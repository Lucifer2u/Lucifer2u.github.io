<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Spring Securityé‡ŒSessionçš„æ¢è®¨ä¸å»¶ä¼¸</title>
    <link href="/2021/08/10/Spring%20Security%E9%87%8CSession%E7%9A%84%E6%8E%A2%E8%AE%A8%E4%B8%8E%E5%BB%B6%E4%BC%B8/"/>
    <url>/2021/08/10/Spring%20Security%E9%87%8CSession%E7%9A%84%E6%8E%A2%E8%AE%A8%E4%B8%8E%E5%BB%B6%E4%BC%B8/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring-Securityé‡ŒSessionçš„æ¢è®¨ä¸å»¶ä¼¸"><a href="#Spring-Securityé‡ŒSessionçš„æ¢è®¨ä¸å»¶ä¼¸" class="headerlink" title="Spring Securityé‡ŒSessionçš„æ¢è®¨ä¸å»¶ä¼¸"></a>Spring Securityé‡ŒSessionçš„æ¢è®¨ä¸å»¶ä¼¸</h1><h2 id="âœï¸é—®é¢˜çš„å¼•å…¥"><a href="#âœï¸é—®é¢˜çš„å¼•å…¥" class="headerlink" title="âœï¸é—®é¢˜çš„å¼•å…¥"></a>âœï¸é—®é¢˜çš„å¼•å…¥</h2><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬ç®€å•åˆ†æäº†ä¸€ä¸ªåŸºäºRBACæ¨¡å‹çš„Spring Securityçš„è®¾è®¡æ€è·¯ï¼Œé€šè¿‡é…ç½®ï¼Œæˆ‘ä»¬çš„ç¡®ç™»é™†æˆåŠŸäº†ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼Œä½ åœ¨æœåŠ¡ç«¯çš„å®‰å…¨ç®¡ç†ä½¿ç”¨äº† Spring Securityï¼Œç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œ<strong>Spring Security å¸®ä½ æŠŠç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨ Session é‡Œï¼Œä½†æ˜¯å…·ä½“ä¿å­˜åœ¨å“ªé‡Œ</strong>ï¼Œè¦æ˜¯ä¸æ·±ç©¶ä½ å¯èƒ½å°±ä¸çŸ¥é“ï¼Œ è¿™å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å¦‚æœç”¨æˆ·åœ¨å‰ç«¯æ“ä½œä¿®æ”¹äº†å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨ä¸é‡æ–°ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è·å–åˆ°æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯ï¼Ÿ</strong></p><p>è¿™ä¹Ÿæ˜¯ä¸€ç›´å›°æ‰°æˆ‘çš„é—®é¢˜ï¼Œæˆ‘æ˜¯é€šè¿‡é˜…è¯»æºç å‘ç°äº†å…³é”®çš„ä¸€æ­¥ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªKeyå»å®ç°äº†é¢å¤–çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæˆ‘ä»¬åˆ°æ—¶å€™å†åˆ†æã€‚</p><h2 id="ğŸ”«åˆæ˜¯Authentication"><a href="#ğŸ”«åˆæ˜¯Authentication" class="headerlink" title="ğŸ”«åˆæ˜¯Authentication"></a>ğŸ”«åˆæ˜¯Authentication</h2><p>åœ¨ Spring Security ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å¯¹è±¡å«åš <code>Authentication</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ³¨å…¥ <code>Authentication</code> è¿›è€Œè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>Authentication</code> æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰å¾ˆå¤šå®ç°ç±»ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809222725161.png" alt="image-20210809222725161"></p><p>åœ¨è¿™ä¼—å¤šçš„å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯<code>UsernamePasswordAuthenticationToken</code>äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªç±»çš„æºç åï¼Œå´å‘ç°è¿™ä¸ªç±»å¹³å¹³æ— å¥‡ï¼Œä»–åªæœ‰ä¸¤ä¸ªå±æ€§ã€ä¸¤ä¸ªæ„é€ æ–¹æ³•ä»¥åŠè‹¥å¹²ä¸ª get/set æ–¹æ³•ï¼›å½“ç„¶ï¼Œä»–è¿˜æœ‰æ›´å¤šå±æ€§åœ¨å®ƒçš„çˆ¶ç±»ä¸Šã€‚</p><p>ä½†æ˜¯ä»å®ƒä»…æœ‰çš„è¿™ä¸¤ä¸ªå±æ€§ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤§è‡´çœ‹å‡ºï¼Œè¿™ä¸ªç±»å°±ä¿å­˜äº†æˆ‘ä»¬ç™»å½•ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809222813938.png" alt="image-20210809222813938"></p><p>é‚£ä¹ˆæˆ‘ä»¬çš„ç™»å½•ä¿¡æ¯æ˜¯å¦‚ä½•å­˜åˆ°è¿™ä¸¤ä¸ªå¯¹è±¡ä¸­çš„ï¼Ÿè¿™å°±è¦æ¥æ¢³ç†ä¸€ä¸‹ç™»å½•æµç¨‹äº†ã€‚</p><h2 id="â³ç™»å½•æµç¨‹"><a href="#â³ç™»å½•æµç¨‹" class="headerlink" title="â³ç™»å½•æµç¨‹"></a>â³ç™»å½•æµç¨‹</h2><p>åœ¨ Spring Security ä¸­ï¼Œè®¤è¯ä¸æˆæƒçš„ç›¸å…³æ ¡éªŒéƒ½æ˜¯åœ¨ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨é“¾ä¸­å®Œæˆçš„ï¼Œåœ¨è¿™ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨é“¾ä¸­ï¼Œå’Œè®¤è¯ç›¸å…³çš„è¿‡æ»¤å™¨å°±æ˜¯ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œç¯‡å¹…é—®é¢˜ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºæ¥è¯¥ç±»ä¸­å‡ ä¸ªé‡è¦æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> <span class="hljs-keyword">extends</span></span><span class="hljs-class"><span class="hljs-title">AbstractAuthenticationProcessingFilter</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">super</span>(<span class="hljs-keyword">new</span> AntPathRequestMatcher(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>));&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;String username = obtainUsername(request);String password = obtainPassword(request);UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(username, password);setDetails(request, authRequest);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainPassword</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(passwordParameter);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainUsername</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(usernameParameter);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDetails</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">UsernamePasswordAuthenticationToken authRequest)</span> </span>&#123;authRequest.setDetails(authenticationDetailsSource.buildDetails(request));&#125;&#125;</code></pre></div><p>æ ¹æ®è¿™æ®µæºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>é¦–å…ˆé€šè¿‡ <code>obtainUsername</code> å’Œ <code>obtainPassword</code> æ–¹æ³•æå–å‡ºè¯·æ±‚é‡Œè¾¹çš„ç”¨æˆ·å/å¯†ç å‡ºæ¥ï¼Œæå–æ–¹å¼å°±æ˜¯<code> request.getParameter</code> ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Spring Security ä¸­é»˜è®¤çš„è¡¨å•ç™»å½•è¦é€šè¿‡ key/value çš„å½¢å¼ä¼ é€’å‚æ•°ï¼Œè€Œä¸èƒ½ä¼ é€’ JSON å‚æ•°ï¼Œå¦‚æœåƒä¼ é€’ JSON å‚æ•°ï¼Œä¿®æ”¹è¿™é‡Œçš„é€»è¾‘å³å¯ï¼ˆå‚è€ƒRBACçš„å®ç°ï¼‰ã€‚</li><li>è·å–åˆ°è¯·æ±‚é‡Œä¼ é€’æ¥çš„ç”¨æˆ·å/å¯†ç ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ„é€ ä¸€ä¸ª <code>UsernamePasswordAuthenticationToken</code> å¯¹è±¡ï¼Œä¼ å…¥ username å’Œ passwordï¼Œusername å¯¹åº”äº† <code>UsernamePasswordAuthenticationToken</code> ä¸­çš„ <code>principal</code> å±æ€§ï¼Œè€Œ password åˆ™å¯¹åº”äº†å®ƒçš„ <code>credentials</code> å±æ€§ã€‚</li><li>æ¥ä¸‹æ¥ setDetails æ–¹æ³•ç»™ details å±æ€§èµ‹å€¼ï¼Œ<code>UsernamePasswordAuthenticationToken</code> æœ¬èº«æ˜¯æ²¡æœ‰ details å±æ€§çš„ï¼Œè¿™ä¸ªå±æ€§åœ¨å®ƒçš„çˆ¶ç±» <code>AbstractAuthenticationToken</code> ä¸­ã€‚details æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œè¾¹æ”¾çš„æ˜¯ <code>WebAuthenticationDetails</code> å®ä¾‹ï¼Œè¯¥å®ä¾‹ä¸»è¦æè¿°äº†ä¸¤ä¸ªä¿¡æ¯ï¼Œè¯·æ±‚çš„ <code>remoteAddress</code> ä»¥åŠè¯·æ±‚çš„ <code>sessionId</code>ã€‚</li><li>æœ€åä¸€æ­¥ï¼Œå°±æ˜¯è°ƒç”¨ <code>authenticate</code> æ–¹æ³•å»åšæ ¡éªŒäº†ã€‚</li></ol><p><strong>ä»è¿™æ®µæºç ä¸­ï¼Œå¤§å®¶å¯ä»¥çœ‹å‡ºæ¥è¯·æ±‚çš„å„ç§ä¿¡æ¯åŸºæœ¬ä¸Šéƒ½æ‰¾åˆ°äº†è‡ªå·±çš„ä½ç½®ï¼Œæ‰¾åˆ°äº†ä½ç½®ï¼Œè¿™å°±æ–¹ä¾¿æˆ‘ä»¬æœªæ¥å»è·å–äº†ã€‚</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹è¯·æ±‚çš„å…·ä½“æ ¡éªŒæ“ä½œã€‚</p><p>åœ¨å‰é¢çš„<code>attemptAuthentication</code>æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•çš„æœ€åä¸€æ­¥å¼€å§‹åšæ ¡éªŒï¼Œæ ¡éªŒæ“ä½œé¦–å…ˆè¦è·å–åˆ°ä¸€ä¸ª<code> AuthenticationManager</code>ï¼Œè¿™é‡Œæ‹¿åˆ°çš„æ˜¯ <code>ProviderManager</code> ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›å…¥åˆ°<code>ProviderManager</code>çš„<code>authenticate</code>æ–¹æ³•ä¸­ï¼Œå½“ç„¶è¿™ä¸ªæ–¹æ³•ä¹Ÿæ¯”è¾ƒé•¿ï¼Œæˆ‘è¿™é‡Œä»…ä»…æ‘˜åˆ—å‡ºæ¥å‡ ä¸ªé‡è¦çš„åœ°æ–¹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication authentication)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;Class&lt;? extends Authentication&gt; toTest = authentication.getClass();<span class="hljs-keyword">for</span> (AuthenticationProvider provider : getProviders()) &#123;<span class="hljs-keyword">if</span> (!provider.supports(toTest)) &#123;<span class="hljs-keyword">continue</span>;&#125;result = provider.authenticate(authentication);<span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;copyDetails(authentication, result);<span class="hljs-keyword">break</span>;&#125;&#125;<span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span> &amp;&amp; parent != <span class="hljs-keyword">null</span>) &#123;result = parentResult = parent.authenticate(authentication);&#125;<span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">if</span> (eraseCredentialsAfterAuthentication&amp;&amp; (result <span class="hljs-keyword">instanceof</span> CredentialsContainer)) &#123;((CredentialsContainer) result).eraseCredentials();&#125;<span class="hljs-keyword">if</span> (parentResult == <span class="hljs-keyword">null</span>) &#123;eventPublisher.publishAuthenticationSuccess(result);&#125;<span class="hljs-keyword">return</span> result;&#125;<span class="hljs-keyword">throw</span> lastException;&#125;</code></pre></div><p><strong>è¿™ä¸ªæ–¹æ³•å°±æ¯”è¾ƒé­”å¹»äº†ï¼Œå› ä¸ºå‡ ä¹å…³äºè®¤è¯çš„é‡è¦é€»è¾‘éƒ½å°†åœ¨è¿™é‡Œå®Œæˆï¼š</strong></p><ol><li>é¦–å…ˆè·å– <code>authentication </code>çš„ Classï¼Œåˆ¤æ–­å½“å‰ <code>provider</code> æ˜¯å¦æ”¯æŒè¯¥ <code>authentication</code></li><li>å¦‚æœæ”¯æŒï¼Œåˆ™è°ƒç”¨ <code>provider</code> çš„ <code>authenticate</code> æ–¹æ³•å¼€å§‹åšæ ¡éªŒï¼Œæ ¡éªŒå®Œæˆåï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Authentication</code>ã€‚ä¸€ä¼šæ¥å’Œå¤§å®¶æ‹è¿™ä¸ªæ–¹æ³•çš„å…·ä½“é€»è¾‘ã€‚</li><li>è¿™é‡Œçš„ <code>provider</code> å¯èƒ½æœ‰å¤šä¸ªï¼Œå¦‚æœ <code>provider </code>çš„ <code>authenticate</code> æ–¹æ³•æ²¡èƒ½æ­£å¸¸è¿”å›ä¸€ä¸ª <code>Authentication</code>ï¼Œåˆ™è°ƒç”¨ <code>provider</code> çš„ <code>parent</code> çš„ <code>authenticate </code>æ–¹æ³•ç»§ç»­æ ¡éªŒã€‚</li><li><code>copyDetails</code> æ–¹æ³•åˆ™ç”¨æ¥æŠŠæ—§çš„ Token çš„ details å±æ€§æ‹·è´åˆ°æ–°çš„ Token ä¸­æ¥ã€‚</li><li>æ¥ä¸‹æ¥ä¼šè°ƒç”¨ <code>eraseCredentials</code> æ–¹æ³•æ“¦é™¤å‡­è¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä½ çš„å¯†ç ï¼Œè¿™ä¸ªæ“¦é™¤æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°† Token ä¸­çš„ <code>credentials</code> å±æ€§ç½®ç©ºã€‚</li><li>æœ€åé€šè¿‡ <code>publishAuthenticationSuccess</code> æ–¹æ³•å°†ç™»å½•æˆåŠŸçš„äº‹ä»¶å¹¿æ’­å‡ºå»ã€‚</li></ol><p>å¤§è‡´çš„æµç¨‹ï¼Œå°±æ˜¯ä¸Šé¢è¿™æ ·ï¼Œåœ¨ for å¾ªç¯ä¸­ï¼Œç¬¬ä¸€æ¬¡æ‹¿åˆ°çš„ provider æ˜¯ä¸€ä¸ª <code>AnonymousAuthenticationProvider</code>ï¼Œè¿™ä¸ª provider å‹æ ¹å°±ä¸æ”¯æŒ <code>UsernamePasswordAuthenticationToken</code>ï¼Œä¹Ÿå°±æ˜¯ä¼šç›´æ¥åœ¨ <code>provider.supports</code> æ–¹æ³•ä¸­è¿”å› falseï¼Œç»“æŸ for å¾ªç¯ï¼Œç„¶åä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ª if ä¸­ï¼Œç›´æ¥è°ƒç”¨ parent çš„ authenticate æ–¹æ³•è¿›è¡Œæ ¡éªŒã€‚</p><p>è€Œ parent å°±æ˜¯ <code>ProviderManager</code>ï¼Œæ‰€ä»¥ä¼šå†æ¬¡å›åˆ°è¿™ä¸ª <code>authenticate</code> æ–¹æ³•ä¸­ã€‚å†æ¬¡å›åˆ° <code>authenticate</code> æ–¹æ³•ä¸­ï¼Œprovider ä¹Ÿå˜æˆäº† <code>DaoAuthenticationProvider</code>ï¼Œè¿™ä¸ª provider æ˜¯æ”¯æŒ <code>UsernamePasswordAuthenticationToken</code> çš„ï¼Œæ‰€ä»¥ä¼šé¡ºåˆ©è¿›å…¥åˆ°è¯¥ç±»çš„ <code>authenticate</code> æ–¹æ³•å»æ‰§è¡Œï¼Œè€Œ <code>DaoAuthenticationProvider</code> ç»§æ‰¿è‡ª <code>AbstractUserDetailsAuthenticationProvider</code> å¹¶ä¸”æ²¡æœ‰é‡å†™ <code>authenticate</code> æ–¹æ³•ï¼Œæ‰€ä»¥ æˆ‘ä»¬æœ€ç»ˆæ¥åˆ° <code>AbstractUserDetailsAuthenticationProvider#authenticate </code>æ–¹æ³•ä¸­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication authentication)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;String username = (authentication.getPrincipal() == <span class="hljs-keyword">null</span>) ? <span class="hljs-string">&quot;NONE_PROVIDED&quot;</span>: authentication.getName();user = retrieveUser(username,(UsernamePasswordAuthenticationToken) authentication);preAuthenticationChecks.check(user);additionalAuthenticationChecks(user,(UsernamePasswordAuthenticationToken) authentication);postAuthenticationChecks.check(user);Object principalToReturn = user;<span class="hljs-keyword">if</span> (forcePrincipalAsString) &#123;principalToReturn = user.getUsername();&#125;<span class="hljs-keyword">return</span> createSuccessAuthentication(principalToReturn, authentication, user);&#125;</code></pre></div><p>è¿™é‡Œçš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼š</p><ol><li>é¦–å…ˆä» <code>Authentication</code> æå–å‡ºç™»å½•ç”¨æˆ·åã€‚</li><li>ç„¶åé€šè¿‡æ‹¿ç€ username å»è°ƒç”¨ <code>retrieveUser </code>æ–¹æ³•å»è·å–å½“å‰ç”¨æˆ·å¯¹è±¡ï¼Œè¿™ä¸€æ­¥ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå·±åœ¨ç™»å½•æ—¶å€™çš„å†™çš„<code>loadUserByUsername</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›çš„ user å…¶å®å°±æ˜¯ä½ çš„ç™»å½•å¯¹è±¡ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/Lucifer2u/xm-luciferpro/blob/master/luciferpro-server/luciferpro-service/src/main/java/org/lucifer/vbluciferpro/service/HrService.java">æˆ‘githubä¸­</a>çš„29è¡Œ</li><li>æ¥ä¸‹æ¥è°ƒç”¨ <code>preAuthenticationChecks.check</code> æ–¹æ³•å»æ£€éªŒ user ä¸­çš„å„ä¸ªè´¦æˆ·çŠ¶æ€å±æ€§æ˜¯å¦æ­£å¸¸ï¼Œä¾‹å¦‚è´¦æˆ·æ˜¯å¦è¢«ç¦ç”¨ã€è´¦æˆ·æ˜¯å¦è¢«é”å®šã€è´¦æˆ·æ˜¯å¦è¿‡æœŸç­‰ç­‰ã€‚</li><li><code>additionalAuthenticationChecks</code> æ–¹æ³•åˆ™æ˜¯åšå¯†ç æ¯”å¯¹çš„ï¼Œå¥½å¤šäººå¥½å¥‡ Spring Security çš„å¯†ç åŠ å¯†ä¹‹åï¼Œæ˜¯å¦‚ä½•è¿›è¡Œæ¯”è¾ƒçš„ï¼Œçœ‹è¿™é‡Œå°±æ‡‚äº†ï¼Œå› ä¸ºæ¯”è¾ƒçš„é€»è¾‘å¾ˆç®€å•ï¼Œæˆ‘è¿™é‡Œå°±ä¸è´´ä»£ç å‡ºæ¥äº†ã€‚</li><li>æœ€ååœ¨ <code>postAuthenticationChecks.check</code> æ–¹æ³•ä¸­æ£€æŸ¥å¯†ç æ˜¯å¦è¿‡æœŸã€‚</li><li>æ¥ä¸‹æ¥æœ‰ä¸€ä¸ª <code>forcePrincipalAsString </code>å±æ€§ï¼Œè¿™ä¸ªæ˜¯æ˜¯å¦å¼ºåˆ¶å°†<code> Authentication</code> ä¸­çš„ principal å±æ€§è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå±æ€§æˆ‘ä»¬ä¸€å¼€å§‹åœ¨<code>UsernamePasswordAuthenticationFilter</code>ç±»ä¸­å…¶å®å°±æ˜¯è®¾ç½®ä¸ºå­—ç¬¦ä¸²çš„ï¼ˆå³ usernameï¼‰ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œ è¿™ä¸ªå±æ€§çš„å€¼å°±å˜æˆå½“å‰ç”¨æˆ·è¿™ä¸ªå¯¹è±¡äº†ã€‚ä¹‹æ‰€ä»¥ä¼šè¿™æ ·ï¼Œå°±æ˜¯å› ä¸º forcePrincipalAsString é»˜è®¤ä¸º falseï¼Œä¸è¿‡è¿™å—å…¶å®ä¸ç”¨æ”¹ï¼Œå°±ç”¨ falseï¼Œè¿™æ ·åœ¨åæœŸè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™åè€Œæ–¹ä¾¿å¾ˆå¤šã€‚</li><li>æœ€åï¼Œé€šè¿‡<code> createSuccessAuthentication</code> æ–¹æ³•æ„å»ºä¸€ä¸ªæ–°çš„ <code>UsernamePasswordAuthenticationToken</code></li></ol><p>å¥½äº†ï¼Œé‚£ä¹ˆç™»å½•çš„æ ¡éªŒæµç¨‹ç°åœ¨å°±åŸºæœ¬å’Œå¤§å®¶æ‹äº†ä¸€éäº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç™»å½•çš„ç”¨æˆ·ä¿¡æ¯æˆ‘ä»¬å»å“ªé‡ŒæŸ¥æ‰¾ï¼Ÿ</p><h2 id="âš™ï¸ç”¨æˆ·ä¿¡æ¯ä¿å­˜"><a href="#âš™ï¸ç”¨æˆ·ä¿¡æ¯ä¿å­˜" class="headerlink" title="âš™ï¸ç”¨æˆ·ä¿¡æ¯ä¿å­˜"></a>âš™ï¸ç”¨æˆ·ä¿¡æ¯ä¿å­˜</h2><p>è¦å»æ‰¾ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å¾—å…ˆæ¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿™ä¸€åˆ‡æ˜¯ä»å“ªé‡Œå¼€å§‹è¢«è§¦å‘çš„ï¼Ÿ</p><p>æˆ‘ä»¬æ¥åˆ° <code>UsernamePasswordAuthenticationFilter</code> çš„çˆ¶ç±» <code>AbstractAuthenticationProcessingFilter</code> ä¸­ï¼Œè¿™ä¸ªç±»æˆ‘ä»¬ç»å¸¸ä¼šè§åˆ°ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™å½“æˆ‘ä»¬æƒ³è¦åœ¨ Spring Security <a href="https://lucifer2u.github.io/2021/08/09/%E6%B5%85%E8%B0%88Spring%20Security%E5%AE%9E%E7%8E%B0RBAC%E6%A8%A1%E5%9E%8B/#%E5%AE%9E%E7%8E%B0JSON%E6%A0%BC%E5%BC%8F%E7%99%BB%E9%99%86">è‡ªå®šä¹‰ä¸€ä¸ªç™»å½•éªŒè¯ç æˆ–è€…å°†ç™»å½•å‚æ•°æ”¹ä¸º JSON</a> çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è‡ªå®šä¹‰è¿‡æ»¤å™¨ç»§æ‰¿è‡ª <code>AbstractAuthenticationProcessingFilter</code> ï¼Œæ¯«æ— ç–‘é—®ï¼Œ<code>UsernamePasswordAuthenticationFilter#attemptAuthentication</code> æ–¹æ³•å°±æ˜¯åœ¨ <code>AbstractAuthenticationProcessingFilter</code> ç±»çš„ doFilter æ–¹æ³•ä¸­è¢«è§¦å‘çš„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;HttpServletRequest request = (HttpServletRequest) req;HttpServletResponse response = (HttpServletResponse) res;Authentication authResult;<span class="hljs-keyword">try</span> &#123;authResult = attemptAuthentication(request, response);<span class="hljs-keyword">if</span> (authResult == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">return</span>;&#125;sessionStrategy.onAuthentication(authResult, request, response);&#125;<span class="hljs-keyword">catch</span> (InternalAuthenticationServiceException failed) &#123;unsuccessfulAuthentication(request, response, failed);<span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">catch</span> (AuthenticationException failed) &#123;unsuccessfulAuthentication(request, response, failed);<span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">if</span> (continueChainBeforeSuccessfulAuthentication) &#123;chain.doFilter(request, response);&#125;successfulAuthentication(request, response, chain, authResult);&#125;</code></pre></div><p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“ <code>attemptAuthentication</code> æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯è§¦å‘äº† <code>UsernamePasswordAuthenticationFilter#attemptAuthentication</code> æ–¹æ³•ï¼Œå½“ç™»å½•æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œ<code>unsuccessfulAuthentication</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè€Œå½“ç™»å½•æˆåŠŸçš„æ—¶å€™ï¼Œ<code>successfulAuthentication</code> æ–¹æ³•åˆ™ä¼šè¢«è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹ <code>successfulAuthentication</code> æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">successfulAuthentication</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">HttpServletResponse response, FilterChain chain, Authentication authResult)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;  <span class="hljs-comment">//æœ¬æ–‡é—®é¢˜çš„key</span>SecurityContextHolder.getContext().setAuthentication(authResult);rememberMeServices.loginSuccess(request, response, authResult);<span class="hljs-comment">// Fire event</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.eventPublisher != <span class="hljs-keyword">null</span>) &#123;eventPublisher.publishEvent(<span class="hljs-keyword">new</span> InteractiveAuthenticationSuccessEvent(authResult, <span class="hljs-keyword">this</span>.getClass()));&#125;successHandler.onAuthenticationSuccess(request, response, authResult);&#125;</code></pre></div><p>åœ¨è¿™é‡Œæœ‰ä¸€æ®µå¾ˆé‡è¦çš„ä»£ç ï¼Œå°±æ˜¯ <code>SecurityContextHolder.getContext().setAuthentication(authResult);</code> ï¼Œç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯è¢«ä¿å­˜åœ¨è¿™é‡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œéƒ½å¯ä»¥ä» <code>SecurityContextHolder.getContext()</code> ä¸­è·å–åˆ°ï¼Œæƒ³ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼Œè¿™é‡Œçš„authResultå­˜çš„æ˜¯ä¸€ä¸ªThreadLocalçš„å˜é‡</strong></p><p>æœ€åå¤§å®¶è¿˜çœ‹åˆ°æœ‰ä¸€ä¸ª <code>successHandler.onAuthenticationSuccess</code>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨ SecurityConfig ä¸­é…ç½®ç™»å½•æˆåŠŸå›è°ƒæ–¹æ³•ï¼Œå°±æ˜¯åœ¨è¿™é‡Œè¢«è§¦å‘çš„ï¼Œè¿™å—å¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://github.com/Lucifer2u/xm-luciferpro/blob/master/luciferpro-server/luciferpro-web/src/main/java/org/lucifer/vbluciferpro/config/SecurityConfig.java">æˆ‘githubé‡Œè¾¹çš„é…ç½®</a>ã€‚ </p></blockquote><p><strong>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬Sessionçš„ä¿¡æ¯ä¹Ÿèƒ½ç¡®è®¤ä¹Ÿä¿å­˜åˆ°è¿™é‡Œäº†ï¼Œæ‹¿åˆ°è¿™ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç€è¿™é‡Œæ€è·¯å»æˆ‘<a href="https://github.com/Lucifer2u/xm-luciferpro">githubä¸Šçš„åç«¯ç®¡ç†é¡¹ç›®</a>ä¸­è®¾è®¡æ–°çš„å†…å®¹ï¼Œæ¯”å¦‚æˆ‘åœ¨ä¸ªäººä¸­å¿ƒä¸­ï¼Œæƒ³è¦åœ¨ä¸é‡æ–°ç™»å½•çš„æƒ…å†µä¸‹ï¼Œè·å–åˆ°æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹é¢æˆ‘å°†é’ˆå¯¹ä¸ªäººä¸­å¿ƒçš„è®¾è®¡æ€è·¯è¿›è¡Œé˜è¿°</strong></p><h2 id="ğŸ’£å¦‚æœç™»é™†å¤±è´¥å‘¢ï¼Ÿ"><a href="#ğŸ’£å¦‚æœç™»é™†å¤±è´¥å‘¢ï¼Ÿ" class="headerlink" title="ğŸ’£å¦‚æœç™»é™†å¤±è´¥å‘¢ï¼Ÿ"></a>ğŸ’£å¦‚æœç™»é™†å¤±è´¥å‘¢ï¼Ÿ</h2><h3 id="ğŸ”‘å¼•å…¥"><a href="#ğŸ”‘å¼•å…¥" class="headerlink" title="ğŸ”‘å¼•å…¥"></a>ğŸ”‘å¼•å…¥</h3><p>æ­£ç¡®æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ç™»å½•æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š</p><ol><li><code>SecurityContextHolder.getContext().getAuthentication()</code></li><li>åœ¨ Controller çš„æ–¹æ³•ä¸­ï¼ŒåŠ å…¥ <code>Authentication </code>å‚æ•°</li></ol><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸Šä¸¤ç§æ–¹å¼çš„ä»»æ„ä¸€ç§å°±å¯ä»¥è·å–åˆ°å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p><strong>ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ€è€ƒï¼Œå¼‚å¸¸æƒ…å†µï¼Œå°±æ˜¯è¿™ä¸¤ç§æ–¹å¼ä¸­çš„ä»»æ„ä¸€ç§ï¼Œéƒ½è¿”å› nullã€‚</strong></p><p>éƒ½è¿”å› nullï¼Œæ„å‘³ç€ç³»ç»Ÿæ”¶åˆ°å½“å‰è¯·æ±‚æ—¶å¹¶ä¸çŸ¥é“ä½ å·²ç»ç™»å½•äº†ï¼ˆå› ä¸ºä½ æ²¡æœ‰åœ¨ç³»ç»Ÿä¸­ç•™ä¸‹ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼‰ï¼Œè¿™ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>æ— æ³•è·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚</li><li>å½“ä½ å‘é€ä»»ä½•è¯·æ±‚ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ä½ è¿”å› 401ã€‚</li></ol><h3 id="ğŸ”’å¼€å§‹å‰–æ"><a href="#ğŸ”’å¼€å§‹å‰–æ" class="headerlink" title="ğŸ”’å¼€å§‹å‰–æ"></a>ğŸ”’å¼€å§‹å‰–æ</h3><p>è¦å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¾—æ˜ç™½ Spring Security ä¸­çš„ç”¨æˆ·ä¿¡æ¯åˆ°åº•æ˜¯åœ¨å“ªé‡Œå­˜çš„ï¼Ÿ</p><p>å‰é¢è¯´äº†ä¸¤ç§æ•°æ®è·å–æ–¹å¼ï¼Œä½†æ˜¯è¿™ä¸¤ç§æ•°æ®è·å–æ–¹å¼ï¼Œè·å–åˆ°çš„æ•°æ®åˆæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p><p><strong><code>SecurityContextHolder</code> ä¸­çš„æ•°æ®ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¿å­˜åœ¨ <code>ThreadLocal</code> ä¸­ï¼Œ<code>ThreadLocal</code> çš„ç‰¹ç‚¹æ˜¯å­˜åœ¨å®ƒé‡Œè¾¹çš„æ•°æ®ï¼Œå“ªä¸ªçº¿ç¨‹å­˜çš„ï¼Œå“ªä¸ªçº¿ç¨‹æ‰èƒ½è®¿é—®åˆ°ã€‚</strong></p><p>è¿™æ ·å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä¸åŒçš„è¯·æ±‚è¿›å…¥åˆ°æœåŠ¡ç«¯ä¹‹åï¼Œç”±ä¸åŒçš„ thread å»å¤„ç†ï¼ŒæŒ‰ç†è¯´åé¢çš„è¯·æ±‚å°±å¯èƒ½æ— æ³•è·å–åˆ°ç™»å½•è¯·æ±‚çš„çº¿ç¨‹å­˜å…¥çš„æ•°æ®ï¼Œä¾‹å¦‚ç™»å½•è¯·æ±‚åœ¨çº¿ç¨‹ A ä¸­å°†ç™»å½•ç”¨æˆ·ä¿¡æ¯å­˜å…¥ <code>ThreadLocal</code>ï¼Œåé¢çš„è¯·æ±‚æ¥äº†ï¼Œåœ¨çº¿ç¨‹ B ä¸­å¤„ç†ï¼Œé‚£æ­¤æ—¶å°±æ— æ³•è·å–åˆ°ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€‚</p><p><strong>ä½†å®é™…ä¸Šï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½èƒ½å¤Ÿè·å–åˆ°ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</strong></p><p>è¿™æˆ‘ä»¬å°±è¦å¼•å…¥ Spring Security ä¸­çš„ <code>SecurityContextPersistenceFilter</code>äº†ã€‚</p><p>å°ä¼™ä¼´ä»¬éƒ½çŸ¥é“ï¼Œæ— è®ºæ˜¯ Spring Security è¿˜æ˜¯ Shiroï¼Œå®ƒçš„ä¸€ç³»åˆ—åŠŸèƒ½å…¶å®éƒ½æ˜¯ç”±è¿‡æ»¤å™¨æ¥å®Œæˆçš„ï¼Œåœ¨ Spring Security ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„æ˜¯<code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨ï¼Œåœ¨è¿™ä¸ªè¿‡æ»¤å™¨ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨å°±æ˜¯ <code>SecurityContextPersistenceFilter</code>ï¼Œè¯·æ±‚åœ¨åˆ°è¾¾ <code>UsernamePasswordAuthenticationFilter</code> ä¹‹å‰éƒ½ä¼šå…ˆç»è¿‡ <code>SecurityContextPersistenceFilter</code>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„æºç (éƒ¨åˆ†)ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityContextPersistenceFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;HttpServletRequest request = (HttpServletRequest) req;HttpServletResponse response = (HttpServletResponse) res;HttpRequestResponseHolder holder = <span class="hljs-keyword">new</span> HttpRequestResponseHolder(request,response);SecurityContext contextBeforeChainExecution = repo.loadContext(holder);<span class="hljs-keyword">try</span> &#123;SecurityContextHolder.setContext(contextBeforeChainExecution);chain.doFilter(holder.getRequest(), holder.getResponse());&#125;<span class="hljs-keyword">finally</span> &#123;SecurityContext contextAfterChainExecution = SecurityContextHolder.getContext();SecurityContextHolder.clearContext();repo.saveContext(contextAfterChainExecution, holder.getRequest(),holder.getResponse());&#125;&#125;&#125;</code></pre></div><p>åŸæœ¬çš„æ–¹æ³•å¾ˆé•¿ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºæ¥äº†æ¯”è¾ƒå…³é”®çš„å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><code>SecurityContextPersistenceFilter</code> ç»§æ‰¿è‡ª <code>GenericFilterBean</code>ï¼Œè€Œ<code> GenericFilterBean</code> åˆ™æ˜¯ Filter çš„å®ç°ï¼Œæ‰€ä»¥ <code>SecurityContextPersistenceFilter</code> ä½œä¸ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒé‡Œè¾¹æœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯ doFilter äº†ã€‚</li><li>åœ¨ doFilter æ–¹æ³•ä¸­ï¼Œå®ƒé¦–å…ˆä¼šä» repo ä¸­è¯»å–ä¸€ä¸ª <code>SecurityContext</code> å‡ºæ¥ï¼Œè¿™é‡Œçš„ repo å®é™…ä¸Šå°±æ˜¯ <code>HttpSessionSecurityContextRepository</code>ï¼Œè¯»å– <code>SecurityContext</code> çš„æ“ä½œä¼šè¿›å…¥åˆ° <code>readSecurityContextFromSession</code> æ–¹æ³•ä¸­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†è¯»å–çš„æ ¸å¿ƒæ–¹æ³• <code>Object contextFromSession = httpSession.getAttribute(springSecurityContextKey);</code>ï¼Œè¿™é‡Œçš„ <code>springSecurityContextKey</code> å¯¹è±¡çš„å€¼å°±æ˜¯ <code>SPRING_SECURITY_CONTEXT</code>ï¼Œè¯»å–å‡ºæ¥çš„å¯¹è±¡æœ€ç»ˆä¼šè¢«è½¬ä¸ºä¸€ä¸ª <code>SecurityContext</code> å¯¹è±¡ã€‚</li><li><code>SecurityContext</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ç°ç±» <code>SecurityContextImpl</code>ï¼Œè¿™ä¸ªå®ç°ç±»å…¶å®å°±æ˜¯ç”¨æˆ·ä¿¡æ¯åœ¨ session ä¸­ä¿å­˜çš„ valueã€‚</li><li>åœ¨æ‹¿åˆ° <code>SecurityContext </code>ä¹‹åï¼Œé€šè¿‡ <code>SecurityContextHolder.setContext</code> æ–¹æ³•å°†è¿™ä¸ª SecurityContext è®¾ç½®åˆ° <code>ThreadLocal </code>ä¸­å»ï¼Œè¿™æ ·ï¼Œåœ¨å½“å‰è¯·æ±‚ä¸­ï¼Œ<code>Spring Security</code> çš„åç»­æ“ä½œï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥ä»<code>SecurityContextHolder</code>ä¸­è·å–åˆ°ç”¨æˆ·ä¿¡æ¯äº†ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œé€šè¿‡<code> chain.doFilter</code> è®©è¯·æ±‚ç»§ç»­å‘ä¸‹èµ°ï¼ˆè¿™ä¸ªæ—¶å€™å°±ä¼šè¿›å…¥åˆ° <code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨ä¸­äº†ï¼‰ã€‚</li><li>åœ¨è¿‡æ»¤å™¨é“¾èµ°å®Œä¹‹åï¼Œæ•°æ®å“åº”ç»™å‰ç«¯ä¹‹åï¼Œfinally ä¸­è¿˜æœ‰ä¸€æ­¥æ”¶å°¾æ“ä½œï¼Œè¿™ä¸€æ­¥å¾ˆå…³é”®ã€‚è¿™é‡Œä» <code>SecurityContextHolder</code> ä¸­è·å–åˆ° <code>SecurityContext</code>ï¼Œè·å–åˆ°ä¹‹åï¼Œä¼šæŠŠ <code>SecurityContextHolder</code> æ¸…ç©ºï¼Œç„¶åè°ƒç”¨ <code>repo.saveContext</code> æ–¹æ³•å°†è·å–åˆ°çš„<code>SecurityContext</code>å­˜å…¥ session ä¸­ã€‚</li></ol><p>è‡³æ­¤ï¼Œæ•´ä¸ªæµç¨‹å°±å¾ˆæ˜äº†äº†ã€‚</p><p><strong>æ¯ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œé¦–å…ˆä» session ä¸­æ‰¾å‡ºæ¥ <code>SecurityContext</code> ï¼Œç„¶åè®¾ç½®åˆ° <code>SecurityContextHolder </code>ä¸­å»ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ï¼Œå½“è¿™ä¸ªè¯·æ±‚ç¦»å¼€çš„æ—¶å€™ï¼Œ<code>SecurityContextHolder</code> ä¼šè¢«æ¸…ç©ºï¼Œ<code>SecurityContext</code> ä¼šè¢«æ”¾å› session ä¸­ï¼Œæ–¹ä¾¿ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è·å–ã€‚</strong></p><p>ææ˜ç™½è¿™ä¸€ç‚¹ä¹‹åï¼Œå†å»è§£å†³ Spring Security ç™»å½•åæ— æ³•è·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·è¿™ä¸ªé—®é¢˜ï¼Œå°±éå¸¸ easy äº†ã€‚</p><h3 id="ğŸ˜„é—®é¢˜è§£å†³"><a href="#ğŸ˜„é—®é¢˜è§£å†³" class="headerlink" title="ğŸ˜„é—®é¢˜è§£å†³"></a>ğŸ˜„é—®é¢˜è§£å†³</h3><p>ç»è¿‡ä¸Šé¢çš„åˆ†æä¹‹åï¼Œæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿç™»å½•ä¹‹åæ— æ³•è·å–åˆ°å½“å‰ç”¨æˆ·ä¿¡æ¯è¿™æ ·çš„äº‹æƒ…ï¼Ÿ</p><p>æœ€ç®€å•æƒ…å†µçš„å°±æ˜¯ä½ åœ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œ <code>SecurityContextHolder.getContext().getAuthentication()</code>ï¼Œè¿™è‚¯å®šè·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å¤šè¯´ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/menu&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            Authentication authentication = SecurityContextHolder.getContext().getAuthentication();            System.out.println(authentication);        &#125;    &#125;).start();    <span class="hljs-keyword">return</span> menuService.getMenusByHrId();&#125;</code></pre></div><p>è¿™ç§ç®€å•çš„é—®é¢˜ç›¸ä¿¡å¤§å®¶éƒ½èƒ½å¤Ÿå¾ˆå®¹æ˜“æ’æŸ¥åˆ°ã€‚</p><p><strong>è¿˜æœ‰ä¸€ç§éšè—æ¯”è¾ƒæ·±çš„å°±æ˜¯åœ¨ <code>SecurityContextPersistenceFilter </code>çš„ doFilter æ–¹æ³•ä¸­æ²¡èƒ½ä» session ä¸­åŠ è½½åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¿›è€Œå¯¼è‡´ <code>SecurityContextHolder </code>é‡Œè¾¹ç©ºç©ºå¦‚ä¹Ÿã€‚</strong></p><p>åœ¨ <code>SecurityContextPersistenceFilter </code>ä¸­æ²¡èƒ½åŠ è½½åˆ°ç”¨æˆ·ä¿¡æ¯ï¼ŒåŸå› å¯èƒ½å°±æ¯”è¾ƒå¤šäº†ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>ã€Œä¸Šä¸€ä¸ªè¯·æ±‚ä¸´èµ°çš„æ—¶å€™ï¼Œæ²¡æœ‰å°†æ•°æ®å­˜å‚¨åˆ° session ä¸­å»ã€‚ã€</strong></li><li><strong>ã€Œå½“å‰è¯·æ±‚è‡ªå·±æ²¡èµ°è¿‡æ»¤å™¨é“¾ã€‚ã€</strong></li></ul><p>ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰çš„å°ä¼™ä¼´å¯èƒ½åœ¨é…ç½® <code>SecurityConfig#configure(WebSecurity)</code> æ–¹æ³•æ—¶ï¼Œä¼šå¿½ç•¥æ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ã€‚</p><p>å½“æˆ‘ä»¬æƒ³è®© Spring Security ä¸­çš„èµ„æºå¯ä»¥åŒ¿åè®¿é—®æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§åŠæ³•ï¼š</p><ol><li>ä¸èµ° Spring Security è¿‡æ»¤å™¨é“¾ã€‚</li><li>ç»§ç»­èµ° Spring Security è¿‡æ»¤å™¨é“¾ï¼Œä½†æ˜¯å¯ä»¥åŒ¿åè®¿é—®ã€‚</li></ol><p>è¿™ä¸¤ç§åŠæ³•å¯¹åº”äº†ä¸¤ç§ä¸åŒçš„é…ç½®æ–¹å¼ã€‚å…¶ä¸­ç¬¬ä¸€ç§é…ç½®å¯èƒ½ä¼šå½±å“åˆ°æˆ‘ä»¬è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç¬¬äºŒç§åˆ™ä¸å½±å“ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ¥é‡ç‚¹çœ‹çœ‹ç¬¬ä¸€ç§ã€‚</p><p>ä¸æƒ³èµ° Spring Security è¿‡æ»¤å™¨é“¾ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/js/**&quot;</span>,<span class="hljs-string">&quot;/index.html&quot;</span>,<span class="hljs-string">&quot;/img/**&quot;</span>,<span class="hljs-string">&quot;/fonts/**&quot;</span>,<span class="hljs-string">&quot;/favicon.ico&quot;</span>,<span class="hljs-string">&quot;/verifyCode&quot;</span>);&#125;</code></pre></div><p>æ­£å¸¸è¿™æ ·é…ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>å¦‚æœä½ å¾ˆä¸å·§ï¼ŒæŠŠç™»å½•è¯·æ±‚åœ°å€æ”¾è¿›æ¥äº†ï¼Œé‚£å°± gg äº†ã€‚è™½ç„¶ç™»å½•è¯·æ±‚å¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½æ”¾åœ¨è¿™é‡Œï¼ˆè€Œåº”è¯¥é€šè¿‡å…è®¸åŒ¿åè®¿é—®çš„æ–¹å¼æ¥ç»™è¯·æ±‚æ”¾è¡Œï¼‰ã€‚<strong>ã€Œå¦‚æœæ”¾åœ¨è¿™é‡Œï¼Œç™»å½•è¯·æ±‚å°†ä¸èµ° <code>SecurityContextPersistenceFilter</code> è¿‡æ»¤å™¨ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸ä¼šå°†ç™»å½•ç”¨æˆ·ä¿¡æ¯å­˜å…¥ sessionï¼Œè¿›è€Œå¯¼è‡´åç»­è¯·æ±‚æ— æ³•è·å–åˆ°ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚ã€</strong></p><h2 id="ğŸ‘¤æ²¿ç€è·¯ï¼šä¸ªäººä¸­å¿ƒçš„è®¾è®¡"><a href="#ğŸ‘¤æ²¿ç€è·¯ï¼šä¸ªäººä¸­å¿ƒçš„è®¾è®¡" class="headerlink" title="ğŸ‘¤æ²¿ç€è·¯ï¼šä¸ªäººä¸­å¿ƒçš„è®¾è®¡"></a>ğŸ‘¤æ²¿ç€è·¯ï¼šä¸ªäººä¸­å¿ƒçš„è®¾è®¡</h2><h3 id="ğŸ”‘å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯"><a href="#ğŸ”‘å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ğŸ”‘å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯"></a>ğŸ”‘å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯</h3><p>åœ¨Spring Securityä¸­æä¾›äº†<code>Authentication</code>ï¼Œå¯ä»¥ç›´æ¥åœ¨Controllerä¸­ç›´æ¥æ³¨å…¥å°±å¯ä»¥ä½¿ç”¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Hr <span class="hljs-title">getCurrentHr</span><span class="hljs-params">(Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">return</span> ((Hr) authentication.getPrincipal());&#125;</code></pre></div><h3 id="ğŸ”‘å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"><a href="#ğŸ”‘å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ğŸ”‘å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"></a>ğŸ”‘å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</h3><p>å› ä¸ºSpring Securityå¸®ä½ æŠŠSessionä¿å­˜å¥½äº†ï¼Œè‡ªå·±æ²¡å¤„ç†ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ä¸Šè¯‰åˆ†æçš„ç»“æœæ¥æ›´æ”¹ï¼Œæ¥ä¸‹æ¥å®šä¹‰æ¥å£ï¼š</p><p>ç›¸å½“äºé‡æ–°æ„å»ºä¸€ä¸ª<code>Authentication</code> å®ä¾‹æ”¾åˆ°Contextä¸­å»ï¼Œåˆåˆ†ä¸ºï¼š</p><ul><li><strong>ä¿®æ”¹ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯ï¼Œä¸éœ€è¦é‡æ–°ç™»å½•</strong></li><li><strong>ä¿®æ”¹å¯†ç åéœ€è¦é‡æ–°ç™»å½•ï¼ˆåœ¨å‰ç«¯å¤„ç†æ­¤é€»è¾‘ï¼‰</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PutMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr, Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;      <span class="hljs-comment">//åˆ©ç”¨ä¸Šé¢çš„æ€è·¯ï¼Œç›´æ¥ä¿®æ”¹</span>        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;<span class="hljs-meta">@PutMapping(&quot;/hr/pass&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Map&lt;String, Object&gt; info)</span> </span>&#123;    String oldpass = (String) info.get(<span class="hljs-string">&quot;oldpass&quot;</span>);    String pass = (String) info.get(<span class="hljs-string">&quot;pass&quot;</span>);    Integer hrid = (Integer) info.get(<span class="hljs-string">&quot;hrid&quot;</span>);    <span class="hljs-keyword">if</span> (hrService.updateHrPasswd(oldpass, pass, hrid)) &#123;        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;</code></pre></div><p>å› ä¸ºä¿®æ”¹å¯†ç éœ€è¦è®¾è®¡åˆ°æ•°æ®åº“çš„æ“ä½œï¼Œç„¶åè®¾è®¡Serviceå±‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(String oldpass, String pass, Integer hrid)</span> </span>&#123;    Hr hr = hrMapper.selectByPrimaryKey(hrid);    BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    <span class="hljs-keyword">if</span> (encoder.matches(oldpass, hr.getPassword())) &#123;        String encodePass = encoder.encode(pass);        Integer result = hrMapper.updatePasswd(hrid, encodePass);        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;</code></pre></div><p>ç„¶åå®šä¹‰Mapper</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updatePasswd&quot;</span>&gt;</span>  update hr set password = #&#123;encodePass&#125; where id=#&#123;hrid&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div><p>è¿™æ ·å°±å®Œæˆäº†ä¸ªäººä¸­å¿ƒçš„åŸºç¡€é…ç½®ï¼Œä¿®æ”¹å¤´åƒå¯ä»¥å­˜åœ¨äº‘ç«¯æˆ–è€…è‡ªå·±æœ¬åœ°çš„æœåŠ¡å™¨ä¸Šï¼Œçœ‹è‡ªå·±å¦‚ä½•é€‰æ‹©ï¼Œæˆ‘æ˜¯ç”¨FaseDFSå®Œæˆäº†å­˜å‚¨çš„é—®é¢˜ï¼Œä»¥åæœ‰æœºä¼šå¦å¤–å†™ä¸€ç¯‡æ–‡ç« è®¨è®º</p><p><strong>è¿™æ ·å…³äºSessionçš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜èƒ½ç»§ç»­æ¢è®¨ï¼Œåœ¨ç°å®ä¸­æˆ‘ä»¬ä¼šæœ‰è¿™æ ·çš„è¯·æ±‚ï¼Œå·²ç»ç™»é™†äº†çš„ç”¨æˆ·ï¼Œå†å¦ä¸€ç«¯ç™»é™†çš„æ—¶å€™ï¼Œéœ€è¦æŠŠä¹‹å‰ç™»é™†çš„ä¿¡æ¯æŠ¹é™¤å¹¶è¸¢æ‰ï¼Œé˜²æ­¢å¤šç«¯ç™»é™†ï¼Œé€ æˆä¸å¿…è¦çš„éº»çƒ¦</strong></p><h2 id="ğŸ¦¶ç»§ç»­èµ°ï¼šè¸¢æ‰å·²ç™»å½•ç”¨æˆ·"><a href="#ğŸ¦¶ç»§ç»­èµ°ï¼šè¸¢æ‰å·²ç™»å½•ç”¨æˆ·" class="headerlink" title="ğŸ¦¶ç»§ç»­èµ°ï¼šè¸¢æ‰å·²ç™»å½•ç”¨æˆ·"></a>ğŸ¦¶ç»§ç»­èµ°ï¼šè¸¢æ‰å·²ç™»å½•ç”¨æˆ·</h2><h3 id="ğŸ¤”åˆ†æéœ€æ±‚"><a href="#ğŸ¤”åˆ†æéœ€æ±‚" class="headerlink" title="ğŸ¤”åˆ†æéœ€æ±‚"></a>ğŸ¤”åˆ†æéœ€æ±‚</h3><p>åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åªå…è®¸ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€ä¸ªç»ˆç«¯ä¸Šç™»å½•ï¼Œä¸€èˆ¬æ¥è¯´è¿™å¯èƒ½æ˜¯å‡ºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æƒ…å†µæ˜¯å‡ºäºä¸šåŠ¡ä¸Šçš„è€ƒè™‘</p><p>è¦å®ç°ä¸€ä¸ªç”¨æˆ·ä¸å¯ä»¥åŒæ—¶åœ¨ä¸¤å°è®¾å¤‡ä¸Šç™»å½•ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯ï¼š</p><ul><li>åæ¥çš„ç™»å½•è‡ªåŠ¨è¸¢æ‰å‰é¢çš„ç™»å½•ï¼Œå°±åƒå¤§å®¶åœ¨QQä¸­çœ‹åˆ°çš„æ•ˆæœã€‚</li><li>å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™ä¸å…è®¸åæ¥è€…ç™»å½•ã€‚</li></ul><p>è¿™ç§æ€è·¯éƒ½èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªï¼Œè¿˜è¦çœ‹æˆ‘ä»¬å…·ä½“çš„éœ€æ±‚ã€‚</p><h3 id="ğŸ”§åŸºç¡€é…ç½®"><a href="#ğŸ”§åŸºç¡€é…ç½®" class="headerlink" title="ğŸ”§åŸºç¡€é…ç½®"></a>ğŸ”§åŸºç¡€é…ç½®</h3><p><strong>æƒ³è¦è¸¢æ‰å·²ç™»å½•çš„ç”¨æˆ·é…ç½®</strong>èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æœ€å¤§ä¼šè¯æ•°è®¾ç½®ä¸º 1 å³å¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            .anyRequest().authenticated()            .sessionManagement()            .maximumSessions(<span class="hljs-number">1</span>);&#125;</code></pre></div><p><code>setMaximumSessions</code> è¡¨ç¤ºé…ç½®æœ€å¤§ä¼šè¯æ•°ä¸º 1ï¼Œè¿™æ ·åé¢çš„ç™»å½•å°±ä¼šè‡ªåŠ¨è¸¢æ‰å‰é¢çš„ç™»å½•ã€‚</p><p>å¦‚æœç›¸åŒçš„ç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œä½ ä¸æƒ³è¸¢æ‰ä»–ï¼Œè€Œæ˜¯æƒ³ç¦æ­¢æ–°çš„ç™»å½•æ“ä½œï¼Œé‚£ä¹Ÿå¥½åŠï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            .anyRequest().authenticated()            .sessionManagement()            .maximumSessions(<span class="hljs-number">1</span>)            .maxSessionsPreventsLogin(<span class="hljs-keyword">true</span>);&#125;</code></pre></div><p>æ·»åŠ  <code>maxSessionsPreventsLogin</code> é…ç½®å³å¯ã€‚æ­¤æ—¶ä¸€ä¸ªæµè§ˆå™¨ç™»å½•æˆåŠŸåï¼Œå¦å¤–ä¸€ä¸ªæµè§ˆå™¨å°±ç™»å½•ä¸äº†äº†ã€‚</p><blockquote><p>maxSessionsPreventsLoginæä¾›ä¸¤ç§sessionä¿æŠ¤ç­–ç•¥ï¼š</p><ul><li>trueè¡¨ç¤ºå·²ç»ç™»å½•å°±ä¸äºˆè®¸å†æ¬¡ç™»å½•ï¼Œ</li><li>falseè¡¨ç¤ºå…è®¸å†æ¬¡ç™»å½•ä½†æ˜¯ä¹‹å‰çš„ç™»å½•è´¦æˆ·ä¼šè¢«è¸¢ä¸‹çº¿</li></ul></blockquote><p>ä¸è¿‡è¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æä¾›ä¸€ä¸ª Beanï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">HttpSessionEventPublisher <span class="hljs-title">httpSessionEventPublisher</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HttpSessionEventPublisher();&#125;</code></pre></div><p><strong>ä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ª Bean å‘¢ï¼Ÿå› ä¸ºåœ¨ Spring Security ä¸­ï¼Œå®ƒæ˜¯é€šè¿‡ç›‘å¬ session çš„é”€æ¯äº‹ä»¶ï¼Œæ¥åŠæ—¶çš„æ¸…ç† session çš„è®°å½•</strong>ã€‚ç”¨æˆ·ä»ä¸åŒçš„æµè§ˆå™¨ç™»å½•åï¼Œéƒ½ä¼šæœ‰å¯¹åº”çš„ sessionï¼Œå½“ç”¨æˆ·æ³¨é”€ç™»å½•ä¹‹åï¼Œsession å°±ä¼šå¤±æ•ˆï¼Œä½†æ˜¯é»˜è®¤çš„å¤±æ•ˆæ˜¯é€šè¿‡è°ƒç”¨ <code>StandardSession#invalidate</code> æ–¹æ³•æ¥å®ç°çš„ï¼Œè¿™ä¸€ä¸ªå¤±æ•ˆäº‹ä»¶æ— æ³•è¢« Spring å®¹å™¨æ„ŸçŸ¥åˆ°ï¼Œè¿›è€Œå¯¼è‡´å½“ç”¨æˆ·æ³¨é”€ç™»å½•ä¹‹åï¼ŒSpring Security æ²¡æœ‰åŠæ—¶æ¸…ç†ä¼šè¯ä¿¡æ¯è¡¨ï¼Œä»¥ä¸ºç”¨æˆ·è¿˜åœ¨çº¿ï¼Œè¿›è€Œå¯¼è‡´ç”¨æˆ·æ— æ³•é‡æ–°ç™»å½•è¿›æ¥ï¼ˆå¤§å®¶å¯ä»¥ä¸æ·»åŠ ä¸Šé¢çš„ Beanï¼Œç„¶åè®©ç”¨æˆ·æ³¨é”€ç™»å½•ä¹‹åå†é‡æ–°ç™»å½•ï¼‰ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ª <code>HttpSessionEventPublisher</code> ï¼Œè¿™ä¸ªç±»å®ç°äº† <code>HttpSessionListener</code> æ¥å£ï¼Œåœ¨è¯¥ Bean ä¸­ï¼Œå¯ä»¥å°† session åˆ›å»ºä»¥åŠé”€æ¯çš„äº‹ä»¶åŠæ—¶æ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”è°ƒç”¨ Spring ä¸­çš„äº‹ä»¶æœºåˆ¶å°†ç›¸å…³çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶å‘å¸ƒå‡ºå»ï¼Œè¿›è€Œè¢« Spring Security æ„ŸçŸ¥åˆ°ï¼Œè¯¥ç±»éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionCreated</span><span class="hljs-params">(HttpSessionEvent event)</span> </span>&#123;HttpSessionCreatedEvent e = <span class="hljs-keyword">new</span> HttpSessionCreatedEvent(event.getSession());getContext(event.getSession().getServletContext()).publishEvent(e);&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionDestroyed</span><span class="hljs-params">(HttpSessionEvent event)</span> </span>&#123;HttpSessionDestroyedEvent e = <span class="hljs-keyword">new</span> HttpSessionDestroyedEvent(event.getSession());getContext(event.getSession().getServletContext()).publishEvent(e);&#125;</code></pre></div><p>OKï¼Œè™½ç„¶å¤šäº†ä¸€ä¸ªé…ç½®ï¼Œä½†æ˜¯ä¾ç„¶å¾ˆç®€å•ï¼</p><h3 id="ğŸ“–å®ç°åŸç†"><a href="#ğŸ“–å®ç°åŸç†" class="headerlink" title="ğŸ“–å®ç°åŸç†"></a>ğŸ“–å®ç°åŸç†</h3><p>ä¸Šé¢è¿™ä¸ªåŠŸèƒ½ï¼Œåœ¨ Spring Security ä¸­æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç¨å¾®åˆ†æä¸€ä¸‹æºç ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ç”¨æˆ·ç™»å½•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»è¿‡ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œè€Œ <code>UsernamePasswordAuthenticationFilter</code> ä¸­è¿‡æ»¤æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨ <code>AbstractAuthenticationProcessingFilter</code> ä¸­è§¦å‘çš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ <code>AbstractAuthenticationProcessingFilter#doFilter </code>æ–¹æ³•çš„è°ƒç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;HttpServletRequest request = (HttpServletRequest) req;HttpServletResponse response = (HttpServletResponse) res;<span class="hljs-keyword">if</span> (!requiresAuthentication(request, response)) &#123;chain.doFilter(request, response);<span class="hljs-keyword">return</span>;&#125;Authentication authResult;<span class="hljs-keyword">try</span> &#123;authResult = attemptAuthentication(request, response);<span class="hljs-keyword">if</span> (authResult == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">return</span>;&#125;sessionStrategy.onAuthentication(authResult, request, response);&#125;<span class="hljs-keyword">catch</span> (InternalAuthenticationServiceException failed) &#123;unsuccessfulAuthentication(request, response, failed);<span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">catch</span> (AuthenticationException failed) &#123;unsuccessfulAuthentication(request, response, failed);<span class="hljs-keyword">return</span>;&#125;<span class="hljs-comment">// Authentication success</span><span class="hljs-keyword">if</span> (continueChainBeforeSuccessfulAuthentication) &#123;chain.doFilter(request, response);&#125;successfulAuthentication(request, response, chain, authResult);</code></pre></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨ <code>attemptAuthentication</code> æ–¹æ³•èµ°å®Œè®¤è¯æµç¨‹ä¹‹åï¼Œå›æ¥ä¹‹åï¼Œ<strong>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨ <code>sessionStrategy.onAuthentication</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥å¤„ç† session çš„å¹¶å‘é—®é¢˜çš„ã€‚</strong>å…·ä½“åœ¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentSessionControlAuthenticationStrategy</span> <span class="hljs-keyword">implements</span></span><span class="hljs-class"><span class="hljs-title">MessageSourceAware</span>, <span class="hljs-title">SessionAuthenticationStrategy</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthentication</span><span class="hljs-params">(Authentication authentication,</span></span><span class="hljs-function"><span class="hljs-params">HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<span class="hljs-keyword">final</span> List&lt;SessionInformation&gt; sessions = sessionRegistry.getAllSessions(authentication.getPrincipal(), <span class="hljs-keyword">false</span>);<span class="hljs-keyword">int</span> sessionCount = sessions.size();<span class="hljs-keyword">int</span> allowedSessions = getMaximumSessionsForThisUser(authentication);<span class="hljs-keyword">if</span> (sessionCount &lt; allowedSessions) &#123;<span class="hljs-comment">// They haven&#x27;t got too many login sessions running at present</span><span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">if</span> (allowedSessions == -<span class="hljs-number">1</span>) &#123;<span class="hljs-comment">// We permit unlimited logins</span><span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">if</span> (sessionCount == allowedSessions) &#123;HttpSession session = request.getSession(<span class="hljs-keyword">false</span>);<span class="hljs-keyword">if</span> (session != <span class="hljs-keyword">null</span>) &#123;<span class="hljs-comment">// Only permit it though if this request is associated with one of the</span><span class="hljs-comment">// already registered sessions</span><span class="hljs-keyword">for</span> (SessionInformation si : sessions) &#123;<span class="hljs-keyword">if</span> (si.getSessionId().equals(session.getId())) &#123;<span class="hljs-keyword">return</span>;&#125;&#125;&#125;<span class="hljs-comment">// If the session is null, a new one will be created by the parent class,</span><span class="hljs-comment">// exceeding the allowed number</span>&#125;allowableSessionsExceeded(sessions, allowedSessions, sessionRegistry);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">allowableSessionsExceeded</span><span class="hljs-params">(List&lt;SessionInformation&gt; sessions,</span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span> allowableSessions, SessionRegistry registry)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> SessionAuthenticationException </span>&#123;<span class="hljs-keyword">if</span> (exceptionIfMaximumExceeded || (sessions == <span class="hljs-keyword">null</span>)) &#123;<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SessionAuthenticationException(messages.getMessage(<span class="hljs-string">&quot;ConcurrentSessionControlAuthenticationStrategy.exceededAllowed&quot;</span>,<span class="hljs-keyword">new</span> Object[] &#123;allowableSessions&#125;,<span class="hljs-string">&quot;Maximum sessions of &#123;0&#125; for this principal exceeded&quot;</span>));&#125;<span class="hljs-comment">// Determine least recently used sessions, and mark them for invalidation</span>sessions.sort(Comparator.comparing(SessionInformation::getLastRequest));<span class="hljs-keyword">int</span> maximumSessionsExceededBy = sessions.size() - allowableSessions + <span class="hljs-number">1</span>;List&lt;SessionInformation&gt; sessionsToBeExpired = sessions.subList(<span class="hljs-number">0</span>, maximumSessionsExceededBy);<span class="hljs-keyword">for</span> (SessionInformation session: sessionsToBeExpired) &#123;session.expireNow();&#125;&#125;&#125;</code></pre></div><p>è¿™æ®µæ ¸å¿ƒä»£ç æˆ‘æ¥ç»™å¤§å®¶ç¨å¾®è§£é‡Šä¸‹ï¼š</p><ol><li>é¦–å…ˆè°ƒç”¨ <code>sessionRegistry.getAllSessions</code> æ–¹æ³•è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ sessionï¼Œè¯¥æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å½“å‰ç”¨æˆ·çš„ <code>authentication</code>ï¼Œå¦ä¸€ä¸ªå‚æ•° false è¡¨ç¤ºä¸åŒ…å«å·²ç»è¿‡æœŸçš„ sessionï¼ˆåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œä¼šå°†ç”¨æˆ·çš„ sessionid å­˜èµ·æ¥ï¼Œå…¶ä¸­ key æ˜¯ç”¨æˆ·çš„ä¸»ä½“ï¼ˆprincipalï¼‰ï¼Œvalue åˆ™æ˜¯è¯¥ä¸»é¢˜å¯¹åº”çš„ sessionid ç»„æˆçš„ä¸€ä¸ªé›†åˆï¼‰ã€‚</li><li>æ¥ä¸‹æ¥è®¡ç®—å‡ºå½“å‰ç”¨æˆ·å·²ç»æœ‰å‡ ä¸ªæœ‰æ•ˆ session äº†ï¼ŒåŒæ—¶è·å–å…è®¸çš„ session å¹¶å‘æ•°ã€‚</li><li>å¦‚æœå½“å‰ session æ•°ï¼ˆsessionCountï¼‰å°äº session å¹¶å‘æ•°ï¼ˆallowedSessionsï¼‰ï¼Œåˆ™ä¸åšä»»ä½•å¤„ç†ï¼›å¦‚æœ allowedSessions çš„å€¼ä¸º -1ï¼Œè¡¨ç¤ºå¯¹ session æ•°é‡ä¸åšä»»ä½•é™åˆ¶ã€‚</li><li>å¦‚æœå½“å‰ session æ•°ï¼ˆsessionCountï¼‰ç­‰äº session å¹¶å‘æ•°ï¼ˆallowedSessionsï¼‰ï¼Œé‚£å°±å…ˆçœ‹çœ‹å½“å‰ session æ˜¯å¦ä¸ä¸º nullï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨äº sessions ä¸­äº†ï¼Œå¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œé‚£éƒ½æ˜¯è‡ªå®¶äººï¼Œä¸åšä»»ä½•å¤„ç†ï¼›å¦‚æœå½“å‰ session ä¸º nullï¼Œé‚£ä¹ˆæ„å‘³ç€å°†æœ‰ä¸€ä¸ªæ–°çš„ session è¢«åˆ›å»ºå‡ºæ¥ï¼Œå±Šæ—¶å½“å‰ session æ•°ï¼ˆsessionCountï¼‰å°±ä¼šè¶…è¿‡ session å¹¶å‘æ•°ï¼ˆallowedSessionsï¼‰ã€‚</li><li>å¦‚æœå‰é¢çš„ä»£ç ä¸­éƒ½æ²¡èƒ½ return æ‰ï¼Œé‚£ä¹ˆå°†è¿›å…¥ç­–ç•¥åˆ¤æ–­æ–¹æ³• <code>allowableSessionsExceeded</code> ä¸­ã€‚</li><li><code>allowableSessionsExceeded</code> æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šæœ‰ <code>exceptionIfMaximumExceeded </code>å±æ€§ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨ SecurityConfig ä¸­é…ç½®çš„ <code>maxSessionsPreventsLogin</code> çš„å€¼ï¼Œé»˜è®¤ä¸º falseï¼Œå¦‚æœä¸º trueï¼Œå°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™æ¬¡ç™»å½•å°±å¤±è´¥äº†ï¼ˆç¦æ­¢æ–°çš„ç™»å½•ï¼‰ï¼Œå¦‚æœä¸º falseï¼Œåˆ™å¯¹ sessions æŒ‰ç…§è¯·æ±‚æ—¶é—´è¿›è¡Œæ’åºï¼Œç„¶åå†ä½¿å¤šä½™çš„ session è¿‡æœŸå³å¯ï¼ˆè¸¢æ‰å·²ç»ç™»å½•ç”¨æˆ·ï¼‰ã€‚</li></ol><h3 id="ğŸª£ç”¨æˆ·é…ç½®æ”¾å…¥åº“"><a href="#ğŸª£ç”¨æˆ·é…ç½®æ”¾å…¥åº“" class="headerlink" title="ğŸª£ç”¨æˆ·é…ç½®æ”¾å…¥åº“"></a>ğŸª£ç”¨æˆ·é…ç½®æ”¾å…¥åº“</h3><p><strong>ä½†æ˜¯ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·æ˜¯é…ç½®åœ¨å†…å­˜ä¸­çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬æ²¡æœ‰å°†ç”¨æˆ·æ”¾åˆ°æ•°æ®åº“ä¸­å»ã€‚åœ¨åš Spring Security çš„ session å¹¶å‘å¤„ç†æ—¶ï¼Œç›´æ¥å°†å†…å­˜ä¸­çš„ç”¨æˆ·åˆ‡æ¢ä¸ºæ•°æ®åº“ä¸­çš„ç”¨æˆ·ä¼šæœ‰é—®é¢˜</strong></p><p>æˆ‘ä»¬å°±è¦å…ˆææ˜ç™½ Spring Security æ˜¯æ€ä¹ˆä¿å­˜ç”¨æˆ·å¯¹è±¡å’Œ session çš„ã€‚</p><p>Spring Security ä¸­é€šè¿‡ SessionRegistryImpl ç±»æ¥å®ç°å¯¹ä¼šè¯ä¿¡æ¯çš„ç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªç±»çš„æºç ï¼ˆéƒ¨åˆ†ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SessionRegistryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SessionRegistry</span>,</span><span class="hljs-class"><span class="hljs-title">ApplicationListener</span>&lt;<span class="hljs-title">SessionDestroyedEvent</span>&gt; </span>&#123;<span class="hljs-comment">/** &lt;principal:Object,SessionIdSet&gt; */</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentMap&lt;Object, Set&lt;String&gt;&gt; principals;<span class="hljs-comment">/** &lt;sessionId:Object,SessionInformation&gt; */</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, SessionInformation&gt; sessionIds;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerNewSession</span><span class="hljs-params">(String sessionId, Object principal)</span> </span>&#123;<span class="hljs-keyword">if</span> (getSessionInformation(sessionId) != <span class="hljs-keyword">null</span>) &#123;removeSessionInformation(sessionId);&#125;sessionIds.put(sessionId,<span class="hljs-keyword">new</span> SessionInformation(principal, sessionId, <span class="hljs-keyword">new</span> Date()));principals.compute(principal, (key, sessionsUsedByPrincipal) -&gt; &#123;<span class="hljs-keyword">if</span> (sessionsUsedByPrincipal == <span class="hljs-keyword">null</span>) &#123;sessionsUsedByPrincipal = <span class="hljs-keyword">new</span> CopyOnWriteArraySet&lt;&gt;();&#125;sessionsUsedByPrincipal.add(sessionId);<span class="hljs-keyword">return</span> sessionsUsedByPrincipal;&#125;);&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeSessionInformation</span><span class="hljs-params">(String sessionId)</span> </span>&#123;SessionInformation info = getSessionInformation(sessionId);<span class="hljs-keyword">if</span> (info == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">return</span>;&#125;sessionIds.remove(sessionId);principals.computeIfPresent(info.getPrincipal(), (key, sessionsUsedByPrincipal) -&gt; &#123;sessionsUsedByPrincipal.remove(sessionId);<span class="hljs-keyword">if</span> (sessionsUsedByPrincipal.isEmpty()) &#123;sessionsUsedByPrincipal = <span class="hljs-keyword">null</span>;&#125;<span class="hljs-keyword">return</span> sessionsUsedByPrincipal;&#125;);&#125;&#125;</code></pre></div><p>è¿™ä¸ªç±»çš„æºç è¿˜æ˜¯æ¯”è¾ƒé•¿ï¼Œæˆ‘è¿™é‡Œæå–å‡ºæ¥ä¸€äº›æ¯”è¾ƒå…³é”®çš„éƒ¨åˆ†ï¼š</p><ol><li>é¦–å…ˆå¤§å®¶çœ‹åˆ°ï¼Œä¸€ä¸Šæ¥å£°æ˜äº†ä¸€ä¸ª<code>principals</code>å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¹¶å‘è®¿é—®çš„ map é›†åˆï¼Œé›†åˆçš„ key å°±æ˜¯ç”¨æˆ·çš„ä¸»ä½“ï¼ˆ<code>principal</code>ï¼‰ï¼Œæ­£å¸¸æ¥è¯´ï¼Œç”¨æˆ·çš„ <code>principal</code> å…¶å®å°±æ˜¯ç”¨æˆ·å¯¹è±¡ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿå’Œå¤§å®¶è®²è¿‡ <code>principal</code> æ˜¯æ€ä¹ˆæ ·å­˜å…¥åˆ°<code> Authentication</code> ä¸­çš„ï¼Œè€Œé›†åˆçš„ value åˆ™æ˜¯ä¸€ä¸ª set é›†åˆï¼Œè¿™ä¸ª set é›†åˆä¸­ä¿å­˜äº†è¿™ä¸ªç”¨æˆ·å¯¹åº”çš„<code> sessionid</code></li><li>å¦‚æœ‰æ–°çš„ session éœ€è¦æ·»åŠ ï¼Œå°±åœ¨ <code>registerNewSession</code> æ–¹æ³•ä¸­è¿›è¡Œæ·»åŠ ï¼Œå…·ä½“æ˜¯è°ƒç”¨ <code>principals.compute</code> æ–¹æ³•è¿›è¡Œæ·»åŠ ï¼Œkey å°±æ˜¯ <code>principal</code></li><li>å¦‚æœç”¨æˆ·æ³¨é”€ç™»å½•ï¼Œ<code>sessionid</code> éœ€è¦ç§»é™¤ï¼Œç›¸å…³æ“ä½œåœ¨ <code>removeSessionInformation </code>æ–¹æ³•ä¸­å®Œæˆï¼Œå…·ä½“ä¹Ÿæ˜¯è°ƒç”¨ <code>principals.computeIfPresent </code>æ–¹æ³•ï¼Œè¿™äº›å…³äºé›†åˆçš„åŸºæœ¬æ“ä½œæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚</li></ol><p>çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œ<code>ConcurrentMap</code> é›†åˆçš„ key æ˜¯ <code>principal </code>å¯¹è±¡ï¼Œ<strong>ç”¨å¯¹è±¡åš keyï¼Œä¸€å®šè¦é‡å†™ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•ï¼Œ</strong>å¦åˆ™ç¬¬ä¸€æ¬¡å­˜å®Œæ•°æ®ï¼Œä¸‹æ¬¡å°±æ‰¾ä¸åˆ°äº†ï¼Œè¿™æ˜¯ JavaSE æ–¹é¢çš„çŸ¥è¯†ï¼Œæˆ‘å°±ä¸ç”¨å¤šè¯´äº†ã€‚</p><p>é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬é‡å†™å®ä½“ç±»çš„ equals å’Œ hashCode æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;    ...    ...    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        Hr hr = (Hr) o;        <span class="hljs-keyword">return</span> Objects.equals(username, hr.username);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> Objects.hash(username);    &#125;    ...    ...&#125;</code></pre></div><h3 id="ğŸ’»ç»“åˆé¡¹ç›®"><a href="#ğŸ’»ç»“åˆé¡¹ç›®" class="headerlink" title="ğŸ’»ç»“åˆé¡¹ç›®"></a>ğŸ’»ç»“åˆé¡¹ç›®</h3><p><strong>ç”±äºç›®å‰æ˜¯é‡‡ç”¨äº† JSON æ ¼å¼ç™»å½•ï¼Œæ‰€ä»¥å¦‚æœé¡¹ç›®æ§åˆ¶ session å¹¶å‘æ•°ï¼Œå°±ä¼šæœ‰ä¸€äº›é¢å¤–çš„é—®é¢˜è¦å¤„ç†ã€‚</strong></p><p><strong>æœ€å¤§çš„é—®é¢˜åœ¨äºæˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ä»£æ›¿äº† <code>UsernamePasswordAuthenticationFilter</code>ï¼Œè¿›è€Œå¯¼è‡´å‰é¢æ‰€è®²çš„å…³äº session çš„é…ç½®ï¼Œç»Ÿç»Ÿå¤±æ•ˆã€‚</strong>æ‰€æœ‰ç›¸å…³çš„é…ç½®æˆ‘ä»¬éƒ½è¦åœ¨æ–°çš„è¿‡æ»¤å™¨ <code>LoginFilter</code> ä¸­è¿›è¡Œé…ç½® ï¼ŒåŒ…æ‹¬ <code>SessionAuthenticationStrategy</code> ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨é…ç½®äº†ã€‚</p><p><strong>æ¥ä¸‹æ¥åœ¨ <code>SecurityConfig </code>ä¸­è¿›è¡Œé…ç½®ã€‚</strong></p><p>è¿™é‡Œæˆ‘ä»¬è¦è‡ªå·±æä¾› <code>SessionAuthenticationStrategy</code>ï¼Œè€Œå‰é¢å¤„ç† session å¹¶å‘çš„æ˜¯<code> ConcurrentSessionControlAuthenticationStrategy</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æä¾›ä¸€ä¸ª <code>ConcurrentSessionControlAuthenticationStrategy</code> çš„å®ä¾‹ï¼Œç„¶åé…ç½®ç»™ <code>LoginFilter</code>ï¼Œä½†æ˜¯åœ¨åˆ›å»º <code>ConcurrentSessionControlAuthenticationStrategy</code> å®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦æœ‰ä¸€ä¸ª <code>SessionRegistryImpl</code> å¯¹è±¡ã€‚</p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œ<code>SessionRegistryImpl</code> å¯¹è±¡æ˜¯ç”¨æ¥ç»´æŠ¤ä¼šè¯ä¿¡æ¯çš„ï¼Œç°åœ¨è¿™ä¸ªä¸œè¥¿ä¹Ÿè¦æˆ‘ä»¬è‡ªå·±æ¥æä¾›ï¼Œ<code>SessionRegistryImpl </code>å®ä¾‹å¾ˆå¥½åˆ›å»ºï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">SessionRegistryImpl <span class="hljs-title">sessionRegistry</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SessionRegistryImpl();&#125;</code></pre></div><p>ç„¶ååœ¨ <code>SecurityConfig</code> ä¸­çš„ <code>LoginFilter</code> ä¸­é…ç½® <code>SessionAuthenticationStrategy</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();<span class="hljs-comment">//è‡ªå·±æä¾›   </span>    ConcurrentSessionControlAuthenticationStrategy sessionStrategy = <span class="hljs-keyword">new</span> ConcurrentSessionControlAuthenticationStrategy(sessionRegistry());    sessionStrategy.setMaximumSessions(<span class="hljs-number">1</span>);    loginFilter.setSessionAuthenticationStrategy(sessionStrategy);    <span class="hljs-keyword">return</span> loginFilter;&#125;</code></pre></div><p>æˆ‘ä»¬åœ¨è¿™é‡Œè‡ªå·±æ‰‹åŠ¨æ„å»º <code>ConcurrentSessionControlAuthenticationStrategy</code> å®ä¾‹ï¼Œæ„å»ºæ—¶ä¼ é€’ <code>SessionRegistryImpl </code>å‚æ•°ï¼Œç„¶åè®¾ç½® session çš„å¹¶å‘æ•°ä¸º 1ï¼Œæœ€åå†å°† <code>sessionStrategy</code> é…ç½®ç»™ <code>LoginFilter</code></p><p>è¿™å°±é…ç½®å®Œäº†å—ï¼Ÿæ²¡æœ‰ï¼session å¤„ç†è¿˜æœ‰ä¸€ä¸ªå…³é”®çš„è¿‡æ»¤å™¨å«åš <code>ConcurrentSessionFilter</code>ï¼Œæœ¬æ¥è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯ä¸éœ€è¦æˆ‘ä»¬ç®¡çš„ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡æ»¤å™¨ä¸­ä¹Ÿç”¨åˆ°äº† <code>SessionRegistryImpl</code>ï¼Œè€Œ <code>SessionRegistryImpl</code> ç°åœ¨æ˜¯ç”±æˆ‘ä»¬è‡ªå·±æ¥å®šä¹‰çš„ï¼Œæ‰€ä»¥ï¼Œè¯¥è¿‡æ»¤å™¨æˆ‘ä»¬ä¹Ÿè¦é‡æ–°é…ç½®ä¸€ä¸‹ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            ...    http.addFilterAt(<span class="hljs-keyword">new</span> ConcurrentSessionFilter(sessionRegistry(), event -&gt; &#123;        HttpServletResponse resp = event.getResponse();        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);        resp.setStatus(<span class="hljs-number">401</span>);        PrintWriter out = resp.getWriter();        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.error(<span class="hljs-string">&quot;æ‚¨å·²åœ¨å¦ä¸€å°è®¾å¤‡ç™»å½•ï¼Œæœ¬æ¬¡ç™»å½•å·²ä¸‹çº¿!&quot;</span>)));        out.flush();        out.close();    &#125;), ConcurrentSessionFilter.class);&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºä¸€ä¸ª <code>ConcurrentSessionFilter</code> çš„å®ä¾‹ï¼Œä»£æ›¿ç³»ç»Ÿé»˜è®¤çš„å³å¯ã€‚åœ¨åˆ›å»ºæ–°çš„ <code>ConcurrentSessionFilter</code> å®ä¾‹æ—¶ï¼Œéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>sessionRegistry</code> å°±æ˜¯æˆ‘ä»¬å‰é¢æä¾›çš„ <code>SessionRegistryImpl </code>å®ä¾‹ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå¤„ç† session è¿‡æœŸåçš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”¨æˆ·è¢«å¦å¤–ä¸€ä¸ªç™»å½•è¸¢ä¸‹çº¿ä¹‹åï¼Œä½ è¦ç»™ä»€ä¹ˆæ ·çš„ä¸‹çº¿æç¤ºï¼Œå°±åœ¨è¿™é‡Œæ¥å®Œæˆã€‚</li></ol><p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å¤„ç†å®Œç™»å½•æ•°æ®ä¹‹åï¼Œæ‰‹åŠ¨å‘ <code>SessionRegistryImpl</code> ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SessionRegistry sessionRegistry;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;        <span class="hljs-comment">//çœç•¥</span>            Hr principal = <span class="hljs-keyword">new</span> Hr();            principal.setUsername(username);            sessionRegistry.registerNewSession(request.getSession(<span class="hljs-keyword">true</span>).getId(), principal);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);        &#125;         ...        ...    &#125;&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨ <code>sessionRegistry.registerNewSession</code> æ–¹æ³•ï¼Œå‘ <code>SessionRegistryImpl</code> ä¸­æ·»åŠ ä¸€æ¡ session è®°å½•ã€‚</p><p>æ­¤åˆ»ï¼Œæˆ‘ä»¬åœ¨åŸºäºä¸Šç¯‡æ–‡ç« â€œæµ…è°ˆSpring Securityå®ç°RBACæ¨¡å‹â€ä¸­çš„é…ç½®ç±»åˆå˜å¾—æœ‰æ‰€ä¸°å¯Œèµ·æ¥ï¼Œè¿™é‡Œé™„ä¸Šè¿‡æ»¤å™¨å’Œé…ç½®ç±»çš„å…¨éƒ¨ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SessionRegistry sessionRegistry;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;        <span class="hljs-keyword">if</span> (!request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(                    <span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());        &#125;        String verify_code = (String) request.getSession().getAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>);        <span class="hljs-keyword">if</span> (request.getContentType().contains(MediaType.APPLICATION_JSON_VALUE) || request.getContentType().contains(MediaType.APPLICATION_JSON_UTF8_VALUE)) &#123;            Map&lt;String, String&gt; loginData = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();            <span class="hljs-keyword">try</span> &#123;                loginData = <span class="hljs-keyword">new</span> ObjectMapper().readValue(request.getInputStream(), Map.class);            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            &#125;<span class="hljs-keyword">finally</span> &#123;                String code = loginData.get(<span class="hljs-string">&quot;code&quot;</span>);                checkCode(response, code, verify_code);            &#125;            String username = loginData.get(getUsernameParameter());            String password = loginData.get(getPasswordParameter());            <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;                username = <span class="hljs-string">&quot;&quot;</span>;            &#125;            <span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;                password = <span class="hljs-string">&quot;&quot;</span>;            &#125;            username = username.trim();            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(                    username, password);            setDetails(request, authRequest);            Hr principal = <span class="hljs-keyword">new</span> Hr();            principal.setUsername(username);            sessionRegistry.registerNewSession(request.getSession(<span class="hljs-keyword">true</span>).getId(), principal);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);        &#125; <span class="hljs-keyword">else</span> &#123;            checkCode(response, request.getParameter(<span class="hljs-string">&quot;code&quot;</span>), verify_code);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.attemptAuthentication(request, response);        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkCode</span><span class="hljs-params">(HttpServletResponse resp, String code, String verify_code)</span> </span>&#123;        <span class="hljs-keyword">if</span> (code == <span class="hljs-keyword">null</span> || verify_code == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(code) || !verify_code.toLowerCase().equals(code.toLowerCase())) &#123;            <span class="hljs-comment">//éªŒè¯ç ä¸æ­£ç¡®</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;éªŒè¯ç ä¸æ­£ç¡®&quot;</span>);        &#125;    &#125;&#125;</code></pre></div><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@Autowired</span>    CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;    <span class="hljs-meta">@Autowired</span>    CustomUrlDecisionManager customUrlDecisionManager;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(hrService);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>        web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();        loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    Hr hr = (Hr) authentication.getPrincipal();                    hr.setPassword(<span class="hljs-keyword">null</span>);                    RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!&quot;</span>, hr);                    String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);                    out.write(s);                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    RespBean respBean = RespBean.error(exception.getMessage());                    <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;å¯†ç è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);                    &#125;                    out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationManager(authenticationManagerBean());        loginFilter.setFilterProcessesUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>);        <span class="hljs-comment">//æ‰‹åŠ¨æ„å»º</span>        ConcurrentSessionControlAuthenticationStrategy sessionStrategy = <span class="hljs-keyword">new</span> ConcurrentSessionControlAuthenticationStrategy(sessionRegistry());        <span class="hljs-comment">//æœ€å¤šä¸€ä¸ªç”¨æˆ·ç™»å½•</span>        sessionStrategy.setMaximumSessions(<span class="hljs-number">1</span>);        loginFilter.setSessionAuthenticationStrategy(sessionStrategy);        <span class="hljs-keyword">return</span> loginFilter;    &#125;    <span class="hljs-comment">//ç”¨æ¥ç»´æŠ¤ä¼šè¯ä¿¡æ¯çš„</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SessionRegistryImpl <span class="hljs-title">sessionRegistry</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SessionRegistryImpl();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;                        object.setAccessDecisionManager(customUrlDecisionManager);                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);                        <span class="hljs-keyword">return</span> object;                    &#125;                &#125;)                .and()                .logout()                .logoutSuccessHandler((req, resp, authentication) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            PrintWriter out = resp.getWriter();                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸ!&quot;</span>)));                            out.flush();                            out.close();                        &#125;                )                .permitAll()                .and()                .csrf().disable().exceptionHandling()                <span class="hljs-comment">//æ²¡æœ‰è®¤è¯æ—¶ï¼Œåœ¨è¿™é‡Œå¤„ç†ç»“æœï¼Œä¸è¦é‡å®šå‘</span>                .authenticationEntryPoint((req, resp, authException) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            resp.setStatus(<span class="hljs-number">401</span>);                            PrintWriter out = resp.getWriter();                            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;è®¿é—®å¤±è´¥!&quot;</span>);                            <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;                                respBean.setMsg(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                            &#125;                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                            out.flush();                            out.close();                        &#125;                );        http.addFilterAt(<span class="hljs-keyword">new</span> ConcurrentSessionFilter(sessionRegistry(), event -&gt; &#123;            HttpServletResponse resp = event.getResponse();            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);            resp.setStatus(<span class="hljs-number">401</span>);            PrintWriter out = resp.getWriter();            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.error(<span class="hljs-string">&quot;æ‚¨å·²åœ¨å¦ä¸€å°è®¾å¤‡ç™»å½•ï¼Œæœ¬æ¬¡ç™»å½•å·²ä¸‹çº¿!&quot;</span>)));            out.flush();            out.close();        &#125;), ConcurrentSessionFilter.class);        http.addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class);    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…è°ˆSpring Securityå®ç°RBACæ¨¡å‹</title>
    <link href="/2021/08/09/%E6%B5%85%E8%B0%88Spring%20Security%E5%AE%9E%E7%8E%B0RBAC%E6%A8%A1%E5%9E%8B/"/>
    <url>/2021/08/09/%E6%B5%85%E8%B0%88Spring%20Security%E5%AE%9E%E7%8E%B0RBAC%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="æµ…è°ˆSpring-Securityå®ç°RBACæ¨¡å‹"><a href="#æµ…è°ˆSpring-Securityå®ç°RBACæ¨¡å‹" class="headerlink" title="æµ…è°ˆSpring Securityå®ç°RBACæ¨¡å‹"></a>æµ…è°ˆSpring Securityå®ç°RBACæ¨¡å‹</h1><blockquote><p>æœ¬æ–‡å°†ç»“åˆæˆ‘æ‰€åšçš„é¡¹ç›®æ¥æ¢è®¨ä¸€ä¸‹åˆ©ç”¨Spring Securityå®ç°RBACæ¨¡å‹çš„ç®€è¦æ­¥éª¤ä»¥åŠåˆ©ç”¨Spring Securityåšé¡¹ç›®æ—¶å€™å‘ç°ä¸æ”¹è¿›</p></blockquote><h2 id="ğŸ¤”ï¸ä»€ä¹ˆæ˜¯RBAC"><a href="#ğŸ¤”ï¸ä»€ä¹ˆæ˜¯RBAC" class="headerlink" title="ğŸ¤”ï¸ä»€ä¹ˆæ˜¯RBAC"></a>ğŸ¤”ï¸ä»€ä¹ˆæ˜¯RBAC</h2><p><strong>RBACæƒé™æ¨¡å‹ï¼ˆRole-Based Access Controlï¼‰</strong>å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚æ¨¡å‹ä¸­æœ‰å‡ ä¸ªå…³é”®çš„æœ¯è¯­ï¼š</p><ul><li>ç”¨æˆ·ï¼šç³»ç»Ÿæ¥å£åŠåŠŸèƒ½è®¿é—®çš„æ“ä½œè€…</li><li>æƒé™ï¼šèƒ½å¤Ÿè®¿é—®æŸæ¥å£æˆ–è€…åšæŸæ“ä½œçš„æˆæƒèµ„æ ¼</li><li>è§’è‰²ï¼šå…·æœ‰ä¸€ç±»ç›¸åŒæ“ä½œæƒé™çš„ç”¨æˆ·çš„æ€»ç§°</li></ul><p><strong>RBACæƒé™æ¨¡å‹æ ¸å¿ƒæˆæƒé€»è¾‘å¦‚ä¸‹ï¼š</strong></p><ul><li>æŸç”¨æˆ·æ˜¯ä»€ä¹ˆè§’è‰²ï¼Ÿ</li><li>æŸè§’è‰²å…·æœ‰ä»€ä¹ˆæƒé™ï¼Ÿ</li><li>é€šè¿‡è§’è‰²çš„æƒé™æ¨å¯¼ç”¨æˆ·çš„æƒé™</li></ul><p>å¯¹äºä¸€ä¸ªç”¨æˆ·æ¥è¯´ï¼Œå¦‚æœç›´æ¥å°†ç”¨æˆ·ä¸æƒé™å…³è”ï¼Œä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>ç°åœ¨ç”¨æˆ·æ˜¯Luciferã€Melroseï¼Œä»¥åéšç€äººå‘˜å¢åŠ ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·éƒ½éœ€è¦é‡æ–°æˆæƒ</li><li>æˆ–è€…Luciferã€Melroseç¦»èŒï¼Œéœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªç”¨æˆ·è¿›è¡Œå¤šç§æƒé™çš„å›æ”¶</li></ul><p><strong>å¦‚æœç»™æ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€ä¸ªè§’è‰²å‘¢ï¼Ÿ</strong></p><ul><li>ä¸€ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªè§’è‰²</li><li>ä¸€ä¸ªè§’è‰²æœ‰å¤šä¸ªæ“ä½œï¼ˆèœå•ï¼‰æƒé™</li><li>ä¸€ä¸ªæ“ä½œæƒé™å¯ä»¥èµ‹äºˆå¤šä¸ªè§’è‰²</li></ul><p>ä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ç³»ç»Ÿä¸­ï¼Œ<strong>ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªè§’è‰²è¿œè¿œæ»¡è¶³ä¸äº†éœ€æ±‚</strong>ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªç”¨æˆ·æ—¢æ‹…ä»»é”€å”®è§’è‰²ã€åˆæš‚æ—¶æ‹…ä»»å‰¯æ€»è§’è‰²ã€‚è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿä¸ºäº†å¢åŠ ç³»ç»Ÿè®¾è®¡çš„é€‚ç”¨æ€§ï¼Œæˆ‘ä»¬é€šå¸¸è®¾è®¡ï¼š</p><ul><li>ä¸€ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²</li><li>ä¸€ä¸ªè§’è‰²åŒ…å«å¤šä¸ªç”¨æˆ·</li><li>ä¸€ä¸ªè§’è‰²æœ‰å¤šç§æƒé™</li><li>ä¸€ä¸ªæƒé™å¯ä»¥èµ‹äºˆå¤šä¸ªè§’è‰²</li></ul><p>æ‰€ä»¥ï¼Œæ¯ä¸ªè§’è‰²çš„æƒé™å¯ä»¥å¯¹åº”ä¸ºè®¿é—®æŸä¸ªURLçš„æƒåˆ©ï¼Œå³æ‰€æœ‰ç³»ç»Ÿéƒ½æ˜¯ç”±ä¸€ä¸ªä¸ªçš„é¡µé¢ç»„æˆï¼Œé¡µé¢å†ç»„æˆæ¨¡å—ï¼Œç”¨æˆ·æ˜¯å¦èƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢çš„èœå•ã€æ˜¯å¦èƒ½è¿›å…¥è¿™ä¸ªé¡µé¢å°±ç§°ä¸ºé¡µé¢è®¿é—®æƒé™ã€‚</p><h2 id="âœï¸æƒé™è¡¨çš„è®¾è®¡"><a href="#âœï¸æƒé™è¡¨çš„è®¾è®¡" class="headerlink" title="âœï¸æƒé™è¡¨çš„è®¾è®¡"></a>âœï¸æƒé™è¡¨çš„è®¾è®¡</h2><p>åœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œå¯ä»¥å¼•å…¥RBACæ¨¡å‹çš„æ€æƒ³</p><blockquote><p>ä¸‹é¢æ˜¯æˆ‘åšçš„ä¸€ä¸ªé¡¹ç›®ä¸­æ‰€è®¾è®¡çš„è¡¨ï¼Œé¡¹ç›®é“¾æ¥ï¼š<a href="https://github.com/Lucifer2u/xm-luciferpro">https://github.com/Lucifer2u/xm-luciferpro</a></p></blockquote><p><strong>æƒé™æ•°æ®åº“</strong>ä¸»è¦åŒ…å«äº†äº”å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯<strong>èµ„æºè¡¨ã€è§’è‰²è¡¨ã€ç”¨æˆ·è¡¨ã€èµ„æºè§’è‰²è¡¨ã€ç”¨æˆ·è§’è‰²è¡¨</strong>ï¼Œæ•°æ®åº“å…³ç³»æ¨¡å‹å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p274.png" alt="p274"></p><ul><li>hrè¡¨æ˜¯<strong>ç”¨æˆ·è¡¨</strong>ï¼Œå­˜æ”¾äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯</li><li>roleæ˜¯<strong>è§’è‰²è¡¨</strong>ï¼Œnameå­—æ®µè¡¨ç¤ºè§’è‰²çš„è‹±æ–‡åç§°ï¼ŒæŒ‰ç…§SpringSecurityçš„è§„èŒƒï¼Œå°†ä»¥<code>ROLE_</code>å¼€å§‹ï¼ŒnameZhå­—æ®µè¡¨ç¤ºè§’è‰²çš„ä¸­æ–‡åç§°</li><li>menuè¡¨æ˜¯ä¸€ä¸ªèµ„æºè¡¨ï¼Œè¯¥è¡¨æ¶‰åŠåˆ°çš„å­—æ®µæœ‰ç‚¹å¤šï¼Œç”±äºæˆ‘çš„å‰ç«¯é‡‡ç”¨äº†Vueæ¥åšï¼Œå› æ­¤å½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®ç”¨æˆ·çš„è§’è‰²åŠ¨æ€åŠ è½½éœ€è¦çš„æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—çš„ä¿¡æ¯å°†ä¿å­˜åœ¨menuè¡¨ä¸­ï¼Œmenuè¡¨ä¸­çš„<strong>pathã€componentã€iconClsã€keepAliveã€requireAuthç­‰å­—æ®µéƒ½æ˜¯Vue-Routerä¸­éœ€è¦çš„å­—æ®µ</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>menuä¸­çš„æ•°æ®åˆ°æ—¶å€™ä¼šä»¥jsonçš„å½¢å¼è¿”å›ç»™å‰ç«¯ï¼Œå†ç”±vueåŠ¨æ€æ›´æ–°routerï¼Œmenuä¸­è¿˜æœ‰ä¸€ä¸ªå­—æ®µurlï¼Œè¡¨ç¤ºä¸€ä¸ªurl patternï¼Œå³è·¯å¾„åŒ¹é…è§„åˆ™</strong>ï¼Œå‡è®¾æœ‰ä¸€ä¸ªè·¯å¾„åŒ¹é…è§„åˆ™ä¸º<code>/admin/**</code>,é‚£ä¹ˆå½“ç”¨æˆ·åœ¨å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª<code>/admin/user</code>çš„è¯·æ±‚ï¼Œå°†è¢«<code>/admin/**</code>æ‹¦æˆªåˆ°ï¼Œç³»ç»Ÿå†å»æŸ¥çœ‹è¿™ä¸ªè§„åˆ™å¯¹åº”çš„è§’è‰²æ˜¯å“ªäº›ï¼Œç„¶åå†å»æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦å…·å¤‡ç›¸åº”çš„è§’è‰²ï¼Œè¿›è€Œåˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦åˆæ³•</li></ul><p><strong>è¿™æ ·æ¯ä¸ªäººéƒ½æœ‰ç›¸åº”çš„è§’è‰²ï¼Œç„¶åéƒ½éœ€è¦æ ¹æ®å®é™…çš„è§’è‰²æƒé™å»è®¿é—®ä¸åŒçš„èœå•</strong></p><h2 id="ğŸ”’åŠ¨æ€å¤„ç†è§’è‰²å’Œèµ„æºçš„å…³ç³»"><a href="#ğŸ”’åŠ¨æ€å¤„ç†è§’è‰²å’Œèµ„æºçš„å…³ç³»" class="headerlink" title="ğŸ”’åŠ¨æ€å¤„ç†è§’è‰²å’Œèµ„æºçš„å…³ç³»"></a>ğŸ”’åŠ¨æ€å¤„ç†è§’è‰²å’Œèµ„æºçš„å…³ç³»</h2><p>è¦åˆ†æä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å›é¡¾Spring Securityçš„ç™»å½•æµç¨‹å¯¹æ•´ä½“æµç¨‹è¿›è¡Œäº†è§£æ‰èƒ½æ›´å¥½çš„æŠŠæ¡æ­¤èŠ‚çš„å†…å®¹</p><h3 id="Spring-Securityçš„ç™»å½•æµç¨‹"><a href="#Spring-Securityçš„ç™»å½•æµç¨‹" class="headerlink" title="Spring Securityçš„ç™»å½•æµç¨‹"></a>Spring Securityçš„ç™»å½•æµç¨‹</h3><p>Spring Securityçš„ç™»å½•éªŒè¯æµç¨‹æ ¸å¿ƒå°±æ˜¯è¿‡æ»¤å™¨é“¾ã€‚</p><p><img src="https://img.kancloud.cn/73/50/73506bb0f3f3834c410ba17353a8168e_1409x389.png" alt="img"></p><ul><li>è´¯ç©¿äºæ•´ä¸ªè¿‡æ»¤å™¨é“¾å§‹ç»ˆæœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡<code>SecurityContext</code>å’Œä¸€ä¸ª<code>Authentication</code>å¯¹è±¡ï¼ˆç™»å½•è®¤è¯çš„ä¸»ä½“ï¼‰</li><li>ä¸€æ—¦æŸä¸€ä¸ªè¯¥ä¸»ä½“é€šè¿‡å…¶ä¸­æŸä¸€ä¸ªè¿‡æ»¤å™¨çš„è®¤è¯ï¼Œ<code>Authentication</code>å¯¹è±¡ä¿¡æ¯è¢«å¡«å……ï¼Œæ¯”å¦‚ï¼š<code>isAuthenticated=true</code>è¡¨ç¤ºè¯¥ä¸»ä½“é€šè¿‡éªŒè¯ã€‚</li><li>å¦‚æœè¯¥ä¸»ä½“é€šè¿‡äº†æ‰€æœ‰çš„è¿‡æ»¤å™¨ï¼Œä»ç„¶æ²¡æœ‰è¢«è®¤è¯ï¼Œåœ¨æ•´ä¸ªè¿‡æ»¤å™¨é“¾çš„æœ€åæ–¹æœ‰ä¸€ä¸ª<code>FilterSecurityInterceptor</code>è¿‡æ»¤å™¨ï¼ˆè™½ç„¶å«Interceptorï¼Œä½†å®ƒæ˜¯åå‰¯å…¶å®çš„è¿‡æ»¤å™¨ï¼Œä¸æ˜¯æ‹¦æˆªå™¨ï¼‰ã€‚åˆ¤æ–­<code>Authentication</code>å¯¹è±¡çš„è®¤è¯çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡è®¤è¯åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œé€šè¿‡è®¤è¯åˆ™è®¿é—®åç«¯APIã€‚</li><li>ä¹‹åè¿›å…¥å“åº”é˜¶æ®µï¼Œ<code>FilterSecurityInterceptor</code>æŠ›å‡ºçš„å¼‚å¸¸è¢«<code>ExceptionTranslationFilter</code>å¯¹å¼‚å¸¸è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚æ¯”å¦‚ï¼šç”¨æˆ·åå¯†ç ç™»å½•å¼‚å¸¸ï¼Œä¼šè¢«å¼•å¯¼åˆ°ç™»å½•é¡µé‡æ–°ç™»é™†ã€‚</li><li>å¦‚æœæ˜¯ç™»é™†æˆåŠŸä¸”æ²¡æœ‰ä»»ä½•å¼‚å¸¸ï¼Œåœ¨è¯·æ±‚å“åº”ä¸­æœ€åä¸€ä¸ªè¿‡æ»¤å™¨<code>SecurityContextPersistenceFilter</code>ä¸­å°†<code>SecurityContext</code>æ”¾å…¥sessionã€‚ä¸‹æ¬¡å†è¿›è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥ä»<code>SecurityContextPersistenceFilter</code>çš„sessionä¸­å–å‡ºè®¤è¯ä¿¡æ¯ã€‚ä»è€Œé¿å…å¤šæ¬¡é‡å¤è®¤è¯ã€‚ï¼ˆå¦‚æœæƒ³ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥ä»è¿™é‡Œæ‹¿ï¼‰</li></ul><p>SpringSecurityæä¾›äº†å¤šç§ç™»å½•è®¤è¯çš„æ–¹å¼ï¼Œç”±å¤šç§Filterè¿‡æ»¤å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>BasicAuthenticationFilter</code>å®ç°çš„æ˜¯HttpBasicæ¨¡å¼çš„ç™»å½•è®¤è¯</li><li><code>UsernamePasswordAuthenticationFilter</code>å®ç°ç”¨æˆ·åå¯†ç çš„ç™»å½•è®¤è¯</li><li><code>RememberMeAuthenticationFilter</code>å®ç°ç™»å½•è®¤è¯çš„â€œè®°ä½æˆ‘â€çš„åŠŸèƒ½</li><li><code>SocialAuthenticationFilter</code>å®ç°ç¤¾äº¤åª’ä½“æ–¹å¼ç™»å½•è®¤è¯çš„å¤„ç†ï¼Œå¦‚ï¼šQQã€å¾®ä¿¡</li><li><code>Oauth2AuthenticationProcessingFilter</code>å’Œ<code>Oauth2ClientAuthenticationProcessingFilter</code>å®ç°Oauth2çš„é‰´æƒæ–¹å¼</li></ul><p>æ ¹æ®æˆ‘ä»¬ä¸åŒçš„éœ€æ±‚å®ç°åŠé…ç½®ï¼Œä¸åŒçš„Filterä¼šè¢«åŠ è½½åˆ°åº”ç”¨ä¸­ã€‚</p><h3 id="è¿‡æ»¤å™¨ç™»å½•éªŒè¯ç»†èŠ‚"><a href="#è¿‡æ»¤å™¨ç™»å½•éªŒè¯ç»†èŠ‚" class="headerlink" title="è¿‡æ»¤å™¨ç™»å½•éªŒè¯ç»†èŠ‚"></a>è¿‡æ»¤å™¨ç™»å½•éªŒè¯ç»†èŠ‚</h3><p><img src="https://img.kancloud.cn/ce/5e/ce5e1f7877e0155577d5511b95ea2100_660x441.png" alt="img"></p><h4 id="æ„å»ºç™»å½•è®¤è¯ä¸»ä½“"><a href="#æ„å»ºç™»å½•è®¤è¯ä¸»ä½“" class="headerlink" title="æ„å»ºç™»å½•è®¤è¯ä¸»ä½“"></a><strong>æ„å»ºç™»å½•è®¤è¯ä¸»ä½“</strong></h4><p>å¦‚å›¾æ‰€ç¤ºï¼Œå½“ç”¨æˆ·ç™»é™†çš„æ—¶å€™é¦–å…ˆè¢«æŸä¸€ç§è®¤è¯æ–¹å¼çš„è¿‡æ»¤å™¨æ‹¦æˆªï¼ˆä»¥ç”¨æˆ·åå¯†ç ç™»å½•ä¸ºä¾‹ï¼‰ã€‚å¦‚ï¼š<code>UsernamePasswordAuthenticationFilter</code>ä¼šä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç åˆ›å»ºä¸€ä¸ªç™»å½•è®¤è¯å‡­è¯ï¼š<code>UsernamePasswordAuthenticationToken</code>ï¼Œè¿›è€Œè·å–ä¸€ä¸ª<code>Authentication</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨èº«ä»½éªŒè¯çš„ä¸»ä½“ï¼Œè´¯ç©¿äºç”¨æˆ·è®¤è¯æµç¨‹å§‹ç»ˆã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808215018034.png" alt="image-20210808215018034"></p><h4 id="å¤šç§è®¤è¯æ–¹å¼çš„ç®¡ç†-ProviderManager"><a href="#å¤šç§è®¤è¯æ–¹å¼çš„ç®¡ç†-ProviderManager" class="headerlink" title="å¤šç§è®¤è¯æ–¹å¼çš„ç®¡ç† ProviderManager"></a><strong>å¤šç§è®¤è¯æ–¹å¼çš„ç®¡ç† ProviderManager</strong></h4><p>éšåä½¿ç”¨<code>AuthenticationManager</code> æ¥å£å¯¹ç™»å½•è®¤è¯ä¸»ä½“è¿›è¡Œauthenticateè®¤è¯ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AuthenticationManager</span> </span>&#123;    <span class="hljs-function">Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication authentication)</span> <span class="hljs-keyword">throws</span> AuthenticationException</span>;&#125;</code></pre></div><p><code>ProviderManager</code>ç»§æ‰¿äº<code>AuthenticationManager</code>æ˜¯ç™»å½•éªŒè¯çš„æ ¸å¿ƒç±»ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuthenticationManager</span>, <span class="hljs-title">MessageSourceAware</span>, <span class="hljs-title">InitializingBean</span> </span>&#123;    â€¦â€¦    <span class="hljs-keyword">private</span> List&lt;AuthenticationProvider&gt; providers;    â€¦â€¦</code></pre></div><p><code>ProviderManager</code>ä¿ç®¡äº†å¤šä¸ª<code>AuthenticationProvider</code>ï¼Œæ¯ä¸€ç§ç™»å½•è®¤è¯æ–¹å¼éƒ½å¯ä»¥å°è¯•å¯¹ç™»å½•è®¤è¯ä¸»ä½“è¿›è¡Œè®¤è¯ã€‚åªè¦æœ‰ä¸€ç§æ–¹å¼è¢«è®¤è¯æˆåŠŸï¼Œ<code>Authentication</code>å¯¹è±¡å°±æˆä¸ºè¢«è®¤å¯çš„ä¸»ä½“ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AuthenticationProvider</span> </span>&#123;    <span class="hljs-function">Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication var1)</span> <span class="hljs-keyword">throws</span> AuthenticationException</span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; var1)</span></span>;&#125;</code></pre></div><blockquote><p><code>RememberMeAuthenticationProvider</code>å®šä¹‰äº†â€œè®°ä½æˆ‘â€åŠŸèƒ½çš„ç™»å½•éªŒè¯é€»è¾‘</p><p><code>DaoAuthenticationProvider</code>åŠ è½½æ•°æ®åº“ç”¨æˆ·ä¿¡æ¯ï¼Œè¿›è¡Œç”¨æˆ·å¯†ç çš„ç™»å½•éªŒè¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808220226118.png" alt="image-20210808220226118"></p></blockquote><p>è€Œ<code>DaoAuthenticationProvider</code>å°±æ˜¯æˆ‘ä»¬å®ç°ç™»å½•çš„å…³é”®ï¼Œä¸‹é¢è¯¦ç»†åˆ†æ</p><h4 id="æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯-DaoAuthenticationProvider"><a href="#æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯-DaoAuthenticationProvider" class="headerlink" title="æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯ DaoAuthenticationProvider"></a><strong>æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯ DaoAuthenticationProvider</strong></h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DaoAuthenticationProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractUserDetailsAuthenticationProvider</span> </span></code></pre></div><p>ä»æºç ä¸­å‘ç°ï¼Œéœ€è¦ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ï¼Œå³æˆ‘ä»¬éœ€è¦åŠ è½½ç”¨æˆ·ä¿¡æ¯è¿›è¡Œç™»å½•éªŒè¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®ç°<code>UserDetailsService</code>æ¥å£ï¼Œé‡å†™<code>loadUserByUsername</code>æ–¹æ³•ï¼Œå‚æ•°æ˜¯ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åã€‚è¿”å›å€¼æ˜¯<code>UserDetails</code></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808220514527.png" alt="image-20210808220514527"></p><h4 id="SecurityContext"><a href="#SecurityContext" class="headerlink" title="SecurityContext"></a><strong>SecurityContext</strong></h4><p>å®Œæˆç™»å½•è®¤è¯ä¹‹åï¼Œå°†è®¤è¯å®Œæˆçš„<code>Authentication</code>å¯¹è±¡(authenticate: true, æœ‰æˆæƒåˆ—è¡¨authority list, å’Œusernameä¿¡æ¯)æ”¾å…¥<code>SecurityContext</code>ä¸Šä¸‹æ–‡é‡Œé¢ã€‚åç»­çš„è¯·æ±‚å°±ç›´æ¥ä»<code>SecurityContextFilter</code>ä¸­è·å¾—è®¤è¯ä¸»ä½“ï¼Œä»è€Œè®¿é—®èµ„æºã€‚</p><h3 id="ç»“åˆæºç è®²è§£ç™»å½•éªŒè¯æµç¨‹"><a href="#ç»“åˆæºç è®²è§£ç™»å½•éªŒè¯æµç¨‹" class="headerlink" title="ç»“åˆæºç è®²è§£ç™»å½•éªŒè¯æµç¨‹"></a>ç»“åˆæºç è®²è§£ç™»å½•éªŒè¯æµç¨‹</h3><p>æˆ‘ä»¬å°±ä»¥ç”¨æˆ·åã€å¯†ç ç™»å½•æ–¹å¼ä¸ºä¾‹è®²è§£ä¸€ä¸‹Spring Securityçš„ç™»å½•è®¤è¯æµç¨‹ã€‚</p><p><img src="https://img.kancloud.cn/96/5b/965b390cafd239b8f33c44496a99dd64_978x674.png" alt="img"></p><h4 id="UsernamePasswordAuthenticationFilter"><a href="#UsernamePasswordAuthenticationFilter" class="headerlink" title="UsernamePasswordAuthenticationFilter"></a><strong>UsernamePasswordAuthenticationFilter</strong></h4><p>è¯¥è¿‡æ»¤å™¨å°è£…ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ï¼Œå®šä¹‰ç™»å½•è¡¨å•æ•°æ®æ¥æ”¶ç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚ï¼š</p><ul><li>é»˜è®¤çš„è¡¨å•ç”¨æˆ·åå¯†ç inputæ¡†nameæ˜¯usernameã€password</li><li>é»˜è®¤çš„å¤„ç†ç™»å½•è¯·æ±‚è·¯å¾„æ˜¯/loginã€ä½¿ç”¨POSTæ–¹æ³•</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808222037202.png" alt="image-20210808222037202"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808222219124.png" alt="image-20210808222219124"></p><h4 id="AbstractAuthenticationProcessingFilterçš„doFilteræ–¹æ³•çš„éªŒè¯è¿‡ç¨‹"><a href="#AbstractAuthenticationProcessingFilterçš„doFilteræ–¹æ³•çš„éªŒè¯è¿‡ç¨‹" class="headerlink" title="AbstractAuthenticationProcessingFilterçš„doFilteræ–¹æ³•çš„éªŒè¯è¿‡ç¨‹"></a><strong>AbstractAuthenticationProcessingFilterçš„doFilteræ–¹æ³•çš„éªŒè¯è¿‡ç¨‹</strong></h4><p><code>UsernamePasswordAuthenticationFilter</code>ç»§æ‰¿è‡ªæŠ½è±¡ç±»<code>AbstractAuthenticationProcessingFilter</code>ï¼Œè¯¥æŠ½è±¡ç±»å®šä¹‰äº†éªŒè¯æˆåŠŸä¸éªŒè¯å¤±è´¥çš„å¤„ç†æ–¹æ³•ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractAuthenticationProcessingFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span></span><span class="hljs-class">      <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationEventPublisherAware</span>, <span class="hljs-title">MessageSourceAware</span> </span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808222657609.png" alt="image-20210808222657609"></p><h4 id="éªŒè¯æˆåŠŸä¹‹åçš„Handlerå’ŒéªŒè¯å¤±è´¥ä¹‹åçš„handler"><a href="#éªŒè¯æˆåŠŸä¹‹åçš„Handlerå’ŒéªŒè¯å¤±è´¥ä¹‹åçš„handler" class="headerlink" title="éªŒè¯æˆåŠŸä¹‹åçš„Handlerå’ŒéªŒè¯å¤±è´¥ä¹‹åçš„handler"></a><strong>éªŒè¯æˆåŠŸä¹‹åçš„Handlerå’ŒéªŒè¯å¤±è´¥ä¹‹åçš„handler</strong></h4><p><code>AbstractAuthenticationProcessingFilter</code>ä¸­å®šä¹‰äº†éªŒè¯æˆåŠŸä¸éªŒè¯å¤±è´¥çš„å¤„ç†Handlerã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> AuthenticationSuccessHandler successHandler = <span class="hljs-keyword">new</span> SavedRequestAwareAuthenticationSuccessHandler();<span class="hljs-keyword">private</span> AuthenticationFailureHandler failureHandler = <span class="hljs-keyword">new</span> SimpleUrlAuthenticationFailureHandler();</code></pre></div><p>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰éªŒè¯æˆåŠŸæˆ–å¤±è´¥çš„å¤„ç†æ–¹æ³•æ—¶ï¼Œè¦å»å®ç°<code>AuthenticationSuccessHandler</code>æˆ–<code>AuthenticationfailureHandler</code>æ¥å£</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210808222936948.png" alt="image-20210808222936948"></p><h3 id="ğŸ‘å›åˆ°æ­£é¢˜"><a href="#ğŸ‘å›åˆ°æ­£é¢˜" class="headerlink" title="ğŸ‘å›åˆ°æ­£é¢˜"></a>ğŸ‘å›åˆ°æ­£é¢˜</h3><p>æˆ‘ä»¬çŸ¥é“å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·ã€è§’è‰²ã€æƒé™ä¿¡æ¯å†™æ­»åœ¨é…ç½®é‡Œé¢ã€‚æˆ‘ä»¬åº”è¯¥å®ç°<code>UserDetails</code>ä¸<code>UserDetailsService</code>æ¥å£ï¼Œä»è€Œä»æ•°æ®åº“æˆ–è€…å…¶ä»–çš„å­˜å‚¨ä¸ŠåŠ¨æ€çš„åŠ è½½è¿™äº›ä¿¡æ¯ã€‚</p><h4 id="UserDetailsä¸UserDetailsServiceæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#UserDetailsä¸UserDetailsServiceæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="UserDetailsä¸UserDetailsServiceæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a><strong>UserDetailsä¸UserDetailsServiceæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></h4><p><code>UserDetailsService</code>æ¥å£è¡¨è¾¾çš„æ˜¯å¦‚ä½•åŠ¨æ€åŠ è½½<code>UserDetails</code>æ•°æ®ã€‚</p><ul><li><code>UserDetailsService</code>æ¥å£æœ‰ä¸€ä¸ªæ–¹æ³•å«åš<code>loadUserByUsername</code>ï¼Œæˆ‘ä»¬å®ç°åŠ¨æ€åŠ è½½ç”¨æˆ·ã€è§’è‰²ã€æƒé™ä¿¡æ¯å°±æ˜¯é€šè¿‡å®ç°è¯¥æ–¹æ³•ã€‚å‡½æ•°è§åçŸ¥ä¹‰ï¼šé€šè¿‡ç”¨æˆ·ååŠ è½½ç”¨æˆ·ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯<code>UserDetails</code></li><li><code>UserDetails</code>å°±æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œå³ï¼šç”¨æˆ·åã€å¯†ç ã€è¯¥ç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>UserDetails</code>æ¥å£éƒ½æœ‰å“ªäº›æ–¹æ³•ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDetails</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">//è·å–ç”¨æˆ·çš„æƒé™é›†åˆ</span>    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();    <span class="hljs-comment">//è·å–å¯†ç </span>    <span class="hljs-function">String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//è·å–ç”¨æˆ·å</span>    <span class="hljs-function">String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//è´¦å·æ˜¯å¦æ²¡è¿‡æœŸ</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//è´¦å·æ˜¯å¦æ²¡è¢«é”å®š</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//å¯†ç æ˜¯å¦æ²¡è¿‡æœŸ</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//è´¦æˆ·æ˜¯å¦å¯ç”¨</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†ï¼Œåªè¦æˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯æä¾›ç»™Spring Securityï¼ŒSpring Securityå°±çŸ¥é“æ€ä¹ˆåšç™»å½•éªŒè¯äº†ï¼Œæ ¹æœ¬ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å†™Controllerå®ç°ç™»å½•éªŒè¯é€»è¾‘ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆæŠŠè¿™äº›ä¿¡æ¯æä¾›ç»™Spring Securityï¼Œç”¨çš„å°±æ˜¯ä¸‹é¢çš„æ¥å£æ–¹æ³•ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;   <span class="hljs-function">UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException</span>;&#125;</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†ï¼Œåªè¦æˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯æä¾›ç»™Spring Securityï¼ŒSpring Securityå°±çŸ¥é“æ€ä¹ˆåšç™»å½•éªŒè¯äº†ï¼Œæ ¹æœ¬ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å†™Controllerå®ç°ç™»å½•éªŒè¯é€»è¾‘ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆæŠŠè¿™äº›ä¿¡æ¯æä¾›ç»™Spring Securityï¼Œç”¨çš„å°±æ˜¯ä¸‹é¢çš„æ¥å£æ–¹æ³•ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;   <span class="hljs-function">UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException</span>;&#125;</code></pre></div><h4 id="å®ç°UserDetails-æ¥å£"><a href="#å®ç°UserDetails-æ¥å£" class="headerlink" title="å®ç°UserDetails æ¥å£"></a>å®ç°UserDetails æ¥å£</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;  String password;  <span class="hljs-comment">//å¯†ç </span>  String username;  <span class="hljs-comment">//ç”¨æˆ·å</span>  <span class="hljs-keyword">boolean</span> accountNonExpired;   <span class="hljs-comment">//æ˜¯å¦æ²¡è¿‡æœŸ</span>  <span class="hljs-keyword">boolean</span> accountNonLocked;   <span class="hljs-comment">//æ˜¯å¦æ²¡è¢«é”å®š</span>  <span class="hljs-keyword">boolean</span> credentialsNonExpired;  <span class="hljs-comment">//å¯†ç æ˜¯å¦æ²¡è¿‡æœŸ</span>  <span class="hljs-keyword">boolean</span> enabled;  <span class="hljs-comment">//è´¦å·æ˜¯å¦å¯ç”¨</span>  Collection&lt;? extends GrantedAuthority&gt; authorities;  <span class="hljs-comment">//ç”¨æˆ·çš„æƒé™é›†åˆ</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;    <span class="hljs-keyword">this</span>.password = password;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;    <span class="hljs-keyword">this</span>.username = username;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAccountNonExpired</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> accountNonExpired)</span> </span>&#123;    <span class="hljs-keyword">this</span>.accountNonExpired = accountNonExpired;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAccountNonLocked</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> accountNonLocked)</span> </span>&#123;    <span class="hljs-keyword">this</span>.accountNonLocked = accountNonLocked;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCredentialsNonExpired</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> credentialsNonExpired)</span> </span>&#123;    <span class="hljs-keyword">this</span>.credentialsNonExpired = credentialsNonExpired;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEnabled</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> enabled)</span> </span>&#123;    <span class="hljs-keyword">this</span>.enabled = enabled;  &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAuthorities</span><span class="hljs-params">(Collection&lt;? extends GrantedAuthority&gt; authorities)</span> </span>&#123;    <span class="hljs-keyword">this</span>.authorities = authorities;  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;    <span class="hljs-keyword">return</span> authorities;  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> password;  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> username;  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;   <span class="hljs-comment">//æš‚æ—¶æœªç”¨åˆ°ï¼Œç›´æ¥è¿”å›trueï¼Œè¡¨ç¤ºè´¦æˆ·æœªè¿‡æœŸ</span>  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;   <span class="hljs-comment">//æš‚æ—¶æœªç”¨åˆ°ï¼Œç›´æ¥è¿”å›trueï¼Œè¡¨ç¤ºè´¦æˆ·æœªè¢«é”å®š</span>  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;   <span class="hljs-comment">//æš‚æ—¶æœªç”¨åˆ°ï¼Œç›´æ¥è¿”å›trueï¼Œè¡¨ç¤ºè´¦æˆ·å¯†ç æœªè¿‡æœŸ</span>  &#125;  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> enabled;  &#125;&#125;</code></pre></div><p>æˆ‘ä»¬å°±æ˜¯å†™äº†ä¸€ä¸ªé€‚åº”äº<code>UserDetails</code>çš„Beanç±»ï¼Œæ‰€è°“çš„ <code>UserDetails</code>æ¥å£å®ç°å°±æ˜¯ä¸€äº›getæ–¹æ³•ã€‚</p><ul><li>getæ–¹æ³•ç”±Spring Securityè°ƒç”¨ï¼Œè·å–è®¤è¯åŠé‰´æƒçš„æ•°æ®</li><li>æˆ‘ä»¬é€šè¿‡setæ–¹æ³•æˆ–æ„é€ å‡½æ•°ä¸º Spring Security æä¾›<code>UserDetails</code>æ•°æ®ï¼ˆä»æ•°æ®åº“æŸ¥è¯¢ï¼‰ã€‚</li><li><strong>å½“enabledçš„å€¼ä¸ºfalseçš„æ—¶å€™ï¼ŒSpring Security ä¼šè‡ªåŠ¨çš„ç¦ç”¨è¯¥ç”¨æˆ·ï¼Œç¦æ­¢è¯¥ç”¨æˆ·è¿›è¡Œç³»ç»Ÿç™»å½•ã€‚</strong></li><li>é€šå¸¸æ•°æ®åº“è¡¨sys_userå­—æ®µè¦å’ŒHr å±æ€§ä¸€ä¸€å¯¹åº”ï¼Œæ¯”å¦‚usernameã€passwordã€enabledã€‚</li></ul><blockquote><p>ç›®å‰æ•°æ®åº“è¡¨é‡Œé¢æ²¡æœ‰å®šä¹‰accountNonExpiredã€accountNonLockedã€credentialsNonExpiredè¿™ä¸‰ä¸ªå­—æ®µï¼Œæˆ‘ä¸€èˆ¬ä¸å–œæ¬¢æè¿™ä¹ˆå¤šå­—æ®µæ§åˆ¶ç”¨æˆ·çš„ç™»å½•è®¤è¯è¡Œä¸ºï¼Œç¬”è€…è§‰å¾—ç®€å•ç‚¹å¥½ï¼Œä¸€ä¸ªenabledå­—æ®µå°±å¤Ÿäº†ã€‚æ‰€ä»¥è¿™ä¸‰ä¸ªæˆå‘˜å˜é‡å¯¹åº”çš„getæ–¹æ³•ï¼Œç›´æ¥è¿”å›trueå³å¯ã€‚</p></blockquote><p>å¦å¤–ï¼Œ<strong>UserDetailsä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å«åšgetAuthoritiesï¼Œè¯¥æ–¹æ³•ç”¨æ¥è·å–å½“å‰ç”¨æˆ·æ‰€å…·æœ‰çš„è§’è‰²</strong>ï¼Œæˆ‘çš„è§’è‰²ä¸­æœ‰ä¸€ä¸ªroleså±æ€§ï¼ˆå³roleè¡¨ï¼‰ç”¨æ¥æè¿°å½“å‰ç”¨æˆ·çš„è§’è‰²ï¼Œå› æ­¤æˆ‘çš„getAuthoritiesæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;    List&lt;GrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">for</span> (Role role : roles) &#123;        authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName()));    &#125;    <span class="hljs-keyword">return</span> authorities;&#125;</code></pre></div><p>å³ç›´æ¥ä»<code>roles</code>ä¸­è·å–å½“å‰ç”¨æˆ·æ‰€å…·æœ‰çš„è§’è‰²ï¼Œæ„é€ <code>SimpleGrantedAuthority</code>ç„¶åè¿”å›å³å¯</p><p><code>SimpleGrantedAuthority</code>ç®€å•æ¥è¯´å°±æ˜¯å­˜å‚¨æˆäºˆ<code>Authentication</code>å¯¹è±¡çš„æƒé™çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</p><h4 id="SimpleGrantedAuthority"><a href="#SimpleGrantedAuthority" class="headerlink" title="SimpleGrantedAuthority"></a><strong>SimpleGrantedAuthority</strong></h4><p>åœ¨Securityä¸­ï¼Œè§’è‰²å’Œæƒé™å…±ç”¨<code>GrantedAuthority</code>æ¥å£ï¼Œå”¯ä¸€çš„ä¸åŒè§’è‰²å°±æ˜¯å¤šäº†ä¸ªå‰ç¼€â€ROLE_â€ï¼Œè€Œä¸”å®ƒæ²¡æœ‰Shiroçš„é‚£ç§ä»å±å…³ç³»ï¼Œå³ä¸€ä¸ªè§’è‰²åŒ…å«å“ªäº›æƒé™ç­‰ç­‰ã€‚åœ¨Securityçœ‹æ¥è§’è‰²å’Œæƒé™æ—¶ä¸€æ ·çš„ï¼Œå®ƒè®¤è¯çš„æ—¶å€™ï¼ŒæŠŠæ‰€æœ‰æƒé™ï¼ˆè§’è‰²ã€æƒé™ï¼‰éƒ½å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯åˆ†å¼€éªŒè¯ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨Securityæä¾›çš„<code>UserDetailsService</code>é»˜è®¤å®ç°<code>JdbcDaoImpl</code>ä¸­ï¼Œè§’è‰²å’Œæƒé™éƒ½å­˜å‚¨åœ¨auhtoritiesè¡¨ä¸­ã€‚è€Œä¸æ˜¯åƒShiroé‚£æ ·ï¼Œè§’è‰²æœ‰ä¸ªrolesè¡¨ï¼Œæƒé™æœ‰ä¸ªpermissionsè¡¨ã€‚ä»¥åŠç›¸å…³çš„ç®¡ç†è¡¨ç­‰ç­‰ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleGrantedAuthority</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GrantedAuthority</span> </span>&#123;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String role;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleGrantedAuthority</span><span class="hljs-params">(String role)</span> </span>&#123;      Assert.hasText(role, <span class="hljs-string">&quot;A granted authority textual representation is required&quot;</span>);      <span class="hljs-keyword">this</span>.role = role;   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAuthority</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.role;   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>&#123;      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == obj) &#123;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;      &#125;      <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> SimpleGrantedAuthority) &#123;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.role.equals(((SimpleGrantedAuthority) obj).role);      &#125;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.role.hashCode();   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.role;   &#125;&#125;</code></pre></div><p>æ³¨æ„ï¼Œåœ¨æ„å»º<code>SimpleGrantedAuthority</code>å¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒæ²¡æœ‰æ·»åŠ ä»»ä½•å‰ç¼€ã€‚æ‰€ä»¥è¡¨ç¤ºâ€è§’è‰²â€çš„æƒé™ï¼Œåœ¨æ•°æ®åº“ä¸­å°±å¸¦æœ‰â€ROLE_â€å‰ç¼€äº†ã€‚æ‰€ä»¥<code>authorities</code>è¡¨ä¸­çš„è§†å›¾å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220537827.png" alt="image-20210809220537827"></p><p><strong>è§’è‰²å’Œæƒé™èƒ½å¦åˆ†å¼€å­˜å‚¨ï¼Ÿè§’è‰²èƒ½ä¸èƒ½ä¸å¸¦â€ROLE_â€å‰ç¼€</strong></p><p>å½“ç„¶å¯ä»¥åˆ†å¼€å­˜å‚¨ï¼Œä½ å¯ä»¥å®šä¹‰ä¸¤å¼ è¡¨ï¼Œä¸€å¼ å­˜è§’è‰²ï¼Œä¸€å¼ å­˜æƒé™ã€‚ä½†æ˜¯ä½ è‡ªå®šä¹‰<code>UserDetailsService</code>çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯æŠŠè¿™ä¸¤å¼ è¡¨çš„æ•°æ®éƒ½å–å‡ºæ¥ï¼Œæ”¾åˆ°<code>UserDails</code>çš„æƒé™é›†åˆä¸­ã€‚å½“ç„¶ä½ æ•°æ®åº“ä¸­å­˜å‚¨çš„è§’è‰²ä¹Ÿå¯ä»¥ä¸å¸¦â€ROLE_â€å‰ç¼€ï¼Œå°±åƒè¿™æ ·ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220551920.png" alt="image-20210809220551920"></p><p>ä½†æ˜¯å‰é¢è¯´åˆ°äº†ï¼ŒSecurityæ‰ä¸ç®¡ä½ æ˜¯è§’è‰²ï¼Œè¿˜æ˜¯æƒé™ã€‚å®ƒåªæ¯”å¯¹å­—ç¬¦ä¸²ã€‚</p><p>æ¯”å¦‚å®ƒæœ‰ä¸ªè¡¨è¾¾å¼hasRole(â€œADMINâ€)ã€‚é‚£å®ƒå®é™…ä¸ŠæŸ¥è¯¢çš„æ˜¯ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²â€ROLE_ADMINâ€ã€‚å¦‚æœä½ ä»è§’è‰²è¡¨ä¸­å–å‡ºç”¨æˆ·æ‰€æ‹¥æœ‰çš„è§’è‰²æ—¶ä¸åŠ ä¸Šâ€ROLE_â€å‰ç¼€ï¼Œé‚£éªŒè¯çš„æ—¶å€™å°±åŒ¹é…ä¸ä¸Šäº†ã€‚</p><p>æ‰€ä»¥è§’è‰²ä¿¡æ¯å­˜å‚¨çš„æ—¶å€™å¯ä»¥æ²¡æœ‰â€ROLE_â€å‰ç¼€ï¼Œä½†æ˜¯åŒ…è£…æˆ<code>GrantedAuthority</code>å¯¹è±¡çš„æ—¶å€™å¿…é¡»è¦æœ‰ã€‚</p><h4 id="è‡ªå®šä¹‰Service"><a href="#è‡ªå®šä¹‰Service" class="headerlink" title="è‡ªå®šä¹‰Service"></a>è‡ªå®šä¹‰Service</h4><p>åˆ›å»ºå¥½<code>Hr</code>ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»º<code>HrService</code>ï¼Œç”¨æ¥æ‰§è¡Œç™»å½•ç­‰æ“ä½œï¼Œ**<code>HrService</code>éœ€è¦å®ç°<code>UserDetailsService</code>æ¥å£ï¼Œå¦‚ä¸‹ï¼š**</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrMapper hrMapper;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;        Hr hr = hrMapper.loadUserByUsername(username);        <span class="hljs-keyword">if</span> (hr == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);        &#125;        hr.setRoles(hrMapper.getHrRolesById(hr.getId()));        <span class="hljs-keyword">return</span> hr;    &#125;</code></pre></div><p>è¿™é‡Œæœ€ä¸»è¦æ˜¯å®ç°äº†**<code>UserDetailsService</code>æ¥å£ä¸­çš„<code>loadUserByUsername</code>æ–¹æ³•**ï¼Œåœ¨æ‰§è¡Œç™»å½•çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å°†æ ¹æ®ç”¨æˆ·åå»æŸ¥æ‰¾ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡º<code>UsernameNotFoundException</code>å¼‚å¸¸ï¼Œå¦åˆ™ç›´æ¥å°†æŸ¥åˆ°çš„<code>Hr</code>è¿”å›ã€‚<code>HrMapper</code>ç”¨æ¥æ‰§è¡Œæ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œã€‚</p><h2 id="ğŸ”‘æ ¹æ®è¯·æ±‚åœ°å€è·å–è§’è‰²"><a href="#ğŸ”‘æ ¹æ®è¯·æ±‚åœ°å€è·å–è§’è‰²" class="headerlink" title="ğŸ”‘æ ¹æ®è¯·æ±‚åœ°å€è·å–è§’è‰²"></a>ğŸ”‘æ ¹æ®è¯·æ±‚åœ°å€è·å–è§’è‰²</h2><p>å…ˆå¼•å…¥ä¸€ä¸‹<code>SecurityMetadataSource</code>çš„æ¦‚å¿µï¼š</p><h3 id="SecurityMetadataSource"><a href="#SecurityMetadataSource" class="headerlink" title="SecurityMetadataSource"></a>SecurityMetadataSource</h3><p><code>SecurityMetadataSource</code>æ˜¯<code>Spring Security</code>çš„ä¸€ä¸ªæ¦‚å¿µæ¨¡å‹æ¥å£ã€‚ç”¨äºè¡¨ç¤ºå¯¹å—æƒé™ä¿æŠ¤çš„â€å®‰å…¨å¯¹è±¡â€çš„æƒé™è®¾ç½®ä¿¡æ¯ã€‚ä¸€ä¸ªè¯¥ç±»å¯¹è±¡å¯ä»¥è¢«ç†è§£æˆä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ˜ å°„è¡¨ä¸­çš„æ¯ä¸€é¡¹åŒ…å«å¦‚ä¸‹ä¿¡æ¯ :</p><ul><li>å®‰å…¨å¯¹è±¡</li><li>å®‰å…¨å¯¹è±¡æ‰€éœ€æƒé™ä¿¡æ¯</li></ul><p>å›´ç»•è¯¥æ˜ å°„è¡¨ï¼Œ<code>SecurityMetadataSource</code> å®šä¹‰äº†å¦‚ä¸‹æ–¹æ³• :</p><ul><li><code>Collection&lt;ConfigAttribute&gt; getAttributes(Object object) throws IllegalArgumentException;</code></li></ul><blockquote><p>è·å–æŸä¸ªå—ä¿æŠ¤çš„å®‰å…¨å¯¹è±¡<code>object</code>çš„æ‰€éœ€è¦çš„æƒé™ä¿¡æ¯,æ˜¯ä¸€ç»„<code>ConfigAttribute</code>å¯¹è±¡çš„é›†åˆï¼Œå¦‚æœè¯¥å®‰å…¨å¯¹è±¡<code>object</code>ä¸è¢«å½“å‰<code>SecurityMetadataSource</code>å¯¹è±¡æ”¯æŒ,åˆ™æŠ›å‡ºå¼‚å¸¸<code>IllegalArgumentException</code>ã€‚<br>è¯¥æ–¹æ³•é€šå¸¸é…åˆ<code>boolean supports(Class&lt;?&gt; clazz)</code>ä¸€èµ·ä½¿ç”¨ï¼Œå…ˆä½¿ç”¨<code>boolean supports(Class&lt;?&gt; clazz)</code>ç¡®ä¿å®‰å…¨å¯¹è±¡èƒ½è¢«å½“å‰<code>SecurityMetadataSource</code>æ”¯æŒï¼Œç„¶åå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p></blockquote><ul><li><code>Collection&lt;ConfigAttribute&gt; getAllConfigAttributes()</code></li></ul><blockquote><p>è·å–è¯¥<code>SecurityMetadataSource</code>å¯¹è±¡ä¸­ä¿å­˜çš„é’ˆå¯¹æ‰€æœ‰å®‰å…¨å¯¹è±¡çš„æƒé™ä¿¡æ¯çš„é›†åˆã€‚è¯¥æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯è¢«<code>AbstractSecurityInterceptor</code>ç”¨äºå¯åŠ¨æ—¶æ ¡éªŒæ¯ä¸ª<code>ConfigAttribute</code>å¯¹è±¡ã€‚</p></blockquote><ul><li><code>boolean supports(Class&lt;?&gt; clazz)</code></li></ul><blockquote><p>è¿™é‡Œ<code>clazz</code>è¡¨ç¤ºå®‰å…¨å¯¹è±¡çš„ç±»å‹ï¼Œè¯¥æ–¹æ³•ç”¨äºå‘ŠçŸ¥è°ƒç”¨è€…å½“å‰<code>SecurityMetadataSource</code>æ˜¯å¦æ”¯æŒæ­¤ç±»å®‰å…¨å¯¹è±¡ï¼Œåªæœ‰æ”¯æŒçš„æ—¶å€™ï¼Œæ‰èƒ½å¯¹è¿™ç±»å®‰å…¨å¯¹è±¡è°ƒç”¨<code>getAttributes</code>æ–¹æ³•ã€‚</p></blockquote><p><strong>ç»§æ‰¿å…³ç³»</strong></p><p><img src="https://img-blog.csdnimg.cn/20190623090023883.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FuZHlfemhhbmcyMDA3,size_16,color_FFFFFF,t_70" alt="SecurityMetadataSource"><br><code>Spring Security</code>å¯¹<code>SecurityMetadataSource</code>æä¾›äº†ä¸¤ä¸ªå­æ¥å£ :</p><ul><li><p>```<br>MethodSecurityMetadataSource</p><div class="hljs code-wrapper"><pre><code class="hljs autohotkey">  &gt; ç”±`Spring Security Core`å®šä¹‰ï¼Œç”¨äºè¡¨ç¤ºå®‰å…¨å¯¹è±¡æ˜¯æ–¹æ³•è°ƒç”¨(`MethodInvocation`)çš„å®‰å…¨å…ƒæ•°æ®æºã€‚- ```  FilterInvocationSecurityMetadataSource</code></pre></div><blockquote><p>ç”±<code>Spring Security Web</code>å®šä¹‰ï¼Œç”¨äºè¡¨ç¤ºå®‰å…¨å¯¹è±¡æ˜¯<code>Web</code>è¯·æ±‚(<code>FilterInvocation</code>)çš„å®‰å…¨å…ƒæ•°æ®æºã€‚</p></blockquote></li></ul><h3 id="FilterInvocationSecurityMetadataSource"><a href="#FilterInvocationSecurityMetadataSource" class="headerlink" title="FilterInvocationSecurityMetadataSource"></a>FilterInvocationSecurityMetadataSource</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦è‡ªå®šä¹‰æƒé™æ‹¦æˆªï¼Œåˆ™éœ€è¦æ¶‰åŠåˆ°<code>FilterInvocationSecurityMetadataSource</code>è¿™ä¸ªæ¥å£äº†ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå‘çˆ¹çš„åœ°æ–¹ã€‚å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œä½†æ˜¯å·²ç»è®¾ç½®äº†æ‹¦æˆªç™½åå•çš„URLï¼Œä»ç„¶ä¼šè¿›å…¥åˆ°æƒé™éªŒè¯é‡Œé¢æ¥ã€‚èµ·åˆï¼Œæˆ‘ä»¥ä¸ºä¸ä¼šè¿›æ¥ï¼Œä½†åæ¥è·Ÿè¸ªæºä»£ç å‘ç°ï¼Œè¿˜æ˜¯ä¼šè¿›æ¥ã€‚åªæ˜¯æ­¤æ—¶çš„èº«ä»½æ˜¯ä¸€ä¸ªåŒ¿åç”¨æˆ·ã€‚å…¶é»˜è®¤çš„å®ç°ä¸º<code>DefaultFilterInvocationSecurityMetadataSource</code></p><p>spring securityçš„è®¤è¯å’Œæƒé™æµç¨‹ï¼Œå¤§æ¦‚å°±æ˜¯æœ‰å¤šä¸ªè¿‡æ»¤å™¨ï¼Œä¸€æ­¥æ­¥è°ƒç”¨filter chainã€‚å®ƒçš„èº«ä»½è®¤è¯å…¶å®æ˜¯å§‹äºè®¿é—®èµ„æºå¼€å§‹ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·å·²ç™»å½•ï¼Œé‚£ä¹ˆè®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œåˆ™ä¼šæ ¡éªŒè¯¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚å¦‚æœæ²¡æœ‰æƒé™ï¼Œåˆ™ä¼šè°ƒç”¨æƒé™æ‹’ç»çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚å¦‚æœæœ‰æƒé™ï¼Œåˆ™èƒ½é¡ºåˆ©è®¿é—®è¯¥èµ„æºï¼›</p><p>ä¸€ä¸ªç”¨æˆ·æœªç™»å½•æƒ…å†µä¸‹ï¼Œä¹Ÿå³åŒ¿åç”¨æˆ·ï¼Œè®¿é—®å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œspring securityä¼šé¦–å…ˆæ£€æŸ¥è¯¥èµ„æºæ˜¯å¦éœ€è¦æƒé™ï¼Œå¦‚æœéœ€è¦æƒé™ï¼Œç„¶åå†æ£€æŸ¥ï¼Œè¯¥èµ„æºæ˜¯å¦æ˜¯ç™½åå•é‡Œé¢ã€‚å¦‚æœæ˜¯ç™½åå•ï¼Œä¹Ÿèƒ½æ­£å¸¸è®¿é—®ã€‚å¦‚æœæ˜¯å—ä¿æŠ¤çš„èµ„æºï¼Œåˆ™ä¼šæç¤ºè¯¥ç”¨æˆ·éœ€è¦ç™»å½•ã€‚</p><p>ä¹Ÿå³ï¼Œå½“ä¸€ä¸ªåŒ¿åç”¨æˆ·ï¼Œè®¿é—®å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼Œå°±ä¼šæç¤ºè¯¥ç”¨æˆ·éœ€è¦ç™»å½•ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œåœ¨<code>FilterInvocationSecurityMetadataSource</code>ä¸­é»˜è®¤çš„å®ç°ç±»<code>DefaultFilterInvocationSecurityMetadataSource</code><strong>çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯é€šè¿‡å½“å‰çš„è¯·æ±‚åœ°å€ï¼Œè·å–è¯¥åœ°å€éœ€è¦çš„ç”¨æˆ·è§’è‰²</strong></p><p>æˆ‘ä»¬å¯ä»¥å‚è€ƒè¿™ä¸ªå®ç°ç±»ï¼Œè‡ªå·±ä¹Ÿå®šä¹‰ä¸€ä¸ª<code>FilterInvocationSecurityMetadataSource</code>ï¼Œå¦‚ä¸‹</p><p>ä¸»è¦å·¥ä½œä¸ºï¼š</p><ul><li>ä»æ•°æ®æºä¸­åŠ è½½<code>ConfigAttribute</code>åˆ°<code>SecurityMetadataSource</code>èµ„æºå™¨ä¸­</li><li>é‡å†™<code>getAttributes()</code>åŠ è½½<code>ConfigAttribute</code>ä¸º<code>AccessDecisionManager.decide()</code>æˆæƒå†³ç­–åšå‡†å¤‡ã€‚</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFilterInvocationSecurityMetadataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FilterInvocationSecurityMetadataSource</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuService menuService;    <span class="hljs-comment">//è·¯å¾„åŒ¹é…</span>    AntPathMatcher antPathMatcher = <span class="hljs-keyword">new</span> AntPathMatcher();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(Object object)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException </span>&#123;        <span class="hljs-comment">//è·å–è¯·æ±‚çš„åœ°å€</span>        String requestUrl = ((FilterInvocation) object).getRequestUrl();        List&lt;Menu&gt; menus = menuService.getAllMenusWithRole();        <span class="hljs-keyword">for</span> (Menu menu : menus) &#123;            <span class="hljs-keyword">if</span> (antPathMatcher.match(menu.getUrl(), requestUrl)) &#123;                List&lt;Role&gt; roles = menu.getRoles();                String[] str = <span class="hljs-keyword">new</span> String[roles.size()];                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; roles.size(); i++) &#123;                    str[i] = roles.get(i).getName();                &#125;                <span class="hljs-keyword">return</span> SecurityConfig.createList(str);            &#125;        &#125;        <span class="hljs-comment">//æ²¡æœ‰åŒ¹é…ä¸Šçš„èµ„æºï¼Œéƒ½æ˜¯ç™»å½•è®¿é—®</span>        <span class="hljs-keyword">return</span> SecurityConfig.createList(<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAllConfigAttributes</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;</code></pre></div><ul><li>ä¸€å¼€å§‹æ³¨å…¥äº†<code>MenuService</code>ï¼Œ<code>MenuService</code>çš„ä½œç”¨æ˜¯ç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­url patternå’Œroleçš„å¯¹åº”å…³ç³»ï¼ˆ <code>menuService.getAllMenu()</code>åé¢å¯ç”¨ç¼“å­˜æ¥å­˜ï¼‰ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸€ä¸ªListé›†åˆï¼Œé›†åˆä¸­æ˜¯Menuç±»ï¼Œ<strong>Menuç±»æœ‰ä¸¤ä¸ªæ ¸å¿ƒå±æ€§ï¼Œä¸€ä¸ªæ˜¯url patternï¼Œå³åŒ¹é…è§„åˆ™(æ¯”å¦‚<code>/admin/**</code>)ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯Listï¼Œå³è¿™ç§è§„åˆ™çš„è·¯å¾„éœ€è¦å“ªäº›è§’è‰²æ‰èƒ½è®¿é—®ã€‚</strong></li><li>æˆ‘ä»¬å¯ä»¥ä»<code>getAttributes(Object o)</code>æ–¹æ³•çš„å‚æ•°oä¸­æå–å‡ºå½“å‰çš„è¯·æ±‚urlï¼Œç„¶åå°†è¿™ä¸ªè¯·æ±‚urlå’Œæ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ‰€æœ‰url patternä¸€ä¸€å¯¹ç…§ï¼Œçœ‹ç¬¦åˆå“ªä¸€ä¸ªurl patternï¼Œç„¶åå°±è·å–åˆ°è¯¥url patternæ‰€å¯¹åº”çš„è§’è‰²ï¼Œå½“ç„¶è¿™ä¸ªè§’è‰²å¯èƒ½æœ‰å¤šä¸ªï¼Œæ‰€ä»¥éå†è§’è‰²ï¼Œæœ€ååˆ©ç”¨<code>SecurityConfig.createList</code>æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªè§’è‰²é›†åˆã€‚</li><li>ç¬¬äºŒæ­¥çš„æ“ä½œä¸­ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ªä¼˜å…ˆçº§é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘çš„åœ°å€æ˜¯<code>/employee/basic/hello</code>,è¿™ä¸ªåœ°å€æ—¢èƒ½è¢«<code>/employee/**</code>åŒ¹é…ï¼Œä¹Ÿèƒ½è¢«<code>/employee/basic/**</code>åŒ¹é…ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬ä»æ•°æ®åº“æŸ¥è¯¢çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œå°†<code>/employee/basic/**</code>ç±»å‹çš„url patternæ”¾åœ¨é›†åˆçš„å‰é¢å»æ¯”è¾ƒã€‚</li><li>å¦‚æœ<code>getAttributes(Object o)</code>æ–¹æ³•è¿”å›nullçš„è¯ï¼Œæ„å‘³ç€å½“å‰è¿™ä¸ªè¯·æ±‚ä¸éœ€è¦ä»»ä½•è§’è‰²å°±èƒ½è®¿é—®ï¼Œç”šè‡³ä¸éœ€è¦ç™»å½•ã€‚ä½†æ˜¯åœ¨æˆ‘çš„æ•´ä¸ªä¸šåŠ¡ä¸­ï¼Œå¹¶ä¸å­˜åœ¨è¿™æ ·çš„è¯·æ±‚ï¼Œæˆ‘è¿™é‡Œçš„è¦æ±‚æ˜¯ï¼Œ<strong>æ‰€æœ‰æœªåŒ¹é…åˆ°çš„è·¯å¾„ï¼Œéƒ½æ˜¯è®¤è¯(ç™»å½•)åå¯è®¿é—®ï¼Œå› æ­¤æˆ‘åœ¨è¿™é‡Œè¿”å›ä¸€ä¸ª<code>ROLE_LOGIN</code>çš„è§’è‰²ï¼Œè¿™ç§è§’è‰²åœ¨æˆ‘çš„è§’è‰²æ•°æ®åº“ä¸­å¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤æˆ‘å°†åœ¨ä¸‹ä¸€æ­¥çš„è§’è‰²æ¯”å¯¹è¿‡ç¨‹ä¸­ç‰¹æ®Šå¤„ç†è¿™ç§è§’è‰²</strong>ã€‚</li><li>å¦‚æœåœ°å€æ˜¯<code>/login_p</code>ï¼Œè¿™ä¸ªæ˜¯ç™»å½•é¡µï¼Œä¸éœ€è¦ä»»ä½•è§’è‰²å³å¯è®¿é—®ï¼Œç›´æ¥è¿”å›nullã€‚</li><li><code>getAttributes(Object o)</code>æ–¹æ³•è¿”å›çš„é›†åˆæœ€ç»ˆä¼šæ¥åˆ°<code>AccessDecisionManager</code>ç±»ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹<code>AccessDecisionManager</code>ç±»</li></ul><h2 id="ğŸ”‘-æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…"><a href="#ğŸ”‘-æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…" class="headerlink" title="ğŸ”‘  æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…"></a>ğŸ”‘  æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…</h2><p>å…ˆå¼•å…¥ä¸€ä¸‹<code>AccessDecisionManager</code>çš„æ¦‚å¿µï¼š</p><h3 id="AccessDecisionManager"><a href="#AccessDecisionManager" class="headerlink" title="AccessDecisionManager"></a>AccessDecisionManager</h3><p><img src="https://oscimg.oschina.net/oscnet/fe299820424c5ead6a7f3bc97fa8dd957a5.jpg" alt="img"></p><p><strong>AccessDecisionManager</strong> é¡¾åæ€ä¹‰ï¼Œè®¿é—®å†³ç­–ç®¡ç†å™¨ã€‚å³åšå‡ºæœ€ç»ˆçš„è®¿é—®æ§åˆ¶ï¼ˆæˆæƒï¼‰å†³å®šã€‚</p><p>è€Œå¸¸ç”¨çš„ <strong>AccessDecisionManager</strong> æœ‰ä¸‰ä¸ªï¼Œè¿™é‡Œæˆ‘å°±ä½¿ç”¨æœ€ç®€å•çš„ä¸€ä¸ª<strong>AffirmativeBased</strong>ä¸­çš„æ€æƒ³ï¼Œè¿™æ˜¯<strong>Spring Security</strong> æ¡†æ¶é»˜è®¤çš„ <strong>AccessDecisionManager</strong>ï¼š<strong>åªè¦ä»»ä¸€ AccessDecisionVoter è¿”å›è‚¯å®šçš„ç»“æœï¼Œä¾¿æˆäºˆè®¿é—®æƒé™</strong>ã€‚</p><p>è‡ªå®šä¹‰<code>CustomUrlDecisionManager</code>ç±»å®ç°<code>AccessDecisionManager</code>æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomUrlDecisionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccessDecisionManager</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decide</span><span class="hljs-params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="hljs-keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;        <span class="hljs-keyword">for</span> (ConfigAttribute configAttribute : configAttributes) &#123;            <span class="hljs-comment">//å½“å‰è¯·æ±‚éœ€è¦çš„æƒé™</span>            String needRole = configAttribute.getAttribute();            <span class="hljs-comment">//å¦‚æœæ˜¯åŒ¿åç”¨æˆ·ï¼ŒæŠ›å¼‚å¸¸</span>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) &#123;                <span class="hljs-keyword">if</span> (authentication <span class="hljs-keyword">instanceof</span> AnonymousAuthenticationToken)&#123;                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•ï¼&quot;</span>);                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;            <span class="hljs-comment">//å½“å‰ç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™</span>            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();            <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;                <span class="hljs-comment">//éœ€è¦çš„è§’è‰²èƒ½è¢«æ£€æµ‹åˆ°</span>                <span class="hljs-keyword">if</span> (authority.getAuthority().equals(needRole))&#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;æƒé™ä¸è¶³ï¼Œè¯·è¿”å›ï¼&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(ConfigAttribute attribute)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;</code></pre></div><ul><li>decideæ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œ<strong>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä¿å­˜äº†å½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯<code>CustomFilterInvocationSecurityMetadataSource</code>ä¸­çš„<code>getAttributes</code>æ–¹æ³•ä¼ æ¥çš„ï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚éœ€è¦çš„è§’è‰²ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰</strong></li><li>å¦‚æœå½“å‰è¯·æ±‚éœ€è¦çš„æƒé™ä¸º<code>ROLE_LOGIN</code>åˆ™è¡¨ç¤ºç™»å½•å³å¯è®¿é—®ï¼Œå’Œè§’è‰²æ²¡æœ‰å…³ç³»ï¼Œæ­¤æ—¶æˆ‘éœ€è¦åˆ¤æ–­authenticationæ˜¯ä¸æ˜¯<code>AnonymousAuthenticationToken</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ²¡æœ‰ç™»å½•å°±æŠ›ä¸€ä¸ª<code>BadCredentialsException</code>å¼‚å¸¸ï¼Œç™»å½•äº†å°±ç›´æ¥è¿”å›ï¼Œåˆ™è¿™ä¸ªè¯·æ±‚å°†è¢«æˆåŠŸæ‰§è¡Œã€‚</li><li><strong>éå†collectionï¼ŒåŒæ—¶æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è§’è‰²åˆ—è¡¨ä¸­æ˜¯å¦å…·å¤‡éœ€è¦çš„æƒé™</strong>ï¼Œå¦‚æœå…·å¤‡å°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™å°±æŠ›å¼‚å¸¸ã€‚</li><li>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªallå’Œanyçš„é—®é¢˜ï¼šå‡è®¾å½“å‰ç”¨æˆ·å…·å¤‡è§’è‰²Aã€è§’è‰²Bï¼Œå½“å‰è¯·æ±‚éœ€è¦è§’è‰²Bã€è§’è‰²Cï¼Œé‚£ä¹ˆæ˜¯è¦å½“å‰ç”¨æˆ·è¦åŒ…å«æ‰€æœ‰è¯·æ±‚è§’è‰²æ‰ç®—æˆæƒæˆåŠŸè¿˜æ˜¯åªè¦åŒ…å«ä¸€ä¸ªå°±ç®—æˆæƒæˆåŠŸï¼Ÿæˆ‘è¿™é‡Œé‡‡ç”¨äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼Œå³åªè¦åŒ…å«ä¸€ä¸ªå³å¯</li></ul><p><strong>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè·å–è§’è‰²å’Œåˆ¤æ–­è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…åˆ°éƒ¨åˆ†å·²ç»åˆ†æç»“æŸï¼Œä¸‹é¢å¼€å§‹åˆ†æç™»å½•çš„éªŒè¯å’Œè‡ªå®šä¹‰ç™»å½•è¿‡æ»¤å™¨çš„å…·ä½“æµç¨‹</strong></p><h2 id="ğŸ”ç™»å½•çš„éªŒè¯"><a href="#ğŸ”ç™»å½•çš„éªŒè¯" class="headerlink" title="ğŸ”ç™»å½•çš„éªŒè¯"></a>ğŸ”ç™»å½•çš„éªŒè¯</h2><p>ä¸‹é¢å°±è¦é’ˆå¯¹äºç™»å½•è¿›è¡Œæ›´æ·±ä¸€æ­¥çš„è¯´æ˜ï¼Œç™»å½•éªŒè¯æ¶‰åŠåˆ°è´¦å·ã€å¯†ç ã€ä¸éªŒè¯ç </p><h3 id="PasswordEncoder"><a href="#PasswordEncoder" class="headerlink" title="PasswordEncoder"></a>PasswordEncoder</h3><p><code>PasswordEncoder</code> æ˜¯Spring Scurityæ¡†æ¶å†…å¤„ç†å¯†ç åŠ å¯†ä¸æ ¡éªŒçš„æ¥å£ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.springframework.security.crypto.password;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PasswordEncoder</span> </span>&#123;   <span class="hljs-function">String <span class="hljs-title">encode</span><span class="hljs-params">(CharSequence rawPassword)</span></span>;   <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">matches</span><span class="hljs-params">(CharSequence rawPassword, String encodedPassword)</span></span>;   <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">upgradeEncoding</span><span class="hljs-params">(String encodedPassword)</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;   &#125;&#125;</code></pre></div><p>è¿™ä¸ªæ¥å£æœ‰ä¸‰ä¸ªæ–¹æ³•</p><ul><li><code>encode</code>æ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯åŸå§‹å¯†ç å­—ç¬¦ä¸²ï¼Œè¿”å›å€¼æ˜¯ç»è¿‡åŠ å¯†ä¹‹åçš„hashå€¼ï¼Œhashå€¼æ˜¯ä¸èƒ½è¢«é€†å‘è§£å¯†çš„ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸åœ¨ä¸ºç³»ç»Ÿæ·»åŠ ç”¨æˆ·ï¼Œæˆ–è€…ç”¨æˆ·æ³¨å†Œçš„æ—¶å€™ä½¿ç”¨ã€‚</li><li><code>matches</code>æ–¹æ³•æ˜¯ç”¨æ¥æ ¡éªŒç”¨æˆ·è¾“å…¥å¯†ç rawPasswordï¼Œå’ŒåŠ å¯†åçš„hashå€¼encodedPasswordæ˜¯å¦åŒ¹é…ã€‚å¦‚æœèƒ½å¤ŸåŒ¹é…è¿”å›trueï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å¯†ç rawPasswordæ˜¯æ­£ç¡®çš„ï¼Œåä¹‹è¿”å›fasleã€‚ä¹Ÿå°±æ˜¯è¯´è™½ç„¶è¿™ä¸ªhashå€¼ä¸èƒ½è¢«é€†å‘è§£å¯†ï¼Œä½†æ˜¯å¯ä»¥åˆ¤æ–­æ˜¯å¦å’ŒåŸå§‹å¯†ç åŒ¹é…ã€‚<strong>è¿™ä¸ªæ–¹æ³•é€šå¸¸åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™è¿›è¡Œç”¨æˆ·è¾“å…¥å¯†ç çš„æ­£ç¡®æ€§æ ¡éªŒã€‚</strong></li><li><code>upgradeEncoding</code>è®¾è®¡çš„ç”¨æ„æ˜¯ï¼Œåˆ¤æ–­å½“å‰çš„å¯†ç æ˜¯å¦éœ€è¦å‡çº§ã€‚ä¹Ÿå°±æ˜¯æ˜¯å¦éœ€è¦é‡æ–°åŠ å¯†ï¼Ÿéœ€è¦çš„è¯è¿”å›trueï¼Œä¸éœ€è¦çš„è¯è¿”å›fasleã€‚é»˜è®¤å®ç°æ˜¯è¿”å›falseã€‚</li></ul><p> <strong><code>BCryptPasswordEncoder</code> ä½œä¸ºSpring Securityæ¨èä½¿ç”¨çš„ <code>PasswordEncoder</code>å®ç°ç±» ï¼Œå¯ä»¥å®ç°å¯¹å¯†ç çš„è‡ªåŠ¨åŠ å¯†åŠ ç›</strong>ï¼Œï¼ˆç›æ˜¯å€¼å³ä½¿ç›¸åŒçš„æ˜æ–‡ï¼Œç”Ÿæˆçš„æ–°çš„åŠ å¯†å­—ç¬¦ä¸²éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…åƒåœ¨Shiroä¸­é‚£æ ·æˆ‘ä»¬è‡ªå·±é…ç½®å¯†ç çš„ç›ï¼Œè€Œ <code>BCryptPasswordEncoder</code> å°±æ˜¯     <code>PasswordEncoder</code> æ¥å£çš„å®ç°ç±»ï¼Œåªéœ€è¦æä¾› <code>BCryptPasswordEncoder</code> è¿™ä¸ª Bean çš„å®ä¾‹å³å¯ï¼ŒSpringSecurityä¸­ä½¿ç”¨<code>BCryptPasswordEncoder</code>çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><p>BCryptPasswordEncoder ä½¿ç”¨ BCrypt å¼ºå“ˆå¸Œå‡½æ•°ï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ—¶å¯ä»¥é€‰æ‹©æä¾› strength å’Œ SecureRandom å®ä¾‹ã€‚strength è¶Šå¤§ï¼Œå¯†é’¥çš„è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œå¯†é’¥è¿­ä»£æ¬¡æ•°ä¸º 2^strengthã€‚strength å–å€¼åœ¨ 4~31 ä¹‹é—´ï¼Œé»˜è®¤ä¸º 10ã€‚</p></blockquote><p>åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¯†ç è¿›è¡Œå¤„ç†ï¼Œå¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hrReg</span><span class="hljs-params">(String username, String password)</span> </span>&#123;    <span class="hljs-comment">//å¦‚æœç”¨æˆ·åå­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span>    <span class="hljs-keyword">if</span> (hrMapper.loadUserByUsername(username) != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;    &#125;    BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    String encode = encoder.encode(password);    <span class="hljs-keyword">return</span> hrMapper.hrReg(username, encode);&#125;</code></pre></div><p>ç”¨æˆ·å°†å¯†ç ä»å‰ç«¯ä¼ æ¥ä¹‹åï¼Œé€šè¿‡è°ƒç”¨ <code>BCryptPasswordEncoder</code> å®ä¾‹ä¸­çš„ encode æ–¹æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†ï¼ŒåŠ å¯†å®Œæˆåå°†å¯†æ–‡å­˜å…¥æ•°æ®åº“ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">$2a$10$zt6dUMTjNSyzINTGyiAgluna3mPm7qdgl26vj4tFpsFO6WlK5lXNm</span></code></pre></div><p>BCryptåŠ å¯†åçš„å¯†ç æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç”± $åˆ†éš”ï¼š</p><ol><li>â€œ2aâ€è¡¨ç¤º BCrypt ç®—æ³•ç‰ˆæœ¬</li><li>â€œ10â€è¡¨ç¤ºç®—æ³•çš„å¼ºåº¦</li><li>â€œzt6dUMTjNSyzINTGyiAgluâ€éƒ¨åˆ†å®é™…ä¸Šæ˜¯éšæœºç”Ÿæˆçš„ç›ã€‚é€šå¸¸æ¥è¯´å‰ 22 ä¸ªå­—ç¬¦æ˜¯ç›ï¼Œå‰©ä½™éƒ¨åˆ†æ˜¯çº¯æ–‡æœ¬çš„å®é™…å“ˆå¸Œå€¼ã€‚</li></ol><blockquote><p>BCryptç®—æ³•ç”Ÿæˆé•¿åº¦ä¸º 60 çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç¡®ä¿å¯†ç å°†å­˜å‚¨åœ¨å¯ä»¥å®¹çº³å¯†ç çš„æ•°æ®åº“åˆ—ä¸­ã€‚</p></blockquote><p>å½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åï¼Œå­˜åœ¨æ•°æ®åº“ä¸­çš„å¯†ç å°±åƒä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p283.png" alt="p283"></p><p>å‡å¦‚æ˜æ–‡éƒ½æ˜¯ 123ã€‚é…ç½®å®Œæˆåï¼Œä½¿ç”¨ admin/123 æˆ–è€… sang/123 å°±å¯ä»¥å®ç°ç™»å½•ã€‚</p><p>å¯†ç åŠ å¯†å¤„ç†ä¹‹åï¼Œç™»å½•æ—¶å€™ä¹Ÿè¦å¯¹å¯†ç è¿›è¡Œå¤„ç†ï¼Œ<strong>ä¿®æ”¹SecurityConfigç±»çš„configure(AuthenticationManagerBuilder auth)æ–¹æ³•ï¼Œ</strong>æ”¹ä¸ºä¸‹é¢è¿™æ ·å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    auth.userDetailsService(hrService);&#125;</code></pre></div><h3 id="éªŒè¯ç çš„æ ¡éªŒ"><a href="#éªŒè¯ç çš„æ ¡éªŒ" class="headerlink" title="éªŒè¯ç çš„æ ¡éªŒ"></a>éªŒè¯ç çš„æ ¡éªŒ</h3><p>éªŒè¯ç çš„ç”Ÿæˆæ¥å£ååˆ†å¤šï¼Œè¿™é‡Œä¸å†æä¾›ï¼Œè¿™ä¸ªå·¥å…·ç±»å¾ˆå¸¸è§ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šï¼Œå°±æ˜¯ç”»ä¸€ä¸ªç®€å•çš„éªŒè¯ç ï¼Œé€šè¿‡æµå°†éªŒè¯ç å†™åˆ°å‰ç«¯é¡µé¢ï¼Œæä¾›éªŒè¯ç çš„ Controller å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/verifyCode&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">verifyCode</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;  <span class="hljs-comment">//è·å–å®ä¾‹</span>    VerificationCode code = <span class="hljs-keyword">new</span> VerificationCode();    BufferedImage image = code.getImage();    String text = code.getText();    HttpSession session = request.getSession(<span class="hljs-keyword">true</span>);    session.setAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>, text);    VerificationCode.output(image,resp.getOutputStream());&#125;</code></pre></div><p>åŒæ—¶éœ€è¦åœ¨Spring Securityé…ç½®ç±»ä¸­é…ç½®ä¸æ‹¦æˆªæ­¤æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>    web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);&#125;</code></pre></div><p>å› ä¸ºæ¶‰åŠåˆ°è‡ªå®šä¹‰ç™»é™†é€»è¾‘ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰ç™»é™†è¿‡æ»¤å™¨ï¼Œè¿™é‡Œå…ˆä¸è¯´æ˜å®ç°è¿‡æ»¤å™¨çš„è¯¦ç»†æµç¨‹ï¼Œç­‰åˆ°ä¸‹é¢è®²åˆ°JSONç™»é™†çš„æ—¶å€™ï¼Œç»Ÿä¸€å¤„ç†</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡æ»¤å™¨è‡ªå®šä¹‰å®Œæˆåï¼Œä¹Ÿéœ€è¦åœ¨é…ç½®ç±»ä¸­æ³¨å…¥ï¼Œè¿™é‡Œæ‰èƒ½èƒ½å®Œæˆæ•´ä¸ªæµç¨‹çš„é…ç½®ã€‚</p><h3 id="å®ç°JSONæ ¼å¼ç™»é™†"><a href="#å®ç°JSONæ ¼å¼ç™»é™†" class="headerlink" title="å®ç°JSONæ ¼å¼ç™»é™†"></a>å®ç°JSONæ ¼å¼ç™»é™†</h3><p>å‰åç«¯åˆ†ç¦»è¿™æ ·çš„å¼€å‘æ¶æ„ä¸‹ï¼Œå‰åç«¯çš„äº¤äº’éƒ½æ˜¯é€šè¿‡ JSON æ¥è¿›è¡Œï¼Œæ— è®ºç™»å½•æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¸ä¼šæœ‰ä»€ä¹ˆæœåŠ¡ç«¯è·³è½¬æˆ–è€…å®¢æˆ·ç«¯è·³è½¬ä¹‹ç±»ã€‚</p><p>ç™»å½•æˆåŠŸäº†ï¼ŒæœåŠ¡ç«¯å°±è¿”å›ä¸€æ®µç™»å½•æˆåŠŸçš„æç¤º JSON ç»™å‰ç«¯ï¼Œå‰ç«¯æ”¶åˆ°ä¹‹åï¼Œè¯¥è·³è½¬è¯¥å±•ç¤ºï¼Œç”±å‰ç«¯è‡ªå·±å†³å®šï¼Œå°±å’Œåç«¯æ²¡æœ‰å…³ç³»äº†ã€‚</p><p>ç™»å½•å¤±è´¥äº†ï¼ŒæœåŠ¡ç«¯å°±è¿”å›ä¸€æ®µç™»å½•å¤±è´¥çš„æç¤º JSON ç»™å‰ç«¯ï¼Œå‰ç«¯æ”¶åˆ°ä¹‹åï¼Œè¯¥è·³è½¬è¯¥å±•ç¤ºï¼Œç”±å‰ç«¯è‡ªå·±å†³å®šï¼Œä¹Ÿå’Œåç«¯æ²¡æœ‰å…³ç³»äº†ã€‚</p><p>æ‰€ä»¥ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç™»å½•çš„æ—¶å€™ï¼Œä¹Ÿå®ç°JSONäº¤äº’ï¼Œä½†æ˜¯æˆ‘ä»¬é¦–å…ˆå¾—æ˜ç™½ä¸€ä¸ªå‰æï¼Œ åœ¨ä½¿ç”¨ SpringSecurity ä¸­ï¼Œé»˜è®¤çš„ç™»å½•æ•°æ®æ˜¯é€šè¿‡ <code>key/value</code> çš„å½¢å¼æ¥ä¼ é€’çš„ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ä¸æ”¯æŒ JSONæ ¼å¼çš„ç™»å½•æ•°æ®ï¼Œå¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œå°±éœ€è¦è‡ªå·±æ¥è§£å†³ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤å™¨</strong></p><p>é¦–å…ˆå¤§å®¶çŸ¥é“ï¼Œç”¨æˆ·ç™»å½•çš„ç”¨æˆ·å/å¯†ç æ˜¯åœ¨ <code>UsernamePasswordAuthenticationFilter</code> ç±»ä¸­å¤„ç†çš„ï¼Œå…·ä½“çš„å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;String username = obtainUsername(request);String password = obtainPassword(request);    <span class="hljs-comment">//çœç•¥</span>&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainPassword</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(passwordParameter);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainUsername</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(usernameParameter);&#125;</code></pre></div><p>ä»è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ä¸ºä»€ä¹ˆ Spring Security é»˜è®¤æ˜¯é€šè¿‡ key/value çš„å½¢å¼æ¥ä¼ é€’ç™»å½•å‚æ•°ï¼Œå› ä¸ºå®ƒå¤„ç†çš„æ–¹å¼å°±æ˜¯<code> request.getParameter</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦å®šä¹‰æˆ JSON çš„ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯è‡ªå®šä¹‰æ¥å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ä»£æ›¿ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œç„¶ååœ¨è·å–å‚æ•°çš„æ—¶å€™ï¼Œæ¢ä¸€ç§æ–¹å¼å°±è¡Œäº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¨¡ä»¿æºä»£ç ä¸­çš„æ­¤éƒ¨åˆ†æ¥ä¸ªæ€§åŒ–å®šåˆ¶ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809163840081.png" alt="image-20210809163840081"></p><p><strong>è¿™é‡Œæœ‰ä¸€ä¸ªé¢å¤–çš„ç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ç°åœ¨è¿˜æœ‰éªŒè¯ç çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚æœè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œè¦è¿åŒéªŒè¯ç ä¸€èµ·å¤„ç†æ‰ã€‚</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ä»£æ›¿ <code>UsernamePasswordAuthenticationFilter</code> ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;  <span class="hljs-comment">//éœ€è¦é‡å†™çš„æ–¹æ³•</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;      <span class="hljs-comment">//æ­¤éƒ¨åˆ†é€»è¾‘ä¸å˜</span>        <span class="hljs-keyword">if</span> (!request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(                    <span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());        &#125;      <span class="hljs-comment">//æ‹¿åˆ°æ­£ç¡®çš„éªŒè¯ç </span>        String verify_code = (String) request.getSession().getAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>);      <span class="hljs-comment">//åˆ¤æ–­æ˜¯Key/Valueè¿˜æ˜¯JSONä¼ é€’</span>        <span class="hljs-keyword">if</span> (request.getContentType().contains(MediaType.APPLICATION_JSON_VALUE) || request.getContentType().contains(MediaType.APPLICATION_JSON_UTF8_VALUE)) &#123;          <span class="hljs-comment">//å°è£…ä¼ æ¥çš„æ•°æ®</span>            Map&lt;String, String&gt; loginData = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();            <span class="hljs-keyword">try</span> &#123;                loginData = <span class="hljs-keyword">new</span> ObjectMapper().readValue(request.getInputStream(), Map.class);            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            &#125;<span class="hljs-keyword">finally</span> &#123;              <span class="hljs-comment">//æµè§ˆå™¨ä¼ è¿‡æ¥è¾“å…¥çš„</span>                String code = loginData.get(<span class="hljs-string">&quot;code&quot;</span>);                checkCode(response, code, verify_code);            &#125;            String username = loginData.get(getUsernameParameter());            String password = loginData.get(getPasswordParameter());            <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;                username = <span class="hljs-string">&quot;&quot;</span>;            &#125;            <span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;                password = <span class="hljs-string">&quot;&quot;</span>;            &#125;            username = username.trim();            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(                    username, password);            setDetails(request, authRequest);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);        &#125;       <span class="hljs-comment">//Key/Valueç›´æ¥ç”¨çˆ¶ç±»å¤„ç†å³å¯</span>      <span class="hljs-keyword">else</span> &#123;            checkCode(response, request.getParameter(<span class="hljs-string">&quot;code&quot;</span>), verify_code);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.attemptAuthentication(request, response);        &#125;    &#125;<span class="hljs-comment">//æ ¡éªŒè¾“å…¥çš„å’Œæ­£ç¡®ç”Ÿæˆçš„æ˜¯å¦åŒ¹é…</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkCode</span><span class="hljs-params">(HttpServletResponse resp, String code, String verify_code)</span> </span>&#123;        <span class="hljs-keyword">if</span> (code == <span class="hljs-keyword">null</span> || verify_code == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(code) || !verify_code.toLowerCase().equals(code.toLowerCase())) &#123;            <span class="hljs-comment">//éªŒè¯ç ä¸æ­£ç¡®</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;éªŒè¯ç ä¸æ­£ç¡®&quot;</span>);        &#125;    &#125;&#125;</code></pre></div><p>è¿™æ®µé€»è¾‘æˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯æ¨¡ä»¿å®˜æ–¹æä¾›çš„ <code>UsernamePasswordAuthenticationFilter</code> æ¥å†™çš„ï¼Œç¨å¾®è§£é‡Šä¸‹ï¼š</p><ol><li>é¦–å…ˆç™»å½•è¯·æ±‚è‚¯å®šæ˜¯ POSTï¼Œå¦‚æœä¸æ˜¯ POST ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œåé¢çš„ä¹Ÿä¸å¤„ç†äº†ã€‚</li><li>å› ä¸ºè¦åœ¨è¿™é‡Œå¤„ç†éªŒè¯ç ï¼Œæ‰€ä»¥ç¬¬äºŒæ­¥ä» session ä¸­æŠŠå·²ç»ä¸‹å‘è¿‡çš„éªŒè¯ç çš„å€¼æ‹¿å‡ºæ¥ã€‚</li><li>æ¥ä¸‹æ¥é€šè¿‡ contentType æ¥åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦é€šè¿‡ JSON æ¥ä¼ é€’å‚æ•°ï¼Œå¦‚æœæ˜¯é€šè¿‡ JSON ä¼ é€’å‚æ•°ï¼Œåˆ™æŒ‰ç…§ JSON çš„æ–¹å¼è§£æï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è°ƒç”¨ <code>super.attemptAuthentication </code>æ–¹æ³•ï¼Œè¿›å…¥çˆ¶ç±»çš„å¤„ç†é€»è¾‘ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªç±»ï¼Œæ—¢æ”¯æŒ JSON å½¢å¼ä¼ é€’å‚æ•°ï¼Œä¹Ÿæ”¯æŒ key/value å½¢å¼ä¼ é€’å‚æ•°ã€‚</strong></li><li>å¦‚æœæ˜¯ JSON å½¢å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±é€šè¿‡è¯»å– request ä¸­çš„ I/O æµï¼Œå°† JSON æ˜ å°„åˆ°ä¸€ä¸ª Map ä¸Šã€‚</li><li>ä» Map ä¸­å–å‡º codeï¼Œå…ˆå»åˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœéªŒè¯ç æœ‰é”™ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li><li>æ¥ä¸‹æ¥ä» Map ä¸­å–å‡º username å’Œ passwordï¼Œæ„é€  UsernamePasswordAuthenticationToken å¯¹è±¡å¹¶ä½œæ ¡éªŒã€‚</li></ol><p><strong>æ¥ä¸‹æ¥å°±æ˜¯åœ¨Spring Securityé…ç½®ç±»ä¸­é…ç½®æ­¤è¿‡æ»¤å™¨å³å¯</strong></p><h3 id="Spring-Securityé…ç½®ç±»"><a href="#Spring-Securityé…ç½®ç±»" class="headerlink" title="Spring Securityé…ç½®ç±»"></a>Spring Securityé…ç½®ç±»</h3><h4 id="åŸºç¡€æ³¨å…¥"><a href="#åŸºç¡€æ³¨å…¥" class="headerlink" title="åŸºç¡€æ³¨å…¥"></a>åŸºç¡€æ³¨å…¥</h4><p>ç»“åˆä»¥ä¸Šæ‰€è®²çš„ï¼Œå°±èƒ½åœ¨é…ç½®ç±»ä¸­æ•´åˆæ‰€æœ‰éœ€è¦ç”¨åˆ°çš„æ ¡éªŒç±»ï¼Œé¦–å…ˆåœ¨Spring Securityé…ç½®ç±»ä¸­é…ç½®åŸºç¡€çš„ä¿¡æ¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<span class="hljs-comment">//UserDetialçš„æ ¡éªŒ</span>    <span class="hljs-meta">@Autowired</span>    HrService hrService;  <span class="hljs-comment">//æ ¹æ®è¯·æ±‚åœ°å€è·å–è§’è‰²çš„æ ¡éªŒ</span>    <span class="hljs-meta">@Autowired</span>    CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;<span class="hljs-comment">//æ£€æŸ¥è§’è‰²çš„æ ¡éªŒ</span>    <span class="hljs-meta">@Autowired</span>    CustomUrlDecisionManager customUrlDecisionManager;<span class="hljs-comment">//å¯†ç çš„æ ¡éªŒ</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;<span class="hljs-comment">//å¯†ç åŠ å¯†å¤„ç†åé…ç½®</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(hrService);    &#125;</code></pre></div><h4 id="ç™»é™†æˆåŠŸå¤±è´¥çš„å›è°ƒ"><a href="#ç™»é™†æˆåŠŸå¤±è´¥çš„å›è°ƒ" class="headerlink" title="ç™»é™†æˆåŠŸå¤±è´¥çš„å›è°ƒ"></a>ç™»é™†æˆåŠŸå¤±è´¥çš„å›è°ƒ</h4><p>æ¥ä¸‹æ¥å°±éœ€è¦é’ˆå¯¹åˆšå®šä¹‰å¥½çš„è¿‡æ»¤å™¨è¿›ä¸€æ­¥é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();  <span class="hljs-comment">//æˆåŠŸå›è°ƒ</span>    loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; &#123;                response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                PrintWriter out = response.getWriter();                Hr hr = (Hr) authentication.getPrincipal();                hr.setPassword(<span class="hljs-keyword">null</span>);                RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!&quot;</span>, hr);                String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);                out.write(s);                out.flush();                out.close();            &#125;    );  <span class="hljs-comment">//å¤±è´¥å›è°ƒ</span>    loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; &#123;                response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                PrintWriter out = response.getWriter();                RespBean respBean = RespBean.error(exception.getMessage());                <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException) &#123;                    respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;                    respBean.setMsg(<span class="hljs-string">&quot;å¯†ç è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;                    respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException) &#123;                    respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;                    respBean.setMsg(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);                &#125;                out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                out.flush();                out.close();            &#125;    );</code></pre></div><p><code>AuthenticationSuccessHandler</code>æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>HttpServletRequest</code></li><li><code>HttpServletResponse</code></li><li><code>Authentication</code></li></ul><p>æœ‰äº†å‰ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™é‡Œéšå¿ƒæ‰€æ¬²çš„è¿”å›æ•°æ®äº†ã€‚åˆ©ç”¨ <code>HttpServletRequest</code> æˆ‘ä»¬å¯ä»¥åšæœåŠ¡ç«¯è·³è½¬ï¼Œåˆ©ç”¨ <code>HttpServletResponse </code>æˆ‘ä»¬å¯ä»¥åšå®¢æˆ·ç«¯è·³è½¬ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¿”å› JSON æ•°æ®ã€‚</p><p>ç¬¬ä¸‰ä¸ª <code>Authentication</code> å‚æ•°åˆ™ä¿å­˜äº†æˆ‘ä»¬åˆšåˆšç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åŒç†ï¼Œå¤±è´¥çš„å›è°ƒä¹Ÿæ˜¯ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªå°±ä¸ç”¨è¯´äº†ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸€ä¸ª Exceptionï¼Œå¯¹äºç™»å½•å¤±è´¥ï¼Œä¼šæœ‰ä¸åŒçš„åŸå› ï¼ŒException ä¸­åˆ™ä¿å­˜äº†ç™»å½•å¤±è´¥çš„åŸå› ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹é€šè¿‡ JSON è¿”å›åˆ°å‰ç«¯ã€‚</p><h4 id="å¼‚å¸¸æ•è·"><a href="#å¼‚å¸¸æ•è·" class="headerlink" title="å¼‚å¸¸æ•è·"></a>å¼‚å¸¸æ•è·</h4><p>è¿™é‡Œæˆ‘è¿˜æŒ¨ä¸ªå»è¯†åˆ«äº†ä¸€ä¸‹å¼‚å¸¸çš„ç±»å‹ï¼Œæ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªæ›´åŠ æ˜ç¡®çš„æç¤ºï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><p>å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬åªç»™ä¸€ä¸ªæ¨¡ç³Šçš„æç¤ºï¼Œå³<strong>ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</strong>ï¼Œè€Œä¸ä¼šç»™ä¸€ä¸ªæ˜ç¡®çš„è¯¸å¦‚â€œç”¨æˆ·åè¾“å…¥é”™è¯¯â€æˆ–â€œå¯†ç è¾“å…¥é”™è¯¯â€è¿™æ ·ç²¾ç¡®çš„æç¤ºï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šä¸æ‡‚è¡Œçš„æ–°æ‰‹å°ä¼™ä¼´ï¼Œä»–å¯èƒ½å°±ä¼šç»™ä¸€ä¸ªæ˜ç¡®çš„é”™è¯¯æç¤ºï¼Œè¿™ä¼šç»™ç³»ç»Ÿå¸¦æ¥é£é™©ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨äº† Spring Security è¿™æ ·çš„å®‰å…¨ç®¡ç†æ¡†æ¶ä¹‹åï¼Œå³ä½¿ä½ æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œä¹Ÿä¸ä¼šçŠ¯è¿™æ ·çš„é”™è¯¯ã€‚</p><p>åœ¨ Spring Security ä¸­ï¼Œç”¨æˆ·åæŸ¥æ‰¾å¤±è´¥å¯¹åº”çš„å¼‚å¸¸æ˜¯ï¼š</p><ul><li><code>UsernameNotFoundException</code></li></ul><p>å¯†ç åŒ¹é…å¤±è´¥å¯¹åº”çš„å¼‚å¸¸æ˜¯ï¼š</p><ul><li><code>BadCredentialsException</code></li></ul><p>ä½†æ˜¯æˆ‘ä»¬åœ¨ç™»å½•å¤±è´¥çš„å›è°ƒä¸­ï¼Œå´æ€»æ˜¯çœ‹ä¸åˆ° <code>UsernameNotFoundException </code>å¼‚å¸¸ï¼Œæ— è®ºç”¨æˆ·åè¿˜æ˜¯å¯†ç è¾“å…¥é”™è¯¯ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸éƒ½æ˜¯ <code>BadCredentialsException</code></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication authentication)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<span class="hljs-keyword">try</span> &#123;user = retrieveUser(username,(UsernamePasswordAuthenticationToken) authentication);&#125;<span class="hljs-keyword">catch</span> (UsernameNotFoundException notFound) &#123;logger.debug(<span class="hljs-string">&quot;User &#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27; not found&quot;</span>);<span class="hljs-keyword">if</span> (hideUserNotFoundExceptions) &#123;<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadCredentialsException(messages.getMessage(<span class="hljs-string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>,<span class="hljs-string">&quot;Bad credentials&quot;</span>));&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">throw</span> notFound;&#125;&#125;&#125;</code></pre></div><p>ä»è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹å‡ºï¼Œåœ¨æŸ¥æ‰¾ç”¨æˆ·æ—¶ï¼Œå¦‚æœæŠ›å‡ºäº† <code>UsernameNotFoundException</code>ï¼Œè¿™ä¸ªå¼‚å¸¸ä¼šè¢«æ•è·ï¼Œæ•è·ä¹‹åï¼Œå¦‚æœ <code>hideUserNotFoundExceptions</code> å±æ€§çš„å€¼ä¸º trueï¼Œå°±æŠ›å‡ºä¸€ä¸ª <code>BadCredentialsException</code>ã€‚ç›¸å½“äºå°† <code>UsernameNotFoundException </code>å¼‚å¸¸éšè—äº†ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>hideUserNotFoundExceptions</code> çš„å€¼å°±ä¸º trueã€‚</p><h4 id="ç™»é™†æœªéªŒè¯"><a href="#ç™»é™†æœªéªŒè¯" class="headerlink" title="ç™»é™†æœªéªŒè¯"></a>ç™»é™†æœªéªŒè¯</h4><p>åœ¨å‰åç«¯åˆ†ç¦»ä¸­ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•å°±è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯åæ‰èƒ½è®¿é—®çš„é¡µé¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è®©ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œè€Œæ˜¯ç»™ç”¨æˆ·ä¸€ä¸ªå°šæœªç™»å½•çš„æç¤ºï¼Œå‰ç«¯æ”¶åˆ°æç¤ºä¹‹åï¼Œå†è‡ªè¡Œå†³å®šé¡µé¢è·³è½¬ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ¶‰åŠåˆ° Spring Security ä¸­çš„ä¸€ä¸ªæ¥å£ <code>AuthenticationEntryPoint</code> ï¼Œè¯¥æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»ï¼š<code>LoginUrlAuthenticationEntryPoint</code> ï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªæ–¹æ³• <code>commence</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * Performs the redirect (or forward) to the login form URL.</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commence</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,</span></span><span class="hljs-function"><span class="hljs-params">AuthenticationException authException)</span> </span>&#123;String redirectUrl = <span class="hljs-keyword">null</span>;<span class="hljs-keyword">if</span> (useForward) &#123;<span class="hljs-keyword">if</span> (forceHttps &amp;&amp; <span class="hljs-string">&quot;http&quot;</span>.equals(request.getScheme())) &#123;redirectUrl = buildHttpsRedirectUrlForRequest(request);&#125;<span class="hljs-keyword">if</span> (redirectUrl == <span class="hljs-keyword">null</span>) &#123;String loginForm = determineUrlToUseForThisRequest(request, response,authException);<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;logger.debug(<span class="hljs-string">&quot;Server side forward to: &quot;</span> + loginForm);&#125;RequestDispatcher dispatcher = request.getRequestDispatcher(loginForm);dispatcher.forward(request, response);<span class="hljs-keyword">return</span>;&#125;&#125;<span class="hljs-keyword">else</span> &#123;redirectUrl = buildRedirectUrlToLoginPage(request, response, authException);&#125;redirectStrategy.sendRedirect(request, response, redirectUrl);&#125;</code></pre></div><p>é¦–å…ˆæˆ‘ä»¬ä»è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å†³å®šåˆ°åº•æ˜¯è¦é‡å®šå‘è¿˜æ˜¯è¦ forwardï¼Œé€šè¿‡ Debug è¿½è¸ªï¼Œæˆ‘ä»¬å‘ç°é»˜è®¤æƒ…å†µä¸‹ useForward çš„å€¼ä¸º falseï¼Œæ‰€ä»¥è¯·æ±‚èµ°è¿›äº†é‡å®šå‘ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è§£å†³é—®é¢˜çš„æ€è·¯å¾ˆç®€å•ï¼Œç›´æ¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è¿”å› JSON å³å¯ï¼Œä¸å†åšé‡å®šå‘æ“ä½œï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;.csrf().disable().exceptionHandling()<span class="hljs-comment">//æ²¡æœ‰è®¤è¯æ—¶ï¼Œåœ¨è¿™é‡Œå¤„ç†ç»“æœï¼Œä¸è¦é‡å®šå‘</span>.authenticationEntryPoint((req, resp, authException) -&gt; &#123;            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);            resp.setStatus(<span class="hljs-number">401</span>);            PrintWriter out = resp.getWriter();            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;è®¿é—®å¤±è´¥!&quot;</span>);            <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;                respBean.setMsg(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);            &#125;            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));            out.flush();            out.close();        &#125;);</code></pre></div><p>åœ¨ Spring Security çš„é…ç½®ä¸­åŠ ä¸Šè‡ªå®šä¹‰çš„ <code>AuthenticationEntryPoint</code> å¤„ç†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ç›´æ¥è¿”å›ç›¸åº”çš„ JSON æç¤ºå³å¯ã€‚è¿™æ ·ï¼Œå¦‚æœç”¨æˆ·å†å»ç›´æ¥è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯ä¹‹åæ‰å¯ä»¥è®¿é—®çš„è¯·æ±‚ï¼Œå°±ä¸ä¼šå‘ç”Ÿé‡å®šå‘æ“ä½œäº†ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥ç»™æµè§ˆå™¨ä¸€ä¸ª JSON æç¤ºï¼Œæµè§ˆå™¨æ”¶åˆ° JSON ä¹‹åï¼Œè¯¥å¹²å˜›å¹²å˜›ã€‚</p><h4 id="æ³¨é”€ç™»å½•"><a href="#æ³¨é”€ç™»å½•" class="headerlink" title="æ³¨é”€ç™»å½•"></a>æ³¨é”€ç™»å½•</h4><p>æ³¨é”€ç™»å½•æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒæŒ‰ç…§å‰é¢çš„é…ç½®ï¼Œæ³¨é”€ç™»å½•ä¹‹åï¼Œç³»ç»Ÿè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿™ä¹Ÿæ˜¯ä¸åˆé€‚çš„ï¼Œå¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œæ³¨é”€ç™»å½•æˆåŠŸåè¿”å› JSON å³å¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        .logout()        .logoutSuccessHandler((req, resp, authentication) -&gt; &#123;         resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);         PrintWriter out = resp.getWriter();         out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸ!&quot;</span>)));         out.flush();         out.close();         &#125;         )         .permitAll()&#125;</code></pre></div><h4 id="LoginFilterçš„é…ç½®"><a href="#LoginFilterçš„é…ç½®" class="headerlink" title="LoginFilterçš„é…ç½®"></a>LoginFilterçš„é…ç½®</h4><p>åœ¨è‡ªå®šä¹‰JSONè¿‡æ»¤å™¨åï¼ŒLoginFilterä¹Ÿéœ€è¦ç›¸åº”çš„é…ç½®åˆ°å®‰å…¨é…ç½®ç±»ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;...loginFilter.setAuthenticationManager(authenticationManagerBean());loginFilter.setFilterProcessesUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>);&#125;</code></pre></div><p>å½“æˆ‘ä»¬ä»£æ›¿äº† <code>UsernamePasswordAuthenticationFilter</code> ä¹‹åï¼ŒåŸæœ¬åœ¨ <code>SecurityConfig#configure</code>æ–¹æ³•ä¸­å…³äº form è¡¨å•çš„é…ç½®å°±ä¼šå¤±æ•ˆï¼Œé‚£äº›å¤±æ•ˆçš„å±æ€§ï¼Œéƒ½å¯ä»¥åœ¨é…ç½® <code>LoginFilter</code> å®ä¾‹çš„æ—¶å€™é…ç½®ã€‚å¦å¤–è®°å¾—é…ç½®ä¸€ä¸ª <code>AuthenticationManager</code>ï¼Œæ ¹æ® <code>WebSecurityConfigurerAdapter</code> ä¸­æä¾›çš„é…ç½®å³å¯ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809192541708.png" alt="image-20210809192541708"></p><p><code>FilterProcessUrl</code> åˆ™å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé…ç½®ï¼Œå¦‚æœä¸é…ç½®ï¼Œé»˜è®¤çš„å°±æ˜¯ <code>/login</code>ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809192208902.png" alt="image-20210809192208902"></p><p>æœ€åï¼Œæˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„ <code>LoginFilter</code> å®ä¾‹ä»£æ›¿ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œè°ƒç”¨ addFilterAt æ–¹æ³•å®Œæˆæ›¿æ¢æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()        ...        <span class="hljs-comment">//çœç•¥</span>    http.addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class);&#125;</code></pre></div><p><strong>ä¸Šé¢åŸºæœ¬å°±å·²ç»å®ç°äº†åŸºäºRBACçš„ç™»é™†æµç¨‹ï¼Œè¿™é‡Œé™„ä¸Šæ•´ä½“çš„é…ç½®ç±»ä»£ç ï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">** * <span class="hljs-meta">@author</span> lucifer */<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@Autowired</span>    CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;    <span class="hljs-meta">@Autowired</span>    CustomUrlDecisionManager customUrlDecisionManager;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(hrService);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>        web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();        loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    Hr hr = (Hr) authentication.getPrincipal();                    hr.setPassword(<span class="hljs-keyword">null</span>);                    RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!&quot;</span>, hr);                    String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);                    out.write(s);                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    RespBean respBean = RespBean.error(exception.getMessage());                    <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;å¯†ç è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);                    &#125;                    out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationManager(authenticationManagerBean());        loginFilter.setFilterProcessesUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>);        <span class="hljs-keyword">return</span> loginFilter;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;                        object.setAccessDecisionManager(customUrlDecisionManager);                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);                        <span class="hljs-keyword">return</span> object;                    &#125;                &#125;)                .and()                .logout()                .logoutSuccessHandler((req, resp, authentication) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            PrintWriter out = resp.getWriter();                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸ!&quot;</span>)));                            out.flush();                            out.close();                        &#125;                )                .permitAll()                .and()                .csrf().disable().exceptionHandling()                <span class="hljs-comment">//æ²¡æœ‰è®¤è¯æ—¶ï¼Œåœ¨è¿™é‡Œå¤„ç†ç»“æœï¼Œä¸è¦é‡å®šå‘</span>                .authenticationEntryPoint((req, resp, authException) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            resp.setStatus(<span class="hljs-number">401</span>);                            PrintWriter out = resp.getWriter();                            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;è®¿é—®å¤±è´¥!&quot;</span>);                            <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;                                respBean.setMsg(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                            &#125;                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                            out.flush();                            out.close();                        &#125;                );        http.addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class);    &#125;&#125;</code></pre></div><h3 id="http-authorizeRequests"><a href="#http-authorizeRequests" class="headerlink" title="http.authorizeRequests()"></a>http.authorizeRequests()</h3><p>å¯ä»¥å‘ç°åœ¨é…ç½®ä¸­çš„å¼€å¤´æœ‰è¿™æ ·çš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</p><p>è¿™å°±æ¶‰åŠåˆ° Spring Security ä¸­è¿‡æ»¤å™¨é“¾çš„é…ç½®é—®é¢˜äº†</p><blockquote><p>ç»“åˆåŠ¨æ€å¤„ç†è§’è‰²å’Œèµ„æºçš„å…³ç³»ä¸€èµ·çœ‹</p></blockquote><h4 id="ä»è¿‡æ»¤å™¨å¼€å§‹"><a href="#ä»è¿‡æ»¤å™¨å¼€å§‹" class="headerlink" title="ä»è¿‡æ»¤å™¨å¼€å§‹"></a>ä»è¿‡æ»¤å™¨å¼€å§‹</h4><p>Spring Security ä¸­ä¸€å…±æä¾›äº† 32 ä¸ªè¿‡æ»¤å™¨ï¼Œå…¶ä¸­é»˜è®¤ä½¿ç”¨çš„æœ‰ 15 ä¸ªï¼Œ</p><p>åœ¨ä¸€ä¸ª Web é¡¹ç›®ä¸­ï¼Œè¯·æ±‚æµç¨‹å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220745044.png" alt="image-20210809220745044" style="zoom:50%;" /><p>è¯·æ±‚ä»å®¢æˆ·ç«¯å‘èµ·ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰ï¼Œç„¶åç©¿è¿‡å±‚å±‚ Filterï¼Œæœ€ç»ˆæ¥åˆ° Servlet ä¸Šï¼Œè¢« Servlet æ‰€å¤„ç†ã€‚</p><p>é‚£ä¹ˆï¼ŒSpring Security ä¸­é»˜è®¤çš„ 15 ä¸ªè¿‡æ»¤å™¨å°±æ˜¯è¿™æ ·åµŒå¥—åœ¨ Client å’Œ Servlet ä¹‹é—´å—ï¼Ÿ</p><p>ä¸æ˜¯çš„ï¼</p><p>ä¸Šå›¾ä¸­çš„ Filter æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º Web Filterï¼ŒSpring Security ä¸­çš„ Filter æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º Security Filterï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220801972.png" alt="image-20210809220801972"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒSpring Security Filter å¹¶ä¸æ˜¯ç›´æ¥åµŒå…¥åˆ° Web Filter ä¸­çš„ï¼Œè€Œæ˜¯é€šè¿‡ <code>FilterChainProxy</code> æ¥ç»Ÿä¸€ç®¡ç† Spring Security Filterï¼Œ<code>FilterChainProxy</code> æœ¬èº«åˆ™é€šè¿‡ Spring æä¾›çš„ <code>DelegatingFilterProxy </code>ä»£ç†è¿‡æ»¤å™¨åµŒå…¥åˆ° Web Filter ä¹‹ä¸­ã€‚</p><blockquote><p>DelegatingFilterProxy å¾ˆå¤šå°ä¼™ä¼´åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ï¼Œåœ¨ Spring ä¸­æ‰‹å·¥æ•´åˆ Spring Sessionã€Shiro ç­‰å·¥å…·æ—¶éƒ½ç¦»ä¸å¼€å®ƒï¼Œç°åœ¨ç”¨äº† Spring Bootï¼Œå¾ˆå¤šäº‹æƒ… Spring Boot å¸®æˆ‘ä»¬åšäº†ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¼šæ„Ÿè§‰ DelegatingFilterProxy çš„å­˜åœ¨æ„Ÿæœ‰æ‰€é™ä½ï¼Œå®é™…ä¸Šå®ƒä¸€ç›´éƒ½åœ¨ã€‚</p></blockquote><h4 id="å¤šä¸ªè¿‡æ»¤å™¨é“¾"><a href="#å¤šä¸ªè¿‡æ»¤å™¨é“¾" class="headerlink" title="å¤šä¸ªè¿‡æ»¤å™¨é“¾"></a>å¤šä¸ªè¿‡æ»¤å™¨é“¾</h4><p>ä¸Šé¢å’Œå¤§å®¶ä»‹ç»çš„æ˜¯å•ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå®é™…ä¸Šï¼Œåœ¨ Spring Security ä¸­ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾ã€‚</p><p>æœ‰äººä¼šé—®ï¼Œä¸‹é¢è¿™ç§é…ç½®æ˜¯ä¸æ˜¯å°±æ˜¯å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Ÿ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)            .anyRequest().authenticated()            ...            .csrf().disable();&#125;</code></pre></div><p>è¿™æ ·çš„é…ç½®ç›¸ä¿¡å¤§å®¶éƒ½è§è¿‡ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚å› ä¸ºä¸ç®¡æ˜¯ <code>/admin/**</code> è¿˜æ˜¯ <code>/user/**</code> ï¼Œèµ°è¿‡çš„è¿‡æ»¤å™¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä¸åŒçš„è·¯å¾„åˆ¤æ–­æ¡ä»¶ä¸ä¸€æ ·è€Œå·²ã€‚</p><p>å¦‚æœç³»ç»Ÿå­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå¤šä¸ªè¿‡æ»¤å™¨é“¾ä¼šåœ¨ FilterChainProxy ä¸­è¿›è¡Œåˆ’åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220817060.png" alt="image-20210809220817060"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è¯·æ±‚åˆ°è¾¾ <code>FilterChainProxy</code> ä¹‹åï¼Œ<code>FilterChainProxy</code> ä¼šæ ¹æ®è¯·æ±‚çš„è·¯å¾„ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ Spring Security Filters ä¸Šé¢å»ï¼Œä¸åŒçš„ Spring Security Filters å¯¹åº”äº†ä¸åŒçš„è¿‡æ»¤å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„è¯·æ±‚å°†ç»è¿‡ä¸åŒçš„è¿‡æ»¤å™¨ã€‚</p><h4 id="å›åˆ°é—®é¢˜"><a href="#å›åˆ°é—®é¢˜" class="headerlink" title="å›åˆ°é—®é¢˜"></a>å›åˆ°é—®é¢˜</h4><p>æœ€åï¼Œæˆ‘ä»¬åœ¨å›åˆ°ä¸€å¼€å§‹çš„é—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œ<code>http.authorizeRequests()</code> é…ç½®å¹¶éæ€»åœ¨ç¬¬ä¸€è¡Œå‡ºç°ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œä»–æ€»æ˜¯åœ¨ç¬¬ä¸€è¡Œå‡ºç°ï¼Œè¡¨ç¤ºè¯¥è¿‡æ»¤å™¨é“¾çš„æ‹¦æˆªè§„åˆ™æ˜¯ <code>/**</code>ï¼ˆ<strong>è¯·æ±‚åªæœ‰å…ˆè¢«è¿‡æ»¤å™¨é“¾æ‹¦æˆªä¸‹æ¥ï¼Œæ¥ä¸‹æ¥æ‰ä¼šè¿›å…¥åˆ°ä¸åŒçš„ Security Filters ä¸­è¿›è¡Œå¤„ç†</strong>ï¼‰ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå°±ä¸ä¸€å®šäº†ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java">    <span class="hljs-meta">@Configuration</span>    <span class="hljs-meta">@Order(1)</span>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;            http.antMatcher(<span class="hljs-string">&quot;/foo/**&quot;</span>)                    .authorizeRequests()                    .anyRequest().hasRole(<span class="hljs-string">&quot;admin&quot;</span>)                    .and()                    .csrf().disable();        &#125;    &#125;    <span class="hljs-meta">@Configuration</span>    <span class="hljs-meta">@Order(2)</span>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultWebSecurityConfig2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;            http.antMatcher(<span class="hljs-string">&quot;/bar/**&quot;</span>)                    .authorizeRequests()                    .anyRequest().hasRole(<span class="hljs-string">&quot;user&quot;</span>)                    .and()                    .formLogin()                    .permitAll()                    .and()                    .csrf().disable();        &#125;    &#125;&#125;</code></pre></div><ol><li>æ³¨æ„åœ¨é™æ€å†…éƒ¨ç±»é‡Œè¾¹ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨ <code>http.authorizeRequests()</code> å¼€å§‹ï¼Œ<code>http.authorizeRequests()</code> é…ç½®è¡¨ç¤ºè¯¥è¿‡æ»¤å™¨é“¾è¿‡æ»¤çš„è·¯å¾„æ˜¯ <code>/**</code>ã€‚åœ¨é™æ€å†…éƒ¨ç±»é‡Œè¾¹ï¼Œæˆ‘æ˜¯ç”¨äº† <code>http.antMatcher(&quot;/bar/**&quot;)</code> å¼€å¯é…ç½®ï¼Œè¡¨ç¤ºå°†å½“å‰è¿‡æ»¤å™¨é“¾çš„æ‹¦æˆªèŒƒå›´é™å®šåœ¨ <code>/bar/**</code>ã€‚</li><li>å½“å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾çš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šæœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾çš„é…ç½®ç±»ä¸Šé€šè¿‡ @Order(2) æ³¨è§£æ¥æ ‡è®°ä¼˜å…ˆçº§ã€‚</li></ol><p>ä»…ä»…ä»å­—é¢æ„æ€æ¥ç†è§£ï¼Œ<code>authorizeRequests()</code> æ–¹æ³•çš„è¿”å›å€¼æ˜¯ <code>ExpressionUrlAuthorizationConfigurer.ExpressionInterceptUrlRegistryï¼ŒExpressionUrlAuthorizationConfigurer</code> å¯ä»¥ä¸ºå¤šç»„ä¸åŒçš„ RequestMatcher é…ç½®ä¸åŒçš„æƒé™è§„åˆ™ï¼Œå°±æ˜¯å¤§å®¶çœ‹åˆ°çš„ <code>.antMatchers(&quot;/admin/**&quot;).hasRole(&quot;admin&quot;).antMatchers(&quot;/user/**&quot;).hasRole(&quot;user&quot;)</code>ã€‚</p><p><strong>å¯¹äºé…ç½®ä¸­çš„ä¸€äº›ç»†èŠ‚ï¼ˆä¸ºä»€ä¹ˆè¦ç”¨è¿™äº›æ¥å®ç°ï¼‰ï¼Œå°†åœ¨ä¸‹é¢ç”¨æºç æ¥è¿›è¡Œåˆ†æï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº†è§£ä¸‹</strong></p><h2 id="ğŸ”§åŠ é¤ï¼šæºç å‰–æSpring-Security"><a href="#ğŸ”§åŠ é¤ï¼šæºç å‰–æSpring-Security" class="headerlink" title="ğŸ”§åŠ é¤ï¼šæºç å‰–æSpring Security"></a>ğŸ”§åŠ é¤ï¼šæºç å‰–æSpring Security</h2><blockquote><p>æœ¬æ–‡åŸºæœ¬ä¸Šå‚è€ƒæ¬è¿äº†æ¾å“¥çš„æ–‡ç« ï¼Œæ¾å“¥å¯¹Spring Securityç†è§£çš„ååˆ†é€å½»ï¼Œæ¨èå»å­¦ä¹ ï¼Œé™„ä¸Šç½‘ç«™ï¼š<a href="http://www.javaboy.org/">http://www.javaboy.org</a></p></blockquote><p>æœ¬éƒ¨åˆ†ä¸»è¦é’ˆå¯¹<code>HttpSecurityã€SecurityConfigurerã€AuthenticationManagerBuilderã€WebSecurityConfigurerAdapter</code>å››éƒ¨åˆ†è¿›è¡Œæºç åˆ†æï¼Œå…¶ä»–å…³é”®çš„ç±»å·²åœ¨å‰é¢çš„éƒ¨åˆ†åšäº†å¿…è¦çš„é˜è¿°</p><h3 id="ğŸ‘€HttpSecurity"><a href="#ğŸ‘€HttpSecurity" class="headerlink" title="ğŸ‘€HttpSecurity"></a>ğŸ‘€HttpSecurity</h3><blockquote><p>æ­¤èŠ‚å»ºè®®ç»“åˆç™»é™†çš„éªŒè¯ä¸­çš„é…ç½®ç±»æ¥çœ‹</p></blockquote><p><code>HttpSecurity</code> ä¹Ÿæ˜¯ Spring Security ä¸­çš„é‡è¦ä¸€ç¯ã€‚æˆ‘ä»¬å¹³æ—¶æ‰€åšçš„å¤§éƒ¨åˆ† Spring Security é…ç½®ä¹Ÿéƒ½æ˜¯åŸºäº <code>HttpSecurity </code>æ¥é…ç½®çš„ã€‚æ¯”å¦‚ï¼Œåˆšæ‰æˆ‘ä»¬é…ç½®ç±»ä¸­çš„<code>configure</code>å°±ä½¿ç”¨åˆ°äº†</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception</span></code></pre></div><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ HttpSecurity çš„ç»§æ‰¿å…³ç³»å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809220933162.png" alt="image-20210809220933162"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>HttpSecurity</code> ç»§æ‰¿è‡ª <code>AbstractConfiguredSecurityBuilder</code>ï¼ŒåŒæ—¶å®ç°äº† <code>SecurityBuilder </code>å’Œ <code>HttpSecurityBuilder</code> ä¸¤ä¸ªæ¥å£ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ <code>HttpSecurity</code> çš„å®šä¹‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpSecurity</span> <span class="hljs-keyword">extends</span></span><span class="hljs-class">  <span class="hljs-title">AbstractConfiguredSecurityBuilder</span>&lt;<span class="hljs-title">DefaultSecurityFilterChain</span>, <span class="hljs-title">HttpSecurity</span>&gt;</span><span class="hljs-class">  <span class="hljs-keyword">implements</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">DefaultSecurityFilterChain</span>&gt;,</span><span class="hljs-class">  <span class="hljs-title">HttpSecurityBuilder</span>&lt;<span class="hljs-title">HttpSecurity</span>&gt; </span>&#123;        <span class="hljs-comment">//...</span>&#125;</code></pre></div><p>è¿™é‡Œæ¯ä¸€ä¸ªç±»éƒ½å¸¦æœ‰æ³›å‹ï¼Œçœ‹å¾—äººæœ‰ç‚¹çœ¼èŠ±ç¼­ä¹±ã€‚</p><p>æˆ‘æŠŠè¿™ä¸ªæ³›å‹ç±»æ‹¿å‡ºæ¥å’Œå¤§å®¶è®²ä¸€ä¸‹ï¼Œå°ä¼™ä¼´ä»¬å°±æ˜ç™½äº†ã€‚</p><p>æ³›å‹ä¸»è¦æ˜¯ä¸¤ä¸ªï¼Œ<code>DefaultSecurityFilterChain</code> å’Œ <code>HttpSecurity</code>ï¼Œ<code>HttpSecurity</code> å°±ä¸ç”¨è¯´äº†ï¼Œè¿™æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ï¼Œé‚£ä¹ˆ <code>DefaultSecurityFilterChain</code> æ˜¯å¹²å˜›çš„ï¼Ÿ</p><p>è¿™æˆ‘ä»¬å°±å¾—ä» <code>SecurityFilterChain</code> è¯´èµ·äº†ã€‚</p><h4 id="SecurityFilterChain"><a href="#SecurityFilterChain" class="headerlink" title="SecurityFilterChain"></a>SecurityFilterChain</h4><p>å…ˆæ¥çœ‹å®šä¹‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SecurityFilterChain</span> </span>&#123; <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">matches</span><span class="hljs-params">(HttpServletRequest request)</span></span>; <span class="hljs-function">List&lt;Filter&gt; <span class="hljs-title">getFilters</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p><code>SecurityFilterChain</code> å…¶å®å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„ Spring Security ä¸­çš„è¿‡æ»¤å™¨é“¾ï¼Œå®ƒé‡Œè¾¹å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ matches æ–¹æ³•ç”¨æ¥åŒ¹é…è¯·æ±‚ï¼Œå¦å¤–ä¸€ä¸ª getFilters æ–¹æ³•è¿”å›ä¸€ä¸ª List é›†åˆï¼Œé›†åˆä¸­æ”¾ç€ Filter å¯¹è±¡ï¼Œå½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œç”¨ matches æ–¹æ³•å»æ¯”è¾ƒè¯·æ±‚æ˜¯å¦å’Œå½“å‰é“¾å»åˆï¼Œå¦‚æœå»åˆï¼Œå°±è¿”å› getFilters æ–¹æ³•ä¸­çš„è¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆå½“å‰è¯·æ±‚ä¼šé€ä¸ªç»è¿‡ List é›†åˆä¸­çš„è¿‡æ»¤å™¨ã€‚</p><p><code>SecurityFilterChain </code>æ¥å£åªæœ‰ä¸€ä¸ªå®ç°ç±»ï¼Œé‚£å°±æ˜¯ <code>DefaultSecurityFilterChain</code>ï¼Œ<strong>é‚£ä¹ˆä»ä¸Šé¢çš„ä»‹ç»ä¸­ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œ<code>DefaultSecurityFilterChain</code> å…¶å®å°±ç›¸å½“äºæ˜¯ Spring Security ä¸­çš„è¿‡æ»¤å™¨é“¾ï¼Œä¸€ä¸ª <code>DefaultSecurityFilterChain</code> ä»£è¡¨ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå¦‚æœç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Œåˆ™ä¼šå­˜åœ¨å¤šä¸ª <code>DefaultSecurityFilterChain</code> å¯¹è±¡ã€‚</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠ <code>HttpSecurity</code> çš„è¿™å‡ ä¸ªçˆ¶ç±»æ‹ä¸€æ‹ã€‚</p><h4 id="âš ï¸SecurityBuilder"><a href="#âš ï¸SecurityBuilder" class="headerlink" title="âš ï¸SecurityBuilder"></a>âš ï¸SecurityBuilder</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">O</span>&gt; </span>&#123; <span class="hljs-function">O <span class="hljs-title">build</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;&#125;</code></pre></div><p><code>SecurityBuilder </code>å°±æ˜¯ç”¨æ¥æ„å»ºè¿‡æ»¤å™¨é“¾çš„ï¼Œåœ¨ <code>HttpSecurity</code> å®ç° <code>SecurityBuilder</code> æ—¶ï¼Œä¼ å…¥çš„æ³›å‹å°±æ˜¯ <code>DefaultSecurityFilterChain</code>ï¼Œæ‰€ä»¥ <code>SecurityBuilder#build</code> æ–¹æ³•çš„åŠŸèƒ½å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯ç”¨æ¥æ„å»ºä¸€ä¸ªè¿‡æ»¤å™¨é“¾å‡ºæ¥ã€‚</p><h4 id="HttpSecurityBuilder"><a href="#HttpSecurityBuilder" class="headerlink" title="HttpSecurityBuilder"></a>HttpSecurityBuilder</h4><p><code>HttpSecurityBuilder</code> çœ‹åå­—å°±æ˜¯ç”¨æ¥æ„å»º <code>HttpSecurity</code> çš„ã€‚ä¸è¿‡å®ƒä¹Ÿåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„å®ç°åœ¨ <code>HttpSecurity </code>ä¸­ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HttpSecurityBuilder</span>&lt;<span class="hljs-title">H</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpSecurityBuilder</span>&lt;<span class="hljs-title">H</span>&gt;&gt; <span class="hljs-keyword">extends</span></span><span class="hljs-class">  <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">DefaultSecurityFilterChain</span>&gt; </span>&#123; &lt;C extends SecurityConfigurer&lt;DefaultSecurityFilterChain, H&gt;&gt; <span class="hljs-function">C <span class="hljs-title">getConfigurer</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">   Class&lt;C&gt; clazz)</span></span>; &lt;C extends SecurityConfigurer&lt;DefaultSecurityFilterChain, H&gt;&gt; <span class="hljs-function">C <span class="hljs-title">removeConfigurer</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">   Class&lt;C&gt; clazz)</span></span>; &lt;C&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setSharedObject</span><span class="hljs-params">(Class&lt;C&gt; sharedType, C object)</span></span>; &lt;C&gt; <span class="hljs-function">C <span class="hljs-title">getSharedObject</span><span class="hljs-params">(Class&lt;C&gt; sharedType)</span></span>; <span class="hljs-function">H <span class="hljs-title">authenticationProvider</span><span class="hljs-params">(AuthenticationProvider authenticationProvider)</span></span>; <span class="hljs-function">H <span class="hljs-title">userDetailsService</span><span class="hljs-params">(UserDetailsService userDetailsService)</span> <span class="hljs-keyword">throws</span> Exception</span>; <span class="hljs-function">H <span class="hljs-title">addFilterAfter</span><span class="hljs-params">(Filter filter, Class&lt;? extends Filter&gt; afterFilter)</span></span>; <span class="hljs-function">H <span class="hljs-title">addFilterBefore</span><span class="hljs-params">(Filter filter, Class&lt;? extends Filter&gt; beforeFilter)</span></span>; <span class="hljs-function">H <span class="hljs-title">addFilter</span><span class="hljs-params">(Filter filter)</span></span>;&#125;</code></pre></div><p>è¿™é‡Œçš„æ–¹æ³•æ¯”è¾ƒç®€å•ï¼š</p><ol><li><code>getConfigurer</code> è·å–ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚Spring Security è¿‡æ»¤å™¨é“¾ä¸­çš„æ‰€æœ‰è¿‡æ»¤å™¨å¯¹è±¡éƒ½æ˜¯ç”± xxxConfigure æ¥è¿›è¡Œé…ç½®çš„ï¼Œè¿™é‡Œå°±æ˜¯è·å–è¿™ä¸ª xxxConfigure å¯¹è±¡ã€‚</li><li><code>removeConfigurer</code> ç§»é™¤ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚</li><li><code>setSharedObject/getSharedObject</code> é…ç½®/è·å–ç”±å¤šä¸ª <code>SecurityConfigurer</code> å…±äº«çš„å¯¹è±¡ã€‚</li><li><code>authenticationProvider</code> æ–¹æ³•è¡¨ç¤ºé…ç½®éªŒè¯å™¨ã€‚</li><li><code>userDetailsService</code> é…ç½®æ•°æ®æºæ¥å£ã€‚</li><li><code>addFilterAfter</code> åœ¨æŸä¸€ä¸ªè¿‡æ»¤å™¨ä¹‹å‰æ·»åŠ è¿‡æ»¤å™¨ã€‚</li><li><code>addFilterBefore</code> åœ¨æŸä¸€ä¸ªè¿‡æ»¤å™¨ä¹‹åæ·»åŠ è¿‡æ»¤å™¨ã€‚</li><li><code>addFilter</code> æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨å¿…é¡»æ˜¯ç°æœ‰è¿‡æ»¤å™¨é“¾ä¸­æŸä¸€ä¸ªè¿‡æ»¤å™¨æˆ–è€…å…¶æ‰©å±•ã€‚</li></ol><p>è¿™ä¾¿æ˜¯ <code>HttpSecurityBuilder</code> ä¸­çš„åŠŸèƒ½ï¼Œè¿™äº›æ¥å£åœ¨<code>HttpSecurity</code>ä¸­éƒ½å°†å¾—åˆ°å®ç°ã€‚</p><h4 id="AbstractSecurityBuilder"><a href="#AbstractSecurityBuilder" class="headerlink" title="AbstractSecurityBuilder"></a>AbstractSecurityBuilder</h4><p><code>AbstractSecurityBuilder </code>ç±»å®ç°äº† <code>SecurityBuilder</code> æ¥å£ï¼Œè¯¥ç±»ä¸­ä¸»è¦åšäº†ä¸€ä»¶äº‹ï¼Œå°±æ˜¯ç¡®ä¿æ•´ä¸ªæ„å»ºåªè¢«æ„å»ºä¸€æ¬¡ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractSecurityBuilder</span>&lt;<span class="hljs-title">O</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">O</span>&gt; </span>&#123; <span class="hljs-keyword">private</span> AtomicBoolean building = <span class="hljs-keyword">new</span> AtomicBoolean(); <span class="hljs-keyword">private</span> O object; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> O <span class="hljs-title">build</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.building.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;   <span class="hljs-keyword">this</span>.object = doBuild();   <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.object;  &#125;  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AlreadyBuiltException(<span class="hljs-string">&quot;This object has already been built&quot;</span>); &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> O <span class="hljs-title">getObject</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.building.get()) &#123;   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;This object has not been built&quot;</span>);  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.object; &#125; <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> O <span class="hljs-title">doBuild</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé‡æ–°å®šä¹‰äº† build æ–¹æ³•ï¼Œå¹¶è®¾ç½® build æ–¹æ³•ä¸º final ç±»å‹ï¼Œæ— æ³•è¢«é‡å†™ï¼Œåœ¨ build æ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>AtomicBoolean</code> å®ç°è¯¥æ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚å…·ä½“çš„æ„å»ºé€»è¾‘åˆ™å®šä¹‰äº†æ–°çš„æŠ½è±¡æ–¹æ³• doBuildï¼Œå°†æ¥åœ¨å®ç°ç±»ä¸­é€šè¿‡ doBuild æ–¹æ³•å®šä¹‰æ„å»ºé€»è¾‘ã€‚</p><h4 id="AbstractConfiguredSecurityBuilder"><a href="#AbstractConfiguredSecurityBuilder" class="headerlink" title="AbstractConfiguredSecurityBuilder"></a>AbstractConfiguredSecurityBuilder</h4><p><code>AbstractSecurityBuilder</code> æ–¹æ³•çš„å®ç°ç±»å°±æ˜¯ <code>AbstractConfiguredSecurityBuilder</code>ã€‚</p><p><code>AbstractConfiguredSecurityBuilder</code> ä¸­æ‰€åšçš„äº‹æƒ…å°±æ¯”è¾ƒå¤šäº†ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ã€‚</p><p>é¦–å…ˆ <code>AbstractConfiguredSecurityBuilder</code> ä¸­å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼Œå°†æ•´ä¸ªæ„å»ºè¿‡ç¨‹åˆ†ä¸º 5 ç§çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ„å»ºè¿‡ç¨‹ç”Ÿå‘½å‘¨æœŸçš„äº”ä¸ªé˜¶æ®µï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">BuildState</span> </span>&#123; UNBUILT(<span class="hljs-number">0</span>), INITIALIZING(<span class="hljs-number">1</span>), CONFIGURING(<span class="hljs-number">2</span>), BUILDING(<span class="hljs-number">3</span>), BUILT(<span class="hljs-number">4</span>); <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> order; BuildState(<span class="hljs-keyword">int</span> order) &#123;  <span class="hljs-keyword">this</span>.order = order; &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isInitializing</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">return</span> INITIALIZING.order == order; &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isConfigured</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">return</span> order &gt;= CONFIGURING.order; &#125;&#125;</code></pre></div><p>äº”ç§çŠ¶æ€åˆ†åˆ«æ˜¯ UNBUILTã€INITIALIZINGã€CONFIGURINGã€BUILDING ä»¥åŠ BUILTã€‚å¦å¤–è¿˜æä¾›äº†ä¸¤ä¸ªåˆ¤æ–­æ–¹æ³•ï¼ŒisInitializing åˆ¤æ–­æ˜¯å¦æ­£åœ¨åˆå§‹åŒ–ï¼ŒisConfigured è¡¨ç¤ºæ˜¯å¦å·²ç»é…ç½®å®Œæ¯•ã€‚</p><p><code>AbstractConfiguredSecurityBuilder</code> ä¸­çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œåœ¨è¿™é‡Œåˆ—å‡ºæ¥ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•å’Œå¤§å®¶åˆ†æï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå°±æ˜¯è¿™ä¸ª add æ–¹æ³•ï¼Œè¿™ç›¸å½“äºæ˜¯åœ¨æ”¶é›†æ‰€æœ‰çš„é…ç½®ç±»ã€‚å°†æ‰€æœ‰çš„ xxxConfigure æ”¶é›†èµ·æ¥å­˜å‚¨åˆ° configurers ä¸­ï¼Œå°†æ¥å†ç»Ÿä¸€åˆå§‹åŒ–å¹¶é…ç½®ï¼Œconfigurers æœ¬èº«æ˜¯ä¸€ä¸ª LinkedHashMap ï¼Œkey æ˜¯é…ç½®ç±»çš„ classï¼Œvalue æ˜¯ä¸€ä¸ªé›†åˆï¼Œé›†åˆé‡Œè¾¹æ”¾ç€ xxxConfigure é…ç½®ç±»ã€‚å½“éœ€è¦å¯¹è¿™äº›é…ç½®ç±»è¿›è¡Œé›†ä¸­é…ç½®çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ getConfigurers æ–¹æ³•è·å–é…ç½®ç±»ï¼Œè¿™ä¸ªè·å–è¿‡ç¨‹å°±æ˜¯æŠŠ LinkedHashMap ä¸­çš„ value æ‹¿å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­è¿”å›ã€‚</li><li>åœ¨ <code>AbstractSecurityBuilder</code> ç±»ä¸­ï¼Œè¿‡æ»¤å™¨çš„æ„å»ºè¢«è½¬ç§»åˆ° doBuild æ–¹æ³•ä¸Šé¢äº†ï¼Œä¸è¿‡åœ¨ <code>AbstractSecurityBuilder</code> ä¸­åªæ˜¯å®šä¹‰äº†æŠ½è±¡çš„ doBuild æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°åœ¨<code>AbstractConfiguredSecurityBuilder</code>ã€‚doBuild æ–¹æ³•å°±æ˜¯ä¸€è¾¹æ›´æ–°çŠ¶æ€ï¼Œè¿›è¡Œè¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><h4 id="å›åˆ°ä¸»é¢˜HttpSecurity"><a href="#å›åˆ°ä¸»é¢˜HttpSecurity" class="headerlink" title="å›åˆ°ä¸»é¢˜HttpSecurity"></a>å›åˆ°ä¸»é¢˜HttpSecurity</h4><p><code>HttpSecurity</code> åšçš„äº‹æƒ…ï¼Œå°±æ˜¯è¿›è¡Œå„ç§å„æ ·çš„ xxxConfigurer é…ç½®ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> CorsConfigurer&lt;HttpSecurity&gt; <span class="hljs-title">cors</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; <span class="hljs-keyword">return</span> getOrApply(<span class="hljs-keyword">new</span> CorsConfigurer&lt;&gt;());&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> CsrfConfigurer&lt;HttpSecurity&gt; <span class="hljs-title">csrf</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; ApplicationContext context = getContext(); <span class="hljs-keyword">return</span> getOrApply(<span class="hljs-keyword">new</span> CsrfConfigurer&lt;&gt;(context));&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> ExceptionHandlingConfigurer&lt;HttpSecurity&gt; <span class="hljs-title">exceptionHandling</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; <span class="hljs-keyword">return</span> getOrApply(<span class="hljs-keyword">new</span> ExceptionHandlingConfigurer&lt;&gt;());&#125;</code></pre></div><p><code>HttpSecurity</code> ä¸­æœ‰å¤§é‡ç±»ä¼¼çš„æ–¹æ³•ï¼Œè¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¸€ä¸ªé…ç½®çš„ã€‚æˆ‘å°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p><p>æ¯ä¸ªé…ç½®æ–¹æ³•çš„ç»“å°¾éƒ½ä¼šæ¥ä¸€å¥ getOrApplyï¼Œè¿™ä¸ªæ˜¯å¹²å˜›çš„ï¼Ÿ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> &lt;C extends SecurityConfigurerAdapter&lt;DefaultSecurityFilterChain, HttpSecurity&gt;&gt; <span class="hljs-function">C <span class="hljs-title">getOrApply</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  C configurer)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; C existingConfig = (C) getConfigurer(configurer.getClass()); <span class="hljs-keyword">if</span> (existingConfig != <span class="hljs-keyword">null</span>) &#123;  <span class="hljs-keyword">return</span> existingConfig; &#125; <span class="hljs-keyword">return</span> apply(configurer);&#125;</code></pre></div><p><code>getConfigurer</code> æ–¹æ³•æ˜¯åœ¨å®ƒçš„çˆ¶ç±» <code>AbstractConfiguredSecurityBuilder</code> ä¸­å®šä¹‰çš„ï¼Œç›®çš„å°±æ˜¯å»æŸ¥çœ‹å½“å‰è¿™ä¸ª xxxConfigurer æ˜¯å¦å·²ç»é…ç½®è¿‡äº†ã€‚</p><p>å¦‚æœå½“å‰ xxxConfigurer å·²ç»é…ç½®è¿‡äº†ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™è°ƒç”¨ apply æ–¹æ³•ï¼Œè¿™ä¸ª apply æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>AbstractConfiguredSecurityBuilder#add</code> æ–¹æ³•ï¼Œå°†å½“å‰é…ç½® configurer æ”¶é›†èµ·æ¥ã€‚</p><p><code>HttpSecurity</code> ä¸­è¿˜æœ‰ä¸€ä¸ª <code>addFilter</code> æ–¹æ³•ï¼ˆä¸Šé¢ä¹Ÿç”¨åˆ°çš„ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> HttpSecurity <span class="hljs-title">addFilter</span><span class="hljs-params">(Filter filter)</span> </span>&#123; Class&lt;? extends Filter&gt; filterClass = filter.getClass(); <span class="hljs-keyword">if</span> (!comparator.isRegistered(filterClass)) &#123;  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(    <span class="hljs-string">&quot;The Filter class &quot;</span>      + filterClass.getName()      + <span class="hljs-string">&quot; does not have a registered order and cannot be added without a specified order. Consider using addFilterBefore or addFilterAfter instead.&quot;</span>); &#125; <span class="hljs-keyword">this</span>.filters.add(filter); <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;&#125;</code></pre></div><p>è¿™ä¸ª <code>addFilter</code> æ–¹æ³•çš„ä½œç”¨ï¼Œä¸»è¦æ˜¯åœ¨å„ä¸ª xxxConfigurer è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œï¼ˆxxxConfigurer å°±æ˜¯ç”¨æ¥é…ç½®è¿‡æ»¤å™¨çš„ï¼‰ï¼ŒæŠŠ Filter éƒ½æ·»åŠ åˆ° fitlers å˜é‡ä¸­ã€‚</p><p>æœ€ç»ˆåœ¨ <code>HttpSecurity</code> çš„ <code>performBuild</code> æ–¹æ³•ä¸­ï¼Œæ„å»ºå‡ºæ¥ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> DefaultSecurityFilterChain <span class="hljs-title">performBuild</span><span class="hljs-params">()</span> </span>&#123; filters.sort(comparator); <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultSecurityFilterChain(requestMatcher, filters);&#125;</code></pre></div><p>å…ˆç»™è¿‡æ»¤å™¨æ’åºï¼Œç„¶åæ„é€  <code>DefaultSecurityFilterChain</code> å¯¹è±¡ã€‚</p><h3 id="ğŸ‘€SecurityConfigurer"><a href="#ğŸ‘€SecurityConfigurer" class="headerlink" title="ğŸ‘€SecurityConfigurer"></a>ğŸ‘€SecurityConfigurer</h3><blockquote><p>æ­¤èŠ‚å»ºè®®ç»“åˆç™»é™†çš„éªŒè¯ä¸­çš„é…ç½®ç±»æ¥çœ‹</p></blockquote><p><code>SecurityConfigurer</code> åœ¨ Spring Security ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è§’è‰²ã€‚Spring Security è¿‡æ»¤å™¨é“¾ä¸­çš„æ¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œéƒ½æ˜¯é€šè¿‡ xxxConfigurer æ¥è¿›è¡Œé…ç½®çš„ï¼ˆä¸Šé¢é…ç½®ç±»ä¸­é‡å†™çš„configureå°±æ˜¯è¿™é‡Œçš„<code>SecurityConfigurer</code>ï¼‰ï¼Œè€Œè¿™äº› xxxConfigurer å®é™…ä¸Šéƒ½æ˜¯ <code>SecurityConfigurer </code>çš„å®ç°ã€‚</p><p><code>SecurityConfigurer</code> æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SecurityConfigurer</span>&lt;<span class="hljs-title">O</span>, <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">O</span>&gt;&gt; </span>&#123; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(B builder)</span> <span class="hljs-keyword">throws</span> Exception</span>; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(B builder)</span> <span class="hljs-keyword">throws</span> Exception</span>;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>SecurityConfigurer</code> ä¸­ä¸»è¦æ˜¯ä¸¤ä¸ªæ–¹æ³•ï¼Œinit å’Œ configureã€‚</p><p>init å°±æ˜¯ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚è€Œ configure åˆ™æ˜¯ä¸€ä¸ªé…ç½®æ–¹æ³•ã€‚è¿™é‡Œåªæ˜¯è§„èŒƒäº†æ–¹æ³•çš„å®šä¹‰ï¼Œå…·ä½“çš„å®ç°åˆ™åœ¨ä¸åŒçš„å®ç°ç±»ä¸­ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹éƒ½æ˜¯ä¸€ä¸ªæ³›å‹ Bï¼Œä¹Ÿå°±æ˜¯ <code>SecurityBuilder</code> çš„å­ç±»ï¼Œå…³äº <code>SecurityBuilder</code> ï¼Œå®ƒæ˜¯ç”¨æ¥æ„å»ºè¿‡æ»¤å™¨é“¾çš„ã€‚</p><p><code>SecurityConfigurer</code> æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼š</p><ul><li><code>SecurityConfigurerAdapter</code></li><li><code>GlobalAuthenticationConfigurerAdapter</code></li><li><code>WebSecurityConfigurer</code></li></ul><h4 id="SecurityConfigurerAdapter"><a href="#SecurityConfigurerAdapter" class="headerlink" title="SecurityConfigurerAdapter"></a>SecurityConfigurerAdapter</h4><p><code>SecurityConfigurerAdapter</code> å®ç°äº† <code>SecurityConfigurer</code> æ¥å£ï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„å¤§éƒ¨åˆ†çš„ xxxConfigurer ä¹Ÿéƒ½æ˜¯ <code>SecurityConfigurerAdapter</code> çš„å­ç±»ã€‚</p><p><code>SecurityConfigurerAdapter</code> åœ¨<code> SecurityConfigurer</code> çš„åŸºç¡€ä¸Šï¼Œè¿˜æ‰©å±•å‡ºæ¥äº†å‡ ä¸ªéå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfigurerAdapter</span>&lt;<span class="hljs-title">O</span>, <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">O</span>&gt;&gt;</span><span class="hljs-class">  <span class="hljs-keyword">implements</span> <span class="hljs-title">SecurityConfigurer</span>&lt;<span class="hljs-title">O</span>, <span class="hljs-title">B</span>&gt; </span>&#123; <span class="hljs-keyword">private</span> B securityBuilder; <span class="hljs-keyword">private</span> CompositeObjectPostProcessor objectPostProcessor = <span class="hljs-keyword">new</span> CompositeObjectPostProcessor(); <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(B builder)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(B builder)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> B <span class="hljs-title">and</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">return</span> getBuilder(); &#125; <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> B <span class="hljs-title">getBuilder</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">if</span> (securityBuilder == <span class="hljs-keyword">null</span>) &#123;   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;securityBuilder cannot be null&quot;</span>);  &#125;  <span class="hljs-keyword">return</span> securityBuilder; &#125; <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">postProcess</span><span class="hljs-params">(T object)</span> </span>&#123;  <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">this</span>.objectPostProcessor.postProcess(object); &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addObjectPostProcessor</span><span class="hljs-params">(ObjectPostProcessor&lt;?&gt; objectPostProcessor)</span> </span>&#123;  <span class="hljs-keyword">this</span>.objectPostProcessor.addObjectPostProcessor(objectPostProcessor); &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBuilder</span><span class="hljs-params">(B builder)</span> </span>&#123;  <span class="hljs-keyword">this</span>.securityBuilder = builder; &#125; <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CompositeObjectPostProcessor</span> <span class="hljs-keyword">implements</span></span><span class="hljs-class">   <span class="hljs-title">ObjectPostProcessor</span>&lt;<span class="hljs-title">Object</span>&gt; </span>&#123;  <span class="hljs-keyword">private</span> List&lt;ObjectPostProcessor&lt;?&gt;&gt; postProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();  <span class="hljs-meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcess</span><span class="hljs-params">(Object object)</span> </span>&#123;   <span class="hljs-keyword">for</span> (ObjectPostProcessor opp : postProcessors) &#123;    Class&lt;?&gt; oppClass = opp.getClass();    Class&lt;?&gt; oppType = GenericTypeResolver.resolveTypeArgument(oppClass,      ObjectPostProcessor.class);    <span class="hljs-keyword">if</span> (oppType == <span class="hljs-keyword">null</span> || oppType.isAssignableFrom(object.getClass())) &#123;     object = opp.postProcess(object);    &#125;   &#125;   <span class="hljs-keyword">return</span> object;  &#125;  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addObjectPostProcessor</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    ObjectPostProcessor&lt;?&gt; objectPostProcessor)</span> </span>&#123;   <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">this</span>.postProcessors.add(objectPostProcessor);   postProcessors.sort(AnnotationAwareOrderComparator.INSTANCE);   <span class="hljs-keyword">return</span> result;  &#125; &#125;&#125;</code></pre></div><ul><li><code>CompositeObjectPostProcessor</code> é¦–å…ˆä¸€å¼€å§‹å£°æ˜äº†ä¸€ä¸ª <code>CompositeObjectPostProcessor</code> å®ä¾‹ï¼Œ<code>CompositeObjectPostProcessor</code> æ˜¯ <code>ObjectPostProcessor</code> çš„ä¸€ä¸ªå®ç°ï¼Œ<code>ObjectPostProcessor</code> æœ¬èº«æ˜¯ä¸€ä¸ªåç½®å¤„ç†å™¨ï¼Œè¯¥åç½®å¤„ç†å™¨é»˜è®¤æœ‰ä¸¤ä¸ªå®ç°ï¼Œ<code>AutowireBeanFactoryObjectPostProcessor</code> å’Œ <code>CompositeObjectPostProcessor</code>:<ul><li>å…¶ä¸­ <code>AutowireBeanFactoryObjectPostProcessor </code>ä¸»è¦æ˜¯åˆ©ç”¨äº† <code>AutowireCapableBeanFactory</code> å¯¹ Bean è¿›è¡Œæ‰‹åŠ¨æ³¨å†Œï¼Œå› ä¸ºåœ¨ Spring Security ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æ‰‹åŠ¨ new å‡ºæ¥çš„ï¼Œè¿™äº› new å‡ºæ¥çš„å¯¹è±¡å’Œå®¹å™¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåˆ©ç”¨ AutowireCapableBeanFactory å¯ä»¥å°†è¿™äº›æ‰‹åŠ¨ new å‡ºæ¥çš„å¯¹è±¡æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œè€Œ <code>AutowireBeanFactoryObjectPostProcessor</code> çš„ä¸»è¦ä½œç”¨å°±æ˜¯å®Œæˆè¿™ä»¶äº‹</li><li><code>CompositeObjectPostProcessor</code> åˆ™æ˜¯ä¸€ä¸ªå¤åˆçš„å¯¹è±¡å¤„ç†å™¨ï¼Œé‡Œè¾¹ç»´æŠ¤äº†ä¸€ä¸ª List é›†åˆï¼Œè¿™ä¸ª List é›†åˆä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹åªå­˜å‚¨ä¸€æ¡æ•°æ®ï¼Œé‚£å°±æ˜¯ <code>AutowireBeanFactoryObjectPostProcessor</code>ï¼Œç”¨æ¥å®Œæˆå¯¹è±¡æ³¨å…¥åˆ°å®¹å™¨çš„æ“ä½œï¼Œå¦‚æœç”¨æˆ·è‡ªå·±æ‰‹åŠ¨è°ƒç”¨äº† <code>addObjectPostProcessor</code> æ–¹æ³•ï¼Œé‚£ä¹ˆ <code>CompositeObjectPostProcessor</code> é›†åˆä¸­ç»´æŠ¤çš„æ•°æ®å°±ä¼šå¤šå‡ºæ¥ä¸€æ¡ï¼Œåœ¨ <code>CompositeObjectPostProcessor#postProcess</code> æ–¹æ³•ä¸­ï¼Œä¼šéå†é›†åˆä¸­çš„æ‰€æœ‰ ObjectPostProcessorï¼ŒæŒ¨ä¸ªè°ƒç”¨å…¶ postProcess æ–¹æ³•å¯¹å¯¹è±¡è¿›è¡Œåç½®å¤„ç†ã€‚</li></ul></li><li>and æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>securityBuilder</code>ï¼Œ<code>securityBuilder</code> å®é™…ä¸Šå°±æ˜¯ <code>HttpSecurity</code>ï¼Œæˆ‘ä»¬åœ¨ <code>HttpSecurity</code> ä¸­å»é…ç½®ä¸åŒçš„è¿‡æ»¤å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ and æ–¹æ³•è¿›è¡Œé“¾å¼é…ç½®ï¼Œå°±æ˜¯å› ä¸ºè¿™é‡Œå®šä¹‰äº† and æ–¹æ³•å¹¶è¿”å›äº† <code>securityBuilder</code> å®ä¾‹ã€‚</li></ul><p>è¿™ä¾¿æ˜¯ <code>SecurityConfigurerAdapter</code> çš„ä¸»è¦åŠŸèƒ½ï¼Œåé¢å¤§éƒ¨åˆ†çš„ xxxConfigurer éƒ½æ˜¯åŸºäºæ­¤ç±»æ¥å®ç°çš„ã€‚</p><p><code>SecurityConfigurerAdapter</code> çš„å®ç°ä¸»è¦ä¹Ÿæ˜¯ä¸‰å¤§ç±»ï¼š</p><ul><li><code>UserDetailsAwareConfigurer</code></li><li><code>AbstractHttpConfigurer</code></li><li><code>LdapAuthenticationProviderConfigurer</code></li></ul><p>è€ƒè™‘åˆ° LDAP ç°åœ¨ä½¿ç”¨å¾ˆå°‘ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æ¥å’Œå¤§å®¶é‡ç‚¹ä»‹ç»ä¸‹å‰ä¸¤ä¸ªã€‚</p><h5 id="UserDetailsAwareConfigurer"><a href="#UserDetailsAwareConfigurer" class="headerlink" title="UserDetailsAwareConfigurer"></a>UserDetailsAwareConfigurer</h5><p>è¿™ä¸ªé…ç½®ç±»çœ‹åå­—å¤§æ¦‚å°±çŸ¥é“è¿™æ˜¯ç”¨æ¥é…ç½®ç”¨æˆ·ç±»çš„ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809221022916.png" alt="image-20210809221022916"></p><blockquote><p><strong>AbstractDaoAuthenticationConfigurer</strong></p><p>AbstractDaoAuthenticationConfigurer ä¸­æ‰€åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯æ„é€ äº†ä¸€ä¸ªé»˜è®¤çš„ DaoAuthenticationProviderï¼Œå¹¶ä¸ºå…¶é…ç½® PasswordEncoder å’Œ UserDetailsServiceã€‚</p><p><strong>UserDetailsServiceConfigurer</strong></p><p>UserDetailsServiceConfigurer é‡å†™äº† AbstractDaoAuthenticationConfigurer ä¸­çš„ configure æ–¹æ³•ï¼Œåœ¨ configure æ–¹æ³•æ‰§è¡Œä¹‹å‰åŠ å…¥äº† initUserDetailsService æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿å¼€å‘å±•æŒ‰ç…§è‡ªå·±çš„æ–¹å¼å»åˆå§‹åŒ– UserDetailsServiceã€‚ä¸è¿‡è¿™é‡Œçš„ initUserDetailsService æ–¹æ³•æ˜¯ç©ºæ–¹æ³•ã€‚</p><p><strong>UserDetailsManagerConfigurer</strong></p><p>UserDetailsManagerConfigurer ä¸­å®ç°äº† UserDetailsServiceConfigurer ä¸­å®šä¹‰çš„ initUserDetailsService æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°é€»è¾‘å°±æ˜¯å°† UserDetailsBuilder æ‰€æ„å»ºå‡ºæ¥çš„ UserDetails ä»¥åŠæå‰å‡†å¤‡å¥½çš„ UserDetails ä¸­çš„ç”¨æˆ·å­˜å‚¨åˆ° UserDetailsService ä¸­ã€‚</p><p>è¯¥ç±»åŒæ—¶æ·»åŠ äº† withUser æ–¹æ³•ç”¨æ¥æ·»åŠ ç”¨æˆ·ï¼ŒåŒæ—¶è¿˜å¢åŠ äº†ä¸€ä¸ª UserDetailsBuilder ç”¨æ¥æ„å»ºç”¨æˆ·ï¼Œè¿™äº›é€»è¾‘éƒ½æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><p><strong>JdbcUserDetailsManagerConfigurer</strong></p><p>JdbcUserDetailsManagerConfigurer åœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šè¡¥å……äº† DataSource å¯¹è±¡ï¼ŒåŒæ—¶è¿˜æä¾›äº†ç›¸åº”çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•ã€‚</p><p><strong>InMemoryUserDetailsManagerConfigurer</strong></p><p>InMemoryUserDetailsManagerConfigurer åœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šé‡å†™äº†æ„é€ æ–¹æ³•ï¼Œå°†çˆ¶ç±»ä¸­çš„ UserDetailsService å®ä¾‹å®šä¹‰ä¸º InMemoryUserDetailsManagerã€‚</p><p><strong>DaoAuthenticationConfigurer</strong></p><p>DaoAuthenticationConfigurer ç»§æ‰¿è‡ª AbstractDaoAuthenticationConfigurerï¼Œåªæ˜¯åœ¨æ„é€ æ–¹æ³•ä¸­ä¿®æ”¹äº†ä¸€ä¸‹ userDetailsService è€Œå·²ã€‚</p></blockquote><h5 id="âš ï¸AbstractHttpConfigurer"><a href="#âš ï¸AbstractHttpConfigurer" class="headerlink" title="âš ï¸AbstractHttpConfigurer"></a>âš ï¸AbstractHttpConfigurer</h5><p><code>AbstractHttpConfigurer </code>è¿™ä¸€æ´¾ä¸­çš„ä¸œè¥¿éå¸¸å¤šï¼Œæˆ‘ä»¬æ‰€æœ‰çš„è¿‡æ»¤å™¨é…ç½®ï¼Œéƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹éƒ½æœ‰å“ªäº›ç±»ï¼Ÿ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809221037144.png" alt="image-20210809221037144"></p><p><code>AbstractHttpConfigurer</code> ç»§æ‰¿è‡ª <code>SecurityConfigurerAdapter</code>ï¼Œå¹¶å¢åŠ äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œdisable å’Œ withObjectPostProcessorï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractHttpConfigurer</span>&lt;<span class="hljs-title">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractHttpConfigurer</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">B</span>&gt;, <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpSecurityBuilder</span>&lt;<span class="hljs-title">B</span>&gt;&gt;</span><span class="hljs-class">  <span class="hljs-keyword">extends</span> <span class="hljs-title">SecurityConfigurerAdapter</span>&lt;<span class="hljs-title">DefaultSecurityFilterChain</span>, <span class="hljs-title">B</span>&gt; </span>&#123; <span class="hljs-comment">/**</span><span class="hljs-comment">  * Disables the &#123;<span class="hljs-doctag">@link</span> AbstractHttpConfigurer&#125; by removing it. After doing so a fresh</span><span class="hljs-comment">  * version of the configuration can be applied.</span><span class="hljs-comment">  *</span><span class="hljs-comment">  * <span class="hljs-doctag">@return</span> the &#123;<span class="hljs-doctag">@link</span> HttpSecurityBuilder&#125; for additional customizations</span><span class="hljs-comment">  */</span> <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="hljs-function"><span class="hljs-keyword">public</span> B <span class="hljs-title">disable</span><span class="hljs-params">()</span> </span>&#123;  getBuilder().removeConfigurer(getClass());  <span class="hljs-keyword">return</span> getBuilder(); &#125; <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">withObjectPostProcessor</span><span class="hljs-params">(ObjectPostProcessor&lt;?&gt; objectPostProcessor)</span> </span>&#123;  addObjectPostProcessor(objectPostProcessor);  <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">this</span>; &#125;&#125;</code></pre></div><p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹å‰éƒ½æœ‰ç»™å¤§å®¶ä»‹ç»è¿‡ï¼Œdisable åŸºæœ¬ä¸Šæ˜¯å¤§å®¶çš„è€ç†Ÿäººäº†ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ <code>.csrf().disable()</code> å°±æ˜¯å‡ºè‡ªè¿™é‡Œï¼Œé‚£ä¹ˆä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° disable çš„å®ç°åŸç†ï¼Œå°±æ˜¯ä» getBuilder ä¸­ç§»é™¤ç›¸å…³çš„ xxxConfigurerï¼ŒgetBuilder æ–¹æ³•è·å–åˆ°çš„å®é™…ä¸Šå°±æ˜¯ HttpSecurityï¼Œæ‰€ä»¥ç§»é™¤æ‰ xxxConfigurer å®é™…ä¸Šå°±æ˜¯ä»è¿‡æ»¤å™¨é“¾ä¸­ç§»é™¤æ‰æŸä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ <code>.csrf().disable()</code> å°±æ˜¯ç§»é™¤æ‰å¤„ç† csrf çš„è¿‡æ»¤å™¨ã€‚</p><p>å¦ä¸€ä¸ªå¢åŠ çš„æ–¹æ³•æ˜¯ <code>withObjectPostProcessor</code>ï¼Œè¿™æ˜¯ä¸ºé…ç½®ç±»æ·»åŠ æ‰‹åŠ¨æ·»åŠ åç½®å¤„ç†å™¨çš„ã€‚åœ¨ <code>AbstractHttpConfigurer</code> çš„çˆ¶ç±»ä¸­å…¶å®æœ‰ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•å°±æ˜¯ <code>addObjectPostProcessor</code>ï¼Œä½†æ˜¯ <code>addObjectPostProcessor</code> åªæ˜¯ä¸€ä¸ªæ·»åŠ æ–¹æ³•ï¼Œè¿”å›å€¼ä¸º voidï¼Œè€Œ withObjectPostProcessor çš„è¿”å›å€¼æ˜¯å½“å‰é…ç½®ç±»ï¼Œä¹Ÿå°±æ˜¯ xxxConfigurerï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ withObjectPostProcessor çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨é“¾å¼é…ç½®ï¼Œäº‹å®ä¸Šï¼Œä¸Šé¢çš„é¡¹ç›®é…ç½®ä½¿ç”¨çš„ä¹Ÿéƒ½æ˜¯ <code>withObjectPostProcessor</code> æ–¹æ³•ï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ addObjectPostProcessorï¼Œæœ€ç»ˆæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p><h5 id="âš ï¸AbstractAuthenticationFilterConfigurer"><a href="#âš ï¸AbstractAuthenticationFilterConfigurer" class="headerlink" title="âš ï¸AbstractAuthenticationFilterConfigurer"></a>âš ï¸AbstractAuthenticationFilterConfigurer</h5><p><code>AbstractAuthenticationFilterConfigurer</code> ç±»çš„åŠŸèƒ½æ¯”è¾ƒå¤šï¼Œæºç ä¹Ÿæ˜¯ç›¸å½“ç›¸å½“é•¿ã€‚ä¸è¿‡æˆ‘ä»¬åªéœ€è¦æŠ“ä½ä¸¤ç‚¹å³å¯ï¼Œ<strong>init æ–¹æ³•å’Œ configure æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ‰€æœ‰ xxxConfigurer çš„çµé­‚ã€‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(B http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; updateAuthenticationDefaults(); updateAccessDefaults(http); registerDefaultAuthenticationEntryPoint(http);&#125;</code></pre></div><p>init æ–¹æ³•ä¸»è¦å¹²äº†ä¸‰ä»¶äº‹ï¼š</p><ol><li><code>updateAuthenticationDefaults</code> ä¸»è¦æ˜¯é…ç½®äº†ç™»å½•å¤„ç†åœ°å€ï¼Œå¤±è´¥è·³è½¬åœ°å€ï¼Œæ³¨é”€æˆåŠŸè·³è½¬åœ°å€ã€‚</li><li><code>updateAccessDefaults</code> æ–¹æ³•ä¸»è¦æ˜¯å¯¹ loginPageã€loginProcessingUrlã€failureUrl è¿›è¡Œ permitAll è®¾ç½®ï¼ˆå¦‚æœç”¨æˆ·é…ç½®äº† permitAll çš„è¯ï¼‰ã€‚</li><li><code>registerDefaultAuthenticationEntryPoint</code> åˆ™æ˜¯æ³¨å†Œå¼‚å¸¸çš„å¤„ç†å™¨ã€‚</li></ol><p>å†æ¥çœ‹ configure æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(B http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; PortMapper portMapper = http.getSharedObject(PortMapper.class); <span class="hljs-keyword">if</span> (portMapper != <span class="hljs-keyword">null</span>) &#123;  authenticationEntryPoint.setPortMapper(portMapper); &#125; RequestCache requestCache = http.getSharedObject(RequestCache.class); <span class="hljs-keyword">if</span> (requestCache != <span class="hljs-keyword">null</span>) &#123;  <span class="hljs-keyword">this</span>.defaultSuccessHandler.setRequestCache(requestCache); &#125; authFilter.setAuthenticationManager(http   .getSharedObject(AuthenticationManager.class)); authFilter.setAuthenticationSuccessHandler(successHandler); authFilter.setAuthenticationFailureHandler(failureHandler); <span class="hljs-keyword">if</span> (authenticationDetailsSource != <span class="hljs-keyword">null</span>) &#123;  authFilter.setAuthenticationDetailsSource(authenticationDetailsSource); &#125; SessionAuthenticationStrategy sessionAuthenticationStrategy = http   .getSharedObject(SessionAuthenticationStrategy.class); <span class="hljs-keyword">if</span> (sessionAuthenticationStrategy != <span class="hljs-keyword">null</span>) &#123;  authFilter.setSessionAuthenticationStrategy(sessionAuthenticationStrategy); &#125; RememberMeServices rememberMeServices = http   .getSharedObject(RememberMeServices.class); <span class="hljs-keyword">if</span> (rememberMeServices != <span class="hljs-keyword">null</span>) &#123;  authFilter.setRememberMeServices(rememberMeServices); &#125; F filter = postProcess(authFilter); http.addFilter(filter);&#125;</code></pre></div><p>configure ä¸­çš„é€»è¾‘å°±å¾ˆç®€ç­”äº†ï¼Œæ„å»ºå„ç§å„æ ·çš„å›è°ƒå‡½æ•°è®¾ç½®ç»™ authFilterï¼ŒauthFilter å†å» postProcess ä¸­èµ°ä¸€åœˆæ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ï¼Œæœ€åå†æŠŠ authFilter æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ã€‚</p><p>è¿™ä¾¿æ˜¯ <code>AbstractAuthenticationFilterConfigurer</code> çš„ä¸»è¦åŠŸèƒ½ã€‚éœ€è¦æé†’å¤§å®¶çš„æ˜¯ï¼Œæˆ‘ä»¬æ—¥å¸¸é…ç½®çš„ï¼Œå¦‚ï¼š</p><ul><li>loginPage</li><li>loginProcessingUrl</li><li>permitAll</li><li>defaultSuccessUrl</li><li>failureUrl</li></ul><p>ç­‰æ–¹æ³•éƒ½æ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„ã€‚</p><h5 id="âš ï¸FormLoginConfigurer"><a href="#âš ï¸FormLoginConfigurer" class="headerlink" title="âš ï¸FormLoginConfigurer"></a>âš ï¸FormLoginConfigurer</h5><p><code>FormLoginConfigurer</code> åœ¨å®šä¹‰æ˜¯ï¼Œæ˜ç¡®äº†<code> AbstractAuthenticationFilterConfigurer</code> ä¸­çš„æ³›å‹æ˜¯ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œæœ€ç»ˆè¦é…ç½®çš„è¿‡æ»¤æ˜¯ <code>UsernamePasswordAuthenticationFilter</code></p><p>FormLoginConfigurer é‡å†™äº† init æ–¹æ³•ï¼Œé…ç½®äº†ä¸€ä¸‹é»˜è®¤çš„ç™»å½•é¡µé¢ã€‚å…¶ä»–çš„åŸºæœ¬ä¸Šéƒ½æ˜¯ä»çˆ¶ç±»æ¥çš„ï¼Œæœªåšå¤ªå¤šæ”¹å˜ã€‚</p><p>å¦å¤–æˆ‘ä»¬æ—¥å¸¸é…ç½®çš„å¾ˆå¤šä¸œè¥¿ä¹Ÿæ˜¯æ¥è‡ªè¿™é‡Œï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809221049974.png" alt="image-20210809221049974"></p><p>è¿™å°±æ˜¯ <code>FormLoginConfigurer</code> è¿™ä¸ªé…ç½®ç±»ï¼Œ<code>FormLoginConfigurer</code> å¯¹åº”çš„è¿‡æ»¤å™¨æ˜¯ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œå¯ä»¥è‡ªè¡Œåˆ†æå…¶ä»–çš„ xxxConfigurerï¼Œæ¯ä¸€ä¸ª xxxConfigurer éƒ½å¯¹åº”äº†ä¸€ä¸ª ä¸åŒçš„ Filterã€‚</p><h4 id="GlobalAuthenticationConfigurerAdapter"><a href="#GlobalAuthenticationConfigurerAdapter" class="headerlink" title="GlobalAuthenticationConfigurerAdapter"></a>GlobalAuthenticationConfigurerAdapter</h4><p><code>GlobalAuthenticationConfigurerAdapter</code> çœ‹åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªè·Ÿå…¨å±€é…ç½®æœ‰å…³çš„ä¸œè¥¿ï¼Œå®ƒæœ¬èº«å®ç°äº† <code>SecurityConfigurerAdapter</code> æ¥å£ï¼Œä½†æ˜¯å¹¶æœªå¯¹æ–¹æ³•åšå…·ä½“çš„å®ç°ï¼Œåªæ˜¯å°†æ³›å‹å…·ä½“åŒ–äº†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Order(100)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalAuthenticationConfigurerAdapter</span> <span class="hljs-keyword">implements</span></span><span class="hljs-class">  <span class="hljs-title">SecurityConfigurer</span>&lt;<span class="hljs-title">AuthenticationManager</span>, <span class="hljs-title">AuthenticationManagerBuilder</span>&gt; </span>&#123; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; &#125; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; &#125;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>SecurityConfigurer</code> ä¸­çš„æ³›å‹ï¼Œç°åœ¨æ˜ç¡®æˆäº† <code>AuthenticationManager</code> å’Œ <code>AuthenticationManagerBuilder</code>ã€‚æ‰€ä»¥ <code>GlobalAuthenticationConfigurerAdapter</code> çš„å®ç°ç±»å°†æ¥ä¸»è¦æ˜¯å’Œé…ç½® <code>AuthenticationManager</code> æœ‰å…³ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬é»˜è®¤çš„ç”¨æˆ·åå¯†ç ä¹Ÿæ˜¯ç”±å®ƒçš„å®ç°ç±»æ¥è¿›è¡Œé…ç½®çš„ã€‚</p><p><strong>æˆ‘ä»¬åœ¨ Spring Security ä¸­ä½¿ç”¨çš„ <code>AuthenticationManager</code> å…¶å®å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å±€éƒ¨çš„ï¼Œå¦ä¸€ç§æ˜¯å…¨å±€çš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯å…¨å±€çš„é…ç½®ã€‚</strong></p><h4 id="WebSecurityConfigurer"><a href="#WebSecurityConfigurer" class="headerlink" title="WebSecurityConfigurer"></a>WebSecurityConfigurer</h4><p>è¿˜æœ‰ä¸€ä¸ªå®ç°ç±»å°±æ˜¯ <code>WebSecurityConfigurer</code>ï¼Œè¿™ä¸ªå¯èƒ½æœ‰çš„å°ä¼™ä¼´æ¯”è¾ƒé™Œç”Ÿï¼Œå…¶å®ä»–å°±æ˜¯æˆ‘ä»¬å¤©å¤©ç”¨çš„ <code>WebSecurityConfigurerAdapter</code> çš„çˆ¶æ¥å£ã€‚</p><p>æ‰€ä»¥ <code>WebSecurityConfigurer</code> çš„ä½œç”¨å°±å¾ˆæ˜ç¡®äº†ï¼Œç”¨æˆ·æ‰©å±•ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ã€‚</p><p><code>SecurityConfigurer</code> é»˜è®¤ä¸»è¦æ˜¯è¿™ä¸‰ä¸ªå®ç°ï¼Œè€ƒè™‘åˆ°å¤§å¤šæ•°çš„è¿‡æ»¤å™¨é…ç½®éƒ½æ˜¯é€šè¿‡ <code>SecurityConfigurerAdapter</code> è¿›è¡Œæ‰©å±•çš„ï¼Œå› æ­¤æˆ‘ä»¬ä»Šå¤©å°±é€šè¿‡è¿™æ¡çº¿è¿›è¡Œå±•å¼€ã€‚</p><h3 id="ğŸ‘€AuthenticationManagerBuilder"><a href="#ğŸ‘€AuthenticationManagerBuilder" class="headerlink" title="ğŸ‘€AuthenticationManagerBuilder"></a>ğŸ‘€AuthenticationManagerBuilder</h3><blockquote><p>æ­¤èŠ‚å»ºè®®ç»“åˆæ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…æ¥çœ‹</p></blockquote><p>å‰é¢å’Œå¤§å®¶åˆ†äº«äº† <code>SecurityBuilder</code> ä»¥åŠå®ƒçš„ä¸€ä¸ªé‡è¦å®ç° <code>HttpSecurity</code>ï¼Œåœ¨ <code>SecurityBuilder</code> çš„å®ç°ç±»é‡Œè¾¹ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åˆ†æ”¯ï¼Œé‚£å°±æ˜¯ <code>AuthenticationManagerBuilder</code>ï¼Œ<code>AuthenticationManagerBuilder</code> çœ‹åå­—å°±çŸ¥é“æ˜¯ç”¨æ¥æ„å»º <code>AuthenticationManager</code> çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹ <code>AuthenticationManager</code> åˆ°åº•æ˜¯æ€ä¹ˆæ„å»ºçš„ã€‚</p><h4 id="åˆæ­¥ç†è§£"><a href="#åˆæ­¥ç†è§£" class="headerlink" title="åˆæ­¥ç†è§£"></a>åˆæ­¥ç†è§£</h4><p>åœ¨ Spring Security ä¸­ï¼Œç”¨æ¥å¤„ç†èº«ä»½è®¤è¯çš„ç±»æ˜¯ <code>AuthenticationManager</code>ï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºè®¤è¯ç®¡ç†å™¨ã€‚<strong>ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šé¢æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³åŒ¹é…çš„é‡è¦ä¸€ç¯</strong></p><p><code>AuthenticationManager</code> ä¸­è§„èŒƒäº† Spring Security çš„è¿‡æ»¤å™¨è¦å¦‚ä½•æ‰§è¡Œèº«ä»½è®¤è¯ï¼Œå¹¶åœ¨èº«ä»½è®¤è¯æˆåŠŸåè¿”å›ä¸€ä¸ªç»è¿‡è®¤è¯çš„ <code>Authentication </code>å¯¹è±¡ã€‚<code>AuthenticationManager</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å®ƒçš„å®ç°ï¼Œä½†æ˜¯é€šå¸¸æˆ‘ä»¬ä½¿ç”¨æ›´å¤šçš„æ˜¯ç³»ç»Ÿæä¾›çš„ <code>ProviderManager</code></p><h4 id="ProviderManager"><a href="#ProviderManager" class="headerlink" title="ProviderManager"></a>ProviderManager</h4><p><code>ProviderManager</code> æ˜¯çš„æœ€å¸¸ç”¨çš„<code> AuthenticationManager</code> å®ç°ç±»ã€‚</p><p><code>ProviderManager</code> ç®¡ç†äº†ä¸€ä¸ª <code>AuthenticationProvider</code> åˆ—è¡¨ï¼Œæ¯ä¸ª <code>AuthenticationProvider</code> éƒ½æ˜¯ä¸€ä¸ªè®¤è¯å™¨ï¼Œä¸åŒçš„ <code>AuthenticationProvider</code> ç”¨æ¥å¤„ç†ä¸åŒçš„ <code>Authentication</code> å¯¹è±¡çš„è®¤è¯ã€‚ä¸€æ¬¡å®Œæ•´çš„èº«ä»½è®¤è¯æµç¨‹å¯èƒ½ä¼šç»è¿‡å¤šä¸ª <code>AuthenticationProvider</code></p><p><code>ProviderManager </code>ç›¸å½“äºä»£ç†äº†å¤šä¸ª <code>AuthenticationProvider</code>ï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809210416369.png" alt="image-20210809210416369"></p><h4 id="AuthenticationProvider"><a href="#AuthenticationProvider" class="headerlink" title="AuthenticationProvider"></a>AuthenticationProvider</h4><p><code>AuthenticationProvider</code> å®šä¹‰äº† Spring Security ä¸­çš„éªŒè¯é€»è¾‘ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ <code>AuthenticationProvider</code> çš„å®šä¹‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AuthenticationProvider</span> </span>&#123;<span class="hljs-function">Authentication <span class="hljs-title">authenticate</span><span class="hljs-params">(Authentication authentication)</span></span><span class="hljs-function"><span class="hljs-keyword">throws</span> AuthenticationException</span>;<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; authentication)</span></span>;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>AuthenticationProvider</code> ä¸­å°±ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li>authenticate æ–¹æ³•ç”¨æ¥åšéªŒè¯ï¼Œå°±æ˜¯éªŒè¯ç”¨æˆ·èº«ä»½ã€‚</li><li>supports åˆ™ç”¨æ¥åˆ¤æ–­å½“å‰çš„ <code>AuthenticationProvider</code> æ˜¯å¦æ”¯æŒå¯¹åº”çš„ <code>Authentication</code>ã€‚</li></ul><p>åœ¨ä¸€æ¬¡å®Œæ•´çš„è®¤è¯ä¸­ï¼Œå¯èƒ½åŒ…å«å¤šä¸ª <code>AuthenticationProvider</code>ï¼Œè€Œè¿™å¤šä¸ª <code>AuthenticationProvider</code> åˆ™ç”± <code>ProviderManager </code>è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå…·ä½“æˆ‘ä¼šå†å‡ºä¸€ç¯‡æ–‡ç« æ¥åˆ†æSpring Security ç™»å½•æµç¨‹ã€‚</p><p>æœ€å¸¸ç”¨çš„ <code>AuthenticationProvider</code> å®ç°ç±»æ˜¯ <code>DaoAuthenticationProvider</code>ã€‚</p><h4 id="Parent"><a href="#Parent" class="headerlink" title="Parent"></a>Parent</h4><p>æ¯ä¸€ä¸ª <code>ProviderManager</code> ç®¡ç†å¤šä¸ª <code>AuthenticationProvider</code>ï¼ŒåŒæ—¶æ¯ä¸€ä¸ª <code>ProviderManager</code> éƒ½å¯ä»¥é…ç½®ä¸€ä¸ª parentï¼Œå¦‚æœå½“å‰çš„ <code>ProviderManager</code> ä¸­è®¤è¯å¤±è´¥äº†ï¼Œè¿˜å¯ä»¥å»å®ƒçš„ parent ä¸­ç»§ç»­æ‰§è¡Œè®¤è¯ï¼Œæ‰€è°“çš„ parent å®ä¾‹ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯ <code>ProviderManager</code>ï¼Œä¹Ÿå°±æ˜¯ <code>ProviderManager</code> çš„ parent è¿˜æ˜¯ <code>ProviderManager</code>ã€‚å¯ä»¥å‚è€ƒå¦‚ä¸‹æ¶æ„å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809210931119.png" alt="image-20210809210931119"></p><p><strong>ä»ä¸Šé¢çš„åˆ†æä¸­å¤§å®¶å¯ä»¥çœ‹å‡ºï¼Œ<code>AuthenticationManager</code> çš„åˆå§‹åŒ–ä¼šåˆ†ä¸ºä¸¤å—ï¼Œä¸€ä¸ªå…¨å±€çš„ <code>AuthenticationManager</code>ï¼Œä¹Ÿå°±æ˜¯ parentï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯å±€éƒ¨çš„ <code>AuthenticationManager</code>ã€‚å…ˆç»™å¤§å®¶ä¸€ä¸ªç»“è®ºï¼Œä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å¤šä¸ª <code>HttpSecurity</code>ï¼Œè€Œæ¯ä¸€ä¸ª<code>HttpSecurity</code>éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ <code>AuthenticationManager</code> å®ä¾‹ï¼ˆå±€éƒ¨ <code>AuthenticationManager</code>ï¼‰ï¼Œè¿™äº›å±€éƒ¨çš„ <code>AuthenticationManager</code> å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ parentï¼Œé‚£å°±æ˜¯å…¨å±€çš„ <code>AuthenticationManager</code>ã€‚</strong></p><h4 id="ä¸ºä»€ä¹ˆæ¯ä¸€ä¸ª-HttpSecurity-éƒ½è¦ç»‘å®šä¸€ä¸ª-AuthenticationManagerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ¯ä¸€ä¸ª-HttpSecurity-éƒ½è¦ç»‘å®šä¸€ä¸ª-AuthenticationManagerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯ä¸€ä¸ª HttpSecurity éƒ½è¦ç»‘å®šä¸€ä¸ª AuthenticationManagerï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ¯ä¸€ä¸ª HttpSecurity éƒ½è¦ç»‘å®šä¸€ä¸ª AuthenticationManagerï¼Ÿ</h4><p>å› ä¸ºåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å›é…ç½®å¤šä¸ª <code>HttpSecurity</code>ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªä¸åŒçš„è¿‡æ»¤å™¨é“¾ï¼Œæ—¢ç„¶æœ‰å¤šä¸ªè¿‡æ»¤å™¨é“¾ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚åˆ°æ¥çš„æ—¶å€™ï¼Œå®ƒéœ€è¦è¿›å…¥åˆ°æŸä¸€ä¸ªè¿‡æ»¤å™¨é“¾ä¸­å»å¤„ç†ï¼Œæ¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ä¸­åˆä¼šæ¶‰åŠåˆ° <code>AuthenticationProvider </code>çš„ç®¡ç†ï¼Œä¸åŒè¿‡æ»¤å™¨é“¾ä¸­çš„ <code>AuthenticationProvider</code> è‚¯å®šæ˜¯å„è‡ªç®¡ç†æœ€ä¸ºåˆé€‚ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„è¿‡æ»¤å™¨é“¾ä¸­éƒ½æœ‰ä¸€ä¸ªç»‘å®šçš„ <code>AuthenticationManager</code>ï¼Œå³æ¯ä¸€ä¸ª <code>HttpSecurity</code> éƒ½è¦ç»‘å®šä¸€ä¸ª <code>AuthenticationManager</code></p><h3 id="ğŸ‘€WebSecurityConfigurerAdapter"><a href="#ğŸ‘€WebSecurityConfigurerAdapter" class="headerlink" title="ğŸ‘€WebSecurityConfigurerAdapter"></a>ğŸ‘€WebSecurityConfigurerAdapter</h3><blockquote><p>æˆ‘ä»¬é…ç½®ä¸­ç»§æ‰¿çš„å°±æ˜¯WebSecurityConfigurerAdapterï¼Œéœ€è¦é‡ç‚¹å…³æ³¨</p></blockquote><p>æˆ‘ä»¬çš„è‡ªå®šä¹‰çš„<code>SecurityConfig</code>éƒ½æ˜¯ç»§æ‰¿è‡ª <code>WebSecurityConfigurerAdapter</code> æ¥å®ç°çš„ï¼Œé¦–å…ˆçœ‹ä¸€å¼  <code>WebSecurityConfigurerAdapter</code> çš„ç»§æ‰¿å…³ç³»å›¾ï¼š</p><p><a href="http://img.itboyhub.com/2020/07/WebSecurityConfigurerAdapter.png"><img src="http://img.itboyhub.com/2020/07/WebSecurityConfigurerAdapter.png" alt="img" style="zoom: 67%;" /></a></p><p>åœ¨è¿™å±‚ç»§æ‰¿å…³ç³»ä¸­ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„ç±»ï¼š</p><ul><li><p><strong>SecurityBuilder</strong></p></li><li><p><strong>SecurityConfigurer</strong></p></li></ul><p>ä¸Šé¢å·²ç»åˆ†æäº†è¿™ä¸¤ä¸ªç±»ï¼Œä¸‹é¢ç€é‡åˆ†æå…¶ä»–çš„</p><h4 id="WebSecurityConfigurer-1"><a href="#WebSecurityConfigurer-1" class="headerlink" title="WebSecurityConfigurer"></a>WebSecurityConfigurer</h4><p>WebSecurityConfigurer å…¶å®æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä½†æ˜¯å®ƒé‡Œè¾¹çº¦æŸäº†ä¸€äº›æ³›å‹ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">WebSecurityConfigurer</span>&lt;<span class="hljs-title">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">Filter</span>&gt;&gt; <span class="hljs-keyword">extends</span></span><span class="hljs-class"><span class="hljs-title">SecurityConfigurer</span>&lt;<span class="hljs-title">Filter</span>, <span class="hljs-title">T</span>&gt; </span>&#123;&#125;</code></pre></div><p>è¿™é‡Œè¾¹çš„æ³›å‹å¾ˆå…³é”®ï¼Œè¿™å…³ä¹åˆ° <code>WebSecurityConfigurer</code> çš„ç›®çš„æ˜¯å•¥ï¼</p><ol><li><code>SecurityBuilder</code> ä¸­çš„æ³›å‹ Filterï¼Œè¡¨ç¤º<code>SecurityBuilder</code>æœ€ç»ˆçš„ç›®çš„æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ª Filter å¯¹è±¡å‡ºæ¥ã€‚</li><li><code>SecurityConfigurer</code> ä¸­ä¸¤ä¸ªæ³›å‹ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºçš„å«ä¹‰ä¹Ÿæ˜¯ <code>SecurityBuilder</code> æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ã€‚</li></ol><p>åŒæ—¶è¿™é‡Œè¿˜å®šä¹‰äº†æ–°çš„æ³›å‹ Tï¼ŒT éœ€è¦ç»§æ‰¿è‡ª <code>SecurityBuilder</code>ï¼Œæ ¹æ® <code>WebSecurityConfigurerAdapter</code> ä¸­çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒT å°±æ˜¯ <code>WebSecurity</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¤§æ¦‚èƒ½çŒœå‡º <code>WebSecurity</code> å°±æ˜¯ <code>SecurityBuilder</code> çš„å­ç±»ã€‚</p><p>æ‰€ä»¥ <code>WebSecurityConfigurer</code> çš„ç›®çš„æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸ºäº†é…ç½® <code>WebSecurity</code></p><h4 id="WebSecurity"><a href="#WebSecurity" class="headerlink" title="WebSecurity"></a>WebSecurity</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ <code>WebSecurity</code> çš„å®šä¹‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurity</span> <span class="hljs-keyword">extends</span></span><span class="hljs-class"><span class="hljs-title">AbstractConfiguredSecurityBuilder</span>&lt;<span class="hljs-title">Filter</span>, <span class="hljs-title">WebSecurity</span>&gt; <span class="hljs-keyword">implements</span></span><span class="hljs-class"><span class="hljs-title">SecurityBuilder</span>&lt;<span class="hljs-title">Filter</span>&gt;, <span class="hljs-title">ApplicationContextAware</span> </span>&#123;&#125;</code></pre></div><p>æ²¡é”™ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼<code>WebSecurity</code> ç»§æ‰¿è‡ª <code>AbstractConfiguredSecurityBuilder&lt;Filter, WebSecurity&gt;</code> åŒæ—¶å®ç°äº† <code>SecurityBuilder</code> æ¥å£ã€‚</p><p><code>WebSecurity</code> çš„è¿™äº›æ¥å£å’Œç»§æ‰¿ç±»ï¼Œä¸Šé¢çš„<code>HttpSecurity</code>ä¸­æœ‰åˆ†æï¼Œè¿™é‡Œå°±ä¸é‡å¤åˆ†æäº†</p><p><strong>SecurityBuilder</strong></p><p><code>SecurityBuilder </code>å°±æ˜¯ç”¨æ¥æ„å»ºè¿‡æ»¤å™¨é“¾çš„ï¼Œåœ¨ <code>HttpSecurity</code> å®ç° <code>SecurityBuilder</code> æ—¶ï¼Œä¼ å…¥çš„æ³›å‹å°±æ˜¯ <code>DefaultSecurityFilterChain</code>ï¼Œæ‰€ä»¥ <code>SecurityBuilder#build </code>æ–¹æ³•çš„åŠŸèƒ½å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯ç”¨æ¥æ„å»ºä¸€ä¸ªè¿‡æ»¤å™¨é“¾å‡ºæ¥ï¼Œä½†æ˜¯é‚£ä¸ªè¿‡æ»¤å™¨é“¾æ˜¯ Spring Security ä¸­çš„ã€‚åœ¨ <code>WebSecurityConfigurerAdapter </code>ä¸­å®šä¹‰çš„æ³›å‹æ˜¯ <code>SecurityBuilder</code>ï¼Œæ‰€ä»¥æœ€ç»ˆæ„å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€š Filterï¼Œå…¶å®å°±æ˜¯ <code>FilterChainProxy</code>ï¼Œå…³äº <code>FilterChainProxy</code> ï¼Œå¯ä»¥å‚è€ƒ<code>http.authorizeRequests()</code>ä¸­çš„è¯´æ˜ã€‚</p><p><code>WebSecurity</code> çš„æ ¸å¿ƒé€»è¾‘é›†ä¸­åœ¨ <code>performBuild</code> æ„å»ºæ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> Filter <span class="hljs-title">performBuild</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;Assert.state(!securityFilterChainBuilders.isEmpty(),() -&gt; <span class="hljs-string">&quot;At least one SecurityBuilder&lt;? extends SecurityFilterChain&gt; needs to be specified. &quot;</span>+ <span class="hljs-string">&quot;Typically this done by adding a @Configuration that extends WebSecurityConfigurerAdapter. &quot;</span>+ <span class="hljs-string">&quot;More advanced users can invoke &quot;</span>+ WebSecurity.class.getSimpleName()+ <span class="hljs-string">&quot;.addSecurityFilterChainBuilder directly&quot;</span>);<span class="hljs-keyword">int</span> chainSize = ignoredRequests.size() + securityFilterChainBuilders.size();List&lt;SecurityFilterChain&gt; securityFilterChains = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(chainSize);<span class="hljs-keyword">for</span> (RequestMatcher ignoredRequest : ignoredRequests) &#123;securityFilterChains.add(<span class="hljs-keyword">new</span> DefaultSecurityFilterChain(ignoredRequest));&#125;<span class="hljs-keyword">for</span> (SecurityBuilder&lt;? extends SecurityFilterChain&gt; securityFilterChainBuilder : securityFilterChainBuilders) &#123;securityFilterChains.add(securityFilterChainBuilder.build());&#125;FilterChainProxy filterChainProxy = <span class="hljs-keyword">new</span> FilterChainProxy(securityFilterChains);<span class="hljs-keyword">if</span> (httpFirewall != <span class="hljs-keyword">null</span>) &#123;filterChainProxy.setFirewall(httpFirewall);&#125;filterChainProxy.afterPropertiesSet();Filter result = filterChainProxy;<span class="hljs-keyword">if</span> (debugEnabled) &#123;logger.warn(<span class="hljs-string">&quot;\n\n&quot;</span>+ <span class="hljs-string">&quot;********************************************************************\n&quot;</span>+ <span class="hljs-string">&quot;**********        Security debugging is enabled.       *************\n&quot;</span>+ <span class="hljs-string">&quot;**********    This may include sensitive information.  *************\n&quot;</span>+ <span class="hljs-string">&quot;**********      Do not use in a production system!     *************\n&quot;</span>+ <span class="hljs-string">&quot;********************************************************************\n\n&quot;</span>);result = <span class="hljs-keyword">new</span> DebugFilter(filterChainProxy);&#125;postBuildAction.run();<span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>å…ˆæ¥è¯´ä¸€å¥ï¼Œè¿™é‡Œçš„ performBuild æ–¹æ³•åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯æ„å»º <code>FilterChainProxy</code></p><p>æŠŠæ¡ä½äº†è¿™æ¡ä¸»çº¿ï¼Œæˆ‘ä»¬å†æ¥çœ‹æ–¹æ³•çš„å®ç°å°±å¾ˆå®¹æ˜“äº†ã€‚</p><ol><li><p>é¦–å…ˆç»Ÿè®¡è¿‡æ»¤å™¨é“¾çš„æ€»æ¡æ•°ï¼Œæ€»æ¡æ•°åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯ <code>ignoredRequests</code>ï¼Œè¿™æ˜¯å¿½ç•¥çš„è¯·æ±‚ï¼Œé€šè¿‡ WebSecurity é…ç½®çš„å¿½ç•¥è¯·æ±‚ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ <code>securityFilterChainBuilders</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡ <code>HttpSecurity</code> é…ç½®çš„è¿‡æ»¤å™¨é“¾ï¼Œæœ‰å‡ ä¸ªå°±ç®—å‡ ä¸ªã€‚</p><blockquote><p>å‰ç«¯é™æ€èµ„æºæ”¾è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥ä¸èµ° Spring Security è¿‡æ»¤å™¨é“¾ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">&gt;<span class="hljs-meta">@Override</span>&gt;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123; web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/js/**&quot;</span>,<span class="hljs-string">&quot;/index.html&quot;</span>,<span class="hljs-string">&quot;/img/**&quot;</span>,<span class="hljs-string">&quot;/fonts/**&quot;</span>,<span class="hljs-string">&quot;/favicon.ico&quot;</span>);&gt;&#125;</code></pre></div><p>åç«¯çš„æ¥å£è¦é¢å¤–æ”¾è¡Œï¼Œå°±éœ€è¦ä»”ç»†è€ƒè™‘åœºæ™¯äº†ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œä¸å»ºè®®ä½¿ç”¨ä¸Šé¢è¿™ç§æ–¹å¼ï¼Œå»ºè®®ä¸‹é¢è¿™ç§æ–¹å¼</p><div class="hljs code-wrapper"><pre><code class="hljs java">&gt;http.authorizeRequests()     .antMatchers(<span class="hljs-string">&quot;/hello&quot;</span>).permitAll()     .anyRequest().authenticated()</code></pre></div><p>å› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬æš´éœ²ç™»å½•æ¥å£çš„æ—¶å€™ï¼Œä½¿ç”¨äº†å‰é¢æåˆ°çš„ç¬¬ä¸€ç§æ–¹å¼ï¼Œæ²¡æœ‰èµ° Spring Securityï¼Œè¿‡æ»¤å™¨é“¾ï¼Œåˆ™åœ¨ç™»å½•æˆåŠŸåï¼Œå°±ä¸ä¼šå°†ç™»å½•ç”¨æˆ·ä¿¡æ¯å­˜å…¥ session ä¸­ï¼Œè¿›è€Œå¯¼è‡´åæ¥çš„è¯·æ±‚éƒ½æ— æ³•è·å–åˆ°ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆåæ¥çš„è¯·æ±‚åœ¨ç³»ç»Ÿçœ¼é‡Œä¹Ÿéƒ½æ˜¯æœªè®¤è¯çš„è¯·æ±‚ï¼‰</p><p>æˆ–è€…å¦‚æœä½ çš„ç™»å½•è¯·æ±‚æ­£å¸¸ï¼Œèµ°äº† Spring Security è¿‡æ»¤å™¨é“¾ï¼Œä½†æ˜¯åæ¥çš„ A è¯·æ±‚æ²¡èµ°è¿‡æ»¤å™¨é“¾ï¼ˆé‡‡ç”¨å‰é¢æåˆ°çš„ç¬¬ä¸€ç§æ–¹å¼æ”¾è¡Œï¼‰ï¼Œé‚£ä¹ˆ A è¯·æ±‚ä¸­ï¼Œä¹Ÿæ˜¯æ— æ³•é€šè¿‡ SecurityContextHolder è·å–åˆ°ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„ï¼Œå› ä¸ºå®ƒä¸€å¼€å§‹æ²¡ç»è¿‡ SecurityContextPersistenceFilter è¿‡æ»¤å™¨é“¾ã€‚</p></blockquote></li><li><p>åˆ›å»º <code>securityFilterChains</code> é›†åˆï¼Œå¹¶ä¸”éå†ä¸Šé¢æåˆ°çš„ä¸¤ç§ç±»å‹çš„è¿‡æ»¤å™¨é“¾ï¼Œå¹¶å°†è¿‡æ»¤å™¨é“¾æ”¾å…¥ <code>securityFilterChains</code> é›†åˆä¸­ã€‚</p></li><li><p>åœ¨<code>HttpSecurity</code>ä»‹ç»è¿‡ï¼Œ<code>HttpSecurity</code> æ„å»ºå‡ºæ¥çš„è¿‡æ»¤å™¨é“¾å¯¹è±¡å°±æ˜¯ <code>DefaultSecurityFilterChain</code>ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°† build ç»“æœæ”¾å…¥ <code>securityFilterChains </code>ä¸­ï¼Œè€Œ <code>ignoredRequests</code> ä¸­ä¿å­˜çš„åˆ™éœ€è¦é‡æ„ä¸€ä¸‹æ‰å¯ä»¥å­˜å…¥ <code>securityFilterChains</code></p></li><li><p><code>securityFilterChains</code> ä¸­æœ‰æ•°æ®ä¹‹åï¼Œæ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ª <code>FilterChainProxy</code></p></li><li><p>ç»™æ–°å»ºçš„<code>FilterChainProxy</code>é…ç½®ä¸Šé˜²ç«å¢™</p></li><li><p>æœ€åæˆ‘ä»¬è¿”å›çš„å°±æ˜¯<code> FilterChainProxy</code> çš„å®ä¾‹ã€‚</p></li></ol><p><strong>ä»è¿™æ®µåˆ†æä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ <code>WebSecurity </code>å’Œ <code>HttpSecurity </code>çš„åŒºåˆ«ï¼š</strong></p><ol><li><code>HttpSecurity</code> ç›®çš„æ˜¯æ„å»ºè¿‡æ»¤å™¨é“¾ï¼Œä¸€ä¸ª <code>HttpSecurity</code> å¯¹è±¡æ„å»ºä¸€æ¡è¿‡æ»¤å™¨é“¾ï¼Œä¸€ä¸ªè¿‡æ»¤å™¨é“¾ä¸­æœ‰ N ä¸ªè¿‡æ»¤å™¨ï¼Œ<code>HttpSecurity</code>æ‰€åšçš„äº‹æƒ…å®é™…ä¸Šå°±æ˜¯åœ¨é…ç½®è¿™ N ä¸ªè¿‡æ»¤å™¨ã€‚</li><li><code>WebSecurity</code> ç›®çš„æ˜¯æ„å»º <code>FilterChainProxy</code>ï¼Œä¸€ä¸ª <code>FilterChainProxy</code> ä¸­åŒ…å«æœ‰å¤šä¸ªè¿‡æ»¤å™¨é“¾å’Œä¸€ä¸ª Firewallã€‚</li></ol><h4 id="å›åˆ°WebSecurityConfigurerAdapter"><a href="#å›åˆ°WebSecurityConfigurerAdapter" class="headerlink" title="å›åˆ°WebSecurityConfigurerAdapter"></a>å›åˆ°WebSecurityConfigurerAdapter</h4><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ <code>WebSecurityConfigurerAdapter</code>ï¼Œç”±äº <code>WebSecurityConfigurer </code>åªæ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œ<code>WebSecurityConfigurerAdapter</code> å°±æ˜¯é’ˆå¯¹è¿™ä¸ªç©ºæ¥å£æä¾›ä¸€ä¸ªå…·ä½“çš„å®ç°ï¼Œæœ€ç»ˆç›®çš„è¿˜æ˜¯ä¸ºäº†æ–¹ä¾¿ä½ é…ç½® <code>WebSecurity</code>ã€‚</p><p><code>WebSecurityConfigurerAdapter</code> ä¸­çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ ¹æ®æˆ‘ä»¬å‰é¢çš„åˆ†æï¼Œæçº²æŒˆé¢†çš„æ–¹æ³•å°±ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ initï¼Œè¿˜æœ‰ä¸€ä¸ª configure(WebSecurity web)ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•æœåŠ¡çš„ã€‚é‚£æˆ‘ä»¬å°±æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå…ˆçœ‹ init æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(<span class="hljs-keyword">final</span> WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<span class="hljs-keyword">final</span> HttpSecurity http = getHttp();web.addSecurityFilterChainBuilder(http).postBuildAction(() -&gt; &#123;FilterSecurityInterceptor securityInterceptor = http.getSharedObject(FilterSecurityInterceptor.class);web.securityInterceptor(securityInterceptor);&#125;);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> HttpSecurity <span class="hljs-title">getHttp</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<span class="hljs-keyword">if</span> (http != <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">return</span> http;&#125;AuthenticationEventPublisher eventPublisher = getAuthenticationEventPublisher();localConfigureAuthenticationBldr.authenticationEventPublisher(eventPublisher);AuthenticationManager authenticationManager = authenticationManager();authenticationBuilder.parentAuthenticationManager(authenticationManager);Map&lt;Class&lt;?&gt;, Object&gt; sharedObjects = createSharedObjects();http = <span class="hljs-keyword">new</span> HttpSecurity(objectPostProcessor, authenticationBuilder,sharedObjects);<span class="hljs-keyword">if</span> (!disableDefaults) &#123;<span class="hljs-comment">// @formatter:off</span>http.csrf().and().addFilter(<span class="hljs-keyword">new</span> WebAsyncManagerIntegrationFilter()).exceptionHandling().and().headers().and().sessionManagement().and().securityContext().and().requestCache().and().anonymous().and().servletApi().and().apply(<span class="hljs-keyword">new</span> DefaultLoginPageConfigurer&lt;&gt;()).and().logout();<span class="hljs-comment">// @formatter:on</span>ClassLoader classLoader = <span class="hljs-keyword">this</span>.context.getClassLoader();List&lt;AbstractHttpConfigurer&gt; defaultHttpConfigurers =SpringFactoriesLoader.loadFactories(AbstractHttpConfigurer.class, classLoader);<span class="hljs-keyword">for</span> (AbstractHttpConfigurer configurer : defaultHttpConfigurers) &#123;http.apply(configurer);&#125;&#125;configure(http);<span class="hljs-keyword">return</span> http;&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;logger.debug(<span class="hljs-string">&quot;Using default configure(HttpSecurity). If subclassed this will potentially override subclass configure(HttpSecurity).&quot;</span>);http.authorizeRequests().anyRequest().authenticated().and().formLogin().and().httpBasic();&#125;</code></pre></div><p>init æ–¹æ³•å¯ä»¥ç®—æ˜¯è¿™é‡Œçš„å…¥å£æ–¹æ³•äº†ï¼šé¦–å…ˆè°ƒç”¨ getHttp æ–¹æ³•è¿›è¡Œ <code>HttpSecurity </code>çš„åˆå§‹åŒ–ã€‚<code>HttpSecurity</code> çš„åˆå§‹åŒ–ï¼Œå®é™…ä¸Šå°±æ˜¯é…ç½®äº†ä¸€å †é»˜è®¤çš„è¿‡æ»¤å™¨ï¼Œé…ç½®å®Œæˆåï¼Œæœ€ç»ˆè¿˜è°ƒç”¨äº† configure(http) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆé…ç½®äº†ä¸€äº›æ‹¦æˆªå™¨ï¼Œä¸è¿‡åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡å†™ configure(http) æ–¹æ³•ï¼Œ<code>HttpSecurity</code> é…ç½®å®Œæˆåï¼Œå†å°† <code>HttpSecurity</code> æ”¾å…¥ <code>WebSecurity</code> ä¸­ï¼Œä¿å­˜åœ¨ <code>WebSecurity</code> çš„ <code>securityFilterChainBuilders</code> é›†åˆé‡Œï¼Œå…·ä½“å‚è§ä¸Šé¢çš„<code>HttpSecurity</code>éƒ¨åˆ†</p><p>configure(WebSecurity web) æ–¹æ³•å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ä¼šé‡å†™è¯¥æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>    web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åå°ç®¡ç†ç³»ç»Ÿå¼€å‘è®°å½•</title>
    <link href="/2021/08/05/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    <url>/2021/08/05/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ"><a href="#äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ" class="headerlink" title="äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ"></a>äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ</h1><blockquote><p>æœ¬æ–‡è®°å½•å¼€å‘ä¸€ä¸ª SpringBoot+Vue å‰åç«¯åˆ†ç¦»çš„äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ</p></blockquote><h1 id="ä¸€ã€æŠ€æœ¯æ ˆ"><a href="#ä¸€ã€æŠ€æœ¯æ ˆ" class="headerlink" title="ä¸€ã€æŠ€æœ¯æ ˆ"></a>ä¸€ã€æŠ€æœ¯æ ˆ</h1><h2 id="åç«¯æŠ€æœ¯æ ˆ"><a href="#åç«¯æŠ€æœ¯æ ˆ" class="headerlink" title="åç«¯æŠ€æœ¯æ ˆ"></a>åç«¯æŠ€æœ¯æ ˆ</h2><ul><li>Spring Boot</li><li>Spring Security</li><li>MyBatis</li><li>MySQL</li><li>Redis</li><li>RabbitMQ</li><li>Spring Cache</li><li>WebSocket</li></ul><h2 id="å‰ç«¯æŠ€æœ¯æ ˆ"><a href="#å‰ç«¯æŠ€æœ¯æ ˆ" class="headerlink" title="å‰ç«¯æŠ€æœ¯æ ˆ"></a>å‰ç«¯æŠ€æœ¯æ ˆ</h2><ul><li>Vue</li><li>ElementUI</li><li>axios</li><li>vue-router</li><li>Vuex</li><li>WebSocket</li><li>vue-cli4</li></ul><h3 id="ä¸ºä»€ä¹ˆé€‰ç”¨Vueï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€‰ç”¨Vueï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰ç”¨Vueï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€‰ç”¨Vueï¼Ÿ</h3><p>Vue æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨æä¾›é©±åŠ¨ã€‚</p><ul><li>åªå…³æ³¨è§†å›¾å±‚</li><li>MVVM æ¡†æ¶</li></ul><p>åœ¨ä½¿ç”¨ jQuery è¿‡ç¨‹ä¸­ï¼Œæºæ‚äº†å¤§é‡çš„ DOM æ“ä½œï¼Œä¿®æ”¹è§†å›¾æˆ–è€…è·å– value ï¼Œéƒ½éœ€è¦ DOM æ“ä½œï¼ŒMVVM æ˜¯ä¸€ç§è§†å›¾å’Œæ•°æ®æ¨¡å‹åŒå‘ç»‘å®šçš„æ¡†æ¶ï¼Œå³æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè§†å›¾ä¼šè·Ÿç€å˜åŒ–ï¼Œè§†å›¾å‘ç”Ÿå˜åŒ–ï¼Œæ•°æ®æ¨¡å‹ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œå¼€å‘è€…å†ä¹Ÿä¸éœ€è¦æ“ä½œ DOM èŠ‚ç‚¹</p><h3 id="MVCä¸MVVM"><a href="#MVCä¸MVVM" class="headerlink" title="MVCä¸MVVM"></a>MVCä¸MVVM</h3><p><strong>MVC</strong>ä¸­çš„<strong>M</strong>å°±æ˜¯å•çº¯çš„ä»ç½‘ç»œè·å–å›æ¥çš„æ•°æ®æ¨¡å‹ï¼Œ<strong>V</strong>æŒ‡çš„æˆ‘ä»¬çš„è§†å›¾ç•Œé¢ï¼Œè€Œ<strong>C</strong>å°±æ˜¯æˆ‘ä»¬çš„ViewControllerã€‚</p><p>åœ¨å…¶ä¸­ï¼ŒViewControllerè´Ÿè´£Viewå’ŒModelä¹‹é—´è°ƒåº¦ï¼ŒViewå‘ç”Ÿäº¤äº’äº‹ä»¶ä¼šé€šè¿‡target-actionæˆ–è€…delegateæ–¹å¼å›è°ƒç»™ViewControllerï¼Œä¸æ­¤åŒæ—¶ViewControllerè¿˜è¦æ‰¿æ‹…æŠŠModelé€šè¿‡KVOã€Notificationæ–¹å¼ä¼ æ¥çš„æ•°æ®ä¼ è¾“ç»™Viewç”¨äºå±•ç¤ºçš„è´£ä»»ã€‚<code>éšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œè§†å›¾äº¤äº’è¶Šå¤æ‚ï¼Œå¯¼è‡´Controllerè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œè´Ÿé‡å‰è¡Œã€‚è„æ´»ç´¯æ´»éƒ½å®ƒå¹²äº†ï¼Œåˆ°å¤´æ¥è¿˜ä¸€ç‚¹ä¸è®¨å¥½ã€‚ç¦æŠ¥ä¿®å¤šäº†çš„ç»“æœå°±æ˜¯ï¼Œä¸è¡Œäº†å°±é‡æ„ä½ ï¼Œé‡æ„ä¸äº†å°±æ¢æ‰ä½ </code>ã€‚æ¥ä¸€å¼ æ–¯å¦ç¦è€å¤´ç»å…¸çš„MVCæ¶æ„å›¾ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809000010550.png" alt="image-20210809000010550"></p><p>æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMVVMå°±é—ªäº®ç™»åœºäº†ã€‚ä»–æŠŠViewå’ŒContrlleréƒ½æ”¾åœ¨äº†Viewå±‚ï¼ˆç›¸å½“äºæŠŠControllerä¸€éƒ¨åˆ†é€»è¾‘æŠ½ç¦»äº†å‡ºæ¥ï¼‰ï¼ŒModelå±‚ä¾ç„¶æ˜¯æœåŠ¡ç«¯è¿”å›çš„æ•°æ®æ¨¡å‹ã€‚<code>è€ŒViewModelå……å½“äº†ä¸€ä¸ªUIé€‚é…å™¨çš„è§’è‰²ï¼Œä¹Ÿå°±æ˜¯è¯´Viewä¸­æ¯ä¸ªUIå…ƒç´ éƒ½åº”è¯¥åœ¨ViewModelæ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„å±æ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»ControlleræŠ½ç¦»å‡ºæ¥çš„ä¸UIæœ‰å…³çš„é€»è¾‘éƒ½æ”¾åœ¨äº†ViewModelä¸­ï¼Œè¿™æ ·å°±å‡è½»äº†Controllerçš„è´Ÿæ‹…</code>ã€‚ä¸‹é¢æ˜¯ç½‘ä¸Šç»å…¸çš„MVVMçš„æ¶æ„å›¾</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809000029611.png" alt="image-20210809000029611"></p><p>ä»ä»¥ä¸Šçš„æ¶æ„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„æ¢³ç†å‡ºå„è‡ªçš„åˆ†å·¥ã€‚</p><ul><li><strong>Viewå±‚</strong>ï¼šè§†å›¾å±•ç¤ºã€‚åŒ…å«UIViewä»¥åŠUIViewControllerï¼ŒViewå±‚æ˜¯å¯ä»¥æŒæœ‰ViewModelçš„ã€‚</li><li><strong>ViewModelå±‚</strong>ï¼šè§†å›¾é€‚é…å™¨ã€‚æš´éœ²å±æ€§ä¸Viewå…ƒç´ æ˜¾ç¤ºå†…å®¹æˆ–è€…å…ƒç´ çŠ¶æ€ä¸€ä¸€å¯¹åº”ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ViewModelæš´éœ²çš„å±æ€§å»ºè®®æ˜¯readOnlyçš„ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼ŒViewModelå±‚æ˜¯å¯ä»¥æŒæœ‰Modelçš„ï¼Œä½†æ˜¯ViewModelä¸èƒ½æŒæœ‰Viewï¼Œ1.ViewModelå¯æµ‹æ€§ï¼Œå³å•å…ƒæµ‹è¯•æ–¹ä¾¿è¿›è¡Œã€‚2.å›¢é˜Ÿäººå‘˜å¯åˆ†ç¦»å¼€å‘ï¼ˆViewå’ŒViewModelå¼€å‘å¯ä»¥æ˜¯ä¸¤ä¸ªäººåŒæ—¶è¿›è¡Œï¼‰ã€‚</li><li><strong>Modelå±‚</strong>ï¼šæ•°æ®æ¨¡å‹ä¸æŒä¹…åŒ–æŠ½è±¡æ¨¡å‹ã€‚æ•°æ®æ¨¡å‹å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ä»æœåŠ¡å™¨æ‹‰å›æ¥çš„JSONæ•°æ®ã€‚è€ŒæŒä¹…åŒ–æŠ½è±¡æ¨¡å‹æš‚æ—¶æ”¾åœ¨Modelå±‚ï¼Œæ˜¯å› ä¸ºMVVMè¯ç”Ÿä¹‹åˆå°±æ²¡æœ‰å¯¹è¿™å—è¿›è¡Œå¾ˆç»†è‡´çš„æè¿°ã€‚æŒ‰ç…§ç»éªŒï¼Œæˆ‘ä»¬é€šå¸¸æŠŠæ•°æ®åº“ã€æ–‡ä»¶æ“ä½œå°è£…æˆModelï¼Œå¹¶å¯¹å¤–æä¾›æ“ä½œæ¥å£ã€‚ï¼ˆæœ‰äº›å…¬å¸æŠŠæ•°æ®å­˜å–æ“ä½œå•æ‹å‡ºæ¥ä¸€å±‚ï¼Œç§°ä¹‹ä¸º<strong>DataAdapterå±‚</strong>ï¼Œæ‰€ä»¥åœ¨ä¸šå†…ä¼šæœ‰å¾ˆå¤šMVVMçš„å˜ç§ï¼Œä½†å…¶æœ¬è´¨ä¸Šéƒ½æ˜¯MVVMï¼‰ã€‚</li><li><strong>Binder</strong>ï¼šMVVMçš„çµé­‚ã€‚å¯æƒœåœ¨MVVMè¿™å‡ ä¸ªè‹±æ–‡å•è¯ä¸­å¹¶æ²¡æœ‰å®ƒçš„ä¸€å¸­ä¹‹åœ°ï¼Œå®ƒçš„æœ€ä¸»è¦ä½œç”¨æ˜¯åœ¨Viewå’ŒViewModelä¹‹é—´åšäº†åŒå‘æ•°æ®ç»‘å®šã€‚å¦‚æœMVVMæ²¡æœ‰Binderï¼Œé‚£ä¹ˆå®ƒä¸MVCçš„å·®å¼‚ä¸æ˜¯å¾ˆå¤§ã€‚</li></ul><p>æˆ‘ä»¬å‘ç°ï¼Œæ­£æ˜¯å› ä¸ºViewã€ViewModelä»¥åŠModelé—´çš„æ¸…æ™°çš„æŒæœ‰å…³ç³»ï¼Œæ‰€ä»¥åœ¨ä¸‰ä¸ªæ¨¡å—é—´çš„æ•°æ®æµè½¬æœ‰äº†å¾ˆå¥½çš„æ§åˆ¶</p><h1 id="äºŒã€SPA"><a href="#äºŒã€SPA" class="headerlink" title="äºŒã€SPA"></a>äºŒã€SPA</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><blockquote><p><strong>å•é¡µåº”ç”¨</strong>ï¼ˆè‹±è¯­ï¼šsingle-page applicationï¼Œç¼©å†™<strong>SPA</strong>ï¼‰æ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">ç½‘ç»œåº”ç”¨ç¨‹åº</a>æˆ–<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E7%AB%99">ç½‘ç«™</a>çš„æ¨¡å‹ï¼Œå®ƒé€šè¿‡åŠ¨æ€é‡å†™å½“å‰é¡µé¢æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œè€Œéä¼ ç»Ÿçš„ä»æœåŠ¡å™¨é‡æ–°åŠ è½½æ•´ä¸ªæ–°é¡µé¢ã€‚è¿™ç§æ–¹æ³•é¿å…äº†é¡µé¢ä¹‹é—´åˆ‡æ¢æ‰“æ–­<a href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C">ç”¨æˆ·ä½“éªŒ</a>ï¼Œä½¿åº”ç”¨ç¨‹åºæ›´åƒä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6">æ¡Œé¢åº”ç”¨ç¨‹åº</a>ã€‚å®ƒå°†æ‰€æœ‰çš„æ´»åŠ¨å±€é™äºä¸€ä¸ª Web é¡µé¢ä¸­ï¼Œä»…åœ¨è¯¥ Web é¡µé¢åˆå§‹åŒ–æ—¶åŠ è½½ç›¸åº”çš„ HTMLã€JavaScriptã€CSSã€‚ä¸€æ—¦é¡µé¢åŠ è½½å®Œæˆï¼ŒSPA ä¸ä¼šå› ä¸ºç”¨æˆ·çš„æ“ä½œè€Œè¿›è¡Œé¡µé¢çš„é‡æ–°åŠ è½½æˆ–è·³è½¬ï¼Œè€Œæ˜¯åˆ©ç”¨ JavaScript åŠ¨æ€çš„å˜æ¢ HTMLï¼ˆé‡‡ç”¨çš„æ˜¯ div åˆ‡æ¢æ˜¾ç¤ºå’Œéšè—ï¼‰ï¼Œä»è€Œå®ç°UIä¸ç”¨æˆ·çš„äº¤äº’ã€‚åœ¨ SPA åº”ç”¨ä¸­ï¼Œåº”ç”¨åŠ è½½ä¹‹åå°±ä¸ä¼šå†æœ‰æ•´é¡µåˆ·æ–°ã€‚</p></blockquote><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p><strong>1) æœ‰è‰¯å¥½çš„äº¤äº’ä½“éªŒ</strong><br>èƒ½æå‡é¡µé¢åˆ‡æ¢ä½“éªŒï¼Œç”¨æˆ·åœ¨è®¿é—®åº”ç”¨é¡µé¢æ˜¯ä¸ä¼šé¢‘ç¹çš„å»åˆ‡æ¢æµè§ˆé¡µé¢ï¼Œä»è€Œé¿å…äº†é¡µé¢çš„é‡æ–°åŠ è½½ï¼›<br><strong>2) å‰åç«¯åˆ†ç¦»å¼€å‘</strong><br>å•é¡µWebåº”ç”¨å¯ä»¥å’Œ RESTful è§„çº¦ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡ REST API æä¾›æ¥å£æ•°æ®ï¼Œå¹¶ä½¿ç”¨ Ajax å¼‚æ­¥è·å–ï¼Œè¿™æ ·æœ‰åŠ©äºåˆ†ç¦»å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å·¥ä½œã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥åˆ†è§£ä¸ºé™æ€é¡µé¢å’Œé¡µé¢äº¤äº’ä¸¤ä¸ªéƒ¨åˆ†ï¼›<br><strong>3) å‡è½»æœåŠ¡å™¨å‹åŠ›</strong><br>æœåŠ¡å™¨åªç”¨å‡ºæ•°æ®å°±å¯ä»¥ï¼Œä¸ç”¨ç®¡å±•ç¤ºé€»è¾‘å’Œé¡µé¢åˆæˆï¼Œååèƒ½åŠ›ä¼šæé«˜å‡ å€ï¼›<br><strong>4) å…±ç”¨ä¸€å¥—åç«¯ç¨‹åºä»£ç </strong><br>ä¸ç”¨ä¿®æ”¹åç«¯ç¨‹åºä»£ç å°±å¯ä»¥åŒæ—¶ç”¨äº Web ç•Œé¢ã€æ‰‹æœºã€å¹³æ¿ç­‰å¤šç§å®¢æˆ·ç«¯ï¼›</p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p><strong>1) SEOéš¾åº¦è¾ƒé«˜</strong><br>ç”±äºæ‰€æœ‰çš„å†…å®¹éƒ½åœ¨ä¸€ä¸ªé¡µé¢ä¸­åŠ¨æ€æ›¿æ¢æ˜¾ç¤ºï¼Œæ‰€ä»¥åœ¨SEOä¸Šå…¶æœ‰ç€å¤©ç„¶çš„å¼±åŠ¿ï¼Œæ‰€ä»¥å¦‚æœä½ çš„ç«™ç‚¹å¯¹SEOå¾ˆçœ‹é‡ï¼Œä¸”è¦ç”¨å•é¡µåº”ç”¨ï¼Œé‚£ä¹ˆå°±åšäº›é™æ€é¡µé¢ç»™æœç´¢å¼•æ“ç”¨å§ï¼›<br><strong>2) å‰è¿›ã€åé€€ç®¡ç†</strong><br>ç”±äºå•é¡µWebåº”ç”¨åœ¨ä¸€ä¸ªé¡µé¢ä¸­æ˜¾ç¤ºæ‰€æœ‰çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨çš„å‰è¿›åé€€åŠŸèƒ½ï¼Œæ‰€æœ‰çš„é¡µé¢åˆ‡æ¢éœ€è¦è‡ªå·±å»ºç«‹å †æ ˆç®¡ç†ï¼Œå½“ç„¶æ­¤é—®é¢˜ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚åˆ©ç”¨URIä¸­çš„æ•£åˆ—+iframeå®ç°ï¼›<br><strong>3) åˆæ¬¡åŠ è½½è€—æ—¶å¤š</strong><br>ä¸ºå®ç°å•é¡µWebåº”ç”¨åŠŸèƒ½åŠæ˜¾ç¤ºæ•ˆæœï¼Œéœ€è¦åœ¨åŠ è½½é¡µé¢çš„æ—¶å€™å°†JavaScriptã€CSSç»Ÿä¸€åŠ è½½ï¼Œéƒ¨åˆ†é¡µé¢å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™åŠ è½½ã€‚æ‰€ä»¥å¿…é¡»å¯¹JavaScriptåŠCSSä»£ç è¿›è¡Œåˆå¹¶å‹ç¼©å¤„ç†ï¼›</p><p><code>æœ¬é¡¹ç›®æ˜¯åå°ç®¡ç†ç³»ç»Ÿï¼Œå› ä¸ºä¸éœ€è¦æœç´¢å¼•æ“ä¼˜åŒ–ï¼Œæ‰€ä»¥é€‰ç”¨äº†å•é¡µé¢åº”ç”¨çš„æŠ€æœ¯</code></p><h1 id="ä¸‰ã€Vueçš„æ„å»º"><a href="#ä¸‰ã€Vueçš„æ„å»º" class="headerlink" title="ä¸‰ã€Vueçš„æ„å»º"></a>ä¸‰ã€Vueçš„æ„å»º</h1><h3 id="å®‰è£…NodeJSä¸npm"><a href="#å®‰è£…NodeJSä¸npm" class="headerlink" title="å®‰è£…NodeJSä¸npm"></a>å®‰è£…NodeJSä¸npm</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528161005216.png" alt="image-20210528161005216"></p><h3 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h3><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g vue-cli   # åªéœ€è¦ç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ‰§è¡Œvue init webpack my-project  # ä½¿ç”¨webpackæ¨¡æ¿åˆ›å»ºä¸€ä¸ªvueé¡¹ç›®cd my-project #è¿›å…¥åˆ°é¡¹ç›®ç›®å½•ä¸­npm install  # ä¸‹è½½ä¾èµ–ï¼ˆå¦‚æœåœ¨é¡¹ç›®åˆ›å»ºçš„æœ€åä¸€æ­¥é€‰æ‹©äº†è‡ªåŠ¨æ‰§è¡Œnpm installï¼Œåˆ™è¯¥æ­¥éª¤å¯ä»¥çœç•¥ï¼‰npm run dev # å¯åŠ¨é¡¹ç›®</code></pre></div><h3 id="Vue-é¡¹ç›®ç»“æ„ä»‹ç»"><a href="#Vue-é¡¹ç›®ç»“æ„ä»‹ç»" class="headerlink" title="Vue é¡¹ç›®ç»“æ„ä»‹ç»"></a>Vue é¡¹ç›®ç»“æ„ä»‹ç»</h3><p>Vue é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œä½¿ç”¨ Web Storm æ‰“å¼€é¡¹ç›®ï¼Œé¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528162924438.png" alt="image-20210528162924438"></p><ul><li>build æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾é¡¹ç›®æ„å»ºè„šæœ¬</li><li>config ä¸­å­˜æ”¾é¡¹ç›®çš„ä¸€äº›åŸºæœ¬é…ç½®ä¿¡æ¯ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ç«¯å£è½¬å‘</li><li>node_modules è¿™ä¸ªç›®å½•å­˜æ”¾çš„æ˜¯é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œå³ npm install å‘½ä»¤ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶</li><li>src è¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾é¡¹ç›®çš„æºç ï¼Œå³å¼€å‘è€…å†™çš„ä»£ç æ”¾åœ¨è¿™é‡Œ</li><li>static ç”¨æ¥å­˜æ”¾é™æ€èµ„æº</li><li>index.html åˆ™æ˜¯é¡¹ç›®çš„é¦–é¡µï¼Œå…¥å£é¡µï¼Œä¹Ÿæ˜¯æ•´ä¸ªé¡¹ç›®å”¯ä¸€çš„HTMLé¡µé¢</li><li>package.json ä¸­å®šä¹‰äº†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼ŒåŒ…æ‹¬å¼€å‘æ—¶ä¾èµ–å’Œå‘å¸ƒæ—¶ä¾èµ–</li></ul><p>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œä»¥å 99.99% çš„å·¥ä½œéƒ½æ˜¯åœ¨ src ä¸­å®Œæˆçš„ï¼Œsrc ä¸­çš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528163055327.png" alt="image-20210528163055327"></p><ul><li>assets ç›®å½•ç”¨æ¥å­˜æ”¾èµ„äº§æ–‡ä»¶</li><li>components ç›®å½•ç”¨æ¥å­˜æ”¾ç»„ä»¶ï¼ˆä¸€äº›å¯å¤ç”¨ï¼Œéç‹¬ç«‹çš„é¡µé¢ï¼‰ï¼Œå½“ç„¶å¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨ components ä¸­ç›´æ¥åˆ›å»ºå®Œæ•´é¡µé¢ã€‚</li><li>æ¨èåœ¨ components ä¸­å­˜æ”¾ç»„ä»¶ï¼Œå¦å¤–å•ç‹¬æ–°å»ºä¸€ä¸ª page æ–‡ä»¶å¤¹ï¼Œä¸“é—¨ç”¨æ¥æ”¾å®Œæ•´é¡µé¢ã€‚</li><li>router ç›®å½•ä¸­ï¼Œå­˜æ”¾äº†è·¯ç”±çš„jsæ–‡ä»¶</li><li>App.vue æ˜¯ä¸€ä¸ªVueç»„ä»¶ï¼Œä¹Ÿæ˜¯é¡¹ç›®çš„ç¬¬ä¸€ä¸ªVueç»„ä»¶</li><li>main.jsç›¸å½“äºJavaä¸­çš„mainæ–¹æ³•ï¼Œæ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£js</li></ul><p><strong>main.js</strong> å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App&#x27;</span><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span>Vue.config.productionTip = <span class="hljs-literal">false</span><span class="hljs-comment">/* eslint-disable no-new */</span><span class="hljs-keyword">new</span> Vue(&#123;  el: <span class="hljs-string">&#x27;#app&#x27;</span>,  router,  components: &#123; App &#125;,  template: <span class="hljs-string">&#x27;&lt;App/&gt;&#x27;</span>&#125;)</code></pre></div><ul><li>åœ¨main.js ä¸­ï¼Œé¦–å…ˆå¯¼å…¥ Vue å¯¹è±¡</li><li>å¯¼å…¥ App.vue ï¼Œå¹¶ä¸”å‘½åä¸º App</li><li>å¯¼å…¥routerï¼Œæ³¨æ„ï¼Œç”±äºrouterç›®å½•ä¸‹è·¯ç”±é»˜è®¤æ–‡ä»¶åä¸º index.js ï¼Œå› æ­¤å¯ä»¥çœç•¥</li><li>æ‰€æœ‰ä¸œè¥¿éƒ½å¯¼å…¥æˆåŠŸåï¼Œåˆ›å»ºä¸€ä¸ªVueå¯¹è±¡ï¼Œè®¾ç½®è¦è¢«Vueå¤„ç†çš„èŠ‚ç‚¹æ˜¯ â€˜#appâ€™ï¼Œâ€™#appâ€™ æŒ‡æå‰åœ¨index.html æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€ä¸ªdiv</li><li>å°† router è®¾ç½®åˆ° vue å¯¹è±¡ä¸­ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç®€åŒ–çš„å†™æ³•ï¼Œå®Œæ•´çš„å†™æ³•æ˜¯ router:routerï¼Œå¦‚æœ key/value ä¸€æ¨¡ä¸€æ ·ï¼Œåˆ™å¯ä»¥ç®€å†™ã€‚</li><li>å£°æ˜ä¸€ä¸ªç»„ä»¶ Appï¼ŒApp è¿™ä¸ªç»„ä»¶åœ¨ä¸€å¼€å§‹å·²ç»å¯¼å…¥åˆ°é¡¹ç›®ä¸­äº†ï¼Œä½†æ˜¯ç›´æ¥å¯¼å…¥çš„ç»„ä»¶æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»è¦å£°æ˜ã€‚</li><li>template ä¸­å®šä¹‰äº†é¡µé¢æ¨¡æ¿ï¼Œå³å°† App ç»„ä»¶ä¸­çš„å†…å®¹æ¸²æŸ“åˆ° â€˜#appâ€™ è¿™ä¸ªdiv ä¸­ã€‚</li></ul><p>å› æ­¤ï¼Œå¯ä»¥çŒœæµ‹ï¼Œé¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œçœ‹åˆ°çš„é¡µé¢æ•ˆæœå®šä¹‰åœ¨ <strong>App.vue</strong> ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div id&#x3D;&quot;app&quot;&gt;    &lt;img src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;    &lt;router-view&#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &#39;App&#39;&#125;&lt;&#x2F;script&gt;&lt;style&gt;#app &#123;  font-family: &#39;Avenir&#39;, Helvetica, Arial, sans-serif;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;  text-align: center;  color: #2c3e50;  margin-top: 60px;&#125;&lt;&#x2F;style&gt;</code></pre></div><ul><li>App.vue æ˜¯ä¸€ä¸ªvueç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¸­åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š<ul><li>é¡µé¢æ¨¡æ¿ï¼ˆtemplateï¼‰</li><li>é¡µé¢è„šæœ¬ï¼ˆscriptï¼‰ï¼›</li><li>é¡µé¢æ ·å¼ï¼ˆstyleï¼‰</li></ul></li><li>é¡µé¢æ¨¡æ¿ä¸­ï¼Œå®šä¹‰äº†é¡µé¢çš„ HTML å…ƒç´ ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ä¸€ä¸ª router-view</li><li>é¡µé¢è„šæœ¬ä¸»è¦ç”¨æ¥å®ç°å½“å‰é¡µé¢æ•°æ®åˆå§‹åŒ–ã€äº‹ä»¶å¤„ç†ç­‰ç­‰æ“ä½œ</li><li>é¡µé¢æ ·å¼å°±æ˜¯é’ˆå¯¹ template ä¸­ HTML å…ƒç´ çš„é¡µé¢ç¾åŒ–æ“ä½œ</li></ul><p>éœ€è¦é¢å¤–è§£é‡Šçš„æ˜¯ï¼Œ<strong>router-view</strong>ï¼Œè¿™ä¸ªæŒ‡å±•ç¤ºè·¯ç”±é¡µé¢çš„ä½ç½®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªå ä½ç¬¦ï¼Œè¿™ä¸ªå ä½ç¬¦å±•ç¤ºçš„å†…å®¹å°†æ ¹æ®å½“å‰å…·ä½“çš„ URL åœ°å€æ¥å®šã€‚å…·ä½“å±•ç¤ºçš„å†…å®¹ï¼Œè¦å‚è€ƒè·¯ç”±è¡¨ï¼Œå³ <strong>router/index.js</strong> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> Router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><span class="hljs-keyword">import</span> HelloWorld <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/HelloWorld&#x27;</span>Vue.use(Router)<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Router(&#123;  routes: [    &#123;      path: <span class="hljs-string">&#x27;/&#x27;</span>,      name: <span class="hljs-string">&#x27;HelloWorld&#x27;</span>,      component: HelloWorld    &#125;  ]&#125;)</code></pre></div><ul><li>è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé¦–å…ˆå¯¼å…¥äº†Vueå¯¹è±¡ã€Routerå¯¹è±¡ä»¥åŠ HelloWorld ç»„ä»¶ï¼Œ</li><li>åˆ›å»ºä¸€ä¸ªRouterå¯¹è±¡ï¼Œå¹¶å®šä¹‰è·¯ç”±è¡¨</li><li>è¿™é‡Œå®šä¹‰çš„è·¯ç”±è¡¨ï¼Œpathä¸º <code>/</code> ï¼Œå¯¹åº”çš„ç»„ä»¶ä¸º HelloWorldï¼Œå³æµè§ˆå™¨åœ°å€ä¸º <code>/</code> æ—¶ï¼Œåœ¨router-viewä½ç½®æ˜¾ç¤º HelloWorld ç»„ä»¶</li></ul><h3 id="é¡¹ç›®ç¼–è¯‘"><a href="#é¡¹ç›®ç¼–è¯‘" class="headerlink" title="é¡¹ç›®ç¼–è¯‘"></a>é¡¹ç›®ç¼–è¯‘</h3><p>è¿™ä¹ˆå¤§ä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œè‚¯å®šæ²¡æ³•ç›´æ¥å‘å¸ƒè¿è¡Œï¼Œå½“å¼€å‘è€…å®Œæˆé¡¹ç›®å¼€å‘åï¼Œå°† cmd å‘½ä»¤è¡Œå®šä½åˆ°å½“å‰é¡¹ç›®ç›®å½•ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run build</span></code></pre></div><p>æ‰“åŒ…æˆåŠŸåï¼Œå½“å‰é¡¹ç›®ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª dist æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ index.html å’Œ static ï¼Œindex.html é¡µé¢å°±æ˜¯æˆ‘ä»¬ SPA é¡¹ç›®ä¸­å”¯ä¸€çš„ HTML é¡µé¢äº†ï¼Œstatic ä¸­åˆ™ä¿å­˜äº†ç¼–è¯‘åçš„ jsã€cssç­‰æ–‡ä»¶ï¼Œé¡¹ç›®å‘å¸ƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ nginx ç‹¬ç«‹éƒ¨ç½² dist ä¸­çš„é™æ€æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å°†é™æ€æ–‡ä»¶æ‹·è´åˆ° Spring Boot é¡¹ç›®çš„ static ç›®å½•ä¸‹ï¼Œç„¶åå¯¹ Spring Boot é¡¹ç›®è¿›è¡Œç¼–è¯‘æ‰“åŒ…å‘å¸ƒã€‚</p><h3 id="ä½¿ç”¨Vue-cli3æ„å»ºé¡¹ç›®"><a href="#ä½¿ç”¨Vue-cli3æ„å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨Vue-cli3æ„å»ºé¡¹ç›®"></a>ä½¿ç”¨Vue-cli3æ„å»ºé¡¹ç›®</h3><blockquote><p>Vue æä¾›äº†ä¸€ä¸ª<a href="https://github.com/vuejs/vue-cli">å®˜æ–¹çš„ CLI</a>ï¼Œä¸ºå•é¡µé¢åº”ç”¨ (SPA) å¿«é€Ÿæ­å»ºç¹æ‚çš„è„šæ‰‹æ¶ã€‚å®ƒä¸ºç°ä»£å‰ç«¯å·¥ä½œæµæä¾›äº† batteries-included çš„æ„å»ºè®¾ç½®ã€‚åªéœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´å°±å¯ä»¥è¿è¡Œèµ·æ¥å¹¶å¸¦æœ‰çƒ­é‡è½½ã€ä¿å­˜æ—¶ lint æ ¡éªŒï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„æ„å»ºç‰ˆæœ¬</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…</span>npm install -g @vue/cli<span class="hljs-comment"># åˆ›å»ºé¡¹ç›®</span>vue create vuehr$ <span class="hljs-built_in">cd</span> vuehr$ npm run serve</code></pre></div><p>æ•´ä½“é¡¹ç›®å˜å¾—æ›´åŠ ç®€æ´</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528193634072.png" alt="image-20210528193634072"></p><p>è‡³æ­¤ï¼Œå‰ç«¯éƒ¨åˆ†çš„å‡†å¤‡å·¥ä½œå·²ç»ç»“æŸï¼Œç°åœ¨å¯ä»¥å¼€å§‹æ­å»ºé¡¹ç›®</p><h1 id="å››ã€å‰ç«¯çš„æ­å»º"><a href="#å››ã€å‰ç«¯çš„æ­å»º" class="headerlink" title="å››ã€å‰ç«¯çš„æ­å»º"></a>å››ã€å‰ç«¯çš„æ­å»º</h1><p><strong>å®‰è£…element</strong></p><div class="hljs code-wrapper"><pre><code class="hljs bash">npm i element-ui -S</code></pre></div><p><strong>å¼•ç”¨element</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> ElementUI <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;Vue.use(ElementUI);</code></pre></div><h3 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h3><p><strong>main.js</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;postKeyValueRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;<span class="hljs-keyword">import</span> &#123;putRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;<span class="hljs-keyword">import</span> &#123;getRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;<span class="hljs-keyword">import</span> &#123;deleteRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;Vue.prototype.postRequest = postRequest;Vue.prototype.postKeyValueRequest = postKeyValueRequest;Vue.prototype.putRequest = putRequest;Vue.prototype.getRequest = getRequest;Vue.prototype.deleteRequest = deleteRequest;Vue.use(ElementUI);Vue.config.productionTip = <span class="hljs-literal">false</span><span class="hljs-keyword">new</span> Vue(&#123;  router,  render: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> h(App)&#125;).$mount(<span class="hljs-string">&#x27;#app&#x27;</span>)</code></pre></div><p><strong>routeré‡Œé…ç½®index.js</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> VueRouter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><span class="hljs-keyword">import</span> Login <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Login.vue&#x27;</span><span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Home.vue&#x27;</span>Vue.use(VueRouter)<span class="hljs-keyword">const</span> routes = [    &#123;      path: <span class="hljs-string">&#x27;/&#x27;</span>,      name: <span class="hljs-string">&#x27;Login&#x27;</span>,      component: Login    &#125;,    &#123;      path: <span class="hljs-string">&#x27;/home&#x27;</span>,      name: <span class="hljs-string">&#x27;Home&#x27;</span>,      component: Home    &#125;]<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> VueRouter(&#123;  routes&#125;)<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router</code></pre></div><h3 id="ç™»å½•é¡µé¢"><a href="#ç™»å½•é¡µé¢" class="headerlink" title="ç™»å½•é¡µé¢"></a>ç™»å½•é¡µé¢</h3><p><strong>Login.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;&lt;div&gt;&lt;!--  v-model:rules&#x3D;:rules--&gt;  &lt;el-form :rules&#x3D;&quot;rules&quot; ref&#x3D;&quot;loginForm&quot; :model&#x3D;&quot;loginForm&quot; class&#x3D;&quot;loginContainer&quot;&gt;    &lt;h3 class&#x3D;&quot;login-title&quot;&gt;ç³»ç»Ÿç™»å½•&lt;&#x2F;h3&gt;    &lt;el-form-item prop&#x3D;&quot;username&quot;&gt;      &lt;el-input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;loginForm.username&quot; auto-complete&#x3D;&quot;off&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å&quot;&gt;&lt;&#x2F;el-input&gt;    &lt;&#x2F;el-form-item&gt;    &lt;el-form-item prop&#x3D;&quot;password&quot;&gt;      &lt;el-input type&#x3D;&quot;password&quot; v-model&#x3D;&quot;loginForm.password&quot; auto-complete&#x3D;&quot;off&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥å¯†ç &quot;&gt;&lt;&#x2F;el-input&gt;    &lt;&#x2F;el-form-item&gt;    &lt;el-checkbox class&#x3D;&quot;loginRemember&quot; v-model&#x3D;&quot;checked&quot;&gt;&lt;&#x2F;el-checkbox&gt;    &lt;el-button type&#x3D;&quot;primary&quot; style&#x3D;&quot;width:100%;&quot; @click&#x3D;&quot;submitLogin&quot;&gt;ç™»å½•&lt;&#x2F;el-button&gt;  &lt;&#x2F;el-form&gt;&lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;Login&quot;,  data()&#123;    return &#123;      loginForm:&#123;        username:&#39;admin&#39;,        password:&#39;123&#39;      &#125;,      checked: true,      rules:&#123;        username:[&#123;required: true, message:&quot;è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å&quot;,trigger:&quot;blur&quot;&#125;],        password:[&#123;required: true, message:&quot;è¯·è¾“å…¥å¯†ç &quot;,trigger:&quot;blur&quot;&#125;]      &#125;    &#125;  &#125;,  methods:&#123;    submitLogin()&#123;      this.$refs.loginForm.validate((valid) &#x3D;&gt; &#123;        if (valid) &#123;          this.postKeyValueRequest(&#39;&#x2F;doLogin&#39;,this.loginForm).then(resp &#x3D;&gt; &#123;            if (resp)&#123;              window.sessionStorage.setItem(&quot;user&quot;, JSON.stringify(resp.obj));              this.$router.replace(&#39;&#x2F;home&#39;)            &#125;          &#125;)          &#x2F;&#x2F; alert(&#39;æäº¤æˆåŠŸ!&#39;);        &#125; else &#123;          this.$message.error(&#39;è¯·è¾“å…¥æ‰€æœ‰å­—æ®µ&#39;);          return false;        &#125;      &#125;);    &#125;  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;.loginContainer&#123;  border-radius: 15px;  background-clip: padding-box;  margin: 180px auto;  width:350px;  padding:35px 35px 15px 35px;  background: #fff;  border: 1px solid #eaeaea;  box-shadow: 0 0 25px #cac6c6;&#125;.login-title&#123;  margin:10px auto 20px auto;  text-align:center;  color: #000000;&#125;.loginRemember&#123;  text-align:left;  margin:0 0 15px 0;&#125;&lt;&#x2F;style&gt;</code></pre></div><h3 id="åˆ¶ä½œåŸºæœ¬é¡µé¢"><a href="#åˆ¶ä½œåŸºæœ¬é¡µé¢" class="headerlink" title="åˆ¶ä½œåŸºæœ¬é¡µé¢"></a>åˆ¶ä½œåŸºæœ¬é¡µé¢</h3><p><strong>Home.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;    &lt;div&gt;        &lt;el-container&gt;            &lt;el-header class&#x3D;&quot;homeHeader&quot;&gt;                &lt;div class&#x3D;&quot;title&quot;&gt;å¾®äººäº‹&lt;&#x2F;div&gt;                &lt;div&gt;                    &lt;el-button icon&#x3D;&quot;el-icon-bell&quot; type&#x3D;&quot;text&quot; style&#x3D;&quot;margin-right: 8px;color: #000000;&quot; size&#x3D;&quot;normal&quot; @click&#x3D;&quot;goChat&quot;&gt;&lt;&#x2F;el-button&gt;                    &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;  &lt;span class&#x3D;&quot;el-dropdown-link&quot;&gt;    &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;  &lt;&#x2F;span&gt;                        &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;                            &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;ä¸ªäººä¸­å¿ƒ&lt;&#x2F;el-dropdown-item&gt;                            &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;è®¾ç½®&lt;&#x2F;el-dropdown-item&gt;                            &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;æ³¨é”€ç™»å½•&lt;&#x2F;el-dropdown-item&gt;                        &lt;&#x2F;el-dropdown-menu&gt;                    &lt;&#x2F;el-dropdown&gt;                &lt;&#x2F;div&gt;            &lt;&#x2F;el-header&gt;            &lt;el-container&gt;                &lt;el-aside width&#x3D;&quot;200px&quot;&gt;                    &lt;el-menu router unique-opened&gt;                        &lt;el-submenu :index&#x3D;&quot;index+&#39;&#39;&quot; v-for&#x3D;&quot;(item,index) in routes&quot; v-if&#x3D;&quot;!item.hidden&quot; :key&#x3D;&quot;index&quot;&gt;                            &lt;template slot&#x3D;&quot;title&quot;&gt;                                &lt;i style&#x3D;&quot;color: #409eff;margin-right: 5px&quot; :class&#x3D;&quot;item.iconCls&quot;&gt;&lt;&#x2F;i&gt;                                &lt;span&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;span&gt;                            &lt;&#x2F;template&gt;                            &lt;el-menu-item :index&#x3D;&quot;child.path&quot; v-for&#x3D;&quot;(child,indexj) in item.children&quot; :key&#x3D;&quot;indexj&quot;&gt;                                &#123;&#123;child.name&#125;&#125;                            &lt;&#x2F;el-menu-item&gt;                        &lt;&#x2F;el-submenu&gt;                    &lt;&#x2F;el-menu&gt;                &lt;&#x2F;el-aside&gt;                &lt;el-main&gt;                    &lt;el-breadcrumb separator-class&#x3D;&quot;el-icon-arrow-right&quot; v-if&#x3D;&quot;this.$router.currentRoute.path!&#x3D;&#39;&#x2F;home&#39;&quot;&gt;                        &lt;el-breadcrumb-item :to&#x3D;&quot;&#123; path: &#39;&#x2F;home&#39; &#125;&quot;&gt;é¦–é¡µ&lt;&#x2F;el-breadcrumb-item&gt;                        &lt;el-breadcrumb-item&gt;&#123;&#123;this.$router.currentRoute.name&#125;&#125;&lt;&#x2F;el-breadcrumb-item&gt;                    &lt;&#x2F;el-breadcrumb&gt;                    &lt;div class&#x3D;&quot;homeWelcome&quot; v-if&#x3D;&quot;this.$router.currentRoute.path&#x3D;&#x3D;&#39;&#x2F;home&#39;&quot;&gt;                        æ¬¢è¿æ¥åˆ°å¾®äººäº‹ï¼                    &lt;&#x2F;div&gt;                    &lt;router-view class&#x3D;&quot;homeRouterView&quot;&#x2F;&gt;                &lt;&#x2F;el-main&gt;            &lt;&#x2F;el-container&gt;        &lt;&#x2F;el-container&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;    export default &#123;        name: &quot;Home&quot;,        data() &#123;            return &#123;                &#x2F;&#x2F; user: JSON.parse(window.sessionStorage.getItem(&quot;user&quot;))            &#125;        &#125;,        computed: &#123;            routes() &#123;                return this.$store.state.routes;            &#125;,            user() &#123;                return this.$store.state.currentHr;            &#125;        &#125;,        methods: &#123;            goChat() &#123;                this.$router.push(&quot;&#x2F;chat&quot;);            &#125;,            commandHandler(cmd) &#123;                if (cmd &#x3D;&#x3D; &#39;logout&#39;) &#123;                    this.$confirm(&#39;æ­¤æ“ä½œå°†æ³¨é”€ç™»å½•, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;                        confirmButtonText: &#39;ç¡®å®š&#39;,                        cancelButtonText: &#39;å–æ¶ˆ&#39;,                        type: &#39;warning&#39;                    &#125;).then(() &#x3D;&gt; &#123;                        this.getRequest(&quot;&#x2F;logout&quot;);                        window.sessionStorage.removeItem(&quot;user&quot;)                        this.$store.commit(&#39;initRoutes&#39;, []);                        this.$router.replace(&quot;&#x2F;&quot;);                    &#125;).catch(() &#x3D;&gt; &#123;                        this.$message(&#123;                            type: &#39;info&#39;,                            message: &#39;å·²å–æ¶ˆæ“ä½œ&#39;                        &#125;);                    &#125;);                &#125;else if (cmd &#x3D;&#x3D; &#39;userinfo&#39;) &#123;                    this.$router.push(&#39;&#x2F;hrinfo&#39;);                &#125;            &#125;        &#125;    &#125;&lt;&#x2F;script&gt;&lt;style&gt;    .homeRouterView &#123;        margin-top: 10px;    &#125;    .homeWelcome &#123;        text-align: center;        font-size: 30px;        font-family: åæ–‡è¡Œæ¥·;        color: #409eff;        padding-top: 50px;    &#125;    .homeHeader &#123;        background-color: #409eff;        display: flex;        align-items: center;        justify-content: space-between;        padding: 0px 15px;        box-sizing: border-box;    &#125;    .homeHeader .title &#123;        font-size: 30px;        font-family: åæ–‡è¡Œæ¥·;        color: #ffffff    &#125;    .homeHeader .userInfo &#123;        cursor: pointer;    &#125;    .el-dropdown-link img &#123;        width: 48px;        height: 48px;        border-radius: 24px;        margin-left: 8px;    &#125;    .el-dropdown-link &#123;        display: flex;        align-items: center;    &#125;&lt;&#x2F;style&gt;</code></pre></div><h3 id="åˆ¶ä½œMenuèœå•"><a href="#åˆ¶ä½œMenuèœå•" class="headerlink" title="åˆ¶ä½œMenuèœå•"></a>åˆ¶ä½œMenuèœå•</h3><p><strong>Home.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;div&gt;  &lt;el-container&gt;    &lt;el-header class&#x3D;&quot;homeHeader&quot;&gt;      &lt;div class&#x3D;&quot;title&quot;&gt;åå°ç®¡ç†ç³»ç»Ÿ&lt;&#x2F;div&gt;            &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;      &lt;span class&#x3D;&quot;el-dropdown-link&quot;&gt;        &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;      &lt;&#x2F;span&gt;              &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;                &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;ä¸ªäººä¸­å¿ƒ&lt;&#x2F;el-dropdown-item&gt;                &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;è®¾ç½®&lt;&#x2F;el-dropdown-item&gt;                &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;æ³¨é”€ç™»å½•&lt;&#x2F;el-dropdown-item&gt;              &lt;&#x2F;el-dropdown-menu&gt;            &lt;&#x2F;el-dropdown&gt;    &lt;&#x2F;el-header&gt;    &lt;el-container&gt;      &lt;el-aside width&#x3D;&quot;200px&quot;&gt;        &lt;el-menu router&gt;          &lt;el-submenu index&#x3D;&quot;1&quot; v-for&#x3D;&quot;(item,index) in this.$router.options.routes&quot; v-if&#x3D;&quot;!item.hidden&quot; :key&#x3D;&quot;index&quot;&gt;            &lt;template slot&#x3D;&quot;title&quot;&gt;              &lt;i class&#x3D;&quot;el-icon-location&quot;&gt;&lt;&#x2F;i&gt;              &lt;span&gt;å¯¼èˆªä¸€&lt;&#x2F;span&gt;            &lt;&#x2F;template&gt;              &lt;el-menu-item :index&#x3D;&quot;child.path&quot; v-for&#x3D;&quot;(child,indexj) in item.children&quot; :key&#x3D;&quot;indexj&quot;&gt;                &#123;&#123;child.name&#125;&#125;              &lt;&#x2F;el-menu-item&gt;          &lt;&#x2F;el-submenu&gt;        &lt;&#x2F;el-menu&gt;      &lt;&#x2F;el-aside&gt;      &lt;el-main&gt;        &lt;router-view&#x2F;&gt;      &lt;&#x2F;el-main&gt;    &lt;&#x2F;el-container&gt;  &lt;&#x2F;el-container&gt;&lt;&#x2F;div&gt;</code></pre></div><p>æ–°å¢routerä¸­çš„è·³è½¬<strong>index.js</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> VueRouter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><span class="hljs-keyword">import</span> Login <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Login.vue&#x27;</span><span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Home.vue&#x27;</span><span class="hljs-keyword">import</span> Test1 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Test1.vue&#x27;</span><span class="hljs-keyword">import</span> Test2 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Test2.vue&#x27;</span>Vue.use(VueRouter)<span class="hljs-keyword">const</span> routes = [    &#123;      path: <span class="hljs-string">&#x27;/&#x27;</span>,      name: <span class="hljs-string">&#x27;Login&#x27;</span>,      component: Login,      hidden:<span class="hljs-literal">true</span>    &#125;,    &#123;      path: <span class="hljs-string">&#x27;/home&#x27;</span>,      name: <span class="hljs-string">&#x27;Home&#x27;</span>,      component: Home,      hidden:<span class="hljs-literal">true</span>    &#125;,    &#123;        path: <span class="hljs-string">&#x27;/home&#x27;</span>,        name: <span class="hljs-string">&#x27;å¯¼èˆªä¸€&#x27;</span>,        component: Home,        children: [            &#123;                path: <span class="hljs-string">&#x27;/test1&#x27;</span>,                name: <span class="hljs-string">&#x27;é€‰é¡¹1&#x27;</span>,                component: Test1            &#125;,            &#123;                path: <span class="hljs-string">&#x27;/test2&#x27;</span>,                name: <span class="hljs-string">&#x27;é€‰é¡¹2&#x27;</span>,                component: Test2            &#125;        ]    &#125;]<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> VueRouter(&#123;  routes&#125;)<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router</code></pre></div><p>æ ¹æ®æ•°æ®åº“ä¸­å­˜å‚¨çš„menuè¡¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602172047103.png" alt="image-20210602172047103"></p><p>å¯ä»¥ç»™æ¯ä¸ªè§’è‰²åˆ†é…ä¸åŒçš„menuè®¿é—®æƒé™</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602172709842.png" alt="image-20210602172709842"></p><p>è¿™æ ·å°±ä¸ç”¨å»routerä¸­è‡ªå·±å®šä¹‰æ¯ä¸ªmenuçš„åå­—å’Œæ˜¾ç¤ºçš„ç±»åˆ«ï¼Œé€šè¿‡è¯»å–æ•°æ®åº“ï¼Œå½“å‰ç”¨æˆ·æ ¹æ®ä¸åŒçš„æƒé™å»è®¿é—®ä¸åŒçš„menuï¼Œ[æ­¤éƒ¨åˆ†åœ¨åç«¯æ­å»ºéƒ¨åˆ†è¡¥å……](# æ•°æ®åº“é©±åŠ¨Menuèœå•)</p><h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><p>ä¸‹ä¸€æ­¥å¼•å…¥<code>Vuex</code>æ¥åšçŠ¶æ€ç®¡ç†ï¼Œæ˜¯æ‰€æœ‰çŠ¶æ€éƒ½æ”¾åœ¨ä¸€ä¸ªå…¬å…±çš„ä½ç½®ï¼Œå®ç°çŠ¶æ€å®æ—¶è½¬æ¢ï¼Œé¦–å…ˆå®‰è£…</p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install vuex</code></pre></div><p>å»ºç«‹ç»„ä»¶storeä¸‹çš„<strong>index.js</strong>å®ç°vuex</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>Vue.use(Vuex)<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Vuex.Store(&#123;    state:&#123;        routes:[]    &#125;,    mutations:&#123;        <span class="hljs-function"><span class="hljs-title">initRoutes</span>(<span class="hljs-params">state, data</span>)</span>&#123;            state.routes = data;        &#125;    &#125;,    actions:&#123;    &#125;&#125;)</code></pre></div><p>é…ç½®å·¥å…·ç±»<strong>menus.js</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;getRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/api&quot;</span>;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> initMenu=<span class="hljs-function">(<span class="hljs-params">router,store</span>)=&gt;</span>&#123;    <span class="hljs-comment">//æ­£å¸¸çš„è·³è½¬</span>    <span class="hljs-keyword">if</span> (store.state.routes.length &gt; <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-comment">//F5åˆ·æ–°</span>    getRequest(<span class="hljs-string">&quot;/system/config/menu&quot;</span>).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (data)&#123;            <span class="hljs-keyword">let</span> fmtRoutes = formatRoutes(data);            router.addRoutes(fmtRoutes);            store.commit(<span class="hljs-string">&#x27;initRoutes&#x27;</span>, fmtRoutes)        &#125;    &#125;)&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> formatRoutes = <span class="hljs-function">(<span class="hljs-params">routes</span>) =&gt;</span> &#123;    <span class="hljs-keyword">let</span> fmRoutes = [];    routes.forEach(<span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> &#123;        <span class="hljs-keyword">let</span>  &#123;            path,            component,            name,            meta,            iconCls,            children        &#125; = router;        <span class="hljs-keyword">if</span> (children &amp;&amp; children <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)&#123;            children = formatRoutes(children);        &#125;        <span class="hljs-keyword">let</span> fmRouter = &#123;            path:path,            name:name,            iconCls:iconCls,            meta:meta,            children: children,            <span class="hljs-function"><span class="hljs-title">component</span>(<span class="hljs-params">resolve</span>)</span> &#123;                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Emp&quot;</span>))&#123;                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/emp/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)                &#125;                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Per&quot;</span>))&#123;                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/per/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)                &#125;                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sal&quot;</span>))&#123;                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sal/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)                &#125;                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sta&quot;</span>))&#123;                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sta/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)                &#125;                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sys&quot;</span>))&#123;                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sys/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)                &#125;            &#125;        &#125;        fmRoutes.push(fmRouter)    &#125;)    <span class="hljs-keyword">return</span> fmRoutes;&#125;</code></pre></div><p>æœ€ååœ¨<strong>main.js</strong>ä¸­é…ç½®è·³è½¬</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;initMenu&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/menus&quot;</span>;router.beforeEach(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>) =&gt;</span> &#123;  <span class="hljs-keyword">if</span> (to.path == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;    next();  &#125; <span class="hljs-keyword">else</span> &#123;    initMenu(router, store);    next();  &#125;&#125;)</code></pre></div><p>åœ¨<strong>Home.vue</strong>ä¸­åŠ è½½</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;export default &#123;computed : &#123;  routes() &#123;    return this.$store.state.routes  &#125;&#125;&lt;&#x2F;script&gt;</code></pre></div><p><strong>å®‰è£…å›¾è¡¨åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install font-awesome</code></pre></div><p>åœ¨<strong>main.js</strong>ä¸­å¼•å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;font-awesome/css/font-awesome.min.css&#x27;</span></code></pre></div><p><strong>Home.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;i style&#x3D;&quot;color: #409eff; margin-right: 8px&quot; :class&#x3D;&quot;item.iconCls&quot;&gt;&lt;&#x2F;i&gt;</code></pre></div><h3 id="é…ç½®æƒé™çš„è·³è½¬"><a href="#é…ç½®æƒé™çš„è·³è½¬" class="headerlink" title="é…ç½®æƒé™çš„è·³è½¬"></a>é…ç½®æƒé™çš„è·³è½¬</h3><p><strong>main.js</strong>ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs js">router.beforeEach(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>) =&gt;</span> &#123;  <span class="hljs-keyword">if</span> (to.path == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;    next();  &#125; <span class="hljs-keyword">else</span> &#123;      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">&quot;user&quot;</span>))&#123;        initMenu(router, store);        next();      &#125; <span class="hljs-keyword">else</span> &#123;        next(<span class="hljs-string">&#x27;/?redirect=&#x27;</span> + to.path);      &#125;  &#125;&#125;)</code></pre></div><p>ä¸ºäº†è®©ç™»å½•æ—¶çš„urlåœ¨ç™»å½•ååŒæ ·é€‚ç”¨ï¼Œé…ç½®<strong>Login.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">let path &#x3D; this.$route.query.redirect;this.$router.replace((path &#x3D;&#x3D; &#39;&#x2F;home&#39; || path &#x3D;&#x3D; undefined)? &#39;&#x2F;home&#39; : path)</code></pre></div><h1 id="äº”ã€å‰åç«¯å¯¹æ¥"><a href="#äº”ã€å‰åç«¯å¯¹æ¥" class="headerlink" title="äº”ã€å‰åç«¯å¯¹æ¥"></a>äº”ã€å‰åç«¯å¯¹æ¥</h1><h3 id="åŸºç¡€è¿æ¥"><a href="#åŸºç¡€è¿æ¥" class="headerlink" title="åŸºç¡€è¿æ¥"></a>åŸºç¡€è¿æ¥</h3><p><strong>å®‰è£…axios</strong></p><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install axios</code></pre></div><p>å°è£…å·¥å…·ç±»<code>api.js</code>ï¼Œå¤„ç†ç™»å½•è¯·æ±‚çš„çŠ¶æ€ç ä¿¡æ¯</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span><span class="hljs-keyword">import</span> &#123; Message &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../router&#x27;</span>axios.interceptors.response.use(<span class="hljs-function"><span class="hljs-params">success</span>=&gt;</span>&#123;    <span class="hljs-keyword">if</span> (success.status &amp;&amp; success.status ==<span class="hljs-number">200</span> &amp;&amp; success.data.status ==<span class="hljs-number">500</span>)&#123;        Message.error(&#123;<span class="hljs-attr">message</span>:success.data.msg&#125;)        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">if</span> (success.data.msg)&#123;        Message.success(&#123;<span class="hljs-attr">message</span>:success.data.msg&#125;)    &#125;    <span class="hljs-keyword">return</span> success.data;&#125;,<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">504</span> || error.response.status == <span class="hljs-number">404</span>)&#123;        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;æœåŠ¡å™¨GGäº†å“¦ã€€â•®(ï¿£â–½ï¿£&quot;&quot;)â•­&#x27;</span>&#125;)    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">403</span>) &#123;        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;æ‚¨çš„æƒé™ä¸å¤Ÿå“¦ã€€â•®(ï¿£â–½ï¿£&quot;&quot;)â•­&#x27;</span>&#125;)    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">401</span>)&#123;        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•&#x27;</span>&#125;)        router.replace(<span class="hljs-string">&#x27;/&#x27;</span>)    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">if</span> (error.response.data.msg)&#123;            Message.error(&#123;<span class="hljs-attr">message</span>:error.response.data.msg&#125;)        &#125; <span class="hljs-keyword">else</span> &#123;            Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;æœªçŸ¥é”™è¯¯ï¼ˆï¼›ã‚œï¼ã‚œï¼‰&#x27;</span>&#125;)        &#125;    &#125;    <span class="hljs-keyword">return</span>;&#125;)<span class="hljs-keyword">let</span> base = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> postKeyValueRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span>&#123;    <span class="hljs-keyword">return</span> axios(&#123;        method:<span class="hljs-string">&#x27;POST&#x27;</span>,        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,        data:params,        transformRequest:[<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>)</span>&#123;            <span class="hljs-keyword">let</span> ret = <span class="hljs-string">&#x27;&#x27;</span>;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> data)&#123;                ret+=<span class="hljs-built_in">encodeURIComponent</span>(i) + <span class="hljs-string">&#x27;=&#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(data[i]) + <span class="hljs-string">&#x27;&amp;&#x27;</span>            &#125;            <span class="hljs-built_in">console</span>.log(ret);            <span class="hljs-keyword">return</span> ret;        &#125;],        headers:&#123;            <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>        &#125;    &#125;);&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> postRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;    <span class="hljs-keyword">return</span> axios (&#123;        method : <span class="hljs-string">&#x27;post&#x27;</span>,        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,        data:params    &#125;)&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> putRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;    <span class="hljs-keyword">return</span> axios (&#123;        method : <span class="hljs-string">&#x27;put&#x27;</span>,        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,        data:params    &#125;)&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;    <span class="hljs-keyword">return</span> axios (&#123;        method : <span class="hljs-string">&#x27;get&#x27;</span>,        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,        data:params    &#125;)&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;    <span class="hljs-keyword">return</span> axios (&#123;        method : <span class="hljs-string">&#x27;delete&#x27;</span>,        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,        data:params    &#125;)&#125;</code></pre></div><p>åœ¨<code>Login.vue</code>ä¸‹å¼•å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;import &#123;postKeyValueRequest&#125; from &quot;@&#x2F;utils&#x2F;api&quot;;  export default &#123;  name: &quot;Login&quot;,  data()&#123;    return &#123;      loginForm:&#123;        username:&#39;admin&#39;,        password:&#39;123&#39;      &#125;,      checked: true,      rules:&#123;        username:[&#123;required: true, message:&quot;è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å&quot;,trigger:&quot;blur&quot;&#125;],        password:[&#123;required: true, message:&quot;è¯·è¾“å…¥å¯†ç &quot;,trigger:&quot;blur&quot;&#125;]      &#125;    &#125;  &#125;,  methods:&#123;    submitLogin()&#123;      this.$refs.loginForm.validate((valid) &#x3D;&gt; &#123;        if (valid) &#123;          postKeyValueRequest(&#39;&#x2F;doLogin&#39;,this.loginForm).then(resp &#x3D;&gt; &#123;            if (resp)&#123;              alert(JSON.stringify(resp))            &#125;          &#125;)          &#x2F;&#x2F; alert(&#39;æäº¤æˆåŠŸ!&#39;);        &#125; else &#123;          this.$message.error(&#39;è¯·è¾“å…¥æ‰€æœ‰å­—æ®µ&#39;);          return false;        &#125;      &#125;);    &#125;  &#125;&#125;&lt;&#x2F;script&gt;</code></pre></div><p><strong>å‰åç«¯è¿æ¥é…ç½®vue.config.js</strong></p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> proxyObj = &#123;&#125;;proxyObj [<span class="hljs-string">&#x27;/&#x27;</span>] = &#123;    ws:<span class="hljs-literal">false</span>,    target:<span class="hljs-string">&#x27;http://localhost:8081&#x27;</span>,    changeOrigin:<span class="hljs-literal">true</span>,    pathRewrite:&#123;        <span class="hljs-string">&#x27;^/&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>    &#125;&#125;<span class="hljs-built_in">module</span>.exports=&#123;    devServer:&#123;        host:<span class="hljs-string">&#x27;localhost&#x27;</span>,        port:<span class="hljs-number">8080</span>,        proxy:proxyObj    &#125;&#125;</code></pre></div><p><strong>ç™»å½•æˆåŠŸ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210531134218777.png" alt="image-20210531134218777"></p><p>è¿”å›çš„æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–åˆ°çš„JSONä¿¡æ¯</p><p><strong>ç™»å½•å¤±è´¥</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210531134244306.png" alt="image-20210531134244306"></p><p>å¯¹åº”ç€åç«¯é…ç½®ç±»ä¸­çš„failureHandleä¸­çš„å¤„ç†å­—æ®µï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå‰åç«¯å·²ç»å¯¹æ¥æˆåŠŸ</p><h3 id="æƒé™ç®¡ç†"><a href="#æƒé™ç®¡ç†" class="headerlink" title="æƒé™ç®¡ç†"></a>æƒé™ç®¡ç†</h3><p>åœ¨ä¼ ç»Ÿçš„å‰åç«¯ä¸åˆ†çš„å¼€å‘ä¸­ï¼Œæƒé™ç®¡ç†ä¸»è¦é€šè¿‡è¿‡æ»¤å™¨æˆ–è€…æ‹¦æˆªå™¨æ¥è¿›è¡Œï¼ˆæƒé™ç®¡ç†æ¡†æ¶æœ¬èº«ä¹Ÿæ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å®ç°åŠŸèƒ½ï¼‰ï¼Œå¦‚æœç”¨æˆ·ä¸å…·å¤‡æŸä¸€ä¸ªè§’è‰²æˆ–è€…æŸä¸€ä¸ªæƒé™ï¼Œåˆ™æ— æ³•è®¿é—®æŸä¸€ä¸ªé¡µé¢ã€‚</p><p>ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»ä¸­ï¼Œé¡µé¢çš„è·³è½¬ç»Ÿç»Ÿäº¤ç»™å‰ç«¯å»åšï¼Œåç«¯åªæä¾›æ•°æ®ï¼Œè¿™ç§æ—¶å€™ï¼Œæƒé™ç®¡ç†ä¸èƒ½å†æŒ‰ç…§ä¹‹å‰çš„æ€è·¯æ¥ã€‚</p><p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œ<code>å‰ç«¯æ˜¯å±•ç¤ºç»™ç”¨æˆ·çœ‹çš„ï¼Œæ‰€æœ‰çš„èœå•æ˜¾ç¤ºæˆ–è€…éšè—ç›®çš„ä¸æ˜¯ä¸ºäº†å®ç°æƒé™ç®¡ç†ï¼Œè€Œæ˜¯ä¸ºäº†ç»™ç”¨æˆ·ä¸€ä¸ªè‰¯å¥½çš„ä½“éªŒï¼Œä¸èƒ½ä¾é å‰ç«¯éšè—æ§ä»¶æ¥å®ç°æƒé™ç®¡ç†ï¼Œå³æ•°æ®å®‰å…¨ä¸èƒ½ä¾é å‰ç«¯</code>ã€‚</p><p>è¿™ç‚¹å°±åƒæ™®é€šçš„è¡¨å•æäº¤ä¸€æ ·ï¼Œå‰ç«¯åšæ•°æ®æ ¡éªŒæ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæé«˜ç”¨æˆ·ä½“éªŒï¼Œåç«¯æ‰æ˜¯çœŸæ­£çš„ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚</p><p>æ‰€ä»¥ï¼Œ<code>çœŸæ­£çš„æ•°æ®å®‰å…¨ç®¡ç†æ˜¯åœ¨åç«¯å®ç°çš„ï¼Œåç«¯åœ¨æ¥å£è®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼Œå°±è¦ç¡®ä¿æ¯ä¸€ä¸ªæ¥å£éƒ½æ˜¯åœ¨æ»¡è¶³æŸç§æƒé™çš„åŸºç¡€ä¸Šæ‰èƒ½è®¿é—®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ€•å°†åç«¯æ•°æ®æ¥å£åœ°å€æš´éœ²å‡ºæ¥ï¼Œå³ä½¿æš´éœ²å‡ºæ¥ï¼Œåªè¦ä½ æ²¡æœ‰ç›¸åº”çš„è§’è‰²ï¼Œä¹Ÿæ˜¯è®¿é—®ä¸äº†çš„</code>ã€‚</p><p>å‰ç«¯ä¸ºäº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å°†ç”¨æˆ·ä¸èƒ½è®¿é—®çš„æ¥å£æˆ–è€…èœå•éšè—èµ·æ¥ã€‚</p><p>æœ‰äººè¯´ï¼Œå¦‚æœç”¨æˆ·ç›´æ¥åœ¨åœ°å€æ‹¦è¾“å…¥æŸä¸€ä¸ªé¡µé¢çš„è·¯å¾„ï¼Œæ€ä¹ˆåŠï¼Ÿæ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰åšä»»ä½•é¢å¤–çš„å¤„ç†çš„è¯ï¼Œç”¨æˆ·ç¡®å®å¯ä»¥é€šè¿‡ç›´æ¥è¾“å…¥æŸä¸€ä¸ªè·¯å¾„è¿›å…¥åˆ°ç³»ç»Ÿä¸­çš„æŸä¸€ä¸ªé¡µé¢ä¸­ï¼Œä½†æ˜¯ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®æ³„éœ²é—®é¢˜ï¼Œå› ä¸ºæ²¡æœ‰ç›¸å…³çš„è§’è‰²ï¼Œå°±æ— æ³•è®¿é—®ç›¸å…³çš„æ¥å£ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·éè¿™æ ·æ“ä½œï¼Œè¿›å…¥åˆ°ä¸€ä¸ªç©ºç™½çš„é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Vue ä¸­çš„å‰ç½®è·¯ç”±å¯¼èˆªå®ˆå«ï¼Œæ¥ç›‘å¬é¡µé¢è·³è½¬ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦å»ä¸€ä¸ªæœªè·æˆæƒçš„é¡µé¢ï¼Œåˆ™ç›´æ¥åœ¨å‰ç½®è·¯ç”±å¯¼èˆªå®ˆå«ä¸­å°†ä¹‹æ‹¦æˆªä¸‹æ¥ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µï¼Œæˆ–è€…ç›´æ¥å°±åœç•™åœ¨å½“å‰é¡µï¼Œä¸è®©ç”¨æˆ·è·³è½¬ï¼Œä¹Ÿå¯ä»¥é¡ºæ‰‹å†ç»™ç”¨æˆ·ä¸€ç‚¹ç‚¹æœªè·æˆæƒçš„æç¤ºä¿¡æ¯ã€‚</p><p>æ€»è€Œè¨€ä¹‹ä¸€å¥è¯ï¼Œå‰ç«¯çš„æ‰€æœ‰æ“ä½œï¼Œéƒ½æ˜¯ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œä¸æ˜¯ä¸ºäº†æ•°æ®å®‰å…¨ï¼ŒçœŸæ­£çš„æƒé™æ ¡éªŒè¦åœ¨åç«¯æ¥åšï¼Œåç«¯å¦‚æœæ˜¯ SSM æ¶æ„ï¼Œå»ºè®®ä½¿ç”¨ Shiro ï¼Œå¦‚æœæ˜¯ <code>Spring Boot + å¾®æœåŠ¡</code>ï¼Œå»ºè®®ä½¿ç”¨ <code>Spring Security</code>ï¼Œæœ¬ç³»ç»Ÿå°±æ˜¯åˆ©ç”¨ Spring Security æ¥å®ç°çš„</p><h1 id="å…­ã€åç«¯çš„æ­å»º"><a href="#å…­ã€åç«¯çš„æ­å»º" class="headerlink" title="å…­ã€åç«¯çš„æ­å»º"></a>å…­ã€åç«¯çš„æ­å»º</h1><h3 id="æœåŠ¡å™¨ç¯å¢ƒçš„æ­å»º"><a href="#æœåŠ¡å™¨ç¯å¢ƒçš„æ­å»º" class="headerlink" title="æœåŠ¡å™¨ç¯å¢ƒçš„æ­å»º"></a>æœåŠ¡å™¨ç¯å¢ƒçš„æ­å»º</h3><p>åˆ›å»ºé¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210529222859839.png" alt="image-20210529222859839"></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h3><p>æƒé™æ•°æ®åº“ä¸»è¦åŒ…å«äº†äº”å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯èµ„æºè¡¨ã€è§’è‰²è¡¨ã€ç”¨æˆ·è¡¨ã€èµ„æºè§’è‰²è¡¨ã€ç”¨æˆ·è§’è‰²è¡¨ï¼Œæ•°æ®åº“å…³ç³»æ¨¡å‹å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p274.png" alt="p274"></p><ul><li>hrè¡¨æ˜¯ç”¨æˆ·è¡¨ï¼Œå­˜æ”¾äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚</li><li>roleæ˜¯è§’è‰²è¡¨ï¼Œnameå­—æ®µè¡¨ç¤ºè§’è‰²çš„è‹±æ–‡åç§°ï¼ŒæŒ‰ç…§SpringSecurityçš„è§„èŒƒï¼Œå°†ä»¥<code>ROLE_</code>å¼€å§‹ï¼ŒnameZhå­—æ®µè¡¨ç¤ºè§’è‰²çš„ä¸­æ–‡åç§°ã€‚</li><li>menuè¡¨æ˜¯ä¸€ä¸ªèµ„æºè¡¨ï¼Œè¯¥è¡¨æ¶‰åŠåˆ°çš„å­—æ®µæœ‰ç‚¹å¤šï¼Œç”±äºæˆ‘çš„å‰ç«¯é‡‡ç”¨äº†Vueæ¥åšï¼Œå› æ­¤å½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®ç”¨æˆ·çš„è§’è‰²åŠ¨æ€åŠ è½½éœ€è¦çš„æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—çš„ä¿¡æ¯å°†ä¿å­˜åœ¨menuè¡¨ä¸­ï¼Œmenuè¡¨ä¸­çš„pathã€componentã€iconClsã€keepAliveã€requireAuthç­‰å­—æ®µéƒ½æ˜¯Vue-Routerä¸­éœ€è¦çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´menuä¸­çš„æ•°æ®åˆ°æ—¶å€™ä¼šä»¥jsonçš„å½¢å¼è¿”å›ç»™å‰ç«¯ï¼Œå†ç”±vueåŠ¨æ€æ›´æ–°routerï¼Œmenuä¸­è¿˜æœ‰ä¸€ä¸ªå­—æ®µurlï¼Œè¡¨ç¤ºä¸€ä¸ªurl patternï¼Œå³è·¯å¾„åŒ¹é…è§„åˆ™ï¼Œå‡è®¾æœ‰ä¸€ä¸ªè·¯å¾„åŒ¹é…è§„åˆ™ä¸º<code>/admin/**</code>,é‚£ä¹ˆå½“ç”¨æˆ·åœ¨å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª<code>/admin/user</code>çš„è¯·æ±‚ï¼Œå°†è¢«<code>/admin/**</code>æ‹¦æˆªåˆ°ï¼Œç³»ç»Ÿå†å»æŸ¥çœ‹è¿™ä¸ªè§„åˆ™å¯¹åº”çš„è§’è‰²æ˜¯å“ªäº›ï¼Œç„¶åå†å»æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦å…·å¤‡ç›¸åº”çš„è§’è‰²ï¼Œè¿›è€Œåˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦åˆæ³•</li></ul><p><code>å…±æœ‰22ä¸ªè¡¨</code></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210529225927805.png" alt="image-20210529225927805"></p><p>åŒæ—¶å¯¼å…¥mapperå’Œmodelæ¨¡æ¿æ–‡ä»¶ï¼Œè§é¡¹ç›®ä¸­ä»£ç <code>model</code>å’Œ<code>mapper</code></p><p>é…ç½®mapperæ‰«æå’Œpomæ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan(basePackages=&quot;org.lucifer.vbluciferpro.mapper&quot;)</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>å¹¶å®ŒæˆJDBCçš„ç›¸å…³é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">Root!123</span><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/vhr?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span><span class="hljs-comment"># å‰ç«¯Vueçš„æ¥å£ä¸º8080</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span></code></pre></div><h3 id="ç®€å•çš„æµ‹è¯•"><a href="#ç®€å•çš„æµ‹è¯•" class="headerlink" title="ç®€å•çš„æµ‹è¯•"></a>ç®€å•çš„æµ‹è¯•</h3><p>è¿™é‡Œå…ˆç®€å•çš„æµ‹è¯•ä¸€ä¸ªæ¥å£çš„æ•ˆæœ</p><p><strong>ç”¨æˆ·ç±»é…ç½®</strong></p><p>ä¸ºäº†ä½¿ç”¨<code>SpringSecurity</code>ï¼Œéœ€è¦å®ç°<code>UserDetails</code>æ¥å£å¹¶é‡å†™æ–¹æ³•ï¼Œå› ä¸ºé‡å†™äº†<code>isEnabled</code>æ–¹æ³•ï¼Œéœ€è¦åˆ é™¤ç”Ÿæˆçš„<code>getEnabled</code>æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String phone;    <span class="hljs-keyword">private</span> String telephone;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-keyword">private</span> Boolean enabled;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-keyword">private</span> String userface;    <span class="hljs-keyword">private</span> String remark;     <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> enabled;    &#125;      <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrMapper hrMapper;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;        Hr hr = hrMapper.loadUserByUsername(username);        <span class="hljs-keyword">if</span> (hr == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> hr;    &#125;&#125;</code></pre></div><p><strong>Mapperæ¥å£</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HrMapper</span> </span>&#123;    <span class="hljs-function">Hr <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span></span>;&#125;</code></pre></div><p><strong>Mapper.xml</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.mapper.HrMapper&quot;</span> &gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Hr&quot;</span> &gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;phone&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;phone&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;CHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;telephone&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;telephone&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;userface&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userface&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadUserByUsername&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  select * from hr where username=#&#123;username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p><strong>Securityé…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(hrService);    &#125;&#125;</code></pre></div><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><p>è¿™æ ·é€šè¿‡ç™»å½•å°±èƒ½è®¿é—®åˆ°helloäº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹<code>Security</code>è¿›è¡Œç™»å½•æˆåŠŸå¤±è´¥ç›¸å…³é…ç½®ï¼Œé¦–å…ˆåˆ›å»ºå“åº”å®ä½“ç±»(å®ä½“ç±»éƒ½æœ‰<code>setter/getter</code>æ–¹æ³•ï¼Œåªä¸è¿‡ä¸ºäº†ä¼˜é›…ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•ç¤º)</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RespBean</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer status;    <span class="hljs-keyword">private</span> String msg;    <span class="hljs-keyword">private</span> Object obj;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg, Object obj)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg, obj);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>,msg,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg, Object obj)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>, msg, obj);    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">(Integer status, String msg, Object obj)</span> </span>&#123;        <span class="hljs-keyword">this</span>.status = status;        <span class="hljs-keyword">this</span>.msg = msg;        <span class="hljs-keyword">this</span>.obj = obj;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">()</span> </span>&#123;    &#125;    &#125;</code></pre></div><p>æ¥ç€ç»§ç»­å®Œå–„é…ç½®ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(hrService);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .anyRequest().authenticated()                .and()                .formLogin()                .usernameParameter(<span class="hljs-string">&quot;username&quot;</span>)                .passwordParameter(<span class="hljs-string">&quot;password&quot;</span>)                .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)                .loginPage(<span class="hljs-string">&quot;/login&quot;</span>)                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        Hr hr = (Hr) authentication.getPrincipal();                        hr.setPassword(<span class="hljs-keyword">null</span>);                        RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>, hr);                        String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);                        out.write(s);                        out.flush();                        out.close();                    &#125;                &#125;)                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException exception)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        RespBean respBean = RespBean.error(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥&quot;</span>);                        <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException)&#123;                            respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException)&#123;                            respBean.setMsg(<span class="hljs-string">&quot;å¯†ç å·²è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException)&#123;                            respBean.setMsg(<span class="hljs-string">&quot;è´¦å·å·²è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException)&#123;                            respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException)&#123;                            respBean.setMsg(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯&quot;</span>);                        &#125;                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                        out.flush();                        out.close();                    &#125;                &#125;)                .permitAll()                .and()                .logout()                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸ&quot;</span>)));                        out.flush();                        out.close();                    &#125;                &#125;)                .permitAll()                .and()                .csrf().disable();    &#125;&#125;</code></pre></div><p>è®¾ç½®ç™»å½•çš„æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">login</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•&quot;</span>);    &#125;&#125;</code></pre></div><h3 id="æ•°æ®åº“é©±åŠ¨Menuèœå•"><a href="#æ•°æ®åº“é©±åŠ¨Menuèœå•" class="headerlink" title="æ•°æ®åº“é©±åŠ¨Menuèœå•"></a>æ•°æ®åº“é©±åŠ¨Menuèœå•</h3><p>æ–°å»ºå®ä½“ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String url;    <span class="hljs-keyword">private</span> String path;    <span class="hljs-keyword">private</span> String component;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String iconCls;    <span class="hljs-keyword">private</span> Meta meta;    <span class="hljs-comment">//å¯¹åº”routerä¸­çš„å­çº§èœå•</span>    <span class="hljs-keyword">private</span> List&lt;Menu&gt; children;    <span class="hljs-keyword">private</span> Integer parentId;    <span class="hljs-keyword">private</span> Boolean enabled;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span> </span>&#123;    <span class="hljs-keyword">private</span> Boolean keepAlive;    <span class="hljs-keyword">private</span> Boolean requireAuth;&#125;</code></pre></div><p>åˆ›å»ºService</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuMapper menuMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getMenusByHrId(((Hr) SecurityContextHolder.getContext().getAuthentication().getPrincipal()).getId());    &#125;&#125;</code></pre></div><p>è°ƒç”¨Mapper</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MenuMapper</span> </span>&#123;<span class="hljs-function">List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">(Integer hrid)</span></span>;&#125;</code></pre></div><p>æ ¹æ®æ•°æ®åº“çš„idï¼Œè®¾è®¡SQL</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> &gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;meta&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Meta&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span> &gt;</span>  id, url, path, component, name, iconCls, keepAlive, requireAuth, parentId, enabled<span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Menus2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;path2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;component2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;iconCls2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;parentId2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;meta&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Meta&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;keepAlive2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;requireAuth2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMenusByHrId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;Menus2&quot;</span>&gt;</span>  SELECT DISTINCT  m1.*, m2.`id` as id2, m2.`component` as component2, m2.`enabled` as enabled2,         m2.`iconCls` as iconCls2, m2.`keepAlive` as keepAlive2, m2.`name` as name2,         m2.`parentId` as parentId2, m2.`requireAuth` as requireAuth2, m2.`path` as path2  FROM menu m1,menu m2, hr_role hrr,menu_role mr  where m1.`id`=m2.`parentId` and hrr.`hrid`=#&#123;hrid&#125; and hrr.`rid`=mr.`rid` and mr.`mid`=m2.`id` and m2.`enabled`=true  ORDER BY m1.`id`,m2.`id`<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>æµ‹è¯•ç”¨Controller</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/config&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemConfigController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuService menuService;    <span class="hljs-meta">@GetMapping(&quot;/menu&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> menuService.getMenusByHrId();    &#125;&#125;</code></pre></div><h3 id="åç«¯æ¥å£æƒé™è®¾è®¡"><a href="#åç«¯æ¥å£æƒé™è®¾è®¡" class="headerlink" title="åç«¯æ¥å£æƒé™è®¾è®¡"></a>åç«¯æ¥å£æƒé™è®¾è®¡</h3><p>æ ¹æ®<code>Menu</code>è¡¨ä¸­çš„<code>path/id/name</code>å¯ä»¥ç¡®å®šå‰ç«¯å‘è¿‡æ¥çš„è¯·æ±‚çš„urlè®¿é—®çš„åå­—ä»¥åŠid</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210604171529329.png" alt="image-20210604171529329"></p><p>ç„¶ååœ¨<code>Menu_role</code>è¡¨ä¸­å¯ä»¥å‘ç°é‚£äº›roleå…·æœ‰å½“å‰midçš„æƒé™ridï¼Œå»æ£€æŸ¥ridæ˜¯å¦ä¸ºå½“å‰ç™»å½•çš„è§’è‰²</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210604171656534.png" alt="image-20210604171656534"></p><p>æ–°å¢é…ç½®ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> lucifer</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * æ ¹æ®ç”¨æˆ·ä¼ æ¥çš„è¯·æ±‚åœ°å€ï¼Œåˆ†æå‡ºè¯·æ±‚éœ€è¦çš„è§’è‰²</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFilterInvocationSecurityMetadataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FilterInvocationSecurityMetadataSource</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuService menuService;    AntPathMatcher antPathMatcher = <span class="hljs-keyword">new</span> AntPathMatcher();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(Object object)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException </span>&#123;        String requestUrl = ((FilterInvocation) object).getRequestUrl();        List&lt;Menu&gt; menus = menuService.getAllMenusWithRole();        <span class="hljs-keyword">for</span> (Menu menu : menus) &#123;            <span class="hljs-keyword">if</span> (antPathMatcher.match(menu.getUrl(), requestUrl)) &#123;                List&lt;Role&gt; roles = menu.getRoles();                String[] str = <span class="hljs-keyword">new</span> String[roles.size()];                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; roles.size(); i++) &#123;                    str[i] = roles.get(i).getName();                &#125;                <span class="hljs-keyword">return</span> SecurityConfig.createList(str);            &#125;        &#125;        <span class="hljs-keyword">return</span> SecurityConfig.createList(<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAllConfigAttributes</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomUrlDecisionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccessDecisionManager</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decide</span><span class="hljs-params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="hljs-keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;        <span class="hljs-keyword">for</span> (ConfigAttribute configAttribute : configAttributes) &#123;            String needRole = configAttribute.getAttribute();            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) &#123;                <span class="hljs-keyword">if</span> (authentication <span class="hljs-keyword">instanceof</span> AnonymousAuthenticationToken)&#123;                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•ï¼&quot;</span>);                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();            <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;                <span class="hljs-comment">//éœ€è¦çš„è§’è‰²èƒ½è¢«æ£€æµ‹åˆ°</span>                <span class="hljs-keyword">if</span> (authority.getAuthority().equals(needRole))&#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;æƒé™ä¸è¶³ï¼Œè¯·è¿”å›ï¼&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(ConfigAttribute attribute)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;</code></pre></div><p>åœ¨<strong>Security</strong>é…ç½®ç±»ä¸­æ³¨å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;<span class="hljs-meta">@Autowired</span>CustomUrlDecisionManager customUrlDecisionManager; <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>        web.ignoring().antMatchers(<span class="hljs-string">&quot;/login&quot;</span>);    &#125; <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;                        object.setAccessDecisionManager(customUrlDecisionManager);                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);                        <span class="hljs-keyword">return</span> object;                    &#125;                &#125;)                <span class="hljs-comment">//.anyRequest().authenticated()</span>                                                <span class="hljs-comment">//è§£å†³æ²¡ç™»å½•æ—¶ï¼Œé‡å®šå‘çš„è·¨åŸŸé—®é¢˜ï¼Œè¿™é‡Œç›´æ¥å¤„ç†ï¼Œä¸é‡å®šå‘</span>                .csrf().disable().exceptionHandling().authenticationEntryPoint(<span class="hljs-keyword">new</span> AuthenticationEntryPoint() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commence</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException authException)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);              <span class="hljs-comment">//é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè®¾ç½®çŠ¶æ€ç ï¼Œè·³è½¬ç™»å½•é¡µé¢</span>              resp.setStatus(<span class="hljs-number">401</span>);                PrintWriter out = resp.getWriter();                RespBean respBean = RespBean.error(<span class="hljs-string">&quot;è®¿é—®å¤±è´¥&quot;</span>);                <span class="hljs-comment">//sessionå¤±æ•ˆï¼Œè·³è½¬ç™»å½•é¡µé¢</span>                <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException)&#123;                    respBean.setMsg(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼&quot;</span>);                &#125;                out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                out.flush();            &#125;</code></pre></div><p>å®ä½“ç±»Hræ–°å¢Roleå±æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</code></pre></div><p>å®ä½“ç±»MenuåŒæ ·æ–°å¢Roleå±æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</code></pre></div><p><strong>MenuService</strong>æ–°å¢æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//@Cacheable</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();&#125;</code></pre></div><p><strong>MenuMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MenuWithRole&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roles&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rnameZh&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nameZh&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllMenusWithRole&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;MenuWithRole&quot;</span>&gt;</span>  SELECT m.*, r.`id` as rid, r.`name` as rname, r.`nameZh` as rnameZh  FROM menu m, menu_role mr, role r  WHERE m.`id` = mr.`mid` AND mr.`rid` = r.`id`  ORDER BY m.`id`;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p><strong>HrService</strong>ä¸­éœ€è¦æ·»åŠ æ³¨å…¥è§’è‰²çš„å­—æ®µï¼Œä¸ç„¶ä¸ºnull</p><div class="hljs code-wrapper"><pre><code class="hljs java">hr.setRoles(hrMapper.getHrRolesById(hr.getId()));</code></pre></div><p><strong>HrMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getHrRolesById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>  SELECT r.* FROM role r, hr_role hrr WHERE hrr.`rid` = r.`id` AND hrr.`hrid` = #&#123;id&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>æµ‹è¯•ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/employee/basic/hello&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/employee/basic/hello&quot;</span>;&#125;<span class="hljs-meta">@GetMapping(&quot;/employee/advanced/hello&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/employee/advanced/hello&quot;</span>;&#125;</code></pre></div><h1 id="ä¸ƒã€ä¸šåŠ¡æ¨¡å—"><a href="#ä¸ƒã€ä¸šåŠ¡æ¨¡å—" class="headerlink" title="ä¸ƒã€ä¸šåŠ¡æ¨¡å—"></a>ä¸ƒã€ä¸šåŠ¡æ¨¡å—</h1><h2 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h2><h3 id="åŸºç¡€ä¿¡æ¯è®¾ç½®"><a href="#åŸºç¡€ä¿¡æ¯è®¾ç½®" class="headerlink" title="åŸºç¡€ä¿¡æ¯è®¾ç½®"></a>åŸºç¡€ä¿¡æ¯è®¾ç½®</h3><p><code>views/sys/SysBasic.vue</code>ä¸‹å®šä¹‰æ¯ä¸ªæ ‡ç­¾</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;    &lt;div&gt;      &lt;el-tabs v-model&#x3D;&quot;activeName&quot; type&#x3D;&quot;card&quot;&gt;        &lt;el-tab-pane label&#x3D;&quot;éƒ¨é—¨ç®¡ç†&quot; name&#x3D;&quot;first&quot;&gt;&lt;DepMana&gt;&lt;&#x2F;DepMana&gt;&lt;&#x2F;el-tab-pane&gt;        &lt;el-tab-pane label&#x3D;&quot;èŒä½ç®¡ç†&quot; name&#x3D;&quot;second&quot;&gt;&lt;PosMana&gt;&lt;&#x2F;PosMana&gt;&lt;&#x2F;el-tab-pane&gt;        &lt;el-tab-pane label&#x3D;&quot;èŒç§°ç®¡ç†&quot; name&#x3D;&quot;third&quot;&gt;&lt;JobLevelMana&gt;&lt;&#x2F;JobLevelMana&gt;&lt;&#x2F;el-tab-pane&gt;        &lt;el-tab-pane label&#x3D;&quot;å¥–æƒ©è§„åˆ™&quot; name&#x3D;&quot;fourth&quot;&gt;&lt;EcMana&gt;&lt;&#x2F;EcMana&gt;&lt;&#x2F;el-tab-pane&gt;        &lt;el-tab-pane label&#x3D;&quot;æƒé™ç»„&quot; name&#x3D;&quot;fifth&quot;&gt;&lt;PermissMana&gt;&lt;&#x2F;PermissMana&gt;&lt;&#x2F;el-tab-pane&gt;      &lt;&#x2F;el-tabs&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;    import DepMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;DepMana&quot;;    import EcMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;EcMana&quot;;    import JobLevelMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;JobLevelMana&quot;;    import PermissMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;PermissMana&quot;;    import PosMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;PosMana&quot;;    export default &#123;        name: &quot;SysBasic&quot;,        data()&#123;            return &#123;              activeName: &#39;&#39;            &#125;        &#125;,        components:&#123;          DepMana,          EcMana,          JobLevelMana,          PermissMana,          PosMana        &#125;    &#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;&lt;&#x2F;style&gt;</code></pre></div><p>å…¶ä¸­çš„<code>&lt;DepMana&gt;</code>ç­‰æ ‡ç­¾ï¼Œå¯¹åº”<code>components/sys/basic/DepMana.vue</code>ï¼Œè¿™æ ·å°±å¯ä»¥å¯¹ä¸åŒçš„æ ‡ç­¾è¿›è¡Œå¼€å‘</p><h4 id="èŒä½ç®¡ç†"><a href="#èŒä½ç®¡ç†" class="headerlink" title="èŒä½ç®¡ç†"></a>èŒä½ç®¡ç†</h4><h5 id="å‰ç«¯éƒ¨åˆ†"><a href="#å‰ç«¯éƒ¨åˆ†" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h5><p><strong>PosMana.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div&gt;      &lt;el-input          size&#x3D;&quot;small&quot;          class&#x3D;&quot;addPosInput&quot;          placeholder&#x3D;&quot;æ·»åŠ èŒä½&quot;          prefix-icon&#x3D;&quot;el-icon-plus&quot;          v-model&#x3D;&quot;pos.name&quot;&gt;      &lt;&#x2F;el-input&gt;      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot;&gt;æ·»åŠ &lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;posManaMain&quot;&gt;    &lt;el-table          :data&#x3D;&quot;positions&quot;          border          stripe          style&#x3D;&quot;width: 70%&quot;&gt;        &lt;el-table-column            prop&#x3D;&quot;id&quot;            label&#x3D;&quot;ç¼–å·&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;name&quot;            label&#x3D;&quot;èŒä½åç§°&quot;            width&#x3D;&quot;120&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;createDate&quot;            label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;        &lt;&#x2F;el-table-column&gt;      &lt;&#x2F;el-table&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;PosMana&quot;,  data()&#123;    return &#123;      pos: &#123;        name: &#39;&#39;      &#125;,      positions: []    &#125;&#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;.addPosInput &#123;  width: 300px;  margin-right: 8px&#125;.posManaMain &#123;  margin-top: 10px;&#125;&lt;&#x2F;style&gt;</code></pre></div><h5 id="åç«¯éƒ¨åˆ†"><a href="#åç«¯éƒ¨åˆ†" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h5><p>å…ˆå†™æµ‹è¯•æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/basic/pos&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PositionController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PositionService positionService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> positionService.getAllPositions();    &#125;    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addPosition</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Position position)</span></span>&#123;        <span class="hljs-keyword">if</span> (positionService.addPosition(position) == <span class="hljs-number">1</span>)&#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥&quot;</span>);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updatePositions</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Position position)</span> </span>&#123;        <span class="hljs-keyword">if</span> (positionService.updatePositions(position) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deletePositionById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;        <span class="hljs-keyword">if</span> (positionService.deletePositionById(id) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);    &#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PositionService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PositionMapper positionMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> positionMapper.getAllPositions();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addPosition</span><span class="hljs-params">(Position position)</span> </span>&#123;        position.setEnabled(<span class="hljs-keyword">true</span>);        position.setCreateDate(<span class="hljs-keyword">new</span> Date());        <span class="hljs-keyword">return</span> positionMapper.insertSelective(position);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updatePositions</span><span class="hljs-params">(Position position)</span> </span>&#123;        <span class="hljs-keyword">return</span> positionMapper.updateByPrimaryKeySelective(position);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deletePositionById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> positionMapper.deleteByPrimaryKey(id);    &#125;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PositionMapper</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Position record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(Position record)</span></span>;    <span class="hljs-function">Position <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(Position record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(Position record)</span></span>;    <span class="hljs-function">List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>å¯¹åº”çš„xmlæ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllPositions&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  SELECT * FROM position;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>è¿™æ ·å°±å®Œæˆäº†å¯¹èŒä½ç®¡ç†çš„æ·»åŠ ï¼Œæ›´æ–°ï¼Œåˆ é™¤æ“ä½œ</p><h5 id="å‰åç«¯å¯¹æ¥"><a href="#å‰åç«¯å¯¹æ¥" class="headerlink" title="å‰åç«¯å¯¹æ¥"></a>å‰åç«¯å¯¹æ¥</h5><p>å…ˆé’ˆå¯¹PosManaè¿›è¡Œåˆ é™¤æ·»åŠ ç›¸å…³çš„è¡¥å……</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div&gt;      &lt;el-input          size&#x3D;&quot;small&quot;          class&#x3D;&quot;addPosInput&quot;          placeholder&#x3D;&quot;æ·»åŠ èŒä½&quot;          prefix-icon&#x3D;&quot;el-icon-plus&quot;          @keydown.enter.native&#x3D;&quot;addPosition&quot;          v-model&#x3D;&quot;pos.name&quot;&gt;      &lt;&#x2F;el-input&gt;      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addPosition&quot;&gt;æ·»åŠ &lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;posManaMain&quot;&gt;    &lt;el-table          :data&#x3D;&quot;positions&quot;          @selection-change&#x3D;&quot;handleSelectionChange&quot;          border          stripe          style&#x3D;&quot;width: 70%&quot;&gt;      &lt;el-table-column          type&#x3D;&quot;selection&quot;          width&#x3D;&quot;55&quot;&gt;      &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;id&quot;            label&#x3D;&quot;ç¼–å·&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;name&quot;            label&#x3D;&quot;èŒä½åç§°&quot;            width&#x3D;&quot;150&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;createDate&quot;            width&#x3D;&quot;150&quot;            label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;        &lt;&#x2F;el-table-column&gt;      &lt;el-table-column label&#x3D;&quot;æ“ä½œ&quot;&gt;        &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;          &lt;el-button              size&#x3D;&quot;mini&quot;              @click&#x3D;&quot;showEditView(scope.$index, scope.row)&quot;&gt;ç¼–è¾‘          &lt;&#x2F;el-button&gt;          &lt;el-button              size&#x3D;&quot;mini&quot;              type&#x3D;&quot;danger&quot;              @click&#x3D;&quot;handleDelete(scope.$index, scope.row)&quot;&gt;åˆ é™¤          &lt;&#x2F;el-button&gt;        &lt;&#x2F;template&gt;      &lt;&#x2F;el-table-column&gt;      &lt;&#x2F;el-table&gt;      &lt;el-button @click&#x3D;&quot;deleteMany&quot; type&#x3D;&quot;danger&quot; size&#x3D;&quot;small&quot; style&#x3D;&quot;margin-top: 8px&quot;                 :disabled&#x3D;&quot;multipleSelection.length&#x3D;&#x3D;0&quot;&gt;æ‰¹é‡åˆ é™¤      &lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;el-dialog        title&#x3D;&quot;ä¿®æ”¹èŒä½&quot;        :visible.sync&#x3D;&quot;dialogVisible&quot;        width&#x3D;&quot;30%&quot;&gt;      &lt;div&gt;        &lt;el-tag&gt;èŒä½åç§°&lt;&#x2F;el-tag&gt;        &lt;el-input class&#x3D;&quot;updatePosInput&quot; size&#x3D;&quot;small&quot; v-model&#x3D;&quot;updatePos.name&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;&#x2F;div&gt;      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt; &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;å– æ¶ˆ&lt;&#x2F;el-button&gt;    &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate&quot;&gt;ç¡® å®š&lt;&#x2F;el-button&gt;  &lt;&#x2F;span&gt;    &lt;&#x2F;el-dialog&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;PosMana&quot;,  data() &#123;    return &#123;      pos: &#123;        name: &#39;&#39;      &#125;,      dialogVisible: false,      updatePos: &#123;        name: &#39;&#39;,        enabled: false      &#125;,      positions: [],      multipleSelection: [],    &#125;  &#125;,  &#x2F;&#x2F; é’©å­å‡½æ•°  mounted() &#123;    this.initPositions();  &#125;,  methods:&#123;    initPositions() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.positions &#x3D; resp;        &#125;      &#125;)    &#125;,    handleSelectionChange(val) &#123;      this.multipleSelection &#x3D; val;    &#125;,    showEditView(index, data) &#123;      Object.assign(this.updatePos, data);      this.dialogVisible &#x3D; true;    &#125;,    handleDelete(index, data) &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ã€&#39; + data.name + &#39;ã€‘èŒä½, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initPositions();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,    addPosition() &#123;      if (this.pos.name) &#123;        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;, this.pos).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initPositions();            this.pos.name &#x3D; &#39;&#39;;          &#125;        &#125;)      &#125; else &#123;        this.$message.error(&#39;èŒä½åç§°ä¸å¯ä»¥ä¸ºç©º&#39;);      &#125;    &#125;,    doUpdate() &#123;      this.putRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;, this.updatePos).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.initPositions();          this.updatePos.name &#x3D; &#39;&#39;;          this.dialogVisible &#x3D; false;        &#125;      &#125;)    &#125;,    deleteMany() &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ &#39; + this.multipleSelection.length + &#39; æ¡è®°å½•, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        let ids &#x3D; &#39;?&#39;;        this.multipleSelection.forEach(item &#x3D;&gt; &#123;          ids +&#x3D; &#39;ids&#x3D;&#39; + item.id + &#39;&amp;&#39;;        &#125;)        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot; + ids).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initPositions();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;.addPosInput &#123;  width: 300px;  margin-right: 8px&#125;.posManaMain &#123;  margin-top: 10px;&#125;.updatePosInput &#123;  width: 200px;  margin-left: 8px;&#125;&lt;&#x2F;style&gt;</code></pre></div><p>åˆ é™¤çš„æ—¶å€™ï¼Œæœ‰äº›èŒä½å¹¶ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦åšå…¨å±€å¼‚å¸¸å¤„ç†</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestControllerAdvice</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalExceptionHandler</span> </span>&#123;    <span class="hljs-meta">@ExceptionHandler(SQLException.class)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">sqlException</span><span class="hljs-params">(SQLException e)</span></span>&#123;        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> MySQLIntegrityConstraintViolationException)&#123;            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;è¯¥æ•°æ®æœ‰å…³è”æ•°æ®ï¼Œæ“ä½œå¤±è´¥ï¼&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ•°æ®åº“å¼‚å¸¸ï¼Œæ“ä½œå¤±è´¥ï¼&quot;</span>);    &#125;&#125;</code></pre></div><p>å¹¶æ·»åŠ æ‰¹é‡åˆ é™¤çš„æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping(&quot;/&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deletePositionsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;    <span class="hljs-keyword">if</span> (positionService.deletePositionsByIds(ids) == ids.length) &#123;        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);&#125;</code></pre></div><p>å¹¶ç”Ÿæˆç›¸åº”çš„Serviceå’ŒMapperæ¥å£ï¼Œæœ€ç»ˆåœ¨mapper.xmlæ–‡ä»¶ä¸­å®Œå–„sqlè¯­å¥</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deletePositionsByIds&quot;</span>&gt;</span>  DELETE FROM position WHERE id in  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span>    #&#123;id&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></div><h4 id="èŒç§°ç®¡ç†"><a href="#èŒç§°ç®¡ç†" class="headerlink" title="èŒç§°ç®¡ç†"></a>èŒç§°ç®¡ç†</h4><h5 id="å‰ç«¯éƒ¨åˆ†-1"><a href="#å‰ç«¯éƒ¨åˆ†-1" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h5><p><strong>JobLevelMana.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div&gt;      &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;jl.name&quot; style&#x3D;&quot;width: 300px;&quot; prefix-icon&#x3D;&quot;el-icon-plus&quot;                placeholder&#x3D;&quot;æ·»åŠ èŒç§°&quot;&gt;      &lt;&#x2F;el-input&gt;      &lt;el-select v-model&#x3D;&quot;jl.titleLevel&quot; placeholder&#x3D;&quot;èŒç§°ç­‰çº§&quot; size&#x3D;&quot;small&quot;                 style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in titleLevels&quot;            :key&#x3D;&quot;item&quot;            :label&#x3D;&quot;item&quot;            :value&#x3D;&quot;item&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;æ·»åŠ &lt;&#x2F;el-button&gt;      &lt;&#x2F;div&gt;    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;      &lt;el-table          :data&#x3D;&quot;jls&quot;          border          size&#x3D;&quot;small&quot;          style&#x3D;&quot;width: 80%&quot;&gt;        &lt;el-table-column            type&#x3D;&quot;selection&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;id&quot;            label&#x3D;&quot;ç¼–å·&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;name&quot;            label&#x3D;&quot;èŒç§°åç§°&quot;            width&#x3D;&quot;150&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;titleLevel&quot;            label&#x3D;&quot;èŒç§°çº§åˆ«&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;createDate&quot;            label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;        &lt;&#x2F;el-table-column&gt;&lt;!--        &lt;el-table-column            label&#x3D;&quot;æ˜¯å¦å¯ç”¨&quot;&gt;          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;            &lt;el-tag type&#x3D;&quot;success&quot; v-if&#x3D;&quot;scope.row.enabled&quot;&gt;å·²å¯ç”¨&lt;&#x2F;el-tag&gt;            &lt;el-tag type&#x3D;&quot;danger&quot; v-else&gt;æœªå¯ç”¨&lt;&#x2F;el-tag&gt;          &lt;&#x2F;template&gt;        &lt;&#x2F;el-table-column&gt;--&gt;        &lt;el-table-column            label&#x3D;&quot;æ“ä½œ&quot;&gt;          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;            &lt;el-button size&#x3D;&quot;small&quot; &gt;ç¼–è¾‘&lt;&#x2F;el-button&gt;            &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;danger&quot; &gt;åˆ é™¤&lt;&#x2F;el-button&gt;          &lt;&#x2F;template&gt;        &lt;&#x2F;el-table-column&gt;      &lt;&#x2F;el-table&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;JobLevelMana&quot;,  data() &#123;    return &#123;      jl: &#123;        name: &#39;&#39;,        titleLevel: &#39;&#39;      &#125;,      jls: [],      titleLevels: [        &#39;æ­£é«˜çº§&#39;,        &#39;å‰¯é«˜çº§&#39;,        &#39;ä¸­çº§&#39;,        &#39;åˆçº§&#39;,        &#39;å‘˜çº§&#39;,      ]    &#125;  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;&lt;&#x2F;style&gt;</code></pre></div><h5 id="åç«¯éƒ¨åˆ†-1"><a href="#åç«¯éƒ¨åˆ†-1" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h5><p><strong>æ¥å£</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/basic/joblevel&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobLevelController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    JobLevelService jobLevelService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> jobLevelService.getAllJobLevels();    &#125;    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addJobLevel</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> JobLevel jobLevel)</span> </span>&#123;        <span class="hljs-keyword">if</span> (jobLevelService.addJobLevel(jobLevel) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateJobLevelById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> JobLevel jobLevel)</span> </span>&#123;        <span class="hljs-keyword">if</span> (jobLevelService.updateJobLevelById(jobLevel) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteJobLevelById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;        <span class="hljs-keyword">if</span> (jobLevelService.deleteJobLevelById(id) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;        <span class="hljs-keyword">if</span> (jobLevelService.deleteJobLevelsByIds(ids) == ids.length) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);    &#125;&#125;</code></pre></div><p>ä¸šåŠ¡ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobLevelService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    JobLevelMapper jobLevelMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span> </span>&#123;     <span class="hljs-keyword">return</span> jobLevelMapper.getAllJobLevels();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addJobLevel</span><span class="hljs-params">(JobLevel jobLevel)</span> </span>&#123;        jobLevel.setCreateDate(<span class="hljs-keyword">new</span> Date());        jobLevel.setEnabled(<span class="hljs-keyword">true</span>);        <span class="hljs-keyword">return</span> jobLevelMapper.insertSelective(jobLevel);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateJobLevelById</span><span class="hljs-params">(JobLevel jobLevel)</span> </span>&#123;        <span class="hljs-keyword">return</span> jobLevelMapper.updateByPrimaryKeySelective(jobLevel);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteJobLevelById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> jobLevelMapper.deleteByPrimaryKey(id);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;        <span class="hljs-keyword">return</span> jobLevelMapper.deleteJobLevelsByIds(ids);    &#125;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JobLevelMapper</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(JobLevel record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(JobLevel record)</span></span>;    <span class="hljs-function">JobLevel <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(JobLevel record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(JobLevel record)</span></span>;    <span class="hljs-function">List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span></span>;    <span class="hljs-function">Integer <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> Integer[] ids)</span></span>;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllJobLevels&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  SELECT * FROM joblevel;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteJobLevelsByIds&quot;</span>&gt;</span>  delete from joblevel where id in  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>    #&#123;id&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></div><h5 id="å‰åç«¯å¯¹æ¥-1"><a href="#å‰åç«¯å¯¹æ¥-1" class="headerlink" title="å‰åç«¯å¯¹æ¥"></a>å‰åç«¯å¯¹æ¥</h5><p>ä¸»è¦å¯¹æ·»åŠ ï¼Œç¼–è¾‘ï¼Œåˆ é™¤æŒ‰é’®è¿›è¡Œè®¾è®¡</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div&gt;      &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;jl.name&quot; style&#x3D;&quot;width: 300px;&quot; prefix-icon&#x3D;&quot;el-icon-plus&quot;                placeholder&#x3D;&quot;æ·»åŠ èŒç§°&quot;&gt;      &lt;&#x2F;el-input&gt;      &lt;el-select v-model&#x3D;&quot;jl.titleLevel&quot; placeholder&#x3D;&quot;èŒç§°ç­‰çº§&quot; size&#x3D;&quot;small&quot;                 style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in titleLevels&quot;            :key&#x3D;&quot;item&quot;            :label&#x3D;&quot;item&quot;            :value&#x3D;&quot;item&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot; @click&#x3D;&quot;addJobLevel&quot;&gt;æ·»åŠ &lt;&#x2F;el-button&gt;      &lt;&#x2F;div&gt;    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;      &lt;el-table          :data&#x3D;&quot;jls&quot;          border          size&#x3D;&quot;small&quot;          @selection-change&#x3D;&quot;handleSelectionChange&quot;          style&#x3D;&quot;width: 80%&quot;&gt;        &lt;el-table-column            type&#x3D;&quot;selection&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;id&quot;            label&#x3D;&quot;ç¼–å·&quot;            width&#x3D;&quot;55&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;name&quot;            label&#x3D;&quot;èŒç§°åç§°&quot;            width&#x3D;&quot;150&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;titleLevel&quot;            label&#x3D;&quot;èŒç§°çº§åˆ«&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            prop&#x3D;&quot;createDate&quot;            label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            label&#x3D;&quot;æ˜¯å¦å¯ç”¨&quot;&gt;          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;            &lt;el-tag type&#x3D;&quot;success&quot; v-if&#x3D;&quot;scope.row.enabled&quot;&gt;å·²å¯ç”¨&lt;&#x2F;el-tag&gt;            &lt;el-tag type&#x3D;&quot;info&quot; v-else&gt;æœªå¯ç”¨&lt;&#x2F;el-tag&gt;          &lt;&#x2F;template&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column            label&#x3D;&quot;æ“ä½œ&quot;&gt;          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;            &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;showEditView(scope.row)&quot;&gt;ç¼–è¾‘&lt;&#x2F;el-button&gt;            &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;deleteHandler(scope.row)&quot;&gt;åˆ é™¤&lt;&#x2F;el-button&gt;          &lt;&#x2F;template&gt;        &lt;&#x2F;el-table-column&gt;      &lt;&#x2F;el-table&gt;      &lt;el-button type&#x3D;&quot;danger&quot; size&#x3D;&quot;small&quot; style&#x3D;&quot;margin-top: 10px&quot; :disabled&#x3D;&quot;multipleSelection.length&#x3D;&#x3D;0&quot;                 @click&#x3D;&quot;deleteMany&quot;&gt;æ‰¹é‡åˆ é™¤      &lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;el-dialog        title&#x3D;&quot;ä¿®æ”¹èŒç§°&quot;        :visible.sync&#x3D;&quot;dialogVisible&quot;        width&#x3D;&quot;30%&quot;&gt;      &lt;div&gt;        &lt;table&gt;          &lt;tr&gt;            &lt;td&gt;              &lt;el-tag&gt;èŒç§°å&lt;&#x2F;el-tag&gt;            &lt;&#x2F;td&gt;            &lt;td&gt;              &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;updateJl.name&quot;&gt;&lt;&#x2F;el-input&gt;            &lt;&#x2F;td&gt;          &lt;&#x2F;tr&gt;          &lt;tr&gt;            &lt;td&gt;              &lt;el-tag&gt;èŒç§°çº§åˆ«&lt;&#x2F;el-tag&gt;            &lt;&#x2F;td&gt;            &lt;td&gt;              &lt;el-select v-model&#x3D;&quot;updateJl.titleLevel&quot; placeholder&#x3D;&quot;èŒç§°ç­‰çº§&quot; size&#x3D;&quot;small&quot;                         style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;                &lt;el-option                    v-for&#x3D;&quot;item in titleLevels&quot;                    :key&#x3D;&quot;item&quot;                    :label&#x3D;&quot;item&quot;                    :value&#x3D;&quot;item&quot;&gt;                &lt;&#x2F;el-option&gt;              &lt;&#x2F;el-select&gt;            &lt;&#x2F;td&gt;          &lt;&#x2F;tr&gt;          &lt;tr&gt;            &lt;td&gt;              &lt;el-tag&gt;æ˜¯å¦å¯ç”¨&lt;&#x2F;el-tag&gt;            &lt;&#x2F;td&gt;            &lt;td&gt;              &lt;el-switch                  v-model&#x3D;&quot;updateJl.enabled&quot;                  active-text&#x3D;&quot;å¯ç”¨&quot;                  inactive-text&#x3D;&quot;ç¦ç”¨&quot;&gt;              &lt;&#x2F;el-switch&gt;            &lt;&#x2F;td&gt;          &lt;&#x2F;tr&gt;        &lt;&#x2F;table&gt;      &lt;&#x2F;div&gt;      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;    &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;å– æ¶ˆ&lt;&#x2F;el-button&gt;    &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate&quot;&gt;ç¡® å®š&lt;&#x2F;el-button&gt;  &lt;&#x2F;span&gt;    &lt;&#x2F;el-dialog&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;JobLevelMana&quot;,  data() &#123;    return &#123;      multipleSelection: [],      dialogVisible: false,      updateJl: &#123;        name: &#39;&#39;,        titleLevel: &#39;&#39;,        enabled: false      &#125;,      jl: &#123;        name: &#39;&#39;,        titleLevel: &#39;&#39;      &#125;,      jls: [],      titleLevels: [        &#39;æ­£é«˜çº§&#39;,        &#39;å‰¯é«˜çº§&#39;,        &#39;ä¸­çº§&#39;,        &#39;åˆçº§&#39;,        &#39;å‘˜çº§&#39;,      ]    &#125;  &#125;,  mounted() &#123;    this.initJls();  &#125;,  methods: &#123;    handleSelectionChange(val) &#123;      this.multipleSelection &#x3D; val;    &#125;,    deleteMany() &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ &#39; + this.multipleSelection.length + &#39; æ¡è®°å½•, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        let ids &#x3D; &#39;?&#39;;        this.multipleSelection.forEach(item &#x3D;&gt; &#123;          ids +&#x3D; &#39;ids&#x3D;&#39; + item.id + &#39;&amp;&#39;;        &#125;)        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot; + ids).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initJls();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,    doUpdate() &#123;      this.putRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;, this.updateJl).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.initJls();          this.dialogVisible &#x3D; false;        &#125;      &#125;)    &#125;,    showEditView(data) &#123;      Object.assign(this.updateJl, data);      this.dialogVisible &#x3D; true;    &#125;,    deleteHandler(data) &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹… &#39; + data.name + &#39; èŒç§°, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initJls();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,    addJobLevel() &#123;      if (this.jl.name &amp;&amp; this.jl.titleLevel) &#123;        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;, this.jl).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initJls();          &#125;        &#125;);      &#125; else &#123;        this.$message.error(&quot;æ·»åŠ å­—æ®µä¸å¯ä»¥ä¸ºç©º!&quot;);      &#125;    &#125;,    initJls() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.jls &#x3D; resp;          this.jl &#x3D; &#123;            name: &#39;&#39;,            titleLevel: &#39;&#39;          &#125;;        &#125;      &#125;)    &#125;  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;&lt;&#x2F;style&gt;</code></pre></div><h4 id="æƒé™ç»„"><a href="#æƒé™ç»„" class="headerlink" title="æƒé™ç»„"></a>æƒé™ç»„</h4><h5 id="å‰ç«¯éƒ¨åˆ†-2"><a href="#å‰ç«¯éƒ¨åˆ†-2" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h5><p><strong>PermissMana.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div class&#x3D;&quot;permissManaTool&quot;&gt;      &lt;el-input size&#x3D;&quot;small&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥è§’è‰²è‹±æ–‡å&quot; v-model&#x3D;&quot;role.name&quot;&gt;        &lt;template slot&#x3D;&quot;prepend&quot;&gt;ROLE_&lt;&#x2F;template&gt;      &lt;&#x2F;el-input&gt;      &lt;el-input size&#x3D;&quot;small&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥è§’è‰²ä¸­æ–‡å&quot; v-model&#x3D;&quot;role.nameZh&quot;                @keydown.enter.native&#x3D;&quot;doAddRole&quot;&gt;      &lt;&#x2F;el-input&gt;      &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot; icon&#x3D;&quot;el-icon-plus&quot; @click&#x3D;&quot;doAddRole&quot;&gt;æ·»åŠ è§’è‰²&lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;permissManaMain&quot;&gt;      &lt;el-collapse v-model&#x3D;&quot;activeName&quot; @change&#x3D;&quot;change&quot;&gt;        &lt;el-collapse-item :title&#x3D;&quot;r.nameZh&quot; :name&#x3D;&quot;r.id&quot; v-for&#x3D;&quot;(r,index) in roles&quot; :key&#x3D;&quot;index&quot;&gt;          &lt;el-card class&#x3D;&quot;box-card&quot;&gt;            &lt;div slot&#x3D;&quot;header&quot; class&#x3D;&quot;clearfix&quot;&gt;              &lt;span&gt;å¯è®¿é—®çš„èµ„æº&lt;&#x2F;span&gt;              &lt;el-button style&#x3D;&quot;float: right; padding: 3px 0;color: #ff0000;&quot; icon&#x3D;&quot;el-icon-delete&quot;                         type&#x3D;&quot;text&quot; @click&#x3D;&quot;deleteRole(r)&quot;&gt;&lt;&#x2F;el-button&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;              &lt;el-tree                  show-checkbox                  node-key&#x3D;&quot;id&quot;                  ref&#x3D;&quot;tree&quot;                  :key&#x3D;&quot;index&quot;                  :default-checked-keys&#x3D;&quot;selectedMenus&quot;                  :data&#x3D;&quot;allmenus&quot; :props&#x3D;&quot;defaultProps&quot;&gt;              &lt;&#x2F;el-tree&gt;              &lt;div style&#x3D;&quot;display: flex;justify-content: flex-end&quot;&gt;                &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;cancelUpdate&quot;&gt;å–æ¶ˆä¿®æ”¹&lt;&#x2F;el-button&gt;                &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate(r.id,index)&quot;&gt;ç¡®è®¤ä¿®æ”¹&lt;&#x2F;el-button&gt;              &lt;&#x2F;div&gt;            &lt;&#x2F;div&gt;          &lt;&#x2F;el-card&gt;        &lt;&#x2F;el-collapse-item&gt;      &lt;&#x2F;el-collapse&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;PermissMana&quot;,  data() &#123;    return &#123;      role: &#123;        name: &#39;&#39;,        nameZh: &#39;&#39;      &#125;,      activeName: -1,      roles: [],      allmenus: [],      selectedMenus: [],      defaultProps: &#123;        children: &#39;children&#39;,        label: &#39;name&#39;      &#125;    &#125;  &#125;,  mounted() &#123;    this.initRoles();  &#125;,  methods: &#123;    initRoles() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.roles &#x3D; resp;        &#125;      &#125;)    &#125;,    change(rid) &#123;      if (rid) &#123;        this.initAllMenus();        this.initSelectedMenus(rid);      &#125;    &#125;,    doUpdate(rid, index) &#123;      let tree &#x3D; this.$refs.tree[index];      let selectedKeys &#x3D; tree.getCheckedKeys(true);      let url &#x3D; &#39;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;?rid&#x3D;&#39; + rid;      selectedKeys.forEach(key &#x3D;&gt; &#123;        url +&#x3D; &#39;&amp;mids&#x3D;&#39; + key;      &#125;)      this.putRequest(url).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.activeName &#x3D; -1;        &#125;      &#125;)    &#125;,    cancelUpdate() &#123;      this.activeName &#x3D; -1;    &#125;,    initAllMenus() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;menus&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.allmenus &#x3D; resp;        &#125;      &#125;)    &#125;,    initSelectedMenus(rid) &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;mids&#x2F;&quot; + rid).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.selectedMenus &#x3D; resp;        &#125;      &#125;)    &#125;,    doAddRole() &#123;      if (this.role.name &amp;&amp; this.role.nameZh) &#123;        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;role&quot;, this.role).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.role.name &#x3D; &#39;&#39;;            this.role.nameZh &#x3D; &#39;&#39;;            this.initRoles();          &#125;        &#125;)      &#125; else &#123;        this.$message.error(&#39;æ•°æ®ä¸å¯ä»¥ä¸ºç©º&#39;);      &#125;    &#125;,    deleteRole(role) &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ &#39; + role.nameZh + &#39; è§’è‰², æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;role&#x2F;&quot; + role.id).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initRoles();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,  &#125;  &#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;.permissManaTool &#123;  display: flex;  justify-content: flex-start;&#125;.permissManaTool .el-input &#123;  width: 300px;  margin-right: 6px;&#125;.permissManaMain &#123;  margin-top: 10px;  width: 700px;&#125;&lt;&#x2F;style&gt;</code></pre></div><h5 id="åç«¯éƒ¨åˆ†-2"><a href="#åç«¯éƒ¨åˆ†-2" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h5><p><strong>æµ‹è¯•æ¥å£ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/basic/permiss&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RoleService roleService;    <span class="hljs-meta">@Autowired</span>    MenuService menuService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> roleService.getAllRoles();    &#125;    <span class="hljs-meta">@GetMapping(&quot;/menus&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuService.getAllMenus();    &#125;    <span class="hljs-meta">@GetMapping(&quot;/mids/&#123;rid&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getMidsByRid</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer rid)</span> </span>&#123;        <span class="hljs-keyword">return</span> menuService.getMidsByRid(rid);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateMenuRole</span><span class="hljs-params">(Integer rid, Integer[] mids)</span> </span>&#123;        <span class="hljs-keyword">if</span> (menuService.updateMenuRole(rid, mids)) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@PostMapping(&quot;/role&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addRole</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Role role)</span> </span>&#123;        <span class="hljs-keyword">if</span> (roleService.addRole(role) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/role/&#123;rid&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteRoleById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer rid)</span> </span>&#123;        <span class="hljs-keyword">if</span> (roleService.deleteRoleById(rid) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);    &#125;&#125;</code></pre></div><p>ç”¨æˆ·ç»‘å®šèœå•çš„æƒé™ï¼Œæ‰€ä»¥å®šä¹‰<strong>MenuService</strong>å’Œ<strong>RoleService</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuMapper menuMapper;    <span class="hljs-meta">@Autowired</span>    MenuRoleMapper menuRoleMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getMenusByHrId(((Hr) SecurityContextHolder.getContext().getAuthentication().getPrincipal()).getId());    &#125;    <span class="hljs-comment">//@Cacheable</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getAllMenus();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getMidsByRid</span><span class="hljs-params">(Integer rid)</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getMidsByRid(rid);    &#125;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateMenuRole</span><span class="hljs-params">(Integer rid, Integer[] mids)</span> </span>&#123;        menuRoleMapper.deleteByRid(rid);        <span class="hljs-keyword">if</span> (mids == <span class="hljs-keyword">null</span> || mids.length == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;        Integer result = menuRoleMapper.insertRecord(rid, mids);        <span class="hljs-keyword">return</span> result==mids.length;    &#125;&#125;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RoleMapper roleMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> roleMapper.getAllRoles();    &#125;      <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addRole</span><span class="hljs-params">(Role role)</span> </span>&#123;      <span class="hljs-keyword">if</span> (!role.getName().startsWith(<span class="hljs-string">&quot;ROLE_&quot;</span>))&#123;        role.setName(<span class="hljs-string">&quot;ROLE_&quot;</span> + role.getName());      &#125;      <span class="hljs-keyword">return</span> roleMapper.insert(role);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteRoleById</span><span class="hljs-params">(Integer rid)</span> </span>&#123;        <span class="hljs-keyword">return</span> roleMapper.deleteByPrimaryKey(rid);    &#125;&#125;</code></pre></div><p><strong>Menumapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MenuWithChildren&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id1&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name1&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id3&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name3&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllMenus&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;MenuWithChildren&quot;</span>&gt;</span>    SELECT m1.`id` as id1,m1.`name` as name1,m2.`id` as id2,m2.`name` as name2,m3.`id` as id3,m3.`name` as name3    FROM menu m1,menu m2,menu m3    WHERE m1.`id`=m2.`parentId` AND m2.`id`=m3.`parentId` AND m3.`enabled`=true    ORDER BY m1.`id`,m2.`id`,m3.`id`  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMidsByRid&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;</span>    select mid from menu_role where rid=#&#123;rid&#125;;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p><strong>Rolemapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllRoles&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  select * from role;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>ç”±äºéœ€è¦æ›´æ–°æ¯ä¸ª<strong>Role</strong>çš„ç®¡ç†æƒé™ï¼Œæ‰€ä»¥è¿˜è¦æ›´æ–°<strong>MenuRoleMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteByRid&quot;</span>&gt;</span>  delete from menu_role where rid=#&#123;rid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertRecord&quot;</span>&gt;</span>insert into menu_role (mid,rid) values<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;mids&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;mid&quot;</span>&gt;</span>(#&#123;mid&#125;,#&#123;rid&#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><h4 id="éƒ¨é—¨ç®¡ç†"><a href="#éƒ¨é—¨ç®¡ç†" class="headerlink" title="éƒ¨é—¨ç®¡ç†"></a>éƒ¨é—¨ç®¡ç†</h4><h5 id="å‰ç«¯éƒ¨åˆ†-3"><a href="#å‰ç«¯éƒ¨åˆ†-3" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h5><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div style&#x3D;&quot;width: 500px;&quot;&gt;    &lt;el-input        placeholder&#x3D;&quot;è¯·è¾“å…¥éƒ¨é—¨åç§°è¿›è¡Œæœç´¢...&quot;        prefix-icon&#x3D;&quot;el-icon-search&quot;        v-model&#x3D;&quot;filterText&quot;&gt;    &lt;&#x2F;el-input&gt;    &lt;el-tree        style&#x3D;&quot;margin-top: 10px;&quot;        :data&#x3D;&quot;deps&quot;        :props&#x3D;&quot;defaultProps&quot;        :expand-on-click-node&#x3D;&quot;false&quot;        :filter-node-method&#x3D;&quot;filterNode&quot;        ref&#x3D;&quot;tree&quot;&gt;      &lt;span class&#x3D;&quot;custom-tree-node&quot; style&#x3D;&quot;display: flex;justify-content:space-between;width: 100%;&quot;                  slot-scope&#x3D;&quot;&#123; node, data &#125;&quot;&gt;        &lt;span&gt;&#123;&#123;data.name &#125;&#125;&lt;&#x2F;span&gt;        &lt;span&gt;          &lt;el-button              type&#x3D;&quot;primary&quot;              size&#x3D;&quot;small&quot;              class&#x3D;&quot;depBtn&quot;              @click&#x3D;&quot;() &#x3D;&gt; showAddDepView(data)&quot;&gt;            æ·»åŠ éƒ¨é—¨          &lt;&#x2F;el-button&gt;          &lt;el-button              type&#x3D;&quot;danger&quot;              size&#x3D;&quot;small&quot;              class&#x3D;&quot;depBtn&quot;              @click&#x3D;&quot;() &#x3D;&gt; deleteDep(data)&quot;&gt;            åˆ é™¤éƒ¨é—¨          &lt;&#x2F;el-button&gt;        &lt;&#x2F;span&gt;      &lt;&#x2F;span&gt;    &lt;&#x2F;el-tree&gt;    &lt;el-dialog        title&#x3D;&quot;æ·»åŠ éƒ¨é—¨&quot;        :visible.sync&#x3D;&quot;dialogVisible&quot;        width&#x3D;&quot;30%&quot;&gt;      &lt;div&gt;        &lt;table&gt;          &lt;tr&gt;            &lt;td&gt;              &lt;el-tag&gt;ä¸Šçº§éƒ¨é—¨&lt;&#x2F;el-tag&gt;            &lt;&#x2F;td&gt;            &lt;td&gt;&#123;&#123;pname&#125;&#125;&lt;&#x2F;td&gt;          &lt;&#x2F;tr&gt;          &lt;tr&gt;            &lt;td&gt;              &lt;el-tag&gt;éƒ¨é—¨åç§°&lt;&#x2F;el-tag&gt;            &lt;&#x2F;td&gt;            &lt;td&gt;              &lt;el-input v-model&#x3D;&quot;dep.name&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥éƒ¨é—¨åç§°...&quot;&gt;&lt;&#x2F;el-input&gt;            &lt;&#x2F;td&gt;          &lt;&#x2F;tr&gt;        &lt;&#x2F;table&gt;      &lt;&#x2F;div&gt;      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;    &lt;el-button @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;å– æ¶ˆ&lt;&#x2F;el-button&gt;    &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doAddDep&quot;&gt;ç¡® å®š&lt;&#x2F;el-button&gt;      &lt;&#x2F;span&gt;  &lt;&#x2F;el-dialog&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;DepMana&quot;,  data() &#123;    return &#123;      filterText: &#39;&#39;,      deps: [],      defaultProps: &#123;        children: &#39;children&#39;,        label: &#39;name&#39;      &#125;,      pname: &#39;&#39;,      dep: &#123;        name: &#39;&#39;,        parentId: -1      &#125;,      dialogVisible: false,    &#125;  &#125;,  watch: &#123;    filterText(val) &#123;      this.$refs.tree.filter(val);    &#125;  &#125;,  mounted() &#123;    this.initDeps();  &#125;,  methods : &#123;    initDeps() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.deps &#x3D; resp;        &#125;      &#125;)    &#125;,    filterNode(value, data) &#123;      if (!value) return true;      return data.name.indexOf(value) !&#x3D;&#x3D; -1;    &#125;,    showAddDepView(data) &#123;      this.pname &#x3D; data.name;      this.dep.parentId &#x3D; data.id;      this.dialogVisible &#x3D; true;    &#125;,    initDep() &#123;      this.dep &#x3D; &#123;        name: &#39;&#39;,        parentId: -1      &#125;      this.pname &#x3D; &#39;&#39;;    &#125;,    doAddDep() &#123;      this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;, this.dep).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.addDep2Deps(this.deps, resp.obj);          this.dialogVisible &#x3D; false;          &#x2F;&#x2F;åˆå§‹åŒ–å˜é‡          this.initDep();        &#125;      &#125;)    &#125;,    addDep2Deps(deps, dep) &#123;      for (let i &#x3D; 0; i &lt; deps.length; i++) &#123;        let d &#x3D; deps[i];        if (d.id &#x3D;&#x3D; dep.parentId) &#123;          d.children &#x3D; d.children.concat(dep);          if (d.children.length &gt; 0) &#123;            d.parent &#x3D; true;          &#125;          return;        &#125; else &#123;          this.addDep2Deps(d.children, dep);        &#125;      &#125;    &#125;,    deleteDep(data) &#123;      if (data.parent) &#123;        this.$message.error(&quot;çˆ¶éƒ¨é—¨åˆ é™¤å¤±è´¥&quot;);      &#125; else &#123;        this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ &#39; + data.name + &#39; éƒ¨é—¨, æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;          confirmButtonText: &#39;ç¡®å®š&#39;,          cancelButtonText: &#39;å–æ¶ˆ&#39;,          type: &#39;warning&#39;        &#125;).then(() &#x3D;&gt; &#123;          this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;+data.id).then(resp&#x3D;&gt;&#123;            if (resp) &#123;              this.removeDepFromDeps(null,this.deps,data.id);            &#125;          &#125;)        &#125;).catch(() &#x3D;&gt; &#123;          this.$message(&#123;            type: &#39;info&#39;,            message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;          &#125;);        &#125;);      &#125;    &#125;,    removeDepFromDeps(p,deps, id) &#123;      for(let i &#x3D; 0;i &lt; deps.length;i++)&#123;        let d &#x3D; deps[i];        if (d.id &#x3D;&#x3D; id) &#123;          deps.splice(i, 1);          if (deps.length &#x3D;&#x3D; 0) &#123;            p.parent &#x3D; false;          &#125;          return;        &#125;else&#123;          this.removeDepFromDeps(d,d.children, id);        &#125;      &#125;    &#125;,  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;  .depBtn &#123;    padding: 2px;  &#125;&lt;&#x2F;style&gt;</code></pre></div><h5 id="åç«¯éƒ¨åˆ†-3"><a href="#åç«¯éƒ¨åˆ†-3" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h5><p>å› ä¸ºè¿™éƒ¨åˆ†SQLä»£ç æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œç”Ÿæˆæ·»åŠ å’Œåˆ é™¤éƒ¨é—¨çš„å­˜å‚¨è¿‡ç¨‹</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ·»åŠ <span class="hljs-keyword">create</span>    definer <span class="hljs-operator">=</span> root@`<span class="hljs-number">172.16</span><span class="hljs-number">.211</span><span class="hljs-number">.4</span>` <span class="hljs-keyword">procedure</span> addDep(<span class="hljs-keyword">IN</span> depName <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>), <span class="hljs-keyword">IN</span> parentId <span class="hljs-type">int</span>, <span class="hljs-keyword">IN</span> enabled tinyint(<span class="hljs-number">1</span>),                                                   <span class="hljs-keyword">OUT</span> <span class="hljs-keyword">result</span> <span class="hljs-type">int</span>, <span class="hljs-keyword">OUT</span> result2 <span class="hljs-type">int</span>)<span class="hljs-keyword">begin</span>  <span class="hljs-keyword">declare</span> did <span class="hljs-type">int</span>;  <span class="hljs-keyword">declare</span> pDepPath <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>);  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> department <span class="hljs-keyword">set</span> name<span class="hljs-operator">=</span>depName,parentId<span class="hljs-operator">=</span>parentId,enabled<span class="hljs-operator">=</span>enabled;  <span class="hljs-keyword">select</span> row_count() <span class="hljs-keyword">into</span> <span class="hljs-keyword">result</span>;  <span class="hljs-keyword">select</span> last_insert_id() <span class="hljs-keyword">into</span> did;  <span class="hljs-keyword">set</span> result2<span class="hljs-operator">=</span>did;  <span class="hljs-keyword">select</span> depPath <span class="hljs-keyword">into</span> pDepPath <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>parentId;  update department <span class="hljs-keyword">set</span> depPath<span class="hljs-operator">=</span>concat(pDepPath,<span class="hljs-string">&#x27;.&#x27;</span>,did) <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did;  update department <span class="hljs-keyword">set</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">true</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>parentId;<span class="hljs-keyword">end</span>;#åˆ é™¤<span class="hljs-keyword">create</span>    definer <span class="hljs-operator">=</span> root@`<span class="hljs-number">172.16</span><span class="hljs-number">.211</span><span class="hljs-number">.4</span>` <span class="hljs-keyword">procedure</span> deleteDep(<span class="hljs-keyword">IN</span> did <span class="hljs-type">int</span>, <span class="hljs-keyword">OUT</span> <span class="hljs-keyword">result</span> <span class="hljs-type">int</span>)<span class="hljs-keyword">begin</span>  <span class="hljs-keyword">declare</span> ecount <span class="hljs-type">int</span>;  <span class="hljs-keyword">declare</span> pid <span class="hljs-type">int</span>;  <span class="hljs-keyword">declare</span> pcount <span class="hljs-type">int</span>;  <span class="hljs-keyword">declare</span> a <span class="hljs-type">int</span>;  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> a <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did <span class="hljs-keyword">and</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span>;  if a<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-number">-2</span>;  <span class="hljs-keyword">else</span>  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> ecount <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> departmentId<span class="hljs-operator">=</span>did;  if ecount<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-number">-1</span>;  <span class="hljs-keyword">else</span>  <span class="hljs-keyword">select</span> parentId <span class="hljs-keyword">into</span> pid <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did;  <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did <span class="hljs-keyword">and</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span>;  <span class="hljs-keyword">select</span> row_count() <span class="hljs-keyword">into</span> <span class="hljs-keyword">result</span>;  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> pcount <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> parentId<span class="hljs-operator">=</span>pid;  if pcount<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> update department <span class="hljs-keyword">set</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>pid;  <span class="hljs-keyword">end</span> if;  <span class="hljs-keyword">end</span> if;  <span class="hljs-keyword">end</span> if;<span class="hljs-keyword">end</span>;</code></pre></div><p>å¯¹<strong>Department</strong>å®ä½“ç±»è¿›è¡Œä¿®æ”¹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Integer parentId;    <span class="hljs-keyword">private</span> String depPath;    <span class="hljs-keyword">private</span> Boolean enabled;    <span class="hljs-keyword">private</span> Boolean isParent;    <span class="hljs-keyword">private</span> List&lt;Department&gt; children = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">private</span> Integer result;&#125;</code></pre></div><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/basic/department&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    DepartmentService departmentService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Department&gt; <span class="hljs-title">getAllDepartments</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> departmentService.getAllDepartments();    &#125;    <span class="hljs-comment">//è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</span>    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addDep</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Department dep)</span> </span>&#123;        departmentService.addDep(dep);        <span class="hljs-keyword">if</span> (dep.getResult() == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>, dep);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteDepById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;        Department dep = <span class="hljs-keyword">new</span> Department();        dep.setId(id);        departmentService.deleteDepById(dep);        <span class="hljs-keyword">if</span> (dep.getResult() == -<span class="hljs-number">2</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;è¯¥éƒ¨é—¨ä¸‹æœ‰å­éƒ¨é—¨ï¼Œåˆ é™¤å¤±è´¥&quot;</span>);        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dep.getResult() == -<span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;è¯¥éƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œåˆ é™¤å¤±è´¥&quot;</span>);        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dep.getResult() == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    DepartmentMapper departmentMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Department&gt; <span class="hljs-title">getAllDepartments</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> departmentMapper.getAllDepartmentsByParentId(-<span class="hljs-number">1</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addDep</span><span class="hljs-params">(Department dep)</span> </span>&#123;        dep.setEnabled(<span class="hljs-keyword">true</span>);        departmentMapper.addDep(dep);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteDepById</span><span class="hljs-params">(Department dep)</span> </span>&#123;        departmentMapper.deleteDepById(dep);    &#125;&#125;</code></pre></div><p><strong>Mapperæ¥å£</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DepartmentMapper</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Department record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(Department record)</span></span>;    <span class="hljs-function">Department <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(Department record)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(Department record)</span></span>;    <span class="hljs-function">List&lt;Department&gt; <span class="hljs-title">getAllDepartmentsByParentId</span><span class="hljs-params">(Integer pid)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addDep</span><span class="hljs-params">(Department dep)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteDepById</span><span class="hljs-params">(Department dep)</span></span>;    <span class="hljs-function">List&lt;Department&gt; <span class="hljs-title">getAllDepartmentsWithOutChildren</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è°ƒç”¨å­˜å‚¨è¿‡ç¨‹--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addDep&quot;</span> <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span>&gt;</span>    call addDep(#&#123;name,mode=IN,jdbcType=VARCHAR&#125;,#&#123;parentId,mode=IN,jdbcType=INTEGER&#125;,        #&#123;enabled,mode=IN,jdbcType=BOOLEAN&#125;,#&#123;result,mode=OUT,jdbcType=INTEGER&#125;,#&#123;id,mode=OUT,jdbcType=INTEGER&#125;)  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteDepById&quot;</span> <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span>&gt;</span>    call deleteDep(#&#123;id,mode=IN,jdbcType=INTEGER&#125;,#&#123;result,mode=OUT,jdbcType=INTEGER&#125;)  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h3 id="æ“ä½œå‘˜ç®¡ç†"><a href="#æ“ä½œå‘˜ç®¡ç†" class="headerlink" title="æ“ä½œå‘˜ç®¡ç†"></a>æ“ä½œå‘˜ç®¡ç†</h3><h4 id="å‰ç«¯éƒ¨åˆ†-4"><a href="#å‰ç«¯éƒ¨åˆ†-4" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h4><p>åœ¨<strong>SysHr.vue</strong>ä¸­å®Œå–„ä»¥ä¸‹éƒ¨åˆ†</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div style&#x3D;&quot;margin-top: 10px;display: flex;justify-content: center&quot;&gt;      &lt;el-input v-model&#x3D;&quot;keywords&quot; placeholder&#x3D;&quot;é€šè¿‡ç”¨æˆ·åæœç´¢ç”¨æˆ·&quot; prefix-icon&#x3D;&quot;el-icon-search&quot;                style&#x3D;&quot;width: 400px;margin-right: 10px&quot; @keydown.enter.native&#x3D;&quot;doSearch&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;el-button icon&#x3D;&quot;el-icon-search&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doSearch&quot;&gt;æœç´¢&lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;hr-container&quot;&gt;      &lt;el-card class&#x3D;&quot;hr-card&quot; v-for&#x3D;&quot;(hr,index) in hrs&quot; :key&#x3D;&quot;index&quot;&gt;        &lt;div slot&#x3D;&quot;header&quot; class&#x3D;&quot;clearfix&quot;&gt;          &lt;span&gt;&#123;&#123;hr.name&#125;&#125;&lt;&#x2F;span&gt;          &lt;el-button style&#x3D;&quot;float: right; padding: 3px 0;color: #e30007;&quot; type&#x3D;&quot;text&quot;                     icon&#x3D;&quot;el-icon-delete&quot; @click&#x3D;&quot;deleteHr(hr)&quot;&gt;&lt;&#x2F;el-button&gt;        &lt;&#x2F;div&gt;        &lt;div&gt;          &lt;div class&#x3D;&quot;img-container&quot;&gt;            &lt;img :src&#x3D;&quot;hr.userface&quot; :alt&#x3D;&quot;hr.name&quot; :title&#x3D;&quot;hr.name&quot; class&#x3D;&quot;userface-img&quot;&gt;          &lt;&#x2F;div&gt;          &lt;div class&#x3D;&quot;userinfo-container&quot;&gt;            &lt;div&gt;ç”¨æˆ·åï¼š&#123;&#123;hr.name&#125;&#125;&lt;&#x2F;div&gt;            &lt;div&gt;æ‰‹æœºå·ç ï¼š&#123;&#123;hr.phone&#125;&#125;&lt;&#x2F;div&gt;            &lt;div&gt;ç”µè¯å·ç ï¼š&#123;&#123;hr.telephone&#125;&#125;&lt;&#x2F;div&gt;            &lt;div&gt;åœ°å€ï¼š&#123;&#123;hr.address&#125;&#125;&lt;&#x2F;div&gt;            &lt;div&gt;ç”¨æˆ·çŠ¶æ€ï¼š              &lt;el-switch                  v-model&#x3D;&quot;hr.enabled&quot;                  active-text&#x3D;&quot;å¯ç”¨&quot;                  @change&#x3D;&quot;enabledChange(hr)&quot;                  active-color&#x3D;&quot;#13ce66&quot;                  inactive-color&#x3D;&quot;#ff4949&quot;                  inactive-text&#x3D;&quot;ç¦ç”¨&quot;&gt;              &lt;&#x2F;el-switch&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;ç”¨æˆ·è§’è‰²ï¼š              &lt;el-tag type&#x3D;&quot;success&quot; style&#x3D;&quot;margin-right: 6px&quot;                      v-for&#x3D;&quot;(role,indexj) in hr.roles&quot; :key&#x3D;&quot;indexj&quot;&gt;                &#123;&#123;role.nameZh&#125;&#125;              &lt;&#x2F;el-tag&gt;              &lt;el-popover                  placement&#x3D;&quot;right&quot;                  title&#x3D;&quot;è§’è‰²åˆ—è¡¨&quot;                  @show&#x3D;&quot;showPop(hr)&quot;                  @hide&#x3D;&quot;hidePop(hr)&quot;                  width&#x3D;&quot;150&quot;                  trigger&#x3D;&quot;click&quot;&gt;                &lt;el-select v-model&#x3D;&quot;selectedRoles&quot; multiple placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt;                  &lt;el-option                      v-for&#x3D;&quot;(r,indexk) in allroles&quot;                      :key&#x3D;&quot;indexk&quot;                      :label&#x3D;&quot;r.nameZh&quot;                      :value&#x3D;&quot;r.id&quot;&gt;                  &lt;&#x2F;el-option&gt;                &lt;&#x2F;el-select&gt;                &lt;el-button slot&#x3D;&quot;reference&quot; icon&#x3D;&quot;el-icon-more&quot; type&#x3D;&quot;text&quot;&gt;&lt;&#x2F;el-button&gt;              &lt;&#x2F;el-popover&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;å¤‡æ³¨ï¼š&#123;&#123;hr.remark&#125;&#125;&lt;&#x2F;div&gt;          &lt;&#x2F;div&gt;        &lt;&#x2F;div&gt;      &lt;&#x2F;el-card&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;SysHr&quot;,  data() &#123;    return &#123;      keywords: &#39;&#39;,      hrs: [],      selectedRoles: [],      allroles: []    &#125;  &#125;,  mounted() &#123;    this.initHrs();  &#125;,  methods: &#123;    initHrs() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;hr&#x2F;?keywords&#x3D;&quot;+this.keywords).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.hrs &#x3D; resp;        &#125;      &#125;)    &#125;,    enabledChange(hr) &#123;      delete hr.roles;      this.putRequest(&quot;&#x2F;system&#x2F;hr&#x2F;&quot;, hr).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.initHrs();        &#125;      &#125;)    &#125;,    showPop(hr) &#123;      this.initAllRoles();      let roles &#x3D; hr.roles;      this.selectedRoles &#x3D; [];      roles.forEach(r &#x3D;&gt; &#123;        this.selectedRoles.push(r.id);      &#125;)    &#125;,    initAllRoles() &#123;      this.getRequest(&quot;&#x2F;system&#x2F;hr&#x2F;roles&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.allroles &#x3D; resp;        &#125;      &#125;)    &#125;,    hidePop(hr) &#123;      let roles &#x3D; [];      &#x2F;&#x2F;æ‹·è´ä¸€ä»½      Object.assign(roles, hr.roles);      let flag &#x3D; false;      if (roles.length !&#x3D; this.selectedRoles.length) &#123;        flag &#x3D; true;      &#125; else &#123;        for (let i &#x3D; 0; i &lt; roles.length; i++) &#123;          let role &#x3D; roles[i];          for (let j &#x3D; 0; j &lt; this.selectedRoles.length; j++) &#123;            let sr &#x3D; this.selectedRoles[j];            if (role.id &#x3D;&#x3D; sr) &#123;              roles.splice(i, 1);              i--;              break;            &#125;          &#125;        &#125;        if (roles.length !&#x3D; 0) &#123;          flag &#x3D; true;        &#125;      &#125;      if (flag) &#123;        let url &#x3D; &#39;&#x2F;system&#x2F;hr&#x2F;role?hrid&#x3D;&#39; + hr.id;        this.selectedRoles.forEach(sr &#x3D;&gt; &#123;          url +&#x3D; &#39;&amp;rids&#x3D;&#39; + sr;        &#125;);        this.putRequest(url).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initHrs();          &#125;        &#125;);      &#125;    &#125;,    doSearch() &#123;      this.initHrs();    &#125;,    deleteHr(hr) &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ &#39;+hr.name+&#39; , æ˜¯å¦ç»§ç»­?&#39;, &#39;æç¤º&#39;, &#123;        confirmButtonText: &#39;ç¡®å®š&#39;,        cancelButtonText: &#39;å–æ¶ˆ&#39;,        type: &#39;warning&#39;      &#125;).then(() &#x3D;&gt; &#123;        this.deleteRequest(&quot;&#x2F;system&#x2F;hr&#x2F;&quot;+hr.id).then(resp&#x3D;&gt;&#123;          if (resp) &#123;            this.initHrs();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message(&#123;          type: &#39;info&#39;,          message: &#39;å·²å–æ¶ˆåˆ é™¤&#39;        &#125;);      &#125;);    &#125;,  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;.hr-container &#123;  margin-top: 10px;  display: flex;  flex-wrap: wrap;  justify-content: space-around;&#125;.hr-card &#123;  width: 350px;  margin-bottom: 20px;&#125;.img-container &#123;  width: 100%;  display: flex;  justify-content: center;&#125;.userface-img &#123;  width: 72px;  height: 72px;  border-radius: 72px;&#125;.userinfo-container &#123;  margin-top: 20px;&#125;.userinfo-container div &#123;  font-size: 12px;  color: #409eff;&#125;&lt;&#x2F;style&gt;</code></pre></div><h4 id="åç«¯éƒ¨åˆ†-4"><a href="#åç«¯éƒ¨åˆ†-4" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h4><p><strong>æ¥å£è®¾è®¡</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/system/hr&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@Autowired</span>    RoleService roleService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">(String keywords)</span> </span>&#123;        <span class="hljs-keyword">return</span> hrService.getAllHrs(keywords);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr)</span> </span>&#123;        <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/roles&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> roleService.getAllRoles();    &#125;    <span class="hljs-meta">@PutMapping(&quot;/role&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrRole</span><span class="hljs-params">(Integer hrid, Integer[] rids)</span> </span>&#123;        <span class="hljs-keyword">if</span> (hrService.updateHrRole(hrid, rids)) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteHrById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;        <span class="hljs-keyword">if</span> (hrService.deleteHrById(id) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥!&quot;</span>);    &#125;</code></pre></div><p>ç»§ç»­åœ¨<strong>Service</strong>å±‚å®Œå–„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrMapper hrMapper;    <span class="hljs-meta">@Autowired</span>    HrRoleMapper hrRoleMapper;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;        Hr hr = hrMapper.loadUserByUsername(username);        <span class="hljs-keyword">if</span> (hr == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);        &#125;        hr.setRoles(hrMapper.getHrRolesById(hr.getId()));        <span class="hljs-keyword">return</span> hr;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">(String keywords)</span> </span>&#123;        <span class="hljs-keyword">return</span> hrMapper.getAllHrs(HrUtils.getCurrentHr().getId(),keywords);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateHr</span><span class="hljs-params">(Hr hr)</span> </span>&#123;        <span class="hljs-keyword">return</span> hrMapper.updateByPrimaryKeySelective(hr);    &#125;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateHrRole</span><span class="hljs-params">(Integer hrid, Integer[] rids)</span> </span>&#123;        hrRoleMapper.deleteByHrid(hrid);        <span class="hljs-keyword">return</span> hrRoleMapper.addRole(hrid,rids) == rids.length;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteHrById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> hrMapper.deleteByPrimaryKey(id);    &#125;&#125;</code></pre></div><p>åœ¨å®ä½“ç±»Hrä¸­å¿½ç•¥ä¼ å…¥çš„roleçš„Json</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-meta">@JsonIgnore</span><span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;    List&lt;SimpleGrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(roles.size());    <span class="hljs-keyword">for</span> (Role role : roles) &#123;        authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName()));    &#125;    <span class="hljs-keyword">return</span> authorities;&#125;</code></pre></div><p><strong>HrRoleMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteByHrid&quot;</span>&gt;</span>  delete from hr_role where hrid=#&#123;hrid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addRole&quot;</span>&gt;</span>  insert into hr_role (hrid,rid) values  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;rids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>    (#&#123;hrid&#125;,#&#123;rid&#125;)  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><p><strong>HrMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;HrWithRoles&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Hr&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roles&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rnameZh&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nameZh&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllHrs&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;HrWithRoles&quot;</span>&gt;</span>  SELECT hr.id, hr.name, hr.phone, hr.telephone, hr.address, hr.enabled,  hr.username, hr.password, hr.userface, hr.remark, r.id as rid, r.name as rname, r.nameZh as rnameZh  FROM hr LEFT JOIN hr_role hrr ON hr.id = hrr.hrid  LEFT JOIN role r ON hrr.rid = r.id  WHERE hr.id != #&#123;hrid&#125;  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;keywords!=null&quot;</span>&gt;</span>    and hr.name like concat(&#x27;%&#x27;,#&#123;keywords&#125;,&#x27;%&#x27;)  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  ORDER BY hr.id<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h2 id="å‘˜å·¥èµ„æ–™"><a href="#å‘˜å·¥èµ„æ–™" class="headerlink" title="å‘˜å·¥èµ„æ–™"></a>å‘˜å·¥èµ„æ–™</h2><p>æ­¤éƒ¨åˆ†ä»£ç è¾ƒå¤šï¼Œä½†å®ç°çš„åŠŸèƒ½å’Œä¸Šé¢ç±»ä¼¼ï¼Œä¸å†å±•ç¤º</p><p>å…·ä½“å¯å»<a href="https://github.com/Lucifer2u/x-luciferpro%E4%B8%AD%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B">https://github.com/Lucifer2u/x-luciferproä¸­çš„ç‰ˆæœ¬ä¿¡æ¯æŸ¥çœ‹</a></p><p><strong>è¿™é‡Œè¡¥å……è®¾è®¡åˆ°çš„æ–°çŸ¥è¯†ç‚¹ï¼Œå¯¼å…¥å’Œå¯¼å‡ºæ•°æ®åˆ°Excel</strong></p><h3 id="å¯¼å‡ºæ•°æ®"><a href="#å¯¼å‡ºæ•°æ®" class="headerlink" title="å¯¼å‡ºæ•°æ®"></a>å¯¼å‡ºæ•°æ®</h3><p>å…ˆå¼•å…¥ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>åç«¯ä»£ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/employee/basic&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmpBasicController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/export&quot;)</span>    <span class="hljs-keyword">public</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt; exportData() &#123;        List&lt;Employee&gt; list = (List&lt;Employee&gt;) employeeService.getEmployeeByPage(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>).getData();        <span class="hljs-keyword">return</span> POIUtils.employee2Excel(list);    &#125;&#125;</code></pre></div><p><strong>ç”ŸæˆExcelçš„å·¥å…·ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">POIUtils</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt; employee2Excel(List&lt;Employee&gt; list) &#123;        <span class="hljs-comment">//1. åˆ›å»ºä¸€ä¸ª Excel æ–‡æ¡£</span>        HSSFWorkbook workbook = <span class="hljs-keyword">new</span> HSSFWorkbook();        <span class="hljs-comment">//2. åˆ›å»ºæ–‡æ¡£æ‘˜è¦</span>        workbook.createInformationProperties();        <span class="hljs-comment">//3. è·å–å¹¶é…ç½®æ–‡æ¡£ä¿¡æ¯</span>        DocumentSummaryInformation docInfo = workbook.getDocumentSummaryInformation();        <span class="hljs-comment">//æ–‡æ¡£ç±»åˆ«</span>        docInfo.setCategory(<span class="hljs-string">&quot;å‘˜å·¥ä¿¡æ¯&quot;</span>);        <span class="hljs-comment">//æ–‡æ¡£ç®¡ç†å‘˜</span>        docInfo.setManager(<span class="hljs-string">&quot;lucifer&quot;</span>);        <span class="hljs-comment">//è®¾ç½®å…¬å¸ä¿¡æ¯</span>        docInfo.setCompany(<span class="hljs-string">&quot;www.lucifer.org&quot;</span>);        <span class="hljs-comment">//4. è·å–æ–‡æ¡£æ‘˜è¦ä¿¡æ¯</span>        SummaryInformation summInfo = workbook.getSummaryInformation();        <span class="hljs-comment">//æ–‡æ¡£æ ‡é¢˜</span>        summInfo.setTitle(<span class="hljs-string">&quot;å‘˜å·¥ä¿¡æ¯è¡¨&quot;</span>);        <span class="hljs-comment">//æ–‡æ¡£ä½œè€…</span>        summInfo.setAuthor(<span class="hljs-string">&quot;lucifer&quot;</span>);        <span class="hljs-comment">// æ–‡æ¡£å¤‡æ³¨</span>        summInfo.setComments(<span class="hljs-string">&quot;æœ¬æ–‡æ¡£ç”± lucifer æä¾›&quot;</span>);        <span class="hljs-comment">//5. åˆ›å»ºæ ·å¼</span>        <span class="hljs-comment">//åˆ›å»ºæ ‡é¢˜è¡Œçš„æ ·å¼</span>        HSSFCellStyle headerStyle = workbook.createCellStyle();        headerStyle.setFillForegroundColor(IndexedColors.YELLOW.index);        headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);        <span class="hljs-comment">//è®¾ç½®æ—¥æœŸæ ¼å¼</span>        HSSFCellStyle dateCellStyle = workbook.createCellStyle();        dateCellStyle.setDataFormat(HSSFDataFormat.getBuiltinFormat(<span class="hljs-string">&quot;m/d/yy&quot;</span>));        HSSFSheet sheet = workbook.createSheet(<span class="hljs-string">&quot;å‘˜å·¥ä¿¡æ¯è¡¨&quot;</span>);        <span class="hljs-comment">//è®¾ç½®åˆ—çš„å®½åº¦</span>        sheet.setColumnWidth(<span class="hljs-number">0</span>, <span class="hljs-number">5</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">1</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">2</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">3</span>, <span class="hljs-number">5</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">4</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">5</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">6</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">7</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">8</span>, <span class="hljs-number">16</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">9</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">10</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">11</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">12</span>, <span class="hljs-number">16</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">13</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">14</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">15</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">16</span>, <span class="hljs-number">8</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">17</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">18</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">19</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">20</span>, <span class="hljs-number">8</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">21</span>, <span class="hljs-number">25</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">22</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">23</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);        sheet.setColumnWidth(<span class="hljs-number">24</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);        <span class="hljs-comment">//6. åˆ›å»ºæ ‡é¢˜è¡Œ</span>        HSSFRow r0 = sheet.createRow(<span class="hljs-number">0</span>);        HSSFCell c0 = r0.createCell(<span class="hljs-number">0</span>);        c0.setCellValue(<span class="hljs-string">&quot;ç¼–å·&quot;</span>);        c0.setCellStyle(headerStyle);        HSSFCell c1 = r0.createCell(<span class="hljs-number">1</span>);        c1.setCellStyle(headerStyle);        c1.setCellValue(<span class="hljs-string">&quot;å§“å&quot;</span>);        HSSFCell c2 = r0.createCell(<span class="hljs-number">2</span>);        c2.setCellStyle(headerStyle);        c2.setCellValue(<span class="hljs-string">&quot;å·¥å·&quot;</span>);        HSSFCell c3 = r0.createCell(<span class="hljs-number">3</span>);        c3.setCellStyle(headerStyle);        c3.setCellValue(<span class="hljs-string">&quot;æ€§åˆ«&quot;</span>);        HSSFCell c4 = r0.createCell(<span class="hljs-number">4</span>);        c4.setCellStyle(headerStyle);        c4.setCellValue(<span class="hljs-string">&quot;å‡ºç”Ÿæ—¥æœŸ&quot;</span>);        HSSFCell c5 = r0.createCell(<span class="hljs-number">5</span>);        c5.setCellStyle(headerStyle);        c5.setCellValue(<span class="hljs-string">&quot;èº«ä»½è¯å·ç &quot;</span>);        HSSFCell c6 = r0.createCell(<span class="hljs-number">6</span>);        c6.setCellStyle(headerStyle);        c6.setCellValue(<span class="hljs-string">&quot;å©šå§»çŠ¶å†µ&quot;</span>);        HSSFCell c7 = r0.createCell(<span class="hljs-number">7</span>);        c7.setCellStyle(headerStyle);        c7.setCellValue(<span class="hljs-string">&quot;æ°‘æ—&quot;</span>);        HSSFCell c8 = r0.createCell(<span class="hljs-number">8</span>);        c8.setCellStyle(headerStyle);        c8.setCellValue(<span class="hljs-string">&quot;ç±è´¯&quot;</span>);        HSSFCell c9 = r0.createCell(<span class="hljs-number">9</span>);        c9.setCellStyle(headerStyle);        c9.setCellValue(<span class="hljs-string">&quot;æ”¿æ²»é¢è²Œ&quot;</span>);        HSSFCell c10 = r0.createCell(<span class="hljs-number">10</span>);        c10.setCellStyle(headerStyle);        c10.setCellValue(<span class="hljs-string">&quot;ç”µè¯å·ç &quot;</span>);        HSSFCell c11 = r0.createCell(<span class="hljs-number">11</span>);        c11.setCellStyle(headerStyle);        c11.setCellValue(<span class="hljs-string">&quot;è”ç³»åœ°å€&quot;</span>);        HSSFCell c12 = r0.createCell(<span class="hljs-number">12</span>);        c12.setCellStyle(headerStyle);        c12.setCellValue(<span class="hljs-string">&quot;æ‰€å±éƒ¨é—¨&quot;</span>);        HSSFCell c13 = r0.createCell(<span class="hljs-number">13</span>);        c13.setCellStyle(headerStyle);        c13.setCellValue(<span class="hljs-string">&quot;èŒç§°&quot;</span>);        HSSFCell c14 = r0.createCell(<span class="hljs-number">14</span>);        c14.setCellStyle(headerStyle);        c14.setCellValue(<span class="hljs-string">&quot;èŒä½&quot;</span>);        HSSFCell c15 = r0.createCell(<span class="hljs-number">15</span>);        c15.setCellStyle(headerStyle);        c15.setCellValue(<span class="hljs-string">&quot;è˜ç”¨å½¢å¼&quot;</span>);        HSSFCell c16 = r0.createCell(<span class="hljs-number">16</span>);        c16.setCellStyle(headerStyle);        c16.setCellValue(<span class="hljs-string">&quot;æœ€é«˜å­¦å†&quot;</span>);        HSSFCell c17 = r0.createCell(<span class="hljs-number">17</span>);        c17.setCellStyle(headerStyle);        c17.setCellValue(<span class="hljs-string">&quot;ä¸“ä¸š&quot;</span>);        HSSFCell c18 = r0.createCell(<span class="hljs-number">18</span>);        c18.setCellStyle(headerStyle);        c18.setCellValue(<span class="hljs-string">&quot;æ¯•ä¸šé™¢æ ¡&quot;</span>);        HSSFCell c19 = r0.createCell(<span class="hljs-number">19</span>);        c19.setCellStyle(headerStyle);        c19.setCellValue(<span class="hljs-string">&quot;å…¥èŒæ—¥æœŸ&quot;</span>);        HSSFCell c20 = r0.createCell(<span class="hljs-number">20</span>);        c20.setCellStyle(headerStyle);        c20.setCellValue(<span class="hljs-string">&quot;åœ¨èŒçŠ¶æ€&quot;</span>);        HSSFCell c21 = r0.createCell(<span class="hljs-number">21</span>);        c21.setCellStyle(headerStyle);        c21.setCellValue(<span class="hljs-string">&quot;é‚®ç®±&quot;</span>);        HSSFCell c22 = r0.createCell(<span class="hljs-number">22</span>);        c22.setCellStyle(headerStyle);        c22.setCellValue(<span class="hljs-string">&quot;åˆåŒæœŸé™(å¹´)&quot;</span>);        HSSFCell c23 = r0.createCell(<span class="hljs-number">23</span>);        c23.setCellStyle(headerStyle);        c23.setCellValue(<span class="hljs-string">&quot;åˆåŒèµ·å§‹æ—¥æœŸ&quot;</span>);        HSSFCell c24 = r0.createCell(<span class="hljs-number">24</span>);        c24.setCellStyle(headerStyle);        c24.setCellValue(<span class="hljs-string">&quot;åˆåŒç»ˆæ­¢æ—¥æœŸ&quot;</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; list.size(); i++) &#123;            Employee emp = list.get(i);            HSSFRow row = sheet.createRow(i + <span class="hljs-number">1</span>);            row.createCell(<span class="hljs-number">0</span>).setCellValue(emp.getId());            row.createCell(<span class="hljs-number">1</span>).setCellValue(emp.getName());            row.createCell(<span class="hljs-number">2</span>).setCellValue(emp.getWorkID());            row.createCell(<span class="hljs-number">3</span>).setCellValue(emp.getGender());            HSSFCell cell4 = row.createCell(<span class="hljs-number">4</span>);            cell4.setCellStyle(dateCellStyle);            cell4.setCellValue(emp.getBirthday());            row.createCell(<span class="hljs-number">5</span>).setCellValue(emp.getIdCard());            row.createCell(<span class="hljs-number">6</span>).setCellValue(emp.getWedlock());            row.createCell(<span class="hljs-number">7</span>).setCellValue(emp.getNation().getName());            row.createCell(<span class="hljs-number">8</span>).setCellValue(emp.getNativePlace());            row.createCell(<span class="hljs-number">9</span>).setCellValue(emp.getPoliticsstatus().getName());            row.createCell(<span class="hljs-number">10</span>).setCellValue(emp.getPhone());            row.createCell(<span class="hljs-number">11</span>).setCellValue(emp.getAddress());            row.createCell(<span class="hljs-number">12</span>).setCellValue(emp.getDepartment().getName());            row.createCell(<span class="hljs-number">13</span>).setCellValue(emp.getJobLevel().getName());            row.createCell(<span class="hljs-number">14</span>).setCellValue(emp.getPosition().getName());            row.createCell(<span class="hljs-number">15</span>).setCellValue(emp.getEngageForm());            row.createCell(<span class="hljs-number">16</span>).setCellValue(emp.getTiptopDegree());            row.createCell(<span class="hljs-number">17</span>).setCellValue(emp.getSpecialty());            row.createCell(<span class="hljs-number">18</span>).setCellValue(emp.getSchool());            HSSFCell cell19 = row.createCell(<span class="hljs-number">19</span>);            cell19.setCellStyle(dateCellStyle);            cell19.setCellValue(emp.getBeginDate());            row.createCell(<span class="hljs-number">20</span>).setCellValue(emp.getWorkState());            row.createCell(<span class="hljs-number">21</span>).setCellValue(emp.getEmail());            row.createCell(<span class="hljs-number">22</span>).setCellValue(emp.getContractTerm());            HSSFCell cell23 = row.createCell(<span class="hljs-number">23</span>);            cell23.setCellStyle(dateCellStyle);            cell23.setCellValue(emp.getBeginContract());            HSSFCell cell24 = row.createCell(<span class="hljs-number">24</span>);            cell24.setCellStyle(dateCellStyle);            cell24.setCellValue(emp.getEndContract());<span class="hljs-comment">/*            HSSFCell cell25 = row.createCell(25);</span><span class="hljs-comment">            cell25.setCellStyle(dateCellStyle);</span><span class="hljs-comment">            cell25.setCellValue(emp.getConversionTime());*/</span>        &#125;        ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();        HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();        <span class="hljs-keyword">try</span> &#123;            headers.setContentDispositionFormData(<span class="hljs-string">&quot;attachment&quot;</span>, <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;å‘˜å·¥è¡¨.xls&quot;</span>.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>), <span class="hljs-string">&quot;ISO-8859-1&quot;</span>));            headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);            workbook.write(baos);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt;(baos.toByteArray(), headers, HttpStatus.CREATED);    &#125;&#125;</code></pre></div><p><strong>å‰ç«¯åœ¨EmpBasic.vueå¡«å†™æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;export default &#123;  methods: &#123;exportData() &#123;  window.open(&#39;&#x2F;employee&#x2F;basic&#x2F;export&#39;, &#39;_parent&#39;);&#125;  &#125;&lt;&#x2F;script&gt;</code></pre></div><h3 id="å¯¼å…¥æ•°æ®"><a href="#å¯¼å…¥æ•°æ®" class="headerlink" title="å¯¼å…¥æ•°æ®"></a>å¯¼å…¥æ•°æ®</h3><p>å®šä¹‰æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/import&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">importData</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    List&lt;Employee&gt; list = POIUtils.excel2Employee(file, nationService.getAllNations(), politicsstatusService.getAllPoliticsstatus(), departmentService.getAllDepartmentsWithOutChildren(), positionService.getAllPositions(), jobLevelService.getAllJobLevels());    <span class="hljs-keyword">if</span> (employeeService.addEmps(list) == list.size()) &#123;        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>);&#125;</code></pre></div><p>åç«¯æ·»åŠ å·¥å…·ç±»ä¸­çš„ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Excel è§£ææˆå‘˜å·¥æ•°æ®é›†åˆ</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Employee&gt; <span class="hljs-title">excel2Employee</span><span class="hljs-params">(MultipartFile file, List&lt;Nation&gt; allNations, List&lt;Politicsstatus&gt; allPoliticsstatus, List&lt;Department&gt; allDepartments, List&lt;Position&gt; allPositions, List&lt;JobLevel&gt; allJobLevels)</span> </span>&#123;    List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    Employee employee = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">//1. åˆ›å»ºä¸€ä¸ª workbook å¯¹è±¡</span>        HSSFWorkbook workbook = <span class="hljs-keyword">new</span> HSSFWorkbook(file.getInputStream());        <span class="hljs-comment">//2. è·å– workbook ä¸­è¡¨å•çš„æ•°é‡</span>        <span class="hljs-keyword">int</span> numberOfSheets = workbook.getNumberOfSheets();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numberOfSheets; i++) &#123;            <span class="hljs-comment">//3. è·å–è¡¨å•</span>            HSSFSheet sheet = workbook.getSheetAt(i);            <span class="hljs-comment">//4. è·å–è¡¨å•ä¸­çš„è¡Œæ•°</span>            <span class="hljs-keyword">int</span> physicalNumberOfRows = sheet.getPhysicalNumberOfRows();            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; physicalNumberOfRows; j++) &#123;                <span class="hljs-comment">//5. è·³è¿‡æ ‡é¢˜è¡Œ</span>                <span class="hljs-keyword">if</span> (j == <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//è·³è¿‡æ ‡é¢˜è¡Œ</span>                &#125;                <span class="hljs-comment">//6. è·å–è¡Œ</span>                HSSFRow row = sheet.getRow(j);                <span class="hljs-keyword">if</span> (row == <span class="hljs-keyword">null</span>) &#123;                    <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//é˜²æ­¢æ•°æ®ä¸­é—´æœ‰ç©ºè¡Œ</span>                &#125;                <span class="hljs-comment">//7. è·å–åˆ—æ•°</span>                <span class="hljs-keyword">int</span> physicalNumberOfCells = row.getPhysicalNumberOfCells();                employee = <span class="hljs-keyword">new</span> Employee();                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; physicalNumberOfCells; k++) &#123;                    HSSFCell cell = row.getCell(k);                    <span class="hljs-keyword">if</span> (cell.getCellType() == CellType.STRING) &#123;                        String cellValue = cell.getStringCellValue();                        <span class="hljs-keyword">switch</span> (k) &#123;                            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:                                employee.setName(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:                                employee.setWorkID(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:                                employee.setGender(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:                                employee.setIdCard(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:                                employee.setWedlock(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:                                <span class="hljs-keyword">int</span> nationIndex = allNations.indexOf(<span class="hljs-keyword">new</span> Nation(cellValue));                                employee.setNationId(allNations.get(nationIndex).getId());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:                                employee.setNativePlace(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:                                <span class="hljs-keyword">int</span> politicstatusIndex = allPoliticsstatus.indexOf(<span class="hljs-keyword">new</span> Politicsstatus(cellValue));                                employee.setPoliticId(allPoliticsstatus.get(politicstatusIndex).getId());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:                                employee.setPhone(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:                                employee.setAddress(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:                                <span class="hljs-keyword">int</span> departmentIndex = allDepartments.indexOf(<span class="hljs-keyword">new</span> Department(cellValue));                                employee.setDepartmentId(allDepartments.get(departmentIndex).getId());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:                                <span class="hljs-keyword">int</span> jobLevelIndex = allJobLevels.indexOf(<span class="hljs-keyword">new</span> JobLevel(cellValue));                                employee.setJobLevelId(allJobLevels.get(jobLevelIndex).getId());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">14</span>:                                <span class="hljs-keyword">int</span> positionIndex = allPositions.indexOf(<span class="hljs-keyword">new</span> Position(cellValue));                                employee.setPosId(allPositions.get(positionIndex).getId());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">15</span>:                                employee.setEngageForm(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:                                employee.setTiptopDegree(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">17</span>:                                employee.setSpecialty(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">18</span>:                                employee.setSchool(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">20</span>:                                employee.setWorkState(cellValue);                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">21</span>:                                employee.setEmail(cellValue);                                <span class="hljs-keyword">break</span>;                        &#125;                    &#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-keyword">switch</span> (k) &#123;                            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:                                employee.setBirthday(cell.getDateCellValue());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">19</span>:                                employee.setBeginDate(cell.getDateCellValue());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">23</span>:                                employee.setBeginContract(cell.getDateCellValue());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:                                employee.setEndContract(cell.getDateCellValue());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">22</span>:                                employee.setContractTerm(cell.getNumericCellValue());                                <span class="hljs-keyword">break</span>;                            <span class="hljs-keyword">case</span> <span class="hljs-number">25</span>:                                employee.setConversionTime(cell.getDateCellValue());                                <span class="hljs-keyword">break</span>;                        &#125;                    &#125;                &#125;                list.add(employee);            &#125;        &#125;    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;    <span class="hljs-keyword">return</span> list;&#125;</code></pre></div><p>æ³¨æ„ï¼šåœ¨<code>new Nation(cellValue)</code>é‡Œåˆ¤æ–­<code>nationIndex</code>çš„æ—¶å€™ï¼Œé‡å†™hashcodeå’Œequalsï¼ŒåŒç†äº<code>Politicsstatusã€Departmentã€JobLevelã€Position</code></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åªç”¨nameæ¥åˆ¤æ–­ï¼Œä¸ä½¿ç”¨idï¼ˆæŒ‰ç†æ¥è¯´åº”è¯¥idå’Œnameéƒ½ä¸€è‡´ï¼‰</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span> || getClass() != o.getClass()) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;    Nation nation = (Nation) o;    <span class="hljs-keyword">return</span> Objects.equals(name, nation.name);&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> Objects.hash(name);&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmps</span><span class="hljs-params">(List&lt;Employee&gt; list)</span> </span>&#123;    <span class="hljs-keyword">return</span> employeeMapper.addEmps(list);&#125;</code></pre></div><p>Mapperä»£ç å¯ä»¥å‚è€ƒæ’å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmps&quot;</span>&gt;</span>  insert into employee (name, gender,  birthday, idCard, wedlock, nationId,  nativePlace, politicId, email,  phone, address, departmentId,  jobLevelId, posId, engageForm,  tiptopDegree, specialty, school,  beginDate, workState, workID,  contractTerm, conversionTime, notWorkDate,  beginContract, endContract, workAge  )  values  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;emp&quot;</span>&gt;</span>    (#&#123;emp.name,jdbcType=VARCHAR&#125;, #&#123;emp.gender,jdbcType=CHAR&#125;,    #&#123;emp.birthday,jdbcType=DATE&#125;, #&#123;emp.idCard,jdbcType=CHAR&#125;, #&#123;emp.wedlock,jdbcType=CHAR&#125;,    #&#123;emp.nationId,jdbcType=INTEGER&#125;,    #&#123;emp.nativePlace,jdbcType=VARCHAR&#125;, #&#123;emp.politicId,jdbcType=INTEGER&#125;, #&#123;emp.email,jdbcType=VARCHAR&#125;,    #&#123;emp.phone,jdbcType=VARCHAR&#125;, #&#123;emp.address,jdbcType=VARCHAR&#125;, #&#123;emp.departmentId,jdbcType=INTEGER&#125;,    #&#123;emp.jobLevelId,jdbcType=INTEGER&#125;, #&#123;emp.posId,jdbcType=INTEGER&#125;, #&#123;emp.engageForm,jdbcType=VARCHAR&#125;,    #&#123;emp.tiptopDegree,jdbcType=CHAR&#125;, #&#123;emp.specialty,jdbcType=VARCHAR&#125;, #&#123;emp.school,jdbcType=VARCHAR&#125;,    #&#123;emp.beginDate,jdbcType=DATE&#125;, #&#123;emp.workState,jdbcType=CHAR&#125;, #&#123;emp.workID,jdbcType=CHAR&#125;,    #&#123;emp.contractTerm,jdbcType=DOUBLE&#125;, #&#123;emp.conversionTime,jdbcType=DATE&#125;, #&#123;emp.notWorkDate,jdbcType=DATE&#125;,    #&#123;emp.beginContract,jdbcType=DATE&#125;, #&#123;emp.endContract,jdbcType=DATE&#125;, #&#123;emp.workAge,jdbcType=INTEGER&#125;    )  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><h3 id="é«˜çº§æœç´¢"><a href="#é«˜çº§æœç´¢" class="headerlink" title="é«˜çº§æœç´¢"></a>é«˜çº§æœç´¢</h3><h4 id="åç«¯éƒ¨åˆ†-5"><a href="#åç«¯éƒ¨åˆ†-5" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h4><p>é’ˆå¯¹æœç´¢æ¥å£ä¼˜åŒ–ï¼Œä¸å†ç®€å•ä½¿ç”¨å…³é”®è¯æœç´¢ï¼ŒåŠ å…¥employeeï¼ŒbeginDateScopeç­‰é«˜çº§æœç´¢éœ€è¦ç”¨åˆ°çš„ä¿¡æ¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(defaultValue = &quot;1&quot;)</span>Integer page, <span class="hljs-meta">@RequestParam(defaultValue = &quot;10&quot;)</span>Integer size, Employee employee, Date[] beginDateScope)</span></span>&#123;    <span class="hljs-keyword">return</span> employeeService.getEmployeeByPage(page, size, employee, beginDateScope);&#125;</code></pre></div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDateéœ€è¦è½¬æ¢å™¨æ‰èƒ½ç›´æ¥ä¼ å…¥ï¼Œåœ¨converteråŒ…ä¸‹å®šä¹‰æ—¥æœŸè½¬æ¢å™¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Date</span>&gt; </span>&#123;    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">return</span> sdf.parse(source);        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p>Serviceä¼˜åŒ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPage</span><span class="hljs-params">(Integer page, Integer size,  Employee employee, Date[] beginDateScope)</span> </span>&#123;    <span class="hljs-keyword">if</span> (page != <span class="hljs-keyword">null</span> &amp;&amp; size != <span class="hljs-keyword">null</span>) &#123;        page = (page - <span class="hljs-number">1</span>) * size;    &#125;    List&lt;Employee&gt; data = employeeMapper.getEmployeeByPage(page, size, employee, beginDateScope);    Long total = employeeMapper.getTotal(employee, beginDateScope);    RespPageBean bean = <span class="hljs-keyword">new</span> RespPageBean();    bean.setData(data);    bean.setTotal(total);    <span class="hljs-keyword">return</span> bean;&#125;</code></pre></div><p>åŠ å…¥Mapper</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeByPage&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;AllEmployeeInfo&quot;</span>&gt;</span>  select e.*,p.`id` as pid,p.`name` as pname,n.`id` as nid,n.`name` as nname,d.`id` as did,d.`name` as  dname,j.`id` as jid,j.`name` as jname,pos.`id` as posid,pos.`name` as posname from employee e,nation  n,politicsstatus p,department d,joblevel j,position pos where e.`nationId`=n.`id` and e.`politicId`=p.`id` and  e.`departmentId`=d.`id` and e.`jobLevelId`=j.`id` and e.`posId`=pos.`id`  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.name !=null and emp.name!=&#x27;&#x27;&quot;</span>&gt;</span>    and e.name like concat(&#x27;%&#x27;,#&#123;emp.name&#125;,&#x27;%&#x27;)  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.politicId !=null&quot;</span>&gt;</span>    and e.politicId =#&#123;emp.politicId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.nationId !=null&quot;</span>&gt;</span>    and e.nationId =#&#123;emp.nationId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.departmentId !=null&quot;</span>&gt;</span>    and e.departmentId =#&#123;emp.departmentId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.jobLevelId !=null&quot;</span>&gt;</span>    and e.jobLevelId =#&#123;emp.jobLevelId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.engageForm !=null and emp.engageForm!=&#x27;&#x27;&quot;</span>&gt;</span>    and e.engageForm =#&#123;emp.engageForm&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.posId !=null&quot;</span>&gt;</span>    and e.posId =#&#123;emp.posId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginDateScope !=null&quot;</span>&gt;</span>    and e.beginDate between #&#123;beginDateScope[0]&#125; and #&#123;beginDateScope[1]&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;page !=null and size!=null&quot;</span>&gt;</span>    limit #&#123;page&#125;,#&#123;size&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTotal&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span>&gt;</span>    select count(*) from employee e    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp!=null&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.name !=null and emp.name!=&#x27;&#x27;&quot;</span>&gt;</span>          and e.name like concat(&#x27;%&#x27;,#&#123;emp.name&#125;,&#x27;%&#x27;)        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.politicId !=null&quot;</span>&gt;</span>          and e.politicId =#&#123;emp.politicId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.nationId !=null&quot;</span>&gt;</span>          and e.nationId =#&#123;emp.nationId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.jobLevelId !=null&quot;</span>&gt;</span>          and e.jobLevelId =#&#123;emp.jobLevelId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.departmentId !=null&quot;</span>&gt;</span>          and e.departmentId =#&#123;emp.departmentId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.engageForm !=null and emp.engageForm!=&#x27;&#x27;&quot;</span>&gt;</span>          and e.engageForm =#&#123;emp.engageForm&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.posId !=null&quot;</span>&gt;</span>          and e.posId =#&#123;emp.posId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginDateScope !=null&quot;</span>&gt;</span>        and e.beginDate between #&#123;beginDateScope[0]&#125; and #&#123;beginDateScope[1]&#125;      <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h4 id="å‰ç«¯éƒ¨åˆ†-5"><a href="#å‰ç«¯éƒ¨åˆ†-5" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h4><p>åœ¨åŸä»£ç ä¸Šç»§ç»­è¿›è¡Œæ·»åŠ ï¼ŒåŠ å…¥é«˜çº§æœç´¢æ¡†çš„ç¼–å†™ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;transition name&#x3D;&quot;slide-fade&quot;&gt;&lt;div v-show&#x3D;&quot;showAdvanceSearchView&quot;    style&#x3D;&quot;border: 1px solid #409eff;border-radius: 5px;box-sizing: border-box;padding: 5px;margin: 10px 0px;&quot;&gt;  &lt;el-row&gt;    &lt;el-col :span&#x3D;&quot;5&quot;&gt;      æ”¿æ²»é¢è²Œ:      &lt;el-select v-model&#x3D;&quot;searchValue.politicId&quot; placeholder&#x3D;&quot;æ”¿æ²»é¢è²Œ&quot; size&#x3D;&quot;mini&quot;                 style&#x3D;&quot;width: 130px;&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in politicsstatus&quot;            :key&#x3D;&quot;item.id&quot;            :label&#x3D;&quot;item.name&quot;            :value&#x3D;&quot;item.id&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;4&quot;&gt;      æ°‘æ—:      &lt;el-select v-model&#x3D;&quot;searchValue.nationId&quot; placeholder&#x3D;&quot;æ°‘æ—&quot; size&#x3D;&quot;mini&quot;                 style&#x3D;&quot;width: 130px;&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in nations&quot;            :key&#x3D;&quot;item.id&quot;            :label&#x3D;&quot;item.name&quot;            :value&#x3D;&quot;item.id&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;4&quot;&gt;      èŒä½:      &lt;el-select v-model&#x3D;&quot;searchValue.posId&quot; placeholder&#x3D;&quot;èŒä½&quot; size&#x3D;&quot;mini&quot; style&#x3D;&quot;width: 130px;&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in positions&quot;            :key&#x3D;&quot;item.id&quot;            :label&#x3D;&quot;item.name&quot;            :value&#x3D;&quot;item.id&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;4&quot;&gt;      èŒç§°:      &lt;el-select v-model&#x3D;&quot;searchValue.jobLevelId&quot; placeholder&#x3D;&quot;èŒç§°&quot; size&#x3D;&quot;mini&quot;                 style&#x3D;&quot;width: 130px;&quot;&gt;        &lt;el-option            v-for&#x3D;&quot;item in joblevels&quot;            :key&#x3D;&quot;item.id&quot;            :label&#x3D;&quot;item.name&quot;            :value&#x3D;&quot;item.id&quot;&gt;        &lt;&#x2F;el-option&gt;      &lt;&#x2F;el-select&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;7&quot;&gt;      è˜ç”¨å½¢å¼:      &lt;el-radio-group v-model&#x3D;&quot;searchValue.engageForm&quot;&gt;        &lt;el-radio label&#x3D;&quot;åŠ³åŠ¨åˆåŒ&quot;&gt;åŠ³åŠ¨åˆåŒ&lt;&#x2F;el-radio&gt;        &lt;el-radio label&#x3D;&quot;åŠ³åŠ¡åˆåŒ&quot;&gt;åŠ³åŠ¡åˆåŒ&lt;&#x2F;el-radio&gt;      &lt;&#x2F;el-radio-group&gt;    &lt;&#x2F;el-col&gt;  &lt;&#x2F;el-row&gt;  &lt;el-row style&#x3D;&quot;margin-top: 10px&quot;&gt;    &lt;el-col :span&#x3D;&quot;5&quot;&gt;      æ‰€å±éƒ¨é—¨:      &lt;el-popover          placement&#x3D;&quot;right&quot;          title&#x3D;&quot;è¯·é€‰æ‹©éƒ¨é—¨&quot;          width&#x3D;&quot;200&quot;          trigger&#x3D;&quot;manual&quot;          v-model&#x3D;&quot;popVisible&quot;&gt;        &lt;el-tree default-expand-all :data&#x3D;&quot;allDeps&quot; :props&#x3D;&quot;defaultProps&quot;                 @node-click&#x3D;&quot;searvhViewHandleNodeClick&quot;&gt;&lt;&#x2F;el-tree&gt;        &lt;div slot&#x3D;&quot;reference&quot;             style&#x3D;&quot;width: 130px;display: inline-flex;font-size: 13px;border: 1px solid #dedede;height: 26px;border-radius: 5px;cursor: pointer;align-items: center;padding-left: 8px;box-sizing: border-box;margin-left: 3px&quot;             @click&#x3D;&quot;showDepView&quot;&gt;&#123;&#123;inputDepName&#125;&#125;        &lt;&#x2F;div&gt;      &lt;&#x2F;el-popover&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;10&quot;&gt;      å…¥èŒæ—¥æœŸ:      &lt;el-date-picker          v-model&#x3D;&quot;searchValue.beginDateScope&quot;          type&#x3D;&quot;daterange&quot;          size&#x3D;&quot;mini&quot;          unlink-panels          value-format&#x3D;&quot;yyyy-MM-dd&quot;          range-separator&#x3D;&quot;è‡³&quot;          start-placeholder&#x3D;&quot;å¼€å§‹æ—¥æœŸ&quot;          end-placeholder&#x3D;&quot;ç»“æŸæ—¥æœŸ&quot;&gt;      &lt;&#x2F;el-date-picker&gt;    &lt;&#x2F;el-col&gt;    &lt;el-col :span&#x3D;&quot;5&quot; :offset&#x3D;&quot;4&quot;&gt;      &lt;el-button size&#x3D;&quot;mini&quot; @click&#x3D;&quot;showAdvanceSearchView &#x3D; !showAdvanceSearchView&quot;&gt;å–æ¶ˆ&lt;&#x2F;el-button&gt;      &lt;el-button size&#x3D;&quot;mini&quot; icon&#x3D;&quot;el-icon-search&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;initEmps(&#39;advanced&#39;)&quot;&gt;æœç´¢&lt;&#x2F;el-button&gt;      &lt;el-button size&#x3D;&quot;mini&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;resetForm&quot;&gt;é‡ç½®&lt;&#x2F;el-button&gt;    &lt;&#x2F;el-col&gt;  &lt;&#x2F;el-row&gt;&lt;&#x2F;div&gt;&lt;&#x2F;transition&gt;&lt;script&gt;  methods: &#123;    searvhViewHandleNodeClick(data) &#123;      this.inputDepName &#x3D; data.name;      this.searchValue.departmentId &#x3D; data.id;      this.popVisible &#x3D; !this.popVisible;    &#125;,&#125;&lt;&#x2F;script&gt;</code></pre></div><p>æ›´å¤šç»†èŠ‚çš„ä»£ç è§githubä¸­çš„æºä»£ç </p><h2 id="æ¨¡å—åŒ–æ”¹é€ "><a href="#æ¨¡å—åŒ–æ”¹é€ " class="headerlink" title="æ¨¡å—åŒ–æ”¹é€ "></a>æ¨¡å—åŒ–æ”¹é€ </h2><p>ä¸ºäº†æ–¹ä¾¿ä»¥åçš„ä¸šåŠ¡éœ€æ±‚ï¼Œé’ˆå¯¹åŸé¡¹ç›®è¿›è¡Œæ”¹é€ ï¼Œå˜æˆ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210630211157577.png" alt="image-20210630211157577"></p><p>serveré‡Œå­˜çš„æ˜¯ç›®å‰ä¸ºæ­¢çš„ä¸šåŠ¡ä»£ç ï¼Œä»¥åä¼šæ·»åŠ é‚®ä»¶æ¨¡å—ï¼Œå’ŒserveråŒºåˆ†ï¼Œå…·ä½“çš„ä»£ç åˆ’åˆ†è§<a href="https://github.com/Lucifer2u/xm-luciferpro">ä»£ç </a></p><h2 id="é‚®ä»¶æœåŠ¡"><a href="#é‚®ä»¶æœåŠ¡" class="headerlink" title="é‚®ä»¶æœåŠ¡"></a>é‚®ä»¶æœåŠ¡</h2><p>å¼•å…¥RabbitMQåå¯åŠ¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210702154401698.png" alt="image-20210702154401698"></p><p>æ–°å»ºæ¨¡å—</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210702160148393.png" alt="image-20210702160148393"></p><p>å¼•å…¥ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.lucifer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>luciferpro-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.amqp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-rabbit-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h3><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8082</span><span class="hljs-comment">#é‚®ä»¶ç›¸å…³</span><span class="hljs-meta">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span><span class="hljs-meta">spring.mail.protocol</span>=<span class="hljs-string">smtp</span><span class="hljs-meta">spring.mail.default-encoding</span>=<span class="hljs-string">UTF-8</span><span class="hljs-meta">spring.mail.password</span>=<span class="hljs-string">cxpuqalzrctubdib</span><span class="hljs-meta">spring.mail.username</span>=<span class="hljs-string">xiaoweliang@qq.com</span><span class="hljs-meta">spring.mail.port</span>=<span class="hljs-string">587</span><span class="hljs-meta">spring.mail.properties.mail.stmp.socketFactory.class</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span><span class="hljs-meta">spring.mail.properties.mail.debug</span>=<span class="hljs-string">true</span><span class="hljs-comment">#æ¶ˆæ¯ä¸­é—´ä»·</span><span class="hljs-meta">spring.rabbitmq.username</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.password</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.host</span>=<span class="hljs-string">172.16.211.4</span><span class="hljs-meta">spring.rabbitmq.port</span>=<span class="hljs-string">5672</span></code></pre></div><p>ç»™å‘˜å·¥å‘é€é‚®ä»¶ï¼Œæ‰€ä»¥éœ€è¦åºåˆ—åŒ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span></code></pre></div><p>å®ƒé‡Œé¢åŒ…å«çš„å¯¹è±¡ï¼ŒåŒæ ·ä¹Ÿéœ€è¦åºåˆ—åŒ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Nation nation;<span class="hljs-keyword">private</span> Politicsstatus politicsstatus;<span class="hljs-keyword">private</span> Department department;<span class="hljs-keyword">private</span> JobLevel jobLevel;<span class="hljs-keyword">private</span> Position position;</code></pre></div><h3 id="å»ºç«‹æ¨¡ç‰ˆ"><a href="#å»ºç«‹æ¨¡ç‰ˆ" class="headerlink" title="å»ºç«‹æ¨¡ç‰ˆ"></a>å»ºç«‹æ¨¡ç‰ˆ</h3><p>åœ¨<code>templates</code>ä¸‹å»ºç«‹æ¨¡ç‰ˆ</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å…¥èŒæ¬¢è¿é‚®ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>æ¬¢è¿ <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> åŠ å…¥ Shelby å¤§å®¶åº­ï¼Œæ‚¨çš„å…¥èŒä¿¡æ¯å¦‚ä¸‹ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>èŒä½<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;posName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>èŒç§°<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;joblevelName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>éƒ¨é—¨<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;departmentName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h3 id="æ¶ˆæ¯å‘é€"><a href="#æ¶ˆæ¯å‘é€" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailserverApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(MailserverApplication.class, args);    &#125;    <span class="hljs-comment">//å¼•å…¥çš„é˜Ÿåˆ—æ˜¯rabbitmqçš„</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;lucifer.mail.welcome&quot;</span>);    &#125;&#125;</code></pre></div><h3 id="æ¶ˆæ¯æ¥æ”¶"><a href="#æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h3><p>è¿™é‡Œç”¨åˆ°çš„åŒ…æœ‰å¾ˆå¤šé‡åçš„æƒ…å†µï¼Œéœ€è¦æ³¨æ„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.lucifer.mailserver.receiver;<span class="hljs-keyword">import</span> org.lucifer.vbluciferpro.model.Employee;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.mail.MailProperties;<span class="hljs-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;<span class="hljs-keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> org.thymeleaf.TemplateEngine;<span class="hljs-keyword">import</span> org.thymeleaf.context.Context;<span class="hljs-keyword">import</span> javax.mail.MessagingException;<span class="hljs-keyword">import</span> javax.mail.internet.MimeMessage;<span class="hljs-keyword">import</span> java.util.Date;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailReceiver</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(MailReceiver.class);        <span class="hljs-meta">@Autowired</span>    JavaMailSender javaMailSender;    <span class="hljs-meta">@Autowired</span>    MailProperties mailProperties;    <span class="hljs-meta">@Autowired</span>    TemplateEngine templateEngine;    <span class="hljs-meta">@RabbitListener(queues =  &quot;lucifer.mail.welcome&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(Employee employee)</span></span>&#123;        <span class="hljs-comment">//æ”¶åˆ°æ¶ˆæ¯ï¼Œå‘é€é‚®ä»¶</span>        MimeMessage msg = javaMailSender.createMimeMessage();        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(msg);        <span class="hljs-keyword">try</span> &#123;            helper.setTo(employee.getEmail());            helper.setFrom(mailProperties.getUsername());            helper.setSubject(<span class="hljs-string">&quot;å…¥èŒæ¬¢è¿!&quot;</span>);            helper.setSentDate(<span class="hljs-keyword">new</span> Date());            Context context = <span class="hljs-keyword">new</span> Context();            context.setVariable(<span class="hljs-string">&quot;name&quot;</span>, employee.getName());            context.setVariable(<span class="hljs-string">&quot;posName&quot;</span>, employee.getPosition().getName());            context.setVariable(<span class="hljs-string">&quot;joblevelName&quot;</span>, employee.getJobLevel().getName());            context.setVariable(<span class="hljs-string">&quot;departmentName&quot;</span>, employee.getDepartment().getName());            <span class="hljs-comment">//å¯¹åº”mail.html</span>            String mail = templateEngine.process(<span class="hljs-string">&quot;mail&quot;</span>, context);            helper.setText(mail, <span class="hljs-keyword">true</span>);            javaMailSender.send(msg);        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;            e.printStackTrace();            <span class="hljs-comment">//å‘é€å¤±è´¥ï¼Œè¿”å›æ—¥å¿—</span>            logger.error(<span class="hljs-string">&quot;é‚®ä»¶å‘é€å¤±è´¥ï¼š&quot;</span> + e.getMessage());        &#125;    &#125;&#125;</code></pre></div><h3 id="å‘é€æ‰§è¡Œ"><a href="#å‘é€æ‰§è¡Œ" class="headerlink" title="å‘é€æ‰§è¡Œ"></a>å‘é€æ‰§è¡Œ</h3><p>åœ¨Serviceæ¨¡å—ä¸­éœ€è¦ç”¨åˆ°rabbitmqï¼Œæ‰€ä»¥å¼•å…¥ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>åŒæ—¶webéœ€è¦è¿ä¸Šrabbitmqï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šé…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#æ¶ˆæ¯ä¸­é—´ä»·</span><span class="hljs-meta">spring.rabbitmq.username</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.password</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.host</span>=<span class="hljs-string">172.16.211.4</span><span class="hljs-meta">spring.rabbitmq.port</span>=<span class="hljs-string">5672</span></code></pre></div><p><strong>Serviceå±‚</strong>æ‰§è¡Œå…·ä½“çš„æ“ä½œ</p><p>åœ¨æ·»åŠ çš„æ—¶å€™è¿˜æ²¡æœ‰idï¼Œæƒ³è¦æ‹¿åˆ°idï¼Œå¿…é¡»ä¸»é”®å›å¡«</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;Employee emp = employeeMapper.getEmployeeById(employee.getId());&#125;</code></pre></div><p>é¦–å…ˆåœ¨<code>EmployeeMapper</code>ä¸­é’ˆå¯¹<code>int insertSelective(Employee record);</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertSelective&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Employee&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span></code></pre></div><p>è®©idèƒ½ä¸»é”®å›å¡«ï¼Œè¿™æ ·åœ¨Serviceå°±èƒ½æ‹¿åˆ°idäº†</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);</code></pre></div><p><strong>æœ€ç»ˆServiceä»£ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;    Date beginContract = employee.getBeginContract();    Date endContract = employee.getEndContract();    <span class="hljs-keyword">double</span> month = (Double.parseDouble(yearFormat.format(endContract)) - Double.parseDouble(yearFormat.format(beginContract))) * <span class="hljs-number">12</span>            + (Double.parseDouble(monthFormat.format(endContract)) - Double.parseDouble(monthFormat.format(beginContract)));    employee.setContractTerm(Double.parseDouble(decimalFormat.format(month / <span class="hljs-number">12</span>)));    <span class="hljs-comment">//é‚®ä»¶å‘é€</span>    <span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);    <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;        Employee emp = employeeMapper.getEmployeeById(employee.getId());        rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;lucifer.mail.welcome&quot;</span>, emp);    &#125;        <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>ç›¸åº”çš„Mapper</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;AllEmployeeInfo&quot;</span>&gt;</span>  select e.*,p.`id` as pid,p.`name` as pname,n.`id` as nid,n.`name` as nname,d.`id` as did,d.`name` as  dname,j.`id` as jid,j.`name` as jname,pos.`id` as posid,pos.`name` as posname  from employee e,nation n,politicsstatus p,department d,joblevel j,position pos  where e.`nationId`=n.`id` and e.`politicId`=p.`id` and    e.`departmentId`=d.`id` and e.`jobLevelId`=j.`id` and e.`posId`=pos.`id` and e.`id`=#&#123;id&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h2 id="è–ªèµ„ç®¡ç†"><a href="#è–ªèµ„ç®¡ç†" class="headerlink" title="è–ªèµ„ç®¡ç†"></a>è–ªèµ„ç®¡ç†</h2><h3 id="å·¥èµ„å¥—è´¦ç®¡ç†"><a href="#å·¥èµ„å¥—è´¦ç®¡ç†" class="headerlink" title="å·¥èµ„å¥—è´¦ç®¡ç†"></a>å·¥èµ„å¥—è´¦ç®¡ç†</h3><h4 id="åç«¯éƒ¨åˆ†-6"><a href="#åç«¯éƒ¨åˆ†-6" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h4><p>æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/salary/sob&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SalaryController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SalaryService salaryService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> salaryService.getAllSalaries();    &#125;    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addSalary</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Salary salary)</span> </span>&#123;        <span class="hljs-keyword">if</span> (salaryService.addSalary(salary) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥!&quot;</span>);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteSalaryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;        <span class="hljs-keyword">if</span> (salaryService.deleteSalaryById(id) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateSalaryById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Salary salary)</span> </span>&#123;        <span class="hljs-keyword">if</span> (salaryService.updateSalaryById(salary) == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SalaryService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SalaryMapper salaryMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> salaryMapper.getAllSalaries();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addSalary</span><span class="hljs-params">(Salary salary)</span> </span>&#123;        salary.setCreateDate(<span class="hljs-keyword">new</span> Date());        <span class="hljs-keyword">return</span> salaryMapper.insertSelective(salary);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteSalaryById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> salaryMapper.deleteByPrimaryKey(id);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateSalaryById</span><span class="hljs-params">(Salary salary)</span> </span>&#123;        <span class="hljs-keyword">return</span> salaryMapper.updateByPrimaryKeySelective(salary);    &#125;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllSalaries&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  select  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>/&gt;</span>  from salary<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h4 id="å‰ç«¯éƒ¨åˆ†-6"><a href="#å‰ç«¯éƒ¨åˆ†-6" class="headerlink" title="å‰ç«¯éƒ¨åˆ†"></a>å‰ç«¯éƒ¨åˆ†</h4><p><strong>SalSob.vue</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div style&#x3D;&quot;display: flex;justify-content: space-between&quot;&gt;      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;showAddSalaryView&quot;&gt;æ·»åŠ å·¥èµ„è´¦å¥—&lt;&#x2F;el-button&gt;      &lt;el-button icon&#x3D;&quot;el-icon-refresh&quot; type&#x3D;&quot;success&quot; @click&#x3D;&quot;initSalaries&quot;&gt;åˆ·æ–°&lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;      &lt;el-table :data&#x3D;&quot;salaries&quot; border stripe&gt;        &lt;el-table-column type&#x3D;&quot;selection&quot; width&#x3D;&quot;55&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;120&quot; prop&#x3D;&quot;name&quot; label&#x3D;&quot;è´¦å¥—åç§°&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;basicSalary&quot; label&#x3D;&quot;åŸºæœ¬å·¥èµ„&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;trafficSalary&quot; label&#x3D;&quot;äº¤é€šè¡¥åŠ©&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;lunchSalary&quot; label&#x3D;&quot;åˆé¤è¡¥åŠ©&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;bonus&quot; label&#x3D;&quot;å¥–é‡‘&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column width&#x3D;&quot;100&quot; prop&#x3D;&quot;createDate&quot; label&#x3D;&quot;å¯ç”¨æ—¶é—´&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;el-table-column label&#x3D;&quot;å…»è€é‡‘&quot; align&#x3D;&quot;center&quot;&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;pensionPer&quot; label&#x3D;&quot;æ¯”ç‡&quot;&gt;&lt;&#x2F;el-table-column&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;pensionBase&quot; label&#x3D;&quot;åŸºæ•°&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column label&#x3D;&quot;åŒ»ç–—ä¿é™©&quot; align&#x3D;&quot;center&quot;&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;medicalPer&quot; label&#x3D;&quot;æ¯”ç‡&quot;&gt;&lt;&#x2F;el-table-column&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;medicalBase&quot; label&#x3D;&quot;åŸºæ•°&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column label&#x3D;&quot;å…¬ç§¯é‡‘&quot; align&#x3D;&quot;center&quot;&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;accumulationFundPer&quot; label&#x3D;&quot;æ¯”ç‡&quot;&gt;&lt;&#x2F;el-table-column&gt;          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;accumulationFundBase&quot; label&#x3D;&quot;åŸºæ•°&quot;&gt;&lt;&#x2F;el-table-column&gt;        &lt;&#x2F;el-table-column&gt;        &lt;el-table-column label&#x3D;&quot;æ“ä½œ&quot;&gt;          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;            &lt;el-button @click&#x3D;&quot;showEditSalaryView(scope.row)&quot;&gt;ç¼–è¾‘&lt;&#x2F;el-button&gt;            &lt;el-button type&#x3D;&quot;danger&quot; @click&#x3D;&quot;deleteSalary(scope.row)&quot;&gt;åˆ é™¤&lt;&#x2F;el-button&gt;          &lt;&#x2F;template&gt;        &lt;&#x2F;el-table-column&gt;      &lt;&#x2F;el-table&gt;    &lt;&#x2F;div&gt;    &lt;el-dialog        :title&#x3D;&quot;dialogTitle&quot;        :visible.sync&#x3D;&quot;dialogVisible&quot;        width&#x3D;&quot;50%&quot;&gt;      &lt;div style&#x3D;&quot;display: flex;justify-content: space-around;align-items: center&quot;&gt;        &lt;el-steps direction&#x3D;&quot;vertical&quot; :active&#x3D;&quot;activeItemIndex&quot;&gt;          &lt;el-step :title&#x3D;&quot;itemName&quot; v-for&#x3D;&quot;(itemName,index) in salaryItemName&quot; :key&#x3D;&quot;index&quot;&gt;&lt;&#x2F;el-step&gt;        &lt;&#x2F;el-steps&gt;        &lt;el-input v-model&#x3D;&quot;salary[title]&quot; :placeholder&#x3D;&quot;&#39;è¯·è¾“å…¥&#39;+salaryItemName[index]+&#39;...&#39;&quot;                  v-for&#x3D;&quot;(value,title,index) in salary&quot;                  :key&#x3D;&quot;index&quot; v-show&#x3D;&quot;activeItemIndex&#x3D;&#x3D;index&quot; style&#x3D;&quot;width: 200px&quot;&gt;        &lt;&#x2F;el-input&gt;      &lt;&#x2F;div&gt;      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;      &lt;el-button @click&#x3D;&quot;cancel&quot;&gt;&#123;&#123;&#39;å–æ¶ˆ&#39;&#125;&#125;&lt;&#x2F;el-button&gt;    &lt;el-button @click&#x3D;&quot;preStep&quot;&gt;&#123;&#123;&#39;ä¸Šä¸€æ­¥&#39;&#125;&#125;&lt;&#x2F;el-button&gt;    &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;nextStep&quot;&gt;&#123;&#123;activeItemIndex&#x3D;&#x3D;10?&#39;å®Œæˆ&#39;:&#39;ä¸‹ä¸€æ­¥&#39;&#125;&#125;&lt;&#x2F;el-button&gt;  &lt;&#x2F;span&gt;    &lt;&#x2F;el-dialog&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  name: &quot;SalSob&quot;,  data() &#123;    return &#123;      dialogVisible: false,      dialogTitle: &#39;æ·»åŠ å·¥èµ„è´¦å¥—&#39;,      salaries: [],      activeItemIndex: 0,      salaryItemName: [        &#39;åŸºæœ¬å·¥èµ„&#39;,        &#39;äº¤é€šè¡¥åŠ©&#39;,        &#39;åˆé¤è¡¥åŠ©&#39;,        &#39;å¥–é‡‘&#39;,        &#39;å…»è€é‡‘æ¯”ç‡&#39;,        &#39;å…»è€é‡‘åŸºæ•°&#39;,        &#39;åŒ»ç–—ä¿é™©æ¯”ç‡&#39;,        &#39;åŒ»ç–—ä¿é™©åŸºæ•°&#39;,        &#39;å…¬ç§¯é‡‘æ¯”ç‡&#39;,        &#39;å…¬ç§¯é‡‘åŸºæ•°&#39;,        &#39;è´¦å¥—åç§°&#39;      ],      salary: &#123;        basicSalary: 0,        trafficSalary: 0,        lunchSalary: 0,        bonus: 0,        pensionPer: 0,        pensionBase: 0,        medicalPer: 0,        medicalBase: 0,        accumulationFundPer: 0,        accumulationFundBase: 0,        name: &#39;&#39;      &#125;    &#125;  &#125;,  mounted() &#123;    this.initSalaries();  &#125;,  methods: &#123;    initSalaries() &#123;      this.getRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;).then(resp &#x3D;&gt; &#123;        if (resp) &#123;          this.salaries &#x3D; resp;        &#125;      &#125;)    &#125;,    showAddSalaryView() &#123;      &#x2F;&#x2F;æ•°æ®åˆå§‹åŒ–      this.salary &#x3D; &#123;        basicSalary: &#39;&#39;,        trafficSalary: &#39;&#39;,        lunchSalary:  &#39;&#39;,        bonus:  &#39;&#39;,        pensionPer:  &#39;&#39;,        pensionBase:  &#39;&#39;,        medicalPer:  &#39;&#39;,        medicalBase:  &#39;&#39;,        accumulationFundPer:  &#39;&#39;,        accumulationFundBase:  &#39;&#39;,        name: &#39;&#39;      &#125;      this.dialogTitle &#x3D; &#39;æ·»åŠ å·¥èµ„è´¦å¥—&#39;;      this.activeItemIndex &#x3D; 0;      this.dialogVisible &#x3D; true;    &#125;,    nextStep() &#123;      if (this.activeItemIndex &#x3D;&#x3D; 10) &#123;        &#x2F;&#x2F;idå­˜åœ¨æ˜¯æ›´æ–°æ“ä½œï¼Œå¦åˆ™æ˜¯æ·»åŠ æ“ä½œ        if (this.salary.id) &#123;          this.putRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;, this.salary).then(resp&#x3D;&gt;&#123;            if (resp) &#123;              this.initSalaries();              this.dialogVisible &#x3D; false;            &#125;          &#125;)        &#125; else &#123;          this.postRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;, this.salary).then(resp &#x3D;&gt; &#123;            if (resp) &#123;              this.initSalaries();              this.dialogVisible &#x3D; false;            &#125;          &#125;);        &#125;        return;      &#125;      this.activeItemIndex++;    &#125;,    cancel() &#123;      &#x2F;&#x2F;å…³é—­å¯¹è¯æ¡†      this.dialogVisible &#x3D; false;      return;    &#125;,    preStep() &#123;      if (this.activeItemIndex &#x3D;&#x3D; 0) &#123;        return;      &#125;      this.activeItemIndex--;    &#125;,    deleteSalary(data) &#123;      this.$confirm(&#39;æ­¤æ“ä½œå°†åˆ é™¤ &#39; + data.name + &#39; è´¦å¥—ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ&#39;, &#39;æç¤º&#39;, &#123;        cancelButtonText: &#39;å–æ¶ˆ&#39;,        confirmButtonText: &#39;ç¡®å®š&#39;      &#125;).then(() &#x3D;&gt; &#123;        this.deleteRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;          if (resp) &#123;            this.initSalaries();          &#125;        &#125;)      &#125;).catch(() &#x3D;&gt; &#123;        this.$message.info(&quot;å–æ¶ˆåˆ é™¤!&quot;);      &#125;)    &#125;,    showEditSalaryView(data) &#123;      this.dialogTitle &#x3D; &#39;ä¿®æ”¹å·¥èµ„è´¦å¥—&#39;;      this.dialogVisible &#x3D; true;      this.salary.basicSalary &#x3D; data.basicSalary;      this.salary.trafficSalary &#x3D; data.trafficSalary;      this.salary.lunchSalary &#x3D; data.lunchSalary;      this.salary.bonus &#x3D; data.bonus;      this.salary.pensionPer &#x3D; data.pensionPer;      this.salary.pensionBase &#x3D; data.pensionBase;      this.salary.medicalPer &#x3D; data.medicalPer;      this.salary.medicalBase &#x3D; data.medicalBase;      this.salary.accumulationFundPer &#x3D; data.accumulationFundPer;      this.salary.accumulationFundBase &#x3D; data.accumulationFundBase;      this.salary.name &#x3D; data.name;      this.salary.id &#x3D; data.id;    &#125;,  &#125;&#125;&lt;&#x2F;script&gt;&lt;style scoped&gt;&lt;&#x2F;style&gt;</code></pre></div><h3 id="å‘˜å·¥å·¥èµ„å¥—è´¦ç®¡ç†"><a href="#å‘˜å·¥å·¥èµ„å¥—è´¦ç®¡ç†" class="headerlink" title="å‘˜å·¥å·¥èµ„å¥—è´¦ç®¡ç†"></a>å‘˜å·¥å·¥èµ„å¥—è´¦ç®¡ç†</h3><h4 id="åç«¯éƒ¨åˆ†-7"><a href="#åç«¯éƒ¨åˆ†-7" class="headerlink" title="åç«¯éƒ¨åˆ†"></a>åç«¯éƒ¨åˆ†</h4><p>åœ¨Employeeå®ä½“ç±»ä¸Šè¡¥å……å·¥èµ„å±æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Salary salary;</code></pre></div><p>æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/salary/sobcfg&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SobConfigController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    EmployeeService employeeService;    <span class="hljs-meta">@Autowired</span>    SalaryService salaryService;    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPageWithSalary</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page, <span class="hljs-meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer size)</span> </span>&#123;        <span class="hljs-keyword">return</span> employeeService.getEmployeeByPageWithSalary(page, size);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/salaries&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> salaryService.getAllSalaries();    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateEmployeeSalaryById</span><span class="hljs-params">(Integer eid, Integer sid)</span> </span>&#123;        Integer result = employeeService.updateEmployeeSalaryById(eid, sid);        <span class="hljs-comment">// REPLACE INTO å…³é”®è¯ æ›´æ–°ä¸º1ï¼Œæ’å…¥ä¸º2</span>        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span> || result == <span class="hljs-number">2</span>) &#123;            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥&quot;</span>);    &#125;&#125;</code></pre></div><p>åœ¨åŸå…ˆEmployeeServiceçš„åŸºç¡€ä¸Šè¡¥å……å³å¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPageWithSalary</span><span class="hljs-params">(Integer page, Integer size)</span> </span>&#123;    <span class="hljs-keyword">if</span> (page != <span class="hljs-keyword">null</span> &amp;&amp; size != <span class="hljs-keyword">null</span>) &#123;        page = (page - <span class="hljs-number">1</span>) * size;    &#125;    List&lt;Employee&gt; list = employeeMapper.getEmployeeByPageWithSalary(page, size);    RespPageBean respPageBean = <span class="hljs-keyword">new</span> RespPageBean();    respPageBean.setData(list);    respPageBean.setTotal(employeeMapper.getTotal(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>));    <span class="hljs-keyword">return</span> respPageBean;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateEmployeeSalaryById</span><span class="hljs-params">(Integer eid, Integer sid)</span> </span>&#123;    <span class="hljs-keyword">return</span> employeeMapper.updateEmployeeSalaryById(eid, sid);&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;EmployeeWithSalary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Employee&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;salary&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Salary&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sbasicSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;basicSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sbonus&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;bonus&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;slunchSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lunchSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;strafficSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;trafficSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sallSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;allSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;spensionBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pensionBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;spensionPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pensionPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;screateDate&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createDate&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;smedicalBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;medicalBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;smedicalPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;medicalPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;saccumulationFundBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;accumulationFundBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;saccumulationFundPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;accumulationFundPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;department&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Department&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeByPageWithSalary&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;EmployeeWithSalary&quot;</span>&gt;</span>  SELECT e.*,d.`name` AS dname,s.`id` AS sid,s.`accumulationFundBase` AS  saccumulationFundBase,s.`accumulationFundPer` AS saccumulationFundPer,s.`allSalary` AS  sallSalary,s.`basicSalary` AS sbasicSalary,s.`bonus` AS sbonus,s.`createDate` AS screateDate,s.`lunchSalary` AS  slunchSalary,s.`medicalBase` AS smedicalBase,s.`medicalPer` AS smedicalPer,s.`name` AS sname,s.`pensionBase` AS  spensionBase,s.`pensionPer` AS spensionPer,s.`trafficSalary` AS strafficSalary  FROM employee e  LEFT JOIN empsalary es  ON e.`id`=es.`eid`  LEFT JOIN salary s  ON es.`sid`=s.`id`  LEFT JOIN department d  ON e.`departmentId`=d.`id`  order by e.id  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;page !=null and size !=null&quot;</span>&gt;</span>    limit #&#123;page&#125;,#&#123;size&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateEmployeeSalaryById&quot;</span>&gt;</span>  REPLACE INTO empsalary (eid,sid) VALUES(#&#123;eid&#125;,#&#123;sid&#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><h2 id="èŠå¤©åŠŸèƒ½"><a href="#èŠå¤©åŠŸèƒ½" class="headerlink" title="èŠå¤©åŠŸèƒ½"></a>èŠå¤©åŠŸèƒ½</h2><h3 id="åŸºæœ¬é¡µé¢æ­å»º"><a href="#åŸºæœ¬é¡µé¢æ­å»º" class="headerlink" title="åŸºæœ¬é¡µé¢æ­å»º"></a>åŸºæœ¬é¡µé¢æ­å»º</h3><p>å°†<a href="https://github.com/is-liyiwei/vue-Chat-demo">Githubä¸Šçš„è„šæ‰‹æ¶</a>å¼•å…¥è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install sass-loader@7.3.1 --save-devnpm install style-loader --save-devnpm i node-sass@4.14.1 --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/ --save-dev</code></pre></div><p>åœ¨<code>views/chat</code>ä¸‹åˆ›å»º<code>FriendChat.vue</code>ï¼Œåœ¨ç»„ä»¶<code>components/chat</code>ä¸‹æ–°å»ºè„šæ‰‹æ¶ä¸­çš„å››ä¸ªç»„ä»¶ï¼š<code>cardã€listã€messageã€usertext</code>ï¼Œåœ¨é¦–é¡µä¸­å¼•å…¥è¿›å…¥èŠå¤©çš„å¿«æ·æŒ‰é’®</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;div&gt;  &lt;el-button icon&#x3D;&quot;el-icon-bell&quot; type&#x3D;&quot;text&quot; style&#x3D;&quot;margin-right: 8px;color: #000000;&quot; size&#x3D;&quot;normal&quot; @click&#x3D;&quot;goChat&quot;&gt;Chat&lt;&#x2F;el-button&gt;  &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;                &lt;span class&#x3D;&quot;el-dropdown-link&quot; style&#x3D;&quot;color: #000000;&quot;&gt;                  &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;                &lt;&#x2F;span&gt;    &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;      &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;ä¸ªäººä¸­å¿ƒ&lt;&#x2F;el-dropdown-item&gt;      &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;è®¾ç½®&lt;&#x2F;el-dropdown-item&gt;      &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;æ³¨é”€ç™»å½•&lt;&#x2F;el-dropdown-item&gt;    &lt;&#x2F;el-dropdown-menu&gt;  &lt;&#x2F;el-dropdown&gt;&lt;&#x2F;div&gt;goChat() &#123;this.$router.push(&quot;&#x2F;chat&quot;);&#125;,</code></pre></div><p>å®Œå–„<code>router</code>ï¼Œå®ç°è·³è½¬</p><div class="hljs code-wrapper"><pre><code class="hljs js">&#123;  path: <span class="hljs-string">&#x27;/home&#x27;</span>,  name: <span class="hljs-string">&#x27;Home&#x27;</span>,  component: Home,  hidden:<span class="hljs-literal">true</span>,children: [    &#123;        path: <span class="hljs-string">&#x27;/chat&#x27;</span>,        name: <span class="hljs-string">&#x27;åœ¨çº¿èŠå¤©&#x27;</span>,        component: FriendChat,        hidden: <span class="hljs-literal">true</span>    &#125;,]&#125;,</code></pre></div><p>å®Œå–„<code>store</code>ä¸‹çš„<code>index.js</code>æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>Vue.use(Vuex)<span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store(&#123;    state:&#123;        routes:[],        sessions:[&#123;            id:<span class="hljs-number">1</span>,            user:&#123;                name:<span class="hljs-string">&#x27;ç¤ºä¾‹ä»‹ç»&#x27;</span>,                img:<span class="hljs-string">&#x27;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F842eea2fef4be992c14222abf3df84af576f8d0d21049-YmLxJv_fw658&amp;refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1628337952&amp;t=02ebc923420e56695dadbe2933151ca0&#x27;</span>            &#125;,            messages:[&#123;                content:<span class="hljs-string">&#x27;Helloï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºVue + Vuex + Webpackæ„å»ºçš„ç®€å•chatç¤ºä¾‹ï¼ŒèŠå¤©è®°å½•ä¿å­˜åœ¨localStorge, æœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥é€šè¿‡Github Issueé—®æˆ‘ã€‚&#x27;</span>,                date:now            &#125;,&#123;                content:<span class="hljs-string">&#x27;é¡¹ç›®åœ°å€(åŸä½œè€…): https://github.com/coffcer/vue-chat&#x27;</span>,                date:now            &#125;,&#123;                content:<span class="hljs-string">&#x27;æœ¬é¡¹ç›®åœ°å€(é‡æ„): https://github.com/is-liyiwei&#x27;</span>,                date:now            &#125;]        &#125;,&#123;            id:<span class="hljs-number">2</span>,            user:&#123;                name:<span class="hljs-string">&#x27;webpack&#x27;</span>,                img:<span class="hljs-string">&#x27;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage.biaobaiju.com%2Fuploads%2F20181113%2F23%2F1542122451-kZaRlqfLyK.jpg&amp;refer=http%3A%2F%2Fimage.biaobaiju.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1628338001&amp;t=8d7e0245528edff2b25393d4573fd6ef&#x27;</span>            &#125;,            messages:[&#123;                content:<span class="hljs-string">&#x27;Hiï¼Œæˆ‘æ˜¯webpackå“¦&#x27;</span>,                date:now            &#125;]        &#125;],        currentSessionId:<span class="hljs-number">1</span>,        filterKey:<span class="hljs-string">&#x27;&#x27;</span>    &#125;,    mutations:&#123;        <span class="hljs-function"><span class="hljs-title">initRoutes</span>(<span class="hljs-params">state, data</span>)</span>&#123;            state.routes = data;        &#125;,        changeCurrentSessionId (state,id) &#123;            state.currentSessionId = id;        &#125;,        addMessage (state,msg) &#123;            state.sessions[state.currentSessionId-<span class="hljs-number">1</span>].messages.push(&#123;                content:msg,                date: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),                self:<span class="hljs-literal">true</span>            &#125;)        &#125;,        INIT_DATA (state) &#123;            <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;vue-chat-session&#x27;</span>);            <span class="hljs-comment">//console.log(data)</span>            <span class="hljs-keyword">if</span> (data) &#123;                state.sessions = <span class="hljs-built_in">JSON</span>.parse(data);            &#125;        &#125;    &#125;,    actions:&#123;        initData (context) &#123;            context.commit(<span class="hljs-string">&#x27;INIT_DATA&#x27;</span>)        &#125;    &#125;&#125;)store.watch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state</span>) </span>&#123;    <span class="hljs-keyword">return</span> state.sessions&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>&#123;    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;vue-chat-session&#x27;</span>, <span class="hljs-built_in">JSON</span>.stringify(val));&#125;, &#123;    deep: <span class="hljs-literal">true</span><span class="hljs-comment">/*è¿™ä¸ªè²Œä¼¼æ˜¯å¼€å¯watchç›‘æµ‹çš„åˆ¤æ–­,å®˜æ–¹è¯´æ˜ä¹Ÿæ¯”è¾ƒæ¨¡ç³Š*/</span>&#125;)<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store;</code></pre></div><h3 id="åŠ¨æ€å±•ç¤º"><a href="#åŠ¨æ€å±•ç¤º" class="headerlink" title="åŠ¨æ€å±•ç¤º"></a>åŠ¨æ€å±•ç¤º</h3><p>åœ¨<code>card.vue</code>å’Œ<code>message.vue</code>ä¸­ä»æ•°æ®åº“è¯»å–ç”¨æˆ·ä¿¡æ¯å’Œå¤´åƒåœ°å€ï¼Œä¸å†å†™æ­»åˆ°å‰ç«¯ä»£ç ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;data () &#123;    return &#123;      user: JSON.parse(window.sessionStorage.getItem(&quot;user&quot;))    &#125;  &#125;&lt;&#x2F;script&gt;</code></pre></div><p>è¿™æ ·<code>user.userface</code>å°±å¯ä»¥è°ƒç”¨å›¾ç‰‡ï¼Œ<code>user.name</code>å°±å¯ä»¥è°ƒç”¨ç”¨æˆ·åç§°ï¼Œç„¶å<strong>åç«¯åŠ è½½æ•°æ®åº“å†…å®¹</strong></p><p><strong>ChatController</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/chat&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HrService hrService;    <span class="hljs-meta">@GetMapping(&quot;/hrs&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> hrService.getAllHrsExceptCurrentHr();    &#125;&#125;</code></pre></div><p><strong>HrService</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrsExceptCurrentHr</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> hrMapper.getAllHrsExceptCurrentHr(HrUtils.getCurrentHr().getId());&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllHrsExceptCurrentHr&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  select * from hr where id !=#&#123;id&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h3 id="å¼•å…¥WebSocket"><a href="#å¼•å…¥WebSocket" class="headerlink" title="å¼•å…¥WebSocket"></a>å¼•å…¥WebSocket</h3><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebSocketMessageBroker</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketMessageBrokerConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> </span>&#123;        registry.addEndpoint(<span class="hljs-string">&quot;/ws/ep&quot;</span>)                <span class="hljs-comment">//å…è®¸å‰ç«¯å‘é€</span>                .setAllowedOrigins(<span class="hljs-string">&quot;*&quot;</span>)                .withSockJS();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry registry)</span> </span>&#123;        registry.enableSimpleBroker(<span class="hljs-string">&quot;/queue&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WsController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SimpMessagingTemplate simpMessagingTemplate;    <span class="hljs-meta">@MessageMapping(&quot;/ws/chat&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMsg</span><span class="hljs-params">(Principal principal, ChatMsg chatMsg)</span> </span>&#123;        chatMsg.setFrom(principal.getName());        chatMsg.setDate(<span class="hljs-keyword">new</span> Date());        simpMessagingTemplate.convertAndSendToUser(chatMsg.getTo(), <span class="hljs-string">&quot;/queue/chat&quot;</span>, chatMsg);    &#125;&#125;</code></pre></div><p>å®ä½“ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Date;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatMsg</span> </span>&#123;    <span class="hljs-keyword">private</span> String from;    <span class="hljs-keyword">private</span> String to;    <span class="hljs-keyword">private</span> String content;    <span class="hljs-keyword">private</span> Date date;    <span class="hljs-keyword">private</span> String fromNickname;&#125;</code></pre></div><h3 id="æ¶ˆæ¯çš„å‘é€"><a href="#æ¶ˆæ¯çš„å‘é€" class="headerlink" title="æ¶ˆæ¯çš„å‘é€"></a>æ¶ˆæ¯çš„å‘é€</h3><p>åœ¨<code>usertext.vue</code>ä¸­å°†è¾“å…¥çš„å†…å®¹å‘é€</p><div class="hljs code-wrapper"><pre><code class="hljs js">addMessage (e) &#123; <span class="hljs-keyword">if</span> (e.ctrlKey &amp;&amp; e.keyCode ===<span class="hljs-number">13</span> &amp;&amp; <span class="hljs-built_in">this</span>.content.length) &#123;   <span class="hljs-keyword">let</span> msgObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();    msgObj.to = <span class="hljs-built_in">this</span>.currentSession.username;     msgObj.content = <span class="hljs-built_in">this</span>.content;   <span class="hljs-built_in">this</span>.$store.state.stomp.send(<span class="hljs-string">&#x27;ws/chat&#x27;</span>,&#123;&#125;,<span class="hljs-built_in">JSON</span>.stringify(msgObj));  <span class="hljs-built_in">this</span>.$store.commit(<span class="hljs-string">&#x27;addMessage&#x27;</span>, msgObj);  <span class="hljs-built_in">this</span>.content=<span class="hljs-string">&#x27;&#x27;</span>; &#125;&#125;</code></pre></div><p>åœ¨<code>router.js</code>ä¸­æ‰§è¡Œå‘é€</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//æ¶ˆæ¯å‘é€</span>        addMessage (state,msg) &#123;            <span class="hljs-keyword">let</span> mss = state.sessions[state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to];            <span class="hljs-keyword">if</span> (!mss) &#123;                <span class="hljs-comment">// æ­¤å¤„æ¶ˆæ¯ä¸èƒ½è‡ªåŠ¨åˆ·æ–°ï¼Œéœ€è¦ç”¨Vue.set</span>                <span class="hljs-comment">// state.sessions[state.currentHr.username+&#x27;#&#x27;+msg.to] = [];</span>            Vue.set(state.sessions, state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to, []);            &#125;            state.sessions[state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to].push(&#123;                content: msg.content,                date: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),                self: !msg.notSelf            &#125;)        &#125;,</code></pre></div><h3 id="æ¶ˆæ¯çš„æ¥æ”¶"><a href="#æ¶ˆæ¯çš„æ¥æ”¶" class="headerlink" title="æ¶ˆæ¯çš„æ¥æ”¶"></a>æ¶ˆæ¯çš„æ¥æ”¶</h3><p>åœ¨<code>router.js</code>ä¸­æ¥æ”¶æ¶ˆæ¯</p><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//æ¶ˆæ¯æ¥æ”¶</span><span class="hljs-function"><span class="hljs-title">connect</span>(<span class="hljs-params">context</span>)</span> &#123;  context.state.stomp = Stomp.over(<span class="hljs-keyword">new</span> SockJS(<span class="hljs-string">&#x27;/ws/ep&#x27;</span>));  context.state.stomp.connect(&#123;&#125;, <span class="hljs-function"><span class="hljs-params">success</span> =&gt;</span> &#123;    context.state.stomp.subscribe(<span class="hljs-string">&#x27;/user/queue/chat&#x27;</span>, <span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> &#123;      <span class="hljs-keyword">let</span> receiveMsg = <span class="hljs-built_in">JSON</span>.parse(msg.body);      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;receiveMsg&#x27;</span> + receiveMsg);      <span class="hljs-keyword">if</span> (!context.state.currentSession || receiveMsg.from != context.state.currentSession.username) &#123;        Notification.info(&#123;          title: <span class="hljs-string">&#x27;ã€&#x27;</span> + receiveMsg.fromNickname + <span class="hljs-string">&#x27;ã€‘å‘æ¥ä¸€æ¡æ¶ˆæ¯&#x27;</span>,          message: receiveMsg.content.length &gt; <span class="hljs-number">10</span> ? receiveMsg.content.substr(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>) : receiveMsg.content,          position: <span class="hljs-string">&#x27;bottom-right&#x27;</span>        &#125;)        Vue.set(context.state.isDot, context.state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + receiveMsg.from, <span class="hljs-literal">true</span>);      &#125;      receiveMsg.notSelf = <span class="hljs-literal">true</span>;      receiveMsg.to = receiveMsg.from;      context.commit(<span class="hljs-string">&#x27;addMessage&#x27;</span>, receiveMsg);    &#125;)  &#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;  &#125;)&#125;,</code></pre></div><h3 id="æ¶ˆæ¯çš„å±•ç¤º"><a href="#æ¶ˆæ¯çš„å±•ç¤º" class="headerlink" title="æ¶ˆæ¯çš„å±•ç¤º"></a>æ¶ˆæ¯çš„å±•ç¤º</h3><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div id&#x3D;&quot;message&quot; v-scroll-bottom&#x3D;&quot;sessions&quot;&gt;   &lt;ul v-if&#x3D;&quot;currentSession&quot;&gt;      &lt;li v-for&#x3D;&quot;entry in sessions[user.username+&#39;#&#39;+currentSession.username]&quot;&gt;      &lt;p class&#x3D;&quot;time&quot;&gt;      &lt;span&gt;&#123;&#123;entry.date | time&#125;&#125;&lt;&#x2F;span&gt;     &lt;&#x2F;p&gt;     &lt;div class&#x3D;&quot;main&quot; :class&#x3D;&quot;&#123;self:entry.self&#125;&quot;&gt;          &lt;img class&#x3D;&quot;avatar&quot; :src&#x3D;&quot;entry.self ? user.userface : currentSession.userface&quot; alt&#x3D;&quot;&quot;&gt;          &lt;p class&#x3D;&quot;text&quot;&gt;&#123;&#123;entry.content&#125;&#125;&lt;&#x2F;p&gt;     &lt;&#x2F;div&gt;    &lt;&#x2F;li&gt;   &lt;&#x2F;ul&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;</code></pre></div><h1 id="å…«ã€è¡¥å……å†…å®¹"><a href="#å…«ã€è¡¥å……å†…å®¹" class="headerlink" title="å…«ã€è¡¥å……å†…å®¹"></a>å…«ã€è¡¥å……å†…å®¹</h1><h2 id="ç™»å½•ç”ŸæˆéªŒè¯ç "><a href="#ç™»å½•ç”ŸæˆéªŒè¯ç " class="headerlink" title="ç™»å½•ç”ŸæˆéªŒè¯ç "></a>ç™»å½•ç”ŸæˆéªŒè¯ç </h2><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><h4 id="ç”ŸæˆéªŒè¯ç "><a href="#ç”ŸæˆéªŒè¯ç " class="headerlink" title="ç”ŸæˆéªŒè¯ç "></a>ç”ŸæˆéªŒè¯ç </h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VerificationCode</span> </span>&#123;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> width = <span class="hljs-number">100</span>;<span class="hljs-comment">// ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„å®½åº¦</span>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> height = <span class="hljs-number">30</span>;<span class="hljs-comment">// ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„é«˜åº¦</span>   <span class="hljs-keyword">private</span> String[] fontNames = &#123; <span class="hljs-string">&quot;å®‹ä½“&quot;</span>, <span class="hljs-string">&quot;æ¥·ä½“&quot;</span>, <span class="hljs-string">&quot;éš¶ä¹¦&quot;</span>, <span class="hljs-string">&quot;å¾®è½¯é›…é»‘&quot;</span> &#125;;   <span class="hljs-keyword">private</span> Color bgColor = <span class="hljs-keyword">new</span> Color(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<span class="hljs-comment">// å®šä¹‰éªŒè¯ç å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²</span>   <span class="hljs-keyword">private</span> Random random = <span class="hljs-keyword">new</span> Random();   <span class="hljs-keyword">private</span> String codes = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;   <span class="hljs-keyword">private</span> String text;<span class="hljs-comment">// è®°å½•éšæœºå­—ç¬¦ä¸²</span>   <span class="hljs-comment">/**</span><span class="hljs-comment">    * è·å–ä¸€ä¸ªéšæ„é¢œè‰²</span><span class="hljs-comment">    * </span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> Color <span class="hljs-title">randomColor</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">int</span> red = random.nextInt(<span class="hljs-number">150</span>);      <span class="hljs-keyword">int</span> green = random.nextInt(<span class="hljs-number">150</span>);      <span class="hljs-keyword">int</span> blue = random.nextInt(<span class="hljs-number">150</span>);      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Color(red, green, blue);   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * è·å–ä¸€ä¸ªéšæœºå­—ä½“</span><span class="hljs-comment">    * </span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> Font <span class="hljs-title">randomFont</span><span class="hljs-params">()</span> </span>&#123;      String name = fontNames[random.nextInt(fontNames.length)];      <span class="hljs-keyword">int</span> style = random.nextInt(<span class="hljs-number">4</span>);      <span class="hljs-keyword">int</span> size = random.nextInt(<span class="hljs-number">5</span>) + <span class="hljs-number">24</span>;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Font(name, style, size);   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * è·å–ä¸€ä¸ªéšæœºå­—ç¬¦</span><span class="hljs-comment">    * </span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">char</span> <span class="hljs-title">randomChar</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> codes.charAt(random.nextInt(codes.length()));   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * åˆ›å»ºä¸€ä¸ªç©ºç™½çš„BufferedImageå¯¹è±¡</span><span class="hljs-comment">    * </span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> BufferedImage <span class="hljs-title">createImage</span><span class="hljs-params">()</span> </span>&#123;      BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);      Graphics2D g2 = (Graphics2D) image.getGraphics();      g2.setColor(bgColor);<span class="hljs-comment">// è®¾ç½®éªŒè¯ç å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²</span>      g2.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);      <span class="hljs-keyword">return</span> image;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> BufferedImage <span class="hljs-title">getImage</span><span class="hljs-params">()</span> </span>&#123;      BufferedImage image = createImage();      Graphics2D g2 = (Graphics2D) image.getGraphics();      StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer();      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;         String s = randomChar() + <span class="hljs-string">&quot;&quot;</span>;         sb.append(s);         g2.setColor(randomColor());         g2.setFont(randomFont());         <span class="hljs-keyword">float</span> x = i * width * <span class="hljs-number">1.0f</span> / <span class="hljs-number">4</span>;         g2.drawString(s, x, height - <span class="hljs-number">8</span>);      &#125;      <span class="hljs-keyword">this</span>.text = sb.toString();      drawLine(image);      <span class="hljs-keyword">return</span> image;   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * ç»˜åˆ¶å¹²æ‰°çº¿</span><span class="hljs-comment">    * </span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> image</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drawLine</span><span class="hljs-params">(BufferedImage image)</span> </span>&#123;      Graphics2D g2 = (Graphics2D) image.getGraphics();      <span class="hljs-keyword">int</span> num = <span class="hljs-number">5</span>;      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) &#123;         <span class="hljs-keyword">int</span> x1 = random.nextInt(width);         <span class="hljs-keyword">int</span> y1 = random.nextInt(height);         <span class="hljs-keyword">int</span> x2 = random.nextInt(width);         <span class="hljs-keyword">int</span> y2 = random.nextInt(height);         g2.setColor(randomColor());         g2.setStroke(<span class="hljs-keyword">new</span> BasicStroke(<span class="hljs-number">1.5f</span>));         g2.drawLine(x1, y1, x2, y2);      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getText</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> text;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">output</span><span class="hljs-params">(BufferedImage image, OutputStream out)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      ImageIO.write(image, <span class="hljs-string">&quot;JPEG&quot;</span>, out);   &#125;&#125;</code></pre></div><h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/verifyCode&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">verifyCode</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    VerificationCode code = <span class="hljs-keyword">new</span> VerificationCode();    BufferedImage image = code.getImage();    String text = code.getText();    HttpSession session = request.getSession(<span class="hljs-keyword">true</span>);    session.setAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>, text);    VerificationCode.output(image,resp.getOutputStream());&#125;</code></pre></div><h4 id="Securityä¸æ‹¦æˆª"><a href="#Securityä¸æ‹¦æˆª" class="headerlink" title="Securityä¸æ‹¦æˆª"></a>Securityä¸æ‹¦æˆª</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    <span class="hljs-comment">//é˜²æ­¢è®¿é—®ç™»å½•é¡µé¢æ­»å¾ªç¯ï¼Œä¸ç”¨è¿›å…¥Securityæ‹¦æˆª</span>    web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);&#125;</code></pre></div><h4 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h4><p>ç™»å½•å‰éœ€è¦å…ˆæ ¡éªŒéªŒè¯ç ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤å™¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SessionRegistry sessionRegistry;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;        <span class="hljs-keyword">if</span> (!request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(                    <span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());        &#125;        String verify_code = (String) request.getSession().getAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>);        <span class="hljs-keyword">if</span> (request.getContentType().contains(MediaType.APPLICATION_JSON_VALUE) || request.getContentType().contains(MediaType.APPLICATION_JSON_UTF8_VALUE)) &#123;            Map&lt;String, String&gt; loginData = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();            <span class="hljs-keyword">try</span> &#123;                loginData = <span class="hljs-keyword">new</span> ObjectMapper().readValue(request.getInputStream(), Map.class);            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            &#125;<span class="hljs-keyword">finally</span> &#123;                String code = loginData.get(<span class="hljs-string">&quot;code&quot;</span>);                checkCode(response, code, verify_code);            &#125;            String username = loginData.get(getUsernameParameter());            String password = loginData.get(getPasswordParameter());            <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;                username = <span class="hljs-string">&quot;&quot;</span>;            &#125;            <span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;                password = <span class="hljs-string">&quot;&quot;</span>;            &#125;            username = username.trim();            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(                    username, password);            setDetails(request, authRequest);            Hr principal = <span class="hljs-keyword">new</span> Hr();            principal.setUsername(username);            sessionRegistry.registerNewSession(request.getSession(<span class="hljs-keyword">true</span>).getId(), principal);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);        &#125; <span class="hljs-keyword">else</span> &#123;            checkCode(response, request.getParameter(<span class="hljs-string">&quot;code&quot;</span>), verify_code);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.attemptAuthentication(request, response);        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkCode</span><span class="hljs-params">(HttpServletResponse resp, String code, String verify_code)</span> </span>&#123;        <span class="hljs-keyword">if</span> (code == <span class="hljs-keyword">null</span> || verify_code == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(code) || !verify_code.toLowerCase().equals(code.toLowerCase())) &#123;            <span class="hljs-comment">//éªŒè¯ç ä¸æ­£ç¡®</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;éªŒè¯ç ä¸æ­£ç¡®&quot;</span>);        &#125;    &#125;&#125;</code></pre></div><p>åŒæ—¶éœ€è¦æ›´æ”¹ä¸€ä¸‹SecurityConfigï¼Œè¿™é‡Œé€šè¿‡ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ŒåŒæ—¶æ£€éªŒç”¨æˆ·åï¼Œå¯†ç å’ŒéªŒè¯ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();        loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    Hr hr = (Hr) authentication.getPrincipal();                    hr.setPassword(<span class="hljs-keyword">null</span>);                    RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!&quot;</span>, hr);                    String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);                    out.write(s);                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; &#123;                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                    PrintWriter out = response.getWriter();                    RespBean respBean = RespBean.error(exception.getMessage());                    <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;å¯†ç è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;                        respBean.setMsg(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);                    &#125;                    out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                    out.flush();                    out.close();                &#125;        );        loginFilter.setAuthenticationManager(authenticationManagerBean());        loginFilter.setFilterProcessesUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>);        ConcurrentSessionControlAuthenticationStrategy sessionStrategy = <span class="hljs-keyword">new</span> ConcurrentSessionControlAuthenticationStrategy(sessionRegistry());        sessionStrategy.setMaximumSessions(<span class="hljs-number">1</span>);        loginFilter.setSessionAuthenticationStrategy(sessionStrategy);        <span class="hljs-keyword">return</span> loginFilter;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SessionRegistryImpl <span class="hljs-title">sessionRegistry</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SessionRegistryImpl();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;                        object.setAccessDecisionManager(customUrlDecisionManager);                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);                        <span class="hljs-keyword">return</span> object;                    &#125;                &#125;)                .and()                .logout()                .logoutSuccessHandler((req, resp, authentication) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            PrintWriter out = resp.getWriter();                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸ!&quot;</span>)));                            out.flush();                            out.close();                        &#125;                )                .permitAll()                .and()                .csrf().disable().exceptionHandling()                <span class="hljs-comment">//æ²¡æœ‰è®¤è¯æ—¶ï¼Œåœ¨è¿™é‡Œå¤„ç†ç»“æœï¼Œä¸è¦é‡å®šå‘</span>                .authenticationEntryPoint((req, resp, authException) -&gt; &#123;                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                            resp.setStatus(<span class="hljs-number">401</span>);                            PrintWriter out = resp.getWriter();                            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;è®¿é—®å¤±è´¥!&quot;</span>);                            <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;                                respBean.setMsg(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);                            &#125;                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));                            out.flush();                            out.close();                        &#125;                );        http.addFilterAt(<span class="hljs-keyword">new</span> ConcurrentSessionFilter(sessionRegistry(), event -&gt; &#123;            HttpServletResponse resp = event.getResponse();            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);            resp.setStatus(<span class="hljs-number">401</span>);            PrintWriter out = resp.getWriter();            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.error(<span class="hljs-string">&quot;æ‚¨å·²åœ¨å¦ä¸€å°è®¾å¤‡ç™»å½•ï¼Œæœ¬æ¬¡ç™»å½•å·²ä¸‹çº¿!&quot;</span>)));            out.flush();            out.close();        &#125;), ConcurrentSessionFilter.class);        http.addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class);    &#125;&#125;</code></pre></div><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><p>å‰ç«¯ç›´æ¥å±•ç¤ºå³å¯</p><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;el-form-item prop&#x3D;&quot;code&quot;&gt;  &lt;el-input size&#x3D;&quot;normal&quot; type&#x3D;&quot;text&quot; v-model&#x3D;&quot;loginForm.code&quot; auto-complete&#x3D;&quot;off&quot;            placeholder&#x3D;&quot;ç‚¹å‡»å›¾ç‰‡æ›´æ¢éªŒè¯ç &quot; @keydown.enter.native&#x3D;&quot;submitLogin&quot; style&#x3D;&quot;width: 250px&quot;&gt;&lt;&#x2F;el-input&gt;  &lt;img :src&#x3D;&quot;vcUrl&quot; @click&#x3D;&quot;updateVerifyCode&quot; alt&#x3D;&quot;&quot; style&#x3D;&quot;cursor: pointer;&quot;&gt;&lt;&#x2F;el-form-item&gt;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs js">methods:&#123;  <span class="hljs-function"><span class="hljs-title">updateVerifyCode</span>(<span class="hljs-params"></span>)</span> &#123;    <span class="hljs-built_in">this</span>.vcUrl = <span class="hljs-string">&#x27;/verifyCode?time=&#x27;</span>+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();  &#125;&#125;</code></pre></div><h2 id="æ–‡ä»¶ä¸Šä¼ FastDFS"><a href="#æ–‡ä»¶ä¸Šä¼ FastDFS" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ FastDFS"></a>æ–‡ä»¶ä¸Šä¼ FastDFS</h2><p>å®‰è£…è¿‡ç¨‹ç•¥ï¼Œå…ˆè¯´æ˜ä¸€ä¸‹å®‰å…¨çš„é—®é¢˜</p><p>ç°åœ¨ï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®æˆ‘ä»¬æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ï¼Œè¿™è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™ä¸ªé—®é¢˜å¥½è§£å†³ï¼ŒåŠ ä¸€ä¸ªä¸Šä¼ æ—¶å€™çš„ä»¤ç‰Œå³å¯ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åœ¨æœåŠ¡ç«¯å¼€å¯ä»¤ç‰Œæ ¡éªŒï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>fdfs/http.conf</code></pre></div><p><a href="http://img.itboyhub.com/2020/03/fastdfs-6.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/fastdfs-6.png" alt="img"></a></p><p>é…ç½®å®Œæˆåï¼Œè®°å¾—é‡å¯æœåŠ¡ç«¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">./nginx</span> -s stop<span class="hljs-string">./nginx</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨å‰ç«¯å‡†å¤‡ä¸€ä¸ªè·å–ä»¤ç‰Œçš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getToken</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    <span class="hljs-keyword">int</span> ts = (<span class="hljs-keyword">int</span>) Instant.now().getEpochSecond();    String token = ProtoCommon.getToken(<span class="hljs-string">&quot;M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png&quot;</span>, ts, <span class="hljs-string">&quot;FastDFS1234567890&quot;</span>);    StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();  sb.append(<span class="hljs-string">&quot;http:172.16.211.4&quot;</span>)      .append(<span class="hljs-string">&quot;group1/M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png&quot;</span>)    sb.append(<span class="hljs-string">&quot;?token=&quot;</span>).append(token);    sb.append(<span class="hljs-string">&quot;&amp;ts=&quot;</span>).append(ts);    System.out.println(sb.toString());&#125;</code></pre></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯æ ¹æ® ProtoCommon.getToken æ–¹æ³•æ¥è·å–ä»¤ç‰Œï¼Œæ³¨æ„è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ è¦è®¿é—®çš„æ–‡ä»¶ idï¼Œ<strong>æ³¨æ„ï¼Œè¿™ä¸ªåœ°å€é‡Œè¾¹ä¸åŒ…å« groupï¼Œåƒä¸‡åˆ«æé”™äº†ï¼›</strong>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ—¶é—´æˆ³ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯†é’¥ï¼Œå¯†é’¥è¦å’ŒæœåŠ¡ç«¯çš„é…ç½®ä¸€è‡´ã€‚å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿½åŠ åˆ°è®¿é—®è·¯å¾„åé¢ï¼Œå¦‚ï¼š<code>http://192.168.91.128/group1/M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png?token=7e329cc50307000283a3ad3592bb6d32&amp;ts=1582975854</code>ã€‚<strong>æ­¤æ—¶è®¿é—®è·¯å¾„é‡Œè¾¹å¦‚æœæ²¡æœ‰ä»¤ç‰Œï¼Œä¼šè®¿é—®å¤±è´¥ã€‚</strong></p><h2 id="ä¸ªäººä¸­å¿ƒ"><a href="#ä¸ªäººä¸­å¿ƒ" class="headerlink" title="ä¸ªäººä¸­å¿ƒ"></a>ä¸ªäººä¸­å¿ƒ</h2><h3 id="å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯"><a href="#å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯"></a>å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯</h3><p>åœ¨Spring Securityä¸­æä¾›äº†Authenticationï¼Œå¯ä»¥ç›´æ¥åœ¨Controllerä¸­ç›´æ¥æ³¨å…¥å°±å¯ä»¥ä½¿ç”¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Hr <span class="hljs-title">getCurrentHr</span><span class="hljs-params">(Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">return</span> ((Hr) authentication.getPrincipal());&#125;</code></pre></div><h3 id="å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"><a href="#å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"></a>å¦‚ä½•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</h3><p>ç›¸å½“äºé‡æ–°æ„å»ºä¸€ä¸ªAuthenticationå®ä¾‹æ”¾åˆ°Contextä¸­å»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PutMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr, Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;</code></pre></div><p>åˆåˆ†ä¸ºä¿®æ”¹ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯ï¼Œä¸éœ€è¦é‡æ–°ç™»å½•ï¼Œä¿®æ”¹å¯†ç åéœ€è¦é‡æ–°ç™»å½•ï¼Œå…ˆå®šä¹‰æ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Hr <span class="hljs-title">getCurrentHr</span><span class="hljs-params">(Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">return</span> ((Hr) authentication.getPrincipal());&#125;<span class="hljs-meta">@PutMapping(&quot;/hr/info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr, Authentication authentication)</span> </span>&#123;    <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;<span class="hljs-meta">@PutMapping(&quot;/hr/pass&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Map&lt;String, Object&gt; info)</span> </span>&#123;    String oldpass = (String) info.get(<span class="hljs-string">&quot;oldpass&quot;</span>);    String pass = (String) info.get(<span class="hljs-string">&quot;pass&quot;</span>);    Integer hrid = (Integer) info.get(<span class="hljs-string">&quot;hrid&quot;</span>);    <span class="hljs-keyword">if</span> (hrService.updateHrPasswd(oldpass, pass, hrid)) &#123;        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(String oldpass, String pass, Integer hrid)</span> </span>&#123;    Hr hr = hrMapper.selectByPrimaryKey(hrid);    BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    <span class="hljs-keyword">if</span> (encoder.matches(oldpass, hr.getPassword())) &#123;        String encodePass = encoder.encode(pass);        Integer result = hrMapper.updatePasswd(hrid, encodePass);        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updatePasswd&quot;</span>&gt;</span>  update hr set password = #&#123;encodePass&#125; where id=#&#123;hrid&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div><h3 id="ä¸Šä¼ å¤´åƒï¼ˆFastDFSï¼‰"><a href="#ä¸Šä¼ å¤´åƒï¼ˆFastDFSï¼‰" class="headerlink" title="ä¸Šä¼ å¤´åƒï¼ˆFastDFSï¼‰"></a>ä¸Šä¼ å¤´åƒï¼ˆFastDFSï¼‰</h3><p><strong>å¼€å¯FastDFSï¼ˆTracker Serverã€Storage Serverã€Nginxï¼‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start/usr/local/nginx/sbin/.nginx</code></pre></div><p><strong>æ·»åŠ ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.zcx7878<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastdfs-client-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.27.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">## application.properties</span><span class="hljs-meta">fastdfs.nginx.host</span> = <span class="hljs-string">http://172.16.211.4/</span><span class="hljs-comment">## fastdfs-client.properties</span><span class="hljs-meta">fastdfs.connect_timeout_in_seconds</span> = <span class="hljs-string">5</span><span class="hljs-meta">fastdfs.network_timeout_in_seconds</span> = <span class="hljs-string">30</span><span class="hljs-meta">fastdfs.charset</span> = <span class="hljs-string">UTF-8</span><span class="hljs-meta">fastdfs.http_anti_steal_token</span> = <span class="hljs-string">false</span><span class="hljs-meta">fastdfs.http_secret_key</span> = <span class="hljs-string">lucifer1234567890</span><span class="hljs-meta">fastdfs.http_tracker_http_port</span> = <span class="hljs-string">80</span><span class="hljs-meta">fastdfs.tracker_servers</span> = <span class="hljs-string">172.16.211.4:22122</span><span class="hljs-comment">## Whether to open the connection pool, if not, create a new connection every time</span><span class="hljs-meta">fastdfs.connection_pool.enabled</span> = <span class="hljs-string">true</span><span class="hljs-comment">## max_count_per_entry: max connection count per host:port , 0 is not limit</span><span class="hljs-meta">fastdfs.connection_pool.max_count_per_entry</span> = <span class="hljs-string">500</span><span class="hljs-comment">## connections whose the idle time exceeds this time will be closed, unit: second, default value is 3600</span><span class="hljs-meta">fastdfs.connection_pool.max_idle_time</span> = <span class="hljs-string">3600</span><span class="hljs-comment">## Maximum waiting time when the maximum number of connections is reached, unit: millisecond, default value is 1000</span><span class="hljs-meta">fastdfs.connection_pool.max_wait_time_in_ms</span> = <span class="hljs-string">1000</span></code></pre></div><p><strong>å·¥å…·ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastDFSUtils</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> StorageClient1 client1;    <span class="hljs-keyword">static</span> &#123;        <span class="hljs-keyword">try</span> &#123;            ClientGlobal.initByProperties(<span class="hljs-string">&quot;fastdfs-client.properties&quot;</span>);            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();            TrackerServer trackerServer = trackerClient.getConnection();            client1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, <span class="hljs-keyword">null</span>);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (MyException e) &#123;            e.printStackTrace();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file)</span> </span>&#123;        String oldName = file.getOriginalFilename();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">return</span> client1.upload_file1(file.getBytes(), oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>), <span class="hljs-keyword">null</span>);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (MyException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/hr/userface&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrUserface</span><span class="hljs-params">(MultipartFile file, Integer id,Authentication authentication)</span> </span>&#123;    String fileId = FastDFSUtils.upload(file);    String url = nginxHost + fileId;    <span class="hljs-keyword">if</span> (hrService.updateUserface(url, id) == <span class="hljs-number">1</span>) &#123;        Hr hr = (Hr) authentication.getPrincipal();        hr.setUserface(url);        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ!&quot;</span>, url);    &#125;    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;æ›´æ–°å¤±è´¥!&quot;</span>);&#125;</code></pre></div><p><strong>Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateUserface</span><span class="hljs-params">(String url, Integer id)</span> </span>&#123;    <span class="hljs-keyword">return</span> hrMapper.updateUserface(url, id);&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUserface&quot;</span>&gt;</span>  update hr set userface = #&#123;url&#125; where id=#&#123;id&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div><h2 id="RabbitMQä¿è¯é‚®ç®±å‘é€çš„å¯é æ€§"><a href="#RabbitMQä¿è¯é‚®ç®±å‘é€çš„å¯é æ€§" class="headerlink" title="RabbitMQä¿è¯é‚®ç®±å‘é€çš„å¯é æ€§"></a>RabbitMQä¿è¯é‚®ç®±å‘é€çš„å¯é æ€§</h2><h3 id="æ¶ˆæ¯å‘é€-1"><a href="#æ¶ˆæ¯å‘é€-1" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><p>ç”Ÿæˆè¡¨è®°å½•æ¶ˆæ¯å‘é€çš„æ—¥å¿—</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210714152747045.png" alt="image-20210714152747045"></p><p>ç”Ÿæˆå¯¹åº”å®ä½“ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendLog</span> </span>&#123;    <span class="hljs-keyword">private</span> String msgId;    <span class="hljs-keyword">private</span> Integer empId;    <span class="hljs-comment">//0 æ¶ˆæ¯æŠ•é€’ä¸­   1 æŠ•é€’æˆåŠŸ   2æŠ•é€’å¤±è´¥</span>    <span class="hljs-keyword">private</span> Integer status;    <span class="hljs-comment">//RabbbitMQç›¸å…³</span>    <span class="hljs-keyword">private</span> String routeKey;    <span class="hljs-keyword">private</span> String exchange;    <span class="hljs-comment">//å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°</span>    <span class="hljs-keyword">private</span> Integer count;    <span class="hljs-comment">//å‘é€å¤±è´¥é‡è¯•æ—¶é—´</span>    <span class="hljs-keyword">private</span> Date tryTime;    <span class="hljs-keyword">private</span> Date createTime;    <span class="hljs-keyword">private</span> Date updateTime;&#125;</code></pre></div><p>æœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯SpringBootæä¾›çš„RabbitTemplateç›´æ¥å‘é€æ¶ˆæ¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>RabbitTemplate rabbitTemplate;</code></pre></div><p>è¿™é‡Œè‡ªå·±é…ç½®RabbitConfigï¼Œä¸å†ä½¿ç”¨ç³»ç»Ÿæä¾›çš„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(RabbitConfig.class);    <span class="hljs-meta">@Autowired</span>    CachingConnectionFactory cachingConnectionFactory;    <span class="hljs-meta">@Autowired</span>    MailSendLogService mailSendLogService;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">RabbitTemplate <span class="hljs-title">rabbitTemplate</span><span class="hljs-params">()</span> </span>&#123;        RabbitTemplate rabbitTemplate = <span class="hljs-keyword">new</span> RabbitTemplate(cachingConnectionFactory);        rabbitTemplate.setConfirmCallback((data, ack, cause) -&gt; &#123;            String msgId = data.getId();            <span class="hljs-keyword">if</span> (ack) &#123;                logger.info(msgId + <span class="hljs-string">&quot;:æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);                mailSendLogService.updateMailSendLogStatus(msgId, <span class="hljs-number">1</span>);<span class="hljs-comment">//ä¿®æ”¹æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œæ¶ˆæ¯æŠ•é€’æˆåŠŸ</span>            &#125; <span class="hljs-keyword">else</span> &#123;                logger.info(msgId + <span class="hljs-string">&quot;:æ¶ˆæ¯å‘é€å¤±è´¥&quot;</span>);            &#125;        &#125;);        rabbitTemplate.setReturnCallback((msg, repCode, repText, exchange, routingkey) -&gt; &#123;            logger.info(<span class="hljs-string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥&quot;</span>);        &#125;);        <span class="hljs-keyword">return</span> rabbitTemplate;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">mailQueue</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME, <span class="hljs-keyword">true</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">DirectExchange <span class="hljs-title">mailExchange</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectExchange(MailConstants.MAIL_EXCHANGE_NAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">mailBinding</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(mailQueue()).to(mailExchange()).with(MailConstants.MAIL_ROUTING_KEY_NAME);    &#125;&#125;</code></pre></div><p>å®šä¹‰çš„æ¶ˆæ¯å¸¸é‡å®ä½“ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailConstants</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer DELIVERING = <span class="hljs-number">0</span>;<span class="hljs-comment">//æ¶ˆæ¯æŠ•é€’ä¸­</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer SUCCESS = <span class="hljs-number">1</span>;<span class="hljs-comment">//æ¶ˆæ¯æŠ•é€’æˆåŠŸ</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer FAILURE = <span class="hljs-number">2</span>;<span class="hljs-comment">//æ¶ˆæ¯æŠ•é€’å¤±è´¥</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer MAX_TRY_COUNT = <span class="hljs-number">3</span>;<span class="hljs-comment">//æœ€å¤§é‡è¯•æ¬¡æ•°</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer MSG_TIMEOUT = <span class="hljs-number">1</span>;<span class="hljs-comment">//æ¶ˆæ¯è¶…æ—¶æ—¶é—´</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_QUEUE_NAME = <span class="hljs-string">&quot;lucifer.mail.queue&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_EXCHANGE_NAME = <span class="hljs-string">&quot;lucifer.mail.exchange&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_ROUTING_KEY_NAME = <span class="hljs-string">&quot;lucifer.mail.routing.key&quot;</span>;&#125;</code></pre></div><p>å¯¹åº”Service</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendLogService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MailSendLogMapper mailSendLogMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateMailSendLogStatus</span><span class="hljs-params">(String msgId, Integer status)</span> </span>&#123;        <span class="hljs-keyword">return</span> mailSendLogMapper.updateMailSendLogStatus(msgId, status);    &#125;&#125;</code></pre></div><p><strong>Mapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateMailSendLogStatus&quot;</span>&gt;</span>    update mail_send_log set status = #&#123;status&#125; where msgId=#&#123;msgId&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div><p>æ­¤æ—¶é’ˆå¯¹<strong>EmployeeService</strong>éœ€è¦è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œåœ¨æ·»åŠ å‘˜å·¥å‘é€é‚®ä»¶çš„æ—¶å€™ï¼Œåˆ©ç”¨è‡ªå·±çš„é…ç½®æ¥è¿›è¡Œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;        Date beginContract = employee.getBeginContract();        Date endContract = employee.getEndContract();        <span class="hljs-keyword">double</span> month = (Double.parseDouble(yearFormat.format(endContract)) - Double.parseDouble(yearFormat.format(beginContract))) * <span class="hljs-number">12</span>                + (Double.parseDouble(monthFormat.format(endContract)) - Double.parseDouble(monthFormat.format(beginContract)));        employee.setContractTerm(Double.parseDouble(decimalFormat.format(month / <span class="hljs-number">12</span>)));        <span class="hljs-comment">//é‚®ä»¶å‘é€</span>        <span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;            Employee emp = employeeMapper.getEmployeeById(employee.getId());            <span class="hljs-comment">//ç”Ÿæˆæ¶ˆæ¯çš„å”¯ä¸€id</span>            String msgId = UUID.randomUUID().toString();            MailSendLog mailSendLog = <span class="hljs-keyword">new</span> MailSendLog();            mailSendLog.setMsgId(msgId);            mailSendLog.setCreateTime(<span class="hljs-keyword">new</span> Date());            mailSendLog.setExchange(MailConstants.MAIL_EXCHANGE_NAME);            mailSendLog.setRouteKey(MailConstants.MAIL_ROUTING_KEY_NAME);            mailSendLog.setEmpId(emp.getId());            mailSendLog.setTryTime(<span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * MailConstants.MSG_TIMEOUT));            mailSendLogService.insert(mailSendLog);<span class="hljs-comment">//            rabbitTemplate.convertAndSend(&quot;lucifer.mail.welcome&quot;, emp);</span>            rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, <span class="hljs-keyword">new</span> CorrelationData(msgId));        &#125;            <span class="hljs-keyword">return</span> result;    &#125;</code></pre></div><p>æ·»åŠ Serviceæ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">insert</span><span class="hljs-params">(MailSendLog mailSendLog)</span> </span>&#123;    <span class="hljs-keyword">return</span> mailSendLogMapper.insert(mailSendLog);&#125;</code></pre></div><p>Mapperï¼Œæ•°æ®åº“è®°å½•æ¯ä¸ªæ¶ˆæ¯å‘é€çš„çŠ¶æ€</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.MailSendLog&quot;</span>&gt;</span>    insert into mail_send_log (msgId,empId,routeKey,exchange,tryTime,createTime) values (#&#123;msgId&#125;,#&#123;empId&#125;,#&#123;routeKey&#125;,#&#123;exchange&#125;,#&#123;tryTime&#125;,#&#123;createTime&#125;);<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><p>æœ€åéœ€è¦æ›´æ”¹<code>MailReceiver</code>å’Œ<code>MailserverApplication</code>ä¸­çš„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(queues = MailConstants.MAIL_QUEUE_NAME)</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME);    &#125;</code></pre></div><h4 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h4><p>å½“æ¶ˆæ¯å‘é€å¤±è´¥çš„æ—¶å€™ï¼Œéœ€è¦æ£€æµ‹æ˜¯å¦éœ€è¦å®šæ—¶é‡å‘ï¼Œé¦–å…ˆåœ¨Serviceé‡Œå®šä¹‰task</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendTask</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MailSendLogService mailSendLogService;    <span class="hljs-meta">@Autowired</span>    RabbitTemplate rabbitTemplate;    <span class="hljs-meta">@Autowired</span>    EmployeeService employeeService;    <span class="hljs-comment">//æ¯éš”10sæ‰§è¡Œä¸€æ¬¡</span>    <span class="hljs-meta">@Scheduled(cron = &quot;0/10 * * * * ?&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mailResendTask</span><span class="hljs-params">()</span> </span>&#123;        List&lt;MailSendLog&gt; logs = mailSendLogService.getMailSendLogsByStatus();        <span class="hljs-keyword">if</span> (logs == <span class="hljs-keyword">null</span> || logs.size() == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span>;        &#125;        logs.forEach(mailSendLog-&gt;&#123;            <span class="hljs-keyword">if</span> (mailSendLog.getCount() &gt;= <span class="hljs-number">3</span>) &#123;                mailSendLogService.updateMailSendLogStatus(mailSendLog.getMsgId(), <span class="hljs-number">2</span>);<span class="hljs-comment">//ç›´æ¥è®¾ç½®è¯¥æ¡æ¶ˆæ¯å‘é€å¤±è´¥</span>            &#125;<span class="hljs-keyword">else</span>&#123;                mailSendLogService.updateCount(mailSendLog.getMsgId(), <span class="hljs-keyword">new</span> Date());                Employee emp = employeeService.getEmployeeById(mailSendLog.getEmpId());                rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, <span class="hljs-keyword">new</span> CorrelationData(mailSendLog.getMsgId()));            &#125;        &#125;);    &#125;&#125;</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šæ³¨è§£<code>@EnableScheduling</code></p><p>æ·»åŠ å¯¹åº”Serviceæ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;MailSendLog&gt; <span class="hljs-title">getMailSendLogsByStatus</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> mailSendLogMapper.getMailSendLogsByStatus();&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateCount</span><span class="hljs-params">(String msgId, Date date)</span> </span>&#123;    <span class="hljs-keyword">return</span> mailSendLogMapper.updateCount(msgId,date);&#125;</code></pre></div><p>Mapper</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMailSendLogsByStatus&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.MailSendLog&quot;</span>&gt;</span>    # å°è¯•çš„æ—¶é—´å°äºå½“å‰æ—¶é—´ï¼Œéœ€è¦é‡æ–°å¤„ç†    select * from mail_send_log where status=0 and tryTime <span class="hljs-symbol">&amp;lt;</span> sysdate()<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateCount&quot;</span>&gt;</span>    update mail_send_log set count=count+1,updateTime=#&#123;date&#125; where msgId=#&#123;msgId&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div><p>åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å›è°ƒ</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#å¼€å¯confirmså›è°ƒ</span><span class="hljs-comment">#spring.rabbitmq.publisher-confirms=true</span><span class="hljs-comment">#å¼€å¯returnedMessageå›è°ƒ</span><span class="hljs-comment">#spring.rabbitmq.publisher-returns=true</span><span class="hljs-comment">#æ–°ç‰ˆspringbootéœ€è¦è¿™æ ·é…ç½®</span><span class="hljs-meta">spring.rabbitmq.publisher-confirm-type</span>=<span class="hljs-string">correlated</span></code></pre></div><blockquote><p>spring.rabbitmq.publisher-confirmåœ¨springboot2.2.0.RELEASEç‰ˆæœ¬ä¹‹å‰æ˜¯amqpæ­£å¼æ”¯æŒçš„å±æ€§ï¼Œç”¨æ¥é…ç½®æ¶ˆæ¯å‘é€åˆ°äº¤æ¢å™¨ä¹‹åæ˜¯å¦è§¦å‘å›è°ƒæ–¹æ³•ï¼Œåœ¨2.2.0åŠä¹‹åä½¿ç”¨spring.rabbitmq.publisher-confirm-typeå±æ€§é…ç½®ä»£æ›¿ï¼Œç”¨æ¥é…ç½®æ›´å¤šçš„ç¡®è®¤ç±»å‹ï¼›</p><p>å…¶ä¸­ï¼š</p><ul><li>NONEå€¼æ˜¯ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</li><li>CORRELATEDå€¼æ˜¯å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</li><li>SIMPLEå€¼ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’ŒCORRELATEDå€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œå…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨rabbitTemplateè°ƒç”¨waitForConfirmsæˆ–waitForConfirmsOrDieæ–¹æ³•ç­‰å¾…brokerèŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯waitForConfirmsOrDieæ–¹æ³•å¦‚æœè¿”å›falseåˆ™ä¼šå…³é—­channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ°broker;</li></ul></blockquote><h3 id="æ¶ˆæ¯æ¶ˆè´¹"><a href="#æ¶ˆæ¯æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹"></a>æ¶ˆæ¯æ¶ˆè´¹</h3><p>åˆ©ç”¨Redisï¼Œå½“æœ‰å¤šä¸ªç›¸åŒçš„æ¶ˆæ¯å‘é€çš„æ—¶å€™ï¼Œåªè¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œä¸äº§ç”Ÿé‡å¤æ¶ˆè´¹ï¼Œå› ä¸ºæ¯ä¸ªæ¶ˆæ¯æœ‰å”¯ä¸€idï¼Œæ¯æ¬¡æŠŠidå­˜åˆ°redisä¸­å»ï¼Œç„¶åæŸ¥è¿™ä¸ªæ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœè¢«æ¶ˆè´¹è¿‡ï¼Œå°±ä¸å†é‡å¤æ¶ˆè´¹</p><p><strong>é¦–å…ˆåœ¨mailæ¨¡å—æ·»åŠ ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>é…ç½®redis</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#å¼€å¯æ‰‹åŠ¨ç¡®è®¤</span><span class="hljs-meta">spring.rabbitmq.listener.simple.acknowledge-mode</span>=<span class="hljs-string">manual</span><span class="hljs-comment">#redis</span><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">172.16.211.4</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span></code></pre></div><blockquote><p>æ³¨æ„ï¼Œrediséœ€è¦å¼€å¯è¿œç¨‹è®¿é—®</p></blockquote><p>æ¯æ¬¡éœ€è¦æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯ï¼Œæ›´æ”¹æ¶ˆæ¯æ¥æ”¶ç±»</p><p>ä¸»è¦æ˜¯åˆ©ç”¨<code>channel.basicAck</code>å’Œ<code>channel.basicNack</code>æ¥ç¡®è®¤æ˜¯å¦è¢«æ¶ˆè´¹è¿‡</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailReceiver</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(MailReceiver.class);    <span class="hljs-meta">@Autowired</span>    JavaMailSender javaMailSender;    <span class="hljs-meta">@Autowired</span>    MailProperties mailProperties;    <span class="hljs-meta">@Autowired</span>    TemplateEngine templateEngine;    <span class="hljs-meta">@Autowired</span>    StringRedisTemplate redisTemplate;    <span class="hljs-meta">@RabbitListener(queues =  MailConstants.MAIL_QUEUE_NAME)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//åˆ©ç”¨rediså®Œæˆæ¶ˆæ¯æ¶ˆè´¹</span>        Employee employee = (Employee) message.getPayload();        MessageHeaders headers = message.getHeaders();        Long tag = (Long) headers.get(AmqpHeaders.DELIVERY_TAG);        String msgId = (String) headers.get(<span class="hljs-string">&quot;spring_returned_message_correlation&quot;</span>);        <span class="hljs-keyword">if</span> (redisTemplate.opsForHash().entries(<span class="hljs-string">&quot;mail_log&quot;</span>).containsKey(msgId)) &#123;            <span class="hljs-comment">//redis ä¸­åŒ…å«è¯¥ keyï¼Œè¯´æ˜è¯¥æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹è¿‡</span>            logger.info(msgId + <span class="hljs-string">&quot;:æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹&quot;</span>);            channel.basicAck(tag, <span class="hljs-keyword">false</span>);<span class="hljs-comment">//ç¡®è®¤æ¶ˆæ¯å·²æ¶ˆè´¹</span>            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">//æ”¶åˆ°æ¶ˆæ¯ï¼Œå‘é€é‚®ä»¶</span>        MimeMessage msg = javaMailSender.createMimeMessage();        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(msg);        <span class="hljs-keyword">try</span> &#123;            helper.setTo(employee.getEmail());            helper.setFrom(mailProperties.getUsername());            helper.setSubject(<span class="hljs-string">&quot;å…¥èŒæ¬¢è¿!&quot;</span>);            helper.setSentDate(<span class="hljs-keyword">new</span> Date());            Context context = <span class="hljs-keyword">new</span> Context();            context.setVariable(<span class="hljs-string">&quot;name&quot;</span>, employee.getName());            context.setVariable(<span class="hljs-string">&quot;posName&quot;</span>, employee.getPosition().getName());            context.setVariable(<span class="hljs-string">&quot;joblevelName&quot;</span>, employee.getJobLevel().getName());            context.setVariable(<span class="hljs-string">&quot;departmentName&quot;</span>, employee.getDepartment().getName());            <span class="hljs-comment">//å¯¹åº”mail.html</span>            String mail = templateEngine.process(<span class="hljs-string">&quot;mail&quot;</span>, context);            helper.setText(mail, <span class="hljs-keyword">true</span>);            javaMailSender.send(msg);            redisTemplate.opsForHash().put(<span class="hljs-string">&quot;mail_log&quot;</span>, msgId, <span class="hljs-string">&quot;lucifer&quot;</span>);            channel.basicAck(tag, <span class="hljs-keyword">false</span>);            logger.info(msgId + <span class="hljs-string">&quot;:é‚®ä»¶å‘é€æˆåŠŸ&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;            channel.basicNack(tag, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);            e.printStackTrace();            <span class="hljs-comment">//å‘é€å¤±è´¥ï¼Œè¿”å›æ—¥å¿—</span>            logger.error(<span class="hljs-string">&quot;é‚®ä»¶å‘é€å¤±è´¥ï¼š&quot;</span> + e.getMessage());        &#125;    &#125;&#125;</code></pre></div><h2 id="Spring-Cacheç¼“å­˜èœå•"><a href="#Spring-Cacheç¼“å­˜èœå•" class="headerlink" title="Spring Cacheç¼“å­˜èœå•"></a>Spring Cacheç¼“å­˜èœå•</h2><p>åœ¨Spring Bootä¸­ï¼Œä½¿ç”¨Redisç¼“å­˜ï¼Œæ—¢å¯ä»¥ä½¿ç”¨RedisTemplateè‡ªå·±æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ˜¯Spring Cacheæä¾›çš„ç»Ÿä¸€æ¥å£ï¼Œå®ç°æ—¢å¯ä»¥æ˜¯Redisï¼Œä¹Ÿå¯ä»¥æ˜¯Ehcacheæˆ–è€…å…¶ä»–æ”¯æŒè¿™ç§è§„èŒƒçš„ç¼“å­˜æ¡†æ¶ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒSpring Cacheå’ŒRedisã€Ehcacheçš„å…³ç³»å°±åƒJDBCä¸å„ç§æ•°æ®åº“é©±åŠ¨çš„å…³ç³»ã€‚</p><p><strong>åœ¨webæ¨¡å—ä¸­å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#å¼€å¯redis+cacheç¼“å­˜</span><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">172.16.211.4</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span><span class="hljs-meta">spring.cache.cache-names</span>=<span class="hljs-string">menus_cache</span></code></pre></div><p><strong>å¯åŠ¨ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableCaching</span><span class="hljs-meta">@MapperScan(basePackages=&quot;org.lucifer.vbluciferpro.mapper&quot;)</span><span class="hljs-meta">@EnableScheduling</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuciferproWebApplication</span> </span>&#123;</code></pre></div><p>EnableCachingæ³¨è§£é‡Œ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210716171759970.png" alt="image-20210716171759970"></p><p>é»˜è®¤ä½¿ç”¨JDKä»£ç†ï¼Œå¦‚æœè®¾ä¸ºtrueï¼Œå°†ä½¿ç”¨cglaib</p><p><strong>å¼•å…¥Service</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-meta">@CacheConfig(cacheNames = &quot;menus_cache&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;    <span class="hljs-meta">@Cacheable</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();  &#125;   &#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring Security</tag>
      
      <tag>SpringBoot</tag>
      
      <tag>MyBatis</tag>
      
      <tag>MySQL</tag>
      
      <tag>WebSocket</tag>
      
      <tag>RabbitMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootåˆé›†</title>
    <link href="/2021/08/05/SpringBoot/"/>
    <url>/2021/08/05/SpringBoot/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><blockquote><p>æœ¬æ–‡æ•´ç†äº†SpingBootæ•´åˆä¸»æµå¼€å‘æ¨¡å—çš„çŸ¥è¯†ï¼Œå‚è€ƒæ¥è‡ª<a href="http://www.javaboy.org/">æ¾å“¥ç³»åˆ—åšå®¢</a>ï¼Œä¾›å­¦ä¹ </p></blockquote><h1 id="SpringBootåŸºç¡€é…ç½®"><a href="#SpringBootåŸºç¡€é…ç½®" class="headerlink" title="SpringBootåŸºç¡€é…ç½®"></a>SpringBootåŸºç¡€é…ç½®</h1><h2 id="1-Maven"><a href="#1-Maven" class="headerlink" title="1. Maven"></a>1. Maven</h2><p>æˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹  JavaWeb çš„æ—¶å€™ï¼Œä½¿ç”¨ Servlet/JSP åšå¼€å‘ï¼Œä¸€ä¸ªæ¥å£æä¸€ä¸ª Servlet ï¼Œå¾ˆå¤´å¤§ï¼Œåæ¥æˆ‘ä»¬é€šè¿‡éšè—åŸŸæˆ–è€…åå°„ç­‰æ–¹å¼ï¼Œå¯ä»¥å‡å°‘ Servlet çš„åˆ›å»ºï¼Œä½†æ˜¯ä¾ç„¶ä¸æ–¹ä¾¿ï¼Œå†åæ¥ï¼Œæˆ‘ä»¬å¼•å…¥ Struts2/SpringMVC è¿™ä¸€ç±»çš„æ¡†æ¶ï¼Œæ¥ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘ ï¼Œå’Œ Servlet/JSP ç›¸æ¯”ï¼Œå¼•å…¥æ¡†æ¶ä¹‹åï¼Œç”Ÿäº§åŠ›ç¡®å®æé«˜äº†ä¸å°‘ï¼Œä½†æ˜¯ç”¨ä¹…äº†ï¼Œåˆå‘ç°äº†æ–°çš„é—®é¢˜ï¼Œå³é…ç½®ç¹çæ˜“å‡ºé”™ï¼Œè¦åšä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå…ˆæ­å»ºç¯å¢ƒï¼Œç¯å¢ƒæ­å»ºæ¥æ­å»ºå»ï¼Œå°±æ˜¯é‚£å‡ è¡Œé…ç½®ï¼Œä¸åŒçš„é¡¹ç›®ï¼Œå¯èƒ½å°±æ˜¯åŒ…ä¸åŒï¼Œå…¶ä»–å¤§éƒ¨åˆ†çš„é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒJava æ€»æ˜¯è¢«äººè¯Ÿç—…é…ç½®ç¹çä»£ç é‡å·¨å¤§ï¼Œè¿™å°±æ˜¯å…¶ä¸­ä¸€ä¸ªè¡¨ç°ã€‚é‚£ä¹ˆæ€ä¹ˆåŠï¼ŸSpring Boot åº”è¿è€Œç”Ÿï¼ŒSpring Boot ä¸»è¦æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š</p><ul><li>ä¸ºæ‰€æœ‰åŸºäº Spring çš„ Java å¼€å‘æä¾›æ–¹ä¾¿å¿«æ·çš„å…¥é—¨ä½“éªŒã€‚</li><li>å¼€ç®±å³ç”¨ï¼Œæœ‰è‡ªå·±è‡ªå®šä¹‰çš„é…ç½®å°±æ˜¯ç”¨è‡ªå·±çš„ï¼Œæ²¡æœ‰å°±ä½¿ç”¨å®˜æ–¹æä¾›çš„é»˜è®¤çš„ã€‚</li><li>æä¾›äº†ä¸€ç³»åˆ—é€šç”¨çš„éåŠŸèƒ½æ€§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åµŒå…¥å¼æœåŠ¡å™¨ã€å®‰å…¨ç®¡ç†ã€å¥åº·æ£€æµ‹ç­‰ã€‚</li><li>ç»å¯¹æ²¡æœ‰ä»£ç ç”Ÿæˆï¼Œä¹Ÿä¸éœ€è¦XMLé…ç½®ã€‚</li></ul><blockquote><p>åœ¨åˆ›å»ºSpringBooté¡¹ç›®æ—¶ï¼Œå¦‚æœå®˜æ–¹çš„<a href="https://start.spring.ioæ— æ³•è®¿é—®,å¯ä»¥è®¿é—®https//start.aliyun.io">https://start.spring.ioæ— æ³•è®¿é—®ï¼Œå¯ä»¥è®¿é—®https://start.aliyun.io</a></p></blockquote><p><strong>åˆ›å»ºæˆåŠŸåï¼Œpom.xml åæ ‡</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span></code></pre></div><h3 id="1-1-åŸºæœ¬åŠŸèƒ½"><a href="#1-1-åŸºæœ¬åŠŸèƒ½" class="headerlink" title="1.1 åŸºæœ¬åŠŸèƒ½"></a>1.1 åŸºæœ¬åŠŸèƒ½</h3><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹æ—¶ï¼Œå¯ä»¥ç»§æ‰¿è‡ªä¸€ä¸ª <code>spring-boot-starter-parent</code> ï¼Œä¹Ÿå¯ä»¥ä¸ç»§æ‰¿è‡ªå®ƒï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§æƒ…å†µã€‚å…ˆæ¥çœ‹ parent çš„åŸºæœ¬åŠŸèƒ½æœ‰å“ªäº›ï¼Ÿ</p><ul><li>å®šä¹‰äº† Java ç¼–è¯‘ç‰ˆæœ¬ä¸º 1.8 ã€‚</li><li>ä½¿ç”¨ UTF-8 æ ¼å¼ç¼–ç ã€‚</li><li>ç»§æ‰¿è‡ª <code>spring-boot-dependencies</code>ï¼Œè¿™ä¸ªé‡Œè¾¹å®šä¹‰äº†ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºç»§æ‰¿äº†è¿™ä¸ªä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™ä¾èµ–æ—¶æ‰ä¸éœ€è¦å†™ç‰ˆæœ¬å·ã€‚</li><li>æ‰§è¡Œæ‰“åŒ…æ“ä½œçš„é…ç½®ã€‚</li><li>è‡ªåŠ¨åŒ–çš„èµ„æºè¿‡æ»¤ã€‚</li><li>è‡ªåŠ¨åŒ–çš„æ’ä»¶é…ç½®ã€‚</li><li>é’ˆå¯¹ application.properties å’Œ application.yml çš„èµ„æºè¿‡æ»¤ï¼ŒåŒ…æ‹¬é€šè¿‡ profile å®šä¹‰çš„ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ application-dev.properties å’Œ application-dev.yml</li></ul><blockquote><p>è¯·æ³¨æ„ï¼Œç”±äº<code>application.properties</code>å’Œ<code>application.yml</code>æ–‡ä»¶æ¥å—Springæ ·å¼å ä½ç¬¦ <code>$ &#123;...&#125;</code> ï¼Œå› æ­¤ Maven è¿‡æ»¤æ›´æ”¹ä¸ºä½¿ç”¨ <code>@ .. @</code> å ä½ç¬¦ï¼Œå½“ç„¶å¼€å‘è€…å¯ä»¥é€šè¿‡è®¾ç½®åä¸º<code> resource.delimiter</code> çš„Maven å±æ€§æ¥è¦†ç›– <code>@ .. @</code> å ä½ç¬¦</p></blockquote><h3 id="1-2-æºç åˆ†æ"><a href="#1-2-æºç åˆ†æ" class="headerlink" title="1.2 æºç åˆ†æ"></a>1.2 æºç åˆ†æ</h3><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ° Maven ä»“åº“ä¸­çœ‹åˆ°è¿™ä¸ªå…·ä½“çš„ parent æ–‡ä»¶ï¼Œä»¥ 2.1.4 è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ï¼Œè¿™é‡Œçš„è·¯å¾„æ˜¯ <code>C:\Users\sang\.m2\repository\org\springframework\boot\spring-boot-starter-parent\2.1.4.RELEASE\spring-boot-starter-parent-2.1.4.RELEASE.pom</code> ,æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¿«é€Ÿé˜…è¯»æ–‡ä»¶æºç ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥è¯å®æˆ‘ä»¬å‰é¢è¯´çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/2-1-20210521101059250.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒç»§æ‰¿è‡ª <code>spring-boot-dependencies</code> ï¼Œè¿™é‡Œä¿å­˜äº†åŸºæœ¬çš„ä¾èµ–ä¿¡æ¯ï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°é¡¹ç›®çš„ç¼–ç æ ¼å¼ï¼ŒJDK çš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œå½“ç„¶ä¹Ÿæœ‰æˆ‘ä»¬å‰é¢æåˆ°çš„æ•°æ®è¿‡æ»¤ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬å†æ ¹æ®å®ƒçš„ parent ä¸­æŒ‡å®šçš„ <code>spring-boot-dependencies</code> ä½ç½®ï¼Œæ¥çœ‹çœ‹ <code>spring-boot-dependencies</code> ä¸­çš„å®šä¹‰ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/2-2.png" alt="img"></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ç‰ˆæœ¬çš„å®šä¹‰ä»¥åŠ<code>dependencyManagement</code>èŠ‚ç‚¹ï¼Œæ˜ç™½äº†ä¸ºå•¥ Spring Boot é¡¹ç›®ä¸­éƒ¨åˆ†ä¾èµ–ä¸éœ€è¦å†™ç‰ˆæœ¬å·äº†ã€‚</p><h3 id="1-3-ä¸ç”¨-parent"><a href="#1-3-ä¸ç”¨-parent" class="headerlink" title="1.3 ä¸ç”¨ parent"></a>1.3 ä¸ç”¨ parent</h3><p>ä½†æ˜¯å¹¶éæ‰€æœ‰çš„å…¬å¸éƒ½éœ€è¦è¿™ä¸ª parent ï¼Œæœ‰çš„æ—¶å€™ï¼Œå…¬å¸é‡Œè¾¹ä¼šæœ‰è‡ªå·±å®šä¹‰çš„ parent ï¼Œæˆ‘ä»¬çš„ Spring Boot é¡¹ç›®è¦ç»§æ‰¿è‡ªå…¬å¸å†…éƒ¨çš„ parent ï¼Œè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä¸€ä¸ªç®€å•çš„åŠæ³•å°±æ˜¯æˆ‘ä»¬è‡ªè¡Œå®šä¹‰<code>dependencyManagement</code>èŠ‚ç‚¹ï¼Œç„¶ååœ¨é‡Œè¾¹å®šä¹‰å¥½ç‰ˆæœ¬å·ï¼Œå†æ¥ä¸‹æ¥åœ¨å¼•ç”¨ä¾èµ–æ—¶ä¹Ÿå°±ä¸ç”¨å†™ç‰ˆæœ¬å·äº†ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre></div><p>è¿™æ ·å†™ä¹‹åï¼Œä¾èµ–çš„ç‰ˆæœ¬å·é—®é¢˜è™½ç„¶è§£å†³äº†ï¼Œä½†æ˜¯å…³äºæ‰“åŒ…çš„æ’ä»¶ã€ç¼–è¯‘çš„ JDK ç‰ˆæœ¬ã€æ–‡ä»¶çš„ç¼–ç æ ¼å¼ç­‰ç­‰è¿™äº›é…ç½®ï¼Œåœ¨æ²¡æœ‰ parent çš„æ—¶å€™ï¼Œè¿™äº›ç»Ÿç»Ÿè¦è‡ªå·±å»é…ç½®</p><h3 id="1-4-lt-resources-gt"><a href="#1-4-lt-resources-gt" class="headerlink" title="1.4 &lt;resources/&gt;"></a>1.4 <code>&lt;resources/&gt;</code></h3><p><code>pom.xml</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">javaboy.name</span>&gt;</span>www.lucifer.org<span class="hljs-tag">&lt;/<span class="hljs-name">javaboy.name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>          <span class="hljs-comment">&lt;!-- è¦å¤„ç†açš„ï¼Œä½†åªå†™è¿™ä¸ªä¼šå¿½ç•¥å…¶ä»–çš„--&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>a.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>          <span class="hljs-comment">&lt;!-- æ‰€ä»¥åŠ ä¸Šæ­¤è¯­å¥ï¼Œè¡¨ç¤ºé™¤äº†aï¼Œå…¶ä»–çš„ä¸è¦å¤„ç† --&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>a.properties<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p><code>a.properties</code>æ–‡ä»¶çš„å®šä¹‰</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">a.name</span>=<span class="hljs-string">$&#123;javaboy.name&#125;</span></code></pre></div><p>åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œ<code>a.name</code>ä¼šç›´æ¥ä»<code>&lt;properties&gt;</code>æ‹¿å–å€¼ï¼Œå¾—åˆ°<a href="http://www.lucifer.org/">www.lucifer.org</a></p><h2 id="2-SpringBootApplication"><a href="#2-SpringBootApplication" class="headerlink" title="2.  @SpringBootApplication"></a>2.  @SpringBootApplication</h2><h3 id="2-1-SpringBootConfiguration"><a href="#2-1-SpringBootConfiguration" class="headerlink" title="2.1 @SpringBootConfiguration"></a>2.1 @SpringBootConfiguration</h3><p>å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£ <code>@SpringBootApplication</code>å¼•ç”¨äº†<code>@SpringBootConfiguration</code></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521102815674.png" alt="image-20210521102815674"></p><p>è¿™é‡Œé¢åˆç›´æ¥è°ƒç”¨äº†<code>@Configuration</code>ï¼Œè¿™å°±å¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æ™®é€šçš„é…ç½®ç±»MyConfigä¸­ï¼Œ<code>@Configuration</code>å’Œ<code>@Component</code>çœ‹ä¼¼åŠŸèƒ½ç›¸åŒï¼Œä¸ºä»€ä¹ˆè¦ç”¨<code>@Configuration</code>ï¼Œé€šè¿‡ä»¥ä¸‹é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Author <span class="hljs-title">author</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Author();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Book <span class="hljs-title">book</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Book(author());    &#125;&#125;</code></pre></div><p>å‘ç°ä½¿ç”¨<code>@Configuration</code>åˆ›å»ºå‡ºæ¥äº†çš„Authorå¯¹è±¡é€šè¿‡ä»£ç†å¯¹è±¡äº†çš„ï¼Œè€Œ<code>@Component</code>æ²¡æœ‰ï¼Œå…¶ä¸­<code>Book(author())</code>å¦‚æœBooké‡Œçš„Authorä¹‹å‰å·²ç»åˆ›å»ºï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨ï¼Œå¹¶ä¸ä¼šé‡å¤åˆ›å»ºï¼Œè¿™é‡Œå°±ä¸ä¼š</p><h3 id="2-2-EnableAutoConfiguration"><a href="#2-2-EnableAutoConfiguration" class="headerlink" title="2.2 EnableAutoConfiguration"></a>2.2 EnableAutoConfiguration</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="hljs-meta">@Documented</span><span class="hljs-meta">@Inherited</span><span class="hljs-meta">@AutoConfigurationPackage</span><span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;    String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;    String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;&#125;</code></pre></div><p>åœ¨åŸç”Ÿçš„Springæ¡†æ¶ä¸­ï¼Œç»„ä»¶è£…é…æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>Spring2.5ï¼Œ@Component</li><li>Spring3.0+ï¼Œä½¿ç”¨@Configuration+@Bean</li><li>Spring3.1+ï¼Œ@EnableXXX+@Import</li></ul><p>ä¸ºäº†è¯´æ˜<code>@EnableXXX+@Import</code>ï¼Œå…ˆå®šä¹‰å®ä½“ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Apple</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Banana</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;&#125;</code></pre></div><p><strong>æœ‰å››ç§å®šä¹‰æ³¨è§£çš„æ–¹å¼</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FruitImportSelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ImportSelector</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String[]&#123;Apple.class.getName(), Banana.class.getName()&#125;;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FruitImportDefinitionRegistar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ImportBeanDefinitionRegistrar</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;        registry.registerBeanDefinition(<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-keyword">new</span> RootBeanDefinition(Apple.class));        registry.registerBeanDefinition(<span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-keyword">new</span> RootBeanDefinition(Banana.class));    &#125;&#125;<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="hljs-meta">@Target(ElementType.TYPE)</span><span class="hljs-comment">//1.@Import(&#123;Apple.class, Banana.class&#125;)</span><span class="hljs-comment">//2.å¯ä»¥ç›´æ¥å¯¼å…¥é…ç½®ç±»</span><span class="hljs-comment">//3.@Import(&#123;FruitImportSelector.class&#125;)</span><span class="hljs-meta">@Import(&#123;FruitImportDefinitionRegistar.class&#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableFruit &#123;&#125;</code></pre></div><p>ä»è€Œå¯ä»¥å‘ç°</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521105018844.png" alt="image-20210521105018844"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521105101247.png" alt="image-20210521105101247"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521105547266.png" alt="image-20210521105547266"></p><h2 id="3-åŸºç¡€é…ç½®"><a href="#3-åŸºç¡€é…ç½®" class="headerlink" title="3. åŸºç¡€é…ç½®"></a>3. åŸºç¡€é…ç½®</h2><h3 id="3-1-Tomcaté…ç½®"><a href="#3-1-Tomcaté…ç½®" class="headerlink" title="3.1 Tomcaté…ç½®"></a>3.1 Tomcaté…ç½®</h3><h4 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h4><p>æ›´æ”¹<code>pom.xml</code>æ–‡ä»¶æ’é™¤è‡ªå¸¦çš„Tomcatåå°±èƒ½è‡ªå®šä¹‰è‡ªå·±æ‰€éœ€çš„</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¯ä»¥ä»»ä½•å®¹å™¨ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#ä¸è¦å¼€å¯webå®¹å™¨ï¼Œä»¥æ™®é€šSEé¡¹ç›®è¿è¡Œ</span><span class="hljs-meta">spring.main.web-application-type</span>=<span class="hljs-string">none</span><span class="hljs-comment">#æ›´æ”¹ç«¯å£</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">8888</span><span class="hljs-comment">#å…³é—­æ‰€æœ‰çš„ http ç«¯ç‚¹</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">-1</span><span class="hljs-comment">#éšæœºç«¯å£</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">0</span><span class="hljs-comment">#ç«¯å£å‹ç¼©</span><span class="hljs-meta">server.compression.enabled</span>=<span class="hljs-string">true</span></code></pre></div><p>éšæœºç«¯å£éœ€è¦é€šè¿‡ç›‘å¬å™¨è·å–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationListener</span>&lt;<span class="hljs-title">WebServerInitializedEvent</span>&gt; </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationEvent</span><span class="hljs-params">(WebServerInitializedEvent event)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;event.getWebServer().getPort() = &quot;</span> + event.getWebServer().getPort());    &#125;&#125;</code></pre></div><h4 id="æ—¥å¿—é…ç½®"><a href="#æ—¥å¿—é…ç½®" class="headerlink" title="æ—¥å¿—é…ç½®"></a>æ—¥å¿—é…ç½®</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># ç”Ÿæˆçš„è®¿é—®æ—¥å¿—å°†åœ¨è¯¥ç›®å½•ä¸‹</span><span class="hljs-meta">server.tomcat.basedir</span>=<span class="hljs-string">my-tomcat</span><span class="hljs-comment"># å¼€å¯è®¿é—®æ—¥å¿—ï¼Œé»˜è®¤çš„æ—¥å¿—ä½ç½®åœ¨é¡¹ç›®è¿è¡Œçš„ä¸´æ—¶ç›®å½•ä¸­ï¼Œé»˜è®¤ç”Ÿæˆçš„æ—¥å¿—æ ¼å¼ access_log.2021-05-12.log</span><span class="hljs-meta">server.tomcat.accesslog.enabled</span>=<span class="hljs-string">true</span><span class="hljs-comment"># ç”Ÿæˆæ—¥å¿—æ–‡ä»¶åçš„å‰ç¼€ï¼Œé»˜è®¤æ˜¯ access_log</span><span class="hljs-meta">server.tomcat.accesslog.prefix</span>=<span class="hljs-string">tomcat_log</span><span class="hljs-comment"># ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶åç¼€</span><span class="hljs-meta">server.tomcat.accesslog.suffix</span>=<span class="hljs-string">.log</span><span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶åä¸­çš„æ—¥æœŸæ ¼å¼</span><span class="hljs-meta">server.tomcat.accesslog.file-date-format</span>=<span class="hljs-string">.yyyyMMdd</span><span class="hljs-comment"># ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶å†…å®¹æ ¼å¼ä¹Ÿæ˜¯å¯ä»¥è°ƒæ•´çš„</span><span class="hljs-comment"># %h è¯·æ±‚çš„å®¢æˆ·ç«¯ IP</span><span class="hljs-comment"># %l ç”¨æˆ·çš„èº«ä»½</span><span class="hljs-comment"># %u ç”¨æˆ·å</span><span class="hljs-comment"># %t è¯·æ±‚æ—¶é—´</span><span class="hljs-comment"># %r è¯·æ±‚åœ°å€</span><span class="hljs-comment"># %s å“åº”çš„çŠ¶æ€ç </span><span class="hljs-comment"># %b å“åº”çš„å¤§å°</span><span class="hljs-meta">server.tomcat.accesslog.pattern</span>=<span class="hljs-string">%h %l %u %t \&quot;%r\&quot; %s %b</span><span class="hljs-comment"># æœåŠ¡å™¨å†…éƒ¨æ—¥å¿—å¼€å¯</span><span class="hljs-meta">logging.level.org.apache.tomcat</span>=<span class="hljs-string">debug</span><span class="hljs-meta">logging.level.org.apache.catalina</span>=<span class="hljs-string">debug</span></code></pre></div><h4 id="HTTPSè¯ä¹¦"><a href="#HTTPSè¯ä¹¦" class="headerlink" title="HTTPSè¯ä¹¦"></a>HTTPSè¯ä¹¦</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª https è¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥ä»å„ä¸ªäº‘æœåŠ¡å‚å•†å¤„ç”³è¯·ä¸€ä¸ªå…è´¹çš„ï¼Œä¸è¿‡è‡ªå·±åšå®éªŒæ²¡æœ‰å¿…è¦è¿™ä¹ˆéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å€ŸåŠ© Java è‡ªå¸¦çš„ JDK ç®¡ç†å·¥å…· keytool æ¥ç”Ÿæˆä¸€ä¸ªå…è´¹çš„ https è¯ä¹¦ã€‚</p><p>è¿›å…¥åˆ° <code>%JAVVA_HOME%\bin</code> ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªæ•°å­—è¯ä¹¦ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">keytool -genkey -alias tomcathttps -keyalg RSA -keysize 2048  -keystore lucifer.p12 -validity 365</code></pre></div><p>å‘½ä»¤å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>genkey è¡¨ç¤ºè¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ã€‚</li><li>alias è¡¨ç¤º keystore çš„åˆ«åã€‚</li><li>keyalg è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†ç®—æ³•æ˜¯ RSA ï¼Œä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</li><li>keysize è¡¨ç¤ºå¯†é’¥çš„é•¿åº¦ã€‚</li><li>keystore è¡¨ç¤ºç”Ÿæˆçš„å¯†é’¥å­˜æ”¾ä½ç½®ã€‚</li><li>validity è¡¨ç¤ºå¯†é’¥çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºå¤©ã€‚</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521155752252.png" alt="image-20210521155752252"></p><p>é…ç½®<code>application.properties</code></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">server.ssl.key-alias</span>=<span class="hljs-string">myhttps</span><span class="hljs-meta">server.ssl.key-store</span>=<span class="hljs-string">classpath:lucifer.p12</span><span class="hljs-meta">server.ssl.key-store-password</span>=<span class="hljs-string">123456</span></code></pre></div><p><strong>é…ç½®httpsè·³è½¬</strong></p><p>è€ƒè™‘åˆ° Spring Boot ä¸æ”¯æŒåŒæ—¶å¯åŠ¨ HTTP å’Œ HTTPS ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥é…ç½®ä¸€ä¸ªè¯·æ±‚è½¬å‘ï¼Œå½“ç”¨æˆ·å‘èµ· HTTP è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨è½¬å‘åˆ° HTTPS ä¸Š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TomcatConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">TomcatServletWebServerFactory <span class="hljs-title">tomcatServletWebServerFactory</span><span class="hljs-params">()</span> </span>&#123;        TomcatServletWebServerFactory factory = <span class="hljs-keyword">new</span> TomcatServletWebServerFactory()&#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessContext</span><span class="hljs-params">(Context context)</span> </span>&#123;                SecurityConstraint securityConstraint = <span class="hljs-keyword">new</span> SecurityConstraint();                securityConstraint.setUserConstraint(<span class="hljs-string">&quot;CONFIDENTIAL&quot;</span>);                SecurityCollection collection = <span class="hljs-keyword">new</span> SecurityCollection();                collection.addPattern(<span class="hljs-string">&quot;/*&quot;</span>);                securityConstraint.addCollection(collection);                context.addConstraint(securityConstraint);            &#125;        &#125;;        factory.addAdditionalTomcatConnectors(myConnectors());        <span class="hljs-keyword">return</span> factory;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> Connector <span class="hljs-title">myConnectors</span><span class="hljs-params">()</span> </span>&#123;        Connector connector = <span class="hljs-keyword">new</span> Connector(<span class="hljs-string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span>);        connector.setScheme(<span class="hljs-string">&quot;http&quot;</span>);        <span class="hljs-comment">//httpå’Œé»˜è®¤çš„8080ä¸èƒ½å ç”¨åŒä¸€ä¸ªç«¯å£</span>        connector.setPort(<span class="hljs-number">8081</span>);        connector.setSecure(<span class="hljs-keyword">false</span>);        connector.setRedirectPort(<span class="hljs-number">8080</span>);        <span class="hljs-keyword">return</span> connector;    &#125;&#125;</code></pre></div><h3 id="3-2-application-properties"><a href="#3-2-application-properties" class="headerlink" title="3.2 application.properties"></a>3.2 <strong>application.properties</strong></h3><p>é¦–å…ˆï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹æ—¶ï¼Œé»˜è®¤ resources ç›®å½•ä¸‹å°±æœ‰ä¸€ä¸ª application.properties æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ application.properties æ–‡ä»¶ä¸­è¿›è¡Œé¡¹ç›®é…ç½®ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶å¹¶éå”¯ä¸€çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ Spring Boot ä¸­ï¼Œä¸€å…±æœ‰ 4 ä¸ªåœ°æ–¹å¯ä»¥å­˜æ”¾ application.properties æ–‡ä»¶</p><ul><li>å½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ config ç›®å½•ä¸‹</li><li>å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹</li><li>resources ç›®å½•ä¸‹çš„ config ç›®å½•ä¸‹</li><li>resources ç›®å½•ä¸‹</li></ul><p>æŒ‰å¦‚ä¸Šé¡ºåºï¼Œå››ä¸ªé…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ä¾æ¬¡é™ä½ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/11-1.png" alt="img"></p><p>è¿™å››ä¸ªä½ç½®æ˜¯é»˜è®¤ä½ç½®ï¼Œå³ Spring Boot å¯åŠ¨ï¼Œé»˜è®¤ä¼šä»è¿™å››ä¸ªä½ç½®æŒ‰é¡ºåºå»æŸ¥æ‰¾ç›¸å…³å±æ€§å¹¶åŠ è½½ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½ç½®ã€‚</p><p>ä¾‹å¦‚ï¼Œç°åœ¨åœ¨ resources ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª javaboy ç›®å½•ï¼Œç›®å½•ä¸­å­˜æ”¾ä¸€ä¸ª application.properties æ–‡ä»¶ï¼Œé‚£ä¹ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ Spring Boot é¡¹ç›®æ—¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åŠ è½½çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ spring.config.location å±æ€§æ¥æ‰‹åŠ¨çš„æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®ï¼ŒæŒ‡å®šå®Œæˆåï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å»æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾ application.properties æ–‡ä»¶ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/11-2.png" alt="img"></p><p>æ­¤æ—¶å¯åŠ¨é¡¹ç›®ï¼Œå°±ä¼šå‘ç°ï¼Œé¡¹ç›®ä»¥ <code>classpath:/javaboy/application.propertie</code> é…ç½®æ–‡ä»¶å¯åŠ¨ã€‚</p><p>è¿™æ˜¯åœ¨å¼€å‘å·¥å…·ä¸­é…ç½®äº†å¯åŠ¨ä½ç½®ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ‰“åŒ…æˆ jar ï¼Œåœ¨å¯åŠ¨å‘½ä»¤ä¸­åŠ å…¥ä½ç½®å‚æ•°å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -jar properties-0.0.1-SNAPSHOT.jar --spring.config.location=classpath:/javaboy/</code></pre></div><h4 id="æ–‡ä»¶åé—®é¢˜"><a href="#æ–‡ä»¶åé—®é¢˜" class="headerlink" title="æ–‡ä»¶åé—®é¢˜"></a>æ–‡ä»¶åé—®é¢˜</h4><p>å¯¹äº application.properties è€Œè¨€ï¼Œå®ƒä¸ä¸€å®šéè¦å« application ï¼Œä½†æ˜¯é¡¹ç›®é»˜è®¤æ˜¯å»åŠ è½½åä¸º application çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¸å« application ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–‡ä»¶åã€‚</p><p>æ–¹å¼å’ŒæŒ‡å®šè·¯å¾„ä¸€è‡´ï¼Œåªä¸è¿‡æ­¤æ—¶çš„ key æ˜¯ spring.config.name ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åœ¨ resources ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª app.properties æ–‡ä»¶ï¼Œç„¶ååœ¨ IDEA ä¸­æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–‡ä»¶åï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/11-3.png" alt="img"></p><p>æŒ‡å®šå®Œé…ç½®æ–‡ä»¶åä¹‹åï¼Œå†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨å»é»˜è®¤çš„å››ä¸ªä½ç½®ä¸‹é¢åˆ†åˆ«æŸ¥æ‰¾åä¸º app.properties çš„é…ç½®æ–‡ä»¶ã€‚å½“ç„¶ï¼Œå…è®¸è‡ªå®šä¹‰æ–‡ä»¶åçš„é…ç½®æ–‡ä»¶ä¸æ”¾åœ¨å››ä¸ªé»˜è®¤ä½ç½®ï¼Œè€Œæ˜¯æ”¾åœ¨è‡ªå®šä¹‰ç›®å½•ä¸‹ï¼Œæ­¤æ—¶å°±éœ€è¦æ˜ç¡®æŒ‡å®š spring.config.location </p><p>é…ç½®æ–‡ä»¶ä½ç½®å’Œæ–‡ä»¶åç§°å¯ä»¥åŒæ—¶è‡ªå®šä¹‰ã€‚</p><h4 id="æ™®é€šçš„å±æ€§æ³¨å…¥"><a href="#æ™®é€šçš„å±æ€§æ³¨å…¥" class="headerlink" title="æ™®é€šçš„å±æ€§æ³¨å…¥"></a>æ™®é€šçš„å±æ€§æ³¨å…¥</h4><p>ç”±äº Spring Boot æºè‡ª Spring ï¼Œæ‰€ä»¥ Spring ä¸­å­˜åœ¨çš„å±æ€§æ³¨å…¥ï¼Œåœ¨ Spring Boot ä¸­ä¸€æ ·ä¹Ÿå­˜åœ¨ã€‚ç”±äº Spring Boot ä¸­ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨åŠ è½½ application.properties æ–‡ä»¶ï¼Œæ‰€ä»¥ç®€å•çš„å±æ€§æ³¨å…¥å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å†™ã€‚</p><p>ä¾‹å¦‚ï¼Œç°åœ¨å®šä¹‰ä¸€ä¸ª Book ç±»ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-comment">//çœç•¥ getter/setter</span>&#125;</code></pre></div><p>ç„¶åï¼Œåœ¨ application.properties æ–‡ä»¶ä¸­å®šä¹‰å±æ€§ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">book.name</span>=<span class="hljs-string">ä¸‰å›½æ¼”ä¹‰</span><span class="hljs-meta">book.author</span>=<span class="hljs-string">ç½—è´¯ä¸­</span><span class="hljs-meta">book.id</span>=<span class="hljs-string">1</span></code></pre></div><p>æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼ˆSpringä¸­çš„æ–¹å¼ï¼‰ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ @Value æ³¨è§£å°†è¿™äº›å±æ€§æ³¨å…¥åˆ° Book å¯¹è±¡ä¸­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-meta">@Value(&quot;$&#123;book.id&#125;&quot;)</span>    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-meta">@Value(&quot;$&#123;book.name&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Value(&quot;$&#123;book.author&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String author;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p><strong>æ³¨æ„</strong></p><p>Book å¯¹è±¡æœ¬èº«ä¹Ÿè¦äº¤ç»™ Spring å®¹å™¨å»ç®¡ç†ï¼Œå¦‚æœ Book æ²¡æœ‰äº¤ç»™ Spring å®¹å™¨ï¼Œé‚£ä¹ˆ Book ä¸­çš„å±æ€§ä¹Ÿæ— æ³•ä» Spring å®¹å™¨ä¸­è·å–åˆ°å€¼ã€‚</p><p>é…ç½®å®Œæˆåï¼Œåœ¨ Controller æˆ–è€…å•å…ƒæµ‹è¯•ä¸­æ³¨å…¥ Book å¯¹è±¡ï¼Œå¯åŠ¨é¡¹ç›®ï¼Œå°±å¯ä»¥çœ‹åˆ°å±æ€§å·²ç»æ³¨å…¥åˆ°å¯¹è±¡ä¸­äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ application.properties æ–‡ä»¶ä¸­ä¸»è¦å­˜æ”¾ç³»ç»Ÿé…ç½®ï¼Œè¿™ç§è‡ªå®šä¹‰é…ç½®ä¸å»ºè®®æ”¾åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰ properties æ–‡ä»¶æ¥å­˜åœ¨è‡ªå®šä¹‰é…ç½®ã€‚</p><p>ä¾‹å¦‚åœ¨ resources ç›®å½•ä¸‹ï¼Œè‡ªå®šä¹‰ book.properties æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">book.name</span>=<span class="hljs-string">ä¸‰å›½æ¼”ä¹‰</span><span class="hljs-meta">book.author</span>=<span class="hljs-string">ç½—è´¯ä¸­</span><span class="hljs-meta">book.id</span>=<span class="hljs-string">1</span></code></pre></div><p>æ­¤æ—¶ï¼Œé¡¹ç›®å¯åŠ¨å¹¶ä¸ä¼šè‡ªåŠ¨çš„åŠ è½½è¯¥é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ˜¯åœ¨ XML é…ç½®ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å¼•ç”¨è¯¥ properties æ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:book.properties&quot;</span>/&gt;</span></code></pre></div><p>å¦‚æœæ˜¯åœ¨ Java é…ç½®ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>@PropertySource</code>æ¥å¼•å…¥é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@PropertySource(&quot;classpath:book.properties&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-meta">@Value(&quot;$&#123;book.id&#125;&quot;)</span>    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-meta">@Value(&quot;$&#123;book.name&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Value(&quot;$&#123;book.author&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String author;    <span class="hljs-comment">//getter/setter</span>&#125;</code></pre></div><p>è¿™æ ·ï¼Œå½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åŠ è½½ book.properties æ–‡ä»¶ã€‚</p><p>è¿™åªæ˜¯ Spring ä¸­å±æ€§æ³¨å…¥çš„ä¸€ä¸ªç®€å•ç”¨æ³•ï¼Œå’Œ Spring Boot æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</p><h4 id="ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥"><a href="#ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥" class="headerlink" title="ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥"></a>ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥</h4><p>Spring Boot å¼•å…¥äº†ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥ï¼Œå¦‚æœé‡‡ç”¨ Spring ä¸­çš„é…ç½®æ–¹å¼ï¼Œå½“é…ç½®çš„å±æ€§éå¸¸å¤šçš„æ—¶å€™ï¼Œå·¥ä½œé‡å°±å¾ˆå¤§äº†ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚</p><p>ä½¿ç”¨ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@PropertySource(&quot;classpath:book.properties&quot;)</span><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;book&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p>è¿™é‡Œï¼Œä¸»è¦æ˜¯å¼•å…¥<code>@ConfigurationProperties(prefix = â€œbookâ€)</code>æ³¨è§£ï¼Œå¹¶ä¸”é…ç½®äº†å±æ€§çš„å‰ç¼€ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† Spring å®¹å™¨ä¸­å¯¹åº”çš„æ•°æ®æ³¨å…¥åˆ°å¯¹è±¡å¯¹åº”çš„å±æ€§ä¸­ï¼Œå°±ä¸ç”¨é€šè¿‡ <code>@Value</code> æ³¨è§£æŒ¨ä¸ªæ³¨å…¥äº†ï¼Œå‡å°‘å·¥ä½œé‡å¹¶ä¸”é¿å…å‡ºé”™</p><h4 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h4><p>åœ¨å®é™…å¼€å‘é…ç½®ä¸­ï¼Œè¦åˆ†ç¯å¢ƒå¼€å‘</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210521163450670.png" alt="image-20210521163450670"></p><p>é…ç½® application.properties é€‰æ‹©ç‰¹å®šçš„å¼€å‘ç«¯å£</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.profiles.active</span>=<span class="hljs-string">prod</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># application-prod.properties</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">8088</span><span class="hljs-comment"># application-dev.properties</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">8080</span><span class="hljs-comment"># application-test.properties</span><span class="hljs-meta">server.port</span>=<span class="hljs-string">8888</span></code></pre></div><h3 id="3-3-Yamlé…ç½®"><a href="#3-3-Yamlé…ç½®" class="headerlink" title="3.3 Yamlé…ç½®"></a>3.3 Yamlé…ç½®</h3><p>é¦–å…ˆapplication.yamlåœ¨Spring Bootä¸­å¯ä»¥å†™åœ¨å››ä¸ªä¸åŒçš„ä½ç½®ï¼Œåˆ†åˆ«æ˜¯å¦‚ä¸‹ä½ç½®ï¼š</p><ul><li>é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„configç›®å½•ä¸­</li><li>é¡¹ç›®æ ¹ç›®å½•ä¸‹</li><li>classpathä¸‹çš„configç›®å½•ä¸­</li><li>classpathç›®å½•ä¸‹</li></ul><p>å››ä¸ªä½ç½®ä¸­çš„application.yamlæ–‡ä»¶çš„ä¼˜å…ˆçº§æŒ‰ç…§ä¸Šé¢åˆ—å‡ºçš„é¡ºåºä¾æ¬¡é™ä½ã€‚å³å¦‚æœæœ‰åŒä¸€ä¸ªå±æ€§åœ¨å››ä¸ªæ–‡ä»¶ä¸­éƒ½å‡ºç°äº†ï¼Œä»¥ä¼˜å…ˆçº§é«˜çš„ä¸ºå‡†ã€‚</p><p>é‚£ä¹ˆapplication.yamlæ˜¯ä¸æ˜¯å¿…é¡»å«application.yamlè¿™ä¸ªåå­—å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯å¿…é¡»çš„ã€‚å¼€å‘è€…å¯ä»¥è‡ªå·±å®šä¹‰yamlåå­—ï¼Œè‡ªå·±å®šä¹‰çš„è¯ï¼Œéœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶æŒ‡å®šé…ç½®æ–‡ä»¶çš„åå­—ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/9-1.png" alt="img"></p><p>å½“ç„¶è¿™æ˜¯åœ¨IntelliJ IDEAä¸­ç›´æ¥é…ç½®çš„ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ‰“æˆjaråŒ…äº†ï¼Œåˆ™åœ¨é¡¹ç›®å¯åŠ¨æ—¶åŠ å…¥å¦‚ä¸‹å‚æ•°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -jar myproject.jar --spring.config.name=app</code></pre></div><p>è¿™æ ·é…ç½®ä¹‹åï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå°±ä¼šæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„å››ä¸ªä½ç½®æŒ‰é¡ºåºå»æŸ¥æ‰¾ä¸€ä¸ªåä¸ºapp.yamlçš„æ–‡ä»¶ã€‚å½“ç„¶è¿™å››ä¸ªä½ç½®ä¹Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨<code>spring.config.location</code>å±æ€§ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ä½¿ç”¨<code>spring.config.additional-location</code>è¿™ä¸ªå±æ€§ï¼Œåœ¨ç¬¬ä¸€ä¸ªå±æ€§ä¸­ï¼Œè¡¨ç¤ºè‡ªå·±é‡æ–°å®šä¹‰é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œé¡¹ç›®å¯åŠ¨æ—¶å°±æŒ‰ç…§å®šä¹‰çš„ä½ç½®å»æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œè¿™ç§å®šä¹‰æ–¹å¼ä¼šè¦†ç›–æ‰é»˜è®¤çš„å››ä¸ªä½ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œç¬¬äºŒç§æ–¹å¼åˆ™è¡¨ç¤ºåœ¨å››ä¸ªä½ç½®çš„åŸºç¡€ä¸Šï¼Œå†æ·»åŠ å‡ ä¸ªä½ç½®ï¼Œæ–°æ·»åŠ çš„ä½ç½®çš„ä¼˜å…ˆçº§å¤§äºåŸæœ¬çš„ä½ç½®ã€‚</p><p>é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/9-2.png" alt="img"></p><p>è¿™é‡Œè¦æ³¨æ„ï¼Œé…ç½®æ–‡ä»¶ä½ç½®æ—¶ï¼Œå€¼ä¸€å®šè¦ä»¥/ç»“å°¾ã€‚</p><h4 id="æ•°ç»„æ³¨å…¥"><a href="#æ•°ç»„æ³¨å…¥" class="headerlink" title="æ•°ç»„æ³¨å…¥"></a>æ•°ç»„æ³¨å…¥</h4><p>yamlä¹Ÿæ”¯æŒæ•°ç»„æ³¨å…¥ï¼Œä¾‹å¦‚</p><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">my:</span>  <span class="hljs-attr">servers:</span><span class="hljs-bullet">-</span> <span class="hljs-string">dev.example.com</span><span class="hljs-bullet">-</span> <span class="hljs-string">another.example.com</span></code></pre></div><p>è¿™æ®µæ•°æ®å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ªå¸¦Beançš„æ•°ç»„ä¸­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix=&quot;my&quot;)</span><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>&#123;<span class="hljs-keyword">private</span> List&lt;String&gt; servers = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getServers</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.servers;&#125;&#125;</code></pre></div><p>é¡¹ç›®å¯åŠ¨åï¼Œé…ç½®ä¸­çš„æ•°ç»„ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°serversé›†åˆä¸­ã€‚å½“ç„¶ï¼Œyamlä¸ä»…å¯ä»¥å­˜å‚¨è¿™ç§ç®€å•æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨é›†åˆä¸­å­˜å‚¨å¯¹è±¡ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ç§ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">redis:</span>  <span class="hljs-attr">redisConfigs:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.66</span><span class="hljs-number">.128</span>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.66</span><span class="hljs-number">.129</span>      <span class="hljs-attr">port:</span> <span class="hljs-number">6380</span></code></pre></div><p>è¿™ä¸ªå¯ä»¥è¢«æ³¨å…¥åˆ°å¦‚ä¸‹ç±»ä¸­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;redis&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisCluster</span> </span>&#123;    <span class="hljs-keyword">private</span> List&lt;SingleRedisConfig&gt; redisConfigs;<span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ä¸åŒäºpropertiesæ–‡ä»¶çš„æ— åºï¼Œyamlé…ç½®æ˜¯æœ‰åºçš„ï¼Œè¿™ä¸€ç‚¹åœ¨æœ‰äº›é…ç½®ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¾‹å¦‚åœ¨Spring Cloud Zuulçš„é…ç½®ä¸­ï¼Œå½“æˆ‘ä»¬é…ç½®ä»£ç†è§„åˆ™æ—¶ï¼Œé¡ºåºå°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚å½“ç„¶yamlé…ç½®ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä¾‹å¦‚ï¼Œyamlé…ç½®ç›®å‰ä¸æ”¯æŒ<code>@PropertySource</code>æ³¨è§£</p><h2 id="4-æ—¥å¿—è¯¦è§£"><a href="#4-æ—¥å¿—è¯¦è§£" class="headerlink" title="4. æ—¥å¿—è¯¦è§£"></a>4. æ—¥å¿—è¯¦è§£</h2><h3 id="1-Java-æ—¥å¿—æ¦‚è§ˆ"><a href="#1-Java-æ—¥å¿—æ¦‚è§ˆ" class="headerlink" title="1. Java æ—¥å¿—æ¦‚è§ˆ"></a>1. Java æ—¥å¿—æ¦‚è§ˆ</h3><p>è¯´åˆ° Java æ—¥å¿—ï¼Œå¾ˆå¤šåˆå­¦è€…å¯èƒ½éƒ½æ¯”è¾ƒæ‡µï¼Œå› ä¸ºè¿™é‡Œæ¶‰åŠåˆ°å¤ªå¤šä¸œè¥¿äº†ï¼š<code>Apache Commons Logging</code>ã€<code>Slf4j</code>ã€<code>Log4j</code>ã€<code>Log4j2</code>ã€<code>Logback</code>ã€<code>Java Util Logging</code> ç­‰ç­‰ï¼Œè¿™äº›æ¡†æ¶å„è‡ªæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><h4 id="1-1-æ€»ä½“æ¦‚è§ˆ"><a href="#1-1-æ€»ä½“æ¦‚è§ˆ" class="headerlink" title="1.1 æ€»ä½“æ¦‚è§ˆ"></a>1.1 æ€»ä½“æ¦‚è§ˆ</h4><p>ä¸‹é¢è¿™å¼ å›¾å¾ˆå¥½çš„å±•ç¤ºäº† Java ä¸­çš„æ—¥å¿—ä½“ç³»ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201213205509.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201213205509.png" alt="img"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒJava ä¸­çš„æ—¥å¿—æ¡†æ¶ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>æ—¥å¿—é—¨é¢</strong>å’Œ<strong>æ—¥å¿—å®ç°</strong>ã€‚</p><p><strong>æ—¥å¿—é—¨é¢</strong></p><p>æ—¥å¿—é—¨é¢å®šä¹‰äº†ä¸€ç»„æ—¥å¿—çš„æ¥å£è§„èŒƒï¼Œå®ƒå¹¶ä¸æä¾›åº•å±‚å…·ä½“çš„å®ç°é€»è¾‘ã€‚<code>Apache Commons Logging</code> å’Œ <code>Slf4j</code> å°±å±äºè¿™ä¸€ç±»ã€‚</p><p><strong>æ—¥å¿—å®ç°</strong></p><p>æ—¥å¿—å®ç°åˆ™æ˜¯æ—¥å¿—å…·ä½“çš„å®ç°ï¼ŒåŒ…æ‹¬æ—¥å¿—çº§åˆ«æ§åˆ¶ã€æ—¥å¿—æ‰“å°æ ¼å¼ã€æ—¥å¿—è¾“å‡ºå½¢å¼ï¼ˆè¾“å‡ºåˆ°æ•°æ®åº“ã€è¾“å‡ºåˆ°æ–‡ä»¶ã€è¾“å‡ºåˆ°æ§åˆ¶å°ç­‰ï¼‰ã€‚<code>Log4j</code>ã€<code>Log4j2</code>ã€<code>Logback</code> ä»¥åŠ <code>Java Util Logging</code> åˆ™å±äºè¿™ä¸€ç±»ã€‚</p><p>å°†æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°åˆ†ç¦»å…¶å®æ˜¯ä¸€ç§å…¸å‹çš„é—¨é¢æ¨¡å¼ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è®©å…·ä½“ä¸šåŠ¡åœ¨ä¸åŒçš„æ—¥å¿—å®ç°æ¡†æ¶ä¹‹é—´è‡ªç”±åˆ‡æ¢ï¼Œè€Œä¸éœ€è¦æ”¹åŠ¨ä»»ä½•ä»£ç ï¼Œå¼€å‘è€…åªéœ€è¦æŒæ¡æ—¥å¿—é—¨é¢çš„ API å³å¯ã€‚</p><p>æ—¥å¿—é—¨é¢æ˜¯ä¸èƒ½å•ç‹¬ä½¿ç”¨çš„ï¼Œå®ƒå¿…é¡»å’Œä¸€ç§å…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶ç›¸ç»“åˆä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆæ—¥å¿—æ¡†æ¶æ˜¯å¦å¯ä»¥å•ç‹¬ä½¿ç”¨å‘¢ï¼Ÿ</p><p>æŠ€æœ¯ä¸Šæ¥è¯´å½“ç„¶æ²¡é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šè¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·åšå¯ç»´æŠ¤æ€§å¾ˆå·®ï¼Œè€Œä¸”åæœŸæ‰©å±•ä¸æ˜“ã€‚ä¾‹å¦‚ A å¼€å‘äº†ä¸€ä¸ªå·¥å…·åŒ…ä½¿ç”¨ Log4j æ‰“å°æ—¥å¿—ï¼ŒB å¼•ç”¨äº†è¿™ä¸ªå·¥å…·åŒ…ï¼Œä½†æ˜¯ B å–œæ¬¢ä½¿ç”¨ Logback æ‰“å°æ—¥å¿—ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨ä¸¤ä¸ªç”šè‡³å¤šä¸ªæ—¥å¿—æ¡†æ¶ï¼Œå¼€å‘è€…ä¹Ÿéœ€è¦ç»´æŠ¤å¤šä¸ªæ—¥å¿—çš„é…ç½®æ–‡ä»¶ã€‚å› æ­¤æˆ‘ä»¬éƒ½æ˜¯ç”¨æ—¥å¿—é—¨é¢æ‰“å°æ—¥å¿—ã€‚</p><h4 id="1-2-æ—¥å¿—çº§åˆ«"><a href="#1-2-æ—¥å¿—çº§åˆ«" class="headerlink" title="1.2 æ—¥å¿—çº§åˆ«"></a>1.2 æ—¥å¿—çº§åˆ«</h4><p>ä½¿ç”¨æ—¥å¿—çº§åˆ«çš„å¥½å¤„åœ¨äºï¼Œè°ƒæ•´çº§åˆ«ï¼Œå°±å¯ä»¥å±è”½æ‰å¾ˆå¤šè°ƒè¯•ç›¸å…³çš„æ—¥å¿—è¾“å‡ºã€‚ä¸åŒçš„æ—¥å¿—å®ç°å®šä¹‰çš„æ—¥å¿—çº§åˆ«ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡ä¹Ÿéƒ½å¤§åŒå°å¼‚ã€‚</p><p><strong>Java Util Logging</strong></p><p><code>Java Util Logging</code> å®šä¹‰äº† 7 ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä»ä¸¥é‡åˆ°æ™®é€šä¾æ¬¡æ˜¯ï¼š</p><ul><li>SEVERE</li><li>WARNING</li><li>INFO</li><li>CONFIG</li><li>FINE</li><li>FINER</li><li>FINEST</li></ul><p>å› ä¸ºé»˜è®¤çº§åˆ«æ˜¯ INFOï¼Œå› æ­¤ INFO çº§åˆ«ä»¥ä¸‹çš„æ—¥å¿—ï¼Œä¸ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</p><p><strong>Log4j</strong></p><p><code>Log4j</code> å®šä¹‰äº† 8 ä¸ªæ—¥å¿—çº§åˆ«ï¼ˆé™¤å» OFF å’Œ ALLï¼Œå¯ä»¥è¯´åˆ†ä¸º 6 ä¸ªçº§åˆ«ï¼‰ï¼Œä»ä¸¥é‡åˆ°æ™®é€šä¾æ¬¡æ˜¯ï¼š</p><ul><li>OFFï¼šæœ€é«˜ç­‰çº§çš„ï¼Œç”¨äºå…³é—­æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚</li><li>FATALï¼šé‡å¤§é”™è¯¯ï¼Œè¿™ç§çº§åˆ«å¯ä»¥ç›´æ¥åœæ­¢ç¨‹åºäº†ã€‚</li><li>ERRORï¼šæ‰“å°é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚æœä¸æƒ³è¾“å‡ºå¤ªå¤šçš„æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªçº§åˆ«ã€‚</li><li>WARNï¼šè­¦å‘Šæç¤ºã€‚</li><li>INFOï¼šç”¨äºç”Ÿäº§ç¯å¢ƒä¸­è¾“å‡ºç¨‹åºè¿è¡Œçš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œä¸èƒ½æ»¥ç”¨ã€‚</li><li>DEBUGï¼šç”¨äºå¼€å‘è¿‡ç¨‹ä¸­æ‰“å°ä¸€äº›è¿è¡Œä¿¡æ¯ã€‚</li><li>TRACE</li><li>ALL æœ€ä½ç­‰çº§çš„ï¼Œç”¨äºæ‰“å¼€æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚</li></ul><p><strong>Logback</strong></p><p><code>Logback</code> æ—¥å¿—çº§åˆ«æ¯”è¾ƒç®€å•ï¼Œä»ä¸¥é‡åˆ°æ™®é€šä¾æ¬¡æ˜¯ï¼š</p><ul><li>ERROR</li><li>WARN</li><li>INFO</li><li>DEBUG</li><li>TRACE</li></ul><h4 id="1-3-ç»¼åˆå¯¹æ¯”"><a href="#1-3-ç»¼åˆå¯¹æ¯”" class="headerlink" title="1.3 ç»¼åˆå¯¹æ¯”"></a>1.3 ç»¼åˆå¯¹æ¯”</h4><p><code>Java Util Logging</code> ç³»ç»Ÿåœ¨ <code>JVM</code> å¯åŠ¨æ—¶è¯»å–é…ç½®æ–‡ä»¶å¹¶å®Œæˆåˆå§‹åŒ–ï¼Œä¸€æ—¦åº”ç”¨ç¨‹åºå¼€å§‹è¿è¡Œï¼Œå°±æ— æ³•ä¿®æ”¹é…ç½®ã€‚å¦å¤–ï¼Œè¿™ç§æ—¥å¿—å®ç°é…ç½®ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œåªèƒ½åœ¨ <code>JVM</code> å¯åŠ¨æ—¶ä¼ é€’å‚æ•°ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml">-Djava.util.logging.config.file=<span class="hljs-tag">&lt;<span class="hljs-name">config-file-name</span>&gt;</span>ã€‚</code></pre></div><p>ç”±äºè¿™äº›å±€é™æ€§ï¼Œå¯¼è‡´ <code>Java Util Logging</code> å¹¶æœªå¹¿æ³›ä½¿ç”¨ã€‚</p><p><code>Log4j</code> è™½ç„¶é…ç½®ç¹çï¼Œä½†æ˜¯ä¸€æ—¦é…ç½®å®Œæˆï¼Œä½¿ç”¨èµ·æ¥å°±éå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦å°†ç›¸å…³çš„é…ç½®æ–‡ä»¶æ”¾åˆ° <code>classpath</code> ä¸‹å³å¯ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œ<code>Log4j</code> çš„é…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„é¡¹ç›®ä¸­åå¤ä½¿ç”¨ã€‚</p><p><code>Log4j</code> å¯ä»¥å’Œ <code>Apache Commons Logging</code> æ­é…ä½¿ç”¨ï¼Œ<code>Apache Commons Logging</code> ä¼šè‡ªåŠ¨æœç´¢å¹¶ä½¿ç”¨ <code>Log4j</code>ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ° <code>Log4j</code>ï¼Œå†ä½¿ç”¨ <code>Java Util Logging</code>ã€‚</p><p>æ¯” <code>Log4j</code> + <code>Apache Commons Logging</code> ç»„åˆæ›´å¾—äººå¿ƒçš„æ˜¯ <code>Slf4j</code> + <code>Logback</code> ç»„åˆã€‚</p><p><code>Logback</code> æ˜¯ <code>Slf4j</code> çš„åŸç”Ÿå®ç°æ¡†æ¶ï¼Œå®ƒä¹Ÿå‡ºè‡ª <code>Log4j</code> ä½œè€…ï¼ˆCeki GÃ¼lcÃ¼ï¼‰ä¹‹æ‰‹ï¼Œä½†æ˜¯ç›¸æ¯” <code>Log4j</code>ï¼Œå®ƒæ‹¥æœ‰æ›´å¤šçš„ä¼˜ç‚¹ã€ç‰¹æ€§ä»¥åŠæ›´å¼ºçš„æ€§èƒ½ã€‚</p><h4 id="1-4-æœ€ä½³å®è·µ"><a href="#1-4-æœ€ä½³å®è·µ" class="headerlink" title="1.4 æœ€ä½³å®è·µ"></a>1.4 æœ€ä½³å®è·µ</h4><ul><li>å¦‚æœä¸æƒ³æ·»åŠ ä»»ä½•ä¾èµ–ï¼Œä½¿ç”¨ <code>Java Util Logging</code> æˆ–æ¡†æ¶å®¹å™¨å·²ç»æä¾›çš„æ—¥å¿—æ¥å£ã€‚</li><li>å¦‚æœæ¯”è¾ƒåœ¨æ„æ€§èƒ½ï¼Œæ¨èï¼š<code>Slf4j</code> + <code>Logback</code>ã€‚</li><li>å¦‚æœé¡¹ç›®ä¸­å·²ç»ä½¿ç”¨äº† <code>Log4j</code> ä¸”æ²¡æœ‰å‘ç°æ€§èƒ½é—®é¢˜ï¼Œæ¨èç»„åˆä¸ºï¼š<code>Slf4j</code> + <code>Log4j2</code>ã€‚</li></ul><h3 id="2-Spring-Boot-æ—¥å¿—å®ç°"><a href="#2-Spring-Boot-æ—¥å¿—å®ç°" class="headerlink" title="2. Spring Boot æ—¥å¿—å®ç°"></a>2. Spring Boot æ—¥å¿—å®ç°</h3><p>Spring Boot ä½¿ç”¨ <code>Apache Commons Logging</code> ä½œä¸ºå†…éƒ¨çš„æ—¥å¿—æ¡†æ¶é—¨é¢ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ—¥å¿—æ¥å£ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦ä¸ºè¯¥æ¥å£æ¥æŒ‡å®šç›¸åº”çš„æ—¥å¿—å®ç°ã€‚</p><p>Spring Boot é»˜è®¤çš„æ—¥å¿—å®ç°æ˜¯ <code>Logback</code>ã€‚è¿™ä¸ªå¾ˆå¥½æŸ¥çœ‹ï¼šéšä¾¿å¯åŠ¨ä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œä»æ§åˆ¶å°æ‰¾ä¸€è¡Œæ—¥å¿—ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201214092816.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201214092816.png" alt="img"></a></p><p>è€ƒè™‘åˆ°æœ€åçš„ prod æ˜¯ä¸€ä¸ªå¯ä»¥å˜åŒ–çš„å­—ç¬¦ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å…¨å±€æœç´¢ï¼š<code>The following profiles are active</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201214092956.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201214092956.png" alt="img"></a></p><p>åœ¨æ—¥å¿—è¾“å‡ºçš„é‚£ä¸€è¡Œ debugã€‚ç„¶åå†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201214093147.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201214093147.png" alt="img"></a></p><p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°çœŸæ­£çš„æ—¥å¿—å®ç°æ˜¯ <code>Logback</code>ã€‚</p><p>å…¶ä»–çš„è¯¸å¦‚ <code>Java Util Logging</code>ã€<code>Log4j</code> ç­‰æ¡†æ¶ï¼ŒSpring Boot ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p><p>åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œåªè¦æ·»åŠ äº†å¦‚ä¸‹ web ä¾èµ–ï¼Œæ—¥å¿—ä¾èµ–å°±è‡ªåŠ¨æ·»åŠ è¿›æ¥äº†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="2-1-Spring-Boot-æ—¥å¿—é…ç½®"><a href="#2-1-Spring-Boot-æ—¥å¿—é…ç½®" class="headerlink" title="2.1 Spring Boot æ—¥å¿—é…ç½®"></a>2.1 Spring Boot æ—¥å¿—é…ç½®</h4><p>Spring Boot çš„æ—¥å¿—ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ® classpath ä¸‹çš„å†…å®¹é€‰æ‹©åˆé€‚çš„æ—¥å¿—é…ç½®ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é¦–é€‰ Logbackã€‚</p><p>å¦‚æœå¼€å‘è€…éœ€è¦ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œåªéœ€è¦åœ¨ application.properties æ–‡ä»¶ä¸­é€šè¿‡ <code>logging.level å‰ç¼€+åŒ…å</code> çš„å½¢å¼è¿›è¡Œé…ç½®å³å¯ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.level.org.springframework.web</span>=<span class="hljs-string">debug</span><span class="hljs-meta">logging.level.org.hibernate</span>=<span class="hljs-string">error</span></code></pre></div><p>å¦‚æœä½ æƒ³å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®æŒ‡å®šæ—¥å¿—æ–‡ä»¶åï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.file.name</span>=<span class="hljs-string">javaboy.log</span></code></pre></div><p>logging.file.name å¯ä»¥åªæŒ‡å®šæ—¥å¿—æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å…¨è·¯å¾„ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.file.name</span>=<span class="hljs-string">/Users/sang/Documents/javaboy/javaboy.log</span></code></pre></div><p>å¦‚æœä½ åªæ˜¯æƒ³é‡æ–°å®šä¹‰è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>logging.file.path</code> å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.file.path</span>=<span class="hljs-string">/Users/sang/Documents/javaboy</span></code></pre></div><p>å¦‚æœæƒ³å¯¹è¾“å‡ºåˆ°æ–‡ä»¶ä¸­çš„æ—¥å¿—è¿›è¡Œç²¾ç»†åŒ–ç®¡ç†ï¼Œè¿˜æœ‰å¦‚ä¸‹ä¸€äº›å±æ€§å¯ä»¥é…ç½®ï¼š</p><ul><li>logging.logback.rollingpolicy.file-name-patternï¼šæ—¥å¿—å½’æ¡£çš„æ–‡ä»¶åï¼Œæ—¥å¿—æ–‡ä»¶è¾¾åˆ°ä¸€å®šå¤§å°ä¹‹åï¼Œè‡ªåŠ¨è¿›è¡Œå‹ç¼©å½’æ¡£ã€‚</li><li>logging.logback.rollingpolicy.clean-history-on-startï¼šæ˜¯å¦åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œå½’æ¡£ç®¡ç†ã€‚</li><li>logging.logback.rollingpolicy.max-file-sizeï¼šæ—¥å¿—æ–‡ä»¶å¤§å°ä¸Šé™ï¼Œè¾¾åˆ°è¯¥ä¸Šé™åï¼Œä¼šè‡ªåŠ¨å‹ç¼©ã€‚</li><li>logging.logback.rollingpolicy.total-size-capï¼šæ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œå¯ä»¥å®¹çº³çš„æœ€å¤§å¤§å°ã€‚</li><li>logging.logback.rollingpolicy.max-historyï¼šæ—¥å¿—æ–‡ä»¶ä¿å­˜çš„å¤©æ•°ã€‚</li></ul><p>æ—¥å¿—æ–‡ä»¶å½’æ¡£è¿™å—ï¼Œå°ä¼™ä¼´ä»¬æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±è¯•ä¸‹ï¼Œå¯ä»¥é¦–å…ˆå°† max-file-size å±æ€§è°ƒå°ï¼Œè¿™æ ·æ–¹ä¾¿çœ‹åˆ°æ•ˆæœï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.logback.rollingpolicy.max-file-size</span>=<span class="hljs-string">1MB</span></code></pre></div><p>ç„¶åæ·»åŠ å¦‚ä¸‹æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = getLogger(HelloController.class);    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;            logger.info(<span class="hljs-string">&quot;hello javaboy&quot;</span>);        &#125;    &#125;&#125;</code></pre></div><p>è®¿é—®è¯¥æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶è¢«è‡ªåŠ¨å‹ç¼©äº†ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201214115027.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201214115027.png" alt="img"></a></p><p>application.properties ä¸­è¿˜å¯ä»¥é…ç½®æ—¥å¿—åˆ†ç»„ã€‚</p><p>æ—¥å¿—åˆ†ç»„èƒ½å¤ŸæŠŠç›¸å…³çš„ logger æ”¾åˆ°ä¸€ä¸ªç»„ç»Ÿä¸€ç®¡ç†ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª tomcat ç»„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.group.tomcat</span>=<span class="hljs-string">org.apache.catalina,org.apache.coyote, org.apache.tomcat</span></code></pre></div><p>ç„¶åç»Ÿä¸€ç®¡ç† tomcat ç»„ä¸­çš„æ‰€æœ‰ loggerï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.level.tomcat</span>=<span class="hljs-string">TRACE</span></code></pre></div><p>Spring Boot ä¸­è¿˜é¢„å®šä¹‰äº†ä¸¤ä¸ªæ—¥å¿—åˆ†ç»„ web å’Œ sqlï¼Œå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201214124953.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201214124953.png" alt="img"></a></p><p>ä¸è¿‡åœ¨ application.properties ä¸­åªèƒ½å®ç°å¯¹æ—¥å¿—ä¸€äº›éå¸¸ç®€å•çš„é…ç½®ï¼Œå¦‚æœæƒ³å®ç°æ›´åŠ ç»†ç²’åº¦çš„æ—¥å¿—é…ç½®ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨æ—¥å¿—å®ç°çš„åŸç”Ÿé…ç½®ï¼Œä¾‹å¦‚ <code>Logback</code> çš„ <code>classpath:logback.xml</code>ï¼Œ<code>Log4j</code> çš„ <code>classpath:log4j.xml</code> ç­‰ã€‚å¦‚æœè¿™äº›æ—¥å¿—é…ç½®æ–‡ä»¶å­˜åœ¨äº classpath ä¸‹ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨åŠ è½½è¿™äº›é…ç½®æ–‡ä»¶ã€‚</p><h4 id="2-2-Logback-é…ç½®"><a href="#2-2-Logback-é…ç½®" class="headerlink" title="2.2 Logback é…ç½®"></a>2.2 Logback é…ç½®</h4><h5 id="2-2-1-åŸºæœ¬é…ç½®"><a href="#2-2-1-åŸºæœ¬é…ç½®" class="headerlink" title="2.2.1 åŸºæœ¬é…ç½®"></a>2.2.1 åŸºæœ¬é…ç½®</h5><p>é»˜è®¤çš„ <code>Logback</code> é…ç½®æ–‡ä»¶åæœ‰ä¸¤ç§ï¼š</p><ul><li><code>logback.xml</code>ï¼šè¿™ç§é…ç½®æ–‡ä»¶ä¼šç›´æ¥è¢«æ—¥å¿—æ¡†æ¶åŠ è½½ã€‚</li><li><code>logback-spring.xml</code>ï¼šè¿™ç§é…ç½®æ–‡ä»¶ä¸ä¼šè¢«æ—¥å¿—æ¡†æ¶ç›´æ¥åŠ è½½ï¼Œè€Œæ˜¯ç”± Spring Boot å»è§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ Spring Boot çš„é«˜çº§ Profile åŠŸèƒ½ã€‚</li></ul><p>Spring Boot ä¸­ä¸º <code>Logback</code> æä¾›äº†å››ä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œä½ç½®åœ¨ <code>org/springframework/boot/logging/logback/</code>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>defaults.xmlï¼šæä¾›äº†å…¬å…±çš„æ—¥å¿—é…ç½®ï¼Œæ—¥å¿—è¾“å‡ºè§„åˆ™ç­‰ã€‚</li><li>console-appender.xmlï¼šä½¿ç”¨ CONSOLE_LOG_PATTERN æ·»åŠ ä¸€ä¸ªConsoleAppenderã€‚</li><li>file-appender.xmlï¼šæ·»åŠ ä¸€ä¸ª RollingFileAppenderã€‚</li><li>base.xmlï¼šä¸ºäº†å…¼å®¹æ—§ç‰ˆ Spring Boot è€Œæä¾›çš„ã€‚</li></ul><p>å¦‚æœéœ€è¦è‡ªå®šä¹‰ <code>logback.xml</code> æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰æ—¶ä½¿ç”¨è¿™äº›é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ã€‚ä¸€ä¸ªå…¸å‹çš„ <code>logback.xml</code> æ–‡ä»¶å¦‚ä¸‹ï¼ˆresources/logback.xmlï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;org/springframework/boot/logging/logback/defaults.xml&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;org/springframework/boot/logging/logback/console-appender.xml&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.springframework.web&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><p>å¯ä»¥é€šè¿‡ include å¼•å…¥ Spring Boot å·²ç»æä¾›çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</p><h5 id="2-2-2-è¾“å‡ºåˆ°æ–‡ä»¶"><a href="#2-2-2-è¾“å‡ºåˆ°æ–‡ä»¶" class="headerlink" title="2.2.2 è¾“å‡ºåˆ°æ–‡ä»¶"></a>2.2.2 è¾“å‡ºåˆ°æ–‡ä»¶</h5><p>å¦‚æœæƒ³ç¦æ­¢æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡ºï¼Œè½¬è€Œå°†æ—¥å¿—å†…å®¹è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª <code>logback-spring.xml</code> æ–‡ä»¶ï¼Œå¹¶å¼•å…¥å‰é¢æ‰€è¯´çš„ <code>file-appender.xml</code> æ–‡ä»¶ã€‚</p><p>åƒä¸‹é¢è¿™æ ·ï¼ˆ<code>resources/logback-spring.xml</code>ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;org/springframework/boot/logging/logback/defaults.xml&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_FILE&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;LOG_FILE:-$&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-/tmp&#125;&#125;/&#125;spring.log&#125;&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;org/springframework/boot/logging/logback/file-appender.xml&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><h4 id="2-3-Log4j-é…ç½®"><a href="#2-3-Log4j-é…ç½®" class="headerlink" title="2.3 Log4j é…ç½®"></a>2.3 Log4j é…ç½®</h4><p>å¦‚æœ classpath ä¸‹å­˜åœ¨ <code>Log4j2</code> çš„ä¾èµ–ï¼ŒSpring Boot ä¼šè‡ªåŠ¨è¿›è¡Œé…ç½®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ classpath ä¸‹å½“ç„¶ä¸å­˜åœ¨ <code>Log4j2</code> çš„ä¾èµ–ï¼Œå¦‚æœæƒ³ä½¿ç”¨ <code>Log4j2</code>ï¼Œå¯ä»¥æ’é™¤å·²æœ‰çš„ <code>Logback</code>ï¼Œç„¶åå†å¼•å…¥ <code>Log4j2</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><code>Log4j2</code> çš„é…ç½®å°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œåœ¨ reources ç›®å½•ä¸‹æ–°å»º log4j2.xml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;warn&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;app_name&quot;</span>&gt;</span>logging<span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log_path&quot;</span>&gt;</span>logs/$&#123;app_name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">appenders</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Console&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d][%t][%p][%l] %m%n&quot;</span> /&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">console</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/info.log&quot;</span></span><span class="hljs-tag">                     <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/$$&#123;date:yyyy-MM&#125;/info-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Filters</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;WARN&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;DENY&quot;</span></span><span class="hljs-tag">                                 <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;NEUTRAL&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Filters</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d][%t][%p][%c:%L] %m%n&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">modulate</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;2 MB&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">compressionLevel</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/warn.log&quot;</span></span><span class="hljs-tag">                     <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/$$&#123;date:yyyy-MM&#125;/warn-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Filters</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;WARN&quot;</span> /&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;ERROR&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;DENY&quot;</span></span><span class="hljs-tag">                                 <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;NEUTRAL&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Filters</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d][%t][%p][%c:%L] %m%n&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">modulate</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;2 MB&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">compressionLevel</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/error.log&quot;</span></span><span class="hljs-tag">                     <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;log_path&#125;/$$&#123;date:yyyy-MM&#125;/error-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;ERROR&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d][%t][%p][%c:%L] %m%n&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">modulate</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;2 MB&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">compressionLevel</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">appenders</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">loggers</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span> /&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">loggers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><p>é¦–å…ˆåœ¨ properties èŠ‚ç‚¹ä¸­æŒ‡å®šäº†åº”ç”¨åç§°ä»¥åŠæ—¥å¿—æ–‡ä»¶ä½ç½®ã€‚</p><p>ç„¶åé€šè¿‡å‡ ä¸ªä¸åŒçš„ RollingFile å¯¹ä¸åŒçº§åˆ«çš„æ—¥å¿—åˆ†åˆ«å¤„ç†ï¼Œä¸åŒçº§åˆ«çš„æ—¥å¿—å°†è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§å„è‡ªçš„å‘½åæ–¹å¼è¿›è¡Œå‹ç¼©ã€‚</p><p>è¿™æ®µé…ç½®æ¯”è¾ƒç¨‹å¼åŒ–ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥ä¿å­˜ä¸‹æ¥åšæˆ IntelliJ IDEA æ¨¡ç‰ˆä»¥ä¾¿æ—¥å¸¸ä½¿ç”¨ã€‚</p><h1 id="SpringBootæ•´åˆè§†å›¾å±‚"><a href="#SpringBootæ•´åˆè§†å›¾å±‚" class="headerlink" title="SpringBootæ•´åˆè§†å›¾å±‚"></a>SpringBootæ•´åˆè§†å›¾å±‚</h1><h2 id="1-Thymeleaf"><a href="#1-Thymeleaf" class="headerlink" title="1. Thymeleaf"></a>1. Thymeleaf</h2><p>Thymeleaf æ˜¯æ–°ä¸€ä»£ Java æ¨¡æ¿å¼•æ“ï¼Œå®ƒç±»ä¼¼äº Velocityã€FreeMarker ç­‰ä¼ ç»Ÿ Java æ¨¡æ¿å¼•æ“ï¼Œä½†æ˜¯ä¸ä¼ ç»Ÿ Java æ¨¡æ¿å¼•æ“ä¸åŒçš„æ˜¯ï¼ŒThymeleaf æ”¯æŒ HTML åŸå‹ã€‚</p><p>å®ƒæ—¢å¯ä»¥è®©å‰ç«¯å·¥ç¨‹å¸ˆåœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ‰“å¼€æŸ¥çœ‹æ ·å¼ï¼Œä¹Ÿå¯ä»¥è®©åç«¯å·¥ç¨‹å¸ˆç»“åˆçœŸå®æ•°æ®æŸ¥çœ‹æ˜¾ç¤ºæ•ˆæœï¼ŒåŒæ—¶ï¼ŒSpringBoot æä¾›äº† Thymeleaf è‡ªåŠ¨åŒ–é…ç½®è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤åœ¨ SpringBoot ä¸­ä½¿ç”¨ Thymeleaf éå¸¸æ–¹ä¾¿ã€‚</p><p>äº‹å®ä¸Šï¼Œ Thymeleaf é™¤äº†å±•ç¤ºåŸºæœ¬çš„ HTML ï¼Œè¿›è¡Œé¡µé¢æ¸²æŸ“ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ª HTML ç‰‡æ®µè¿›è¡Œæ¸²æŸ“ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨åšé‚®ä»¶å‘é€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Thymeleaf ä½œä¸ºé‚®ä»¶å‘é€æ¨¡æ¿ã€‚</p><p>å¦å¤–ï¼Œç”±äº Thymeleaf æ¨¡æ¿åç¼€ä¸º <code>.html</code>ï¼Œå¯ä»¥ç›´æ¥è¢«æµè§ˆå™¨æ‰“å¼€ï¼Œå› æ­¤ï¼Œé¢„è§ˆæ—¶éå¸¸æ–¹ä¾¿ã€‚</p><h3 id="1-1-æ•´åˆ"><a href="#1-1-æ•´åˆ" class="headerlink" title="1.1 æ•´åˆ"></a>1.1 æ•´åˆ</h3><ul><li>åˆ›å»ºé¡¹ç›®</li></ul><p>Spring Boot ä¸­æ•´åˆ Thymeleaf éå¸¸å®¹æ˜“ï¼Œåªéœ€è¦åˆ›å»ºé¡¹ç›®æ—¶æ·»åŠ  Thymeleaf å³å¯ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/18-1.png" alt="img"></p><p>åˆ›å»ºå®Œæˆåï¼Œpom.xml ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å½“ç„¶ï¼ŒThymeleaf ä¸ä»…ä»…èƒ½åœ¨ Spring Boot ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨å…¶ä»–åœ°æ–¹ï¼Œåªä¸è¿‡ Spring Boot é’ˆå¯¹ Thymeleaf æä¾›äº†ä¸€æ•´å¥—çš„è‡ªåŠ¨åŒ–é…ç½®æ–¹æ¡ˆï¼Œè¿™ä¸€å¥—é…ç½®ç±»çš„å±æ€§åœ¨ <code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafProperties</code> ä¸­ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafProperties</span> </span>&#123;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_PREFIX = <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_SUFFIX = <span class="hljs-string">&quot;.html&quot;</span>;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> checkTemplate = <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> checkTemplateLocation = <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">private</span> String prefix = DEFAULT_PREFIX;        <span class="hljs-keyword">private</span> String suffix = DEFAULT_SUFFIX;        <span class="hljs-keyword">private</span> String mode = <span class="hljs-string">&quot;HTML&quot;</span>;        <span class="hljs-keyword">private</span> Charset encoding = DEFAULT_ENCODING;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> cache = <span class="hljs-keyword">true</span>;        <span class="hljs-comment">//...</span>&#125;</code></pre></div><ul><li>é¦–å…ˆé€šè¿‡ <code>@ConfigurationProperties</code> æ³¨è§£ï¼Œå°† <code>application.properties</code> å‰ç¼€ä¸º <code>spring.thymeleaf</code> çš„é…ç½®å’Œè¿™ä¸ªç±»ä¸­çš„å±æ€§ç»‘å®šã€‚</li><li>å‰ä¸‰ä¸ª <code>static</code> å˜é‡å®šä¹‰äº†é»˜è®¤çš„ç¼–ç æ ¼å¼ã€è§†å›¾è§£æå™¨çš„å‰ç¼€ã€åç¼€ç­‰ã€‚</li><li>ä»å‰ä¸‰è¡Œé…ç½®ä¸­ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>Thymeleaf</code> æ¨¡æ¿çš„é»˜è®¤ä½ç½®åœ¨ <code>resources/templates</code> ç›®å½•ä¸‹ï¼Œé»˜è®¤çš„åç¼€æ˜¯ <code>html</code>ã€‚</li><li>è¿™äº›é…ç½®ï¼Œå¦‚æœå¼€å‘è€…ä¸è‡ªå·±æä¾›ï¼Œåˆ™ä½¿ç”¨ é»˜è®¤çš„ï¼Œå¦‚æœè‡ªå·±æä¾›ï¼Œåˆ™åœ¨ <code>application.properties</code> ä¸­ä»¥ <code>spring.thymeleaf</code> å¼€å§‹ç›¸å…³çš„é…ç½®ã€‚</li></ul><p>è€Œæˆ‘ä»¬åˆšåˆšæåˆ°çš„ï¼ŒSpring Boot ä¸º Thymeleaf æä¾›çš„è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œåˆ™æ˜¯ <code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</code> ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span><span class="hljs-meta">@ConditionalOnClass(&#123; TemplateMode.class, SpringTemplateEngine.class &#125;)</span><span class="hljs-meta">@AutoConfigureAfter(&#123; WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafAutoConfiguration</span> </span>&#123;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»ä¸­ï¼Œé¦–å…ˆå¯¼å…¥ <code>ThymeleafProperties</code> ï¼Œç„¶å <code>@ConditionalOnClass</code> æ³¨è§£è¡¨ç¤ºå½“å½“å‰ç³»ç»Ÿä¸­å­˜åœ¨ <code>TemplateMode</code> å’Œ <code>SpringTemplateEngine</code> ç±»æ—¶ï¼Œå½“å‰çš„è‡ªåŠ¨åŒ–é…ç½®ç±»æ‰ä¼šç”Ÿæ•ˆï¼Œå³åªè¦é¡¹ç›®ä¸­å¼•å…¥äº† <code>Thymeleaf</code> ç›¸å…³çš„ä¾èµ–ï¼Œè¿™ä¸ªé…ç½®å°±ä¼šç”Ÿæ•ˆã€‚</p><p>è¿™äº›é»˜è®¤çš„é…ç½®æˆ‘ä»¬å‡ ä¹ä¸éœ€è¦åšä»»ä½•æ›´æ”¹å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚å¦‚æœå¼€å‘è€…æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œåˆ™å¯ä»¥åœ¨ application.properties ä¸­é…ç½®ä»¥ spring.thymeleaf å¼€å¤´çš„å±æ€§å³å¯ã€‚</p><ul><li><strong>åˆ›å»º Controller</strong></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ›å»º Controller äº†ï¼Œå®é™…ä¸Šå¼•å…¥ Thymeleaf ä¾èµ–ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¸åšä»»ä½•é…ç½®ã€‚æ–°å»ºçš„ IndexController å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/index&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">(Model model)</span> </span>&#123;        List&lt;User&gt; users = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            User u = <span class="hljs-keyword">new</span> User();            u.setId((<span class="hljs-keyword">long</span>) i);            u.setName(<span class="hljs-string">&quot;javaboy:&quot;</span> + i);            u.setAddress(<span class="hljs-string">&quot;æ·±åœ³:&quot;</span> + i);            users.add(u);        &#125;        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//çœç•¥ getter/setter</span>&#125;</code></pre></div><p>åœ¨ <code>IndexController</code> ä¸­è¿”å›é€»è¾‘è§†å›¾å+æ•°æ®ï¼Œé€»è¾‘è§†å›¾åä¸º <code>index</code> ï¼Œæ„æ€æˆ‘ä»¬éœ€è¦åœ¨ <code>resources/templates</code> ç›®å½•ä¸‹æä¾›ä¸€ä¸ªåä¸º <code>index.html</code> çš„ <code>Thymeleaf</code> æ¨¡æ¿æ–‡ä»¶ã€‚</p><ul><li><strong>åˆ›å»º Thymeleaf</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç¼–å·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åœ°å€<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user : $&#123;users&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>åœ¨ <code>Thymeleaf</code> ä¸­ï¼Œé€šè¿‡ <code>th:each</code> æŒ‡ä»¤æ¥éå†ä¸€ä¸ªé›†åˆï¼Œæ•°æ®çš„å±•ç¤ºé€šè¿‡ <code>th:text</code> æŒ‡ä»¤æ¥å®ç°ï¼Œ</p><p>æ³¨æ„ <code>index.html</code> æœ€ä¸Šé¢è¦å¼•å…¥ <code>thymeleaf</code> åç§°ç©ºé—´ã€‚</p><p>é…ç½®å®Œæˆåï¼Œå°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ï¼Œè®¿é—® /index æ¥å£ï¼Œå°±èƒ½çœ‹åˆ°é›†åˆä¸­çš„æ•°æ®äº†ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/18-2.png" alt="img"></p><p>å¦å¤–ï¼Œ<code>Thymeleaf</code> æ”¯æŒåœ¨ <code>js</code> ä¸­ç›´æ¥è·å– <code>Model</code> ä¸­çš„å˜é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>IndexController</code> ä¸­æœ‰ä¸€ä¸ªå˜é‡ <code>username</code> ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/index&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">(Model model)</span> </span>&#123;        model.addAttribute(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;æå››&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;    &#125;&#125;</code></pre></div><p>åœ¨é¡µé¢æ¨¡æ¿ä¸­ï¼Œå¯ä»¥ç›´æ¥åœ¨ js ä¸­è·å–åˆ°è¿™ä¸ªå˜é‡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs js">&lt;script th:inline=<span class="hljs-string">&quot;javascript&quot;</span>&gt;    <span class="hljs-keyword">var</span> username = [[$&#123;username&#125;]];    <span class="hljs-built_in">console</span>.log(username)&lt;/script&gt;</code></pre></div><p>è¿™ä¸ªåŠŸèƒ½ç®—æ˜¯ Thymeleaf çš„ç‰¹è‰²ä¹‹ä¸€å§ã€‚</p><h3 id="1-2-æ‰‹åŠ¨æ¸²æŸ“"><a href="#1-2-æ‰‹åŠ¨æ¸²æŸ“" class="headerlink" title="1.2 æ‰‹åŠ¨æ¸²æŸ“"></a>1.2 æ‰‹åŠ¨æ¸²æŸ“</h3><p>å‰é¢æˆ‘ä»¬è¯´çš„æ˜¯è¿”å›ä¸€ä¸ª Thymeleaf æ¨¡æ¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸²æŸ“ Thymeleaf æ¨¡æ¿ï¼Œè¿™ä¸ªä¸€èˆ¬åœ¨é‚®ä»¶å‘é€æ—¶å€™æœ‰ç”¨ï¼Œä¾‹å¦‚æˆ‘åœ¨ resources/templates ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªé‚®ä»¶æ¨¡æ¿ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello æ¬¢è¿ <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>åŠ å…¥ XXX é›†å›¢ï¼Œæ‚¨çš„å…¥èŒä¿¡æ¯å¦‚ä¸‹ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>èŒä½<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;position&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>è–ªæ°´<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;salary&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.javaboy.org/images/sb/javaboy.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>è¿™ä¸€ä¸ª HTML æ¨¡æ¿ä¸­ï¼Œæœ‰å‡ ä¸ªå˜é‡ï¼Œæˆ‘ä»¬è¦å°†è¿™ä¸ª HTML æ¨¡æ¿æ¸²æŸ“æˆä¸€ä¸ª String å­—ç¬¦ä¸²ï¼Œå†æŠŠè¿™ä¸ªå­—ç¬¦ä¸²é€šè¿‡é‚®ä»¶å‘é€å‡ºå»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰‹åŠ¨æ¸²æŸ“å‘¢ï¼Ÿ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>TemplateEngine templateEngine;<span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;    Context context = <span class="hljs-keyword">new</span> Context();    context.setVariable(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);    context.setVariable(<span class="hljs-string">&quot;position&quot;</span>, <span class="hljs-string">&quot;Javaå·¥ç¨‹å¸ˆ&quot;</span>);    context.setVariable(<span class="hljs-string">&quot;salary&quot;</span>, <span class="hljs-number">99999</span>);    String mail = templateEngine.process(<span class="hljs-string">&quot;mail&quot;</span>, context);    <span class="hljs-comment">//çœç•¥é‚®ä»¶å‘é€</span>&#125;</code></pre></div><ul><li>æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæ³¨å…¥ä¸€ä¸ª <code>TemplateEngine </code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯åœ¨ Thymeleaf çš„è‡ªåŠ¨åŒ–é…ç½®ç±»ä¸­é…ç½®çš„ï¼ˆå³å½“æˆ‘ä»¬å¼•å…¥ Thymeleaf çš„ä¾èµ–ä¹‹åï¼Œè¿™ä¸ªå®ä¾‹å°±æœ‰äº†ï¼‰ã€‚</li><li>ç„¶åæ„é€ ä¸€ä¸ª Context å¯¹è±¡ç”¨æ¥å­˜æ”¾å˜é‡ã€‚</li><li>è°ƒç”¨ process æ–¹æ³•è¿›è¡Œæ¸²æŸ“ï¼Œè¯¥æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯æ¸²æŸ“åçš„ HTML å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬å°†è¿™ä¸ªå­—ç¬¦ä¸²å‘é€å‡ºå»ã€‚</li></ul><p>è¿™æ˜¯ Spring Boot æ•´åˆ Thymeleaf çš„å‡ ä¸ªå…³é”®ç‚¹ï¼Œå…³äº Thymeleaf è¿™ä¸ªé¡µé¢æ¨¡æ¿æœ¬èº«æ›´å¤šçš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ Thymeleaf çš„æ–‡æ¡£ï¼š[<a href="https://www.thymeleaf.org]">https://www.thymeleaf.org]</a>(</p><h3 id="1-3-Thymeleaf-ç»†èŠ‚"><a href="#1-3-Thymeleaf-ç»†èŠ‚" class="headerlink" title="1.3 Thymeleaf ç»†èŠ‚"></a>1.3 Thymeleaf ç»†èŠ‚</h3><h4 id="1-3-1-æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"><a href="#1-3-1-æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="1.3.1 æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"></a>1.3.1 æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•</h4><h5 id="ç®€å•è¡¨è¾¾å¼"><a href="#ç®€å•è¡¨è¾¾å¼" class="headerlink" title="ç®€å•è¡¨è¾¾å¼"></a>ç®€å•è¡¨è¾¾å¼</h5><p><strong>${â€¦}</strong></p><p>ç›´æ¥ä½¿ç”¨ <code>th:xx = &quot;$&#123;&#125;&quot;</code> è·å–å¯¹è±¡å±æ€§ã€‚è¿™ä¸ªåœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­å·²ç»æ¼”ç¤ºè¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚</p><p><strong>*{â€¦}</strong></p><p>å¯ä»¥åƒ <code>$&#123;...&#125;</code> ä¸€æ ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>th:object</code> è·å–å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>th:xx = &quot;*&#123;&#125;&quot;</code> è·å–å¯¹è±¡å±æ€§ï¼Œè¿™ç§ç®€å†™é£æ ¼æä¸ºæ¸…çˆ½ï¼Œæ¨èå¤§å®¶åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">th:object</span>=<span class="hljs-string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*&#123;username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åœ°å€<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*&#123;address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p><strong>#{â€¦}</strong></p><p>é€šå¸¸çš„å›½é™…åŒ–å±æ€§ï¼š<code>#&#123;...&#125;</code> ç”¨äºè·å–å›½é™…åŒ–è¯­è¨€ç¿»è¯‘å€¼ã€‚</p><p>åœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼šmessages.properties å’Œ messages_zh_CN.propertiesï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><p>messages.propertiesï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">message</span> = <span class="hljs-string">javaboy</span></code></pre></div><p>messages_zh_CN.propertiesï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">message</span> = <span class="hljs-string">æ±Ÿå—ä¸€ç‚¹é›¨</span></code></pre></div><p>ç„¶ååœ¨ thymeleaf ä¸­å¼•ç”¨ messageï¼Œç³»ç»Ÿä¼šæ ¹æ®æµè§ˆå™¨çš„è¯­è¨€ç¯å¢ƒæ˜¾ç¤ºä¸åŒçš„å€¼ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;#&#123;message&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>@{â€¦}</strong></p><ul><li><strong>å¼•ç”¨ç»å¯¹ URLï¼š</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;http://localhost:8080/hello.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç­‰ä»·äºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:8080/hello.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><ul><li><strong>ä¸Šä¸‹æ–‡ç›¸å…³çš„ URLï¼š</strong></li></ul><p>é¦–å…ˆåœ¨ application.properties ä¸­é…ç½® Spring Boot çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿äºæµ‹è¯•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">server.servlet.context-path</span>=<span class="hljs-string">/myapp</span></code></pre></div><p>å¼•ç”¨è·¯å¾„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/hello.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç­‰ä»·äºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/myapp/hello.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><ul><li><strong>ç›¸å¯¹ URLï¼š</strong></li></ul><p>è¿™ä¸ªç›¸å¯¹æ˜¯æŒ‡ç›¸å¯¹äºæœåŠ¡å™¨çš„ URLï¼Œä¾‹å¦‚å¦‚ä¸‹å¼•ç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;~/hello.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç­‰ä»·äºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/hello.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ <strong>/myapp</strong> å°†è¢«å¿½ç•¥ã€‚</p><ul><li><strong>åè®®ç›¸å¯¹ URLï¼š</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;//localhost:8080/hello.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç­‰ä»·äºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//localhost:8080/hello.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><ul><li><strong>å¸¦å‚æ•°çš„ URLï¼š</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;//localhost:8080/hello.js(name=&#x27;javaboy&#x27;,age=99)&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç­‰ä»·äºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;//localhost:8080/hello.js?name=javaboy&amp;age=99&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p><strong>~{â€¦}</strong></p><p>ç‰‡æ®µè¡¨è¾¾å¼æ˜¯ Thymeleaf çš„ç‰¹è‰²ä¹‹ä¸€ï¼Œç»†ç²’åº¦å¯ä»¥è¾¾åˆ°æ ‡ç­¾çº§åˆ«ï¼Œè¿™æ˜¯ JSP æ— æ³•åšåˆ°çš„ã€‚ç‰‡æ®µè¡¨è¾¾å¼æ‹¥æœ‰ä¸‰ç§è¯­æ³•ï¼š</p><ul><li><code>~&#123; viewName &#125;</code>ï¼šè¡¨ç¤ºå¼•å…¥å®Œæ•´é¡µé¢</li><li><code>~&#123; viewName ::selector&#125;</code>ï¼šè¡¨ç¤ºåœ¨æŒ‡å®šé¡µé¢å¯»æ‰¾ç‰‡æ®µï¼Œå…¶ä¸­ selector å¯ä¸ºç‰‡æ®µåã€jqueryé€‰æ‹©å™¨ç­‰</li><li><code>~&#123; ::selector&#125;</code>ï¼š è¡¨ç¤ºåœ¨å½“å‰é¡µå¯»æ‰¾</li></ul><p>ä¸¾ä¸ªç®€å•ä¾‹å­ã€‚</p><p>åœ¨ resources/templates ç›®å½•ä¸‹æ–°å»º my_fragment.html æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;javaboy_link&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.javaboy.org&quot;</span>&gt;</span>www.javaboy<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;itboyhub_link&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.itboyhub.com&quot;</span>&gt;</span>www.itboyhub.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>è¿™é‡Œæœ‰ä¸¤ä¸ª divï¼Œé€šè¿‡ th:fragment æ¥å®šä¹‰ç‰‡æ®µï¼Œä¸¤ä¸ª div åˆ†åˆ«å…·æœ‰ä¸åŒçš„åå­—ã€‚</p><p>ç„¶ååœ¨å¦å¤–ä¸€ä¸ªé¡µé¢ä¸­å¼•ç”¨è¯¥ç‰‡æ®µï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">th:object</span>=<span class="hljs-string">&quot;$&#123;user&#125;&quot;</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">&quot;aaa&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*&#123;username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åœ°å€<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;*&#123;address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;my_fragment.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;~&#123;my_fragment.html::javaboy_link&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">&quot;~&#123;::aaa&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>é€šè¿‡ th:replace æ¥å¼•ç”¨ç‰‡æ®µã€‚ç¬¬ä¸€ä¸ªè¡¨ç¤ºå¼•ç”¨å®Œæ•´çš„ <code>my_fragment.html</code> é¡µé¢ï¼›ç¬¬äºŒä¸ªè¡¨ç¤ºå¼•ç”¨ <code>my_fragment.html</code> ä¸­çš„åä¸º <code>javaboy_link</code> çš„ç‰‡æ®µï¼›ç¬¬ä¸‰ä¸ªè¡¨ç¤ºå¼•ç”¨å½“å‰é¡µé¢åä¸º aaa çš„ç‰‡æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢é‚£ä¸ª tableã€‚</p><h5 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h5><p>è¿™äº›æ˜¯ä¸€äº›å¯ä»¥ç›´æ¥å†™åœ¨è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>æ–‡æœ¬å­—é¢é‡ï¼š â€˜one textâ€™, â€˜Another one!â€™,â€¦</li><li>æ•°å­—å­—é¢é‡ï¼š 0, 34, 3.0, 12.3,â€¦</li><li>å¸ƒå°”å­—é¢é‡ï¼š true, false</li><li>Nullå­—é¢é‡ï¼š null</li><li>å­—é¢é‡æ ‡è®°ï¼šone, sometext, main,â€¦</li></ul><p>æ¡ˆä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&#x27;è¿™æ˜¯ æ–‡æœ¬å­—é¢é‡(æœ‰ç©ºæ ¼)&#x27;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;javaboy&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;99&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å¦‚æœæ–‡æœ¬æ˜¯è‹±æ–‡ï¼Œå¹¶ä¸”ä¸åŒ…å«ç©ºæ ¼ã€é€—å·ç­‰å­—ç¬¦ï¼Œå¯ä»¥ä¸ç”¨åŠ å•å¼•å·ã€‚</p><h5 id="æ–‡æœ¬è¿ç®—"><a href="#æ–‡æœ¬è¿ç®—" class="headerlink" title="æ–‡æœ¬è¿ç®—"></a>æ–‡æœ¬è¿ç®—</h5><p>æ–‡æœ¬å¯ä»¥ä½¿ç”¨ <code>+</code> è¿›è¡Œæ‹¼æ¥ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&#x27;hello &#x27;+&#x27;javaboy&#x27;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&#x27;hello &#x27;+$&#123;user.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦ä¸€ç§ç®€å•çš„æ–¹å¼ï¼Œå«åšå­—é¢é‡ç½®æ¢ï¼Œç”¨ <code>|</code> ä»£æ›¿ <code>&#39;...&#39; + &#39;...&#39;</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;|hello $&#123;user.username&#125;|&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&#x27;hello &#x27;+$&#123;user.username&#125;+&#x27; &#x27;+|Go $&#123;user.address&#125;|&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="ç®—æœ¯è¿ç®—"><a href="#ç®—æœ¯è¿ç®—" class="headerlink" title="ç®—æœ¯è¿ç®—"></a>ç®—æœ¯è¿ç®—</h5><p>ç®—æœ¯è¿ç®—æœ‰ï¼š<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> å’Œ <code>%</code>ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:with</span>=<span class="hljs-string">&quot;age=(99*99/99+99-1)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>th:with å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ ageï¼Œåœ¨å…¶æ‰€åœ¨çš„ div ä¸­å¯ä»¥ä½¿ç”¨è¯¥å±€éƒ¨å˜é‡</p><h5 id="å¸ƒå°”è¿ç®—"><a href="#å¸ƒå°”è¿ç®—" class="headerlink" title="å¸ƒå°”è¿ç®—"></a>å¸ƒå°”è¿ç®—</h5><ul><li>äºŒå…ƒè¿ç®—ç¬¦ï¼šand, or</li><li>å¸ƒå°”éï¼ˆä¸€å…ƒè¿ç®—ç¬¦ï¼‰ï¼š!, not</li></ul><p>æ¡ˆä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:with</span>=<span class="hljs-string">&quot;age=(99*99/99+99-1)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;9 eq 9 or 8 ne 8&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;!(9 eq 9 or 8 ne 8)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;not(9 eq 9 or 8 ne 8)&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="æ¯”è¾ƒå’Œç›¸ç­‰"><a href="#æ¯”è¾ƒå’Œç›¸ç­‰" class="headerlink" title="æ¯”è¾ƒå’Œç›¸ç­‰"></a>æ¯”è¾ƒå’Œç›¸ç­‰</h5><p>è¡¨è¾¾å¼é‡Œçš„å€¼å¯ä»¥ä½¿ç”¨ <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code> å’Œ <code>&lt;=</code> ç¬¦å·æ¯”è¾ƒã€‚<code>==</code> å’Œ <code>!=</code> è¿ç®—ç¬¦ç”¨äºæ£€æŸ¥ç›¸ç­‰ï¼ˆæˆ–è€…ä¸ç›¸ç­‰ï¼‰ã€‚æ³¨æ„ <code>XML</code>è§„å®š <code>&lt;</code> å’Œ <code>&gt;</code> æ ‡ç­¾ä¸èƒ½ç”¨äºå±æ€§å€¼ï¼Œæ‰€ä»¥åº”å½“æŠŠå®ƒä»¬è½¬ä¹‰ä¸º <code>&lt;</code> å’Œ <code>&gt;</code>ã€‚</p><p>å¦‚æœä¸æƒ³è½¬ä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åï¼š<code>gt (&gt;)ï¼›lt (&lt;)ï¼›ge (&gt;=)ï¼›le (&lt;=)ï¼›not (!)</code>è¿˜æœ‰<code> eq (==), neq/ne (!=)</code></p><p>ä¸¾ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:with</span>=<span class="hljs-string">&quot;age=(99*99/99+99-1)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; eq 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; ne 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; ge 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; gt 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; le 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;age&#125; lt 197&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="æ¡ä»¶è¿ç®—ç¬¦"><a href="#æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="æ¡ä»¶è¿ç®—ç¬¦"></a>æ¡ä»¶è¿ç®—ç¬¦</h5><p>ç±»ä¼¼äºæˆ‘ä»¬ Java ä¸­çš„ä¸‰ç›®è¿ç®—ç¬¦ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:with</span>=<span class="hljs-string">&quot;age=(99*99/99+99-1)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;($&#123;age&#125; ne 197)?&#x27;yes&#x27;:&#x27;no&#x27;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å…¶ä¸­ï¼Œ: åé¢çš„éƒ¨åˆ†å¯ä»¥çœç•¥ï¼Œå¦‚æœçœç•¥äº†ï¼ŒåˆåŒæ—¶è®¡ç®—ç»“æœä¸º false æ—¶ï¼Œå°†è¿”å› nullã€‚</p><h5 id="å†…ç½®å¯¹è±¡"><a href="#å†…ç½®å¯¹è±¡" class="headerlink" title="å†…ç½®å¯¹è±¡"></a>å†…ç½®å¯¹è±¡</h5><p>åŸºæœ¬å†…ç½®å¯¹è±¡ï¼š</p><ul><li>#ctxï¼šä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</li><li>#vars: ä¸Šä¸‹æ–‡å˜é‡ã€‚</li><li>#localeï¼šä¸Šä¸‹æ–‡åŒºåŸŸè®¾ç½®ã€‚</li><li>#requestï¼šï¼ˆä»…åœ¨ Web ä¸Šä¸‹æ–‡ä¸­ï¼‰HttpServletRequest å¯¹è±¡ã€‚</li><li>#responseï¼šï¼ˆä»…åœ¨ Web ä¸Šä¸‹æ–‡ä¸­ï¼‰HttpServletResponse å¯¹è±¡ã€‚</li><li>#sessionï¼šï¼ˆä»…åœ¨ Web ä¸Šä¸‹æ–‡ä¸­ï¼‰HttpSession å¯¹è±¡ã€‚</li><li>#servletContextï¼šï¼ˆä»…åœ¨ Web ä¸Šä¸‹æ–‡ä¸­ï¼‰ServletContext å¯¹è±¡ã€‚</li></ul><p>åœ¨é¡µé¢å¯ä»¥è®¿é—®åˆ°ä¸Šé¢è¿™äº›å†…ç½®å¯¹è±¡ï¼Œä¸¾ä¸ªç®€å•ä¾‹å­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&#x27;$&#123;#session.getAttribute(&quot;name&quot;)&#125;&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å®ç”¨å†…ç½®å¯¹è±¡ï¼š</p><ul><li>#execInfoï¼šæœ‰å…³æ­£åœ¨å¤„ç†çš„æ¨¡æ¿çš„ä¿¡æ¯ã€‚</li><li>#messagesï¼šåœ¨å˜é‡è¡¨è¾¾å¼ä¸­è·å–å¤–éƒ¨åŒ–æ¶ˆæ¯çš„æ–¹æ³•ï¼Œä¸ä½¿ç”¨ï¼ƒ{â€¦}è¯­æ³•è·å¾—çš„æ–¹å¼ç›¸åŒã€‚</li><li>#urisï¼šè½¬ä¹‰URL / URIéƒ¨åˆ†çš„æ–¹æ³•</li><li>#conversionsï¼šæ‰§è¡Œé…ç½®çš„è½¬æ¢æœåŠ¡ï¼ˆå¦‚æœæœ‰ï¼‰çš„æ–¹æ³•ã€‚</li><li>#datesï¼šjava.util.Dateå¯¹è±¡çš„æ–¹æ³•ï¼šæ ¼å¼åŒ–ï¼Œç»„ä»¶æå–ç­‰</li><li>#calendarsï¼šç±»ä¼¼äº#datesä½†æ˜¯java.util.Calendarå¯¹è±¡ã€‚</li><li>#numbersï¼šç”¨äºæ ¼å¼åŒ–æ•°å­—å¯¹è±¡çš„æ–¹æ³•ã€‚</li><li>#stringsï¼šStringå¯¹è±¡çš„æ–¹æ³•ï¼šcontainsï¼ŒstartsWithï¼Œprepending / appendingç­‰</li><li>#objectsï¼šä¸€èˆ¬å¯¹è±¡çš„æ–¹æ³•ã€‚</li><li>#boolsï¼šå¸ƒå°”è¯„ä¼°çš„æ–¹æ³•ã€‚</li><li>#arraysï¼šæ•°ç»„æ–¹æ³•ã€‚</li><li>#listsï¼šåˆ—è¡¨çš„æ–¹æ³•ã€‚</li><li>#setsï¼šé›†åˆçš„æ–¹æ³•ã€‚</li><li>#mapsï¼šåœ°å›¾æ–¹æ³•ã€‚</li><li>#aggregatesï¼šåœ¨æ•°ç»„æˆ–é›†åˆä¸Šåˆ›å»ºèšåˆçš„æ–¹æ³•ã€‚</li><li>#idsï¼šå¤„ç†å¯èƒ½é‡å¤çš„idå±æ€§çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºè¿­ä»£çš„ç»“æœï¼‰ã€‚</li></ul><p>è¿™æ˜¯ä¸€äº›å†…ç½®å¯¹è±¡ä»¥åŠå·¥å…·æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿéƒ½æ¯”è¾ƒå®¹æ˜“ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ IntelliJ IDEAï¼Œéƒ½ä¼šè‡ªåŠ¨æç¤ºå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;#execInfo.getProcessedTemplateName()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;#arrays.length(#request.getAttribute(&#x27;names&#x27;))&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h4 id="1-3-2-è®¾ç½®å±æ€§å€¼"><a href="#1-3-2-è®¾ç½®å±æ€§å€¼" class="headerlink" title="1.3.2 è®¾ç½®å±æ€§å€¼"></a>1.3.2 è®¾ç½®å±æ€§å€¼</h4><p>è¿™ä¸ªæ˜¯ç»™ HTML å…ƒç´ è®¾ç½®å±æ€§å€¼ã€‚å¯ä»¥ä¸€æ¬¡è®¾ç½®å¤šä¸ªï¼Œå¤šä¸ªä¹‹é—´ç”¨ <code>,</code> åˆ†éš”å¼€ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">&quot;src=@&#123;/1.png&#125;,title=$&#123;user.username&#125;,alt=$&#123;user.username&#125;&quot;</span>&gt;</span></code></pre></div><p>ä¼šè¢«æ¸²æŸ“æˆï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/myapp/1.png&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;javaboy&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;javaboy&quot;</span>&gt;</span></code></pre></div><p>å½“ç„¶è¿™ç§è®¾ç½®æ–¹æ³•ä¸å¤ªç¾è§‚ï¼Œå¯è¯»æ€§ä¹Ÿä¸å¥½ã€‚Thymeleaf è¿˜æ”¯æŒåœ¨æ¯ä¸€ä¸ªåŸç”Ÿçš„ HTML å±æ€§å‰åŠ ä¸Š th: å‰ç¼€çš„æ–¹å¼æ¥ä½¿ç”¨åŠ¨æ€å€¼ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/1.png&#125;&quot;</span> <span class="hljs-attr">th:alt</span>=<span class="hljs-string">&quot;$&#123;user.username&#125;&quot;</span> <span class="hljs-attr">th:title</span>=<span class="hljs-string">&quot;$&#123;user.username&#125;&quot;</span>&gt;</span></code></pre></div><p>è¿™ç§å†™æ³•çœ‹èµ·æ¥æ›´æ¸…æ™°ä¸€äº›ï¼Œæ¸²æŸ“æ•ˆæœå’Œå‰é¢ä¸€è‡´ã€‚</p><p>ä¸Šé¢æ¡ˆä¾‹ä¸­çš„ alt å’Œ title åˆ™æ˜¯ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è®¾ç½®ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/1.png&#125;&quot;</span> <span class="hljs-attr">th:alt-title</span>=<span class="hljs-string">&quot;$&#123;user.username&#125;&quot;</span>&gt;</span></code></pre></div><p>è¿™ä¸ªç­‰ä»·äºå‰æ–‡çš„è®¾ç½®ã€‚</p><h4 id="1-3-3-éå†"><a href="#1-3-3-éå†" class="headerlink" title="1.3.3 éå†"></a>1.3.3 éå†</h4><p>æ•°ç»„/é›†åˆ/Map/Enumeration/Iterator ç­‰çš„éå†ä¹Ÿç®—æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ï¼ŒThymeleaf ä¸­é€šè¿‡ th:each æ¥å®ç°éå†ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;u : $&#123;users&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p>users æ˜¯è¦éå†çš„é›†åˆ/æ•°ç»„ï¼Œu åˆ™æ˜¯é›†åˆä¸­çš„å•ä¸ªå…ƒç´ ã€‚</p><p>éå†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è·å–éå†çš„çŠ¶æ€ï¼ŒThymeleaf ä¹Ÿå¯¹æ­¤æä¾›äº†æ”¯æŒï¼š</p><ul><li>indexï¼šå½“å‰çš„éå†ç´¢å¼•ï¼Œä»0å¼€å§‹ã€‚</li><li>countï¼šå½“å‰çš„éå†ç´¢å¼•ï¼Œä»1å¼€å§‹ã€‚</li><li>sizeï¼šè¢«éå†å˜é‡é‡Œçš„å…ƒç´ æ•°é‡ã€‚</li><li>currentï¼šæ¯æ¬¡éå†çš„éå†å˜é‡ã€‚</li><li>even/oddï¼šå½“å‰çš„éå†æ˜¯å¶æ•°æ¬¡è¿˜æ˜¯å¥‡æ•°æ¬¡ã€‚</li><li>firstï¼šå½“å‰æ˜¯å¦ä¸ºé¦–æ¬¡éå†ã€‚</li><li>lastï¼šå½“å‰æ˜¯å¦ä¸ºæœ€åä¸€æ¬¡éå†ã€‚</li></ul><p>u åé¢çš„ state è¡¨ç¤ºéå†çŠ¶æ€ï¼Œé€šè¿‡éå†çŠ¶æ€å¯ä»¥å¼•ç”¨ä¸Šé¢çš„å±æ€§ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;u,state : $&#123;users&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.index&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.count&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.size&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.current&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.even&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.first&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.last&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><h4 id="1-3-4-åˆ†æ”¯è¯­å¥"><a href="#1-3-4-åˆ†æ”¯è¯­å¥" class="headerlink" title="1.3.4 åˆ†æ”¯è¯­å¥"></a>1.3.4 åˆ†æ”¯è¯­å¥</h4><p>åªæ˜¾ç¤ºå¥‡æ•°æ¬¡çš„éå†ï¼Œå¯ä»¥ä½¿ç”¨ th:ifï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;u,state : $&#123;users&#125;&quot;</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.index&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.count&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.size&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.current&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.even&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.first&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.last&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p>th:if ä¸ä»…ä»…åªæ¥å—å¸ƒå°”å€¼ï¼Œä¹Ÿæ¥å—å…¶ä»–ç±»å‹çš„å€¼ï¼Œä¾‹å¦‚å¦‚ä¸‹å€¼éƒ½ä¼šåˆ¤å®šä¸º trueï¼š</p><ul><li>å¦‚æœå€¼æ˜¯å¸ƒå°”å€¼ï¼Œå¹¶ä¸”ä¸º trueã€‚</li><li>å¦‚æœå€¼æ˜¯æ•°å­—ï¼Œå¹¶ä¸”ä¸ä¸º 0ã€‚</li><li>å¦‚æœå€¼æ˜¯å­—ç¬¦ï¼Œå¹¶ä¸”ä¸ä¸º 0ã€‚</li><li>å¦‚æœå€¼æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸ä¸º â€œfalseâ€ï¼Œ â€œoffâ€ æˆ–è€… â€œnoâ€ã€‚</li><li>å¦‚æœå€¼ä¸æ˜¯å¸ƒå°”å€¼ï¼Œæ•°å­—ï¼Œå­—ç¬¦æˆ–è€…å­—ç¬¦ä¸²ã€‚</li></ul><p>ä½†æ˜¯å¦‚æœå€¼ä¸º nullï¼Œth:if ä¼šæ±‚å€¼ä¸º falseã€‚</p><p>th:unless çš„åˆ¤å®šæ¡ä»¶åˆ™ä¸ th:if å®Œå…¨ç›¸åã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;u,state : $&#123;users&#125;&quot;</span> <span class="hljs-attr">th:unless</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.index&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.count&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.size&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.current&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.even&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.first&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.last&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p>è¿™ä¸ªæ˜¾ç¤ºæ•ˆæœåˆ™ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åã€‚</p><p>å½“å¯èƒ½æ€§æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ switchï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;u,state : $&#123;users&#125;&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.username&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;u.address&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.index&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.count&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.size&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.current&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.even&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.first&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;state.last&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:switch</span>=<span class="hljs-string">&quot;$&#123;state.odd&#125;&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>odd<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span>even<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p><code>th:case=&quot;*&quot;</code> åˆ™è¡¨ç¤ºé»˜è®¤é€‰é¡¹ã€‚</p><h4 id="1-3-5-æœ¬åœ°å˜é‡"><a href="#1-3-5-æœ¬åœ°å˜é‡" class="headerlink" title="1.3.5 æœ¬åœ°å˜é‡"></a>1.3.5 æœ¬åœ°å˜é‡</h4><p>è¿™ä¸ªæˆ‘ä»¬å‰é¢å·²ç»æ¶‰åŠåˆ°äº†ï¼Œä½¿ç”¨ th:with å¯ä»¥å®šä¹‰ä¸€ä¸ªæœ¬åœ°å˜é‡ã€‚</p><h4 id="1-3-6-å†…è”"><a href="#1-3-6-å†…è”" class="headerlink" title="1.3.6 å†…è”"></a>1.3.6 å†…è”</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å±æ€§å°†æ•°æ®æ”¾å…¥é¡µé¢æ¨¡ç‰ˆä¸­ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œå†…è”çš„æ–¹å¼çœ‹èµ·æ¥æ›´åŠ ç›´è§‚ä¸€äº›ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>hello [[$&#123;user.username&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>ç”¨å†…è”çš„æ–¹å¼å»åšæ‹¼æ¥ä¹Ÿæ˜¾å¾—æ›´åŠ è‡ªç„¶ã€‚</p><p><code>[[...]]</code> å¯¹åº”äº th:text ï¼ˆç»“æœä¼šæ˜¯è½¬ä¹‰çš„ HTMLï¼‰ï¼Œ<code>[(...)]</code>å¯¹åº”äº th:utextï¼Œå®ƒä¸ä¼šæ‰§è¡Œä»»ä½•çš„ HTML è½¬ä¹‰ã€‚</p><p>åƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:with</span>=<span class="hljs-string">&quot;str=&#x27;hello &lt;strong&gt;javaboy&lt;/strong&gt;&#x27;&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>[[$&#123;str&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>[($&#123;str&#125;)]<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>æœ€ç»ˆçš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201215210604.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201215210604.png" alt="img"></a></p><p>ä¸è¿‡å†…è”æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨ Thymeleaf çš„ä¸€å¤§ä¼˜åŠ¿åœ¨äºä¸ç”¨åŠ¨æ€æ¸²æŸ“å°±å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°æ˜¾ç¤ºæ•ˆæœï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å±æ€§é…ç½®çš„æ—¶å€™ç¡®å®æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨å†…è”çš„æ–¹å¼ï¼Œå„ç§è¡¨è¾¾å¼å°±ä¼šç›´æ¥å±•ç¤ºåœ¨é™æ€ç½‘é¡µä¸­ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨ js æˆ–è€… css ä¸­ä½¿ç”¨å†…è”ï¼Œä»¥ js ä¸ºä¾‹ï¼Œjs ä¸­éœ€è¦é€šè¿‡ <code>th:inline=&quot;javascript&quot;</code> å¼€å¯å†…è”</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:inline</span>=<span class="hljs-string">&quot;javascript&quot;</span>&gt;</span><span class="javascript">    <span class="hljs-keyword">var</span> username=[[$&#123;user.username&#125;]]</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(username)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>å¤§å®¶åœ¨ç½‘ä¸Šå¯èƒ½éƒ½çœ‹åˆ°è¿‡ä¸€äº›ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¾ˆé…·ï¼MyBatisã€Serviceã€Controllerã€Model å…¨éƒ¨éƒ½å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚</p><p>è¿™äº›å·¥å…·çš„å®ç°å…¶å®éå¸¸ Easyï¼Œåªè¦ç†Ÿæ‚‰ JDBC API å’Œä»»æ„ä¸€ç§é¡µé¢æ¨¡ç‰ˆå°±å¯ä»¥å®ç°ã€‚ä»Šå¤©æ¾å“¥å°±å°è¯•ä½¿ç”¨ Freemarker åšä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œå¸¦å¤§å®¶æ­å¼€ä»£ç ç”Ÿæˆå·¥å…·çš„ç¥ç§˜é¢çº±ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Spring Boot æ•´åˆ Freemarkerï¼Œç„¶åå†æ¥çœ‹çœ‹å¦‚ä½•å®ç°è‡ªåŠ¨ç”Ÿæˆä»£ç ã€‚</p><h2 id="2-Freemarker"><a href="#2-Freemarker" class="headerlink" title="2. Freemarker"></a>2. Freemarker</h2><p>è¿™æ˜¯ä¸€ä¸ªç›¸å½“è€ç‰Œçš„å¼€æºçš„å…è´¹çš„æ¨¡ç‰ˆå¼•æ“ï¼ŒåŸºäºApacheè®¸å¯è¯2.0ç‰ˆæœ¬å‘å¸ƒã€‚</p><p>é€šè¿‡ Freemarker æ¨¡ç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®æ¸²æŸ“æˆ HTML ç½‘é¡µã€ç”µå­é‚®ä»¶ã€é…ç½®æ–‡ä»¶ä»¥åŠæºä»£ç ç­‰ã€‚Freemarker ä¸æ˜¯é¢å‘æœ€ç»ˆç”¨æˆ·çš„ï¼Œè€Œæ˜¯ä¸€ä¸ª Java ç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ç»„ä»¶åµŒå…¥åˆ°æˆ‘ä»¬çš„äº§å“ä¸­ã€‚</p><p>æ¥çœ‹ä¸€å¼ æ¥è‡ª Freemarker å®˜ç½‘çš„å›¾ç‰‡ï¼š</p><p><a href="http://img.itboyhub.com/2020/10-1.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/10-1-20210521175030210.png" alt="img"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒFreemarker å¯ä»¥å°†æ¨¡ç‰ˆå’Œæ•°æ®æ¸²æŸ“æˆ HTML ã€‚</p><p>Freemarker æ¨¡ç‰ˆåç¼€ä¸º <code>.ftlh</code>(FreeMarker Template Language)ã€‚FTL æ˜¯ä¸€ç§ç®€å•çš„ã€ä¸“ç”¨çš„è¯­è¨€ï¼Œå®ƒä¸æ˜¯åƒ Java é‚£æ ·æˆç†Ÿçš„ç¼–ç¨‹è¯­è¨€ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œä½ å¯ä»¥ä¸“æ³¨äºå¦‚ä½•å±•ç°æ•°æ®ï¼Œ è€Œåœ¨æ¨¡æ¿ä¹‹å¤–å¯ä»¥ä¸“æ³¨äºè¦å±•ç¤ºä»€ä¹ˆæ•°æ®ã€‚</p><h3 id="2-1-æ•´åˆ-Spring-Boot"><a href="#2-1-æ•´åˆ-Spring-Boot" class="headerlink" title="2.1  æ•´åˆ Spring Boot"></a>2.1  æ•´åˆ Spring Boot</h3><p>åœ¨ SSM ä¸­æ•´åˆ Freemarker ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶åŠ èµ·æ¥ï¼Œå‰å‰ååå¤§çº¦åœ¨ 50 è¡Œå·¦å³ï¼ŒSpring Boot ä¸­è¦å‡ è¡Œé…ç½®å‘¢ï¼Ÿ 0 è¡Œï¼</p><h4 id="2-1-1-åˆ›å»ºå·¥ç¨‹"><a href="#2-1-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="2.1.1 åˆ›å»ºå·¥ç¨‹"></a>2.1.1 åˆ›å»ºå·¥ç¨‹</h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹ï¼Œå¼•å…¥ Freemarker ä¾èµ–ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217125112.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217125112.png" alt="img"></a></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å·¥ç¨‹åˆ›å»ºå®Œæˆåï¼Œåœ¨ <code>org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration</code> ç±»ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…³äº Freemarker çš„è‡ªåŠ¨åŒ–é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><span class="hljs-meta">@ConditionalOnClass(&#123; freemarker.template.Configuration.class, FreeMarkerConfigurationFactory.class &#125;)</span><span class="hljs-meta">@EnableConfigurationProperties(FreeMarkerProperties.class)</span><span class="hljs-meta">@Import(&#123; FreeMarkerServletWebConfiguration.class, FreeMarkerReactiveWebConfiguration.class,</span><span class="hljs-meta">FreeMarkerNonWebConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreeMarkerAutoConfiguration</span> </span>&#123;&#125;</code></pre></div><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå½“ <code>classpath</code> ä¸‹å­˜åœ¨ <code>freemarker.template.Configuration</code> ä»¥åŠ <code>FreeMarkerConfigurationFactory</code> æ—¶ï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬å¼•å…¥äº† <code>Freemarker</code> ä¹‹åï¼Œé…ç½®å°±ä¼šç”Ÿæ•ˆã€‚ä½†æ˜¯è¿™é‡Œçš„è‡ªåŠ¨åŒ–é…ç½®åªåšäº†æ¨¡æ¿ä½ç½®æ£€æŸ¥ï¼Œå…¶ä»–é…ç½®åˆ™æ˜¯åœ¨å¯¼å…¥çš„ <code>FreeMarkerServletWebConfiguration</code> é…ç½®ä¸­å®Œæˆçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹ <code>FreeMarkerServletWebConfiguration</code> ç±»ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><span class="hljs-meta">@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)</span><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, FreeMarkerConfigurer.class &#125;)</span><span class="hljs-meta">@AutoConfigureAfter(WebMvcAutoConfiguration.class)</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreeMarkerServletWebConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractFreeMarkerConfiguration</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">FreeMarkerServletWebConfiguration</span><span class="hljs-params">(FreeMarkerProperties properties)</span> </span>&#123;<span class="hljs-keyword">super</span>(properties);&#125;<span class="hljs-meta">@Bean</span><span class="hljs-meta">@ConditionalOnMissingBean(FreeMarkerConfig.class)</span><span class="hljs-function">FreeMarkerConfigurer <span class="hljs-title">freeMarkerConfigurer</span><span class="hljs-params">()</span> </span>&#123;FreeMarkerConfigurer configurer = <span class="hljs-keyword">new</span> FreeMarkerConfigurer();applyProperties(configurer);<span class="hljs-keyword">return</span> configurer;&#125;<span class="hljs-meta">@Bean</span>freemarker.template.<span class="hljs-function">Configuration <span class="hljs-title">freeMarkerConfiguration</span><span class="hljs-params">(FreeMarkerConfig configurer)</span> </span>&#123;<span class="hljs-keyword">return</span> configurer.getConfiguration();&#125;<span class="hljs-meta">@Bean</span><span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;freeMarkerViewResolver&quot;)</span><span class="hljs-meta">@ConditionalOnProperty(name = &quot;spring.freemarker.enabled&quot;, matchIfMissing = true)</span><span class="hljs-function">FreeMarkerViewResolver <span class="hljs-title">freeMarkerViewResolver</span><span class="hljs-params">()</span> </span>&#123;FreeMarkerViewResolver resolver = <span class="hljs-keyword">new</span> FreeMarkerViewResolver();getProperties().applyToMvcViewResolver(resolver);<span class="hljs-keyword">return</span> resolver;&#125;<span class="hljs-meta">@Bean</span><span class="hljs-meta">@ConditionalOnEnabledResourceChain</span><span class="hljs-meta">@ConditionalOnMissingFilterBean(ResourceUrlEncodingFilter.class)</span><span class="hljs-function">FilterRegistrationBean&lt;ResourceUrlEncodingFilter&gt; <span class="hljs-title">resourceUrlEncodingFilter</span><span class="hljs-params">()</span> </span>&#123;FilterRegistrationBean&lt;ResourceUrlEncodingFilter&gt; registration = <span class="hljs-keyword">new</span> FilterRegistrationBean&lt;&gt;(<span class="hljs-keyword">new</span> ResourceUrlEncodingFilter());registration.setDispatcherTypes(DispatcherType.REQUEST, DispatcherType.ERROR);<span class="hljs-keyword">return</span> registration;&#125;&#125;</code></pre></div><p>æˆ‘ä»¬æ¥ç®€å•çœ‹ä¸‹è¿™æ®µæºç ï¼š</p><ul><li>@ConditionalOnWebApplication è¡¨ç¤ºå½“å‰é…ç½®åœ¨ web ç¯å¢ƒä¸‹æ‰ä¼šç”Ÿæ•ˆã€‚</li><li>ConditionalOnClass è¡¨ç¤ºå½“å‰é…ç½®åœ¨å­˜åœ¨ Servlet å’Œ FreeMarkerConfigurer æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</li><li>@AutoConfigureAfter è¡¨ç¤ºå½“å‰è‡ªåŠ¨åŒ–é…ç½®åœ¨ WebMvcAutoConfiguration ä¹‹åå®Œæˆã€‚</li><li>ä»£ç ä¸­ï¼Œä¸»è¦æä¾›äº† FreeMarkerConfigurer å’Œ FreeMarkerViewResolverã€‚</li><li>FreeMarkerConfigurer æ˜¯ Freemarker çš„ä¸€äº›åŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚ templateLoaderPathã€defaultEncoding ç­‰</li><li>FreeMarkerViewResolver åˆ™æ˜¯è§†å›¾è§£æå™¨çš„åŸºæœ¬é…ç½®ï¼ŒåŒ…å«äº†viewClassã€suffixã€allowRequestOverrideã€allowSessionOverride ç­‰å±æ€§ã€‚</li></ul><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹ï¼Œåœ¨è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œæ³¨å…¥äº† FreeMarkerPropertiesï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.freemarker&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreeMarkerProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractTemplateViewResolverProperties</span> </span>&#123;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_TEMPLATE_LOADER_PATH = <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_PREFIX = <span class="hljs-string">&quot;&quot;</span>;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_SUFFIX = <span class="hljs-string">&quot;.ftlh&quot;</span>;        <span class="hljs-comment">/**</span><span class="hljs-comment">         * Well-known FreeMarker keys which are passed to FreeMarker&#x27;s Configuration.</span><span class="hljs-comment">         */</span>        <span class="hljs-keyword">private</span> Map&lt;String, String&gt; settings = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();&#125;</code></pre></div><p>FreeMarkerProperties ä¸­åˆ™é…ç½®äº† Freemarker çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚æ¨¡æ¿ä½ç½®åœ¨ <code>classpath:/templates/</code> ï¼Œå†ä¾‹å¦‚æ¨¡æ¿åç¼€ä¸º <code>.ftlh</code>ï¼Œé‚£ä¹ˆè¿™äº›é…ç½®æˆ‘ä»¬ä»¥åéƒ½å¯ä»¥åœ¨ application.properties ä¸­è¿›è¡Œä¿®æ”¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ SSM çš„ XML æ–‡ä»¶ä¸­è‡ªå·±é…ç½® Freemarker ï¼Œä¹Ÿä¸è¿‡å°±æ˜¯é…ç½®è¿™äº›ä¸œè¥¿ã€‚ç°åœ¨ï¼Œè¿™äº›é…ç½®ç”± FreeMarkerServletWebConfiguration å¸®æˆ‘ä»¬å®Œæˆäº†ã€‚</p><h4 id="2-1-2-åˆ›å»ºç±»"><a href="#2-1-2-åˆ›å»ºç±»" class="headerlink" title="2.1.2 åˆ›å»ºç±»"></a>2.1.2 åˆ›å»ºç±»</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª User ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//çœç•¥ getter/setter</span>&#125;</code></pre></div><p>å†æ¥åˆ›å»º <code>UserController</code>ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/index&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">(Model model)</span> </span>&#123;        List&lt;User&gt; users = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            User user = <span class="hljs-keyword">new</span> User();            user.setId((<span class="hljs-keyword">long</span>) i);            user.setUsername(<span class="hljs-string">&quot;javaboy&gt;&gt;&gt;&gt;&quot;</span> + i);            user.setAddress(<span class="hljs-string">&quot;www.javaboy.org&gt;&gt;&gt;&gt;&quot;</span> + i);            users.add(user);        &#125;        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;    &#125;&#125;</code></pre></div><p>æœ€ååœ¨ freemarker ä¸­æ¸²æŸ“æ•°æ®ï¼Œåˆ›å»º<code>index.ftlh</code></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·ç¼–å·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·åç§°<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·åœ°å€<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    &lt;#list users as user&gt;        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;user.id&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;user.username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;user.address&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    &lt;/#list&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/10-3.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/10-3.png" alt="img"></a></p><h4 id="2-1-3-å…¶ä»–é…ç½®"><a href="#2-1-3-å…¶ä»–é…ç½®" class="headerlink" title="2.1.3 å…¶ä»–é…ç½®"></a>2.1.3 å…¶ä»–é…ç½®</h4><p>å¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹æ¨¡ç‰ˆæ–‡ä»¶ä½ç½®ç­‰ï¼Œå¯ä»¥åœ¨ application.properties ä¸­è¿›è¡Œé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.freemarker.allow-request-override</span>=<span class="hljs-string">false</span><span class="hljs-meta">spring.freemarker.allow-session-override</span>=<span class="hljs-string">false</span><span class="hljs-meta">spring.freemarker.cache</span>=<span class="hljs-string">false</span><span class="hljs-meta">spring.freemarker.charset</span>=<span class="hljs-string">UTF-8</span><span class="hljs-meta">spring.freemarker.check-template-location</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.freemarker.content-type</span>=<span class="hljs-string">text/html</span><span class="hljs-meta">spring.freemarker.expose-request-attributes</span>=<span class="hljs-string">false</span><span class="hljs-meta">spring.freemarker.expose-session-attributes</span>=<span class="hljs-string">false</span><span class="hljs-meta">spring.freemarker.suffix</span>=<span class="hljs-string">.ftl</span><span class="hljs-meta">spring.freemarker.template-loader-path</span>=<span class="hljs-string">classpath:/templates/</span></code></pre></div><p>é…ç½®æ–‡ä»¶æŒ‰ç…§é¡ºåºä¾æ¬¡è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>HttpServletRequestçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerä¸­modelçš„åŒåé¡¹</li><li>HttpSessionçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerä¸­modelçš„åŒåé¡¹</li><li>æ˜¯å¦å¼€å¯ç¼“å­˜</li><li>æ¨¡æ¿æ–‡ä»¶ç¼–ç </li><li>æ˜¯å¦æ£€æŸ¥æ¨¡æ¿ä½ç½®</li><li>Content-Typeçš„å€¼</li><li>æ˜¯å¦å°†HttpServletRequestä¸­çš„å±æ€§æ·»åŠ åˆ°Modelä¸­</li><li>æ˜¯å¦å°†HttpSessionä¸­çš„å±æ€§æ·»åŠ åˆ°Modelä¸­</li><li>æ¨¡æ¿æ–‡ä»¶åç¼€</li><li>æ¨¡æ¿æ–‡ä»¶ä½ç½®</li></ul><p>å¥½äº†ï¼Œæ•´åˆå®Œæˆä¹‹åï¼ŒFreemarker çš„æ›´å¤šç”¨æ³•ï¼Œå°±å’Œåœ¨ SSM ä¸­ä½¿ç”¨ Freemarker ä¸€æ ·äº†</p><h3 id="2-2-Freemarker-ä½¿ç”¨ç»†èŠ‚"><a href="#2-2-Freemarker-ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="2.2 Freemarker ä½¿ç”¨ç»†èŠ‚"></a>2.2 Freemarker ä½¿ç”¨ç»†èŠ‚</h3><h4 id="2-2-1-æ’å€¼ä¸è¡¨è¾¾å¼"><a href="#2-2-1-æ’å€¼ä¸è¡¨è¾¾å¼" class="headerlink" title="2.2.1 æ’å€¼ä¸è¡¨è¾¾å¼"></a>2.2.1 æ’å€¼ä¸è¡¨è¾¾å¼</h4><h5 id="ç›´æ¥è¾“å‡ºå€¼"><a href="#ç›´æ¥è¾“å‡ºå€¼" class="headerlink" title="ç›´æ¥è¾“å‡ºå€¼"></a>ç›´æ¥è¾“å‡ºå€¼</h5><p><strong>å­—ç¬¦ä¸²</strong></p><p>å¯ä»¥ç›´æ¥è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;helloï¼Œæˆ‘æ˜¯ç›´æ¥è¾“å‡ºçš„å­—ç¬¦ä¸²&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;æˆ‘çš„æ–‡ä»¶ä¿å­˜åœ¨C:\\ç›˜&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>\ éœ€è¦è¿›è¡Œè½¬ä¹‰ã€‚</p><p>å¦‚æœæ„Ÿè§‰è½¬ä¹‰å¤ªéº»çƒ¦ï¼Œå¯ä»¥åœ¨ç›®æ ‡å­—ç¬¦ä¸²çš„å¼•å·å‰å¢åŠ  r æ ‡è®°,åœ¨ r æ ‡è®°åçš„æ–‡æœ¬å†…å®¹å°†ä¼šç›´æ¥è¾“å‡ºï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;r&quot;æˆ‘çš„æ–‡ä»¶ä¿å­˜åœ¨C:\ç›˜&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>æ•°å­—</strong></p><p>åœ¨ FreeMarker ä¸­ä½¿ç”¨æ•°å€¼éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p><ol><li>æ•°å€¼ä¸èƒ½çœç•¥å°æ•°ç‚¹å‰é¢çš„0ï¼Œæ‰€ä»¥â€.5â€æ˜¯é”™è¯¯çš„å†™æ³•ã€‚</li><li>æ•°å€¼ 8 , +8 , 8.00 éƒ½æ˜¯ç›¸åŒçš„ã€‚</li></ol><p>æ•°å­—è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç©æ³•ï¼š</p><ul><li>å°†æ•°å­—ä»¥é’±çš„å½¢å¼å±•ç¤ºï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#assign num=99&gt;<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;num?string.currency&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><code>&lt;#assign num=99&gt;</code> è¡¨ç¤ºå®šä¹‰äº†ä¸€ä¸ªå˜é‡ numï¼Œå€¼ä¸º 99ã€‚æœ€ç»ˆçš„å±•ç¤ºå½¢å¼æ˜¯åœ¨æ•°å­—å‰é¢å‡ºç°äº†ä¸€ä¸ªäººæ°‘å¸ç¬¦å·ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217155655.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217155655.png" alt="img"></a></p><ul><li>å°†æ•°å­—ä»¥ç™¾åˆ†æ•°çš„å½¢å¼å±•ç¤ºï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;num?string.percent&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217160444.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217160444.png" alt="img"></a></p><p><strong>å¸ƒå°”</strong></p><p>å¸ƒå°”ç±»å‹å¯ä»¥ç›´æ¥å®šä¹‰ï¼Œä¸éœ€è¦å¼•å·ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#assign flag=true&gt;<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;flag?string(&quot;a&quot;,&quot;b&quot;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>é¦–å…ˆä½¿ç”¨ <code>&lt;#assign flag=true&gt;</code> å®šä¹‰äº†ä¸€ä¸ª Boolean ç±»å‹çš„å˜é‡ï¼Œç„¶ååœ¨ div ä¸­å±•ç¤ºï¼Œå¦‚æœ flag ä¸º trueï¼Œåˆ™è¾“å‡º aï¼Œå¦åˆ™è¾“å‡º bã€‚</p><p><strong>é›†åˆ</strong></p><p>é›†åˆä¹Ÿå¯ä»¥ç°åœºå®šä¹‰ç°åœºè¾“å‡ºï¼Œä¾‹å¦‚å¦‚ä¸‹æ–¹å¼å®šä¹‰ä¸€ä¸ª List é›†åˆå¹¶æ˜¾ç¤ºå‡ºæ¥ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#list [&quot;æ˜ŸæœŸä¸€&quot;, &quot;æ˜ŸæœŸäºŒ&quot;, &quot;æ˜ŸæœŸä¸‰&quot;, &quot;æ˜ŸæœŸå››&quot;, &quot;æ˜ŸæœŸäº”&quot;, &quot;æ˜ŸæœŸå…­&quot;, &quot;æ˜ŸæœŸå¤©&quot;] as x&gt;    $&#123;x&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&lt;/#list&gt;</code></pre></div><p>x ä»£è¡¨é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæœ€ç»ˆæ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217161426.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217161426.png" alt="img"></a></p><p>é›†åˆä¸­çš„å…ƒç´ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#list [2+2,&quot;javaboy&quot;] as x&gt;    $&#123;x&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&lt;/#list&gt;</code></pre></div><p>é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯ 2+2 çš„ç»“æœï¼Œå³ 4ã€‚</p><p>ä¹Ÿå¯ä»¥ç”¨ <code>1..5</code> è¡¨ç¤º 1 åˆ° 5ï¼Œ<code>5..1</code> è¡¨ç¤º 5 åˆ° 1ï¼Œä¾‹å¦‚ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#list 5..1 as x&gt;    $&#123;x&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&lt;/#list&gt;&lt;#list 1..5 as x&gt;    $&#123;x&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&lt;/#list&gt;</code></pre></div><p>ä¹Ÿå¯ä»¥å®šä¹‰ Map é›†åˆï¼ŒMap é›†åˆç”¨ä¸€ä¸ª <code>&#123;&#125;</code> æ¥æè¿°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#list &#123;&quot;name&quot;:&quot;javaboy&quot;,&quot;address&quot;:&quot;www.javaboy.org&quot;&#125;?keys as x&gt;$&#123;x&#125;&lt;/#list&gt;&lt;#list &#123;&quot;name&quot;:&quot;javaboy&quot;,&quot;address&quot;:&quot;www.javaboy.org&quot;&#125;?values as x&gt;$&#123;x&#125;&lt;/#list&gt;</code></pre></div><p>ä¸Šé¢ä¸¤ä¸ªå¾ªç¯åˆ†åˆ«è¡¨ç¤ºéå† Map ä¸­çš„ key å’Œ valuesã€‚</p><h5 id="è¾“å‡ºå˜é‡"><a href="#è¾“å‡ºå˜é‡" class="headerlink" title="è¾“å‡ºå˜é‡"></a>è¾“å‡ºå˜é‡</h5><p>åˆ›å»ºä¸€ä¸ª HelloControllerï¼Œç„¶åæ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(Model model)</span> </span>&#123;        List&lt;User&gt; users = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            User u = <span class="hljs-keyword">new</span> User();            u.setUsername(<span class="hljs-string">&quot;javaboy:&quot;</span> + i);            u.setAddress(<span class="hljs-string">&quot;www.javaboy.org:&quot;</span> + i);            users.add(u);        &#125;        Map&lt;String, Object&gt; info = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        info.put(<span class="hljs-string">&quot;site&quot;</span>, <span class="hljs-string">&quot;http://www.itboyhub.com&quot;</span>);        info.put(<span class="hljs-string">&quot;wechat&quot;</span>, <span class="hljs-string">&quot;a_java_boy&quot;</span>);        info.put(<span class="hljs-string">&quot;github&quot;</span>, <span class="hljs-string">&quot;https://github.com/lenve&quot;</span>);        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);        model.addAttribute(<span class="hljs-string">&quot;info&quot;</span>, info);        model.addAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;æ±Ÿå—ä¸€ç‚¹é›¨&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ¨¡ç‰ˆæ–‡ä»¶ä¸­å¯¹è¿™é‡Œçš„æ™®é€šå˜é‡ã€List é›†åˆä»¥åŠ Map åˆ†åˆ«è¿›è¡Œå±•ç¤ºã€‚</p><p><strong>æ™®é€šå˜é‡</strong></p><p>æ™®é€šå˜é‡çš„å±•ç¤ºå¾ˆå®¹æ˜“ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>é›†åˆ</strong></p><p>é›†åˆçš„å±•ç¤ºå°±æœ‰å¾ˆå¤šä¸åŒçš„ç©æ³•äº†ã€‚</p><p>ç›´æ¥éå†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list users as u&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.address&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>è¾“å‡ºé›†åˆä¸­ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    $&#123;users[3].username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>è¾“å‡ºé›†åˆä¸­ç¬¬ 4-6 ä¸ªå…ƒç´ ï¼Œå³å­é›†åˆï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list users[3..5] as u&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.address&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>éå†æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>å˜é‡_index</code> è·å–éå†çš„ä¸‹æ ‡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list users[3..5] as u&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u.address&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;u_index&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>Map</strong></p><p>ç›´æ¥è·å– Map ä¸­çš„å€¼æœ‰ä¸åŒçš„å†™æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;info.wechat&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;info[&#x27;site&#x27;]&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>è·å– Map ä¸­çš„æ‰€æœ‰ keyï¼Œå¹¶æ ¹æ® key è·å– valueï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#list info?keys as key&gt;        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;key&#125;--$&#123;info[key]&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    &lt;/#list&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>è·å– Map ä¸­çš„æ‰€æœ‰ valueï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#list info?values as value&gt;        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;value&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    &lt;/#list&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="å­—ç¬¦ä¸²æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ“ä½œ"></a>å­—ç¬¦ä¸²æ“ä½œ</h5><p>å­—ç¬¦ä¸²çš„æ‹¼æ¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;hello $&#123;name&#125;&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;hello &quot;+ name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>ä¹Ÿå¯ä»¥ä»å­—ç¬¦ä¸²ä¸­æˆªå–å­ä¸²ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;name[0]&#125;$&#123;name[1]&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;name[0..2]&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>æœ€ç»ˆæ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217200637.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217200637.png" alt="img"></a></p><h5 id="é›†åˆæ“ä½œ"><a href="#é›†åˆæ“ä½œ" class="headerlink" title="é›†åˆæ“ä½œ"></a>é›†åˆæ“ä½œ</h5><p>é›†åˆæˆ–è€… Map éƒ½å¯ä»¥ç›¸åŠ ã€‚</p><p>é›†åˆç›¸åŠ ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#list [&quot;æ˜ŸæœŸä¸€&quot;,&quot;æ˜ŸæœŸäºŒ&quot;,&quot;æ˜ŸæœŸä¸‰&quot;] + [&quot;æ˜ŸæœŸå››&quot;,&quot;æ˜ŸæœŸäº”&quot;,&quot;æ˜ŸæœŸå…­&quot;,&quot;æ˜ŸæœŸå¤©&quot;] as x&gt;        $&#123;x&#125;    &lt;/#list&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>Map ç›¸åŠ ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#list (info+&#123;&quot;gitee&quot;:&quot;https://gitee.com/lenve&quot;&#125;)?keys as key&gt;        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;key&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    &lt;/#list&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="ç®—æœ¯è¿ç®—ç¬¦"><a href="#ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯è¿ç®—ç¬¦"></a>ç®—æœ¯è¿ç®—ç¬¦</h5><p><code>+</code>ã€<code>â€”</code>ã€<code>*</code>ã€<code>/</code>ã€<code>%</code> è¿ç®—éƒ½æ˜¯æ”¯æŒçš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#assign age=99&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;age*99/99+99-1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="æ¯”è¾ƒè¿ç®—"><a href="#æ¯”è¾ƒè¿ç®—" class="headerlink" title="æ¯”è¾ƒè¿ç®—"></a>æ¯”è¾ƒè¿ç®—</h5><p>æ¯”è¾ƒè¿ç®—å’Œ Thymeleaf æ¯”è¾ƒç±»ä¼¼:</p><ul><li>= æˆ–è€… == åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li>!= åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰ã€‚</li><li><code>&gt;</code> æˆ–è€… gt åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼ã€‚</li><li><code>&gt;=</code> æˆ–è€… gte åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºç­‰äºå³è¾¹å€¼ã€‚</li><li><code>&lt;</code> æˆ–è€… lt åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºå³è¾¹å€¼ã€‚</li><li><code>&lt;=</code> æˆ–è€… lte åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œå¸¦ <code>&lt;</code> æˆ–è€… <code>&gt;</code> çš„ç¬¦å·ï¼Œä¹Ÿéƒ½æœ‰åˆ«åï¼Œå»ºè®®ä½¿ç”¨åˆ«åã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#assign age=99&gt;    &lt;#if age=99&gt;age=99&lt;/#if&gt;    &lt;#if age gt 99&gt;age gt 99&lt;/#if&gt;    &lt;#if age gte 99&gt;age gte 99&lt;/#if&gt;    &lt;#if age lt 99&gt;age lt 99&lt;/#if&gt;    &lt;#if age lte 99&gt;age lte 99&lt;/#if&gt;    &lt;#if age!=99&gt;age!=99&lt;/#if&gt;    &lt;#if age==99&gt;age==99&lt;/#if&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h5><p>é€»è¾‘è¿ç®—ç¬¦æœ‰ä¸‰ä¸ª:</p><ul><li>é€»è¾‘ä¸ <code>&amp;&amp;</code></li><li>é€»è¾‘æˆ– <code>||</code></li><li>é€»è¾‘é <code>!</code></li></ul><p>é€»è¾‘è¿ç®—ç¬¦åªèƒ½ä½œç”¨äºå¸ƒå°”å€¼,å¦åˆ™å°†äº§ç”Ÿé”™è¯¯ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#assign age=99&gt;    &lt;#if age=99 &amp;&amp; 1==1&gt;age=99 &amp;&amp; 1==1&lt;/#if&gt;    &lt;#if age=99 || 1==0&gt;age=99 || 1==0&lt;/#if&gt;    &lt;#if !(age gt 99)&gt;!(age gt 99)&lt;/#if&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h5 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h5><p>ä¸ºäº†å¤„ç†ç¼ºå¤±å˜é‡,Freemarker æä¾›äº†ä¸¤ä¸ªè¿ç®—ç¬¦:</p><ol><li><code>!</code>ï¼šæŒ‡å®šç¼ºå¤±å˜é‡çš„é»˜è®¤å€¼</li><li><code>??</code>ï¼šåˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦å­˜åœ¨</li></ol><p>å¦‚æœæŸä¸ªå˜é‡ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®å…¶ä¸º javaboyï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;aaa!&quot;javaboy&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å¦‚æœæŸä¸ªå˜é‡ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®å…¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;aaa!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å³ï¼Œ<code>!</code> åé¢çš„ä¸œè¥¿å¦‚æœçœç•¥äº†ï¼Œé»˜è®¤å°±æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</p><p>åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;aaa!&quot;javaboy&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;aaa!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  &lt;#if aaa??&gt;    aaa    &lt;/#if&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h4 id="2-2-2-å†…å»ºå‡½æ•°"><a href="#2-2-2-å†…å»ºå‡½æ•°" class="headerlink" title="2.2.2 å†…å»ºå‡½æ•°"></a>2.2.2 å†…å»ºå‡½æ•°</h4><p>å†…å»ºå‡½æ•°æ¶‰åŠåˆ°çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£:<a href="http://freemarker.foofun.cn/ref_builtins.html%E3%80%82">http://freemarker.foofun.cn/ref_builtins.htmlã€‚</a></p><p>è¿™é‡Œä»…è¯´ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„å†…å»ºå‡½æ•°ã€‚</p><p><strong>cap_first</strong></p><p>ä½¿å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;hello&quot;?cap_first&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>lower_case</strong></p><p>å°†å­—ç¬¦ä¸²è½¬æ¢æˆå°å†™ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;HELLO&quot;?lower_case&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>upper_case</strong></p><p>å°†å­—ç¬¦ä¸²è½¬æ¢æˆå¤§å†™ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot;hello&quot;?upper_case&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>trim</strong></p><p>å»æ‰å­—ç¬¦ä¸²å‰åçš„ç©ºç™½å­—ç¬¦ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;&quot; hello&quot;?trim&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>size</strong></p><p>è·å–åºåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;users?size&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>int</strong></p><p>å–å¾—æ•°å­—çš„æ•´æ•°éƒ¨åˆ†,ç»“æœå¸¦ç¬¦å·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;3.14?int&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><strong>æ—¥æœŸæ ¼å¼åŒ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;birthday?string(&quot;yyyy-MM-dd&quot;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h4 id="2-2-3-å¸¸ç”¨æŒ‡ä»¤"><a href="#2-2-3-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="2.2.3 å¸¸ç”¨æŒ‡ä»¤"></a>2.2.3 å¸¸ç”¨æŒ‡ä»¤</h4><h5 id="if-else"><a href="#if-else" class="headerlink" title="if/else"></a>if/else</h5><p>åˆ†æ”¯æ§åˆ¶æŒ‡ä»¤ï¼Œä½œç”¨ç±»ä¼¼äº Java è¯­è¨€ä¸­çš„ ifï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#assign age=23&gt;    &lt;#if (age&gt;60)&gt;è€å¹´äºº    &lt;#elseif (age&gt;40)&gt;ä¸­å¹´äºº    &lt;#elseif (age&gt;20)&gt;é’å¹´äºº    &lt;#else&gt; å°‘å¹´äºº    &lt;/#if&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>æ¯”è¾ƒç¬¦å·ä¸­ç”¨äº† <code>()</code>ï¼Œå› æ­¤ä¸ç”¨è½¬ä¹‰ã€‚</p><h5 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h5><p>åˆ†æ”¯æŒ‡ä»¤ï¼Œç±»ä¼¼äº Java ä¸­çš„ switchï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    &lt;#assign age=99&gt;    &lt;#switch age&gt;        &lt;#case 23&gt;23&lt;#break&gt;        &lt;#case 24&gt;24&lt;#break&gt;        &lt;#default&gt;9999    &lt;/#switch&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p><code>&lt;#break&gt;</code> æ˜¯æå‰é€€å‡ºï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ <code>&lt;#list&gt;</code> ä¸­ã€‚</p><h5 id="include"><a href="#include" class="headerlink" title="include"></a>include</h5><p>include å¯ä»¥åŒ…å«ä¸€ä¸ªå¤–éƒ¨é¡µé¢è¿›æ¥ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#include &quot;./javaboy.ftlh&quot;&gt;</code></pre></div><h5 id="macro"><a href="#macro" class="headerlink" title="macro"></a>macro</h5><p>macro ç”¨æ¥å®šä¹‰ä¸€ä¸ªå®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªåä¸º book çš„å®ï¼Œå¹¶å¼•ç”¨å®ƒï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#macro book&gt;    ä¸‰å›½æ¼”ä¹‰&lt;/#macro&gt;&lt;@book/&gt;</code></pre></div><p>æœ€ç»ˆé¡µé¢ä¸­ä¼šè¾“å‡ºå®ä¸­æ‰€å®šä¹‰çš„å†…å®¹ã€‚</p><p>åœ¨å®šä¹‰å®çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°ï¼Œé‚£ä¹ˆå¼•ç”¨æ—¶ï¼Œä¹Ÿéœ€è¦ä¼ å…¥å‚æ•°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#macro book bs&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list bs as b&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;b&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>&lt;/#macro&gt;&lt;@book [&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]/&gt;</code></pre></div><p>bs å°±æ˜¯éœ€è¦ä¼ å…¥çš„å‚æ•°ã€‚å¯ä»¥é€šè¿‡ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œå¤šä¸ªå‚æ•°è·Ÿåœ¨ bs åé¢å³å¯ï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨ <code>&lt;#nested&gt;</code> å¼•å…¥ç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤çš„æ ‡ç­¾ä½“ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#macro book bs&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list bs as b&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;b&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>    &lt;#nested&gt;&lt;/#macro&gt;&lt;@book [&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello javaboy!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>&lt;/@book&gt;</code></pre></div><p>åœ¨å®å®šä¹‰çš„æ—¶å€™ï¼Œ<code>&lt;#nested&gt;</code> ç›¸å½“äºæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>&lt;@book&gt;</code> æ ‡ç­¾ä¸­çš„å†…å®¹ä¼šå‡ºç°åœ¨ <code>&lt;#nested&gt;</code> ä½ç½®ã€‚</p><p>å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œå®éƒ½æ˜¯å®šä¹‰åœ¨å½“å‰é¡µé¢ä¸­ï¼Œå®ä¹Ÿå¯ä»¥å®šä¹‰åœ¨ä¸€ä¸ªä¸“é—¨çš„é¡µé¢ä¸­ã€‚æ–°å»º<code>myjavaboy.ftlh</code>é¡µé¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#macro book bs&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>        &lt;#list bs as b&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;b&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        &lt;/#list&gt;    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>    &lt;#nested&gt;&lt;/#macro&gt;</code></pre></div><p>æ­¤æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡ <code>&lt;#import&gt;</code> æ ‡ç­¾å¯¼å…¥å®ï¼Œç„¶åæ‰èƒ½è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#import &quot;./myjavaboy.ftlh&quot; as com&gt;&lt;@com.book bs=[&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello javaboy!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>&lt;/@com.book&gt;</code></pre></div><h5 id="noparse"><a href="#noparse" class="headerlink" title="noparse"></a>noparse</h5><p>å¦‚æœæƒ³åœ¨é¡µé¢å±•ç¤ºä¸€äº› Freemarker è¯­æ³•è€Œä¸è¢«æ¸²æŸ“ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ noparse æ ‡ç­¾ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html">&lt;#noparse&gt;&lt;#import &quot;./myjavaboy.ftlh&quot; as com&gt;&lt;@com.book bs=[&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello javaboy!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>&lt;/@com.book&gt;&lt;/#noparse&gt;</code></pre></div><p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/20201217214402.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20201217214402.png" alt="img"></a></p><p><strong>å¦‚æœè¦åŒæ—¶ä½¿ç”¨Thymeleafï¼Œè¦æŠŠFreemarkerçš„pomä¾èµ–æ”¾åœ¨å‰é¢</strong></p><h1 id="SpringBootæ•´åˆWeb"><a href="#SpringBootæ•´åˆWeb" class="headerlink" title="SpringBootæ•´åˆWeb"></a>SpringBootæ•´åˆWeb</h1><h2 id="1-SpringBootä¸­çš„JSON"><a href="#1-SpringBootä¸­çš„JSON" class="headerlink" title="1. SpringBootä¸­çš„JSON"></a>1. SpringBootä¸­çš„JSON</h2><p>å…·ä½“çš„JSONç”¨æ³•å¯ä»¥[å‚è€ƒSringMVC](#11. JSON)ä¸­çš„ä»‹ç»ï¼Œè¿™é‡Œè¡¥å……å‡ ç‚¹</p><h3 id="1-1-Jackson"><a href="#1-1-Jackson" class="headerlink" title="1.1 Jackson"></a>1.1 Jackson</h3><p>SpringBooté»˜è®¤å°±æœ‰ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥<code>pom.xml</code>çš„ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ‰¹é‡å¿½ç•¥å­—æ®µ</span><span class="hljs-meta">@JsonIgnoreProperties(&#123;&quot;birthday&quot;,&quot;address&quot;&#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-comment">//æŒ‡å®šå±æ€§åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶çš„åç§°ï¼Œé»˜è®¤åç§°å°±æ˜¯å±æ€§å</span>    <span class="hljs-meta">@JsonProperty(value = &quot;aaaage&quot;,index = 99)</span>    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-meta">@JsonProperty(index = 98)</span>    <span class="hljs-keyword">private</span> String username;<span class="hljs-meta">@JsonProperty(index = 97)</span>    <span class="hljs-comment">//æ—¥æœŸæ ¼å¼åŒ–ï¼Œæ³¨æ„æ—¶åŒºé—®é¢˜</span><span class="hljs-meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;,timezone = &quot;Asia/Shanghai&quot;)</span>    <span class="hljs-comment">//ç±»ä¼¼äº @JsonProperty ä¸­çš„ index</span>    <span class="hljs-meta">@JsonPropertyOrder</span>    <span class="hljs-keyword">private</span> Date birthday;    <span class="hljs-comment">//åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶å¿½ç•¥æŸä¸€ä¸ªå­—æ®µ</span><span class="hljs-meta">@JsonIgnore</span>    <span class="hljs-keyword">private</span> String address;</code></pre></div><p>è‡ªå·±æä¾›ä¸€ä¸ª<code>ObjectMapper</code>å®ä¾‹ï¼Œå°±ä¸ç”¨æ¯ä¸ªå®ä½“ç±»ä¸Šæ·»åŠ </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">ObjectMapper <span class="hljs-title">objectMapper</span><span class="hljs-params">()</span> </span>&#123;        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();        om.setDateFormat(<span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));        <span class="hljs-keyword">return</span> om;    &#125;&#125;</code></pre></div><h3 id="1-2-Gson"><a href="#1-2-Gson" class="headerlink" title="1.2 Gson"></a>1.2 Gson</h3><p>åœ¨<code>pom.xml</code>é‡Œæ’é™¤é»˜è®¤çš„ä¾èµ–å†å¼•å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><code>application.properties</code>é‡Œçš„é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.gson.date-format</span>=<span class="hljs-string">yyyy-MM-dd HH:mm:ss</span><span class="hljs-comment">## æ˜¯å¦ç¦ç”¨ HTML çš„è½¬ä¹‰å­—ç¬¦</span><span class="hljs-meta">spring.gson.disable-html-escaping</span>=<span class="hljs-string">true</span><span class="hljs-comment">## åºåˆ—åŒ–æ—¶æ˜¯å¦æ’é™¤å†…éƒ¨ç±»</span><span class="hljs-meta">spring.gson.disable-inner-class-serialization</span>=<span class="hljs-string">false</span><span class="hljs-comment">## åºåˆ—åŒ–æ—¶æ˜¯å¦å¼ƒç”¨å¤æ‚æ˜ å°„é”®</span><span class="hljs-meta">spring.gson.enable-complex-map-key-serialization</span>=<span class="hljs-string"></span><span class="hljs-comment">## æ˜¯å¦æ’é™¤æ²¡æœ‰ @Expose æ³¨è§£çš„å­—æ®µ</span><span class="hljs-meta">spring.gson.exclude-fields-without-expose-annotation</span>=<span class="hljs-string"></span><span class="hljs-comment">## åºåˆ—åŒ–æ—¶å­—æ®µåçš„å‘½åç­–ç•¥</span><span class="hljs-meta">spring.gson.field-naming-policy</span>=<span class="hljs-string"></span><span class="hljs-comment">## åœ¨è¾“å‡ºä¹‹å‰æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„æ–‡æœ¬æ¥ç”Ÿæˆä¸€ä¸ªä¸å¯æ‰§è¡Œçš„ JSON</span><span class="hljs-meta">spring.gson.generate-non-executable-json</span>=<span class="hljs-string"></span><span class="hljs-comment">## æ˜¯å¦åºåˆ—åŒ–ç©ºå­—æ®µ</span><span class="hljs-meta">spring.gson.serialize-nulls</span>=<span class="hljs-string"></span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/user&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>&#123;        User user = <span class="hljs-keyword">new</span> User();        user.setUsername(<span class="hljs-string">&quot;javaboy&quot;</span>);        user.setBirthday(<span class="hljs-keyword">new</span> Date());        <span class="hljs-keyword">return</span> user;    &#125;&#125;<span class="hljs-comment">//åŒç†äºjacksonçš„ObjectMapper</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">GsonBuilder <span class="hljs-title">gsonBuilder</span><span class="hljs-params">()</span> </span>&#123;        GsonBuilder gsonBuilder = <span class="hljs-keyword">new</span> GsonBuilder();        gsonBuilder.setDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);        <span class="hljs-keyword">return</span> gsonBuilder;    &#125;  <span class="hljs-comment">//æˆ–è€…</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">GsonHttpMessageConverter <span class="hljs-title">gsonHttpMessageConverter</span><span class="hljs-params">()</span> </span>&#123;        GsonBuilder gsonBuilder = <span class="hljs-keyword">new</span> GsonBuilder();        gsonBuilder.setDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);        GsonHttpMessageConverter converter = <span class="hljs-keyword">new</span> GsonHttpMessageConverter();        converter.setGson(gsonBuilder.create());        <span class="hljs-keyword">return</span> converter;    &#125;&#125;</code></pre></div><h3 id="1-3-fastjson"><a href="#1-3-fastjson" class="headerlink" title="1.3 fastjson"></a>1.3 fastjson</h3><p>åœ¨<code>pom.xml</code>é‡Œæ’é™¤é»˜è®¤çš„ä¾èµ–å†å¼•å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.75<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>Springæ²¡æœ‰ç»™å®ƒæä¾›<code>FastJsonHttpMessageConverter</code>ï¼Œå¿…é¡»è¦è‡ªå·±æä¾›</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">FastJsonHttpMessageConverter <span class="hljs-title">fastJsonHttpMessageConverter</span><span class="hljs-params">()</span> </span>&#123;        FastJsonHttpMessageConverter converter = <span class="hljs-keyword">new</span> FastJsonHttpMessageConverter();        FastJsonConfig fastJsonConfig = <span class="hljs-keyword">new</span> FastJsonConfig();        fastJsonConfig.setCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        fastJsonConfig.setDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);        converter.setFastJsonConfig(fastJsonConfig);        converter.setDefaultCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        <span class="hljs-keyword">return</span> converter;    &#125;&#125;<span class="hljs-comment">//æˆ–è€…</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;        FastJsonHttpMessageConverter converter = <span class="hljs-keyword">new</span> FastJsonHttpMessageConverter();        FastJsonConfig fastJsonConfig = <span class="hljs-keyword">new</span> FastJsonConfig();        fastJsonConfig.setCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        fastJsonConfig.setDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);        converter.setFastJsonConfig(fastJsonConfig);        converter.setDefaultCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        converters.add(converter);    &#125;&#125;</code></pre></div><h2 id="2-é™æ€èµ„æºé…ç½®"><a href="#2-é™æ€èµ„æºé…ç½®" class="headerlink" title="2. é™æ€èµ„æºé…ç½®"></a>2. é™æ€èµ„æºé…ç½®</h2><h3 id="2-1-SSM-ä¸­çš„é…ç½®"><a href="#2-1-SSM-ä¸­çš„é…ç½®" class="headerlink" title="2.1 SSM ä¸­çš„é…ç½®"></a>2.1 SSM ä¸­çš„é…ç½®</h3><p>è¦è®² Spring Boot ä¸­çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾—å…ˆå›åˆ° SSM ç¯å¢ƒæ­å»ºä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>&lt;mvc:resources /&gt;</code> èŠ‚ç‚¹æ¥é…ç½®ä¸æ‹¦æˆªé™æ€èµ„æºï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/js/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/js/&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/css/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/css/&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/html/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/html/&quot;</span>/&gt;</span></code></pre></div><p>ç”±äºè¿™æ˜¯ä¸€ç§Anté£æ ¼çš„è·¯å¾„åŒ¹é…ç¬¦ï¼Œ<code>/**</code> è¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»æ„å±‚çº§çš„è·¯å¾„ï¼Œå› æ­¤ä¸Šé¢çš„ä»£ç ä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·ç®€å†™ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/&quot;</span>/&gt;</span></code></pre></div><p>è¿™ç§é…ç½®æ˜¯åœ¨ XML ä¸­çš„é…ç½®ï¼Œå¤§å®¶çŸ¥é“ï¼ŒSpringMVC çš„é…ç½®é™¤äº†åœ¨XMLä¸­é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨ Java ä»£ç ä¸­é…ç½®ï¼Œå¦‚æœåœ¨Javaä»£ç ä¸­é…ç½®çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªWebMvcConfigurationSupportå³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.sang.javassm&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;        registry.addResourceHandler(<span class="hljs-string">&quot;/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;/&quot;</span>);    &#125;&#125;</code></pre></div><p>é‡å†™ WebMvcConfigurationSupport ç±»ä¸­çš„addResourceHandlersæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­é…ç½®é™æ€èµ„æºä½ç½®å³å¯ï¼Œè¿™é‡Œçš„å«ä¹‰å’Œä¸Šé¢ xml é…ç½®çš„å«ä¹‰ä¸€è‡´ï¼Œå› æ­¤æ— éœ€å¤šè¯´ã€‚<br>è¿™æ˜¯æˆ‘ä»¬ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨Spring Boot ä¸­ï¼Œå…¶å®é…ç½®æ–¹å¼å’Œè¿™ä¸ªä¸€è„‰ç›¸æ‰¿ï¼Œåªæ˜¯æœ‰ä¸€äº›è‡ªåŠ¨åŒ–çš„é…ç½®äº†ã€‚</p><h3 id="2-2-Spring-Boot-ä¸­çš„é…ç½®"><a href="#2-2-Spring-Boot-ä¸­çš„é…ç½®" class="headerlink" title="2.2 Spring Boot ä¸­çš„é…ç½®"></a>2.2 Spring Boot ä¸­çš„é…ç½®</h3><p>åœ¨ Spring Boot ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯ä» <code>https://start.spring.io</code> è¿™ä¸ªç½‘ç«™ä¸Šåˆ›å»ºçš„é¡¹ç›®ï¼Œæˆ–è€…ä½¿ç”¨ IntelliJ IDEA ä¸­çš„ Spring Boot åˆå§‹åŒ–å·¥å…·åˆ›å»ºçš„é¡¹ç›®ï¼Œé»˜è®¤éƒ½ä¼šå­˜åœ¨<code>resources/static</code>ç›®å½•ï¼Œå¾ˆå¤šå°ä¼™ä¼´ä¹ŸçŸ¥é“é™æ€èµ„æºåªè¦æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®ï¼Œé™¤äº†è¿™é‡Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–å¯ä»¥æ”¾é™æ€èµ„æºçš„ä½ç½®å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ”¾åœ¨è¿™é‡Œå°±èƒ½ç›´æ¥è®¿é—®äº†å‘¢ï¼Ÿè¿™å°±æ˜¯æœ¬æ–‡è¦è®¨è®ºçš„é—®é¢˜äº†ã€‚</p><h4 id="2-2-1-æ•´ä½“è§„åˆ’"><a href="#2-2-1-æ•´ä½“è§„åˆ’" class="headerlink" title="2.2.1 æ•´ä½“è§„åˆ’"></a>2.2.1 æ•´ä½“è§„åˆ’</h4><p>é¦–å…ˆï¼Œåœ¨ Spring Boot ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€å…±æœ‰5ä¸ªä½ç½®å¯ä»¥æ”¾é™æ€èµ„æºï¼Œäº”ä¸ªè·¯å¾„åˆ†åˆ«æ˜¯å¦‚ä¸‹5ä¸ªï¼š</p><ul><li>classpath:/META-INF/resources/</li><li>classpath:/resources/</li><li>classpath:/static/</li><li>classpath:/public/</li><li>/</li></ul><p>å‰å››ä¸ªç›®å½•å¥½ç†è§£ï¼Œåˆ†åˆ«å¯¹åº”äº†resourcesç›®å½•ä¸‹ä¸åŒçš„ç›®å½•ï¼Œç¬¬5ä¸ª <code>/</code> æ˜¯å•¥æ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ webapp è¿™ä¸ªç›®å½•çš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ·»åŠ ï¼ˆä¾‹å¦‚åœ¨éœ€è¦ä½¿ç”¨JSPçš„æ—¶å€™ï¼‰ï¼Œè¿™é‡Œç¬¬5ä¸ª <code>/</code>å…¶å®å°±æ˜¯è¡¨ç¤º webapp ç›®å½•ä¸­çš„é™æ€èµ„æºä¹Ÿä¸è¢«æ‹¦æˆªã€‚å¦‚æœåŒä¸€ä¸ªæ–‡ä»¶åˆ†åˆ«å‡ºç°åœ¨äº”ä¸ªç›®å½•ä¸‹ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§ä¹Ÿæ˜¯æŒ‰ç…§ä¸Šé¢åˆ—å‡ºçš„é¡ºåºã€‚</p><p>ä¸è¿‡ï¼Œè™½ç„¶æœ‰5ä¸ªå­˜å‚¨ç›®å½•ï¼Œé™¤äº†ç¬¬5ä¸ªç”¨çš„æ¯”è¾ƒå°‘ä¹‹å¤–ï¼Œå…¶ä»–å››ä¸ªï¼Œç³»ç»Ÿé»˜è®¤åˆ›å»ºäº† <code>classpath:/static/</code> ï¼Œ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æˆ‘ä»¬çš„é™æ€èµ„æºæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹å³å¯ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–å»åˆ›å»ºå…¶ä»–é™æ€èµ„æºç›®å½•ï¼Œä¾‹å¦‚æˆ‘åœ¨ <code>classpath:/static/</code> ç›®å½•ä¸‹æ”¾äº†ä¸€å¼ åä¸º1.png çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆæˆ‘çš„è®¿é—®è·¯å¾„æ˜¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://localhost:<span class="hljs-number">8080</span>/<span class="hljs-number">1</span>.png</code></pre></div><p>è¿™é‡Œå¤§å®¶æ³¨æ„ï¼Œè¯·æ±‚åœ°å€ä¸­å¹¶ä¸éœ€è¦ <code>static</code>ï¼Œå¦‚æœåŠ ä¸Šäº†<code>static</code>åè€Œå¤šæ­¤ä¸€ä¸¾ä¼šæŠ¥404é”™è¯¯ã€‚å¾ˆå¤šäººä¼šè§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¸éœ€è¦æ·»åŠ <code> static</code>å‘¢ï¼Ÿèµ„æºæ˜æ˜æ”¾åœ¨ <code>static </code>ç›®å½•ä¸‹ã€‚å…¶å®è¿™ä¸ªæ•ˆæœå¾ˆå¥½å®ç°ï¼Œä¾‹å¦‚åœ¨SSMé…ç½®ä¸­ï¼Œæˆ‘ä»¬çš„é™æ€èµ„æºæ‹¦æˆªé…ç½®å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/static/&quot;</span>/&gt;</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬æ˜¯è¿™æ ·é…ç½®çš„è¯ï¼Œè¯·æ±‚åœ°å€å¦‚æœæ˜¯ <code>http://localhost:8080/1.png</code> å®é™…ä¸Šç³»ç»Ÿä¼šå» <code>/static/1.png</code> ç›®å½•ä¸‹æŸ¥æ‰¾ç›¸å…³çš„æ–‡ä»¶ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ç†æ‰€å½“ç„¶çš„çŒœæµ‹ï¼Œåœ¨ Spring Boot ä¸­å¯èƒ½ä¹Ÿæ˜¯ç±»ä¼¼çš„é…ç½®ã€‚</p><h4 id="2-2-2-æºç è§£è¯»"><a href="#2-2-2-æºç è§£è¯»" class="headerlink" title="2.2.2 æºç è§£è¯»"></a>2.2.2 æºç è§£è¯»</h4><p>èƒ¡é€‚ä¹‹å…ˆç”Ÿè¯´ï¼šâ€œå¤§èƒ†çŒœæƒ³ï¼Œå°å¿ƒæ±‚è¯â€ï¼Œæˆ‘ä»¬è¿™é‡Œå°±é€šè¿‡æºç è§£è¯»æ¥çœ‹çœ‹ Spring Boot ä¸­çš„é™æ€èµ„æºåˆ°åº•æ˜¯æ€ä¹ˆé…ç½®çš„ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åœ¨ <code>WebMvcAutoConfiguration </code>ç±»ä¸­çœ‹åˆ°äº† SpringMVC è‡ªåŠ¨åŒ–é…ç½®çš„ç›¸å…³çš„å†…å®¹ï¼Œæ‰¾åˆ°äº†é™æ€èµ„æºæ‹¦æˆªçš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/21-1-20210525153453678.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œé™æ€èµ„æºçš„å®šä¹‰å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„Javaé…ç½®SSMä¸­çš„é…ç½®éå¸¸ç›¸ä¼¼ï¼Œå…¶ä¸­ï¼Œ<code>this.mvcProperties.getStaticPathPattern() </code>æ–¹æ³•å¯¹åº”çš„å€¼æ˜¯ <code>â€œ/**â€</code>ï¼Œ<code>this.resourceProperties.getStaticLocations()</code>æ–¹æ³•è¿”å›äº†å››ä¸ªä½ç½®ï¼Œåˆ†åˆ«æ˜¯ï¼šâ€<code>classpath:/META-INF/resources/â€, â€œclasspath:/resources/â€,â€classpath:/static/â€, â€œclasspath:/public/â€</code>ï¼Œç„¶ååœ¨<code>getResourceLocations</code>æ–¹æ³•ä¸­ï¼Œåˆæ·»åŠ äº†<code>â€œ/â€</code>ï¼Œå› æ­¤è¿™é‡Œè¿”å›å€¼ä¸€å…±æœ‰5ä¸ªã€‚å…¶ä¸­ï¼Œ<code>/</code>è¡¨ç¤º<code>webapp</code>ç›®å½•ï¼Œå³webappä¸­çš„é™æ€æ–‡ä»¶ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®ã€‚é™æ€èµ„æºçš„åŒ¹é…è·¯å¾„æŒ‰ç…§å®šä¹‰è·¯å¾„ä¼˜å…ˆçº§ä¾æ¬¡é™ä½ã€‚å› æ­¤è¿™é‡Œçš„é…ç½®å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„å¦‚å‡ºä¸€è¾™ã€‚è¿™æ ·å¤§ä¼™å°±çŸ¥é“äº†ä¸ºä»€ä¹ˆSpring Boot ä¸­æ”¯æŒ5ä¸ªé™æ€èµ„æºä½ç½®ï¼ŒåŒæ—¶ä¹Ÿæ˜ç™½äº†ä¸ºä»€ä¹ˆé™æ€èµ„æºè¯·æ±‚è·¯å¾„ä¸­ä¸éœ€è¦<code>/static</code>ï¼Œå› ä¸ºåœ¨è·¯å¾„æ˜ å°„ä¸­å·²ç»è‡ªåŠ¨çš„æ·»åŠ ä¸Šäº†<code>/static</code>äº†ã€‚</p><h4 id="2-2-3-è‡ªå®šä¹‰é…ç½®"><a href="#2-2-3-è‡ªå®šä¹‰é…ç½®" class="headerlink" title="2.2.3 è‡ªå®šä¹‰é…ç½®"></a>2.2.3 è‡ªå®šä¹‰é…ç½®</h4><p>å½“ç„¶ï¼Œè¿™ä¸ªæ˜¯ç³»ç»Ÿé»˜è®¤é…ç½®ï¼Œå¦‚æœæˆ‘ä»¬å¹¶ä¸æƒ³å°†èµ„æºæ”¾åœ¨ç³»ç»Ÿé»˜è®¤çš„è¿™äº”ä¸ªä½ç½®ä¸Šï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰é™æ€èµ„æºä½ç½®å’Œæ˜ å°„ï¼Œè‡ªå®šä¹‰çš„æ–¹å¼ä¹Ÿæœ‰ä¸¤ç§ï¼Œå¯ä»¥é€šè¿‡ application.properties æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨ Java ä»£ç ä¸­æ¥å®šä¹‰ï¼Œä¸‹é¢åˆ†åˆ«æ¥çœ‹ã€‚</p><ul><li>application.properties</li></ul><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.resources.static-locations</span>=<span class="hljs-string">classpath:/</span><span class="hljs-meta">spring.mvc.static-path-pattern</span>=<span class="hljs-string">/**</span></code></pre></div><p>ç¬¬ä¸€è¡Œé…ç½®è¡¨ç¤ºå®šä¹‰èµ„æºä½ç½®ï¼Œç¬¬äºŒè¡Œé…ç½®è¡¨ç¤ºå®šä¹‰è¯·æ±‚ URL è§„åˆ™ã€‚ä»¥ä¸Šæ–‡çš„é…ç½®ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·å®šä¹‰äº†ï¼Œè¡¨ç¤ºå¯ä»¥å°†é™æ€èµ„æºæ”¾åœ¨ resourcesç›®å½•ä¸‹çš„ä»»æ„åœ°æ–¹ï¼Œæˆ‘ä»¬è®¿é—®çš„æ—¶å€™å½“ç„¶ä¹Ÿéœ€è¦å†™å®Œæ•´çš„è·¯å¾„ï¼Œä¾‹å¦‚åœ¨resources/staticç›®å½•ä¸‹æœ‰ä¸€å¼ åä¸º1.png çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆè®¿é—®è·¯å¾„å°±æ˜¯ <code>http://localhost:8080/static/1.png</code> ,æ³¨æ„æ­¤æ—¶çš„staticä¸èƒ½çœç•¥ã€‚</p><ul><li>Java ä»£ç å®šä¹‰</li></ul><p>å½“ç„¶ï¼Œåœ¨Spring Bootä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ Javaä»£ç æ¥è‡ªå®šä¹‰ï¼Œæ–¹å¼å’Œ Java é…ç½®çš„ SSM æ¯”è¾ƒç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMVCConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;        registry.addResourceHandler(<span class="hljs-string">&quot;/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/aaa/&quot;</span>);    &#125;&#125;</code></pre></div><p>è¿™é‡Œéœ€è¦æé†’å¤§å®¶çš„æ˜¯ï¼Œæœ‰å¾ˆå¤šäººç”¨äº† Thymeleaf ä¹‹åï¼Œ<strong>ä¼šå°†é™æ€èµ„æºä¹Ÿæ”¾åœ¨ resources/templates ç›®å½•ä¸‹ï¼Œæ³¨æ„ï¼Œtemplates ç›®å½•å¹¶ä¸æ˜¯é™æ€èµ„æºç›®å½•ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ”¾é¡µé¢æ¨¡æ¿çš„ä½ç½®ï¼ˆ</strong>ä½ çœ‹åˆ°çš„ Thymeleaf æ¨¡æ¿è™½ç„¶åç¼€ä¸º .htmlï¼Œå…¶å®å¹¶ä¸æ˜¯é™æ€èµ„æºï¼‰</p><h3 id="2-3-è·¯å¾„æ˜ å°„"><a href="#2-3-è·¯å¾„æ˜ å°„" class="headerlink" title="2.3 è·¯å¾„æ˜ å°„"></a>2.3 è·¯å¾„æ˜ å°„</h3><p>åˆ©ç”¨Controllerè·³è½¬</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/01&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello01</span><span class="hljs-params">(Model model)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;01&quot;</span>;    &#125;&#125;</code></pre></div><p>åˆ©ç”¨é…ç½®ç±»ç›´æ¥è¿›è¡Œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;        registry.addViewController(<span class="hljs-string">&quot;/02&quot;</span>).setViewName(<span class="hljs-string">&quot;02&quot;</span>);    &#125;&#125;</code></pre></div><p>è¿™æ ·å°±å¯ä»¥åœ¨ä¸åˆ›å»ºcontrollerçš„æƒ…å†µä¸‹ï¼Œåœ¨urlä¸­ç›´æ¥è¾“å…¥02è·³è½¬åˆ°02.htmlé¡µé¢äº†ï¼Œä½†æ˜¯æ­¤æ–¹æ³•ä¸æ”¯æŒè·³è½¬åˆ°åŠ¨æ€æ¸²æŸ“çš„é¡µé¢ä¸Šï¼Œå…·æœ‰ä¸€å®šçš„å±€é™æ€§</p><h3 id="2-4-è‡ªå®šä¹‰é¦–é¡µ"><a href="#2-4-è‡ªå®šä¹‰é¦–é¡µ" class="headerlink" title="2.4 è‡ªå®šä¹‰é¦–é¡µ"></a>2.4 è‡ªå®šä¹‰é¦–é¡µ</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;        registry.addViewController(<span class="hljs-string">&quot;/index&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);    &#125;&#125;</code></pre></div><p>é»˜è®¤è®¿é—®çš„æ˜¯<code>static</code>ä¸‹çš„<code>index.html</code>ï¼Œå¦‚æœä¸‹é¢æ²¡æœ‰ï¼Œå»è®¿é—®<code>templates</code>ä¸‹çš„<code>index.html</code></p><p>å¦‚æœè¦å®šä¹‰ç½‘ç«™<code>favicon</code>ï¼Œæ”¾ç½®<code>favicon.ico</code>æ”¾åœ¨<code>static</code>ä¸‹å³å¯</p><h2 id="3-æ–‡ä»¶ä¸Šä¼ "><a href="#3-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="3. æ–‡ä»¶ä¸Šä¼ "></a>3. æ–‡ä»¶ä¸Šä¼ </h2><p>Springè‡ªå¸¦çš„æ˜¯<code>StandardServletMultipartResolver</code>ï¼Œåˆ›å»ºController</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadController</span> </span>&#123;    <span class="hljs-comment">//åˆ†ç±»å¤„ç†</span>    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;/yyyy/MM/dd/&quot;</span>);    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span>    <span class="hljs-comment">//fileè¦å’Œhtmlçš„nameå€¼å¯¹åº”</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file, HttpServletRequest req)</span> </span>&#123;        <span class="hljs-comment">//ä¸´æ—¶ç›®å½•</span>        String realPath = req.getServletContext().getRealPath(<span class="hljs-string">&quot;/&quot;</span>);        String format = sdf.format(<span class="hljs-keyword">new</span> Date());        String path = realPath + format;        File folder = <span class="hljs-keyword">new</span> File(path);        <span class="hljs-comment">//åˆ¤ç©ºå¤„ç†</span>        <span class="hljs-keyword">if</span> (!folder.exists()) &#123;            folder.mkdirs();        &#125;        <span class="hljs-comment">//åå­—åç¼€</span>        String oldName = file.getOriginalFilename();        <span class="hljs-comment">//å‰ç¼€</span>        String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ‹¼æ¥</span>            file.transferTo(<span class="hljs-keyword">new</span> File(folder, newName));            <span class="hljs-comment">//åŠ¨æ€è·å–</span>            String s = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + format + newName;            <span class="hljs-keyword">return</span> s;        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;    &#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/upload&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--nameå±æ€§å¿…é¡»å†™ä¸Š,åŒæ—¶è¦å’Œcontrolleré‡Œçš„å¯¹åº”--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#è®¾ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°</span><span class="hljs-meta">spring.servlet.multipart.max-file-size</span>=<span class="hljs-string">1KB</span></code></pre></div><p><strong>å¦‚æœè¦ä¸Šä¼ å¤šæ–‡ä»¶</strong>ï¼Œé…ç½®å¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadController2</span> </span>&#123;    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;/yyyy/MM/dd/&quot;</span>);    <span class="hljs-meta">@PostMapping(&quot;/upload2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile[] files, HttpServletRequest req)</span> </span>&#123;        String realPath = req.getServletContext().getRealPath(<span class="hljs-string">&quot;/&quot;</span>);        String format = sdf.format(<span class="hljs-keyword">new</span> Date());        String path = realPath + format;        File folder = <span class="hljs-keyword">new</span> File(path);        <span class="hljs-keyword">if</span> (!folder.exists()) &#123;            folder.mkdirs();        &#125;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">for</span> (MultipartFile file : files) &#123;                String oldName = file.getOriginalFilename();                String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));                file.transferTo(<span class="hljs-keyword">new</span> File(folder, newName));                String s = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + format + newName;                System.out.println(<span class="hljs-string">&quot;s = &quot;</span> + s);            &#125;        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/upload2&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;files&quot;</span> <span class="hljs-attr">multiple</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p><strong>ajaxçš„æ–‡ä»¶ä¸Šä¼ </strong></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://code.jquery.com/jquery-3.5.1.js&quot;</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=&quot;</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;result&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;uploadFile()&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadFile</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        <span class="hljs-comment">//æ‹¿åˆ°æ–‡ä»¶å¯¹è±¡</span></span><span class="javascript">        <span class="hljs-keyword">var</span> file = $(<span class="hljs-string">&quot;#file&quot;</span>)[<span class="hljs-number">0</span>].files[<span class="hljs-number">0</span>];</span><span class="javascript">        <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> FormData();</span><span class="javascript">        formData.append(<span class="hljs-string">&quot;file&quot;</span>, file);</span><span class="javascript">        formData.append(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);</span><span class="javascript">        $.ajax(&#123;</span><span class="javascript">            type:<span class="hljs-string">&#x27;post&#x27;</span>,</span><span class="javascript">            url:<span class="hljs-string">&#x27;/upload&#x27;</span>,</span><span class="javascript">            processData:<span class="hljs-literal">false</span>,</span><span class="javascript">            contentType:<span class="hljs-literal">false</span>,</span>            data:formData,<span class="javascript">            success:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">                $(<span class="hljs-string">&quot;#result&quot;</span>).html(msg);</span>            &#125;        &#125;)    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="4-å¼‚å¸¸å¤„ç†"><a href="#4-å¼‚å¸¸å¤„ç†" class="headerlink" title="4. å¼‚å¸¸å¤„ç†"></a>4. å¼‚å¸¸å¤„ç†</h2><p>åœ¨ Spring Boot é¡¹ç›®ä¸­ ï¼Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ Spring ä¸­ @ControllerAdvice æ¥ç»Ÿä¸€å¤„ç†ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ¥å®šä¹‰å¼‚å¸¸å¤„ç†æ–¹æ¡ˆã€‚Spring Boot ä¸­ï¼Œå¯¹å¼‚å¸¸çš„å¤„ç†æœ‰ä¸€äº›é»˜è®¤çš„ç­–ç•¥ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¸­çš„å¼‚å¸¸é¡µé¢ æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-1-20210525153453655.png" alt="img"></p><p>æˆ‘ä»¬ä»è¿™ä¸ªå¼‚å¸¸æç¤ºä¸­ï¼Œä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œä¹‹æ‰€ä»¥ç”¨æˆ·çœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œæ˜¯å› ä¸ºå¼€å‘è€…æ²¡æœ‰æ˜ç¡®æä¾›ä¸€ä¸ª /error è·¯å¾„ï¼Œå¦‚æœå¼€å‘è€…æä¾›äº† /error è·¯å¾„ ï¼Œè¿™ä¸ªé¡µé¢å°±ä¸ä¼šå±•ç¤ºå‡ºæ¥ï¼Œä¸è¿‡åœ¨ Spring Boot ä¸­ï¼Œæä¾› /error è·¯å¾„å®é™…ä¸Šæ˜¯ä¸‹ä¸‹ç­–ï¼ŒSpring Boot æœ¬èº«åœ¨å¤„ç†å¼‚å¸¸æ—¶ï¼Œä¹Ÿæ˜¯å½“æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶ï¼Œæ‰ä¼šå»æ‰¾ /error è·¯å¾„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹ï¼Œåœ¨ Spring Boot ä¸­ï¼Œå¦‚ä½•è‡ªå®šä¹‰ error é¡µé¢ï¼Œæ•´ä½“ä¸Šæ¥è¯´ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é™æ€é¡µé¢ï¼Œå¦ä¸€ç§æ˜¯åŠ¨æ€é¡µé¢ã€‚</p><h3 id="4-1-é™æ€å¼‚å¸¸é¡µé¢"><a href="#4-1-é™æ€å¼‚å¸¸é¡µé¢" class="headerlink" title="4.1 é™æ€å¼‚å¸¸é¡µé¢"></a>4.1 é™æ€å¼‚å¸¸é¡µé¢</h3><p>è‡ªå®šä¹‰é™æ€å¼‚å¸¸é¡µé¢ï¼Œåˆåˆ†ä¸ºä¸¤ç§ï¼Œç¬¬ä¸€ç§ æ˜¯ä½¿ç”¨ HTTP å“åº”ç æ¥å‘½åé¡µé¢ï¼Œä¾‹å¦‚<code> 404.htmlã€405.htmlã€500.html â€¦.</code>ï¼Œå¦ä¸€ç§å°±æ˜¯ç›´æ¥å®šä¹‰ä¸€ä¸ª <code>4xx.html</code>ï¼Œè¡¨ç¤º400-499 çš„çŠ¶æ€éƒ½æ˜¾ç¤ºè¿™ä¸ªå¼‚å¸¸é¡µé¢ï¼Œ5xx.html è¡¨ç¤º 500-599 çš„çŠ¶æ€æ˜¾ç¤ºè¿™ä¸ªå¼‚å¸¸é¡µé¢ã€‚</p><p>é»˜è®¤æ˜¯åœ¨ <code>classpath:/static/error/</code> è·¯å¾„ä¸‹å®šä¹‰ç›¸å…³é¡µé¢ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-2-20210525153453642.png" alt="img"></p><p>æ­¤æ—¶ï¼Œå¯åŠ¨é¡¹ç›®ï¼Œå¦‚æœé¡¹ç›®æŠ›å‡º 500 è¯·æ±‚é”™è¯¯ï¼Œå°±ä¼šè‡ªåŠ¨å±•ç¤º 500.html è¿™ä¸ªé¡µé¢ï¼Œå‘ç”Ÿ 404 å°±ä¼šå±•ç¤º 404.html é¡µé¢ã€‚å¦‚æœå¼‚å¸¸å±•ç¤ºé¡µé¢æ—¢å­˜åœ¨ 5xx.htmlï¼Œä¹Ÿå­˜åœ¨ 500.html ï¼Œæ­¤æ—¶ï¼Œå‘ç”Ÿ500å¼‚å¸¸æ—¶ï¼Œä¼˜å…ˆå±•ç¤º 500.html é¡µé¢</p><h3 id="4-2-åŠ¨æ€å¼‚å¸¸é¡µé¢"><a href="#4-2-åŠ¨æ€å¼‚å¸¸é¡µé¢" class="headerlink" title="4.2 åŠ¨æ€å¼‚å¸¸é¡µé¢"></a>4.2 åŠ¨æ€å¼‚å¸¸é¡µé¢</h3><p>åŠ¨æ€çš„å¼‚å¸¸é¡µé¢å®šä¹‰æ–¹å¼å’Œé™æ€çš„åŸºæœ¬ ä¸€è‡´ï¼Œå¯ä»¥é‡‡ç”¨çš„é¡µé¢æ¨¡æ¿æœ‰ jspã€freemarkerã€thymeleafã€‚åŠ¨æ€å¼‚å¸¸é¡µé¢ï¼Œä¹Ÿæ”¯æŒ 404.html æˆ–è€… 4xx.html ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œç”±äºåŠ¨æ€å¼‚å¸¸é¡µé¢å¯ä»¥ç›´æ¥å±•ç¤ºå¼‚å¸¸è¯¦ç»†ä¿¡æ¯ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦æŒ¨ä¸ªæšä¸¾é”™è¯¯äº† ï¼Œç›´æ¥å®šä¹‰ 4xx.htmlï¼ˆè¿™é‡Œä½¿ç”¨thymeleafæ¨¡æ¿ï¼‰æˆ–è€… 5xx.html å³å¯ã€‚</p><p><strong>æ³¨æ„ï¼ŒåŠ¨æ€é¡µé¢æ¨¡æ¿ï¼Œä¸éœ€è¦å¼€å‘è€…è‡ªå·±å»å®šä¹‰æ§åˆ¶å™¨ï¼Œç›´æ¥å®šä¹‰å¼‚å¸¸é¡µé¢å³å¯ ï¼ŒSpring Boot ä¸­è‡ªå¸¦çš„å¼‚å¸¸å¤„ç†å™¨ä¼šè‡ªåŠ¨æŸ¥æ‰¾åˆ°å¼‚å¸¸é¡µé¢ã€‚</strong></p><p>é¡µé¢å®šä¹‰å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-3-20210525153453651.png" alt="img"></p><p>é¡µé¢å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>5xx<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>path<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;path&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>error<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;error&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>message<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>timestamp<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;timestamp&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>status<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;status&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®Œæ•´çš„å¼‚å¸¸ä¿¡æ¯å°±æ˜¯è¿™5æ¡ï¼Œå±•ç¤º æ•ˆæœå¦‚ä¸‹ ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-4-20210525153453654.png" alt="img"></p><p>å¦‚æœåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢åŒæ—¶å®šä¹‰äº†å¼‚å¸¸å¤„ç†é¡µé¢ï¼Œä¾‹å¦‚ <code>classpath:/static/error/404.html</code> å’Œ <code>classpath:/templates/error/404.html</code> åŒæ—¶å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä½¿ç”¨åŠ¨æ€é¡µé¢ã€‚å³å®Œæ•´çš„é”™è¯¯é¡µé¢æŸ¥æ‰¾æ–¹å¼åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><p><strong>å‘ç”Ÿäº†500é”™è¯¯â€“&gt;æŸ¥æ‰¾åŠ¨æ€ 500.html é¡µé¢â€“&gt;æŸ¥æ‰¾é™æ€ 500.html â€“&gt; æŸ¥æ‰¾åŠ¨æ€ 5xx.htmlâ€“&gt;æŸ¥æ‰¾é™æ€ 5xx.html</strong></p><h3 id="4-3-è‡ªå®šä¹‰å¼‚å¸¸æ•°æ®"><a href="#4-3-è‡ªå®šä¹‰å¼‚å¸¸æ•°æ®" class="headerlink" title="4.3 è‡ªå®šä¹‰å¼‚å¸¸æ•°æ®"></a>4.3 è‡ªå®šä¹‰å¼‚å¸¸æ•°æ®</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨Spring Boot ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸æ•°æ®å…¶å®å°±æ˜¯ä¸Šæ–‡æ‰€å±•ç¤ºå‡ºæ¥çš„5æ¡æ•°æ®ï¼Œè¿™5æ¡æ•°æ®å®šä¹‰åœ¨ <code>org.springframework.boot.web.reactive.error.DefaultErrorAttributes</code> ç±»ä¸­ï¼Œå…·ä½“å®šä¹‰åœ¨ <code>getErrorAttributes</code> æ–¹æ³•ä¸­ ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getErrorAttributes</span><span class="hljs-params">(ServerRequest request,</span></span><span class="hljs-function"><span class="hljs-params">                <span class="hljs-keyword">boolean</span> includeStackTrace)</span> </span>&#123;        Map&lt;String, Object&gt; errorAttributes = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();        errorAttributes.put(<span class="hljs-string">&quot;timestamp&quot;</span>, <span class="hljs-keyword">new</span> Date());        errorAttributes.put(<span class="hljs-string">&quot;path&quot;</span>, request.path());        Throwable error = getError(request);        HttpStatus errorStatus = determineHttpStatus(error);        errorAttributes.put(<span class="hljs-string">&quot;status&quot;</span>, errorStatus.value());        errorAttributes.put(<span class="hljs-string">&quot;error&quot;</span>, errorStatus.getReasonPhrase());        errorAttributes.put(<span class="hljs-string">&quot;message&quot;</span>, determineMessage(error));        handleException(errorAttributes, determineException(error), includeStackTrace);        <span class="hljs-keyword">return</span> errorAttributes;&#125;</code></pre></div><p><code>DefaultErrorAttributes </code>ç±»æœ¬èº«åˆ™æ˜¯åœ¨<code>org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration </code>å¼‚å¸¸è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰çš„ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è‡ªå·±æä¾›ä¸€ä¸ª <code>ErrorAttributes</code> çš„å®ä¾‹çš„è¯ï¼Œé‚£ä¹ˆ Spring Boot å°†è‡ªåŠ¨æä¾›ä¸€ä¸ª<code>ErrorAttributes</code> çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ <code>DefaultErrorAttributes </code></p><p>åŸºäºæ­¤ ï¼Œå¼€å‘è€…è‡ªå®šä¹‰ <code>ErrorAttributes </code>æœ‰ä¸¤ç§æ–¹å¼ ï¼š</p><ul><li>ç›´æ¥å®ç° <code>ErrorAttributes </code>æ¥å£</li><li>ç»§æ‰¿ <code>DefaultErrorAttributes</code>ï¼ˆæ¨èï¼‰ï¼Œå› ä¸º<code>DefaultErrorAttributes</code>ä¸­å¯¹å¼‚å¸¸æ•°æ®çš„å¤„ç†å·²ç»å®Œæˆï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li></ul><p>å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyErrorAttributes</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultErrorAttributes</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getErrorAttributes</span><span class="hljs-params">(WebRequest webRequest, <span class="hljs-keyword">boolean</span> includeStackTrace)</span> </span>&#123;        Map&lt;String, Object&gt; map = <span class="hljs-keyword">super</span>.getErrorAttributes(webRequest, includeStackTrace);        <span class="hljs-keyword">if</span> ((Integer)map.get(<span class="hljs-string">&quot;status&quot;</span>) == <span class="hljs-number">500</span>) &#123;            map.put(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯!&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> map;    &#125;&#125;</code></pre></div><p>å®šä¹‰å¥½çš„<code>ErrorAttributes</code>ä¸€å®šè¦æ³¨å†Œæˆä¸€ä¸ª Bean ï¼Œè¿™æ ·ï¼ŒSpring Boot å°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„ <code>DefaultErrorAttributes </code>äº†ï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-5-20210525153453655.png" alt="img"></p><h3 id="4-4-è‡ªå®šä¹‰å¼‚å¸¸è§†å›¾"><a href="#4-4-è‡ªå®šä¹‰å¼‚å¸¸è§†å›¾" class="headerlink" title="4.4 è‡ªå®šä¹‰å¼‚å¸¸è§†å›¾"></a>4.4 è‡ªå®šä¹‰å¼‚å¸¸è§†å›¾</h3><p>å¼‚å¸¸è§†å›¾é»˜è®¤å°±æ˜¯å‰é¢æ‰€è¯´çš„é™æ€æˆ–è€…åŠ¨æ€é¡µé¢ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œé¦–å…ˆ ï¼Œé»˜è®¤çš„å¼‚å¸¸è§†å›¾åŠ è½½é€»è¾‘åœ¨ <code>org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController </code>ç±»çš„ <code>errorHtml </code>æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥è¿”å›å¼‚å¸¸é¡µé¢+æ•°æ®ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ª error æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥è¿”å›å¼‚å¸¸æ•°æ®ï¼ˆå¦‚æœæ˜¯ ajax è¯·æ±‚ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šè¢«è§¦å‘ï¼‰ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">errorHtml</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">                HttpServletResponse response)</span> </span>&#123;        HttpStatus status = getStatus(request);        Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(                        request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));        response.setStatus(status.value());        ModelAndView modelAndView = resolveErrorView(request, response, status, model);        <span class="hljs-keyword">return</span> (modelAndView != <span class="hljs-keyword">null</span>) ? modelAndView : <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;error&quot;</span>, model);&#125;</code></pre></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ ï¼Œé¦–å…ˆä¼šé€šè¿‡ <code>getErrorAttributes</code> æ–¹æ³•å»è·å–å¼‚å¸¸æ•°æ®ï¼ˆå®é™…ä¸Šä¼šè°ƒç”¨åˆ° <code>ErrorAttributes </code>çš„å®ä¾‹ çš„ <code>getErrorAttributes </code>æ–¹æ³•ï¼‰ï¼Œç„¶åè°ƒç”¨<code> resolveErrorView</code> å»åˆ›å»ºä¸€ä¸ª<code> ModelAndView</code> ï¼Œå¦‚æœè¿™é‡Œåˆ›å»ºå¤±è´¥ï¼Œé‚£ä¹ˆç”¨æˆ·å°†ä¼šçœ‹åˆ°é»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>resolveErrorView</code>æ–¹æ³•ä¼šæ¥åˆ° <code>DefaultErrorViewResolver </code>ç±»çš„ <code>resolveErrorView</code> æ–¹æ³•ä¸­ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveErrorView</span><span class="hljs-params">(HttpServletRequest request, HttpStatus status,</span></span><span class="hljs-function"><span class="hljs-params">                Map&lt;String, Object&gt; model)</span> </span>&#123;        ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);        <span class="hljs-keyword">if</span> (modelAndView == <span class="hljs-keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;                modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);        &#125;        <span class="hljs-keyword">return</span> modelAndView;&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆä»¥å¼‚å¸¸å“åº”ç ä½œä¸ºè§†å›¾ååˆ†åˆ«å»æŸ¥æ‰¾åŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œåˆ™å†ä»¥ 4xx æˆ–è€… 5xx ä½œä¸ºè§†å›¾åå†å»åˆ†åˆ«æŸ¥æ‰¾åŠ¨æ€æˆ–è€…é™æ€é¡µé¢ã€‚</p><p>è¦è‡ªå®šä¹‰å¼‚å¸¸è§†å›¾è§£æï¼Œä¹Ÿå¾ˆå®¹æ˜“ ï¼Œç”±äº<code>DefaultErrorViewResolver</code>æ˜¯åœ¨<code> ErrorMvcAutoConfiguration</code> ç±»ä¸­æä¾›çš„å®ä¾‹ï¼Œå³å¼€å‘è€…æ²¡æœ‰æä¾›ç›¸å…³å®ä¾‹æ—¶ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„ <code>DefaultErrorViewResolver </code>ï¼Œå¼€å‘è€…æä¾›äº†è‡ªå·±çš„<code> ErrorViewResolver</code> å®ä¾‹åï¼Œé»˜è®¤çš„é…ç½®å°±ä¼šå¤±æ•ˆï¼Œå› æ­¤ï¼Œè‡ªå®šä¹‰å¼‚å¸¸è§†å›¾ï¼Œåªéœ€è¦æä¾› ä¸€ä¸ª <code>ErrorViewResolver </code>çš„å®ä¾‹å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyErrorViewResolver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultErrorViewResolver</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyErrorViewResolver</span><span class="hljs-params">(ApplicationContext applicationContext, ResourceProperties resourceProperties)</span> </span>&#123;        <span class="hljs-keyword">super</span>(applicationContext, resourceProperties);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveErrorView</span><span class="hljs-params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;/aaa/123&quot;</span>, model);    &#125;&#125;</code></pre></div><p>å®é™…ä¸Šï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå®šä¹‰å¼‚å¸¸æ•°æ®ï¼ˆç›´æ¥åœ¨<code> resolveErrorView</code> æ–¹æ³•é‡æ–°å®šä¹‰ä¸€ä¸ª model ï¼Œå°†å‚æ•°ä¸­çš„model æ•°æ®æ‹·è´è¿‡å»å¹¶ä¿®æ”¹ï¼Œæ³¨æ„å‚æ•°ä¸­çš„ model ç±»å‹ä¸º <code>UnmodifiableMap</code>ï¼Œå³ä¸å¯ä»¥ç›´æ¥ä¿®æ”¹ï¼‰ï¼Œè€Œä¸éœ€è¦è‡ªå®šä¹‰<code>MyErrorAttributes</code>ã€‚å®šä¹‰å®Œæˆåï¼Œæä¾›ä¸€ä¸ªåä¸º123çš„è§†å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/4-6-20210525153453660.png" alt="img"></p><p>å¦‚æ­¤ä¹‹åï¼Œé”™è¯¯è¯•å›¾å°±ç®—å®šä¹‰æˆåŠŸäº†ã€‚</p><h2 id="5-CORSè§£å†³è·¨åŸŸ"><a href="#5-CORSè§£å†³è·¨åŸŸ" class="headerlink" title="5. CORSè§£å†³è·¨åŸŸ"></a>5. CORSè§£å†³è·¨åŸŸ</h2><blockquote><p>åŸŸï¼šåè®®+åŸŸå/IP/ç«¯å£</p></blockquote><h3 id="5-1-åŒæºç­–ç•¥"><a href="#5-1-åŒæºç­–ç•¥" class="headerlink" title="5.1 åŒæºç­–ç•¥"></a>5.1 åŒæºç­–ç•¥</h3><p>å¾ˆå¤šäººå¯¹è·¨åŸŸæœ‰ä¸€ç§è¯¯è§£ï¼Œä»¥ä¸ºè¿™æ˜¯å‰ç«¯çš„äº‹ï¼Œå’Œåç«¯æ²¡å…³ç³»ï¼Œå…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œè¯´åˆ°è·¨åŸŸï¼Œå°±ä¸å¾—ä¸è¯´è¯´æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚<br>åŒæºç­–ç•¥æ˜¯ç”±Netscapeæå‡ºçš„ä¸€ä¸ªè‘—åçš„å®‰å…¨ç­–ç•¥ï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œç°åœ¨æ‰€æœ‰æ”¯æŒJavaScriptçš„æµè§ˆå™¨éƒ½ä¼šä½¿ç”¨è¿™ä¸ªç­–ç•¥ã€‚æ‰€è°“åŒæºæ˜¯æŒ‡åè®®ã€åŸŸåä»¥åŠç«¯å£è¦ç›¸åŒã€‚åŒæºç­–ç•¥æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘æå‡ºæ¥çš„ï¼Œè¿™ä¸ªç­–ç•¥æœ¬èº«æ²¡é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå„ç§åŸå› åˆç»å¸¸æœ‰è·¨åŸŸçš„éœ€æ±‚ï¼Œä¼ ç»Ÿçš„è·¨åŸŸæ–¹æ¡ˆæ˜¯JSONPï¼ŒJSONPè™½ç„¶èƒ½è§£å†³è·¨åŸŸä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å±€é™æ€§ï¼Œé‚£å°±æ˜¯åªæ”¯æŒGETè¯·æ±‚ï¼Œä¸æ”¯æŒå…¶ä»–ç±»å‹çš„è¯·æ±‚ï¼Œè€Œä»Šå¤©æˆ‘ä»¬è¯´çš„<strong>CORSï¼ˆè·¨åŸŸæºèµ„æºå…±äº«ï¼‰ï¼ˆCORSï¼ŒCross-origin resource sharingï¼‰</strong>æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå®ƒæ˜¯ä¸€ä»½æµè§ˆå™¨æŠ€æœ¯çš„è§„èŒƒï¼Œæä¾›äº†WebæœåŠ¡ä»ä¸åŒç½‘åŸŸä¼ æ¥æ²™ç›’è„šæœ¬çš„æ–¹æ³•ï¼Œä»¥é¿å¼€æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œè¿™æ˜¯JSONPæ¨¡å¼çš„ç°ä»£ç‰ˆã€‚<br>åœ¨Springæ¡†æ¶ä¸­ï¼Œå¯¹äºCORSä¹Ÿæä¾›äº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹SpringBootä¸­å¦‚ä½•å®ç°CORSã€‚</p><h3 id="5-2-å®è·µ"><a href="#5-2-å®è·µ" class="headerlink" title="5.2 å®è·µ"></a>5.2 å®è·µ</h3><p>é¦–å…ˆåˆ›å»ºä¸¤ä¸ªæ™®é€šçš„SpringBooté¡¹ç›®ï¼Œç¬¬ä¸€ä¸ªå‘½åä¸º<code>provider</code>æä¾›æœåŠ¡ï¼Œç¬¬äºŒä¸ªå‘½åä¸º<code>consumer</code>æ¶ˆè´¹æœåŠ¡ï¼Œç¬¬ä¸€ä¸ªé…ç½®ç«¯å£ä¸º8080ï¼Œç¬¬äºŒä¸ªé…ç½®é…ç½®ä¸º8081ï¼Œç„¶ååœ¨providerä¸Šæä¾›ä¸¤ä¸ªhelloæ¥å£ï¼Œä¸€ä¸ªgetï¼Œä¸€ä¸ªpostï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;    <span class="hljs-meta">@PostMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello2</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post hello&quot;</span>;    &#125;&#125;</code></pre></div><p>åœ¨<code>consumer</code>çš„<code>resources/static</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå‘é€ä¸€ä¸ªç®€å•çš„ajaxè¯·æ±‚ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;btnClick()&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;get_button&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;btnClick2()&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;post_button&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">btnClick</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        $.get(<span class="hljs-string">&#x27;http://localhost:8080/hello&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">            $(<span class="hljs-string">&quot;#app&quot;</span>).html(msg);</span>        &#125;);    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">btnClick2</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        $.post(<span class="hljs-string">&#x27;http://localhost:8080/hello&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">            $(<span class="hljs-string">&quot;#app&quot;</span>).html(msg);</span>        &#125;);    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>ç„¶ååˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®ï¼Œå‘é€è¯·æ±‚æŒ‰é’®ï¼Œè§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">Access to XMLHttpRequest at <span class="hljs-string">&#x27;http://localhost:8080/hello&#x27;</span> from origin <span class="hljs-string">&#x27;http://localhost:8081&#x27;</span> has been blocked by CORS policy: No <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> header is present on the requested resource.</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œè¯·æ±‚æ— æ³•å‘é€æˆåŠŸã€‚</p><p>ä½¿ç”¨CORSå¯ä»¥åœ¨å‰ç«¯ä»£ç ä¸åšä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå®ç°è·¨åŸŸï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çœ‹çœ‹åœ¨providerä¸­å¦‚ä½•é…ç½®ã€‚é¦–å…ˆå¯ä»¥é€šè¿‡<code>@CrossOrigin</code>æ³¨è§£é…ç½®æŸä¸€ä¸ªæ–¹æ³•æ¥å—æŸä¸€ä¸ªåŸŸçš„è¯·æ±‚ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@CrossOrigin(value = &quot;http://localhost:8081&quot;)</span>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;    <span class="hljs-meta">@CrossOrigin(value = &quot;http://localhost:8081&quot;)</span>    <span class="hljs-meta">@PostMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello2</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post hello&quot;</span>;    &#125;&#125;</code></pre></div><p>è¿™ä¸ªæ³¨è§£è¡¨ç¤ºè¿™ä¸¤ä¸ªæ¥å£æ¥å—æ¥è‡ª<a href="http://localhost:8081åœ°å€çš„è¯·æ±‚ï¼Œé…ç½®å®Œæˆåï¼Œé‡å¯providerï¼Œå†æ¬¡å‘é€è¯·æ±‚ï¼Œæµè§ˆå™¨æ§åˆ¶å°å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œconsumerä¹Ÿèƒ½æ‹¿åˆ°æ•°æ®äº†">http://localhost:8081åœ°å€çš„è¯·æ±‚ï¼Œé…ç½®å®Œæˆåï¼Œé‡å¯providerï¼Œå†æ¬¡å‘é€è¯·æ±‚ï¼Œæµè§ˆå™¨æ§åˆ¶å°å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œconsumerä¹Ÿèƒ½æ‹¿åˆ°æ•°æ®äº†</a></p><p>æ­¤æ—¶è§‚å¯Ÿæµè§ˆå™¨è¯·æ±‚ç½‘ç»œæ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°å“åº”å¤´ä¸­å¤šäº†å¦‚ä¸‹ä¿¡æ¯ï¼š<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/w1-1-20210525153453702.png" alt="img"></p><p>è¿™ä¸ªè¡¨ç¤ºæœåŠ¡ç«¯æ„¿æ„æ¥æ”¶æ¥è‡ª<a href="http://localhost:8081çš„è¯·æ±‚ï¼Œæ‹¿åˆ°è¿™ä¸ªä¿¡æ¯åï¼Œæµè§ˆå™¨å°±ä¸ä¼šå†å»é™åˆ¶æœ¬æ¬¡è¯·æ±‚çš„è·¨åŸŸäº†ã€‚">http://localhost:8081çš„è¯·æ±‚ï¼Œæ‹¿åˆ°è¿™ä¸ªä¿¡æ¯åï¼Œæµè§ˆå™¨å°±ä¸ä¼šå†å»é™åˆ¶æœ¬æ¬¡è¯·æ±‚çš„è·¨åŸŸäº†ã€‚</a></p><p>providerä¸Šï¼Œæ¯ä¸€ä¸ªæ–¹æ³•ä¸Šéƒ½å»åŠ æ³¨è§£æœªå…å¤ªéº»çƒ¦äº†ï¼Œåœ¨Spring Bootä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡å…¨å±€é…ç½®ä¸€æ¬¡æ€§è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¨å±€é…ç½®åªéœ€è¦åœ¨é…ç½®ç±»ä¸­é‡å†™<code>addCorsMappings</code>æ–¹æ³•å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>&#123;        registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>)        .allowedOrigins(<span class="hljs-string">&quot;http://localhost:8081&quot;</span>)        .allowedMethods(<span class="hljs-string">&quot;*&quot;</span>)        .allowedHeaders(<span class="hljs-string">&quot;*&quot;</span>);    &#125;  <span class="hljs-comment">//æˆ–è€…</span>      <span class="hljs-meta">@Bean</span>    <span class="hljs-function">CorsFilter <span class="hljs-title">corsFilter</span><span class="hljs-params">()</span> </span>&#123;        UrlBasedCorsConfigurationSource source = <span class="hljs-keyword">new</span> UrlBasedCorsConfigurationSource();        CorsConfiguration cfg = <span class="hljs-keyword">new</span> CorsConfiguration();        cfg.addAllowedOrigin(<span class="hljs-string">&quot;http://localhost:8081&quot;</span>);      <span class="hljs-comment">//å…è®¸optionsæ¢æµ‹è¯·æ±‚</span>        cfg.addAllowedMethod(<span class="hljs-string">&quot;*&quot;</span>);        source.registerCorsConfiguration(<span class="hljs-string">&quot;/**&quot;</span>,cfg);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CorsFilter(source);    &#125;&#125;</code></pre></div><p><code>/**</code>è¡¨ç¤ºæœ¬åº”ç”¨çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¼šå»å¤„ç†è·¨åŸŸè¯·æ±‚ï¼Œ<code>allowedMethods</code>è¡¨ç¤ºå…è®¸é€šè¿‡çš„è¯·æ±‚æ•°ï¼Œ<code>allowedHeaders</code>åˆ™è¡¨ç¤ºå…è®¸çš„è¯·æ±‚å¤´ã€‚ç»è¿‡è¿™æ ·çš„é…ç½®ä¹‹åï¼Œå°±ä¸å¿…åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šå•ç‹¬é…ç½®è·¨åŸŸäº†ã€‚</p><h3 id="5-3-å­˜åœ¨çš„é—®é¢˜"><a href="#5-3-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="5.3 å­˜åœ¨çš„é—®é¢˜"></a>5.3 å­˜åœ¨çš„é—®é¢˜</h3><p>äº†è§£äº†æ•´ä¸ªCORSçš„å·¥ä½œè¿‡ç¨‹ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡Ajaxå‘é€è·¨åŸŸè¯·æ±‚ï¼Œè™½ç„¶ç”¨æˆ·ä½“éªŒæé«˜äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰æ½œåœ¨çš„å¨èƒå­˜åœ¨ï¼Œå¸¸è§çš„å°±æ˜¯CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚è·¨ç«™è¯·æ±‚ä¼ªé€ ä¹Ÿè¢«ç§°ä¸ºone-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸ºCSRFæˆ–è€…XSRFï¼Œæ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><blockquote><p>å‡å¦‚ä¸€å®¶é“¶è¡Œç”¨ä»¥è¿è¡Œè½¬è´¦æ“ä½œçš„URLåœ°å€å¦‚ä¸‹ï¼š<code>http://icbc.com/aa?bb=cc</code>ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªæ¶æ„æ”»å‡»è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šæ”¾ç½®å¦‚ä¸‹ä»£ç ï¼š<code>&lt;img src=&quot;http://icbc.com/aa?bb=cc&quot;&gt;</code>ï¼Œå¦‚æœç”¨æˆ·è®¿é—®äº†æ¶æ„ç«™ç‚¹ï¼Œè€Œå¥¹ä¹‹å‰åˆšè®¿é—®è¿‡é“¶è¡Œä¸ä¹…ï¼Œç™»å½•ä¿¡æ¯å°šæœªè¿‡æœŸï¼Œé‚£ä¹ˆå¥¹å°±ä¼šé­å—æŸå¤±ã€‚</p></blockquote><p>åŸºäºæ­¤ï¼Œæµè§ˆå™¨åœ¨å®é™…æ“ä½œä¸­ï¼Œä¼šå¯¹è¯·æ±‚è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ä¸ºç®€å•è¯·æ±‚ï¼Œé¢„å…ˆè¯·æ±‚ï¼Œå¸¦å‡­è¯çš„è¯·æ±‚ç­‰ï¼Œé¢„å…ˆè¯·æ±‚ä¼šé¦–å…ˆå‘é€ä¸€ä¸ªoptionsæ¢æµ‹è¯·æ±‚ï¼Œå’Œæµè§ˆå™¨è¿›è¡Œåå•†æ˜¯å¦æ¥å—è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹è·¨åŸŸè¯·æ±‚æ˜¯ä¸éœ€è¦å‡­è¯çš„ï¼Œä½†æ˜¯æœåŠ¡ç«¯å¯ä»¥é…ç½®è¦æ±‚å®¢æˆ·ç«¯æä¾›å‡­è¯ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…csrfæ”»å‡»ã€‚</p><h2 id="6-æ‹¦æˆªå™¨"><a href="#6-æ‹¦æˆªå™¨" class="headerlink" title="6. æ‹¦æˆªå™¨"></a>6. æ‹¦æˆªå™¨</h2><p>å’ŒSpringMVCçš„ç”¨æ³•ç›¸åŒ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-comment">//è¯¥æ–¹æ³•è¿”å› falseï¼Œè¯·æ±‚å°†ä¸å†ç»§ç»­å¾€ä¸‹èµ°</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;preHandle&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-comment">//Controller æ‰§è¡Œä¹‹åè¢«è°ƒç”¨</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;postHandle&quot;</span>);    &#125;    <span class="hljs-comment">//preHandle æ–¹æ³•è¿”å› trueï¼ŒafterCompletion æ‰ä¼šæ‰§è¡Œã€‚</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;afterCompletion&quot;</span>);    &#125;&#125;</code></pre></div><p>ä¸å†ç”¨xmlé…ç½®ï¼Œä½¿ç”¨åŸºäºæ³¨è§£çš„é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;        registry.addInterceptor(<span class="hljs-keyword">new</span> MyInterceptor()).addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).excludePathPatterns(<span class="hljs-string">&quot;/hello&quot;</span>);    &#125;&#125;</code></pre></div><p>å°±å¯ä»¥å¯¹Conrollerè¿›è¡Œæ‹¦æˆª</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;hello&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/hello2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello2</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;hello2&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello2&quot;</span>;    &#125;&#125;</code></pre></div><h2 id="7-å®šä¹‰ç³»ç»Ÿå¯åŠ¨ä»»åŠ¡"><a href="#7-å®šä¹‰ç³»ç»Ÿå¯åŠ¨ä»»åŠ¡" class="headerlink" title="7. å®šä¹‰ç³»ç»Ÿå¯åŠ¨ä»»åŠ¡"></a>7. å®šä¹‰ç³»ç»Ÿå¯åŠ¨ä»»åŠ¡</h2><p>åœ¨ Servlet/Jsp é¡¹ç›®ä¸­ï¼Œå¦‚æœæ¶‰åŠåˆ°ç³»ç»Ÿä»»åŠ¡ï¼Œä¾‹å¦‚åœ¨é¡¹ç›®å¯åŠ¨é˜¶æ®µè¦åšä¸€äº›æ•°æ®åˆå§‹åŒ–æ“ä½œï¼Œè¿™äº›æ“ä½œæœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œåªåœ¨é¡¹ç›®å¯åŠ¨æ—¶è¿›è¡Œï¼Œä»¥åéƒ½ä¸å†æ‰§è¡Œï¼Œè¿™é‡Œï¼Œå®¹æ˜“æƒ³åˆ°webåŸºç¡€ä¸­çš„ä¸‰å¤§ç»„ä»¶ï¼ˆ Servletã€Filterã€Listener ï¼‰ä¹‹ä¸€ Listener ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸€èˆ¬å®šä¹‰ä¸€ä¸ª ServletContextListenerï¼Œç„¶åå°±å¯ä»¥ç›‘å¬åˆ°é¡¹ç›®å¯åŠ¨å’Œé”€æ¯ï¼Œè¿›è€Œåšå‡ºç›¸åº”çš„æ•°æ®åˆå§‹åŒ–å’Œé”€æ¯æ“ä½œï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>&#123;        <span class="hljs-comment">//åœ¨è¿™é‡Œåšæ•°æ®åˆå§‹åŒ–æ“ä½œ</span>    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextDestroyed</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>&#123;        <span class="hljs-comment">//åœ¨è¿™é‡Œåšæ•°æ®å¤‡ä»½æ“ä½œ</span>    &#125;&#125;</code></pre></div><p>å½“ç„¶ï¼Œè¿™æ˜¯åŸºç¡€ web é¡¹ç›®çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœä½¿ç”¨äº† Spring Bootï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ä¸ºç®€ä¾¿çš„æ–¹å¼ã€‚Spring Boot ä¸­é’ˆå¯¹ç³»ç»Ÿå¯åŠ¨ä»»åŠ¡æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ CommandLineRunner å’Œ ApplicationRunnerï¼Œåˆ†åˆ«æ¥çœ‹ã€‚</p><h3 id="7-1-CommandLineRunner"><a href="#7-1-CommandLineRunner" class="headerlink" title="7.1 CommandLineRunner"></a>7.1 CommandLineRunner</h3><p>ä½¿ç”¨ CommandLineRunner æ—¶ï¼Œé¦–å…ˆè‡ªå®šä¹‰ MyCommandLineRunner1 å¹¶ä¸”å®ç° CommandLineRunner æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@Order(100)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCommandLineRunner1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandLineRunner</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    &#125;&#125;</code></pre></div><p>å…³äºè¿™æ®µä»£ç ï¼Œæˆ‘åšå¦‚ä¸‹è§£é‡Šï¼š</p><ul><li>é¦–å…ˆé€šè¿‡ <code>@Compoent </code>æ³¨è§£å°† <code>MyCommandLineRunner1 </code>æ³¨å†Œä¸ºSpringå®¹å™¨ä¸­çš„ä¸€ä¸ª Beanã€‚</li><li>æ·»åŠ  <code>@Order</code>æ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªå¯åŠ¨ä»»åŠ¡çš„æ‰§è¡Œä¼˜å…ˆçº§ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¯åŠ¨ä»»åŠ¡å¯èƒ½æœ‰å¤šä¸ªï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªæ’åºã€‚<code>@Order</code> æ³¨è§£ä¸­ï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šå¤§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§çš„å€¼ä¸º<code> Integer.MAX_VALUE</code>ï¼Œè¡¨ç¤ºä¼˜å…ˆçº§æœ€ä½ã€‚</li><li>åœ¨ run æ–¹æ³•ä¸­ï¼Œå†™å¯åŠ¨ä»»åŠ¡çš„æ ¸å¿ƒé€»è¾‘ï¼Œå½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œrunæ–¹æ³•ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œã€‚</li><li>run æ–¹æ³•çš„å‚æ•°ï¼Œæ¥è‡ªäºé¡¹ç›®çš„å¯åŠ¨å‚æ•°ï¼Œå³é¡¹ç›®å…¥å£ç±»ä¸­ï¼Œmainæ–¹æ³•çš„å‚æ•°ä¼šè¢«ä¼ åˆ°è¿™é‡Œã€‚</li></ul><p>æ­¤æ—¶å¯åŠ¨é¡¹ç›®ï¼Œrunæ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œï¼Œè‡³äºå‚æ•°ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ä¼ é€’ï¼Œå¦‚æœæ˜¯åœ¨ IDEA ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥é…ç½®å‚æ•°ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-1-20210523104130918-20210525153453711.png" alt="img"></p><p>å¦ä¸€ç§æ–¹å¼ï¼Œåˆ™æ˜¯å°†é¡¹ç›®æ‰“åŒ…ï¼Œåœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨é¡¹ç›®ï¼Œç„¶åå¯åŠ¨æ—¶åœ¨å‘½ä»¤è¡Œä¼ å…¥å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -jar devtools-0.0.1-SNAPSHOT.jar ä¸‰å›½æ¼”ä¹‰ è¥¿æ¸¸è®°</code></pre></div><p>æ³¨æ„ï¼Œè¿™é‡Œå‚æ•°ä¼ é€’æ—¶æ²¡æœ‰keyï¼Œç›´æ¥å†™valueå³å¯ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-2-20210525153453688.png" alt="img"></p><h3 id="7-2-ApplicationRunner"><a href="#7-2-ApplicationRunner" class="headerlink" title="7.2 ApplicationRunner"></a>7.2 ApplicationRunner</h3><p>ApplicationRunner å’Œ CommandLineRunner åŠŸèƒ½ä¸€è‡´ï¼Œç”¨æ³•ä¹ŸåŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å¯¹å‚æ•°çš„å¤„ç†ä¸Šï¼ŒApplicationRunner å¯ä»¥æ¥æ”¶æ›´å¤šç±»å‹çš„å‚æ•°ï¼ˆApplicationRunner é™¤äº†å¯ä»¥æ¥æ”¶ CommandLineRunner çš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¥æ”¶ key/valueå½¢å¼çš„å‚æ•°ï¼‰ã€‚</p><p>ä½¿ç”¨ ApplicationRunner ï¼Œè‡ªå®šä¹‰ç±»å®ç° ApplicationRunner æ¥å£å³å¯ï¼Œç»„ä»¶æ³¨å†Œä»¥åŠç»„ä»¶ä¼˜å…ˆçº§çš„é…ç½®éƒ½å’Œ CommandLineRunner ä¸€è‡´ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@Order(98)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationRunner1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationRunner</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        List&lt;String&gt; nonOptionArgs = args.getNonOptionArgs();        System.out.println(<span class="hljs-string">&quot;MyApplicationRunner1&gt;&gt;&gt;&quot;</span>+nonOptionArgs);        Set&lt;String&gt; optionNames = args.getOptionNames();        <span class="hljs-keyword">for</span> (String key : optionNames) &#123;            System.out.println(<span class="hljs-string">&quot;MyApplicationRunner1&gt;&gt;&gt;&quot;</span>+key + <span class="hljs-string">&quot;:&quot;</span> + args.getOptionValues(key));        &#125;        String[] sourceArgs = args.getSourceArgs();        System.out.println(<span class="hljs-string">&quot;MyApplicationRunner1&gt;&gt;&gt;&quot;</span>+Arrays.toString(sourceArgs));    &#125;&#125;</code></pre></div><p>å½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œè¿™é‡Œçš„ run æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œï¼Œå…³äº run æ–¹æ³•çš„å‚æ•° ApplicationArguments ï¼Œæˆ‘è¯´å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li><code>args.getNonOptionArgs()</code>;å¯ä»¥ç”¨æ¥è·å–å‘½ä»¤è¡Œä¸­çš„æ— keyå‚æ•°ï¼ˆå’ŒCommandLineRunnerä¸€æ ·ï¼‰ã€‚</li><li><code>args.getOptionNames()</code>;å¯ä»¥ç”¨æ¥è·å–æ‰€æœ‰key/valueå½¢å¼çš„å‚æ•°çš„keyã€‚</li><li><code>args.getOptionValues(key))</code>;å¯ä»¥æ ¹æ®keyè·å–key/value å½¢å¼çš„å‚æ•°çš„valueã€‚</li><li><code>args.getSourceArgs()</code>; åˆ™è¡¨ç¤ºè·å–å‘½ä»¤è¡Œä¸­çš„æ‰€æœ‰å‚æ•°ã€‚</li></ul><p>ApplicationRunner å®šä¹‰å®Œæˆåï¼Œä¼ å¯åŠ¨å‚æ•°ä¹Ÿæ˜¯ä¸¤ç§æ–¹å¼ï¼Œå‚æ•°ç±»å‹ä¹Ÿæœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§å’Œ CommandLineRunner ä¸€è‡´ï¼Œç¬¬äºŒç§åˆ™æ˜¯ â€“key=value çš„å½¢å¼ï¼Œåœ¨ IDEA ä¸­å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-3-20210525153453687.png" alt="img"></p><p>æˆ–è€…ä½¿ç”¨ å¦‚ä¸‹å¯åŠ¨å‘½ä»¤ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -jar devtools-0.0.1-SNAPSHOT.jar ä¸‰å›½æ¼”ä¹‰ è¥¿æ¸¸è®° --age=99</code></pre></div><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-4-20210525153453678.png" alt="img"></p><h2 id="8-å®šæ—¶ä»»åŠ¡"><a href="#8-å®šæ—¶ä»»åŠ¡" class="headerlink" title="8. å®šæ—¶ä»»åŠ¡"></a>8. å®šæ—¶ä»»åŠ¡</h2><p>åœ¨ Spring + SpringMVC ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¦å®ç°å®šæ—¶ä»»åŠ¡ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸­æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ä½¿ç”¨ Spring è‡ªå¸¦çš„å®šæ—¶ä»»åŠ¡å¤„ç†å™¨ @Scheduled æ³¨è§£ï¼Œå¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶ Quartz ï¼ŒSpring Boot æºè‡ª Spring+SpringMVC ï¼Œå› æ­¤å¤©ç„¶å…·å¤‡è¿™ä¸¤ä¸ª Spring ä¸­çš„å®šæ—¶ä»»åŠ¡å®ç°ç­–ç•¥ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒ Quartzï¼Œæœ¬æ–‡æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ Spring Boot ä¸­ä¸¤ç§å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹å¼ã€‚</p><h4 id="8-1-Scheduled"><a href="#8-1-Scheduled" class="headerlink" title="8.1 @Scheduled"></a>8.1 @Scheduled</h4><p>ä½¿ç”¨ @Scheduled éå¸¸å®¹æ˜“ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¹¶ä¸”æ·»åŠ  web ä¾èµ– <code>spring-boot-starter-web</code>ï¼Œé¡¹ç›®åˆ›å»ºæˆåŠŸåï¼Œæ·»åŠ  <code>@EnableScheduling</code> æ³¨è§£ï¼Œå¼€å¯å®šæ—¶ä»»åŠ¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableScheduling</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScheduledApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ScheduledApplication.class, args);    &#125;&#125;</code></pre></div><p>æ¥ä¸‹æ¥é…ç½®å®šæ—¶ä»»åŠ¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Scheduled(fixedRate = 2000)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fixedRate</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">&quot;fixedRate&gt;&gt;&gt;&quot;</span>+<span class="hljs-keyword">new</span> Date());    &#125;<span class="hljs-meta">@Scheduled(fixedDelay = 2000)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fixedDelay</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">&quot;fixedDelay&gt;&gt;&gt;&quot;</span>+<span class="hljs-keyword">new</span> Date());&#125;<span class="hljs-meta">@Scheduled(initialDelay = 2000,fixedDelay = 2000)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialDelay</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">&quot;initialDelay&gt;&gt;&gt;&quot;</span>+<span class="hljs-keyword">new</span> Date());&#125;</code></pre></div><ul><li>é¦–å…ˆä½¿ç”¨ @Scheduled æ³¨è§£å¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ã€‚</li><li>fixedRate è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå…·ä½“æ˜¯æŒ‡ä¸¤æ¬¡ä»»åŠ¡çš„å¼€å§‹æ—¶é—´é—´éš”ï¼Œå³ç¬¬äºŒæ¬¡ä»»åŠ¡å¼€å§‹æ—¶ï¼Œç¬¬ä¸€æ¬¡ä»»åŠ¡å¯èƒ½è¿˜æ²¡ç»“æŸã€‚</li><li>fixedDelay è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå…·ä½“æ˜¯æŒ‡æœ¬æ¬¡ä»»åŠ¡ç»“æŸåˆ°ä¸‹æ¬¡ä»»åŠ¡å¼€å§‹ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚</li><li>initialDelay è¡¨ç¤ºé¦–æ¬¡ä»»åŠ¡å¯åŠ¨çš„å»¶è¿Ÿæ—¶é—´ã€‚</li><li>æ‰€æœ‰æ—¶é—´çš„å•ä½éƒ½æ˜¯æ¯«ç§’ã€‚</li></ul><p>ä¸Šé¢è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬ç”¨æ³•ï¼Œé™¤äº†è¿™å‡ ä¸ªåŸºæœ¬å±æ€§ä¹‹å¤–ï¼Œ@Scheduled æ³¨è§£ä¹Ÿæ”¯æŒ cron è¡¨è¾¾å¼ï¼Œä½¿ç”¨ cron è¡¨è¾¾å¼ï¼Œå¯ä»¥éå¸¸ä¸°å¯Œçš„æè¿°å®šæ—¶ä»»åŠ¡çš„æ—¶é—´ã€‚cron è¡¨è¾¾å¼æ ¼å¼å¦‚ä¸‹ï¼š</p><blockquote><p>[ç§’] [åˆ†] [å°æ—¶] [æ—¥] [æœˆ] [å‘¨] [å¹´]</p></blockquote><p>å…·ä½“å–å€¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">åºå·</th><th align="left">è¯´æ˜</th><th align="left">æ˜¯å¦å¿…å¡«</th><th align="left">å…è®¸å¡«å†™çš„å€¼</th><th align="left">å…è®¸çš„é€šé…ç¬¦</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">ç§’</td><td align="left">æ˜¯</td><td align="left">0-59</td><td align="left">- * /</td></tr><tr><td align="left">2</td><td align="left">åˆ†</td><td align="left">æ˜¯</td><td align="left">0-59</td><td align="left">- * /</td></tr><tr><td align="left">3</td><td align="left">æ—¶</td><td align="left">æ˜¯</td><td align="left">0-23</td><td align="left">- * /</td></tr><tr><td align="left">4</td><td align="left">æ—¥</td><td align="left">æ˜¯</td><td align="left">1-31</td><td align="left">- * ? / L W</td></tr><tr><td align="left">5</td><td align="left">æœˆ</td><td align="left">æ˜¯</td><td align="left">1-12 or JAN-DEC</td><td align="left">- * /</td></tr><tr><td align="left">6</td><td align="left">å‘¨</td><td align="left">æ˜¯</td><td align="left">1-7 or SUN-SAT</td><td align="left">- * ? / L #</td></tr><tr><td align="left">7</td><td align="left">å¹´</td><td align="left">å¦</td><td align="left">1970-2099</td><td align="left">- * /</td></tr></tbody></table><p><strong>è¿™ä¸€å—éœ€è¦å¤§å®¶æ³¨æ„çš„æ˜¯ï¼Œæœˆä»½ä¸­çš„æ—¥æœŸå’Œæ˜ŸæœŸå¯èƒ½ä¼šèµ·å†²çªï¼Œå› æ­¤åœ¨é…ç½®æ—¶è¿™ä¸¤ä¸ªå¾—æœ‰ä¸€ä¸ªæ˜¯ <code>?</code></strong></p><p><strong>é€šé…ç¬¦å«ä¹‰ï¼š</strong></p><ul><li><code>?</code> è¡¨ç¤ºä¸æŒ‡å®šå€¼ï¼Œå³ä¸å…³å¿ƒæŸä¸ªå­—æ®µçš„å–å€¼æ—¶ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœˆä»½ä¸­çš„æ—¥æœŸå’Œæ˜ŸæœŸå¯èƒ½ä¼šèµ·å†²çªï¼Œå› æ­¤åœ¨é…ç½®æ—¶è¿™ä¸¤ä¸ªå¾—æœ‰ä¸€ä¸ªæ˜¯ <code>?</code></li><li><code>*</code> è¡¨ç¤ºæ‰€æœ‰å€¼ï¼Œä¾‹å¦‚:åœ¨ç§’çš„å­—æ®µä¸Šè®¾ç½® <code>*</code>,è¡¨ç¤ºæ¯ä¸€ç§’éƒ½ä¼šè§¦å‘</li><li><code>,</code> ç”¨æ¥åˆ†å¼€å¤šä¸ªå€¼ï¼Œä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½® â€œMON,WED,FRIâ€ è¡¨ç¤ºå‘¨ä¸€ï¼Œå‘¨ä¸‰å’Œå‘¨äº”è§¦å‘</li><li><code>-</code> è¡¨ç¤ºåŒºé—´ï¼Œä¾‹å¦‚åœ¨ç§’ä¸Šè®¾ç½® â€œ10-12â€,è¡¨ç¤º 10,11,12ç§’éƒ½ä¼šè§¦å‘</li><li><code>/</code> ç”¨äºé€’å¢è§¦å‘ï¼Œå¦‚åœ¨ç§’ä¸Šé¢è®¾ç½®â€5/15â€ è¡¨ç¤ºä»5ç§’å¼€å§‹ï¼Œæ¯å¢15ç§’è§¦å‘(5,20,35,50)</li><li><code>#</code> åºå·(è¡¨ç¤ºæ¯æœˆçš„ç¬¬å‡ ä¸ªå‘¨å‡ )ï¼Œä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½®â€6#3â€è¡¨ç¤ºåœ¨æ¯æœˆçš„ç¬¬ä¸‰ä¸ªå‘¨å…­ï¼Œ(ç”¨ åœ¨æ¯äº²èŠ‚å’Œçˆ¶äº²èŠ‚å†åˆé€‚ä¸è¿‡äº†)</li><li>å‘¨å­—æ®µçš„è®¾ç½®ï¼Œè‹¥ä½¿ç”¨è‹±æ–‡å­—æ¯æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ ï¼Œå³ MON ä¸monç›¸åŒ</li><li><code>L</code> è¡¨ç¤ºæœ€åçš„æ„æ€ã€‚åœ¨æ—¥å­—æ®µè®¾ç½®ä¸Šï¼Œè¡¨ç¤ºå½“æœˆçš„æœ€åä¸€å¤©(ä¾æ®å½“å‰æœˆä»½ï¼Œå¦‚æœæ˜¯äºŒæœˆè¿˜ä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦æ˜¯æ¶¦å¹´), åœ¨å‘¨å­—æ®µä¸Šè¡¨ç¤ºæ˜ŸæœŸå…­ï¼Œç›¸å½“äºâ€7â€æˆ–â€SATâ€ï¼ˆæ³¨æ„å‘¨æ—¥ç®—æ˜¯ç¬¬ä¸€å¤©ï¼‰ã€‚å¦‚æœåœ¨â€Lâ€å‰åŠ ä¸Šæ•°å­—ï¼Œåˆ™è¡¨ç¤ºè¯¥æ•°æ®çš„æœ€åä¸€ä¸ªã€‚ä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½®â€6Lâ€è¿™æ ·çš„æ ¼å¼,åˆ™è¡¨ç¤ºâ€æœ¬æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”â€</li><li><code>W</code> è¡¨ç¤ºç¦»æŒ‡å®šæ—¥æœŸçš„æœ€è¿‘å·¥ä½œæ—¥(å‘¨ä¸€è‡³å‘¨äº”)ï¼Œä¾‹å¦‚åœ¨æ—¥å­—æ®µä¸Šè®¾ç½®â€15Wâ€ï¼Œè¡¨ç¤ºç¦»æ¯æœˆ15å·æœ€è¿‘çš„é‚£ä¸ªå·¥ä½œæ—¥è§¦å‘ã€‚å¦‚æœ15å·æ­£å¥½æ˜¯å‘¨å…­ï¼Œåˆ™æ‰¾æœ€è¿‘çš„å‘¨äº”(14å·)è§¦å‘, å¦‚æœ15å·æ˜¯å‘¨æœªï¼Œåˆ™æ‰¾æœ€è¿‘çš„ä¸‹å‘¨ä¸€(16å·)è§¦å‘ï¼Œå¦‚æœ15å·æ­£å¥½åœ¨å·¥ä½œæ—¥(å‘¨ä¸€è‡³å‘¨äº”)ï¼Œåˆ™å°±åœ¨è¯¥å¤©è§¦å‘ã€‚å¦‚æœæŒ‡å®šæ ¼å¼ä¸º â€œ1Wâ€,å®ƒåˆ™è¡¨ç¤ºæ¯æœˆ1å·å¾€åæœ€è¿‘çš„å·¥ä½œæ—¥è§¦å‘ã€‚å¦‚æœ1å·æ­£æ˜¯å‘¨å…­ï¼Œåˆ™å°†åœ¨3å·ä¸‹å‘¨ä¸€è§¦å‘ã€‚(æ³¨ï¼Œâ€Wâ€å‰åªèƒ½è®¾ç½®å…·ä½“çš„æ•°å­—,ä¸å…è®¸åŒºé—´â€-â€œ)</li><li><code>L</code> å’Œ <code>W</code> å¯ä»¥ä¸€ç»„åˆä½¿ç”¨ã€‚å¦‚æœåœ¨æ—¥å­—æ®µä¸Šè®¾ç½®â€LWâ€,åˆ™è¡¨ç¤ºåœ¨æœ¬æœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥è§¦å‘(ä¸€èˆ¬æŒ‡å‘å·¥èµ„ )</li></ul><p>ä¾‹å¦‚ï¼Œåœ¨ @Scheduled æ³¨è§£ä¸­æ¥ä¸€ä¸ªç®€å•çš„ cron è¡¨è¾¾å¼ï¼Œæ¯éš”5ç§’è§¦å‘ä¸€æ¬¡ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Scheduled(cron = &quot;0/5 * * * * *&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cron</span><span class="hljs-params">()</span> </span>&#123;    System.out.println(<span class="hljs-keyword">new</span> Date());&#125;</code></pre></div><p>ä¸Šé¢ä»‹ç»çš„æ˜¯ä½¿ç”¨ @Scheduled æ³¨è§£çš„æ–¹å¼æ¥å®ç°å®šæ—¶ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Quartz å®ç°å®šæ—¶ä»»åŠ¡ã€‚</p><h4 id="8-2-Quartz"><a href="#8-2-Quartz" class="headerlink" title="8.2 Quartz"></a>8.2 Quartz</h4><p>ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ï¼Œé™¤éå®šæ—¶ä»»åŠ¡æ¶‰åŠåˆ°çš„ä¸šåŠ¡å®åœ¨æ˜¯å¤ªç®€å•ï¼Œä½¿ç”¨ @Scheduled æ³¨è§£æ¥è§£å†³å®šæ—¶ä»»åŠ¡ï¼Œå¦åˆ™å¤§éƒ¨åˆ†æƒ…å†µå¯èƒ½éƒ½æ˜¯ä½¿ç”¨ Quartz æ¥åšå®šæ—¶ä»»åŠ¡ã€‚åœ¨ Spring Boot ä¸­ä½¿ç”¨ Quartz ï¼Œåªéœ€è¦åœ¨åˆ›å»ºé¡¹ç›®æ—¶ï¼Œæ·»åŠ  Quartz ä¾èµ–å³å¯ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/6-1.png" alt="img"></p><p>é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œä¹Ÿéœ€è¦æ·»åŠ å¼€å¯å®šæ—¶ä»»åŠ¡çš„æ³¨è§£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableScheduling</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuartzApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(QuartzApplication.class, args);    &#125;&#125;</code></pre></div><p>Quartz åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯JobDetailï¼ˆè¦åšçš„äº‹æƒ…ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯è§¦å‘å™¨ï¼ˆä»€ä¹ˆæ—¶å€™åšï¼‰ï¼Œè¦å®šä¹‰ JobDetailï¼Œéœ€è¦å…ˆå®šä¹‰ Jobï¼ŒJob çš„å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œç›´æ¥å®šä¹‰ä¸€ä¸ªBeanï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyJob1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyJob1&gt;&gt;&gt;&quot;</span>+<span class="hljs-keyword">new</span> Date());    &#125;&#125;</code></pre></div><p>å…³äºè¿™ç§å®šä¹‰æ–¹å¼è¯´ä¸¤ç‚¹ï¼š</p><ol><li>é¦–å…ˆå°†è¿™ä¸ª Job æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</li><li>è¿™ç§å®šä¹‰æ–¹å¼æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯æ— æ³•ä¼ å‚ã€‚</li></ol><p>ç¬¬äºŒç§å®šä¹‰æ–¹å¼ï¼Œåˆ™æ˜¯ç»§æ‰¿ QuartzJobBean å¹¶å®ç°é»˜è®¤çš„æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyJob2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">QuartzJobBean</span> </span>&#123;    HelloService helloService;    <span class="hljs-function"><span class="hljs-keyword">public</span> HelloService <span class="hljs-title">getHelloService</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> helloService;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHelloService</span><span class="hljs-params">(HelloService helloService)</span> </span>&#123;        <span class="hljs-keyword">this</span>.helloService = helloService;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">executeInternal</span><span class="hljs-params">(JobExecutionContext jobExecutionContext)</span> <span class="hljs-keyword">throws</span> JobExecutionException </span>&#123;        helloService.sayHello();    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;hello service &gt;&gt;&gt;&quot;</span>+<span class="hljs-keyword">new</span> Date());    &#125;&#125;</code></pre></div><p>å’Œç¬¬1ç§æ–¹å¼ç›¸æ¯”ï¼Œè¿™ç§æ–¹å¼æ”¯æŒä¼ å‚ï¼Œä»»åŠ¡å¯åŠ¨æ—¶ï¼ŒexecuteInternal æ–¹æ³•å°†ä¼šè¢«æ‰§è¡Œã€‚</p><p>Job æœ‰äº†ä¹‹åï¼Œæ¥ä¸‹æ¥åˆ›å»ºç±»ï¼Œé…ç½® JobDetail å’Œ Trigger è§¦å‘å™¨ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuartzConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">MethodInvokingJobDetailFactoryBean <span class="hljs-title">methodInvokingJobDetailFactoryBean</span><span class="hljs-params">()</span> </span>&#123;        MethodInvokingJobDetailFactoryBean bean = <span class="hljs-keyword">new</span> MethodInvokingJobDetailFactoryBean();        bean.setTargetBeanName(<span class="hljs-string">&quot;myJob1&quot;</span>);        bean.setTargetMethod(<span class="hljs-string">&quot;sayHello&quot;</span>);        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">JobDetailFactoryBean <span class="hljs-title">jobDetailFactoryBean</span><span class="hljs-params">()</span> </span>&#123;        JobDetailFactoryBean bean = <span class="hljs-keyword">new</span> JobDetailFactoryBean();        bean.setJobClass(MyJob2.class);        JobDataMap map = <span class="hljs-keyword">new</span> JobDataMap();        map.put(<span class="hljs-string">&quot;helloService&quot;</span>, helloService());        bean.setJobDataMap(map);        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SimpleTriggerFactoryBean <span class="hljs-title">simpleTriggerFactoryBean</span><span class="hljs-params">()</span> </span>&#123;        SimpleTriggerFactoryBean bean = <span class="hljs-keyword">new</span> SimpleTriggerFactoryBean();        bean.setStartTime(<span class="hljs-keyword">new</span> Date());        bean.setRepeatCount(<span class="hljs-number">5</span>);        bean.setJobDetail(methodInvokingJobDetailFactoryBean().getObject());        bean.setRepeatInterval(<span class="hljs-number">3000</span>);        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">CronTriggerFactoryBean <span class="hljs-title">cronTrigger</span><span class="hljs-params">()</span> </span>&#123;        CronTriggerFactoryBean bean = <span class="hljs-keyword">new</span> CronTriggerFactoryBean();        bean.setCronExpression(<span class="hljs-string">&quot;0/10 * * * * ?&quot;</span>);        bean.setJobDetail(jobDetailFactoryBean().getObject());        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SchedulerFactoryBean <span class="hljs-title">schedulerFactoryBean</span><span class="hljs-params">()</span> </span>&#123;        SchedulerFactoryBean bean = <span class="hljs-keyword">new</span> SchedulerFactoryBean();        bean.setTriggers(cronTrigger().getObject(), simpleTriggerFactoryBean().getObject());        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">HelloService <span class="hljs-title">helloService</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HelloService();    &#125;&#125;</code></pre></div><p>å…³äºè¿™ä¸ªé…ç½®è¯´å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>JobDetail çš„é…ç½®æœ‰ä¸¤ç§æ–¹å¼ï¼šMethodInvokingJobDetailFactoryBean å’Œ JobDetailFactoryBean ã€‚</li><li>ä½¿ç”¨ MethodInvokingJobDetailFactoryBean å¯ä»¥é…ç½®ç›®æ ‡ Bean çš„åå­—å’Œç›®æ ‡æ–¹æ³•çš„åå­—ï¼Œè¿™ç§æ–¹å¼ä¸æ”¯æŒä¼ å‚ã€‚</li><li>ä½¿ç”¨ JobDetailFactoryBean å¯ä»¥é…ç½® JobDetail ï¼Œä»»åŠ¡ç±»ç»§æ‰¿è‡ª QuartzJobBean ï¼Œè¿™ç§æ–¹å¼æ”¯æŒä¼ å‚ï¼Œå°†å‚æ•°å°è£…åœ¨ JobDataMap ä¸­è¿›è¡Œä¼ é€’ã€‚</li><li>Trigger æ˜¯æŒ‡è§¦å‘å™¨ï¼ŒQuartz ä¸­å®šä¹‰äº†å¤šä¸ªè§¦å‘å™¨ï¼Œè¿™é‡Œå‘å¤§å®¶å±•ç¤ºå…¶ä¸­ä¸¤ç§çš„ç”¨æ³•ï¼ŒSimpleTrigger å’Œ CronTrigger ã€‚</li><li>SimpleTrigger æœ‰ç‚¹ç±»ä¼¼äºå‰é¢è¯´çš„ @Scheduled çš„åŸºæœ¬ç”¨æ³•ã€‚</li><li>CronTrigger åˆ™æœ‰ç‚¹ç±»ä¼¼äº @Scheduled ä¸­ cron è¡¨è¾¾å¼çš„ç”¨æ³•ã€‚</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/6-2.png" alt="img"></p><h2 id="9-WebåŸºç¡€ç»„ä»¶"><a href="#9-WebåŸºç¡€ç»„ä»¶" class="headerlink" title="9. WebåŸºç¡€ç»„ä»¶"></a>9. WebåŸºç¡€ç»„ä»¶</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebListener</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RequestContextListener</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestInitialized</span><span class="hljs-params">(ServletRequestEvent requestEvent)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;requestInitialized&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent requestEvent)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;requestDestroyed&quot;</span>);    &#125;&#125;<span class="hljs-meta">@WebServlet(urlPatterns = &quot;/hello&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doPost(req,resp);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyServlet&quot;</span>);    &#125;&#125;<span class="hljs-comment">//å¯åŠ¨ç±»</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@ServletComponentScan(&quot;org.javaboy.webcomponent&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebcomponentApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(WebcomponentApplication.class, args);    &#125;&#125;</code></pre></div><p>å…³äºè¿‡æ»¤å™¨ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨æ‹¦æˆªå™¨ï¼Œä½†è¿™é‡Œè¿˜æ˜¯å¯¹è¿‡æ»¤å™¨è¿›è¡Œä¸€å®šçš„è¯´æ˜</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åŸºç¡€ç”¨æ³•</span><span class="hljs-meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyFilter&quot;</span>);        chain.doFilter(request,response);    &#125;&#125;<span class="hljs-comment">//è®¾ç½®ä¼˜å…ˆçº§éœ€è¦ç”¨å½“åŸºç¡€ç»„ä»¶å¤„ç†</span><span class="hljs-meta">@Component</span><span class="hljs-comment">//æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span><span class="hljs-meta">@Order(101)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter02</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyFilter02&quot;</span>);        chain.doFilter(request, response);    &#125;&#125;<span class="hljs-comment">//ä¸Šè¿°è¿‡æ»¤å™¨2æ— æ³•æŒ‡å®šæ‹¦æˆªurlï¼Œéœ€è¦æ›´æ¢é…ç½®</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter03</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyFilter04&quot;</span>);        chain.doFilter(request, response);    &#125;&#125;<span class="hljs-comment">//é’ˆå¯¹03å¯¹åº”çš„é…ç½®ç±»</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilterConfiguration</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">FilterRegistrationBean&lt;MyFilter03&gt; <span class="hljs-title">filter03FilterRegistrationBean03</span><span class="hljs-params">()</span> </span>&#123;        FilterRegistrationBean&lt;MyFilter03&gt; bean = <span class="hljs-keyword">new</span> FilterRegistrationBean&lt;&gt;();        bean.setOrder(<span class="hljs-number">90</span>);        bean.setFilter(<span class="hljs-keyword">new</span> MyFilter03());        bean.setUrlPatterns(Arrays.asList(<span class="hljs-string">&quot;/*&quot;</span>));        <span class="hljs-keyword">return</span> bean;    &#125;&#125;</code></pre></div><h2 id="10-AOP"><a href="#10-AOP" class="headerlink" title="10.  AOP"></a>10.  AOP</h2><p>Springä¸­å·²ç»å¯¹[AOPæ³¨è§£ç¼–ç¨‹](#6. åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹)è¿›è¡Œäº†è®²è§£ï¼Œè¿™é‡Œåšä¸€å®šçš„è¡¥å……</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//UserService</span><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUserById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;getUserById&quot;</span>);        <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user&quot;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;delete id:&quot;</span> + id);    &#125;&#125;<span class="hljs-comment">//LogAspect</span><span class="hljs-meta">@Component</span><span class="hljs-meta">@Aspect</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogAspect</span> </span>&#123;    <span class="hljs-meta">@Pointcut(&quot;execution(* org.javaboy.aop.service.*.*(..))&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pc1</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-meta">@Before(&quot;pc1()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">(JoinPoint jp)</span> </span>&#123;        String name = jp.getSignature().getName();        System.out.println(name + <span class="hljs-string">&quot; æ–¹æ³•å¼€å§‹æ‰§è¡Œäº†...&quot;</span>);    &#125;    <span class="hljs-meta">@After(&quot;pc1()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">after</span><span class="hljs-params">(JoinPoint jp)</span> </span>&#123;        String name = jp.getSignature().getName();        System.out.println(name + <span class="hljs-string">&quot; æ–¹æ³•æ‰§è¡Œç»“æŸäº†...&quot;</span>);    &#125;    <span class="hljs-meta">@AfterReturning(value = &quot;pc1()&quot;, returning = &quot;s&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterReturning</span><span class="hljs-params">(JoinPoint jp, String s)</span> </span>&#123;        String name = jp.getSignature().getName();        System.out.println(name + <span class="hljs-string">&quot; æ–¹æ³•çš„è¿”å›å€¼æ˜¯ &quot;</span> + s);    &#125;    <span class="hljs-meta">@AfterThrowing(value = &quot;pc1()&quot;, throwing = &quot;e&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterThrowing</span><span class="hljs-params">(JoinPoint jp, Exception e)</span> </span>&#123;        String name = jp.getSignature().getName();        System.out.println(name + <span class="hljs-string">&quot; æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ &quot;</span> + e.getMessage());    &#125;    <span class="hljs-meta">@Around(&quot;pc1()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> </span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//ç±»ä¼¼äºåå°„ä¸­çš„ invoke æ–¹æ³•</span>            Object proceed = pjp.proceed();            <span class="hljs-keyword">return</span> proceed;        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;            throwable.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><h2 id="11-æ•´åˆSwagger"><a href="#11-æ•´åˆSwagger" class="headerlink" title="11. æ•´åˆSwagger"></a>11. æ•´åˆSwagger</h2><h3 id="11-1-å¼•è¨€"><a href="#11-1-å¼•è¨€" class="headerlink" title="11.1 å¼•è¨€"></a>11.1 å¼•è¨€</h3><blockquote><p>ç›¸ä¿¡æ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯åç«¯å¼€å‘ï¼Œéƒ½æˆ–å¤šæˆ–å°‘åœ°è¢«æ¥å£æ–‡æ¡£æŠ˜ç£¨è¿‡ã€‚å‰ç«¯ç»å¸¸æŠ±æ€¨åç«¯ç»™çš„æ¥å£æ–‡æ¡£å’Œå®é™…æƒ…å†µä¸ä¸€è‡´ã€‚åç«¯åˆè§‰å¾—ç¼–å†™åŠç»´æŠ¤æ¥å£æ–‡æ¡£ä¼šè€—è´¹ä¸å°‘ç²¾åŠ›ï¼Œç»å¸¸æ¥ä¸åŠæ›´æ–°ã€‚å…¶å®æ— è®ºæ˜¯å‰ç«¯è°ƒç”¨åç«¯ï¼Œè¿˜æ˜¯åç«¯è°ƒç”¨å‰ç«¯ï¼Œéƒ½æœŸæœ›æœ‰ä¸€ä¸ªå¥½çš„æ¥å£æ–‡æ¡£ã€‚ä½†æ˜¯è¿™ä¸ªæ¥å£æ–‡æ¡£å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œå°±è·Ÿæ³¨é‡Šä¸€æ ·ï¼Œç»å¸¸è¿˜ä¼šæŠ±æ€¨åˆ«äººå†™çš„ä»£ç æ²¡æœ‰å†™æ³¨é‡Šï¼Œç„¶è€Œè‡ªå·±å†™èµ·ä»£ç æ¥ï¼Œæœ€è®¨åŒçš„ä¹Ÿæ˜¯å†™æ³¨é‡Šã€‚æ‰€ä»¥ä»…ä»…åªå¬è¿‡å¼ºåˆ¶äº†æ¥è§„èŒƒå¤§å®¶æ˜¯ä¸å¤Ÿçš„ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œç‰ˆæœ¬è¿­ä»£ï¼Œæ¥å£æ–‡æ¡£å¾€å¾€å¾ˆå®¹æ˜“å°±è·Ÿä¸ä¸Šä»£ç äº†</p></blockquote><h3 id="11-2-ä»€ä¹ˆæ˜¯Swagger"><a href="#11-2-ä»€ä¹ˆæ˜¯Swagger" class="headerlink" title="11.2  ä»€ä¹ˆæ˜¯Swagger"></a>11.2  ä»€ä¹ˆæ˜¯Swagger</h3><blockquote><p>å‘ç°äº†ç—›ç‚¹å°±è¦å»æ‰¾è§£å†³æ–¹æ¡ˆã€‚è§£å†³æ–¹æ¡ˆç”¨çš„äººå¤šäº†ï¼Œå°±æˆäº†æ ‡å‡†çš„è§„èŒƒï¼Œè¿™å°±æ˜¯ Swagger çš„ç”±æ¥ã€‚é€šè¿‡è¿™å¥—è§„èŒƒï¼Œä½ åªéœ€è¦æŒ‰ç…§å®ƒçš„è§„èŒƒå»å®šä¹‰æ¥å£åŠæ¥å£ç›¸å…³ä¿¡æ¯ã€‚å†é€šè¿‡ Swagger è¡ç”Ÿå‡ºæ¥çš„ä¸€ç³»åˆ—é¡¹ç›®å’Œå·¥å…·ï¼Œå°±å¯ä»¥åšåˆ°ç”Ÿæˆå„ç§æ ¼å¼çš„æ¥å£æ–‡æ¡£ï¼Œç”Ÿæˆå¤šåšè¯­è¨€çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ï¼Œä»¥åŠåœ¨çº¿æ¥å£è°ƒè¯•é¡µé¢ç­‰ç­‰ã€‚è¿™æ ·ï¼Œå¦‚æœæŒ‰ç…§æ–°çš„å¼€å‘æœ¨äº‹ï¼Œåœ¨å¼€å‘æ–°ç‰ˆæœ¬æˆ–è€…è¿­ä»£ç‰ˆæœ¬çš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–° Swagger æè¿°æ–‡ä»¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£å’Œå®¢æˆ·ç«¯ä»£ç ï¼Œåšåˆ°è°ƒç”¨ç«¯ä»£ç ã€æœåŠ¡ç«¯ä»£ç ä»¥åŠæ¥å£æ–‡æ¡£çš„ä¸€è‡´æ€§ã€‚ ä½†å³ä¾¿å¦‚æ­¤ï¼Œå¯¹äºè®¸å¤šå¼€å‘æ¥è¯´ï¼Œç¼–å†™è¿™ä¸ª yml æˆ– json æ ¼å¼çš„æè¿°æ–‡ä»¶ï¼Œæœ¬èº«ä¹Ÿæ˜¯æœ‰ä¸€å®šè´Ÿæ‹…çš„å·¥ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨åé¢æŒç»­è¿­ä»£å¼€å‘çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå¿½ç•¥æ›´æ–°è¿™ä¸ªæè¿°æ–‡ä»¶ï¼Œç›´æ¥æ›´æ”¹ä»£ç ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œè¿™ä¸ªæè¿°æ–‡ä»¶ä¹Ÿå’Œå®é™…é¡¹ç›®æ¸è¡Œæ¸è¿œï¼ŒåŸºäºè¯¥æè¿°æ–‡ä»¶ç”Ÿæˆçš„æ¥å£æ–‡æ¡£ä¹Ÿå¤±å»äº†å‚è€ƒæ„ä¹‰ã€‚<code>æ‰€ä»¥ä½œä¸º Java ç•ŒæœåŠ¡ç«¯çš„å¤§ä¸€ç»Ÿæ¡†æ¶ Springï¼Œè¿…é€Ÿå°† Swagger è§„èŒƒçº³å…¥è‡ªèº«çš„æ ‡å‡†ï¼Œå»ºç«‹äº† Spring-swagger é¡¹ç›®ï¼Œåé¢æ”¹æˆäº†ç°åœ¨çš„ Springfoxã€‚é€šè¿‡åœ¨é¡¹ç›®ä¸­å¼•å…¥ Springfoxï¼Œå¯ä»¥æ‰«æç›¸å…³çš„ä»£ç ï¼Œç”Ÿæˆè¯¥æè¿°æ–‡ä»¶ï¼Œè¿›è€Œç”Ÿæˆä¸ä»£ç ä¸€è‡´çš„æ¥å£æ–‡æ¡£å’Œå®¢æˆ·ç«¯ä»£ç ã€‚</code>è¿™ç§é€šè¿‡ä»£ç ç”Ÿæˆæ¥å£æ–‡æ¡£çš„å½¢å¼ï¼Œåœ¨åé¢éœ€æ±‚æŒç»­è¿­ä»£çš„é¡¹ç›®ä¸­ï¼Œæ˜¾å¾—å°¤ä¸ºé‡è¦å’Œé«˜æ•ˆ</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519160517871.png" alt="image-20210519160517871"></p><p><strong>æ€»ç»“ï¼šSwagger å°±æ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰æ¥å£æ ‡å‡†ï¼Œæ¥å£è§„èŒƒï¼ŒåŒæ—¶èƒ½æ ¹æ®ä½ çš„ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¥å£è¯´æ˜æ–‡æ¡£çš„ä¸€ä¸ªå·¥å…·</strong></p><h3 id="11-3-å®˜æ–¹æä¾›çš„å·¥å…·"><a href="#11-3-å®˜æ–¹æä¾›çš„å·¥å…·" class="headerlink" title="11.3 å®˜æ–¹æä¾›çš„å·¥å…·"></a>11.3 å®˜æ–¹æä¾›çš„å·¥å…·</h3><p><strong>Swagger Codegen</strong>ï¼šé€šè¿‡Codegen å¯ä»¥å°†æè¿°æ–‡ä»¶ç”Ÿæˆ html æ ¼å¼å’Œ cwiki å½¢å¼çš„æ¥å£æ–‡æ¡£ï¼ŒåŒæ—¶ä¹Ÿèƒ½ç”Ÿæˆå¤šç§è¯­è¨€çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä»£ç ã€‚æ”¯æŒé€šè¿‡ jar åŒ…ã€dockerã€node ç­‰æ–¹å¼åœ¨æœ¬åœ°åŒ–æ‰§è¡Œç”Ÿæˆã€‚ä¹Ÿå¯ä»¥åœ¨åé¢çš„ Swagger Editor ä¸­åœ¨çº¿ç”Ÿæˆã€‚ </p><p><strong>Swagger UI</strong>ï¼šæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ UI é¡µé¢å±•ç¤ºæè¿°æ–‡ä»¶ã€‚æ¥å£çš„è°ƒç”¨æ–¹ã€æµ‹è¯•ã€é¡¹ç›®ç»ç†ç­‰éƒ½å¯ä»¥åœ¨è¯¥é¡µé¢ä¸­å¯¹ç›¸å…³æ¥å£è¿›è¡ŒæŸ¥é˜…å’Œåšä¸€äº›ç®€å•çš„æ¥å£è¯·æ±‚ã€‚è¯¥é¡¹ç›®æ”¯æŒåœ¨çº¿å¯¼å…¥æè¿°æ–‡ä»¶å’Œæœ¬åœ°éƒ¨ç½² UI é¡¹ç›®ã€‚ </p><p><strong>Swagger Editor</strong>ï¼šç±»ä¼¼äº Markdown ç¼–è¾‘å™¨çš„ç¼–è¾‘ Swagger æè¿°æ–‡ä»¶çš„ç¼–è¾‘å™¨ï¼Œè¯¥ç¼–è¾‘å™¨æ”¯æŒå®æ—¶é¢„è§ˆæè¿°æ–‡ä»¶çš„æ›´æ–°æ•ˆæœï¼Œä¹Ÿæä¾›äº†åœ¨çº¿ç¼–è¾‘å™¨å’Œæœ¬åœ°éƒ¨ç½²å™¨ä¿©ç§æ–¹å¼ã€‚         </p><p><strong>Swagger Inspector</strong>ï¼šæ„Ÿè§‰å’Œ Postman å·®ä¸å¤šï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥å¯¹æ¥å£è¿›è¡Œæµ‹è¯•çš„åœ¨çº¿ç‰ˆçš„ postmanã€‚æ¯”å¦‚åœ¨ Swagger UI é‡Œé¢åšæ¥å£è¯·æ±‚ï¼Œä¼šè¿”å›æ›´å¤šçš„ä¿¡æ¯ï¼Œä¹Ÿä¼šä¿å­˜ä½ è¯·æ±‚çš„å®é™…è¯·æ±‚å‚æ•°ç­‰æ•°æ®ã€‚         </p><p><strong>Swagger Hub</strong>ï¼šé›†æˆäº†ä¸Šé¢æ‰€æœ‰é¡¹ç›®çš„å„ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥ä»¥é¡¹ç›®å’Œç‰ˆæœ¬ä¸ºå•ä½ï¼Œå°†ä½ çš„æè¿°æ–‡ä»¶ä¸Šä¼ åˆ° Swagger Hub ä¸­ã€‚åœ¨ Swagger Hub ä¸­å¯ä»¥å®Œæˆä¸Šé¢é¡¹ç›®çš„æ‰€æœ‰å·¥ä½œï¼Œéœ€è¦æ³¨å†Œè´¦å·ï¼Œåˆ†å…è´¹ç‰ˆå’Œæ”¶è´¹ç‰ˆã€‚         </p><p><strong>Springfox Swagger</strong>ï¼šSpring åŸºäº Swagger è§„èŒƒï¼Œå¯ä»¥å°†åŸºäº SpringMVC å’Œ Spring Boot é¡¹ç›®çš„é¡¹ç›®ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæˆ JSON æ ¼å¼çš„æè¿°æ–‡ä»¶ã€‚æœ¬èº«ä¸æ˜¯å±äº Swagger å®˜ç½‘æä¾›çš„ï¼Œåœ¨è¿™é‡Œåˆ—å‡ºæ¥åšä¸ªè¯´æ˜ï¼Œæ–¹ä¾¿åé¢ä½œä¸€ä¸ªä½¿ç”¨çš„å±•å¼€ã€‚</p><h3 id="11-4-æ„å»º-Swagger-ä¸-Spring-Boot-ç¯å¢ƒ"><a href="#11-4-æ„å»º-Swagger-ä¸-Spring-Boot-ç¯å¢ƒ" class="headerlink" title="11.4 æ„å»º Swagger ä¸ Spring Boot ç¯å¢ƒ"></a>11.4 æ„å»º Swagger ä¸ Spring Boot ç¯å¢ƒ</h3><h4 id="11-4-1-å¼•å…¥ä¾èµ–"><a href="#11-4-1-å¼•å…¥ä¾èµ–" class="headerlink" title="11.4.1 å¼•å…¥ä¾èµ–"></a>11.4.1 å¼•å…¥ä¾èµ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="11-4-2-ç¼–å†™-Swagger-é…ç½®ç±»"><a href="#11-4-2-ç¼–å†™-Swagger-é…ç½®ç±»" class="headerlink" title="11.4.2 ç¼–å†™ Swagger é…ç½®ç±»"></a>11.4.2 ç¼–å†™ Swagger é…ç½®ç±»</h4><blockquote><p>è¿™ä¸ªé…ç½®ç±»åŸºæœ¬éƒ½æ˜¯ä¸å˜çš„</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;<span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;<span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;<span class="hljs-keyword">import</span> springfox.documentation.service.Contact;<span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;<span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;<span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableSwagger2</span>  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">createRestApi</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)                .pathMapping(<span class="hljs-string">&quot;/&quot;</span>)                .select()                <span class="hljs-comment">// æ‰«æå“ªä¸ªæ¥å£çš„åŒ…</span>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.example.controller&quot;</span>))                .paths(PathSelectors.any())                .build().apiInfo(<span class="hljs-keyword">new</span> ApiInfoBuilder()                        .title(<span class="hljs-string">&quot;æ ‡é¢˜: SpringBoot æ•´åˆ Swagger ä½¿ç”¨&quot;</span>)                        .description(<span class="hljs-string">&quot;è¯¦ç»†ä¿¡æ¯: SpringBoot æ•´åˆ Swagger,è¯¦ç»†ä¿¡æ¯......&quot;</span>)                        <span class="hljs-comment">// ç‰ˆæœ¬ä¿¡æ¯</span>                        .version(<span class="hljs-string">&quot;1.1&quot;</span>)                        <span class="hljs-comment">// å¼€å‘æ–‡æ¡£çš„è”ç³»äºº</span>                    .contact(<span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;lucifer&quot;</span>, <span class="hljs-string">&quot;https://lucifer2u.github.io&quot;</span>,<span class="hljs-string">&quot;xiaoweliangx@gmail.com&quot;</span>))                        .license(<span class="hljs-string">&quot;This Baidu License&quot;</span>)                        .licenseUrl(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)                        .build());    &#125;&#125;</code></pre></div><h4 id="11-4-3-å¯åŠ¨-SpringBoot-é¡¹ç›®"><a href="#11-4-3-å¯åŠ¨-SpringBoot-é¡¹ç›®" class="headerlink" title="11.4.3 å¯åŠ¨ SpringBoot é¡¹ç›®"></a>11.4.3 å¯åŠ¨ SpringBoot é¡¹ç›®</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519162040084.png" alt="image-20210519162040084"></p><h4 id="11-4-4-è®¿é—®-Swagger-çš„-UI-ç•Œé¢"><a href="#11-4-4-è®¿é—®-Swagger-çš„-UI-ç•Œé¢" class="headerlink" title="11.4.4 è®¿é—® Swagger çš„ UI ç•Œé¢"></a>11.4.4 è®¿é—® Swagger çš„ UI ç•Œé¢</h4><p>è®¿é—® Swagger æä¾›çš„ UI ç•Œé¢ï¼š<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519162204984.png" alt="image-20210519162204984"></p><h3 id="11-5-ä½¿ç”¨-Swagger-æ„å»º"><a href="#11-5-ä½¿ç”¨-Swagger-æ„å»º" class="headerlink" title="11.5 ä½¿ç”¨ Swagger æ„å»º"></a>11.5 ä½¿ç”¨ Swagger æ„å»º</h3><h4 id="11-5-1-å¼€å‘-Controller-æ¥å£"><a href="#11-5-1-å¼€å‘-Controller-æ¥å£" class="headerlink" title="11.5.1 å¼€å‘ Controller æ¥å£"></a>11.5.1 å¼€å‘ Controller æ¥å£</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<span class="hljs-keyword">import</span> java.util.HashMap;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/findAll&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>&#123;        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;æŸ¥è¯¢æ‰€æœ‰æ•°æ®æˆåŠŸ&quot;</span>);        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-keyword">true</span>);        <span class="hljs-keyword">return</span> map;    &#125;&#125;</code></pre></div><h4 id="11-5-2-é‡å¯é¡¹ç›®è®¿é—®æ¥å£ç•Œé¢"><a href="#11-5-2-é‡å¯é¡¹ç›®è®¿é—®æ¥å£ç•Œé¢" class="headerlink" title="11.5.2 é‡å¯é¡¹ç›®è®¿é—®æ¥å£ç•Œé¢"></a>11.5.2 é‡å¯é¡¹ç›®è®¿é—®æ¥å£ç•Œé¢</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519162452762.png" alt="image-20210519162452762"></p><h3 id="11-6-Swagger-æ³¨è§£"><a href="#11-6-Swagger-æ³¨è§£" class="headerlink" title="11.6 Swagger æ³¨è§£"></a>11.6 Swagger æ³¨è§£</h3><h4 id="11-6-1-Api"><a href="#11-6-1-Api" class="headerlink" title="11.6.1 @Api"></a>11.6.1 @Api</h4><blockquote><p>ä½œç”¨ï¼šç”¨æ¥æŒ‡å®šæ¥å£çš„æè¿°æ–‡å­—<br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨ç±»ä¸Š</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-meta">@Api(tags = &quot;ç”¨æˆ·æœåŠ¡ç›¸å…³æ¥å£æå™&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;....&#125;</code></pre></div><h4 id="11-6-2-ApiOperation"><a href="#11-6-2-ApiOperation" class="headerlink" title="11.6.2 @ApiOperation"></a>11.6.2 @ApiOperation</h4><blockquote><p>ä½œç”¨ï¼šç”¨æ¥å¯¹æ¥å£ä¸­å…·ä½“æ–¹æ³•åšæå™<br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨æ–¹æ³•ä¸Š</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/findAll&quot;)</span><span class="hljs-meta">@ApiOperation(value = &quot;æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·æ¥å£&quot;,</span><span class="hljs-meta">        notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;æå™:&lt;/span&gt;&amp;nbsp;&amp;nbsp;ç”¨æ¥æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯çš„æ¥å£&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>&#123;    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;æŸ¥è¯¢æ‰€æœ‰æ•°æ®æˆåŠŸ&quot;</span>);    map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-keyword">true</span>);    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><h4 id="11-6-3-ApiImplicitParams"><a href="#11-6-3-ApiImplicitParams" class="headerlink" title="11.6.3 @ApiImplicitParams"></a>11.6.3 @ApiImplicitParams</h4><blockquote><p>ä½œç”¨ï¼šç”¨æ¥æ¥å£ä¸­å‚æ•°è¿›è¡Œè¯´æ˜<br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨æ–¹æ³•ä¸Š</p></blockquote><h5 id="æ™®é€šå‚æ•°ä½¿ç”¨"><a href="#æ™®é€šå‚æ•°ä½¿ç”¨" class="headerlink" title="æ™®é€šå‚æ•°ä½¿ç”¨"></a>æ™®é€šå‚æ•°ä½¿ç”¨</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;save&quot;)</span><span class="hljs-meta">@ApiOperation(value = &quot;ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ¥å£&quot;,</span><span class="hljs-meta">        notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;æå™:&lt;/span&gt;&amp;nbsp;&amp;nbsp;ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„æ¥å£&quot;)</span><span class="hljs-meta">@ApiImplicitParams(&#123;</span><span class="hljs-meta">        @ApiImplicitParam(name = &quot;id&quot;, value = &quot;ç”¨æˆ· id&quot;, dataType = &quot;String&quot;, defaultValue = &quot;21&quot;),</span><span class="hljs-meta">        @ApiImplicitParam(name = &quot;name&quot;, value = &quot;ç”¨æˆ·å§“å&quot;, dataType = &quot;String&quot;, defaultValue = &quot;lucifer&quot;)</span><span class="hljs-meta">&#125;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">save</span><span class="hljs-params">(String id, String name)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + id);    System.out.println(<span class="hljs-string">&quot;name = &quot;</span> + name);    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;id&quot;</span>, id);    map.put(<span class="hljs-string">&quot;name&quot;</span>, name);    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519163323183.png" alt="image-20210519163323183"></p><h5 id="RestFul-é£æ ¼ä½¿ç”¨"><a href="#RestFul-é£æ ¼ä½¿ç”¨" class="headerlink" title="RestFul é£æ ¼ä½¿ç”¨"></a>RestFul é£æ ¼ä½¿ç”¨</h5><blockquote><p>å¦‚æœä½¿ç”¨çš„æ˜¯ RestFul é£æ ¼è¿›è¡Œä¼ å‚ï¼Œå¿…é¡»å†æ·»åŠ ä¸€ä¸ª paramType=â€pathâ€</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;save/&#123;id&#125;/&#123;name&#125;&quot;)</span><span class="hljs-meta">@ApiOperation(value = &quot;ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ¥å£&quot;,</span><span class="hljs-meta">        notes = &quot;&lt;span style=&#x27;color:red;&#x27;&gt;æå™:&lt;/span&gt;&amp;nbsp;&amp;nbsp;ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„æ¥å£&quot;)</span><span class="hljs-meta">@ApiImplicitParams(&#123;</span><span class="hljs-meta">        @ApiImplicitParam(name = &quot;id&quot;, value = &quot;ç”¨æˆ· id&quot;, dataType = &quot;String&quot;, defaultValue = &quot;21&quot;, paramType = &quot;path&quot;),</span><span class="hljs-meta">        @ApiImplicitParam(name = &quot;name&quot;, value = &quot;ç”¨æˆ·å§“å&quot;, dataType = &quot;String&quot;, defaultValue = &quot;lucifer&quot;, paramType = &quot;path&quot;)</span><span class="hljs-meta">&#125;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">save</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> String id,<span class="hljs-meta">@PathVariable(&quot;name&quot;)</span> String name)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + id);    System.out.println(<span class="hljs-string">&quot;name = &quot;</span> + name);    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;id&quot;</span>, id);    map.put(<span class="hljs-string">&quot;name&quot;</span>, name);    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519163641192.png" alt="image-20210519163641192"></p><h5 id="JSON-æ ¼å¼ä½¿ç”¨"><a href="#JSON-æ ¼å¼ä½¿ç”¨" class="headerlink" title="JSON æ ¼å¼ä½¿ç”¨"></a>JSON æ ¼å¼ä½¿ç”¨</h5><p>å¦‚æœæ˜¯ <code>RequestBody</code> çš„æ–¹å¼ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ¥æ”¶</p><p><strong>å®šä¹‰ä¸€ä¸ª User å¯¹è±¡</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> String id;    <span class="hljs-keyword">private</span> String name;&#125;</code></pre></div><p><strong>ç¼–å†™ Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;save2&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">save2</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + user.getId());    System.out.println(<span class="hljs-string">&quot;name = &quot;</span> + user.getName());    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;id&quot;</span>, user.getId());    map.put(<span class="hljs-string">&quot;name&quot;</span>, user.getName());    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519163919745.png" alt="image-20210519163919745"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210519164215434.png" alt="image-20210519164215434"></p><h4 id="11-6-4-ApiResponses"><a href="#11-6-4-ApiResponses" class="headerlink" title="11.6.4 @ApiResponses"></a>11.6.4 @ApiResponses</h4><blockquote><p>ä½œç”¨ï¼šç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å“åº”<br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨æ–¹æ³•ä¸Š</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;save2&quot;)</span><span class="hljs-meta">@ApiResponses(&#123;</span><span class="hljs-meta">        @ApiResponse(code = 404, message = &quot;è¯·æ±‚è·¯å¾„ä¸å¯¹&quot;),</span><span class="hljs-meta">        @ApiResponse(code = 400, message = &quot;ç¨‹åºä¸å¯¹&quot;)</span><span class="hljs-meta">&#125;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">save2</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + user.getId());    System.out.println(<span class="hljs-string">&quot;name = &quot;</span> + user.getName());    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;id&quot;</span>, user.getId());    map.put(<span class="hljs-string">&quot;name&quot;</span>, user.getName());    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70.png" alt="img"></p><h4 id="11-6-5-ApiModel"><a href="#11-6-5-ApiModel" class="headerlink" title="11.6.5 @ApiModel"></a>11.6.5 @ApiModel</h4><p>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚ä¸Šæ–‡çš„æ›´æ–°æ¥å£ï¼‰ï¼Œå¯¹äºå‚æ•°çš„æè¿°ä¹Ÿå¯ä»¥æ”¾åœ¨å®ä½“ç±»ä¸­ã€‚ä¾‹å¦‚ä¸‹é¢ä¸€æ®µä»£ç ï¼š </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ApiModel(value = &quot;ç”¨æˆ·å®ä½“ç±»&quot;ï¼Œ description= &quot;å®šä¹‰äº†ç”¨æˆ·æ‰€æœ‰å±æ€§&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-meta">@ApiModelProperty(value = &quot;ç”¨æˆ·id&quot;)</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@ApiModelProperty(value = &quot;ç”¨æˆ·å&quot;)</span>    <span class="hljs-keyword">private</span> String username;    <span class="hljs-meta">@ApiModelProperty(value = &quot;ç”¨æˆ·åœ°å€&quot;)</span>    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//getter/setter</span>&#125;</code></pre></div><h3 id="11-7-åœ¨Securityä¸­çš„é…ç½®"><a href="#11-7-åœ¨Securityä¸­çš„é…ç½®" class="headerlink" title="11.7 åœ¨Securityä¸­çš„é…ç½®"></a>11.7 åœ¨Securityä¸­çš„é…ç½®</h3><p>å¦‚æœæˆ‘ä»¬çš„Spring Booté¡¹ç›®ä¸­é›†æˆäº†Spring Securityï¼Œé‚£ä¹ˆå¦‚æœä¸åšé¢å¤–é…ç½®ï¼ŒSwagger2æ–‡æ¡£å¯èƒ½ä¼šè¢«æ‹¦æˆªï¼Œæ­¤æ—¶åªéœ€è¦åœ¨Spring Securityçš„é…ç½®ç±»ä¸­é‡å†™configureæ–¹æ³•ï¼Œæ·»åŠ å¦‚ä¸‹è¿‡æ»¤å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    web.ignoring()            .antMatchers(<span class="hljs-string">&quot;/swagger-ui.html&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/v2/**&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/swagger-resources/**&quot;</span>);&#125;</code></pre></div><h3 id="11-8-Swagger-3-0"><a href="#11-8-Swagger-3-0" class="headerlink" title="11.8 Swagger 3.0"></a>11.8 Swagger 3.0</h3><p>åœ¨ 3.0 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦äº†ï¼Œä¸€ä¸ª starter å°±å¯ä»¥æå®šï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å’Œ Spring Boot ä¸­çš„å…¶ä»– starter ä¸€æ ·ï¼Œspringfox-boot-starter ä¾èµ–å¯ä»¥å®ç°é›¶é…ç½®ä»¥åŠè‡ªåŠ¨é…ç½®æ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æ²¡æœ‰å…¶ä»–ç‰¹æ®Šéœ€æ±‚ï¼ŒåŠ ä¸€ä¸ªè¿™ä¸ªä¾èµ–å°±è¡Œäº†ï¼Œæ¥å£æ–‡æ¡£å°±è‡ªåŠ¨ç”Ÿæˆäº†ã€‚</p><p><strong>æ¥å£åœ°å€</strong></p><p>3.0 ä¸­çš„æ¥å£åœ°å€ä¹Ÿå’Œä¹‹å‰æœ‰æ‰€ä¸åŒï¼Œä»¥å‰åœ¨ 2.9.2 ä¸­æˆ‘ä»¬ä¸»è¦è®¿é—®ä¸¤ä¸ªåœ°å€ï¼š</p><ul><li>æ–‡æ¡£æ¥å£åœ°å€ï¼š<a href="http://localhost:8080/v2/api-docs">http://localhost:8080/v2/api-docs</a></li><li>æ–‡æ¡£é¡µé¢åœ°å€ï¼š<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></li></ul><p>ç°åœ¨åœ¨ 3.0 ä¸­ï¼Œè¿™ä¸¤ä¸ªåœ°å€ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼š</p><ul><li>æ–‡æ¡£æ¥å£åœ°å€ï¼š<a href="http://localhost:8080/v3/api-docs">http://localhost:8080/v3/api-docs</a></li><li>æ–‡æ¡£é¡µé¢åœ°å€ï¼š<a href="http://localhost:8080/swagger-ui/index.html">http://localhost:8080/swagger-ui/index.html</a></li></ul><p>ç‰¹åˆ«æ˜¯æ–‡æ¡£é¡µé¢åœ°å€ï¼Œå¦‚æœç”¨äº† 3.0ï¼Œè€Œå»è®¿é—®ä¹‹å‰çš„é¡µé¢ï¼Œä¼šæŠ¥ 404</p><p><strong>æ³¨è§£</strong></p><p>æ—§çš„æ³¨è§£è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä¸è¿‡åœ¨ 3.0 ä¸­è¿˜æä¾›äº†ä¸€äº›å…¶ä»–æ³¨è§£ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @EnableOpenApi ä»£æ›¿ä»¥å‰æ—§ç‰ˆæœ¬ä¸­çš„ @EnableSwagger2ã€‚</p><p>è¯æ˜¯è¿™ä¹ˆè¯´ï¼Œä¸è¿‡æ¾å“¥åœ¨å®é™…ä½“éªŒä¸­ï¼Œæ„Ÿè§‰ @EnableOpenApi æ³¨è§£çš„åŠŸèƒ½ä¸æ˜æ˜¾ï¼ŒåŠ ä¸åŠ éƒ½è¡Œã€‚ç¿»äº†ä¸‹æºç ï¼Œ@EnableOpenApi æ³¨è§£ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºäº†å¯¼å…¥ OpenApiDocumentationConfiguration é…ç½®ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Retention(value = java.lang.annotation.RetentionPolicy.RUNTIME)</span><span class="hljs-meta">@Target(value = &#123;java.lang.annotation.ElementType.TYPE&#125;)</span><span class="hljs-meta">@Documented</span><span class="hljs-meta">@Import(OpenApiDocumentationConfiguration.class)</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableOpenApi &#123;&#125;</code></pre></div><p>ç„¶åæˆ‘åˆçœ‹äº†ä¸‹è‡ªåŠ¨åŒ–é…ç½®ç±» OpenApiAutoConfigurationï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableConfigurationProperties(SpringfoxConfigurationProperties.class)</span><span class="hljs-meta">@ConditionalOnProperty(value = &quot;springfox.documentation.enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span><span class="hljs-meta">@Import(&#123;</span><span class="hljs-meta">    OpenApiDocumentationConfiguration.class,</span><span class="hljs-meta">    SpringDataRestConfiguration.class,</span><span class="hljs-meta">    BeanValidatorPluginsConfiguration.class,</span><span class="hljs-meta">    Swagger2DocumentationConfiguration.class,</span><span class="hljs-meta">    SwaggerUiWebFluxConfiguration.class,</span><span class="hljs-meta">    SwaggerUiWebMvcConfiguration.class</span><span class="hljs-meta">&#125;)</span><span class="hljs-meta">@AutoConfigureAfter(&#123; WebMvcAutoConfiguration.class, JacksonAutoConfiguration.class,</span><span class="hljs-meta">    HttpMessageConvertersAutoConfiguration.class, RepositoryRestMvcAutoConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OpenApiAutoConfiguration</span> </span>&#123;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè‡ªåŠ¨åŒ–é…ç½®ç±»é‡Œè¾¹ä¹Ÿå¯¼å…¥äº† OpenApiDocumentationConfigurationã€‚</p><p>æ‰€ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®é™…ä¸Šä¸éœ€è¦æ·»åŠ  @EnableOpenApi æ³¨è§£ã€‚</p><p>æ ¹æ® OpenApiAutoConfiguration ä¸Šçš„ @ConditionalOnProperty æ¡ä»¶æ³¨è§£ä¸­çš„å®šä¹‰ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœåœ¨ application.properties ä¸­è®¾ç½® <code>springfox.documentation.enabled=false</code>ï¼Œå³å…³é—­äº† swagger åŠŸèƒ½ï¼Œæ­¤æ—¶è‡ªåŠ¨åŒ–é…ç½®ç±»å°±ä¸æ‰§è¡Œäº†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ @EnableOpenApi æ³¨è§£å¯¼å…¥ OpenApiDocumentationConfiguration é…ç½®ç±»ã€‚æŠ€æœ¯ä¸Šæ¥è¯´é€»è¾‘æ˜¯è¿™æ ·ï¼Œä¸è¿‡åº”ç”¨ä¸­æš‚æœªå‘ç°è¿™æ ·çš„éœ€æ±‚ï¼ˆå³åœ¨ application.properties ä¸­å…³é—­ swaggerï¼Œå†é€šè¿‡ @EnableOpenApi æ³¨è§£å¼€å¯ï¼‰ã€‚</p><p>å¦å¤–ï¼Œä»¥å‰æˆ‘ä»¬ç”¨çš„ @ApiResponses/@ApiResponse æ³¨è§£ï¼Œåœ¨ 3.0 ä¸­åå­—æ²¡å˜ï¼Œä½†æ˜¯æ‰€åœ¨çš„åŒ…å˜äº†ï¼Œå°ä¼™ä¼´ä»¬ä½¿ç”¨æ—¶æ³¨æ„å¯¼åŒ…é—®é¢˜å“¦ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹‹å‰ç”¨çš„ @ApiOperation æ³¨è§£åœ¨ 3.0 ä¸­å¯ä»¥ä½¿ç”¨ @Operation ä»£æ›¿ã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€äº›æ–°æ³¨è§£å¦‚ @Parameterã€@Parametersã€@Schema ç­‰ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œä¸å¦‚æ—§çš„ç”¨çš„èˆ’æœï¼Œè¿™äº›æ–°æ³¨è§£å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œå°è¯•ä¸‹ã€‚</p><h2 id="12-æ•°æ®æ ¡éªŒ"><a href="#12-æ•°æ®æ ¡éªŒ" class="headerlink" title="12. æ•°æ®æ ¡éªŒ"></a>12. æ•°æ®æ ¡éªŒ</h2><p><strong>ä¾èµ–å¼•å…¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶ ValidationMessages.properties</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">user.name.size</span>=<span class="hljs-string">name xxx</span><span class="hljs-meta">user.address.notnull</span>=<span class="hljs-string">address xxx</span><span class="hljs-meta">user.age.min</span>=<span class="hljs-string">age xxx</span><span class="hljs-meta">user.age.max</span>=<span class="hljs-string">age xxx</span><span class="hljs-meta">user.email.notnull</span>=<span class="hljs-string">email xxx</span><span class="hljs-meta">user.email.pattern</span>=<span class="hljs-string">email xxx</span></code></pre></div><p>åˆ†ç»„æ ¡éªŒï¼Œé¦–å…ˆéœ€è¦å®šä¹‰æ ¡éªŒç»„ï¼Œæ‰€è°“çš„æ ¡éªŒç»„ï¼Œå…¶å®å°±æ˜¯<strong>ç©ºæ¥å£</strong>ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ValidationGroup1</span> </span>&#123;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ValidationGroup2</span> </span>&#123;&#125;</code></pre></div><p><strong>å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-meta">@Size(min = 5,max = 8,message = &quot;&#123;user.name.size&#125;&quot;,groups = ValidationGroup1.class)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@NotNull(message = &quot;&#123;user.address.notnull&#125;&quot;,groups = ValidationGroup2.class)</span>    <span class="hljs-keyword">private</span> String address;    <span class="hljs-meta">@DecimalMin(value = &quot;1&quot;,message = &quot;&#123;user.age.min&#125;&quot;,groups = &#123;ValidationGroup1.class,ValidationGroup2.class&#125;)</span>    <span class="hljs-meta">@DecimalMax(value = &quot;200&quot;,message = &quot;&#123;user.age.max&#125;&quot;)</span>    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-meta">@NotNull(message = &quot;&#123;user.email.notnull&#125;&quot;)</span>    <span class="hljs-meta">@Email(message = &quot;&#123;user.email.pattern&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String email;&#125;</code></pre></div><p>æ ¡éªŒæ³¨è§£ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>@Null è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º null</li><li>@NotNull è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ä¸º null</li><li>@AssertTrue è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º true</li><li>@AssertFalse è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º false</li><li>@Min(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li>@Max(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li>@DecimalMin(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li>@DecimalMax(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li>@Size(max=, min=) è¢«æ³¨è§£çš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</li><li>@Digits (integer, fraction) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</li><li>@Past è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</li><li>@Future è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</li><li>@Pattern(regex=,flag=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</li><li>@NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº0</li><li>@Email è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€</li><li>@Length(min=,max=) è¢«æ³¨è§£çš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</li><li>@NotEmpty è¢«æ³¨è§£çš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º</li><li>@Range(min=,max=,message=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</li></ul><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@PostMapping(&quot;/user&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUser</span><span class="hljs-params">(<span class="hljs-meta">@Validated(ValidationGroup1.class)</span> User user, BindingResult result)</span> </span>&#123;        <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span> &amp;&amp; result.hasErrors()) &#123;            List&lt;ObjectError&gt; allErrors = result.getAllErrors();            <span class="hljs-keyword">for</span> (ObjectError error : allErrors) &#123;                System.out.println(error.getObjectName() + error.getDefaultMessage());            &#125;        &#125;    &#125;&#125;</code></pre></div><h1 id="SpringBootæ•´åˆæŒä¹…å±‚"><a href="#SpringBootæ•´åˆæŒä¹…å±‚" class="headerlink" title="SpringBootæ•´åˆæŒä¹…å±‚"></a>SpringBootæ•´åˆæŒä¹…å±‚</h1><h2 id="1-æ•´åˆJDBCTemplate"><a href="#1-æ•´åˆJDBCTemplate" class="headerlink" title="1. æ•´åˆJDBCTemplate"></a>1. æ•´åˆJDBCTemplate</h2><p>åœ¨Javaé¢†åŸŸï¼Œæ•°æ®æŒä¹…åŒ–æœ‰å‡ ä¸ªå¸¸è§çš„æ–¹æ¡ˆï¼Œæœ‰Springè‡ªå¸¦çš„JdbcTemplateã€æœ‰MyBatisï¼Œè¿˜æœ‰JPAï¼Œåœ¨è¿™äº›æ–¹æ¡ˆä¸­ï¼Œæœ€ç®€å•çš„å°±æ˜¯Springè‡ªå¸¦çš„JdbcTemplateäº†ï¼Œè¿™ä¸ªä¸œè¥¿è™½ç„¶æ²¡æœ‰MyBatisé‚£ä¹ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æ¯”èµ·æœ€å¼€å§‹çš„Jdbcå·²ç»å¼ºäº†å¾ˆå¤šäº†ï¼Œå®ƒæ²¡æœ‰MyBatisåŠŸèƒ½é‚£ä¹ˆå¼ºå¤§ï¼Œå½“ç„¶ä¹Ÿæ„å‘³ç€å®ƒçš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œäº‹å®ä¸Šï¼ŒJdbcTemplateç®—æ˜¯æœ€ç®€å•çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ</p><h3 id="1-1-åŸºæœ¬é…ç½®"><a href="#1-1-åŸºæœ¬é…ç½®" class="headerlink" title="1.1 åŸºæœ¬é…ç½®"></a>1.1 åŸºæœ¬é…ç½®</h3><p>JdbcTemplateåŸºæœ¬ç”¨æ³•å®é™…ä¸Šå¾ˆç®€å•ï¼Œå¼€å‘è€…åœ¨åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®æ—¶ï¼Œé™¤äº†é€‰æ‹©åŸºæœ¬çš„Webä¾èµ–ï¼Œå†è®°å¾—é€‰ä¸ŠJdbcä¾èµ–ï¼Œä»¥åŠæ•°æ®åº“é©±åŠ¨ä¾èµ–å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/1-1-20210525153228731.png" alt="img"></p><p>é¡¹ç›®åˆ›å»ºæˆåŠŸä¹‹åï¼Œè®°å¾—æ·»åŠ Druidæ•°æ®åº“è¿æ¥æ± ä¾èµ–ï¼ˆæ³¨æ„è¿™é‡Œå¯ä»¥æ·»åŠ ä¸“é—¨ä¸ºSpring Bootæ‰“é€ çš„druid-spring-boot-starterï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¸€èˆ¬åœ¨SSMä¸­æ·»åŠ çš„Druidï¼‰ï¼Œæ‰€æœ‰æ·»åŠ çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>é¡¹ç›®åˆ›å»ºå®Œåï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨application.propertiesä¸­æä¾›æ•°æ®çš„åŸºæœ¬é…ç½®å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=UTF-8</span></code></pre></div><p>å¦‚æ­¤ä¹‹åï¼Œæ‰€æœ‰çš„é…ç½®å°±ç®—å®Œæˆäº†ï¼Œ<strong>æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨JdbcTemplateï¼Œå…¶å®è¿™å°±æ˜¯SpringBootçš„è‡ªåŠ¨åŒ–é…ç½®å¸¦æ¥çš„å¥½å¤„</strong></p><h3 id="1-2-åŸºæœ¬ç”¨æ³•"><a href="#1-2-åŸºæœ¬ç”¨æ³•" class="headerlink" title="1.2 åŸºæœ¬ç”¨æ³•"></a>1.2 åŸºæœ¬ç”¨æ³•</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªUser Beanï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p>ç„¶åæ¥åˆ›å»ºä¸€ä¸ªUserServiceç±»ï¼Œåœ¨UserServiceç±»ä¸­æ³¨å…¥JdbcTemplateï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    JdbcTemplate jdbcTemplate;&#125;</code></pre></div><p>å¥½äº†ï¼Œå¦‚æ­¤ä¹‹åï¼Œå‡†å¤‡å·¥ä½œå°±ç®—å®Œæˆäº†ã€‚</p><h4 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h4><p>JdbcTemplateä¸­ï¼Œé™¤äº†æŸ¥è¯¢æœ‰å‡ ä¸ªAPIä¹‹å¤–ï¼Œå¢åˆ æ”¹ç»Ÿä¸€éƒ½ä½¿ç”¨updateæ¥æ“ä½œï¼Œè‡ªå·±æ¥ä¼ å…¥SQLå³å¯ã€‚ä¾‹å¦‚æ·»åŠ æ•°æ®ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span> </span>&#123;    <span class="hljs-keyword">return</span> jdbcTemplate.update(<span class="hljs-string">&quot;insert into user (username,address) values (?,?);&quot;</span>, user.getUsername(), user.getAddress());&#125;</code></pre></div><p>updateæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯SQLæ‰§è¡Œå—å½±å“çš„è¡Œæ•°ã€‚</p><p>è¿™é‡Œåªéœ€è¦ä¼ å…¥SQLå³å¯ï¼Œå¦‚æœä½ çš„éœ€æ±‚æ¯”è¾ƒå¤æ‚ï¼Œä¾‹å¦‚åœ¨æ•°æ®æ’å…¥çš„è¿‡ç¨‹ä¸­å¸Œæœ›å®ç°ä¸»é”®å›å¡«ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨PreparedStatementCreatorï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">addUser2</span><span class="hljs-params">(User user)</span> </span>&#123;      KeyHolder keyHolder = <span class="hljs-keyword">new</span> GeneratedKeyHolder();    <span class="hljs-keyword">int</span> update = jdbcTemplate.update(<span class="hljs-keyword">new</span> PreparedStatementCreator() &#123;              <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> PreparedStatement <span class="hljs-title">createPreparedStatement</span><span class="hljs-params">(Connection connection)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;            PreparedStatement ps = connection.prepareStatement(<span class="hljs-string">&quot;insert into user (username,address) values (?,?);&quot;</span>, Statement.RETURN_GENERATED_KEYS);            ps.setString(<span class="hljs-number">1</span>, user.getUsername());            ps.setString(<span class="hljs-number">2</span>, user.getAddress());            <span class="hljs-keyword">return</span> ps;        &#125;    &#125;, keyHolder);    user.setId(keyHolder.getKey().longValue());    System.out.println(user);    <span class="hljs-keyword">return</span> update;&#125;</code></pre></div><p>å®é™…ä¸Šè¿™é‡Œå°±ç›¸å½“äºå®Œå…¨ä½¿ç”¨äº†JDBCä¸­çš„è§£å†³æ–¹æ¡ˆäº†ï¼Œé¦–å…ˆåœ¨æ„å»ºPreparedStatementæ—¶ä¼ å…¥Statement.RETURN_GENERATED_KEYSï¼Œç„¶åä¼ å…¥KeyHolderï¼Œæœ€ç»ˆä»KeyHolderä¸­è·å–åˆšåˆšæ’å…¥æ•°æ®çš„idä¿å­˜åˆ°userå¯¹è±¡çš„idå±æ€§ä¸­å»ã€‚</p><p>ä½ èƒ½æƒ³åˆ°çš„JDBCçš„ç”¨æ³•ï¼Œåœ¨è¿™é‡Œéƒ½èƒ½å®ç°ï¼ŒSpringæä¾›çš„JdbcTemplateè™½ç„¶ä¸å¦‚MyBatisï¼Œä½†æ˜¯æ¯”èµ·Jdbcè¿˜æ˜¯è¦æ–¹ä¾¿å¾ˆå¤šçš„ã€‚</p><h4 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h4><p>åˆ é™¤ä¹Ÿæ˜¯ä½¿ç”¨update APIï¼Œä¼ å…¥ä½ çš„SQLå³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Long id)</span> </span>&#123;    <span class="hljs-keyword">return</span> jdbcTemplate.update(<span class="hljs-string">&quot;delete from user where id=?&quot;</span>, id);&#125;</code></pre></div><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨PreparedStatementCreator</p><h4 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateUserById</span><span class="hljs-params">(User user)</span> </span>&#123;    <span class="hljs-keyword">return</span> jdbcTemplate.update(<span class="hljs-string">&quot;update user set username=?,address=? where id=?&quot;</span>, user.getUsername(), user.getAddress(),user.getId());&#125;</code></pre></div><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨PreparedStatementCreator</p><h4 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h4><p>æŸ¥è¯¢çš„è¯ï¼Œç¨å¾®æœ‰ç‚¹å˜åŒ–ï¼Œè¿™é‡Œä¸»è¦å‘å¤§ä¼™ä»‹ç»queryæ–¹æ³•ï¼Œä¾‹å¦‚æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getAllUsers</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> jdbcTemplate.query(<span class="hljs-string">&quot;select * from user&quot;</span>, <span class="hljs-keyword">new</span> RowMapper&lt;User&gt;() &#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet resultSet, <span class="hljs-keyword">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;            String username = resultSet.getString(<span class="hljs-string">&quot;username&quot;</span>);            String address = resultSet.getString(<span class="hljs-string">&quot;address&quot;</span>);            <span class="hljs-keyword">long</span> id = resultSet.getLong(<span class="hljs-string">&quot;id&quot;</span>);            User user = <span class="hljs-keyword">new</span> User();            user.setAddress(address);            user.setUsername(username);            user.setId(id);            <span class="hljs-keyword">return</span> user;        &#125;    &#125;);&#125;</code></pre></div><p>æŸ¥è¯¢çš„æ—¶å€™éœ€è¦æä¾›ä¸€ä¸ªRowMapperï¼Œå°±æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨æ˜ å°„ï¼Œå°†æ•°æ®åº“ä¸­çš„å­—æ®µå’Œå¯¹è±¡çš„å±æ€§ä¸€ä¸€å¯¹åº”èµ·æ¥ï¼Œè¿™æ ·çœ‹èµ·æ¥æœ‰ç‚¹éº»çƒ¦ï¼Œå®é™…ä¸Šï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„å­—æ®µå’Œå¯¹è±¡å±æ€§çš„åå­—ä¸€æ¨¡ä¸€æ ·çš„è¯ï¼Œæœ‰å¦å¤–ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getAllUsers2</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> jdbcTemplate.query(<span class="hljs-string">&quot;select * from user&quot;</span>, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;&gt;(User.class));&#125;</code></pre></div><p>è‡³äºæŸ¥è¯¢æ—¶å€™ä¼ å‚ä¹Ÿæ˜¯ä½¿ç”¨å ä½ç¬¦ï¼Œè¿™ä¸ªå’Œå‰æ–‡çš„ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>é™¤äº†è¿™äº›åŸºæœ¬ç”¨æ³•ä¹‹å¤–ï¼ŒJdbcTemplateä¹Ÿæ”¯æŒå…¶ä»–ç”¨æ³•ï¼Œä¾‹å¦‚è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ç­‰ï¼Œè¿™äº›éƒ½æ¯”è¾ƒå®¹æ˜“ï¼Œè€Œä¸”å’ŒJdbcæœ¬èº«éƒ½æ¯”è¾ƒç›¸ä¼¼ï¼Œè¿™é‡Œä¹Ÿå°±ä¸åšä»‹ç»äº†ï¼Œæœ‰å…´è¶£å¯ä»¥ç•™è¨€è®¨è®ºã€‚</p><h3 id="1-3-åŸç†åˆ†æ"><a href="#1-3-åŸç†åˆ†æ" class="headerlink" title="1.3 åŸç†åˆ†æ"></a>1.3 åŸç†åˆ†æ</h3><p>é‚£ä¹ˆåœ¨SpringBootä¸­ï¼Œé…ç½®å®Œæ•°æ®åº“åŸºæœ¬ä¿¡æ¯ä¹‹åï¼Œå°±æœ‰äº†ä¸€ä¸ªJdbcTemplateäº†ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿæºç åœ¨<code>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</code>ç±»ä¸­ï¼Œè¯¥ç±»æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass(&#123; DataSource.class, JdbcTemplate.class &#125;)</span><span class="hljs-meta">@ConditionalOnSingleCandidate(DataSource.class)</span><span class="hljs-meta">@AutoConfigureAfter(DataSourceAutoConfiguration.class)</span><span class="hljs-meta">@EnableConfigurationProperties(JdbcProperties.class)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateAutoConfiguration</span> </span>&#123;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateConfiguration</span> </span>&#123;<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataSource dataSource;<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcProperties properties;JdbcTemplateConfiguration(DataSource dataSource, JdbcProperties properties) &#123;<span class="hljs-keyword">this</span>.dataSource = dataSource;<span class="hljs-keyword">this</span>.properties = properties;&#125;<span class="hljs-meta">@Bean</span><span class="hljs-meta">@Primary</span><span class="hljs-meta">@ConditionalOnMissingBean(JdbcOperations.class)</span><span class="hljs-function"><span class="hljs-keyword">public</span> JdbcTemplate <span class="hljs-title">jdbcTemplate</span><span class="hljs-params">()</span> </span>&#123;JdbcTemplate jdbcTemplate = <span class="hljs-keyword">new</span> JdbcTemplate(<span class="hljs-keyword">this</span>.dataSource);JdbcProperties.Template template = <span class="hljs-keyword">this</span>.properties.getTemplate();jdbcTemplate.setFetchSize(template.getFetchSize());jdbcTemplate.setMaxRows(template.getMaxRows());<span class="hljs-keyword">if</span> (template.getQueryTimeout() != <span class="hljs-keyword">null</span>) &#123;jdbcTemplate.setQueryTimeout((<span class="hljs-keyword">int</span>) template.getQueryTimeout().getSeconds());&#125;<span class="hljs-keyword">return</span> jdbcTemplate;&#125;&#125;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import(JdbcTemplateConfiguration.class)</span><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamedParameterJdbcTemplateConfiguration</span> </span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-meta">@Primary</span><span class="hljs-meta">@ConditionalOnSingleCandidate(JdbcTemplate.class)</span><span class="hljs-meta">@ConditionalOnMissingBean(NamedParameterJdbcOperations.class)</span><span class="hljs-function"><span class="hljs-keyword">public</span> NamedParameterJdbcTemplate <span class="hljs-title">namedParameterJdbcTemplate</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">JdbcTemplate jdbcTemplate)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NamedParameterJdbcTemplate(jdbcTemplate);&#125;&#125;&#125;</code></pre></div><p>ä»è¿™ä¸ªç±»ä¸­ï¼Œå¤§è‡´å¯ä»¥çœ‹å‡ºï¼Œå½“å½“å‰ç±»è·¯å¾„ä¸‹å­˜åœ¨DataSourceå’ŒJdbcTemplateæ—¶ï¼Œè¯¥ç±»å°±ä¼šè¢«è‡ªåŠ¨é…ç½®ï¼ŒjdbcTemplateæ–¹æ³•åˆ™è¡¨ç¤ºï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è‡ªå·±æä¾›ä¸€ä¸ªJdbcOperationsçš„å®ä¾‹çš„è¯ï¼Œç³»ç»Ÿå°±è‡ªåŠ¨é…ç½®ä¸€ä¸ªJdbcTemplate Beanï¼ˆJdbcTemplateæ˜¯JdbcOperationsæ¥å£çš„ä¸€ä¸ªå®ç°ï¼‰</p><h3 id="1-4-å¤šæ•°æ®æºé…ç½®"><a href="#1-4-å¤šæ•°æ®æºé…ç½®" class="headerlink" title="1.4 å¤šæ•°æ®æºé…ç½®"></a>1.4 å¤šæ•°æ®æºé…ç½®</h3><p>å¤šæ•°æ®æºé…ç½®ä¹Ÿç®—æ˜¯ä¸€ä¸ªå¸¸è§çš„å¼€å‘éœ€æ±‚ï¼ŒSpringå’ŒSpringBootä¸­ï¼Œå¯¹æ­¤éƒ½æœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæœ‰å¤šæ•°æ®æºçš„éœ€æ±‚ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®é¦–é€‰åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶<code>MyCat</code>å»è§£å†³ç›¸å…³é—®é¢˜ï¼Œä¹‹å‰æœ‰å°ä¼™ä¼´åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒä¸Šæé—®ï¼Œä»–çš„æ•°æ®æ ¹æ®æ¡ä»¶çš„ä¸åŒï¼Œå¯èƒ½ä¿å­˜åœ¨å››åå¤šä¸ªä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œæ€ä¹ˆåŠï¼Ÿè¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨å¤šæ•°æ®æºå…¶å®å°±æœ‰äº›è´¹äº‹äº†ï¼Œæˆ‘ç»™çš„å»ºè®®æ˜¯ä½¿ç”¨MyCatï¼Œç„¶ååˆ†è¡¨ç­–ç•¥ä½¿ç”¨sharding-by-intfileã€‚å½“ç„¶å¦‚æœä¸€äº›ç®€å•çš„éœ€æ±‚ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨å¤šæ•°æ®æºçš„ï¼ŒSpring Bootä¸­ï¼ŒJdbcTemplateã€MyBatisä»¥åŠJpaéƒ½å¯ä»¥é…ç½®å¤šæ•°æ®æºï¼Œæœ¬æ–‡å°±å…ˆå’Œå¤§ä¼™èŠä¸€èŠJdbcTemplateä¸­å¤šæ•°æ®æºçš„é…ç½®</p><h4 id="1-4-1-åˆ›å»ºå·¥ç¨‹"><a href="#1-4-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="1.4.1 åˆ›å»ºå·¥ç¨‹"></a>1.4.1 åˆ›å»ºå·¥ç¨‹</h4><p>é¦–å…ˆæ˜¯åˆ›å»ºå·¥ç¨‹ï¼Œå’Œå‰æ–‡ä¸€æ ·ï¼Œåˆ›å»ºå·¥ç¨‹æ—¶ï¼Œä¹Ÿæ˜¯é€‰æ‹©Webã€Jdbcä»¥åŠMySQLé©±åŠ¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/1-1-20210523152539479-20210525153228676.png" alt="img"></p><p>åˆ›å»ºæˆåŠŸä¹‹åï¼Œä¸€å®šæ¥ä¸‹æ¥æ‰‹åŠ¨æ·»åŠ Druidä¾èµ–ï¼Œç”±äºè¿™é‡Œä¸€ä¼šéœ€è¦å¼€å‘è€…è‡ªå·±é…ç½®DataSoruceï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è¦ä½¿ç”¨<code>druid-spring-boot-starter</code>ä¾èµ–ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„é‚£ä¸ªdruidä¾èµ–ï¼Œå› ä¸º<code>druid-spring-boot-starter</code>ä¾èµ–æä¾›äº†DruidDataSourceBuilderç±»ï¼Œè¿™ä¸ªå¯ä»¥ç”¨æ¥æ„å»ºä¸€ä¸ªDataSourceå®ä¾‹ï¼Œè€Œä¼ ç»Ÿçš„Druidåˆ™æ²¡æœ‰è¯¥ç±»ã€‚å®Œæ•´çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="1-4-2-é…ç½®æ•°æ®æº"><a href="#1-4-2-é…ç½®æ•°æ®æº" class="headerlink" title="1.4.2 é…ç½®æ•°æ®æº"></a>1.4.2 é…ç½®æ•°æ®æº</h4><p>æ¥ä¸‹æ¥ï¼Œåœ¨application.propertiesä¸­é…ç½®æ•°æ®æºï¼Œä¸åŒäºä¸Šæ–‡ï¼Œè¿™é‡Œçš„æ•°æ®æºéœ€è¦é…ç½®ä¸¤ä¸ªï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.one.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=utf-8</span><span class="hljs-meta">spring.datasource.one.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.two.url</span>=<span class="hljs-string">jdbc:mysql:///test02?useUnicode=true&amp;characterEncoding=utf-8</span><span class="hljs-meta">spring.datasource.two.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span></code></pre></div><p>è¿™é‡Œé€šè¿‡oneå’Œtwoå¯¹æ•°æ®æºè¿›è¡Œäº†åŒºåˆ†ï¼Œä½†æ˜¯åŠ äº†oneå’Œtwoä¹‹åï¼Œè¿™é‡Œçš„é…ç½®å°±æ²¡æ³•è¢«SpringBootè‡ªåŠ¨åŠ è½½äº†ï¼ˆå› ä¸ºå‰é¢çš„keyå˜äº†ï¼‰ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»åŠ è½½DataSourceäº†ï¼Œæ­¤æ—¶ï¼Œéœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ªDataSourceConfigï¼Œç”¨æ¥æä¾›ä¸¤ä¸ªDataSource Beanï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.one&quot;)</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsOne</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.two&quot;)</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsTwo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;&#125;</code></pre></div><p>è¿™é‡Œæä¾›äº†ä¸¤ä¸ªBeanï¼Œå…¶ä¸­@ConfigurationPropertiesæ˜¯Spring Bootæä¾›çš„ç±»å‹å®‰å…¨çš„å±æ€§ç»‘å®šï¼Œä»¥ç¬¬ä¸€ä¸ªBeanä¸ºä¾‹ï¼Œ<code>@ConfigurationProperties(prefix = &quot;spring.datasource.one&quot;)</code>è¡¨ç¤ºä½¿ç”¨<code>spring.datasource.one</code>å‰ç¼€çš„æ•°æ®åº“é…ç½®å»åˆ›å»ºä¸€ä¸ªDataSourceï¼Œè¿™æ ·é…ç½®ä¹‹åï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸¤ä¸ªä¸åŒçš„DataSourceï¼Œæ¥ä¸‹æ¥å†ç”¨è¿™ä¸¤ä¸ªä¸åŒçš„DataSourceå»åˆ›å»ºä¸¤ä¸ªä¸åŒçš„JdbcTemplate</p><h4 id="1-4-3-é…ç½®JdbcTemplateå®ä¾‹"><a href="#1-4-3-é…ç½®JdbcTemplateå®ä¾‹" class="headerlink" title="1.4.3 é…ç½®JdbcTemplateå®ä¾‹"></a>1.4.3 é…ç½®JdbcTemplateå®ä¾‹</h4><p>åˆ›å»ºJdbcTemplateConfigç±»ï¼Œç”¨æ¥æä¾›ä¸¤ä¸ªä¸åŒçš„JdbcTemplateå®ä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">JdbcTemplate <span class="hljs-title">jdbcTemplateOne</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;dsOne&quot;)</span> DataSource dsOne)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JdbcTemplate(dsOne);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">JdbcTemplate <span class="hljs-title">jdbcTemplateTwo</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;dsTwo&quot;)</span> DataSource dsTwo)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JdbcTemplate(dsTwo);    &#125;&#125;</code></pre></div><p>æ¯ä¸€ä¸ªJdbcTemplateçš„åˆ›å»ºéƒ½éœ€è¦ä¸€ä¸ªDataSourceï¼Œç”±äºSpringå®¹å™¨ä¸­ç°åœ¨å­˜åœ¨ä¸¤ä¸ªDataSourceï¼Œé»˜è®¤ä½¿ç”¨ç±»å‹æŸ¥æ‰¾ï¼Œä¼šæŠ¥é”™ï¼Œå› æ­¤åŠ ä¸Š@Qualifieræ³¨è§£ï¼Œè¡¨ç¤ºæŒ‰ç…§åç§°æŸ¥æ‰¾ã€‚è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªJdbcTemplateå®ä¾‹ï¼Œåˆ†åˆ«å¯¹åº”äº†ä¸¤ä¸ªDataSourceï¼Œæ¥ä¸‹æ¥ç›´æ¥å»ä½¿ç”¨è¿™ä¸ªJdbcTemplateå°±å¯ä»¥äº†</p><h4 id="1-4-4-æµ‹è¯•ä½¿ç”¨"><a href="#1-4-4-æµ‹è¯•ä½¿ç”¨" class="headerlink" title="1.4.4 æµ‹è¯•ä½¿ç”¨"></a>1.4.4 æµ‹è¯•ä½¿ç”¨</h4><p>å…³äºJdbcTemplateçš„è¯¦ç»†ç”¨æ³•å¤§ä¼™å¯ä»¥å‚è€ƒæˆ‘çš„ä¸Šç¯‡æ–‡ç« ï¼Œè¿™é‡Œæˆ‘ä¸»è¦æ¼”ç¤ºæ•°æ®æºçš„å·®å¼‚ï¼Œåœ¨Controllerä¸­æ³¨å…¥ä¸¤ä¸ªä¸åŒçš„JdbcTemplateï¼Œè¿™ä¸¤ä¸ªJdbcTemplateåˆ†åˆ«å¯¹åº”äº†ä¸åŒçš„æ•°æ®æºï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-meta">@Qualifier(&quot;jdbcTemplateOne&quot;)</span>    JdbcTemplate jdbcTemplateOne;    <span class="hljs-meta">@Resource(name = &quot;jdbcTemplateTwo&quot;)</span>    JdbcTemplate jdbcTemplateTwo;    <span class="hljs-meta">@GetMapping(&quot;/user&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span> </span>&#123;        List&lt;User&gt; list = jdbcTemplateOne.query(<span class="hljs-string">&quot;select * from t_user&quot;</span>, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;&gt;(User.class));        <span class="hljs-keyword">return</span> list;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/user2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getAllUser2</span><span class="hljs-params">()</span> </span>&#123;        List&lt;User&gt; list = jdbcTemplateTwo.query(<span class="hljs-string">&quot;select * from t_user&quot;</span>, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;&gt;(User.class));        <span class="hljs-keyword">return</span> list;    &#125;&#125;</code></pre></div><p>å’ŒDataSourceä¸€æ ·ï¼ŒSpringå®¹å™¨ä¸­çš„JdbcTemplateä¹Ÿæ˜¯æœ‰ä¸¤ä¸ªï¼Œå› æ­¤ä¸èƒ½é€šè¿‡byTypeçš„æ–¹å¼æ³¨å…¥è¿›æ¥ï¼Œè¿™é‡Œç»™å¤§ä¼™æä¾›äº†ä¸¤ç§æ³¨å…¥æ€è·¯ï¼Œä¸€ç§æ˜¯ä½¿ç”¨@Resourceæ³¨è§£ï¼Œç›´æ¥é€šè¿‡byNameçš„æ–¹å¼æ³¨å…¥è¿›æ¥ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯<code>@Autowired</code>æ³¨è§£åŠ ä¸Š<code>@Qualifier</code>æ³¨è§£ï¼Œä¸¤è€…è”åˆèµ·æ¥ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯byNameã€‚å°†JdbcTemplateæ³¨å…¥è¿›æ¥ä¹‹åï¼ŒjdbcTemplateOneå’ŒjdbcTemplateTwoæ­¤æ—¶å°±ä»£è¡¨æ“ä½œä¸åŒçš„æ•°æ®æºï¼Œä½¿ç”¨ä¸åŒçš„JdbcTemplateæ“ä½œä¸åŒçš„æ•°æ®æºï¼Œå®ç°äº†å¤šæ•°æ®æºé…ç½®ã€‚</p><h2 id="2-æ•´åˆMyBatis"><a href="#2-æ•´åˆMyBatis" class="headerlink" title="2. æ•´åˆMyBatis"></a>2. æ•´åˆMyBatis</h2><p>JdbcTemplateè™½ç„¶ç®€å•ï¼Œä½†æ˜¯ç”¨çš„å¹¶ä¸å¤šï¼Œå› ä¸ºå®ƒæ²¡æœ‰MyBatisæ–¹ä¾¿ï¼Œåœ¨Spring+SpringMVCä¸­æ•´åˆMyBatisæ­¥éª¤è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ï¼Œè¦é…ç½®å¤šä¸ªBeanï¼ŒSpring Bootä¸­å¯¹æ­¤åšäº†è¿›ä¸€æ­¥çš„ç®€åŒ–ï¼Œä½¿MyBatisåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°å¼€ç®±å³ç”¨ï¼Œæœ¬æ–‡å°±æ¥çœ‹çœ‹åœ¨Spring Bootä¸­MyBatisè¦å¦‚ä½•ä½¿ç”¨</p><h3 id="2-1-å·¥ç¨‹åˆ›å»º"><a href="#2-1-å·¥ç¨‹åˆ›å»º" class="headerlink" title="2.1 å·¥ç¨‹åˆ›å»º"></a>2.1 å·¥ç¨‹åˆ›å»º</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„Spring Bootå·¥ç¨‹ï¼Œæ·»åŠ Webä¾èµ–ï¼ŒMyBatisä¾èµ–ä»¥åŠMySQLé©±åŠ¨ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-1-20210523153350314-20210525153228568.png" alt="img"></p><p>åˆ›å»ºæˆåŠŸåï¼Œæ·»åŠ Druidä¾èµ–ï¼Œå¹¶ä¸”é”å®šMySQLé©±åŠ¨ç‰ˆæœ¬ï¼Œå®Œæ•´çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¦‚æ­¤ï¼Œå·¥ç¨‹å°±ç®—æ˜¯åˆ›å»ºæˆåŠŸäº†ã€‚è¯»è€…æ³¨æ„ï¼ŒMyBatiså’ŒDruidä¾èµ–çš„å‘½åå’Œå…¶ä»–åº“çš„å‘½åä¸å¤ªä¸€æ ·ï¼Œæ˜¯å±äºxxx-spring-boot-stateræ¨¡å¼çš„ï¼Œè¿™è¡¨ç¤ºè¯¥starteræ˜¯ç”±ç¬¬ä¸‰æ–¹æä¾›çš„ã€‚</p><h3 id="2-2-åŸºæœ¬ç”¨æ³•"><a href="#2-2-åŸºæœ¬ç”¨æ³•" class="headerlink" title="2.2 åŸºæœ¬ç”¨æ³•"></a>2.2 åŸºæœ¬ç”¨æ³•</h3><p>MyBatisçš„ä½¿ç”¨å’ŒJdbcTemplateåŸºæœ¬ä¸€è‡´ï¼Œé¦–å…ˆä¹Ÿæ˜¯åœ¨application.propertiesä¸­é…ç½®æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=utf-8</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span></code></pre></div><p>é…ç½®å®Œæˆåï¼ŒMyBatiså°±å¯ä»¥åˆ›å»ºMapperæ¥ä½¿ç”¨äº†ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ªUserMapper2ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper2</span> </span>&#123;    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getAllUsers</span><span class="hljs-params">()</span></span>;    <span class="hljs-meta">@Results(&#123;</span><span class="hljs-meta">            @Result(property = &quot;id&quot;, column = &quot;id&quot;),</span><span class="hljs-meta">            @Result(property = &quot;username&quot;, column = &quot;u&quot;),</span><span class="hljs-meta">            @Result(property = &quot;address&quot;, column = &quot;a&quot;)</span><span class="hljs-meta">    &#125;)</span>    <span class="hljs-meta">@Select(&quot;select username as u,address as a,id as id from user where id=#&#123;id&#125;&quot;)</span>    <span class="hljs-function">User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span></span>;    <span class="hljs-meta">@Select(&quot;select * from user where username like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)&quot;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUsersByName</span><span class="hljs-params">(String name)</span></span>;    <span class="hljs-meta">@Insert(&#123;&quot;insert into user(username,address) values(#&#123;username&#125;,#&#123;address&#125;)&quot;&#125;)</span>    <span class="hljs-meta">@SelectKey(statement = &quot;select last_insert_id()&quot;, keyProperty = &quot;id&quot;, before = false, resultType = Integer.class)</span>    <span class="hljs-function">Integer <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-meta">@Update(&quot;update user set username=#&#123;username&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;&quot;)</span>    <span class="hljs-function">Integer <span class="hljs-title">updateUserById</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-meta">@Delete(&quot;delete from user where id=#&#123;id&#125;&quot;)</span>    <span class="hljs-function">Integer <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Integer id)</span></span>;&#125;</code></pre></div><p>è¿™é‡Œæ˜¯é€šè¿‡å…¨æ³¨è§£çš„æ–¹å¼æ¥å†™SQLï¼Œä¸å†™XMLæ–‡ä»¶ï¼Œ@Selectã€@Insertã€@Updateä»¥åŠ@Deleteå››ä¸ªæ³¨è§£åˆ†åˆ«å¯¹åº”XMLä¸­çš„selectã€insertã€updateä»¥åŠdeleteæ ‡ç­¾ï¼Œ@Resultsæ³¨è§£ç±»ä¼¼äºXMLä¸­çš„ResultMapæ˜ å°„æ–‡ä»¶ï¼ˆgetUserByIdæ–¹æ³•ç»™æŸ¥è¯¢ç»“æœçš„å­—æ®µå–åˆ«åä¸»è¦æ˜¯å‘å°ä¼™ä¼´ä»¬æ¼”ç¤ºä¸‹<code>@Results</code>æ³¨è§£çš„ç”¨æ³•ï¼‰ï¼Œå¦å¤–ä½¿ç”¨@SelectKeyæ³¨è§£å¯ä»¥å®ç°ä¸»é”®å›å¡«çš„åŠŸèƒ½ï¼Œå³å½“æ•°æ®æ’å…¥æˆåŠŸåï¼Œæ’å…¥æˆåŠŸçš„æ•°æ®idä¼šèµ‹å€¼åˆ°userå¯¹è±¡çš„idå±æ€§ä¸Šã€‚</p><p>UserMapper2åˆ›å»ºå¥½ä¹‹åï¼Œè¿˜è¦é…ç½®mapperæ‰«æï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨UserMapper2ä¸Šé¢æ·»åŠ <code>@Mapper</code>æ³¨è§£ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯æ‰€æœ‰çš„Mapperéƒ½è¦æ‰‹åŠ¨æ·»åŠ ï¼Œè¦æ˜¯è½ä¸‹ä¸€ä¸ªå°±ä¼šæŠ¥é”™ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸€åŠ³æ°¸é€¸çš„åŠæ³•å°±æ˜¯ç›´æ¥åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ Mapperæ‰«æï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@MapperScan(basePackages = &quot;org.sang.mybatis.mapper&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(MybatisApplication.class, args);    &#125;&#125;</code></pre></div><p>å¥½äº†ï¼Œåšå®Œè¿™äº›å·¥ä½œå°±å¯ä»¥å»æµ‹è¯•Mapperçš„ä½¿ç”¨äº†ã€‚</p><h3 id="2-3-mapperæ˜ å°„"><a href="#2-3-mapperæ˜ å°„" class="headerlink" title="2.3 mapperæ˜ å°„"></a>2.3 mapperæ˜ å°„</h3><p>å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨XMLä¸­å†™SQLï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªUserMapperï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span></span>;    <span class="hljs-function">Integer <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-function">Integer <span class="hljs-title">updateUserById</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-function">Integer <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Integer id)</span></span>;&#125;</code></pre></div><p>ç„¶ååˆ›å»ºUserMapper.xmlæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.sang.mybatis.mapper.UserMapper&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.sang.mybatis.model.User&quot;</span>&gt;</span>        select * from t_user;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.sang.mybatis.model.User&quot;</span>&gt;</span>        insert into user (username,address) values (#&#123;username&#125;,#&#123;address&#125;);    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUserById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.sang.mybatis.model.User&quot;</span>&gt;</span>        update user set username=#&#123;username&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUserById&quot;</span>&gt;</span>        delete from user where id=#&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>    <span class="hljs-comment">&lt;!--æˆ–è€…å®šä¹‰resultMapå»æ˜ å°„--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.javaboy.mybatis.model.User&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;UserMap&quot;</span>&gt;</span>  select * from user where id=#&#123;id&#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUsers&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;UserMap&quot;</span>&gt;</span>  select * from user ;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>å°†æ¥å£ä¸­æ–¹æ³•å¯¹åº”çš„SQLç›´æ¥å†™åœ¨XMLæ–‡ä»¶ä¸­</p><p>é‚£ä¹ˆè¿™ä¸ªUserMapper.xmlåˆ°åº•æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿæœ‰ä¸¤ä¸ªä½ç½®å¯ä»¥æ”¾ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç›´æ¥æ”¾åœ¨UserMapperæ‰€åœ¨çš„åŒ…ä¸‹é¢ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-2-20210523153350459-20210525153228563.png" alt="img"></p><p>æ”¾åœ¨è¿™é‡Œçš„UserMapper.xmlä¼šè¢«è‡ªåŠ¨æ‰«æåˆ°ï¼Œä½†æ˜¯æœ‰å¦å¤–ä¸€ä¸ªMavenå¸¦æ¥çš„é—®é¢˜ï¼Œå°±æ˜¯javaç›®å½•ä¸‹çš„xmlèµ„æºåœ¨é¡¹ç›®æ‰“åŒ…æ—¶ä¼šè¢«å¿½ç•¥æ‰ï¼Œæ‰€ä»¥ï¼Œå¦‚æœUserMapper.xmlæ”¾åœ¨åŒ…ä¸‹ï¼Œéœ€è¦åœ¨pom.xmlæ–‡ä»¶ä¸­å†æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œé¿å…æ‰“åŒ…æ—¶javaç›®å½•ä¸‹çš„XMLæ–‡ä»¶è¢«è‡ªåŠ¨å¿½ç•¥æ‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>å½“ç„¶ï¼ŒUserMapper.xmlä¹Ÿå¯ä»¥ç›´æ¥æ”¾åœ¨resourcesç›®å½•ä¸‹ï¼Œè¿™æ ·å°±ä¸ç”¨æ‹…å¿ƒæ‰“åŒ…æ—¶è¢«å¿½ç•¥äº†ï¼Œä½†æ˜¯æ”¾åœ¨resourcesç›®å½•ä¸‹ï¼Œåˆä¸èƒ½è‡ªåŠ¨è¢«æ‰«æåˆ°ï¼Œéœ€è¦æ·»åŠ é¢å¤–é…ç½®ã€‚ä¾‹å¦‚æˆ‘åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºmapperç›®å½•ç”¨æ¥æ”¾mapperæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-3-20210523153349662-20210525153228563.png" alt="img"></p><p>æ­¤æ—¶åœ¨application.propertiesä¸­å‘Šè¯‰mybatiså»å“ªé‡Œæ‰«æmapperï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:mapper/*.xml</span></code></pre></div><p>å¦‚æ­¤é…ç½®ä¹‹åï¼Œmapperå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚æ³¨æ„ç¬¬äºŒç§æ–¹å¼ä¸éœ€è¦åœ¨pom.xmlæ–‡ä»¶ä¸­é…ç½®æ–‡ä»¶è¿‡æ»¤ã€‚</p><h3 id="2-4-åŸç†åˆ†æ"><a href="#2-4-åŸç†åˆ†æ" class="headerlink" title="2.4 åŸç†åˆ†æ"></a>2.4 åŸç†åˆ†æ</h3><p>åœ¨SSMæ•´åˆä¸­ï¼Œå¼€å‘è€…éœ€è¦è‡ªå·±æä¾›ä¸¤ä¸ªBeanï¼Œä¸€ä¸ªSqlSessionFactoryBeanï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯MapperScannerConfigurerï¼Œåœ¨Spring Bootä¸­ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿è™½ç„¶ä¸ç”¨å¼€å‘è€…è‡ªå·±æä¾›äº†ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€è¿™ä¸¤ä¸ªBeanä¸éœ€è¦äº†ï¼Œåœ¨<code>org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</code>ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Spring Bootæä¾›äº†è¿™ä¸¤ä¸ªBeanï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration<span class="hljs-meta">@ConditionalOnClass(&#123; SqlSessionFactory.class, SqlSessionFactoryBean.class &#125;)</span><span class="hljs-meta">@ConditionalOnSingleCandidate(DataSource.class)</span><span class="hljs-meta">@EnableConfigurationProperties(MybatisProperties.class)</span><span class="hljs-meta">@AutoConfigureAfter(DataSourceAutoConfiguration.class)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisAutoConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InitializingBean</span> </span>&#123;  <span class="hljs-meta">@Bean</span>  <span class="hljs-meta">@ConditionalOnMissingBean</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionFactory <span class="hljs-title">sqlSessionFactory</span><span class="hljs-params">(DataSource dataSource)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    SqlSessionFactoryBean factory = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();    factory.setDataSource(dataSource);    <span class="hljs-keyword">return</span> factory.getObject();  &#125;  <span class="hljs-meta">@Bean</span>  <span class="hljs-meta">@ConditionalOnMissingBean</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionTemplate <span class="hljs-title">sqlSessionTemplate</span><span class="hljs-params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;    ExecutorType executorType = <span class="hljs-keyword">this</span>.properties.getExecutorType();    <span class="hljs-keyword">if</span> (executorType != <span class="hljs-keyword">null</span>) &#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory, executorType);    &#125; <span class="hljs-keyword">else</span> &#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory);    &#125;  &#125;  <span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration  <span class="hljs-meta">@Import(&#123; AutoConfiguredMapperScannerRegistrar.class &#125;)</span>  <span class="hljs-meta">@ConditionalOnMissingBean(MapperFactoryBean.class)</span>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapperScannerRegistrarNotFoundConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InitializingBean</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterPropertiesSet</span><span class="hljs-params">()</span> </span>&#123;      logger.debug(<span class="hljs-string">&quot;No &#123;&#125; found.&quot;</span>, MapperFactoryBean.class.getName());    &#125;  &#125;&#125;</code></pre></div><p>ä»ç±»ä¸Šçš„æ³¨è§£å¯ä»¥çœ‹å‡ºï¼Œå½“å‰ç±»è·¯å¾„ä¸‹å­˜åœ¨SqlSessionFactoryã€ SqlSessionFactoryBeanä»¥åŠDataSourceæ—¶ï¼Œè¿™é‡Œçš„é…ç½®æ‰ä¼šç”Ÿæ•ˆï¼ŒSqlSessionFactoryå’ŒSqlTemplateéƒ½è¢«æä¾›äº†ã€‚</p><h3 id="2-5-å¤šæ•°æ®æº"><a href="#2-5-å¤šæ•°æ®æº" class="headerlink" title="2.5 å¤šæ•°æ®æº"></a>2.5 å¤šæ•°æ®æº</h3><p>å…¶å®å…³äºå¤šæ•°æ®æºï¼Œæˆ‘çš„æ€åº¦è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¤æ‚çš„å°±ç›´æ¥ä¸Šåˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼Œç®€å•çš„å†è€ƒè™‘å¤šæ•°æ®æºã€‚è¿™æ˜¯é¡¹ç›®ä¸­çš„å»ºè®®ï¼ŒæŠ€æœ¯ä¸Šçš„è¯ï¼Œå½“ç„¶è¿˜æ˜¯å„ç§æŠ€æœ¯éƒ½è¦æŒæ¡çš„ã€‚</p><h4 id="2-5-1-å·¥ç¨‹åˆ›å»º"><a href="#2-5-1-å·¥ç¨‹åˆ›å»º" class="headerlink" title="2.5.1 å·¥ç¨‹åˆ›å»º"></a>2.5.1 å·¥ç¨‹åˆ›å»º</h4><p>é¦–å…ˆéœ€è¦åˆ›å»ºMyBatisé¡¹ç›®ï¼Œé¡¹ç›®åˆ›å»ºå’Œå‰æ–‡çš„ä¸€æ ·ï¼Œæ·»åŠ MyBatisã€MySQLä»¥åŠWebä¾èµ–ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-1-20210523173628435-20210525153228619.png" alt="img"></p><p>é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œæ·»åŠ Druidä¾èµ–ï¼Œå’ŒJdbcTemplateä¸€æ ·ï¼Œè¿™é‡Œæ·»åŠ Druidä¾èµ–ä¹Ÿå¿…é¡»æ˜¯ä¸“ä¸ºSpring bootæ‰“é€ çš„Druidï¼Œä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„Druidã€‚å®Œæ•´çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="2-5-2-å¤šæ•°æ®æºé…ç½®"><a href="#2-5-2-å¤šæ•°æ®æºé…ç½®" class="headerlink" title="2.5.2 å¤šæ•°æ®æºé…ç½®"></a>2.5.2 å¤šæ•°æ®æºé…ç½®</h4><p>æ¥ä¸‹æ¥é…ç½®å¤šæ•°æ®æºï¼Œè¿™é‡ŒåŸºæœ¬ä¸Šè¿˜æ˜¯å’ŒJdbcTemplateå¤šæ•°æ®æºçš„é…ç½®æ–¹å¼ä¸€è‡´ï¼Œé¦–å…ˆåœ¨application.propertiesä¸­é…ç½®æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åæä¾›ä¸¤ä¸ªDataSourceå³å¯ï¼Œè¿™é‡Œæˆ‘å†æŠŠä»£ç è´´å‡ºæ¥ï¼Œé‡Œè¾¹çš„é“ç†æ¡æ¡æ¡†æ¡†çš„ï¼Œå¤§ä¼™å¯ä»¥å‚è€ƒå‰é¢çš„æ–‡ç« ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>application.propertiesä¸­çš„é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.one.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=utf-8</span><span class="hljs-meta">spring.datasource.one.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.two.url</span>=<span class="hljs-string">jdbc:mysql:///test02?useUnicode=true&amp;characterEncoding=utf-8</span><span class="hljs-meta">spring.datasource.two.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span></code></pre></div><p>ç„¶åå†æä¾›ä¸¤ä¸ªDataSourceï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.one&quot;)</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsOne</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.two&quot;)</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsTwo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;&#125;</code></pre></div><h4 id="2-5-3-MyBatisé…ç½®"><a href="#2-5-3-MyBatisé…ç½®" class="headerlink" title="2.5.3 MyBatisé…ç½®"></a>2.5.3 MyBatisé…ç½®</h4><p>æ¥ä¸‹æ¥åˆ™æ˜¯MyBatisçš„é…ç½®ï¼Œä¸åŒäºJdbcTemplateï¼ŒMyBatisçš„é…ç½®è¦ç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œå› ä¸ºè¦æä¾›ä¸¤ä¸ªBeanï¼Œå› æ­¤è¿™é‡Œä¸¤ä¸ªæ•°æ®æºæˆ‘å°†åœ¨ä¸¤ä¸ªç±»ä¸­åˆ†å¼€æ¥é…ç½®ï¼Œé¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæ•°æ®æºçš„é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@MapperScan(basePackages = &quot;org.sang.mybatis.mapper1&quot;,sqlSessionFactoryRef = &quot;sqlSessionFactory1&quot;,sqlSessionTemplateRef = &quot;sqlSessionTemplate1&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisConfigOne</span> </span>&#123;    <span class="hljs-meta">@Resource(name = &quot;dsOne&quot;)</span>    DataSource dsOne;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SqlSessionFactory <span class="hljs-title">sqlSessionFactory1</span><span class="hljs-params">()</span> </span>&#123;        SqlSessionFactory sessionFactory = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            SqlSessionFactoryBean bean = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();            bean.setDataSource(dsOne);            sessionFactory = bean.getObject();        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> sessionFactory;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SqlSessionTemplate <span class="hljs-title">sqlSessionTemplate1</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory1());    &#125;&#125;</code></pre></div><p>åˆ›å»ºMyBatisConfigOneç±»ï¼Œé¦–å…ˆæŒ‡æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œé…ç½®ç±»ä¸­è¦æ‰«æçš„åŒ…æ˜¯org.sang.mybatis.mapper1ï¼Œå³è¯¥åŒ…ä¸‹çš„Mapperæ¥å£å°†æ“ä½œdsOneä¸­çš„æ•°æ®ï¼Œå¯¹åº”çš„SqlSessionFactoryå’ŒSqlSessionTemplateåˆ†åˆ«æ˜¯sqlSessionFactory1å’ŒsqlSessionTemplate1ï¼Œåœ¨MyBatisConfigOneå†…éƒ¨ï¼Œåˆ†åˆ«æä¾›SqlSessionFactoryå’ŒSqlSessionTemplateå³å¯ï¼ŒSqlSessionFactoryæ ¹æ®dsOneåˆ›å»ºï¼Œç„¶åå†æ ¹æ®åˆ›å»ºå¥½çš„SqlSessionFactoryåˆ›å»ºä¸€ä¸ªSqlSessionTemplateã€‚</p><p>è¿™é‡Œé…ç½®å®Œæˆåï¼Œä¾æ®è¿™ä¸ªé…ç½®ï¼Œå†æ¥é…ç½®ç¬¬äºŒä¸ªæ•°æ®æºå³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@MapperScan(basePackages = &quot;org.sang.mybatis.mapper2&quot;,sqlSessionFactoryRef = &quot;sqlSessionFactory2&quot;,sqlSessionTemplateRef = &quot;sqlSessionTemplate2&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisConfigTwo</span> </span>&#123;    <span class="hljs-meta">@Resource(name = &quot;dsTwo&quot;)</span>    DataSource dsTwo;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SqlSessionFactory <span class="hljs-title">sqlSessionFactory2</span><span class="hljs-params">()</span> </span>&#123;        SqlSessionFactory sessionFactory = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            SqlSessionFactoryBean bean = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();            bean.setDataSource(dsTwo);            sessionFactory = bean.getObject();        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> sessionFactory;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SqlSessionTemplate <span class="hljs-title">sqlSessionTemplate2</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory2());    &#125;&#125;</code></pre></div><p>å¥½äº†ï¼Œè¿™æ ·MyBatiså¤šæ•°æ®æºåŸºæœ¬ä¸Šå°±é…ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨org.sang.mybatis.mapper1å’Œorg.sang.mybatis.mapper2åŒ…ä¸­æä¾›ä¸åŒçš„Mapperï¼ŒServiceä¸­æ³¨å…¥ä¸åŒçš„Mapperå°±å¯ä»¥æ“ä½œä¸åŒçš„æ•°æ®æºã€‚</p><h4 id="2-5-4-mapperåˆ›å»º"><a href="#2-5-4-mapperåˆ›å»º" class="headerlink" title="2.5.4 mapperåˆ›å»º"></a>2.5.4 mapperåˆ›å»º</h4><p>org.sang.mybatis.mapper1ä¸­çš„mapperï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapperOne</span> </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>å¯¹åº”çš„XMLæ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.sang.mybatis.mapper1.UserMapperOne&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.sang.mybatis.model.User&quot;</span>&gt;</span>        select * from t_user;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p>org.sang.mybatis.mapper2ä¸­çš„mapperï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>å¯¹åº”çš„XMLæ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.sang.mybatis.mapper2.UserMapper&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.sang.mybatis.model.User&quot;</span>&gt;</span>        select * from t_user;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨Serviceä¸­æ³¨å…¥ä¸¤ä¸ªä¸åŒçš„Mapperï¼Œä¸åŒçš„Mapperå°†æ“ä½œä¸åŒçš„æ•°æ®æºã€‚</p><h2 id="3-æ•´åˆJpa"><a href="#3-æ•´åˆJpa" class="headerlink" title="3. æ•´åˆJpa"></a>3. æ•´åˆJpa</h2><h3 id="3-1-JPAæ˜¯ä»€ä¹ˆ"><a href="#3-1-JPAæ˜¯ä»€ä¹ˆ" class="headerlink" title="3.1 JPAæ˜¯ä»€ä¹ˆ"></a>3.1 JPAæ˜¯ä»€ä¹ˆ</h3><ul><li><p>Java Persistence APIï¼šç”¨äºå¯¹è±¡æŒä¹…åŒ–çš„ API</p></li><li><p>Java EE 5.0 å¹³å°æ ‡å‡†çš„ ORM è§„èŒƒï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä»¥ç»Ÿä¸€çš„æ–¹å¼è®¿é—®æŒä¹…å±‚ </p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/19-1-20210525153228703.png" alt="img"></p></li></ul><h3 id="3-2-JPAå’ŒHibernateçš„å…³ç³»"><a href="#3-2-JPAå’ŒHibernateçš„å…³ç³»" class="headerlink" title="3.2 JPAå’ŒHibernateçš„å…³ç³»"></a>3.2 JPAå’ŒHibernateçš„å…³ç³»</h3><ul><li>JPA æ˜¯ Hibernate çš„ä¸€ä¸ªæŠ½è±¡ï¼ˆå°±åƒJDBCå’ŒJDBCé©±åŠ¨çš„å…³ç³»ï¼‰</li><li>JPA æ˜¯è§„èŒƒï¼šJPA æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§ ORM è§„èŒƒï¼Œä¸æ˜¯ORM æ¡†æ¶ï¼Œè¿™æ˜¯å› ä¸º JPA å¹¶æœªæä¾› ORM å®ç°ï¼Œå®ƒåªæ˜¯åˆ¶è®¢äº†ä¸€äº›è§„èŒƒï¼Œæä¾›äº†ä¸€äº›ç¼–ç¨‹çš„ API æ¥å£ï¼Œä½†å…·ä½“å®ç°åˆ™ç”± ORM å‚å•†æä¾›å®ç°ï¼›</li><li>Hibernate æ˜¯å®ç°ï¼šHibernate é™¤äº†ä½œä¸º ORM æ¡†æ¶ä¹‹å¤–ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§ JPA å®ç°</li><li>ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œ JPA æ˜¯ Hibernate åŠŸèƒ½çš„ä¸€ä¸ªå­é›†</li></ul><h3 id="3-3-JPAçš„ä¾›åº”å•†"><a href="#3-3-JPAçš„ä¾›åº”å•†" class="headerlink" title="3.3 JPAçš„ä¾›åº”å•†"></a>3.3 JPAçš„ä¾›åº”å•†</h3><p>JPA çš„ç›®æ ‡ä¹‹ä¸€æ˜¯åˆ¶å®šä¸€ä¸ªå¯ä»¥ç”±å¾ˆå¤šä¾›åº”å•†å®ç°çš„ APIï¼ŒHibernate 3.2+ã€TopLink 10.1+ ä»¥åŠ OpenJPA éƒ½æä¾›äº† JPA çš„å®ç°ï¼ŒJpa ä¾›åº”å•†æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰å¦‚ä¸‹å››ç§ï¼š</p><ul><li>Hibernate<br>JPA çš„å§‹ä½œä¿‘è€…å°±æ˜¯ Hibernate çš„ä½œè€…ï¼ŒHibernate ä» 3.2 å¼€å§‹å…¼å®¹ JPAã€‚</li><li>OpenJPA<br>OpenJPA æ˜¯ Apache ç»„ç»‡æä¾›çš„å¼€æºé¡¹ç›®ã€‚</li><li>TopLink<br>TopLink ä»¥å‰éœ€è¦æ”¶è´¹ï¼Œå¦‚ä»Šå¼€æºäº†ã€‚</li><li>EclipseLink</li></ul><h3 id="3-4-JPAçš„ä¼˜åŠ¿"><a href="#3-4-JPAçš„ä¼˜åŠ¿" class="headerlink" title="3.4 JPAçš„ä¼˜åŠ¿"></a>3.4 JPAçš„ä¼˜åŠ¿</h3><ul><li>æ ‡å‡†åŒ–: æä¾›ç›¸åŒçš„ APIï¼Œè¿™ä¿è¯äº†åŸºäºJPA å¼€å‘çš„ä¼ä¸šåº”ç”¨èƒ½å¤Ÿç»è¿‡å°‘é‡çš„ä¿®æ”¹å°±èƒ½å¤Ÿåœ¨ä¸åŒçš„ JPA æ¡†æ¶ä¸‹è¿è¡Œã€‚</li><li>ç®€å•æ˜“ç”¨ï¼Œé›†æˆæ–¹ä¾¿: JPA çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€å°±æ˜¯æä¾›æ›´åŠ ç®€å•çš„ç¼–ç¨‹æ¨¡å‹ï¼Œåœ¨ JPA æ¡†æ¶ä¸‹åˆ›å»ºå®ä½“å’Œåˆ›å»º Java ç±»ä¸€æ ·ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ javax.persistence.Entity è¿›è¡Œæ³¨è§£ï¼›JPA çš„æ¡†æ¶å’Œæ¥å£ä¹Ÿéƒ½éå¸¸ç®€å•ã€‚</li><li>å¯åª²ç¾JDBCçš„æŸ¥è¯¢èƒ½åŠ›: JPAçš„æŸ¥è¯¢è¯­è¨€æ˜¯é¢å‘å¯¹è±¡çš„ï¼ŒJPAå®šä¹‰äº†ç‹¬ç‰¹çš„JPQLï¼Œè€Œä¸”èƒ½å¤Ÿæ”¯æŒæ‰¹é‡æ›´æ–°å’Œä¿®æ”¹ã€JOINã€GROUP BYã€HAVING ç­‰é€šå¸¸åªæœ‰ SQL æ‰èƒ½å¤Ÿæä¾›çš„é«˜çº§æŸ¥è¯¢ç‰¹æ€§ï¼Œç”šè‡³è¿˜èƒ½å¤Ÿæ”¯æŒå­æŸ¥è¯¢ã€‚</li><li>æ”¯æŒé¢å‘å¯¹è±¡çš„é«˜çº§ç‰¹æ€§: JPA ä¸­èƒ½å¤Ÿæ”¯æŒé¢å‘å¯¹è±¡çš„é«˜çº§ç‰¹æ€§ï¼Œå¦‚ç±»ä¹‹é—´çš„ç»§æ‰¿ã€å¤šæ€å’Œç±»ä¹‹é—´çš„å¤æ‚å…³ç³»ï¼Œæœ€å¤§é™åº¦çš„ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ¨¡å‹</li></ul><h3 id="3-5-JPAåŒ…å«çš„æŠ€æœ¯"><a href="#3-5-JPAåŒ…å«çš„æŠ€æœ¯" class="headerlink" title="3.5 JPAåŒ…å«çš„æŠ€æœ¯"></a>3.5 JPAåŒ…å«çš„æŠ€æœ¯</h3><ul><li>ORM æ˜ å°„å…ƒæ•°æ®ï¼šJPA æ”¯æŒ XML å’Œ JDK 5.0 æ³¨è§£ä¸¤ç§å…ƒæ•°æ®çš„å½¢å¼ï¼Œå…ƒæ•°æ®æè¿°å¯¹è±¡å’Œè¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œæ¡†æ¶æ®æ­¤å°†å®ä½“å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚</li><li>JPA çš„ APIï¼šç”¨æ¥æ“ä½œå®ä½“å¯¹è±¡ï¼Œæ‰§è¡ŒCRUDæ“ä½œï¼Œæ¡†æ¶åœ¨åå°å®Œæˆæ‰€æœ‰çš„äº‹æƒ…ï¼Œå¼€å‘è€…ä»ç¹ççš„ JDBC å’Œ SQL ä»£ç ä¸­è§£è„±å‡ºæ¥ã€‚</li><li>æŸ¥è¯¢è¯­è¨€ï¼ˆJPQLï¼‰ï¼šè¿™æ˜¯æŒä¹…åŒ–æ“ä½œä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ–¹é¢ï¼Œé€šè¿‡é¢å‘å¯¹è±¡è€Œéé¢å‘æ•°æ®åº“çš„æŸ¥è¯¢è¯­è¨€æŸ¥è¯¢æ•°æ®ï¼Œé¿å…ç¨‹åºå’Œå…·ä½“çš„ SQL ç´§å¯†è€¦åˆã€‚</li></ul><h3 id="3-6-Spring-Data"><a href="#3-6-Spring-Data" class="headerlink" title="3.6 Spring Data"></a>3.6 Spring Data</h3><p>Spring Data æ˜¯ Spring çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚ç”¨äºç®€åŒ–æ•°æ®åº“è®¿é—®ï¼Œæ”¯æŒNoSQL å’Œ å…³ç³»æ•°æ®å­˜å‚¨ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä½¿æ•°æ®åº“çš„è®¿é—®å˜å¾—æ–¹ä¾¿å¿«æ·ã€‚Spring Data å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>SpringData é¡¹ç›®æ”¯æŒ NoSQL å­˜å‚¨ï¼š<br>MongoDB ï¼ˆæ–‡æ¡£æ•°æ®åº“ï¼‰<br>Neo4jï¼ˆå›¾å½¢æ•°æ®åº“ï¼‰<br>Redisï¼ˆé”®/å€¼å­˜å‚¨ï¼‰<br>Hbaseï¼ˆåˆ—æ—æ•°æ®åº“ï¼‰</li><li>SpringData é¡¹ç›®æ‰€æ”¯æŒçš„å…³ç³»æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼š<br>JDBC<br>JPA</li><li>Spring Data Jpa è‡´åŠ›äºå‡å°‘æ•°æ®è®¿é—®å±‚ (DAO) çš„å¼€å‘é‡. å¼€å‘è€…å”¯ä¸€è¦åšçš„ï¼Œå°±æ˜¯å£°æ˜æŒä¹…å±‚çš„æ¥å£ï¼Œå…¶ä»–éƒ½äº¤ç»™ Spring Data JPA æ¥å¸®ä½ å®Œæˆï¼</li><li>æ¡†æ¶æ€ä¹ˆå¯èƒ½ä»£æ›¿å¼€å‘è€…å®ç°ä¸šåŠ¡é€»è¾‘å‘¢ï¼Ÿæ¯”å¦‚ï¼šå½“æœ‰ä¸€ä¸ª UserDao.findUserById() è¿™æ ·ä¸€ä¸ªæ–¹æ³•å£°æ˜ï¼Œå¤§è‡´åº”è¯¥èƒ½åˆ¤æ–­å‡ºè¿™æ˜¯æ ¹æ®ç»™å®šæ¡ä»¶çš„ ID æŸ¥è¯¢å‡ºæ»¡è¶³æ¡ä»¶çš„ User å¯¹è±¡ã€‚Spring Data JPA åšçš„ä¾¿æ˜¯è§„èŒƒæ–¹æ³•çš„åå­—ï¼Œæ ¹æ®ç¬¦åˆè§„èŒƒçš„åå­—æ¥ç¡®å®šæ–¹æ³•éœ€è¦å®ç°ä»€ä¹ˆæ ·çš„é€»è¾‘ã€‚</li></ul><h3 id="3-7-Jpa-çš„æ•…äº‹"><a href="#3-7-Jpa-çš„æ•…äº‹" class="headerlink" title="3.7 Jpa çš„æ•…äº‹"></a>3.7 Jpa çš„æ•…äº‹</h3><p>ä¸ºäº†è®©å¤§ä¼™å½»åº•æŠŠè¿™ä¸¤ä¸ªä¸œè¥¿å­¦ä¼šï¼Œè¿™é‡Œæˆ‘å°±å…ˆæ¥ä»‹ç»å•çº¯çš„Jpaä½¿ç”¨ï¼Œç„¶åæˆ‘ä»¬å†ç»“åˆ Spring Data æ¥çœ‹ Jpaå¦‚ä½•ä½¿ç”¨ã€‚</p><p>æ•´ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1.ä½¿ç”¨ IntelliJ IDEA åˆ›å»ºé¡¹ç›®ï¼Œåˆ›å»ºæ—¶é€‰æ‹© JavaEE Persistence ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/19-2-20210525153228734.png" alt="img"></p><p>2.åˆ›å»ºæˆåŠŸåï¼Œæ·»åŠ ä¾èµ–jarï¼Œç”±äº Jpa åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œå› æ­¤æˆ‘ä»¬è¯´ç”¨Jpaå®é™…ä¸Šå¿…ç„¶æ˜¯ç”¨Jpaçš„æŸä¸€ç§å®ç°ï¼Œé‚£ä¹ˆæ˜¯å“ªä¸€ç§å®ç°å‘¢ï¼Ÿå½“ç„¶å°±æ˜¯Hibernateäº†ï¼Œæ‰€ä»¥æ·»åŠ çš„jarï¼Œå®é™…ä¸Šæ¥è‡ª Hibernateï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/19-3-20210525153228618.png" alt="img"></p><p>3.æ·»åŠ å®ä½“ç±»</p><p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®ä¸­æ·»åŠ å®ä½“ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Entity(name = &quot;t_book&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-comment">// çœç•¥å…¶ä»–getter/setter</span>&#125;</code></pre></div><p>é¦–å…ˆ@Entityæ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œé‚£ä¹ˆåœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é’ˆå¯¹è¯¥ç±»ç”Ÿæˆä¸€å¼ è¡¨ï¼Œé»˜è®¤çš„è¡¨åä¸ºç±»åï¼Œ@Entityæ³¨è§£çš„nameå±æ€§è¡¨ç¤ºè‡ªå®šä¹‰ç”Ÿæˆçš„è¡¨åã€‚@Idæ³¨è§£è¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªidï¼Œ@GeneratedValueæ³¨è§£è¡¨ç¤ºä¸»é”®çš„è‡ªå¢é•¿ç­–ç•¥ï¼Œå¯¹äºç±»ä¸­çš„å…¶ä»–å±æ€§ï¼Œé»˜è®¤éƒ½ä¼šæ ¹æ®å±æ€§ååœ¨è¡¨ä¸­ç”Ÿæˆç›¸åº”çš„å­—æ®µï¼Œå­—æ®µåå’Œå±æ€§åç›¸åŒï¼Œå¦‚æœå¼€å‘è€…æƒ³è¦å¯¹å­—æ®µè¿›è¡Œå®šåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨@Columnæ³¨è§£ï¼Œå»é…ç½®å­—æ®µçš„åç§°ï¼Œé•¿åº¦ï¼Œæ˜¯å¦ä¸ºç©ºç­‰ç­‰ã€‚</p><p>4.åˆ›å»º persistence.xml æ–‡ä»¶</p><p>JPA è§„èŒƒè¦æ±‚åœ¨ç±»è·¯å¾„çš„ META-INF ç›®å½•ä¸‹æ”¾ç½®persistence.xmlï¼Œæ–‡ä»¶çš„åç§°æ˜¯å›ºå®šçš„</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">persistence</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/persistence&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;2.0&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;NewPersistenceUnit&quot;</span> <span class="hljs-attr">transaction-type</span>=<span class="hljs-string">&quot;RESOURCE_LOCAL&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span>&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">class</span>&gt;</span>org.sang.Book<span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.connection.url&quot;</span></span><span class="hljs-tag">                      <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql:///jpa01?useUnicode=true<span class="hljs-symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.connection.driver_class&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.connection.username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.connection.password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.archive.autodetection&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;class&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.show_sql&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.format_sql&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;update&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">persistence</span>&gt;</span></code></pre></div><p>æ³¨æ„ï¼š</p><ul><li>persistence-unit çš„name å±æ€§ç”¨äºå®šä¹‰æŒä¹…åŒ–å•å…ƒçš„åå­—, å¿…å¡«ã€‚</li><li>transaction-typeï¼šæŒ‡å®š JPA çš„äº‹åŠ¡å¤„ç†ç­–ç•¥ã€‚RESOURCE_LOCALï¼šé»˜è®¤å€¼ï¼Œæ•°æ®åº“çº§åˆ«çš„äº‹åŠ¡ï¼Œåªèƒ½é’ˆå¯¹ä¸€ç§æ•°æ®åº“ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€‚å¦‚æœéœ€è¦æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½¿ç”¨JTAï¼štransaction-type=â€JTAâ€</li><li>classèŠ‚ç‚¹è¡¨ç¤ºæ˜¾å¼çš„åˆ—å‡ºå®ä½“ç±»</li><li>propertiesä¸­çš„é…ç½®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯ä»¥åŠHibernateä¿¡æ¯</li></ul><ol><li>æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œ</li></ol><div class="hljs code-wrapper"><pre><code class="hljs java">EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory(<span class="hljs-string">&quot;NewPersistenceUnit&quot;</span>);EntityManager manager = entityManagerFactory.createEntityManager();EntityTransaction transaction = manager.getTransaction();transaction.begin();Book book = <span class="hljs-keyword">new</span> Book();book.setAuthor(<span class="hljs-string">&quot;ç½—è´¯ä¸­&quot;</span>);book.setName(<span class="hljs-string">&quot;ä¸‰å›½æ¼”ä¹‰&quot;</span>);manager.persist(book);transaction.commit();manager.close();entityManagerFactory.close();</code></pre></div><p>è¿™é‡Œé¦–å…ˆæ ¹æ®é…ç½®æ–‡ä»¶åˆ›å»ºå‡ºæ¥ä¸€ä¸ª EntityManagerFactory ï¼Œç„¶åå†æ ¹æ® EntityManagerFactory çš„å®ä¾‹åˆ›å»ºå‡ºæ¥ä¸€ä¸ª EntityManager ï¼Œç„¶åå†å¼€å¯äº‹åŠ¡ï¼Œè°ƒç”¨ EntityManager ä¸­çš„ persist æ–¹æ³•æ‰§è¡Œä¸€æ¬¡æŒä¹…åŒ–æ“ä½œï¼Œæœ€åæäº¤äº‹åŠ¡ï¼Œæ‰§è¡Œå®Œè¿™äº›æ“ä½œåï¼Œæ•°æ®åº“ä¸­æ—§å¤šå‡ºæ¥ä¸€ä¸ª t_book è¡¨ï¼Œå¹¶ä¸”è¡¨ä¸­æœ‰ä¸€æ¡æ•°æ®ã€‚</p><h4 id="å…³äº-JPQL"><a href="#å…³äº-JPQL" class="headerlink" title="å…³äº JPQL"></a>å…³äº JPQL</h4><ul><li><p>JPQLè¯­è¨€ï¼Œå³ Java Persistence Query Language çš„ç®€ç§°ã€‚JPQL æ˜¯ä¸€ç§å’Œ SQL éå¸¸ç±»ä¼¼çš„ä¸­é—´æ€§å’Œå¯¹è±¡åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒæœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆé’ˆå¯¹ä¸åŒåº•å±‚æ•°æ®åº“çš„ SQL æŸ¥è¯¢ï¼Œä»è€Œå±è”½ä¸åŒæ•°æ®åº“çš„å·®å¼‚ã€‚JPQLè¯­è¨€çš„è¯­å¥å¯ä»¥æ˜¯ select è¯­å¥ã€update è¯­å¥æˆ–deleteè¯­å¥ï¼Œå®ƒä»¬éƒ½é€šè¿‡ Query æ¥å£å°è£…æ‰§è¡Œã€‚</p></li><li><p>Queryæ¥å£å°è£…äº†æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢çš„ç›¸å…³æ–¹æ³•ã€‚è°ƒç”¨ EntityManager çš„ createQueryã€create NamedQuery åŠ createNativeQuery æ–¹æ³•å¯ä»¥è·å¾—æŸ¥è¯¢å¯¹è±¡ï¼Œè¿›è€Œå¯è°ƒç”¨ Query æ¥å£çš„ç›¸å…³æ–¹æ³•æ¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚</p></li><li><p>Queryæ¥å£çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><table><thead><tr><th><strong>int executeUpdate();</strong></th><th>ç”¨äºæ‰§è¡Œupdateæˆ–deleteè¯­å¥ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>List getResultList();</strong></th><th>ç”¨äºæ‰§è¡Œselectè¯­å¥å¹¶è¿”å›ç»“æœé›†å®ä½“åˆ—è¡¨ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>Object getSingleResult();</strong></th><th>ç”¨äºæ‰§è¡Œåªè¿”å›å•ä¸ªç»“æœå®ä½“çš„selectè¯­å¥ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>Query setFirstResult(int startPosition);</strong></th><th>ç”¨äºè®¾ç½®ä»å“ªä¸ªå®ä½“è®°å½•å¼€å§‹è¿”å›æŸ¥è¯¢ç»“æœã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>Query setMaxResults(int maxResult);</strong></th><th>ç”¨äºè®¾ç½®è¿”å›ç»“æœå®ä½“çš„æœ€å¤§æ•°ã€‚ä¸setFirstResultç»“åˆä½¿ç”¨å¯å®ç°åˆ†é¡µæŸ¥è¯¢ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>Query setFlushMode(FlushModeType flushMode);</strong></th><th>è®¾ç½®æŸ¥è¯¢å¯¹è±¡çš„Flushæ¨¡å¼ã€‚å‚æ•°å¯ä»¥å–2ä¸ªæšä¸¾å€¼ï¼šFlushModeType.AUTO ä¸ºè‡ªåŠ¨æ›´æ–°æ•°æ®åº“è®°å½•ï¼ŒFlushMode Type.COMMIT ä¸ºç›´åˆ°æäº¤äº‹åŠ¡æ—¶æ‰æ›´æ–°æ•°æ®åº“è®°å½•ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setHint(String hintName, Object value);</strong></th><th>è®¾ç½®ä¸æŸ¥è¯¢å¯¹è±¡ç›¸å…³çš„ç‰¹å®šä¾›åº”å•†å‚æ•°æˆ–æç¤ºä¿¡æ¯ã€‚å‚æ•°ååŠå…¶å–å€¼éœ€è¦å‚è€ƒç‰¹å®š JPA å®ç°åº“æä¾›å•†çš„æ–‡æ¡£ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ— æ•ˆå°†æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setParameter(int position, Object value);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šä½ç½®å‚æ•°èµ‹å€¼ã€‚Position æŒ‡å®šå‚æ•°åºå·ï¼Œvalue ä¸ºèµ‹ç»™å‚æ•°çš„å€¼ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setParameter(int position, Date d, TemporalType type);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šä½ç½®å‚æ•°èµ‹ Date å€¼ã€‚Position æŒ‡å®šå‚æ•°åºå·ï¼Œvalue ä¸ºèµ‹ç»™å‚æ•°çš„å€¼ï¼ŒtemporalType å– TemporalType çš„æšä¸¾å¸¸é‡ï¼ŒåŒ…æ‹¬ DATEã€TIME åŠ TIMESTAMP ä¸‰ä¸ªï¼Œï¼Œç”¨äºå°† Java çš„ Date å‹å€¼ä¸´æ—¶è½¬æ¢ä¸ºæ•°æ®åº“æ”¯æŒçš„æ—¥æœŸæ—¶é—´ç±»å‹ï¼ˆjava.sql.Dateã€java.sql.TimeåŠjava.sql.Timestampï¼‰ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setParameter(int position, Calendar c, TemporalType type);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šä½ç½®å‚æ•°èµ‹ Calenda rå€¼ã€‚position æŒ‡å®šå‚æ•°åºå·ï¼Œvalue ä¸ºèµ‹ç»™å‚æ•°çš„å€¼ï¼ŒtemporalType çš„å«ä¹‰åŠå–èˆåŒå‰ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setParameter(String name, Object value);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šåç§°å‚æ•°èµ‹å€¼ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li><li><table><thead><tr><th><strong>setParameter(String name, Date d, TemporalType type);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šåç§°å‚æ•°èµ‹ Date å€¼,ç”¨æ³•åŒå‰ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><table><thead><tr><th><strong>setParameter(String name, Calendar c, TemporalType type);</strong></th><th>ä¸ºæŸ¥è¯¢è¯­å¥çš„æŒ‡å®šåç§°å‚æ•°è®¾ç½®Calendarå€¼ã€‚nameä¸ºå‚æ•°åï¼Œå…¶å®ƒåŒå‰ã€‚è¯¥æ–¹æ³•è°ƒç”¨æ—¶å¦‚æœå‚æ•°ä½ç½®æˆ–å‚æ•°åä¸æ­£ç¡®ï¼Œæˆ–è€…æ‰€èµ‹çš„å‚æ•°å€¼ç±»å‹ä¸åŒ¹é…ï¼Œå°†æŠ›å‡º IllegalArgumentException å¼‚å¸¸ã€‚</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></li></ul></li></ul><h4 id="JPQL-ä¸¾ä¾‹"><a href="#JPQL-ä¸¾ä¾‹" class="headerlink" title="JPQL ä¸¾ä¾‹"></a>JPQL ä¸¾ä¾‹</h4><p>å’Œåœ¨ SQL ä¸­ä¸€æ ·ï¼ŒJPQL ä¸­çš„ select è¯­å¥ç”¨äºæ‰§è¡ŒæŸ¥è¯¢ã€‚å…¶è¯­æ³•å¯è¡¨ç¤ºä¸ºï¼š<br><code>select_clause form_clause [where_clause] [groupby_clause] [having_clause] [orderby_clause]</code></p><p>å…¶ä¸­ï¼š</p><ol><li>from å­å¥æ˜¯æŸ¥è¯¢è¯­å¥çš„å¿…é€‰å­å¥ã€‚</li><li>select ç”¨æ¥æŒ‡å®šæŸ¥è¯¢è¿”å›çš„ç»“æœå®ä½“æˆ–å®ä½“çš„æŸäº›å±æ€§ã€‚</li><li>from å­å¥å£°æ˜æŸ¥è¯¢æºå®ä½“ç±»ï¼Œå¹¶æŒ‡å®šæ ‡è¯†ç¬¦å˜é‡ï¼ˆç›¸å½“äºSQLè¡¨çš„åˆ«åï¼‰ã€‚</li><li>å¦‚æœä¸å¸Œæœ›è¿”å›é‡å¤å®ä½“ï¼Œå¯ä½¿ç”¨å…³é”®å­— distinct ä¿®é¥°ã€‚selectã€from éƒ½æ˜¯ JPQL çš„å…³é”®å­—ï¼Œé€šå¸¸å…¨å¤§å†™æˆ–å…¨å°å†™ï¼Œå»ºè®®ä¸è¦å¤§å°å†™æ··ç”¨ã€‚</li></ol><p>åœ¨ JPQL ä¸­ï¼ŒæŸ¥è¯¢æ‰€æœ‰å®ä½“çš„ JPQL æŸ¥è¯¢è¯­å¥å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š<br><code>select o from Order o æˆ– select o from Order as o</code><br>è¿™é‡Œå…³é”®å­— as å¯ä»¥çœå»ï¼Œæ ‡è¯†ç¬¦å˜é‡çš„å‘½åè§„èŒƒä¸ Java æ ‡è¯†ç¬¦ç›¸åŒï¼Œä¸”åŒºåˆ†å¤§å°å†™,è°ƒç”¨ EntityManager çš„ createQuery() æ–¹æ³•å¯åˆ›å»ºæŸ¥è¯¢å¯¹è±¡ï¼Œæ¥ç€è°ƒç”¨ Query æ¥å£çš„ getResultList() æ–¹æ³•å°±å¯è·å¾—æŸ¥è¯¢ç»“æœé›†ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">Query query = entityManager.createQuery( <span class="hljs-string">&quot;select o from Order o&quot;</span>); List orders = query.getResultList();Iterator iterator = orders.iterator();<span class="hljs-keyword">while</span>(iterator.hasNext() ) &#123;  <span class="hljs-comment">// å¤„ç†Order</span>&#125;</code></pre></div><p>å…¶ä»–æ–¹æ³•çš„ä¸æ­¤ç±»ä¼¼ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h3 id="3-8-Spring-Data-çš„æ•…äº‹"><a href="#3-8-Spring-Data-çš„æ•…äº‹" class="headerlink" title="3.8 Spring Data çš„æ•…äº‹"></a>3.8 Spring Data çš„æ•…äº‹</h3><p>åœ¨ Spring Boot ä¸­ï¼ŒSpring Data Jpa å®˜æ–¹å°è£…äº†å¤ªå¤šä¸œè¥¿äº†ï¼Œå¯¼è‡´å¾ˆå¤šäººç”¨çš„æ—¶å€™ä¸çŸ¥é“åº•å±‚åˆ°åº•æ˜¯æ€ä¹ˆé…ç½®çš„ï¼Œæœ¬æ–‡å°±å’Œå¤§ä¼™æ¥çœ‹çœ‹åœ¨æ‰‹å·¥çš„Springç¯å¢ƒä¸‹ï¼ŒSpring Data Jpaè¦æ€ä¹ˆé…ç½®ï¼Œé…ç½®å®Œæˆåï¼Œç”¨æ³•å’Œ Spring Boot ä¸­çš„ç”¨æ³•æ˜¯ä¸€è‡´çš„ã€‚</p><h4 id="åŸºæœ¬ç¯å¢ƒæ­å»º"><a href="#åŸºæœ¬ç¯å¢ƒæ­å»º" class="headerlink" title="åŸºæœ¬ç¯å¢ƒæ­å»º"></a>åŸºæœ¬ç¯å¢ƒæ­å»º</h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavenå·¥ç¨‹ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-orm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-oxm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-support<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-expression<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.12.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-jpamodelgen<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.12.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.29<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.11.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><p>è¿™é‡Œé™¤äº† Jpa çš„ä¾èµ–ä¹‹å¤–ï¼Œå°±æ˜¯Spring Data Jpa çš„ä¾èµ–äº†ã€‚</p><p>æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ª User å®ä½“ç±»ï¼Œåˆ›å»ºæ–¹å¼å‚è€ƒ Jpaä¸­å®ä½“ç±»çš„åˆ›å»ºæ–¹å¼ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>æ¥ä¸‹æ¥åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªapplicationContext.xmlæ–‡ä»¶ï¼Œå¹¶é…ç½®Springå’ŒJpaï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:db.properties&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.sang&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;db.driver&#125;&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;db.url&#125;&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;db.username&#125;&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;db.password&#125;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;entityManagerFactory&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jpaVendorAdapter&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;packagesToScan&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.sang.model&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jpaProperties&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;hibernate.show_sql&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;hibernate.format_sql&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;hibernate.hbm2ddl.auto&quot;</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;hibernate.dialect&quot;</span>&gt;</span>org.hibernate.dialect.MySQL57Dialect<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;entityManagerFactory&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;entityManagerFactory&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!-- é…ç½®jpa --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.sang.dao&quot;</span></span><span class="hljs-tag">                  <span class="hljs-attr">entity-manager-factory-ref</span>=<span class="hljs-string">&quot;entityManagerFactory&quot;</span>/&gt;</span></code></pre></div><p>è¿™é‡Œå’Œ Jpa ç›¸å…³çš„é…ç½®ä¸»è¦æ˜¯ä¸‰ä¸ªï¼Œä¸€ä¸ªæ˜¯entityManagerFactoryï¼Œä¸€ä¸ªæ˜¯Jpaçš„äº‹åŠ¡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯é…ç½®daoçš„ä½ç½®ï¼Œé…ç½®å®Œæˆåï¼Œå°±å¯ä»¥åœ¨ org.sang.dao åŒ…ä¸‹åˆ›å»ºç›¸åº”çš„ Repository äº†ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;    <span class="hljs-function">User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span></span>;&#125;</code></pre></div><p>getUserByIdè¡¨ç¤ºæ ¹æ®idå»æŸ¥è¯¢Userå¯¹è±¡ï¼Œåªè¦æˆ‘ä»¬çš„æ–¹æ³•åç§°ç¬¦åˆç±»ä¼¼çš„è§„èŒƒï¼Œå°±ä¸éœ€è¦å†™SQLï¼Œå…·ä½“çš„è§„èŒƒä¸€ä¼šæ¥è¯´ã€‚å¥½äº†ï¼Œæ¥ä¸‹æ¥ï¼Œåˆ›å»º Service å’Œ Controller æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-meta">@Transactional</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Resource</span>    UserDao userDao;    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span> </span>&#123;        <span class="hljs-keyword">return</span> userDao.getUserById(id);    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;    ClassPathXmlApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);    UserService userService = ctx.getBean(UserService.class);    User user = userService.getUserById(<span class="hljs-number">1L</span>);    System.out.println(user);&#125;</code></pre></div><p>è¿™æ ·ï¼Œå°±å¯ä»¥æŸ¥è¯¢åˆ°idä¸º1çš„ç”¨æˆ·äº†ã€‚</p><h4 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h4><p>ä¸Šæ–‡æˆ‘ä»¬è‡ªå®šä¹‰çš„ UserDao å®ç°äº† Repository æ¥å£ï¼Œè¿™ä¸ª Repository æ¥å£æ˜¯ä»€ä¹ˆæ¥å¤´å‘¢ï¼Ÿ</p><p>é¦–å…ˆæ¥çœ‹ Repository çš„ä¸€ä¸ªç»§æ‰¿å…³ç³»å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/19-4-20210525152813140.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ç°ç±»ä¸å°‘ã€‚é‚£ä¹ˆåˆ°åº•å¦‚ä½•ç†è§£ Repository å‘¢ï¼Ÿ</p><ol><li>Repository æ¥å£æ˜¯ Spring Data çš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå®ƒä¸æä¾›ä»»ä½•æ–¹æ³•ï¼Œå¼€å‘è€…éœ€è¦åœ¨è‡ªå·±å®šä¹‰çš„æ¥å£ä¸­å£°æ˜éœ€è¦çš„æ–¹æ³• <code>public interface Repository&lt;T, ID extends Serializable&gt; &#123; &#125;</code></li><li>è‹¥æˆ‘ä»¬å®šä¹‰çš„æ¥å£ç»§æ‰¿äº† Repository, åˆ™è¯¥æ¥å£ä¼šè¢« IOC å®¹å™¨è¯†åˆ«ä¸ºä¸€ä¸ª Repository Beanï¼Œè¿›è€Œçº³å…¥åˆ° IOC å®¹å™¨ä¸­ï¼Œè¿›è€Œå¯ä»¥åœ¨è¯¥æ¥å£ä¸­å®šä¹‰æ»¡è¶³ä¸€å®šè§„èŒƒçš„æ–¹æ³•ã€‚</li><li>Spring Dataå¯ä»¥è®©æˆ‘ä»¬åªå®šä¹‰æ¥å£ï¼Œåªè¦éµå¾ª Spring Data çš„è§„èŒƒï¼Œå°±æ— éœ€å†™å®ç°ç±»ã€‚</li><li>ä¸ç»§æ‰¿ Repository ç­‰ä»·çš„ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯åœ¨æŒä¹…å±‚æ¥å£ä¸Šä½¿ç”¨ @RepositoryDefinition æ³¨è§£ï¼Œå¹¶ä¸ºå…¶æŒ‡å®š domainClass å’Œ idClass å±æ€§ã€‚åƒä¸‹é¢è¿™æ ·ï¼š</li></ol><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RepositoryDefinition(domainClass = User.class, idClass = Long.class)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-function">User <span class="hljs-title">findById</span><span class="hljs-params">(Long id)</span></span>;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>åŸºç¡€çš„ Repository æä¾›äº†æœ€åŸºæœ¬çš„æ•°æ®è®¿é—®åŠŸèƒ½ï¼Œå…¶å‡ ä¸ªå­æ¥å£åˆ™æ‰©å±•äº†ä¸€äº›åŠŸèƒ½ï¼Œå®ƒçš„å‡ ä¸ªå¸¸ç”¨çš„å®ç°ç±»å¦‚ä¸‹ï¼š</p><ul><li>CrudRepositoryï¼š ç»§æ‰¿ Repositoryï¼Œå®ç°äº†ä¸€ç»„ CRUD ç›¸å…³çš„æ–¹æ³•</li><li>PagingAndSortingRepositoryï¼š ç»§æ‰¿ CrudRepositoryï¼Œå®ç°äº†ä¸€ç»„åˆ†é¡µæ’åºç›¸å…³çš„æ–¹æ³•</li><li>JpaRepositoryï¼š ç»§æ‰¿ PagingAndSortingRepositoryï¼Œå®ç°ä¸€ç»„ JPA è§„èŒƒç›¸å…³çš„æ–¹æ³•</li><li>è‡ªå®šä¹‰çš„ XxxxRepository éœ€è¦ç»§æ‰¿ JpaRepositoryï¼Œè¿™æ ·çš„ XxxxRepository æ¥å£å°±å…·å¤‡äº†é€šç”¨çš„æ•°æ®è®¿é—®æ§åˆ¶å±‚çš„èƒ½åŠ›ã€‚</li><li>JpaSpecificationExecutorï¼š ä¸å±äºRepositoryä½“ç³»ï¼Œå®ç°ä¸€ç»„ JPA Criteria æŸ¥è¯¢ç›¸å…³çš„æ–¹æ³•</li></ul><h4 id="æ–¹æ³•å®šä¹‰è§„èŒƒ"><a href="#æ–¹æ³•å®šä¹‰è§„èŒƒ" class="headerlink" title="æ–¹æ³•å®šä¹‰è§„èŒƒ"></a>æ–¹æ³•å®šä¹‰è§„èŒƒ</h4><h5 id="ç®€å•æ¡ä»¶æŸ¥è¯¢"><a href="#ç®€å•æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="ç®€å•æ¡ä»¶æŸ¥è¯¢"></a>ç®€å•æ¡ä»¶æŸ¥è¯¢</h5><ul><li>æŒ‰ç…§ Spring Data çš„è§„èŒƒï¼ŒæŸ¥è¯¢æ–¹æ³•ä»¥ find  read  get å¼€å¤´</li><li>æ¶‰åŠæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œæ¡ä»¶çš„å±æ€§ç”¨æ¡ä»¶å…³é”®å­—è¿æ¥ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼šæ¡ä»¶å±æ€§ä»¥é¦–å­—æ¯å¤§å†™</li></ul><p>ä¾‹å¦‚ï¼šå®šä¹‰ä¸€ä¸ª Entity å®ä½“ç±»ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>ï½› </span><span class="hljs-class">   <span class="hljs-title">private</span> <span class="hljs-title">String</span> <span class="hljs-title">firstName</span></span>;    <span class="hljs-keyword">private</span> String lastName; ï½</code></pre></div><p>ä½¿ç”¨Andæ¡ä»¶è¿æ¥æ—¶ï¼Œæ¡ä»¶çš„å±æ€§åç§°ä¸ä¸ªæ•°è¦ä¸å‚æ•°çš„ä½ç½®ä¸ä¸ªæ•°ä¸€ä¸€å¯¹åº”ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">findByLastNameAndFirstName(String lastName,String firstName);</code></pre></div><ul><li>æ”¯æŒå±æ€§çš„çº§è”æŸ¥è¯¢. è‹¥å½“å‰ç±»æœ‰ç¬¦åˆæ¡ä»¶çš„å±æ€§, åˆ™ä¼˜å…ˆä½¿ç”¨, è€Œä¸ä½¿ç”¨çº§è”å±æ€§. è‹¥éœ€è¦ä½¿ç”¨çº§è”å±æ€§, åˆ™å±æ€§ä¹‹é—´ä½¿ç”¨ _ è¿›è¡Œè¿æ¥.</li></ul><p>æŸ¥è¯¢ä¸¾ä¾‹ï¼š<br>1.æŒ‰ç…§idæŸ¥è¯¢</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span></span>;<span class="hljs-function">User <span class="hljs-title">getById</span><span class="hljs-params">(Long id)</span></span>;</code></pre></div><p>2.æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å°äº90å²çš„äºº</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByAgeLessThan</span><span class="hljs-params">(Long age)</span></span>;</code></pre></div><p>3.æŸ¥è¯¢æ‰€æœ‰å§“èµµçš„äºº</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByUsernameStartingWith</span><span class="hljs-params">(String u)</span></span>;</code></pre></div><p>4.æŸ¥è¯¢æ‰€æœ‰å§“èµµçš„ã€å¹¶ä¸”idå¤§äº50çš„äºº</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByUsernameStartingWithAndIdGreaterThan</span><span class="hljs-params">(String name, Long id)</span></span>;</code></pre></div><p>5.æŸ¥è¯¢æ‰€æœ‰å§“åä¸­åŒ…å«â€ä¸Šâ€å­—çš„äºº</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByUsernameContaining</span><span class="hljs-params">(String name)</span></span>;</code></pre></div><p>6.æŸ¥è¯¢æ‰€æœ‰å§“èµµçš„æˆ–è€…å¹´é¾„å¤§äº90å²çš„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByUsernameStartingWithOrAgeGreaterThan</span><span class="hljs-params">(String name, Long age)</span></span>;</code></pre></div><p>7.æŸ¥è¯¢æ‰€æœ‰è§’è‰²ä¸º1çš„ç”¨æˆ·</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByRole_Id</span><span class="hljs-params">(Long id)</span></span>;</code></pre></div><h5 id="æ”¯æŒçš„å…³é”®å­—"><a href="#æ”¯æŒçš„å…³é”®å­—" class="headerlink" title="æ”¯æŒçš„å…³é”®å­—"></a>æ”¯æŒçš„å…³é”®å­—</h5><p>æ”¯æŒçš„æŸ¥è¯¢å…³é”®å­—å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/19-5-20210525152813173.png" alt="img"></p><h5 id="æŸ¥è¯¢æ–¹æ³•æµç¨‹è§£æ"><a href="#æŸ¥è¯¢æ–¹æ³•æµç¨‹è§£æ" class="headerlink" title="æŸ¥è¯¢æ–¹æ³•æµç¨‹è§£æ"></a>æŸ¥è¯¢æ–¹æ³•æµç¨‹è§£æ</h5><p>ä¸ºä»€ä¹ˆå†™ä¸Šæ–¹æ³•åï¼ŒJPAå°±çŸ¥é“ä½ æƒ³å¹²å˜›äº†å‘¢ï¼Ÿå‡å¦‚åˆ›å»ºå¦‚ä¸‹çš„æŸ¥è¯¢ï¼š<code>findByUserDepUuid()</code>ï¼Œæ¡†æ¶åœ¨è§£æè¯¥æ–¹æ³•æ—¶ï¼Œé¦–å…ˆå‰”é™¤ findByï¼Œç„¶åå¯¹å‰©ä¸‹çš„å±æ€§è¿›è¡Œè§£æï¼Œå‡è®¾æŸ¥è¯¢å®ä½“ä¸ºDocï¼š</p><ol><li>å…ˆåˆ¤æ–­ userDepUuid ï¼ˆæ ¹æ® POJO è§„èŒƒï¼Œé¦–å­—æ¯å˜ä¸ºå°å†™ï¼‰æ˜¯å¦ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºæ ¹æ®è¯¥å±æ€§è¿›è¡ŒæŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œç»§ç»­ç¬¬äºŒæ­¥ï¼›</li><li>ä»å³å¾€å·¦æˆªå–ç¬¬ä¸€ä¸ªå¤§å†™å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²(æ­¤å¤„ä¸ºUuid)ï¼Œç„¶åæ£€æŸ¥å‰©ä¸‹çš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºæ ¹æ®è¯¥å±æ€§è¿›è¡ŒæŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™é‡å¤ç¬¬äºŒæ­¥ï¼Œç»§ç»­ä»å³å¾€å·¦æˆªå–ï¼›æœ€åå‡è®¾ user ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§ï¼›</li><li>æ¥ç€å¤„ç†å‰©ä¸‹éƒ¨åˆ†ï¼ˆDepUuidï¼‰ï¼Œå…ˆåˆ¤æ–­ user æ‰€å¯¹åº”çš„ç±»å‹æ˜¯å¦æœ‰depUuidå±æ€§ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¡¨ç¤ºè¯¥æ–¹æ³•æœ€ç»ˆæ˜¯æ ¹æ® â€œ Doc.user.depUuidâ€ çš„å–å€¼è¿›è¡ŒæŸ¥è¯¢ï¼›å¦åˆ™ç»§ç»­æŒ‰ç…§æ­¥éª¤ 2 çš„è§„åˆ™ä»å³å¾€å·¦æˆªå–ï¼Œæœ€ç»ˆè¡¨ç¤ºæ ¹æ® â€œDoc.user.dep.uuidâ€ çš„å€¼è¿›è¡ŒæŸ¥è¯¢ã€‚</li><li>å¯èƒ½ä¼šå­˜åœ¨ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ DocåŒ…å«ä¸€ä¸ª user çš„å±æ€§ï¼Œä¹Ÿæœ‰ä¸€ä¸ª userDep å±æ€§ï¼Œæ­¤æ—¶ä¼šå­˜åœ¨æ··æ·†ã€‚å¯ä»¥æ˜ç¡®åœ¨å±æ€§ä¹‹é—´åŠ ä¸Š â€œ_â€ ä»¥æ˜¾å¼è¡¨è¾¾æ„å›¾ï¼Œæ¯”å¦‚ â€œfindByUser_DepUuid()â€ æˆ–è€… â€œfindByUserDep_uuid()â€</li><li>è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„å‚æ•°ï¼šä¾‹å¦‚åˆ†é¡µæˆ–æ’åºçš„å‚æ•°ï¼š</li></ol><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">Page&lt;UserModel&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(String name, Pageable pageable)</span></span>;  <span class="hljs-function">List&lt;UserModel&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(String name, Sort sort)</span></span>;</code></pre></div><h4 id="Queryæ³¨è§£"><a href="#Queryæ³¨è§£" class="headerlink" title="@Queryæ³¨è§£"></a>@Queryæ³¨è§£</h4><p>æœ‰çš„æ—¶å€™ï¼Œè¿™é‡Œæä¾›çš„æŸ¥è¯¢å…³é”®å­—å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ @Query å…³é”®å­—ï¼Œæ¥è‡ªå®šä¹‰æŸ¥è¯¢ SQLï¼Œä¾‹å¦‚æŸ¥è¯¢Idæœ€å¤§çš„Userï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Query(&quot;select u from t_user u where id=(select max(id) from t_user)&quot;)</span><span class="hljs-function">User <span class="hljs-title">getMaxIdUser</span><span class="hljs-params">()</span></span>;</code></pre></div><p>å¦‚æœæŸ¥è¯¢æœ‰å‚æ•°çš„è¯ï¼Œå‚æ•°æœ‰ä¸¤ç§ä¸åŒçš„ä¼ é€’æ–¹å¼:</p><p>1.åˆ©ç”¨ä¸‹æ ‡ç´¢å¼•ä¼ å‚ï¼Œç´¢å¼•å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼Œç´¢å¼•å€¼ä»1å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸­ â€?Xâ€ ä¸ªæ•°éœ€è¦ä¸æ–¹æ³•å®šä¹‰çš„å‚æ•°ä¸ªæ•°ç›¸ä¸€è‡´ï¼Œå¹¶ä¸”é¡ºåºä¹Ÿè¦ä¸€è‡´ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Query(&quot;select u from t_user u where id&gt;?1 and username like ?2&quot;)</span><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">selectUserByParam</span><span class="hljs-params">(Long id, String name)</span></span>;</code></pre></div><p>2.å‘½åå‚æ•°ï¼ˆæ¨èï¼‰ï¼šè¿™ç§æ–¹å¼å¯ä»¥å®šä¹‰å¥½å‚æ•°åï¼Œèµ‹å€¼æ—¶é‡‡ç”¨@Param(â€œå‚æ•°åâ€)ï¼Œè€Œä¸ç”¨ç®¡é¡ºåºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Query(&quot;select u from t_user u where id&gt;:id and username like :name&quot;)</span><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">selectUserByParam2</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;name&quot;)</span> String name, <span class="hljs-meta">@Param(&quot;id&quot;)</span> Long id)</span></span>;</code></pre></div><p>æŸ¥è¯¢æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨åŸç”Ÿçš„SQLæŸ¥è¯¢ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Query(value = &quot;select * from t_user&quot;,nativeQuery = true)</span><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">selectAll</span><span class="hljs-params">()</span></span>;</code></pre></div><h4 id="Modifyingæ³¨è§£"><a href="#Modifyingæ³¨è§£" class="headerlink" title="@Modifyingæ³¨è§£"></a>@Modifyingæ³¨è§£</h4><p>æ¶‰åŠåˆ°æ•°æ®ä¿®æ”¹æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ @Modifying æ³¨è§£ï¼Œ@Query ä¸ @Modifying è¿™ä¸¤ä¸ª annotationä¸€èµ·å£°æ˜ï¼Œå¯å®šä¹‰ä¸ªæ€§åŒ–æ›´æ–°æ“ä½œï¼Œä¾‹å¦‚æ¶‰åŠæŸäº›å­—æ®µæ›´æ–°æ—¶æœ€ä¸ºå¸¸ç”¨ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Modifying</span><span class="hljs-meta">@Query(&quot;update t_user set age=:age where id&gt;:id&quot;)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateUserById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;age&quot;)</span> Long age, <span class="hljs-meta">@Param(&quot;id&quot;)</span> Long id)</span></span>;</code></pre></div><p>æ³¨æ„ï¼š</p><ol><li>å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ JPQL å®Œæˆ UPDATE å’Œ DELETE æ“ä½œ. æ³¨æ„: JPQL ä¸æ”¯æŒä½¿ç”¨ INSERT</li><li>æ–¹æ³•çš„è¿”å›å€¼åº”è¯¥æ˜¯ intï¼Œè¡¨ç¤ºæ›´æ–°è¯­å¥æ‰€å½±å“çš„è¡Œæ•°</li><li>åœ¨è°ƒç”¨çš„åœ°æ–¹å¿…é¡»åŠ äº‹åŠ¡ï¼Œæ²¡æœ‰äº‹åŠ¡ä¸èƒ½æ­£å¸¸æ‰§è¡Œ</li><li>é»˜è®¤æƒ…å†µä¸‹, Spring Data çš„æ¯ä¸ªæ–¹æ³•ä¸Šæœ‰äº‹åŠ¡, ä½†éƒ½æ˜¯ä¸€ä¸ªåªè¯»äº‹åŠ¡. ä»–ä»¬ä¸èƒ½å®Œæˆä¿®æ”¹æ“ä½œ</li></ol><p>è¯´åˆ°è¿™é‡Œï¼Œå†æ¥é¡ºä¾¿è¯´è¯´Spring Data ä¸­çš„äº‹åŠ¡é—®é¢˜ï¼š</p><ol><li>Spring Data æä¾›äº†é»˜è®¤çš„äº‹åŠ¡å¤„ç†æ–¹å¼ï¼Œå³æ‰€æœ‰çš„æŸ¥è¯¢å‡å£°æ˜ä¸ºåªè¯»äº‹åŠ¡ã€‚</li><li>å¯¹äºè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå¦‚éœ€æ”¹å˜ Spring Data æä¾›çš„äº‹åŠ¡é»˜è®¤æ–¹å¼ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸Šæ·»åŠ  @Transactional æ³¨è§£ã€‚</li><li>è¿›è¡Œå¤šä¸ª Repository æ“ä½œæ—¶ï¼Œä¹Ÿåº”è¯¥ä½¿å®ƒä»¬åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤„ç†ï¼ŒæŒ‰ç…§åˆ†å±‚æ¶æ„çš„æ€æƒ³ï¼Œè¿™éƒ¨åˆ†å±äºä¸šåŠ¡é€»è¾‘å±‚ï¼Œå› æ­¤ï¼Œéœ€è¦åœ¨Service å±‚å®ç°å¯¹å¤šä¸ª Repository çš„è°ƒç”¨ï¼Œå¹¶åœ¨ç›¸åº”çš„æ–¹æ³•ä¸Šå£°æ˜äº‹åŠ¡ã€‚</li></ol><p>Spring Bootä¸­çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆå‰é¢ç»™å¤§ä¼™ä»‹ç»äº†ä¸¤ç§äº†ï¼Œä¸€ä¸ªæ˜¯JdbcTemplateï¼Œè¿˜æœ‰ä¸€ä¸ªMyBatisï¼ŒJdbcTemplateé…ç½®ç®€å•ï¼Œä½¿ç”¨ä¹Ÿç®€å•ï¼Œä½†æ˜¯åŠŸèƒ½ä¹Ÿéå¸¸æœ‰é™ï¼ŒMyBatisåˆ™æ¯”è¾ƒçµæ´»ï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œå…¬å¸é‡‡ç”¨MyBatisåšæ•°æ®æŒä¹…åŒ–çš„ç›¸å½“å¤šï¼Œä½†æ˜¯MyBatiså¹¶ä¸æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œé™¤äº†MyBatisä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯Jpaï¼Œæ¾å“¥ä¹Ÿæœ‰ä¸€äº›æœ‹å‹åœ¨å…¬å¸é‡Œä½¿ç”¨Jpaæ¥åšæ•°æ®æŒä¹…åŒ–ï¼Œæœ¬æ–‡å°±å’Œå¤§ä¼™æ¥è¯´è¯´Jpaå¦‚ä½•å®ç°æ•°æ®æŒä¹…åŒ–ã€‚</p><h3 id="3-9-æ•´åˆJpa"><a href="#3-9-æ•´åˆJpa" class="headerlink" title="3.9 æ•´åˆJpa"></a>3.9 æ•´åˆJpa</h3><p>é¦–å…ˆéœ€è¦å‘å¤§ä¼™ä»‹ç»ä¸€ä¸‹Jpaï¼ŒJpaï¼ˆJava Persistence APIï¼‰JavaæŒä¹…åŒ–APIï¼Œå®ƒæ˜¯ä¸€å¥—ORMè§„èŒƒï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°ï¼ŒJpaçš„æ±Ÿæ¹–åœ°ä½ç±»ä¼¼äºJDBCï¼Œåªæä¾›è§„èŒƒï¼Œæ‰€æœ‰çš„æ•°æ®åº“å‚å•†æä¾›å®ç°ï¼ˆå³å…·ä½“çš„æ•°æ®åº“é©±åŠ¨ï¼‰ï¼ŒJavaé¢†åŸŸï¼Œå°ä¼™ä¼´ä»¬ç†ŸçŸ¥çš„ORMæ¡†æ¶å¯èƒ½ä¸»è¦æ˜¯Hibernateï¼Œå®é™…ä¸Šï¼Œé™¤äº†Hibernateä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ORMæ¡†æ¶ï¼Œä¾‹å¦‚ï¼š</p><ul><li>Batoo JPA</li><li>DataNucleus (formerly JPOX)</li><li>EclipseLink (formerly Oracle TopLink)</li><li>IBM, for WebSphere Application Server</li><li>JBoss with Hibernate</li><li>Kundera</li><li>ObjectDB</li><li>OpenJPA</li><li>OrientDB from Orient Technologies</li><li>Versant Corporation JPA (not relational, object database)</li></ul><p>Hibernateåªæ˜¯ORMæ¡†æ¶çš„ä¸€ç§ï¼Œä¸Šé¢åˆ—å‡ºæ¥çš„ORMæ¡†æ¶éƒ½æ˜¯æ”¯æŒJPA2.0è§„èŒƒçš„ORMæ¡†æ¶ã€‚æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œä¸æ˜¯å…·ä½“çš„å®ç°ï¼Œé‚£ä¹ˆå¿…ç„¶å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ˆç±»ä¼¼äºJDBCä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»è¦åŠ äº†é©±åŠ¨æ‰èƒ½ç”¨ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…·ä½“çš„å®ç°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨çš„å®ç°å®é™…ä¸Šè¿˜æ˜¯Hibernateã€‚</p><p>Spring Bootä¸­ä½¿ç”¨çš„Jpaå®é™…ä¸Šæ˜¯Spring Data Jpaï¼ŒSpring Dataæ˜¯Springå®¶æ—çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œç”¨äºç®€åŒ–SQLå’ŒNoSQLçš„è®¿é—®ï¼Œåœ¨Spring Dataä¸­ï¼Œåªè¦ä½ çš„æ–¹æ³•åç§°ç¬¦åˆè§„èŒƒï¼Œå®ƒå°±çŸ¥é“ä½ æƒ³å¹²å˜›ï¼Œä¸éœ€è¦è‡ªå·±å†å»å†™SQLã€‚</p><h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><p>åˆ›å»ºSpring Bootå·¥ç¨‹ï¼Œæ·»åŠ Webã€Jpaä»¥åŠMySQLé©±åŠ¨ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5-1-20210523202517154-20210525152813172.png" alt="img"></p><p>å·¥ç¨‹åˆ›å»ºå¥½ä¹‹åï¼Œæ·»åŠ Druidä¾èµ–ï¼Œå®Œæ•´çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¦‚æ­¤ï¼Œå·¥ç¨‹å°±ç®—åˆ›å»ºæˆåŠŸäº†ã€‚</p><h4 id="åŸºæœ¬é…ç½®-1"><a href="#åŸºæœ¬é…ç½®-1" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h4><p>å·¥ç¨‹åˆ›å»ºå®Œæˆåï¼Œåªéœ€è¦åœ¨application.propertiesä¸­è¿›è¡Œæ•°æ®åº“åŸºæœ¬ä¿¡æ¯é…ç½®ä»¥åŠJpaåŸºæœ¬é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># æ•°æ®åº“çš„åŸºæœ¬é…ç½®</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=UTF-8</span><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-comment"># JPAé…ç½®</span><span class="hljs-meta">spring.jpa.database</span>=<span class="hljs-string">mysql</span><span class="hljs-comment"># åœ¨æ§åˆ¶å°æ‰“å°SQL</span><span class="hljs-meta">spring.jpa.show-sql</span>=<span class="hljs-string">true</span><span class="hljs-comment"># æ•°æ®åº“å¹³å°</span><span class="hljs-meta">spring.jpa.database-platform</span>=<span class="hljs-string">mysql</span><span class="hljs-comment"># æ¯æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œæ•°æ®åº“åˆå§‹åŒ–ç­–ç•¥</span><span class="hljs-meta">spring.jpa.hibernate.ddl-auto</span>=<span class="hljs-string">update</span><span class="hljs-comment"># æŒ‡å®šé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¸ºInnoDB</span><span class="hljs-meta">spring.jpa.properties.hibernate.dialect</span>=<span class="hljs-string">org.hibernate.dialect.MySQL57Dialect</span></code></pre></div><p>æ³¨æ„è¿™é‡Œå’ŒJdbcTemplateä»¥åŠMyBatisæ¯”èµ·æ¥ï¼Œå¤šäº†Jpaé…ç½®ï¼ŒJpaé…ç½®å«ä¹‰æˆ‘éƒ½æ³¨é‡Šåœ¨ä»£ç ä¸­äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæœ€åä¸€è¡Œé…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨åˆ›å»ºè¡¨çš„æ—¶å€™ä¼šä½¿ç”¨MyISAMåšè¡¨çš„å¼•æ“ï¼Œå¦‚æœé…ç½®äº†æ•°æ®åº“æ–¹è¨€ä¸ºMySQL57Dialectï¼Œåˆ™ä½¿ç”¨InnoDBåšè¡¨çš„å¼•æ“</p><p>å¥½äº†ï¼Œé…ç½®å®Œæˆåï¼Œæˆ‘ä»¬çš„Jpaå·®ä¸å¤šå°±å¯ä»¥å¼€å§‹ç”¨äº†</p><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p>ORM(Object Relational Mapping)æ¡†æ¶è¡¨ç¤ºå¯¹è±¡å…³ç³»æ˜ å°„ï¼Œä½¿ç”¨ORMæ¡†æ¶æˆ‘ä»¬ä¸å¿…å†å»åˆ›å»ºè¡¨ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ ¹æ®å½“å‰é¡¹ç›®ä¸­çš„å®ä½“ç±»åˆ›å»ºç›¸åº”çš„æ•°æ®è¡¨ã€‚å› æ­¤ï¼Œæˆ‘è¿™é‡Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªUserå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Entity(name = &quot;t_user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@Column(name = &quot;name&quot;)</span>    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p>é¦–å…ˆ@Entityæ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œé‚£ä¹ˆåœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é’ˆå¯¹è¯¥ç±»ç”Ÿæˆä¸€å¼ è¡¨ï¼Œé»˜è®¤çš„è¡¨åä¸ºç±»åï¼Œ@Entityæ³¨è§£çš„nameå±æ€§è¡¨ç¤ºè‡ªå®šä¹‰ç”Ÿæˆçš„è¡¨åã€‚@Idæ³¨è§£è¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªidï¼Œ@GeneratedValueæ³¨è§£è¡¨ç¤ºä¸»é”®çš„è‡ªå¢é•¿ç­–ç•¥ï¼Œå¯¹äºç±»ä¸­çš„å…¶ä»–å±æ€§ï¼Œé»˜è®¤éƒ½ä¼šæ ¹æ®å±æ€§ååœ¨è¡¨ä¸­ç”Ÿæˆç›¸åº”çš„å­—æ®µï¼Œå­—æ®µåå’Œå±æ€§åç›¸åŒï¼Œå¦‚æœå¼€å‘è€…æƒ³è¦å¯¹å­—æ®µè¿›è¡Œå®šåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨@Columnæ³¨è§£ï¼Œå»é…ç½®å­—æ®µçš„åç§°ï¼Œé•¿åº¦ï¼Œæ˜¯å¦ä¸ºç©ºç­‰ç­‰ã€‚</p><p>åšå®Œè¿™ä¸€åˆ‡ä¹‹åï¼Œå¯åŠ¨Spring Booté¡¹ç›®ï¼Œå°±ä¼šå‘ç°æ•°æ®åº“ä¸­å¤šäº†ä¸€ä¸ªåä¸ºt_userçš„è¡¨äº†ã€‚</p><p>é’ˆå¯¹è¯¥è¡¨çš„æ“ä½œï¼Œåˆ™éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªRepositoryï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Integer</span>&gt; </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserByAddressEqualsAndIdLessThanEqual</span><span class="hljs-params">(String address, Integer id)</span></span>;    <span class="hljs-meta">@Query(value = &quot;select * from t_user where id=(select max(id) from t_user)&quot;,nativeQuery = true)</span>    <span class="hljs-function">User <span class="hljs-title">maxIdUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>è¿™é‡Œï¼Œè‡ªå®šä¹‰UserDaoæ¥å£ç»§æ‰¿è‡ªJpaRepositoryï¼ŒJpaRepositoryæä¾›äº†ä¸€äº›åŸºæœ¬çš„æ•°æ®æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ä¿å­˜ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼Œåˆ†é¡µæŸ¥è¯¢ç­‰ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨æ¥å£ä¸­è‡ªå·±å£°æ˜ç›¸å…³çš„æ–¹æ³•ï¼Œåªéœ€è¦æ–¹æ³•åç§°ç¬¦åˆè§„èŒƒå³å¯ï¼Œåœ¨Spring Dataä¸­ï¼Œåªè¦æŒ‰ç…§æ—¢å®šçš„è§„èŒƒå‘½åæ–¹æ³•ï¼ŒSpring Data Jpaå°±çŸ¥é“ä½ æƒ³å¹²å˜›ï¼Œè¿™æ ·å°±ä¸ç”¨å†™SQLäº†ï¼Œé‚£ä¹ˆè§„èŒƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5-2-20210525152813241.jpeg" alt="img"></p><p>å½“ç„¶ï¼Œè¿™ç§æ–¹æ³•å‘½åä¸»è¦æ˜¯é’ˆå¯¹æŸ¥è¯¢ï¼Œä½†æ˜¯ä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼Œå¯èƒ½å¹¶ä¸èƒ½é€šè¿‡è¿™ç§æ–¹å¼è§£å†³ï¼Œä¾‹å¦‚æƒ³è¦æŸ¥è¯¢idæœ€å¤§çš„ç”¨æˆ·ï¼Œè¿™æ—¶å°±éœ€è¦å¼€å‘è€…è‡ªå®šä¹‰æŸ¥è¯¢SQLäº†ï¼Œå¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œè‡ªå®šä¹‰æŸ¥è¯¢SQLï¼Œä½¿ç”¨@Queryæ³¨è§£ï¼Œåœ¨æ³¨è§£ä¸­å†™è‡ªå·±çš„SQLï¼Œé»˜è®¤ä½¿ç”¨çš„æŸ¥è¯¢è¯­è¨€ä¸æ˜¯SQLï¼Œè€Œæ˜¯JPQLï¼Œè¿™æ˜¯ä¸€ç§æ•°æ®åº“å¹³å°æ— å…³çš„é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œæœ‰ç‚¹å®šä½ç±»ä¼¼äºHibernateä¸­çš„HQLï¼Œåœ¨@Queryæ³¨è§£ä¸­è®¾ç½®nativeQueryå±æ€§ä¸ºtrueåˆ™è¡¨ç¤ºä½¿ç”¨åŸç”ŸæŸ¥è¯¢ï¼Œå³å¤§ä¼™æ‰€ç†Ÿæ‚‰çš„SQLã€‚ä¸Šé¢ä»£ç ä¸­çš„åªæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ç‚¹ï¼Œä¾‹å¦‚å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸­çš„SQLæ¶‰åŠåˆ°æ•°æ®æ“ä½œï¼Œåˆ™éœ€è¦ä½¿ç”¨@Modifyingæ³¨è§£ã€‚</p><p>å¥½äº†ï¼Œå®šä¹‰å®ŒDaoä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å°†UserDaoæ³¨å…¥åˆ°Controllerä¸­è¿›è¡Œæµ‹è¯•äº†(è¿™é‡Œä¸ºäº†çœäº‹ï¼Œå°±æ²¡æœ‰æä¾›Serviceäº†ï¼Œç›´æ¥å°†UserDaoæ³¨å…¥åˆ°Controllerä¸­)ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    UserDao userDao;    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUser</span><span class="hljs-params">()</span> </span>&#123;        User user = <span class="hljs-keyword">new</span> User();        user.setId(<span class="hljs-number">1</span>);        user.setUsername(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);        user.setAddress(<span class="hljs-string">&quot;æ·±åœ³&quot;</span>);        userDao.save(user);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">()</span> </span>&#123;        userDao.deleteById(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateUser</span><span class="hljs-params">()</span> </span>&#123;        User user = userDao.getOne(<span class="hljs-number">1</span>);        user.setUsername(<span class="hljs-string">&quot;æå››&quot;</span>);        userDao.flush();    &#125;    <span class="hljs-meta">@GetMapping(&quot;/test1&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;        List&lt;User&gt; all = userDao.findAll();        System.out.println(all);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/test2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;        List&lt;User&gt; list = userDao.getUserByAddressEqualsAndIdLessThanEqual(<span class="hljs-string">&quot;å¹¿å·&quot;</span>, <span class="hljs-number">2</span>);        System.out.println(list);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/test3&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;        User user = userDao.maxIdUser();        System.out.println(user);    &#125;&#125;</code></pre></div><p>å¦‚æ­¤ä¹‹åï¼Œå³å¯æŸ¥è¯¢åˆ°éœ€è¦çš„æ•°æ®ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åœ¨å’ŒSpringæ¡†æ¶æ•´åˆæ—¶ï¼Œå¦‚æœç”¨åˆ°ORMæ¡†æ¶ï¼Œå¤§éƒ¨åˆ†äººå¯èƒ½éƒ½æ˜¯é¦–é€‰Hibernateï¼Œå®é™…ä¸Šï¼Œåœ¨å’ŒSpring+SpringMVCæ•´åˆæ—¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©Spring Data Jpaåšæ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼Œç”¨æ³•å’Œæœ¬æ–‡æ‰€è¿°åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼ŒSpring Bootåªæ˜¯å°†Spring Data Jpaçš„é…ç½®ç®€åŒ–äº†ï¼Œå› æ­¤ï¼Œå¾ˆå¤šåˆå­¦è€…å¯¹Spring Data Jpaè§‰å¾—å¾ˆç¥å¥‡ï¼Œä½†æ˜¯åˆè§‰å¾—æ— ä»ä¸‹æ‰‹ï¼Œå…¶å®ï¼Œæ­¤æ—¶å¯ä»¥å›åˆ°Springæ¡†æ¶ï¼Œå…ˆå»å­¦ä¹ Jpaï¼Œå†å»å­¦ä¹ Spring Data Jpaï¼Œè¿™æ˜¯ç»™åˆå­¦è€…çš„ä¸€ç‚¹å»ºè®®ã€‚</p><h3 id="3-10-æ•´åˆå¤šæ•°æ®æº"><a href="#3-10-æ•´åˆå¤šæ•°æ®æº" class="headerlink" title="3.10 æ•´åˆå¤šæ•°æ®æº"></a>3.10 æ•´åˆå¤šæ•°æ®æº</h3><p>æœ¬æ–‡æ˜¯Spring Bootæ•´åˆæ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆçš„æœ€åä¸€ç¯‡ï¼Œä¸»è¦å’Œå¤§ä¼™æ¥èŠèŠSpring Bootæ•´åˆJpaå¤šæ•°æ®æºé—®é¢˜ã€‚åœ¨Spring Bootæ•´åˆJbdcTemplateå¤šæ•°æ®æºã€Spring Bootæ•´åˆMyBatiså¤šæ•°æ®æºä»¥åŠSpring Bootæ•´åˆJpaå¤šæ•°æ®æºè¿™ä¸‰ä¸ªçŸ¥è¯†ç‚¹ä¸­ï¼Œæ•´åˆJpaå¤šæ•°æ®æºç®—æ˜¯æœ€å¤æ‚çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººåœ¨é…ç½®æ—¶æœ€å®¹æ˜“å‡ºé”™çš„ä¸€ç§ã€‚</p><h4 id="3-10-1-å·¥ç¨‹åˆ›å»º"><a href="#3-10-1-å·¥ç¨‹åˆ›å»º" class="headerlink" title="3.10.1 å·¥ç¨‹åˆ›å»º"></a>3.10.1 å·¥ç¨‹åˆ›å»º</h4><p>é¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ªSpring Bootå·¥ç¨‹ï¼Œåˆ›å»ºæ—¶æ·»åŠ åŸºæœ¬çš„Webã€Jpaä»¥åŠMySQLä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5-1-20210523212051594-20210525152813172.png" alt="img"></p><p>åˆ›å»ºå®Œæˆåï¼Œæ·»åŠ Druidä¾èµ–ï¼Œè¿™é‡Œå’Œå‰æ–‡çš„è¦æ±‚ä¸€æ ·ï¼Œè¦ä½¿ç”¨ä¸“ä¸ºSpring Bootæ‰“é€ çš„Druidï¼Œå¤§ä¼™å¯èƒ½å‘ç°äº†ï¼Œå¦‚æœæ•´åˆå¤šæ•°æ®æºä¸€å®šè¦ä½¿ç”¨è¿™ä¸ªä¾èµ–ï¼Œå› ä¸ºè¿™ä¸ªä¾èµ–ä¸­æ‰æœ‰DruidDataSourceBuilderï¼Œæœ€åè¿˜è¦è®°å¾—é”å®šæ•°æ®åº“ä¾èµ–çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå¯èƒ½å¤§éƒ¨åˆ†äººç”¨çš„è¿˜æ˜¯5.xçš„MySQLè€Œä¸æ˜¯8.xã€‚å®Œæ•´ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¦‚æ­¤ä¹‹åï¼Œå·¥ç¨‹å°±åˆ›å»ºæˆåŠŸäº†ã€‚</p><h4 id="3-10-2-åŸºæœ¬é…ç½®"><a href="#3-10-2-åŸºæœ¬é…ç½®" class="headerlink" title="3.10.2 åŸºæœ¬é…ç½®"></a>3.10.2 åŸºæœ¬é…ç½®</h4><p>åœ¨åŸºæœ¬é…ç½®ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥é…ç½®å¤šæ•°æ®æºåŸºæœ¬ä¿¡æ¯ä»¥åŠDataSourceï¼Œé¦–å…ˆåœ¨application.propertiesä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#  æ•°æ®æºä¸€</span><span class="hljs-meta">spring.datasource.one.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.one.url</span>=<span class="hljs-string">jdbc:mysql:///test01?useUnicode=true&amp;characterEncoding=UTF-8</span><span class="hljs-meta">spring.datasource.one.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-comment">#  æ•°æ®æºäºŒ</span><span class="hljs-meta">spring.datasource.two.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.two.url</span>=<span class="hljs-string">jdbc:mysql:///test02?useUnicode=true&amp;characterEncoding=UTF-8</span><span class="hljs-meta">spring.datasource.two.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-comment"># Jpaé…ç½®</span><span class="hljs-meta">spring.jpa.properties.database</span>=<span class="hljs-string">mysql</span><span class="hljs-meta">spring.jpa.properties.show-sql</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.jpa.properties.database-platform</span>=<span class="hljs-string">mysql</span><span class="hljs-meta">spring.jpa.properties.hibernate.ddl-auto</span>=<span class="hljs-string">update</span><span class="hljs-meta">spring.jpa.properties.hibernate.dialect</span>=<span class="hljs-string">org.hibernate.dialect.MySQL57Dialect</span></code></pre></div><p>è¿™é‡ŒJpaçš„é…ç½®å’Œä¸Šæ–‡ç›¸æ¯”keyä¸­å¤šäº†propertiesï¼Œå¤šæ•°æ®æºçš„é…ç½®å’Œå‰æ–‡ä¸€è‡´ï¼Œç„¶åæ¥ä¸‹æ¥é…ç½®ä¸¤ä¸ªDataSourceï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.one&quot;)</span>    <span class="hljs-meta">@Primary</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsOne</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.two&quot;)</span>    <span class="hljs-function">DataSource <span class="hljs-title">dsTwo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> DruidDataSourceBuilder.create().build();    &#125;&#125;</code></pre></div><p>è¿™é‡Œçš„é…ç½®å’Œå‰æ–‡çš„å¤šæ•°æ®æºé…ç½®åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯æ³¨æ„å¤šäº†ä¸€ä¸ªåœ¨Springä¸­ä½¿ç”¨è¾ƒå°‘çš„æ³¨è§£@Primaryï¼Œè¿™ä¸ªæ³¨è§£ä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™åœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¼šå‡ºé”™ï¼Œ@Primaryè¡¨ç¤ºå½“æŸä¸€ä¸ªç±»å­˜åœ¨å¤šä¸ªå®ä¾‹æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨å“ªä¸ªå®ä¾‹ã€‚</p><h4 id="3-10-3-å¤šæ•°æ®æºé…ç½®"><a href="#3-10-3-å¤šæ•°æ®æºé…ç½®" class="headerlink" title="3.10.3 å¤šæ•°æ®æºé…ç½®"></a>3.10.3 å¤šæ•°æ®æºé…ç½®</h4><p>æ¥ä¸‹æ¥é…ç½®Jpaçš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œä¸¤ä¸ªæ•°æ®æºï¼Œæˆ‘åˆ†åˆ«åœ¨ä¸¤ä¸ªç±»ä¸­æ¥é…ç½®ï¼Œå…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableJpaRepositories(basePackages = &quot;org.sang.jpa.dao&quot;,entityManagerFactoryRef = &quot;localContainerEntityManagerFactoryBeanOne&quot;,transactionManagerRef = &quot;platformTransactionManagerOne&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JpaConfigOne</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-meta">@Qualifier(value = &quot;dsOne&quot;)</span>    DataSource dsOne;    <span class="hljs-meta">@Autowired</span>    JpaProperties jpaProperties;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@Primary</span>    <span class="hljs-function">LocalContainerEntityManagerFactoryBean <span class="hljs-title">localContainerEntityManagerFactoryBeanOne</span><span class="hljs-params">(EntityManagerFactoryBuilder builder)</span> </span>&#123;        <span class="hljs-keyword">return</span> builder.dataSource(dsOne)                .packages(<span class="hljs-string">&quot;org.sang.jpa.model&quot;</span>)                .properties(jpaProperties.getProperties())                .persistenceUnit(<span class="hljs-string">&quot;pu1&quot;</span>)                .build();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PlatformTransactionManager <span class="hljs-title">platformTransactionManagerOne</span><span class="hljs-params">(EntityManagerFactoryBuilder builder)</span> </span>&#123;        LocalContainerEntityManagerFactoryBean factoryBeanOne = localContainerEntityManagerFactoryBeanOne(builder);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JpaTransactionManager(factoryBeanOne.getObject());    &#125;&#125;</code></pre></div><p>é¦–å…ˆè¿™é‡Œæ³¨å…¥dsOneï¼Œå†æ³¨å…¥JpaPropertiesï¼ŒJpaPropertiesæ˜¯ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªå®ä¾‹ï¼Œé‡Œè¾¹çš„æ•°æ®å°±æ˜¯æˆ‘ä»¬åœ¨application.propertiesä¸­é…ç½®çš„jpaç›¸å…³çš„é…ç½®ã€‚ç„¶åæˆ‘ä»¬æä¾›ä¸¤ä¸ªBeanï¼Œåˆ†åˆ«æ˜¯LocalContainerEntityManagerFactoryBeanå’ŒPlatformTransactionManageräº‹åŠ¡ç®¡ç†å™¨ï¼Œä¸åŒäºMyBatiså’ŒJdbcTemplateï¼Œåœ¨Jpaä¸­ï¼Œäº‹åŠ¡ä¸€å®šè¦é…ç½®ã€‚åœ¨æä¾›LocalContainerEntityManagerFactoryBeançš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®špackagesï¼Œè¿™é‡Œçš„packagesæŒ‡å®šçš„åŒ…å°±æ˜¯è¿™ä¸ªæ•°æ®æºå¯¹åº”çš„å®ä½“ç±»æ‰€åœ¨çš„ä½ç½®ï¼Œå¦å¤–åœ¨è¿™é‡Œé…ç½®ç±»ä¸Šé€šè¿‡@EnableJpaRepositoriesæ³¨è§£æŒ‡å®šdaoæ‰€åœ¨çš„ä½ç½®ï¼Œä»¥åŠLocalContainerEntityManagerFactoryBeanå’ŒPlatformTransactionManageråˆ†åˆ«å¯¹åº”çš„å¼•ç”¨çš„åå­—ã€‚</p><p>å¥½äº†ï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªå°±é…ç½®å¥½äº†ï¼Œç¬¬äºŒä¸ªåŸºæœ¬å’Œè¿™ä¸ªç±»ä¼¼ï¼Œä¸»è¦æœ‰å‡ ä¸ªä¸åŒç‚¹ï¼š</p><ul><li>daoçš„ä½ç½®ä¸åŒ</li><li>persistenceUnitä¸åŒ</li><li>ç›¸å…³beançš„åç§°ä¸åŒ</li></ul><p>æ³¨æ„å®ä½“ç±»å¯ä»¥å…±ç”¨ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableJpaRepositories(basePackages = &quot;org.sang.jpa.dao2&quot;,entityManagerFactoryRef = &quot;localContainerEntityManagerFactoryBeanTwo&quot;,transactionManagerRef = &quot;platformTransactionManagerTwo&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JpaConfigTwo</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-meta">@Qualifier(value = &quot;dsTwo&quot;)</span>    DataSource dsTwo;    <span class="hljs-meta">@Autowired</span>    JpaProperties jpaProperties;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">LocalContainerEntityManagerFactoryBean <span class="hljs-title">localContainerEntityManagerFactoryBeanTwo</span><span class="hljs-params">(EntityManagerFactoryBuilder builder)</span> </span>&#123;        <span class="hljs-keyword">return</span> builder.dataSource(dsTwo)                .packages(<span class="hljs-string">&quot;org.sang.jpa.model&quot;</span>)                .properties(jpaProperties.getProperties())                .persistenceUnit(<span class="hljs-string">&quot;pu2&quot;</span>)                .build();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PlatformTransactionManager <span class="hljs-title">platformTransactionManagerTwo</span><span class="hljs-params">(EntityManagerFactoryBuilder builder)</span> </span>&#123;        LocalContainerEntityManagerFactoryBean factoryBeanTwo = localContainerEntityManagerFactoryBeanTwo(builder);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JpaTransactionManager(factoryBeanTwo.getObject());    &#125;&#125;</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨å¯¹åº”ä½ç½®åˆ†åˆ«æä¾›ç›¸å…³çš„å®ä½“ç±»å’Œdaoå³å¯ï¼Œæ•°æ®æºä¸€çš„daoå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.sang.jpa.dao;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Integer</span>&gt; </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserByAddressEqualsAndIdLessThanEqual</span><span class="hljs-params">(String address, Integer id)</span></span>;    <span class="hljs-meta">@Query(value = &quot;select * from t_user where id=(select max(id) from t_user)&quot;,nativeQuery = true)</span>    <span class="hljs-function">User <span class="hljs-title">maxIdUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>æ•°æ®æºäºŒçš„daoå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.sang.jpa.dao2;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Integer</span>&gt; </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getUserByAddressEqualsAndIdLessThanEqual</span><span class="hljs-params">(String address, Integer id)</span></span>;    <span class="hljs-meta">@Query(value = &quot;select * from t_user where id=(select max(id) from t_user)&quot;,nativeQuery = true)</span>    <span class="hljs-function">User <span class="hljs-title">maxIdUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>å…±åŒçš„å®ä½“ç±»å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.sang.jpa.model;<span class="hljs-meta">@Entity(name = &quot;t_user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p>åˆ°æ­¤ï¼Œæ‰€æœ‰çš„é…ç½®å°±ç®—å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨Serviceä¸­æ³¨å…¥ä¸åŒçš„UserDaoï¼Œä¸åŒçš„UserDaoæ“ä½œä¸åŒçš„æ•°æ®æºã€‚</p><h1 id="SpringBootæ•´åˆNoSQL"><a href="#SpringBootæ•´åˆNoSQL" class="headerlink" title="SpringBootæ•´åˆNoSQL"></a>SpringBootæ•´åˆNoSQL</h1><h2 id="1-æ•´åˆRedis"><a href="#1-æ•´åˆRedis" class="headerlink" title="1. æ•´åˆRedis"></a>1. æ•´åˆRedis</h2><h3 id="1-1-åˆ›å»ºå·¥ç¨‹"><a href="#1-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="1.1 åˆ›å»ºå·¥ç¨‹"></a>1.1 åˆ›å»ºå·¥ç¨‹</h3><p>åˆ›å»ºå·¥ç¨‹ï¼Œå¼•å…¥ Redis ä¾èµ–ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13-2-20210525152434590.png" alt="img"></p><p>åˆ›å»ºæˆåŠŸåï¼Œè¿˜éœ€è¦æ‰‹åŠ¨å¼•å…¥ commos-pool2 çš„ä¾èµ–ï¼Œå› æ­¤æœ€ç»ˆå®Œæ•´çš„ pom.xml ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>è¿™é‡Œä¸»è¦å°±æ˜¯å¼•å…¥äº† Spring Data Redis + è¿æ¥æ± ã€‚</p><h3 id="1-2-é…ç½®-Redis-ä¿¡æ¯"><a href="#1-2-é…ç½®-Redis-ä¿¡æ¯" class="headerlink" title="1.2 é…ç½® Redis ä¿¡æ¯"></a>1.2 é…ç½® Redis ä¿¡æ¯</h3><p>æ¥ä¸‹æ¥é…ç½® Redis çš„ä¿¡æ¯ï¼Œä¿¡æ¯åŒ…å«ä¸¤æ–¹é¢ï¼Œä¸€æ–¹é¢æ˜¯ Redis çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯è¿æ¥æ± ä¿¡æ¯:</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span><span class="hljs-comment">#æ²¡æœ‰å°±ç©ºç€</span><span class="hljs-meta">spring.redis.password</span>=<span class="hljs-string">123</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">192.168.66.128</span><span class="hljs-meta">spring.redis.lettuce.pool.min-idle</span>=<span class="hljs-string">5</span><span class="hljs-meta">spring.redis.lettuce.pool.max-idle</span>=<span class="hljs-string">10</span><span class="hljs-meta">spring.redis.lettuce.pool.max-active</span>=<span class="hljs-string">8</span><span class="hljs-meta">spring.redis.lettuce.pool.max-wait</span>=<span class="hljs-string">1ms</span><span class="hljs-meta">spring.redis.lettuce.shutdown-timeout</span>=<span class="hljs-string">100ms</span></code></pre></div><h3 id="1-3-è‡ªåŠ¨é…ç½®"><a href="#1-3-è‡ªåŠ¨é…ç½®" class="headerlink" title="1.3 è‡ªåŠ¨é…ç½®"></a>1.3 è‡ªåŠ¨é…ç½®</h3><p>å½“å¼€å‘è€…åœ¨é¡¹ç›®ä¸­å¼•å…¥äº† Spring Data Redis ï¼Œå¹¶ä¸”é…ç½®äº† Redis çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ­¤æ—¶ï¼Œè‡ªåŠ¨åŒ–é…ç½®å°±ä¼šç”Ÿæ•ˆã€‚</p><p>æˆ‘ä»¬ä» Spring Boot ä¸­ Redis çš„è‡ªåŠ¨åŒ–é…ç½®ç±»ä¸­å°±å¯ä»¥çœ‹å‡ºç«¯å€ªï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass(RedisOperations.class)</span><span class="hljs-meta">@EnableConfigurationProperties(RedisProperties.class)</span><span class="hljs-meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisAutoConfiguration</span> </span>&#123;        <span class="hljs-meta">@Bean</span>        <span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">                        RedisConnectionFactory redisConnectionFactory)</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;                RedisTemplate&lt;Object, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();                template.setConnectionFactory(redisConnectionFactory);                <span class="hljs-keyword">return</span> template;        &#125;          <span class="hljs-meta">@Bean</span>        <span class="hljs-meta">@ConditionalOnMissingBean</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> StringRedisTemplate <span class="hljs-title">stringRedisTemplate</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">                        RedisConnectionFactory redisConnectionFactory)</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;                StringRedisTemplate template = <span class="hljs-keyword">new</span> StringRedisTemplate();                template.setConnectionFactory(redisConnectionFactory);                <span class="hljs-keyword">return</span> template;        &#125;&#125;</code></pre></div><p>è¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»å¾ˆå¥½ç†è§£ï¼š</p><ul><li>é¦–å…ˆæ ‡è®°è¿™ä¸ªæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼ŒåŒæ—¶è¯¥é…ç½®åœ¨ RedisOperations å­˜åœ¨çš„æƒ…å†µä¸‹æ‰ä¼šç”Ÿæ•ˆ(å³é¡¹ç›®ä¸­å¼•å…¥äº† Spring Data Redis)</li><li>ç„¶åå¯¼å…¥åœ¨ application.properties ä¸­é…ç½®çš„å±æ€§</li><li>ç„¶åå†å¯¼å…¥è¿æ¥æ± ä¿¡æ¯ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰</li><li>æœ€åï¼Œæä¾›äº†ä¸¤ä¸ª Bean ï¼ŒRedisTemplate å’Œ StringRedisTemplate ï¼Œå…¶ä¸­ StringRedisTemplate æ˜¯ RedisTemplate çš„å­ç±»ï¼Œä¸¤ä¸ªçš„æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„ä¸»è¦ä½“ç°åœ¨æ“ä½œçš„æ•°æ®ç±»å‹ä¸åŒï¼ŒRedisTemplate ä¸­çš„ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯ Object ï¼Œæ„å‘³è€…å­˜å‚¨çš„ key å’Œ value éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ StringRedisTemplate çš„ ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯ String ï¼Œæ„å‘³è€… StringRedisTemplate çš„ key å’Œ value éƒ½åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚å¦‚æœå¼€å‘è€…æ²¡æœ‰æä¾›ç›¸å…³çš„ Bean ï¼Œè¿™ä¸¤ä¸ªé…ç½®å°±ä¼šç”Ÿæ•ˆï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆã€‚</li></ul><h3 id="1-4-ä½¿ç”¨"><a href="#1-4-ä½¿ç”¨" class="headerlink" title="1.4 ä½¿ç”¨"></a>1.4 ä½¿ç”¨</h3><p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥ç›´æ¥åœ¨ Service ä¸­æ³¨å…¥ StringRedisTemplate æˆ–è€… RedisTemplate æ¥ä½¿ç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RedisTemplate redisTemplate;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        ValueOperations ops = redisTemplate.opsForValue();        ops.set(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;v1&quot;</span>);        Object k1 = ops.get(<span class="hljs-string">&quot;k1&quot;</span>);        System.out.println(k1);    &#125;&#125;</code></pre></div><p>Redis ä¸­çš„æ•°æ®æ“ä½œï¼Œå¤§ä½“ä¸Šæ¥è¯´ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>é’ˆå¯¹ key çš„æ“ä½œï¼Œç›¸å…³çš„æ–¹æ³•å°±åœ¨ RedisTemplate ä¸­</li><li>é’ˆå¯¹å…·ä½“æ•°æ®ç±»å‹çš„æ“ä½œï¼Œç›¸å…³çš„æ–¹æ³•éœ€è¦é¦–å…ˆè·å–å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œè·å–ç›¸åº”æ•°æ®ç±»å‹çš„æ“ä½œæ–¹æ³•æ˜¯ opsForXXX</li></ul><p>è°ƒç”¨è¯¥æ–¹æ³•å°±å¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ° Redis ä¸­å»äº†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13-3-20210525152434572.png" alt="img"></p><p>k1 å‰é¢çš„å­—ç¬¦æ˜¯ç”±äºä½¿ç”¨äº† RedisTemplate å¯¼è‡´çš„ï¼ŒRedisTemplate å¯¹ key è¿›è¡Œåºåˆ—åŒ–ä¹‹åçš„ç»“æœã€‚</p><p>RedisTemplate ä¸­ï¼Œkey é»˜è®¤çš„åºåˆ—åŒ–æ–¹æ¡ˆæ˜¯ JdkSerializationRedisSerializer ã€‚</p><p>è€Œåœ¨ StringRedisTemplate ä¸­ï¼Œkey é»˜è®¤çš„åºåˆ—åŒ–æ–¹æ¡ˆæ˜¯ StringRedisSerializer ï¼Œå› æ­¤ï¼Œå¦‚æœä½¿ç”¨ StringRedisTemplate ï¼Œé»˜è®¤æƒ…å†µä¸‹ key å‰é¢ä¸ä¼šæœ‰å‰ç¼€ã€‚</p><p>ä¸è¿‡å¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ RedisTemplate ä¸­çš„åºåˆ—åŒ–æ–¹æ¡ˆï¼Œå¦‚ä¸‹:</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RedisTemplate redisTemplate;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> StringRedisSerializer());        ValueOperations ops = redisTemplate.opsForValue();        ops.set(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;v1&quot;</span>);        Object k1 = ops.get(<span class="hljs-string">&quot;k1&quot;</span>);        System.out.println(k1);    &#125;&#125;</code></pre></div><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ StringRedisTemplateï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    StringRedisTemplate stringRedisTemplate;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello2</span><span class="hljs-params">()</span> </span>&#123;        ValueOperations ops = stringRedisTemplate.opsForValue();        ops.set(<span class="hljs-string">&quot;k2&quot;</span>, <span class="hljs-string">&quot;v2&quot;</span>);        Object k1 = ops.get(<span class="hljs-string">&quot;k2&quot;</span>);        System.out.println(k1);    &#125;&#125;</code></pre></div><p>å¦å¤–éœ€è¦æ³¨æ„ ï¼ŒSpring Boot çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œåªèƒ½é…ç½®å•æœºçš„ Redis ï¼Œå¦‚æœæ˜¯ Redis é›†ç¾¤ï¼Œåˆ™æ‰€æœ‰çš„ä¸œè¥¿éƒ½éœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½®</p><h3 id="1-5-è§£å†³æ¥å£å¹‚ç­‰æ€§"><a href="#1-5-è§£å†³æ¥å£å¹‚ç­‰æ€§" class="headerlink" title="1.5 è§£å†³æ¥å£å¹‚ç­‰æ€§"></a>1.5 è§£å†³æ¥å£å¹‚ç­‰æ€§</h3><p>åˆ©ç”¨Serviceæ“ä½œRedis</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    StringRedisTemplate stringRedisTemplate;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">setEx</span><span class="hljs-params">(String key, String value, Long expireTime)</span> </span>&#123;        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;        <span class="hljs-keyword">try</span> &#123;            ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.opsForValue();            ops.set(key,value);            stringRedisTemplate.expire(key, expireTime, TimeUnit.SECONDS);            result = <span class="hljs-keyword">true</span>;        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> result;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">exists</span><span class="hljs-params">(String key)</span> </span>&#123;        <span class="hljs-keyword">return</span> stringRedisTemplate.hasKey(key);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(String key)</span> </span>&#123;        <span class="hljs-keyword">if</span> (exists(key)) &#123;            <span class="hljs-keyword">return</span> stringRedisTemplate.delete(key);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TokenService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RedisService redisService;    <span class="hljs-comment">//åˆ›å»º</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">createToken</span><span class="hljs-params">()</span> </span>&#123;        String uuid = UUID.randomUUID().toString();        redisService.setEx(uuid, uuid, <span class="hljs-number">10000L</span>);        <span class="hljs-keyword">return</span> uuid;    &#125;    <span class="hljs-comment">//æ£€æŸ¥</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">checkToken</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IdempotentException </span>&#123;        String token = request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(token)) &#123;            token = request.getParameter(<span class="hljs-string">&quot;token&quot;</span>);            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(token)) &#123;                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IdempotentException(<span class="hljs-string">&quot;token ä¸å­˜åœ¨&quot;</span>);            &#125;        &#125;        <span class="hljs-keyword">if</span> (!redisService.exists(token)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IdempotentException(<span class="hljs-string">&quot;é‡å¤æ“ä½œï¼&quot;</span>);        &#125;        <span class="hljs-keyword">boolean</span> remove = redisService.remove(token);        <span class="hljs-keyword">if</span> (!remove) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IdempotentException(<span class="hljs-string">&quot;é‡å¤æ“ä½œï¼&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><p><strong>è‡ªå®šä¹‰æ³¨è§£</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æœ‰æ­¤æ–¹æ³•ä»£è¡¨éœ€è¦å¤„ç†å¹‚ç­‰æ€§é—®é¢˜</span><span class="hljs-meta">@Target(ElementType.METHOD)</span><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoIdempotent &#123;&#125;</code></pre></div><p><strong>è‡ªå®šä¹‰å¼‚å¸¸</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdempotentException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Exception</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IdempotentException</span><span class="hljs-params">(String message)</span> </span>&#123;        <span class="hljs-keyword">super</span>(message);    &#125;&#125;<span class="hljs-comment">//å…¨å±€å¼‚å¸¸å¤„ç†å™¨</span><span class="hljs-meta">@RestControllerAdvice</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalException</span> </span>&#123;    <span class="hljs-meta">@ExceptionHandler(IdempotentException.class)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">idempotentException</span><span class="hljs-params">(IdempotentException e)</span> </span>&#123;        <span class="hljs-keyword">return</span> e.getMessage();    &#125;&#125;</code></pre></div><h4 id="åˆ©ç”¨æ‹¦æˆªå™¨çš„è§£å†³æ–¹æ¡ˆ"><a href="#åˆ©ç”¨æ‹¦æˆªå™¨çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ©ç”¨æ‹¦æˆªå™¨çš„è§£å†³æ–¹æ¡ˆ"></a><strong>åˆ©ç”¨æ‹¦æˆªå™¨çš„è§£å†³æ–¹æ¡ˆ</strong></h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdempotentInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    TokenService tokenService;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//ä¸æ˜¯ç›´æ¥æ”¾è¡Œ</span>        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;        Method method = ((HandlerMethod) handler).getMethod();        AutoIdempotent idempotent = method.getAnnotation(AutoIdempotent.class);        <span class="hljs-comment">//è‡ªå®šä¹‰çš„æ³¨è§£ä¸ä¸ºç©ºï¼Œè¯´æ˜åŠ äº†æ³¨è§£ï¼Œè¦è¿›è¡Œå¹‚ç­‰æ€§å¤„ç†</span>        <span class="hljs-keyword">if</span> (idempotent != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">return</span> tokenService.checkToken(request);            &#125; <span class="hljs-keyword">catch</span> (IdempotentException e) &#123;                <span class="hljs-keyword">throw</span> e;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><p>é…ç½®ç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    IdempotentInterceptor idempotentInterceptor;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;        registry.addInterceptor(idempotentInterceptor).addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    TokenService tokenService;    <span class="hljs-meta">@GetMapping(&quot;/gettoken&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getToken</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> tokenService.createToken();    &#125;    <span class="hljs-meta">@PostMapping(&quot;/hello&quot;)</span>    <span class="hljs-meta">@AutoIdempotent</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;    <span class="hljs-meta">@PostMapping(&quot;/hello2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello2</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello2&quot;</span>;    &#125;&#125;</code></pre></div><h4 id="åˆ©ç”¨AOPçš„è§£å†³æ–¹æ¡ˆ"><a href="#åˆ©ç”¨AOPçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ©ç”¨AOPçš„è§£å†³æ–¹æ¡ˆ"></a>åˆ©ç”¨AOPçš„è§£å†³æ–¹æ¡ˆ</h4><p>å› ä¸ºè¦ä½¿ç”¨AOPï¼ŒæŠŠIdempotentInterceptorä¸Šçš„@Componentæ³¨è§£æ‰ï¼Œè®©å…¶å¤±æ•ˆï¼ŒåŒæ—¶è®©WebMvcConfigä¹Ÿå¤±æ•ˆï¼Œç„¶ååˆ›å»ºå³å¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@Aspect</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdempotentAspect</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    TokenService tokenService;    <span class="hljs-comment">//åŠ äº†è‡ªå®šä¹‰æ³¨è§£çš„</span>    <span class="hljs-meta">@Pointcut(&quot;@annotation(org.javaboy.idempontent.anno.AutoIdempotent)&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pc1</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-comment">//å‰ç½®é€šçŸ¥</span>    <span class="hljs-meta">@Before(&quot;pc1()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IdempotentException </span>&#123;        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();        <span class="hljs-keyword">try</span> &#123;            tokenService.checkToken(request);        &#125; <span class="hljs-keyword">catch</span> (IdempotentException e) &#123;            <span class="hljs-keyword">throw</span> e;        &#125;    &#125;&#125;</code></pre></div><h2 id="2-sessionå…±äº«"><a href="#2-sessionå…±äº«" class="headerlink" title="2. sessionå…±äº«"></a>2. sessionå…±äº«</h2><p>åœ¨ä¼ ç»Ÿçš„å•æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¸å­˜åœ¨ Session å…±äº«é—®é¢˜ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼/é›†ç¾¤é¡¹ç›®ä¸­ï¼ŒSession å…±äº«åˆ™æ˜¯ä¸€ä¸ªå¿…é¡»é¢å¯¹çš„é—®é¢˜ï¼Œå…ˆçœ‹ä¸€ä¸ªç®€å•çš„æ¶æ„å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-1-20210525152434632.png" alt="img"></p><p>åœ¨è¿™æ ·çš„æ¶æ„ä¸­ï¼Œä¼šå‡ºç°ä¸€äº›å•æœåŠ¡ä¸­ä¸å­˜åœ¨çš„é—®é¢˜ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚åˆ°è¾¾ Nginx ä¸Šä¹‹åï¼Œè¢« Nginx è½¬å‘åˆ° Tomcat A ä¸Šï¼Œç„¶ååœ¨ Tomcat A ä¸Šå¾€ session ä¸­ä¿å­˜äº†ä¸€ä»½æ•°æ®ï¼Œä¸‹æ¬¡åˆæ¥ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚è¢«è½¬å‘åˆ° Tomcat B ä¸Šï¼Œæ­¤æ—¶å†å» Session ä¸­è·å–æ•°æ®ï¼Œå‘ç°æ²¡æœ‰ä¹‹å‰çš„æ•°æ®ã€‚å¯¹äºè¿™ä¸€ç±»é—®é¢˜çš„è§£å†³ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯å°†å„ä¸ªæœåŠ¡ä¹‹é—´éœ€è¦å…±äº«çš„æ•°æ®ï¼Œä¿å­˜åˆ°ä¸€ä¸ªå…¬å…±çš„åœ°æ–¹ï¼ˆä¸»æµæ–¹æ¡ˆå°±æ˜¯ Redisï¼‰ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-2-20210525152434653.png" alt="img"></p><p>å½“æ‰€æœ‰ Tomcat éœ€è¦å¾€ Session ä¸­å†™æ•°æ®æ—¶ï¼Œéƒ½å¾€ Redis ä¸­å†™ï¼Œå½“æ‰€æœ‰ Tomcat éœ€è¦è¯»æ•°æ®æ—¶ï¼Œéƒ½ä» Redis ä¸­è¯»ã€‚è¿™æ ·ï¼Œä¸åŒçš„æœåŠ¡å°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ Session æ•°æ®äº†ã€‚</p><p>è¿™æ ·çš„æ–¹æ¡ˆï¼Œå¯ä»¥ç”±å¼€å‘è€…æ‰‹åŠ¨å®ç°ï¼Œå³æ‰‹åŠ¨å¾€ Redis ä¸­å­˜å‚¨æ•°æ®ï¼Œæ‰‹åŠ¨ä» Redis ä¸­è¯»å–æ•°æ®ï¼Œç›¸å½“äºä½¿ç”¨ä¸€äº› Redis å®¢æˆ·ç«¯å·¥å…·æ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œæ¯«æ— ç–‘é—®ï¼Œæ‰‹åŠ¨å®ç°å·¥ä½œé‡è¿˜æ˜¯è›®å¤§çš„ã€‚</p><p>ä¸€ä¸ªç®€åŒ–çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Spring Session æ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼ŒSpring Session å°±æ˜¯ä½¿ç”¨ Spring ä¸­çš„ä»£ç†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰çš„ Session æ“ä½œæ‹¦æˆªä¸‹æ¥ï¼Œè‡ªåŠ¨çš„å°†æ•°æ® åŒæ­¥åˆ° Redis ä¸­ï¼Œæˆ–è€…è‡ªåŠ¨çš„ä» Redis ä¸­è¯»å–æ•°æ®ã€‚</p><p>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæ‰€æœ‰å…³äº Session åŒæ­¥çš„æ“ä½œéƒ½æ˜¯é€æ˜çš„ï¼Œå¼€å‘è€…ä½¿ç”¨ Spring Sessionï¼Œä¸€æ—¦é…ç½®å®Œæˆåï¼Œå…·ä½“çš„ç”¨æ³•å°±åƒä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ Session ä¸€æ ·ã€‚</p><h3 id="2-1-åˆ›å»ºå·¥ç¨‹"><a href="#2-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="2.1 åˆ›å»ºå·¥ç¨‹"></a>2.1 åˆ›å»ºå·¥ç¨‹</h3><p>é¦–å…ˆ åˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹ï¼Œå¼•å…¥ Webã€Spring Session ä»¥åŠ Redis:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-3-20210525152434702.png" alt="img"></p><p>åˆ›å»ºæˆåŠŸä¹‹åï¼Œpom.xml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬æ˜¯ 2.1.4 ï¼Œå¦‚æœä½¿ç”¨å½“å‰æœ€æ–°ç‰ˆ Spring Boot2.1.5 çš„è¯ï¼Œé™¤äº†ä¸Šé¢è¿™äº›ä¾èµ–ä¹‹å¤–ï¼Œéœ€è¦é¢å¤–æ·»åŠ  Spring Security ä¾èµ–ï¼ˆå…¶ä»–æ“ä½œä¸å—å½±å“ï¼Œä»…ä»…åªæ˜¯å¤šäº†ä¸€ä¸ªä¾èµ–ï¼Œå½“ç„¶ä¹Ÿå¤šäº† Spring Security çš„ä¸€äº›é»˜è®¤è®¤è¯æµç¨‹ï¼‰ã€‚</p><h3 id="2-2-é…ç½®-Redis"><a href="#2-2-é…ç½®-Redis" class="headerlink" title="2.2 é…ç½® Redis"></a>2.2 é…ç½® Redis</h3><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">192.168.66.128</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-comment">#spring.redis.password=123</span><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span></code></pre></div><p>è¿™é‡Œçš„ Redis ï¼Œæˆ‘è™½ç„¶é…ç½®äº†å››è¡Œï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç«¯å£é»˜è®¤å°±æ˜¯ 6379 ï¼Œdatabase é»˜è®¤å°±æ˜¯ 0ï¼Œæ‰€ä»¥çœŸæ­£è¦é…ç½®çš„ï¼Œå…¶å®å°±æ˜¯ä¸¤è¡Œã€‚</p><h3 id="2-3-ä½¿ç”¨"><a href="#2-3-ä½¿ç”¨" class="headerlink" title="2.3 ä½¿ç”¨"></a>2.3 ä½¿ç”¨</h3><p>é…ç½®å®Œæˆå ï¼Œå°±å¯ä»¥ä½¿ç”¨ Spring Session äº†ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨æ™®é€šçš„ HttpSession ï¼Œå…¶ä»–çš„ Session åŒæ­¥åˆ° Redis ç­‰æ“ä½œï¼Œæ¡†æ¶å·²ç»è‡ªåŠ¨å¸®ä½ å®Œæˆäº†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span>    Integer port;    <span class="hljs-meta">@GetMapping(&quot;/set&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">set</span><span class="hljs-params">(HttpSession session)</span> </span>&#123;        session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> String.valueOf(port);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/get&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">(HttpSession session)</span> </span>&#123;        <span class="hljs-keyword">return</span> session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>) + <span class="hljs-string">&quot;:&quot;</span> + port;    &#125;&#125;</code></pre></div><p>è€ƒè™‘åˆ°ä¸€ä¼š Spring Boot å°†ä»¥é›†ç¾¤çš„æ–¹å¼å¯åŠ¨ ï¼Œä¸ºäº†è·å–æ¯ä¸€ä¸ªè¯·æ±‚åˆ°åº•æ˜¯å“ªä¸€ä¸ª Spring Boot æä¾›çš„æœåŠ¡ï¼Œéœ€è¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶è¿”å›å½“å‰æœåŠ¡çš„ç«¯å£å·ï¼Œå› æ­¤è¿™é‡Œæˆ‘æ³¨å…¥äº† server.port </p><p>æ¥ä¸‹æ¥ ï¼Œé¡¹ç›®æ‰“åŒ…ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-4-20210525152434653.png" alt="img"></p><p>æ‰“åŒ…ä¹‹åï¼Œå¯åŠ¨é¡¹ç›®çš„ä¸¤ä¸ªå®ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8080java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8081</code></pre></div><p>ç„¶åå…ˆè®¿é—® <code>localhost:8080/set</code> å‘ <code>8080</code> è¿™ä¸ªæœåŠ¡çš„ <code>Session</code> ä¸­ä¿å­˜ä¸€ä¸ªå˜é‡ï¼Œè®¿é—®å®Œæˆåï¼Œæ•°æ®å°±å·²ç»è‡ªåŠ¨åŒæ­¥åˆ° <code>Redis</code> ä¸­ äº† ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-5-20210525152434610.png" alt="img"></p><p>ç„¶åï¼Œå†è°ƒç”¨ <code>localhost:8081/get</code> æ¥å£ï¼Œå°±å¯ä»¥è·å–åˆ° <code>8080</code> æœåŠ¡çš„ <code>session</code> ä¸­çš„æ•°æ®ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-6-20210525152434632.png" alt="img"></p><p>æ­¤æ—¶å…³äº session å…±äº«çš„é…ç½®å°±å·²ç»å…¨éƒ¨å®Œæˆäº†ï¼Œsession å…±äº«çš„æ•ˆæœæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ï¼Œä½†æ˜¯æ¯æ¬¡è®¿é—®éƒ½æ˜¯æˆ‘è‡ªå·±æ‰‹åŠ¨åˆ‡æ¢æœåŠ¡å®ä¾‹ï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¼•å…¥ Nginx ï¼Œå®ç°æœåŠ¡å®ä¾‹è‡ªåŠ¨åˆ‡æ¢ã€‚</p><h3 id="2-4-å¼•å…¥-Nginx"><a href="#2-4-å¼•å…¥-Nginx" class="headerlink" title="2.4 å¼•å…¥ Nginx"></a>2.4 å¼•å…¥ Nginx</h3><p>å¾ˆç®€å•ï¼Œè¿›å…¥ Nginx çš„å®‰è£…ç›®å½•çš„ conf ç›®å½•ä¸‹ï¼ˆé»˜è®¤æ˜¯åœ¨ <code>/usr/local/nginx/conf</code>ï¼‰ï¼Œç¼–è¾‘ nginx.conf æ–‡ä»¶:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-7-20210525152434641.png" alt="img"></p><p>åœ¨è¿™æ®µé…ç½®ä¸­ï¼š</p><ul><li>upstream è¡¨ç¤ºé…ç½®ä¸Šæ¸¸æœåŠ¡å™¨</li><li>javaboy.org è¡¨ç¤ºæœåŠ¡å™¨é›†ç¾¤çš„åå­—ï¼Œè¿™ä¸ªå¯ä»¥éšæ„å–åå­—</li><li>upstream é‡Œè¾¹é…ç½®çš„æ˜¯ä¸€ä¸ªä¸ªçš„å•ç‹¬æœåŠ¡</li><li>weight è¡¨ç¤ºæœåŠ¡çš„æƒé‡ï¼Œæ„å‘³è€…å°†æœ‰å¤šå°‘æ¯”ä¾‹çš„è¯·æ±‚ä» Nginx ä¸Šè½¬å‘åˆ°è¯¥æœåŠ¡ä¸Š</li><li>location ä¸­çš„ proxy_pass è¡¨ç¤ºè¯·æ±‚è½¬å‘çš„åœ°å€ï¼Œ<code>/</code> è¡¨ç¤ºæ‹¦æˆªåˆ°æ‰€æœ‰çš„è¯·æ±‚ï¼Œè½¬å‘è½¬å‘åˆ°åˆšåˆšé…ç½®å¥½çš„æœåŠ¡é›†ç¾¤ä¸­</li><li>proxy_redirect è¡¨ç¤ºè®¾ç½®å½“å‘ç”Ÿé‡å®šå‘è¯·æ±‚æ—¶ï¼Œnginx è‡ªåŠ¨ä¿®æ­£å“åº”å¤´æ•°æ®ï¼ˆé»˜è®¤æ˜¯ Tomcat è¿”å›é‡å®šå‘ï¼Œæ­¤æ—¶é‡å®šå‘çš„åœ°å€æ˜¯ Tomcat çš„åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¹‹ä¿®æ”¹ä½¿ä¹‹æˆä¸º Nginx çš„åœ°å€ï¼‰</li></ul><p>é…ç½®å®Œæˆåï¼Œå°†æœ¬åœ°çš„ Spring Boot æ‰“åŒ…å¥½çš„ jar ä¸Šä¼ åˆ° Linux ï¼Œç„¶ååœ¨ Linux ä¸Šåˆ†åˆ«å¯åŠ¨ä¸¤ä¸ª Spring Boot å®ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">nohup java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8080 &amp;nohup java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8081 &amp;</code></pre></div><p>å…¶ä¸­</p><ul><li>nohup è¡¨ç¤ºå½“ç»ˆç«¯å…³é—­æ—¶ï¼ŒSpring Boot ä¸è¦åœæ­¢è¿è¡Œ</li><li>&amp; è¡¨ç¤ºè®© Spring Boot åœ¨åå°å¯åŠ¨</li></ul><p>é…ç½®å®Œæˆåï¼Œé‡å¯ Nginxï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">/usr/local/nginx/sbin/nginx -s reload</code></pre></div><p>Nginx å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬é¦–å…ˆæ‰‹åŠ¨æ¸…é™¤ Redis ä¸Šçš„æ•°æ®ï¼Œç„¶åè®¿é—® <code>192.168.66.128/set</code> è¡¨ç¤ºå‘ <code>session</code> ä¸­ä¿å­˜æ•°æ®ï¼Œè¿™ä¸ªè¯·æ±‚é¦–å…ˆä¼šåˆ°è¾¾ <code>Nginx</code> ä¸Šï¼Œå†ç”± <code>Nginx</code> è½¬å‘ç»™æŸä¸€ä¸ª <code>Spring Boot</code> å®ä¾‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-8-20210525152434681.png" alt="img"></p><p>å¦‚ä¸Šï¼Œè¡¨ç¤ºç«¯å£ä¸º <code>8081</code> çš„ <code>Spring Boot</code> å¤„ç†äº†è¿™ä¸ª <code>/set</code> è¯·æ±‚ï¼Œå†è®¿é—® <code>/get</code> è¯·æ±‚ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/14-9-20210525152434677.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>/get</code> è¯·æ±‚æ˜¯è¢«ç«¯å£ä¸º 8080 çš„æœåŠ¡æ‰€å¤„ç†çš„ã€‚</p><h3 id="2-5-æ€»ç»“"><a href="#2-5-æ€»ç»“" class="headerlink" title="2.5 æ€»ç»“"></a>2.5 æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦å‘å¤§å®¶ä»‹ç»äº† Spring Session çš„ä½¿ç”¨ï¼Œå¦å¤–ä¹Ÿæ¶‰åŠåˆ°ä¸€äº› Nginx çš„ä½¿ç”¨ ï¼Œè™½ç„¶æœ¬æ–‡è¾ƒé•¿ï¼Œä½†æ˜¯å®é™…ä¸Š Spring Session çš„é…ç½®æ²¡å•¥ã€‚</p><p>æˆ‘ä»¬å†™äº†ä¸€äº›ä»£ç ï¼Œä¹Ÿåšäº†ä¸€äº›é…ç½®ï¼Œä½†æ˜¯å…¨éƒ½å’Œ Spring Session æ— å…³ï¼Œé…ç½®æ˜¯é…ç½® Redisï¼Œä»£ç å°±æ˜¯æ™®é€šçš„ HttpSessionï¼Œå’Œ Spring Session æ²¡æœ‰ä»»ä½•å…³ç³»ï¼</p><p>å”¯ä¸€å’Œ Spring Session ç›¸å…³çš„ï¼Œå¯èƒ½å°±æ˜¯æˆ‘åœ¨ä¸€å¼€å§‹å¼•å…¥äº† Spring Session çš„ä¾èµ–å§ï¼</p><p>å¦‚æœå¤§å®¶æ²¡æœ‰åœ¨ SSM æ¶æ„ä¸­ç”¨è¿‡ Spring Session ï¼Œå¯èƒ½ä¸å¤ªå¥½ç†è§£æˆ‘ä»¬åœ¨ Spring Boot ä¸­ä½¿ç”¨ Spring Session æœ‰å¤šä¹ˆæ–¹ä¾¿ï¼Œå› ä¸ºåœ¨ SSM æ¶æ„ä¸­ï¼ŒSpring Session çš„ä½¿ç”¨è¦é…ç½®ä¸‰ä¸ªåœ°æ–¹ ï¼Œä¸€ä¸ªæ˜¯ web.xml é…ç½®ä»£ç†è¿‡æ»¤å™¨ï¼Œç„¶ååœ¨ Spring å®¹å™¨ä¸­é…ç½® Redisï¼Œæœ€åå†é…ç½® Spring Sessionï¼Œæ­¥éª¤è¿˜æ˜¯æœ‰äº›ç¹ççš„ï¼Œè€Œ Spring Boot ä¸­ç›´æ¥å¸®æˆ‘ä»¬çœå»äº†è¿™äº›ç¹ççš„æ­¥éª¤ï¼ä¸ç”¨å†å»é…ç½® Spring Sessionã€‚</p><h1 id="SpringBootæ„å»ºRESTful"><a href="#SpringBootæ„å»ºRESTful" class="headerlink" title="SpringBootæ„å»ºRESTful"></a>SpringBootæ„å»ºRESTful</h1><p>RESTful ï¼Œåˆ°ç°åœ¨ç›¸ä¿¡å·²ç»æ²¡äººä¸çŸ¥é“è¿™ä¸ªä¸œè¥¿äº†å§ï¼å…³äº RESTful çš„æ¦‚å¿µï¼Œæˆ‘è¿™é‡Œå°±ä¸åšè¿‡å¤šä»‹ç»äº†ï¼Œä¼ ç»Ÿçš„ Struts å¯¹ RESTful æ”¯æŒä¸å¤Ÿå‹å¥½ ï¼Œä½†æ˜¯ SpringMVC å¯¹äº RESTful æä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œå¸¸è§çš„ç›¸å…³æ³¨è§£æœ‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@GetMapping</span><span class="hljs-meta">@PutMapping</span><span class="hljs-meta">@PostMapping</span><span class="hljs-meta">@DeleteMapping</span><span class="hljs-meta">@ResponseBody</span>...</code></pre></div><p>è¿™äº›æ³¨è§£éƒ½æ˜¯å’Œ RESTful ç›¸å…³çš„ï¼Œåœ¨ç§»åŠ¨äº’è”ç½‘ä¸­ï¼ŒRESTful å¾—åˆ°äº†éå¸¸å¹¿æ³›çš„ä½¿ç”¨ã€‚RESTful è¿™ä¸ªæ¦‚å¿µæå‡ºæ¥å¾ˆæ—©ï¼Œä½†æ˜¯ä»¥å‰æ²¡æœ‰ç§»åŠ¨äº’è”ç½‘æ—¶ï¼Œæˆ‘ä»¬åšçš„å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ˜¯å‰åç«¯ä¸åˆ†çš„ï¼Œåœ¨è¿™ç§æ¶æ„çš„åº”ç”¨ä¸­ï¼Œæ•°æ®åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨åç«¯æ¸²æŸ“å¥½è¿”å›ç»™å‰ç«¯å±•ç¤ºçš„ï¼Œæ­¤æ—¶ RESTful åœ¨ Web åº”ç”¨ä¸­åŸºæœ¬å°±æ²¡ç”¨æ­¦ä¹‹åœ°ï¼Œç§»åŠ¨äº’è”ç½‘çš„å…´èµ·ï¼Œè®©æˆ‘ä»¬ä¸€å¥—åå°å¯¹åº”å¤šä¸ªå‰ç«¯é¡¹ç›®ï¼Œå› æ­¤å‰åç«¯åˆ†ç¦»ï¼ŒRESTful é¡ºåˆ©èµ°ä¸Šå‰å°ã€‚</p><p>Spring Boot ç»§æ‰¿è‡ª Spring + SpringMVCï¼Œ SpringMVC ä¸­å¯¹äº RESTful æ”¯æŒçš„ç‰¹æ€§åœ¨ Spring Boot ä¸­å…¨ç›˜æ¥æ”¶ï¼ŒåŒæ—¶ï¼Œç»“åˆ Jpa å’Œ è‡ªåŠ¨åŒ–é…ç½®ï¼Œå¯¹äº RESTful è¿˜æä¾›äº†æ›´å¤šçš„æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å‡ ä¹ä¸éœ€è¦å†™ä»£ç ï¼ˆå¾ˆå°‘å‡ è¡Œï¼‰ï¼Œå°±èƒ½å¿«é€Ÿå®ç°ä¸€ä¸ª RESTful é£æ ¼çš„å¢åˆ æ”¹æŸ¥</p><h2 id="1-Spring-Data-JPAæ„å»º"><a href="#1-Spring-Data-JPAæ„å»º" class="headerlink" title="1. Spring Data JPAæ„å»º"></a>1. Spring Data JPAæ„å»º</h2><h3 id="1-1-åˆ›å»ºå·¥ç¨‹-1"><a href="#1-1-åˆ›å»ºå·¥ç¨‹-1" class="headerlink" title="1.1 åˆ›å»ºå·¥ç¨‹"></a>1.1 åˆ›å»ºå·¥ç¨‹</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹ï¼Œå¼•å…¥ <code>Web</code> ã€ <code>Jpa</code> ã€ <code>MySQL</code> ã€<code>Rest Repositories</code> ä¾èµ–ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-1-20210525152434677.png" alt="img"></p><p>åˆ›å»ºå®Œæˆåï¼Œè¿˜éœ€è¦é”å®š MySQL é©±åŠ¨çš„ç‰ˆæœ¬ä»¥åŠåŠ å…¥ Druid æ•°æ®åº“è¿æ¥æ± ï¼Œå®Œæ•´ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><h3 id="1-2-é…ç½®æ•°æ®åº“"><a href="#1-2-é…ç½®æ•°æ®åº“" class="headerlink" title="1.2 é…ç½®æ•°æ®åº“"></a>1.2 é…ç½®æ•°æ®åº“</h3><p>ä¸»è¦é…ç½®ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ•°æ®åº“ï¼Œå¦ä¸€ä¸ªæ˜¯ Jpaï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql:///test01</span><span class="hljs-meta">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><span class="hljs-meta">spring.jpa.properties.hibernate.dialect</span>=<span class="hljs-string">org.hibernate.dialect.MySQL57Dialect</span><span class="hljs-meta">spring.jpa.show-sql</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.jpa.hibernate.ddl-auto</span>=<span class="hljs-string">update</span><span class="hljs-meta">spring.jpa.database-platform</span>=<span class="hljs-string">mysql</span><span class="hljs-meta">spring.jpa.database</span>=<span class="hljs-string">mysql</span></code></pre></div><p>è¿™é‡Œçš„é…ç½®ï¼Œå’Œ Jpa ä¸­çš„åŸºæœ¬ä¸€è‡´ã€‚</p><p>å‰é¢äº”è¡Œé…ç½®äº†æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¿æ¥æ± ã€æ•°æ®åº“ç”¨æˆ·åã€æ•°æ®åº“å¯†ç ã€æ•°æ®åº“è¿æ¥åœ°å€ä»¥åŠæ•°æ®åº“é©±åŠ¨åç§°ã€‚</p><p>æ¥ä¸‹æ¥çš„äº”è¡Œé…ç½®äº† JPA çš„åŸºæœ¬ä¿¡æ¯ï¼Œåˆ†åˆ«è¡¨ç¤ºç”Ÿæˆ SQL çš„æ–¹è¨€ã€æ‰“å°å‡ºç”Ÿæˆçš„ SQL ã€æ¯æ¬¡å¯åŠ¨é¡¹ç›®æ—¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ˜¯å¦æ›´æ–°è¡¨ã€æ•°æ®åº“å¹³å°æ˜¯ MySQLã€‚</p><h3 id="1-3-æ„å»ºå®ä½“ç±»"><a href="#1-3-æ„å»ºå®ä½“ç±»" class="headerlink" title="1.3 æ„å»ºå®ä½“ç±»"></a>1.3 æ„å»ºå®ä½“ç±»</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Entity(name = &quot;t_book&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-meta">@Column(name = &quot;book_name&quot;)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-comment">//çœç•¥ getter/setter</span>&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>,<span class="hljs-title">Long</span>&gt; </span>&#123;&#125;</code></pre></div><p>è¿™é‡Œä¸€ä¸ªæ˜¯é…ç½®äº†ä¸€ä¸ªå®ä½“ç±» Bookï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯é…ç½®äº†ä¸€ä¸ª BookRepository ï¼Œé¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæ¡†æ¶ä¼šæ ¹æ® Book ç±»çš„å®šä¹‰ï¼Œåœ¨æ•°æ®åº“ä¸­è‡ªåŠ¨åˆ›å»ºç›¸åº”çš„è¡¨ï¼ŒBookRepository æ¥å£åˆ™æ˜¯ç»§æ‰¿è‡ª JpaRepository ï¼ŒJpaRepository ä¸­è‡ªå¸¦äº†ä¸€äº›åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ã€‚</p><p>ä¸€ä¸ª RESTful é£æ ¼çš„å¢åˆ æ”¹æŸ¥åº”ç”¨å°±æœ‰äº†ï¼Œè¿™å°±æ˜¯ Spring Boot çš„é­…åŠ›</p><h3 id="1-4-æµ‹è¯•"><a href="#1-4-æµ‹è¯•" class="headerlink" title="1.4 æµ‹è¯•"></a>1.4 æµ‹è¯•</h3><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•äº†ï¼Œä½¿ç”¨ <code>POSTMAN </code>æ¥æµ‹è¯•ï¼ˆå¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œé€‰æ‹©è¶æ‰‹çš„ HTTP è¯·æ±‚å·¥å…·ï¼‰</p><p>æ­¤æ—¶æˆ‘ä»¬çš„é¡¹ç›®å·²ç»é»˜è®¤å…·å¤‡äº†ä¸€äº›æ¥å£ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ï¼š</p><h4 id="æ ¹æ®-id-æŸ¥è¯¢æ¥å£"><a href="#æ ¹æ®-id-æŸ¥è¯¢æ¥å£" class="headerlink" title="æ ¹æ® id æŸ¥è¯¢æ¥å£"></a>æ ¹æ® id æŸ¥è¯¢æ¥å£</h4><ul><li><a href="http://127.0.0.1:8080/books/%7Bid%7D">http://127.0.0.1:8080/books/{id}</a></li></ul><p>è¿™ä¸ªæ¥å£è¡¨ç¤ºæ ¹æ® id æŸ¥è¯¢æŸä¸€æœ¬ä¹¦ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-2-20210525152434684.png" alt="img"></p><h4 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h4><ul><li><a href="http://127.0.0.1:8080/books">http://127.0.0.1:8080/books</a></li></ul><p>è¿™æ˜¯ä¸€ä¸ªæ‰¹é‡æŸ¥è¯¢æ¥å£ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„æ˜¯ç±»åé¦–å­—æ¯å°å†™ï¼Œå¹¶ä¸”å†åŠ ä¸€ä¸ª s åç¼€ã€‚è¿™ä¸ªæ¥å£å®é™…ä¸Šæ˜¯ä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œæ²¡æœ‰ä¼ å‚æ•°ï¼Œè¡¨ç¤ºæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œæ¯é¡µ 20 æ¡æ•°æ®ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-3-20210525152434693.png" alt="img"></p><p>æŸ¥è¯¢ç»“æœä¸­ï¼Œé™¤äº†è¯¥æœ‰çš„æ•°æ®ä¹‹å¤–ï¼Œä¹ŸåŒ…å«äº†åˆ†é¡µæ•°æ®ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-4-20210525152434757.png" alt="img"></p><p>åˆ†é¡µæ•°æ®ä¸­ï¼š</p><ol><li>size è¡¨ç¤ºæ¯é¡µæŸ¥è¯¢è®°å½•æ•°</li><li>totalElements è¡¨ç¤ºæ€»è®°å½•æ•°</li><li>totalPages è¡¨ç¤ºæ€»é¡µæ•°</li><li>number è¡¨ç¤ºå½“å‰é¡µæ•°ï¼Œä»0å¼€å§‹è®¡</li></ol><p>å¦‚æœè¦åˆ†é¡µæˆ–è€…æ’åºæŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ _links ä¸­çš„é“¾æ¥ã€‚<code>http://127.0.0.1:8080/books?page=1&amp;size=3&amp;sort=id,desc</code> </p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-5-20210525152434720.png" alt="img"></p><h4 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><p>ä¹Ÿå¯ä»¥æ·»åŠ æ•°æ®ï¼Œæ·»åŠ æ˜¯ POST è¯·æ±‚ï¼Œæ•°æ®é€šè¿‡ JSON çš„å½¢å¼ä¼ é€’ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-6-20210525152434720.png" alt="img"></p><p>æ·»åŠ æˆåŠŸä¹‹åï¼Œé»˜è®¤ä¼šè¿”å›æ·»åŠ æˆåŠŸçš„æ•°æ®ã€‚</p><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><p>ä¿®æ”¹æ¥å£é»˜è®¤ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œæ•°æ®ä¿®æ”¹è¯·æ±‚æ˜¯ä¸€ä¸ª PUT è¯·æ±‚ï¼Œä¿®æ”¹çš„å‚æ•°ä¹Ÿæ˜¯é€šè¿‡ JSON çš„å½¢å¼ä¼ é€’ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-7-20210525152434752.png" alt="img"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¿®æ”¹æˆåŠŸåï¼Œä¼šè¿”å›ä¿®æ”¹æˆåŠŸçš„æ•°æ®ã€‚</p><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ DELETE è¯·æ±‚æ ¹æ® id åˆ é™¤æ•°æ®ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-8-20210525152434730.png" alt="img"></p><p>åˆ é™¤æˆåŠŸåï¼Œæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚</p><p>ä¸éœ€è¦å‡ è¡Œä»£ç ï¼Œä¸€ä¸ªåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥å°±æœ‰äº†ã€‚</p><p>è¿™äº›éƒ½æ˜¯é»˜è®¤çš„é…ç½®ï¼Œè¿™äº›é»˜è®¤çš„é…ç½®å®é™…ä¸Šéƒ½æ˜¯åœ¨ JpaRepository çš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¿™äº›åŠŸèƒ½è¿›è¡Œå®šåˆ¶ã€‚</p><h3 id="1-5-æŸ¥è¯¢å®šåˆ¶"><a href="#1-5-æŸ¥è¯¢å®šåˆ¶" class="headerlink" title="1.5 æŸ¥è¯¢å®šåˆ¶"></a>1.5 æŸ¥è¯¢å®šåˆ¶</h3><p>æœ€å¹¿æ³›çš„å®šåˆ¶ï¼Œå°±æ˜¯æŸ¥è¯¢ï¼Œå› ä¸ºå¢åˆ æ”¹æ“ä½œçš„å˜åŒ–ä¸åƒæŸ¥è¯¢è¿™ä¹ˆä¸°å¯Œã€‚å¯¹äºæŸ¥è¯¢çš„å®šåˆ¶ï¼Œéå¸¸å®¹æ˜“ï¼Œåªéœ€è¦æä¾›ç›¸å…³çš„æ–¹æ³•å³å¯ã€‚ä¾‹å¦‚æ ¹æ®ä½œè€…æŸ¥è¯¢ä¹¦ç±ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>,<span class="hljs-title">Long</span>&gt; </span>&#123;    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;author&quot;)</span> String author)</span></span>;&#125;</code></pre></div><p>æ³¨æ„ï¼Œæ–¹æ³•çš„å®šä¹‰ï¼Œå‚æ•°è¦æœ‰ @Param æ³¨è§£ã€‚</p><p>å®šåˆ¶å®Œæˆåï¼Œé‡å¯é¡¹ç›®ï¼Œæ­¤æ—¶å°±å¤šäº†ä¸€ä¸ªæŸ¥è¯¢æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ <a href="http://localhost:8080/books/search">http://localhost:8080/books/search</a> æ¥æŸ¥çœ‹å’Œ book ç›¸å…³çš„è‡ªå®šä¹‰æ¥å£éƒ½æœ‰å“ªäº›ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-9-20210525152434766.png" alt="img"></p><p>æŸ¥è¯¢ç»“æœè¡¨ç¤ºï¼Œåªæœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ¥å£ï¼Œæ¥å£åå°±æ˜¯æ–¹æ³•åï¼Œè€Œä¸”æŸ¥è¯¢ç»“æœè¿˜ç»™å‡ºäº†æ¥å£è°ƒç”¨çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬æ¥å°è¯•è°ƒç”¨ä¸€ä¸‹è‡ªå·±å®šä¹‰çš„æŸ¥è¯¢æ¥å£ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-10-20210525152434772.png" alt="img"></p><p>å¼€å‘è€…å¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œåœ¨ BookRepository ä¸­å®šä¹‰ä»»æ„å¤šä¸ªæŸ¥è¯¢æ–¹æ³•ï¼ŒæŸ¥è¯¢æ–¹æ³•çš„å®šä¹‰è§„åˆ™å’Œ Jpa ä¸­ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ Jpa ä¸­æ–¹æ³•åå¤ªé•¿ï¼Œå› æ­¤ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨æ–¹æ³•åä½œä¸ºæ¥å£åï¼Œåˆ™å¯ä»¥è‡ªå®šä¹‰æ¥å£å</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;    <span class="hljs-meta">@RestResource(rel = &quot;byauthor&quot;,path = &quot;byauthor&quot;)</span>    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;author&quot;)</span> String author)</span></span>;&#125;</code></pre></div><p>@RestResource æ³¨è§£ä¸­ï¼Œä¸¤ä¸ªå‚æ•°çš„å«ä¹‰ï¼š</p><ul><li>rel è¡¨ç¤ºæ¥å£æŸ¥è¯¢ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„ key</li><li>path è¡¨ç¤ºè¯·æ±‚è·¯å¾„</li></ul><p>è¿™æ ·å®šä¹‰å®Œæˆåï¼Œè¡¨ç¤ºæ¥å£åä¸º byauthor ï¼Œé‡å¯é¡¹ç›®ï¼Œç»§ç»­æŸ¥è¯¢æ¥å£ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-11-20210525152434803.png" alt="img"></p><p>é™¤äº† <code>rel</code> å’Œ <code>path</code> ä¸¤ä¸ªå±æ€§ä¹‹å¤–ï¼Œ<code>@RestResource</code> ä¸­è¿˜æœ‰ä¸€ä¸ªå±æ€§ï¼Œ<code>exported</code> è¡¨ç¤ºæ˜¯å¦æš´éœ²æ¥å£ï¼Œé»˜è®¤ä¸º <code>true</code>ï¼Œè¡¨ç¤ºæš´éœ²æ¥å£ï¼Œå³æ–¹æ³•å¯ä»¥åœ¨å‰ç«¯è°ƒç”¨ï¼Œå¦‚æœä»…ä»…åªæ˜¯æƒ³å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¸éœ€è¦åœ¨å‰ç«¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è®¾ç½® <code>exported</code> å±æ€§ä¸º <code>false</code> ã€‚</p><p>å¦‚æœä¸æƒ³æš´éœ²å®˜æ–¹å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œä¾‹å¦‚æ ¹æ® <code>id</code> åˆ é™¤æ•°æ®ï¼Œåªéœ€è¦åœ¨è‡ªå®šä¹‰æ¥å£ä¸­é‡å†™è¯¥æ–¹æ³•ï¼Œç„¶ååœ¨è¯¥æ–¹æ³•ä¸ŠåŠ  <code>@RestResource</code> æ³¨è§£å¹¶ä¸”é…ç½®ç›¸å…³å±æ€§å³å¯ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;    <span class="hljs-meta">@RestResource(rel = &quot;byauthor&quot;,path = &quot;byauthor&quot;)</span>    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;author&quot;)</span> String author)</span></span>;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@RestResource(exported = false)</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Long aLong)</span></span>;&#125;</code></pre></div><p>å¦å¤–ç”Ÿæˆçš„ JSON å­—ç¬¦ä¸²ä¸­çš„é›†åˆåå’Œå•ä¸ª <code>item</code> çš„åå­—éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RepositoryRestResource(collectionResourceRel = &quot;bs&quot;,itemResourceRel = &quot;b&quot;,path = &quot;bs&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;    <span class="hljs-meta">@RestResource(rel = &quot;byauthor&quot;,path = &quot;byauthor&quot;)</span>    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;author&quot;)</span> String author)</span></span>;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@RestResource(exported = false)</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Long aLong)</span></span>;&#125;</code></pre></div><p><code>path</code> å±æ€§è¡¨ç¤ºè¯·æ±‚è·¯å¾„ï¼Œè¯·æ±‚è·¯å¾„é»˜è®¤æ˜¯ç±»åé¦–å­—æ¯å°å†™+sï¼Œå¯ä»¥åœ¨è¿™é‡Œè‡ªå·±é‡æ–°å®šä¹‰ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16-12-20210525152434760.png" alt="img"></p><h3 id="1-6-å…¶ä»–é…ç½®"><a href="#1-6-å…¶ä»–é…ç½®" class="headerlink" title="1.6 å…¶ä»–é…ç½®"></a>1.6 å…¶ä»–é…ç½®</h3><p>æœ€åï¼Œä¹Ÿå¯ä»¥åœ¨ application.properties ä¸­é…ç½® REST åŸºæœ¬å‚æ•°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.data.rest.base-path</span>=<span class="hljs-string">/api</span><span class="hljs-meta">spring.data.rest.sort-param-name</span>=<span class="hljs-string">sort</span><span class="hljs-meta">spring.data.rest.page-param-name</span>=<span class="hljs-string">page</span><span class="hljs-meta">spring.data.rest.limit-param-name</span>=<span class="hljs-string">size</span><span class="hljs-meta">spring.data.rest.max-page-size</span>=<span class="hljs-string">20</span><span class="hljs-meta">spring.data.rest.default-page-size</span>=<span class="hljs-string">0</span><span class="hljs-meta">spring.data.rest.return-body-on-update</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.data.rest.return-body-on-create</span>=<span class="hljs-string">true</span></code></pre></div><p>é…ç½®å«ä¹‰ï¼Œä»ä¸Šå¾€ä¸‹ï¼Œä¾æ¬¡æ˜¯ï¼š</p><ul><li>ç»™æ‰€æœ‰çš„æ¥å£æ·»åŠ ç»Ÿä¸€çš„å‰ç¼€</li><li>é…ç½®æ’åºå‚æ•°çš„ key ï¼Œé»˜è®¤æ˜¯ sort</li><li>é…ç½®åˆ†é¡µæŸ¥è¯¢æ—¶é¡µç çš„ keyï¼Œé»˜è®¤æ˜¯ page</li><li>é…ç½®åˆ†é¡µæŸ¥è¯¢æ—¶æ¯é¡µæŸ¥è¯¢é¡µæ•°çš„ keyï¼Œé»˜è®¤æ˜¯size</li><li>é…ç½®æ¯é¡µæœ€å¤§æŸ¥è¯¢è®°å½•æ•°ï¼Œé»˜è®¤æ˜¯ 20 æ¡</li><li>åˆ†é¡µæŸ¥è¯¢æ—¶é»˜è®¤çš„é¡µç </li><li>æ›´æ–°æˆåŠŸæ—¶æ˜¯å¦è¿”å›æ›´æ–°è®°å½•</li><li>æ·»åŠ æˆåŠŸæ—¶æ˜¯å¦è¿”å›æ·»åŠ è®°å½•</li></ul><h1 id="SpringBootå¼€å‘è€…å·¥å…·"><a href="#SpringBootå¼€å‘è€…å·¥å…·" class="headerlink" title="SpringBootå¼€å‘è€…å·¥å…·"></a>SpringBootå¼€å‘è€…å·¥å…·</h1><h2 id="1-Devtools"><a href="#1-Devtools" class="headerlink" title="1. Devtools"></a>1. Devtools</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524151205975.png" alt="image-20210524151205975"></p><p>Spring Boot ä¸­çš„çƒ­éƒ¨ç½²ç›¸ä¿¡å¤§å®¶éƒ½ç”¨è¿‡å§ï¼Œåªéœ€è¦æ·»åŠ  <code>spring-boot-devtools</code> ä¾èµ–å°±å¯ä»¥è½»æ¾å®ç°çƒ­éƒ¨ç½²ã€‚Spring Boot ä¸­çƒ­éƒ¨ç½²æœ€æœ€å…³é”®çš„åŸç†å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ classloaderï¼š</p><ul><li>base classloader</li><li>restart classloader</li></ul><p>å…¶ä¸­ base classloader ç”¨æ¥åŠ è½½é‚£äº›ä¸ä¼šå˜åŒ–çš„ç±»ï¼Œä¾‹å¦‚å„ç§ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œè€Œ restart classloader åˆ™ç”¨æ¥åŠ è½½é‚£äº›ä¼šå‘ç”Ÿå˜åŒ–çš„ç±»ï¼Œä¾‹å¦‚ä½ è‡ªå·±å†™çš„ä»£ç ã€‚Spring Boot ä¸­çƒ­éƒ¨ç½²çš„åŸç†å°±æ˜¯å½“ä»£ç å‘ç”Ÿå˜åŒ–æ—¶ï¼Œbase classloader ä¸å˜ï¼Œè€Œ restart classloader åˆ™ä¼šè¢«åºŸå¼ƒï¼Œè¢«å¦ä¸€ä¸ªæ–°çš„ restart classloader ä»£æ›¿ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºåªé‡æ–°åŠ è½½äº†å˜åŒ–çš„ç±»ï¼Œæ‰€ä»¥å¯åŠ¨é€Ÿåº¦è¦è¢«é‡å¯å¿«</p><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>åœ¨IDEAä¸­å¼€å¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524154546455.png" alt="image-20210524154546455"></p><p>æ‰¾åˆ°</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524154656023.png" alt="image-20210524154656023"></p><p>åœ¨<code>Registry</code>ä¸­</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524154820641.png" alt="image-20210524154820641"></p><p>å³å¯å¼€å¯è‡ªåŠ¨é‡å¯</p><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#å…³é—­è‡ªåŠ¨é‡å¯</span><span class="hljs-meta">spring.devtools.restart.enabled</span>=<span class="hljs-string">false</span><span class="hljs-comment">#è§¦å‘é‡å¯çš„æ–‡ä»¶ï¼Œæ”¾ç½®åœ¨resourcesç›®å½•ä¸‹</span><span class="hljs-meta">spring.devtools.restart.trigger-file</span>=<span class="hljs-string">.reloadtrigger</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524153804327.png" alt="image-20210524153804327"></p><p>æ·»åŠ åè¿™ä¸ªæ–‡ä»¶ä¸‹ï¼Œæ¯æ¬¡å»ä¿®æ”¹<code>.reloadtrigger</code>æ–‡ä»¶ç„¶åå»åˆ·æ–°æ‰ä¼šé‡å¯ï¼Œè¿™é‡Œçš„é‡å¯è¿˜æ˜¯ä¸å…¨éƒ¨é‡å¯çš„åˆ·æ–°</p><p>å¦‚æœæœ‰ä¸ªå¤šæ¨¡å—çš„é¡¹ç›®ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º<code>spring-boot-devtools.properties</code>æ–‡ä»¶</p><p>è¿™é‡Œé¢çš„é…ç½®éƒ½è®©æ‰€æœ‰ä½¿ç”¨Devtoolsæ¨¡å—çš„é¡¹ç›®éƒ½ç”Ÿæ•ˆ</p><p>ä½†æ˜¯æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é™æ€èµ„æºæ–‡ä»¶ï¼ä½¿ç”¨ devtools ï¼Œé»˜è®¤æƒ…å†µä¸‹å½“é™æ€èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šè§¦å‘é¡¹ç›®é‡å¯ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦ï¼å› ä¸ºé™æ€èµ„æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–åä¸éœ€è¦ç¼–è¯‘ï¼ŒæŒ‰ç†è¯´ä¿å­˜ååˆ·æ–°ä¸‹å°±å¯ä»¥è®¿é—®åˆ°äº†ï¼Œæ‰€ä»¥é™æ€èµ„æºä¸ä¼šè¢«Devtoolsç›‘è§†åˆ°ï¼Œé™æ€èµ„æºä¸éœ€è¦é‡å¯ä¹Ÿèƒ½ç›´æ¥åŒæ­¥åˆ°targetç›®å½•ä¸‹</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210524151746545.png" alt="image-20210524151746545"></p><h3 id="LiveReload"><a href="#LiveReload" class="headerlink" title="LiveReload"></a>LiveReload</h3><p>devtools ä¸­é»˜è®¤åµŒå…¥äº† LiveReload æœåŠ¡å™¨ï¼Œåˆ©ç”¨ LiveReload å¯ä»¥å®ç°é™æ€æ–‡ä»¶çš„çƒ­éƒ¨ç½²ï¼ŒLiveReload å¯ä»¥åœ¨èµ„æºå‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘æµè§ˆå™¨æ›´æ–°ï¼ŒLiveReload æ”¯æŒ Chromeã€Firefox ä»¥åŠ Safari ã€‚ä»¥ Chrome ä¸ºä¾‹ï¼Œåœ¨ Chrome åº”ç”¨å•†åº—æœç´¢ LiveReload ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/27-1-20210525152240919.png" alt="img"></p><p>å°†ç¬¬ä¸€ä¸ªæœç´¢ç»“æœæ·»åŠ åˆ° Chrome ä¸­ï¼Œæ·»åŠ æˆåŠŸåï¼Œåœ¨ Chrome å³ä¸Šè§’æœ‰ä¸€ä¸ª LiveReload å›¾æ ‡</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/27-2-20210525152240870.png" alt="img"></p><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡¹ç›®çš„é¡µé¢ï¼Œç„¶åç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„ LiveReload æŒ‰é’®ï¼Œæ‰“å¼€ LiveReload è¿æ¥ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>LiveReload æ˜¯å’Œæµè§ˆå™¨é€‰é¡¹å¡ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œåœ¨å“ªä¸ªé€‰é¡¹å¡ä¸­æ‰“å¼€äº† LiveReloadï¼Œå°±åœ¨å“ªä¸ªé€‰é¡¹å¡ä¸­è®¿é—®é¡µé¢ï¼Œè¿™æ ·æ‰æœ‰æ•ˆæœ</p><p>æ­¤æ—¶éšä¾¿åœ¨ resources/static ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªé™æ€ html é¡µé¢ï¼Œç„¶åå¯åŠ¨ Spring Boot é¡¹ç›®ï¼Œåœ¨<strong>æ‰“å¼€äº† LiveReload çš„é€‰é¡¹å¡ä¸­è®¿é—® html é¡µé¢</strong>ã€‚</p><p>è®¿é—®æˆåŠŸåï¼Œæˆ‘ä»¬å†å»æ‰‹åŠ¨ä¿®æ”¹ html é¡µé¢ä»£ç ï¼Œä¿®æ”¹æˆåŠŸåï¼Œå›åˆ°æµè§ˆå™¨ï¼Œä¸ç”¨åšä»»ä½•æ“ä½œï¼Œå°±ä¼šå‘ç°æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°äº†ï¼Œé¡µé¢å·²ç»æ›´æ–°äº†ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘çš„ Spring Boot é¡¹ç›®å¹¶æ²¡æœ‰é‡å¯ã€‚</p><p>å¦‚æœå¼€å‘è€…å®‰è£…å¹¶ä¸”å¯åŠ¨äº† LiveReload æ’ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ·»åŠ äº† devtools ä¾èµ–ï¼Œä½†æ˜¯å´å¹¶ä¸æƒ³å½“é™æ€é¡µé¢å‘ç”Ÿå˜åŒ–æ—¶æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ application.properties ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç è¿›è¡Œé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.devtools.livereload.enabled</span>=<span class="hljs-string">false</span></code></pre></div><p>å»ºè®®å¼€å‘è€…ä½¿ç”¨ LiveReload ç­–ç•¥è€Œä¸æ˜¯é¡¹ç›®é‡å¯ç­–ç•¥æ¥å®ç°é™æ€èµ„æºçš„åŠ¨æ€åŠ è½½ï¼Œå› ä¸ºé¡¹ç›®é‡å¯æ‰€è€—è´¹æ—¶é—´ä¸€èˆ¬æ¥è¯´è¦è¶…è¿‡ä½¿ç”¨LiveReload æ‰€è€—è´¹çš„æ—¶é—´</p><h2 id="2-Mockå•å…ƒæµ‹è¯•"><a href="#2-Mockå•å…ƒæµ‹è¯•" class="headerlink" title="2. Mockå•å…ƒæµ‹è¯•"></a>2. Mockå•å…ƒæµ‹è¯•</h2><p>é’ˆå¯¹Controllerçš„æ¥å£ç®€å•æµ‹è¯•ï¼Œè¿™é‡Œä¸ä½¿ç”¨Postmanï¼Œä½¿ç”¨Javaä»£ç æ¥å®Œæˆ</p><p><strong>å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Long id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> username;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;        <span class="hljs-keyword">this</span>.username = username;    &#125;&#125;</code></pre></div><p><strong>Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> </span>&#123;        User user = <span class="hljs-keyword">new</span> User();        user.setId(id);        user.setUsername(<span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> user;    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * webEnvironmentï¼šæŒ‡å®š web åº”ç”¨ç¯å¢ƒï¼š</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * - MOCK</span><span class="hljs-comment"> * - RANDOM_PORT (å¯¹äº‹åŠ¡ä¸å›æ»š)</span><span class="hljs-comment"> * - DEFINED_PORT (å¯¹äº‹åŠ¡ä¸å›æ»š)</span><span class="hljs-comment"> * - NONE</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * classesï¼šæŒ‡å®šåº”ç”¨å¯åŠ¨ç±»</span><span class="hljs-comment"> */</span><span class="hljs-meta">@SpringBootTest()</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestApplicationTests</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    WebApplicationContext webApplicationContext;    MockMvc mockMvc;    <span class="hljs-meta">@BeforeEach</span> <span class="hljs-comment">//ç›¸å½“äºBefore</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>&#123;        mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();   <span class="hljs-comment">//æˆ–è€…ï¼Œä½†ä¸æ¨è  mockMvc = MockMvcBuilders.standaloneSetup(new UserController()).build();</span>    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//GETè¯·æ±‚</span>  mockMvc  .perform(MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/user/99&quot;</span>).accept(MediaType.APPLICATION_JSON_UTF8))                .andExpect(MockMvcResultMatchers.status().isOk())                .andExpect(MockMvcResultMatchers.content().string(<span class="hljs-string">&quot;&#123;\&quot;id\&quot;:99,\&quot;username\&quot;:\&quot;javaboy\&quot;&#125;&quot;</span>))                .andDo(MockMvcResultHandlers.print());    &#125;    &#125;</code></pre></div><p><strong>å¯¹Serviceçš„æµ‹è¯•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    UserDao userDao;    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span> </span>&#123;        <span class="hljs-keyword">return</span> userDao.getUserById(id);    &#125;&#125;</code></pre></div><p><strong>DAO</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDao</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span> </span>&#123;        User user = <span class="hljs-keyword">new</span> User();        user.setId(id);        user.setUsername(<span class="hljs-string">&quot;111&quot;</span>);        <span class="hljs-keyword">return</span> user;    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest()</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestApplicationTests</span> </span>&#123;    <span class="hljs-comment">//ä¸æ¶‰åŠæ•°æ®åº“çš„æ³¨å…¥ï¼Œå¦‚æœç”¨AutoWiredä¼šæ”¹å˜æ•°æ®åº“</span>    <span class="hljs-meta">@MockBean</span>    UserDao userDao;    <span class="hljs-meta">@Autowired</span>    UserService userService;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-comment">//ä»…ä¾›æµ‹è¯•çš„æ•°æ®</span>        User user = <span class="hljs-keyword">new</span> User();        user.setId(<span class="hljs-number">99L</span>);        user.setUsername(<span class="hljs-string">&quot;javaboy&quot;</span>);        Mockito.when(userDao.getUserById(<span class="hljs-number">99L</span>)).thenReturn(user);        User u = userService.getUserById(<span class="hljs-number">99L</span>);        Assertions.assertEquals(<span class="hljs-number">99L</span>,u.getId());        Assertions.assertEquals(<span class="hljs-string">&quot;javaboy&quot;</span>, u.getUsername());    &#125;&#125;</code></pre></div><h1 id="SpringBootæ•´åˆç¼“å­˜"><a href="#SpringBootæ•´åˆç¼“å­˜" class="headerlink" title="SpringBootæ•´åˆç¼“å­˜"></a>SpringBootæ•´åˆç¼“å­˜</h1><h2 id="1-Spring-Cache-Redis"><a href="#1-Spring-Cache-Redis" class="headerlink" title="1. Spring Cache + Redis"></a>1. Spring Cache + Redis</h2><p>ç»è¿‡Spring Bootçš„æ•´åˆå°è£…ä¸è‡ªåŠ¨åŒ–é…ç½®ï¼Œåœ¨Spring Bootä¸­æ•´åˆRediså·²ç»å˜å¾—éå¸¸å®¹æ˜“äº†ï¼Œå¼€å‘è€…åªéœ€è¦å¼•å…¥Spring Data Redisä¾èµ–ï¼Œç„¶åç®€å•é…ä¸‹redisçš„åŸºæœ¬ä¿¡æ¯ï¼Œç³»ç»Ÿå°±ä¼šæä¾›ä¸€ä¸ªRedisTemplateä¾›å¼€å‘è€…ä½¿ç”¨ã€‚Spring3.1ä¸­å¼€å§‹å¼•å…¥äº†ä»¤äººæ¿€åŠ¨çš„Cacheï¼Œåœ¨Spring Bootä¸­ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„ä½¿ç”¨Redisæ¥ä½œä¸ºCacheçš„å®ç°ï¼Œè¿›è€Œå®ç°æ•°æ®çš„ç¼“å­˜ã€‚</p><h3 id="1-1-å·¥ç¨‹åˆ›å»º"><a href="#1-1-å·¥ç¨‹åˆ›å»º" class="headerlink" title="1.1 å·¥ç¨‹åˆ›å»º"></a>1.1 å·¥ç¨‹åˆ›å»º</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªSpring Bootå·¥ç¨‹ï¼Œæ³¨æ„åˆ›å»ºçš„æ—¶å€™éœ€è¦å¼•å…¥ä¸‰ä¸ªä¾èµ–ï¼Œwebã€cacheä»¥åŠredisï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13-1-20210525152240902.png" alt="img"></p><p>å¯¹åº”çš„ä¾èµ–å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="1-2-åŸºæœ¬é…ç½®"><a href="#1-2-åŸºæœ¬é…ç½®" class="headerlink" title="1.2 åŸºæœ¬é…ç½®"></a>1.2 åŸºæœ¬é…ç½®</h3><p>å·¥ç¨‹åˆ›å»ºå¥½ä¹‹åï¼Œé¦–å…ˆéœ€è¦ç®€å•é…ç½®ä¸€ä¸‹Redisï¼ŒRedisçš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦å¤–ï¼Œè¿™é‡Œè¦ç”¨åˆ°Cacheï¼Œå› æ­¤è¿˜éœ€è¦ç¨å¾®é…ç½®ä¸€ä¸‹Cacheï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6380</span><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">192.168.66.128</span><span class="hljs-meta">spring.cache.cache-names</span>=<span class="hljs-string">c1</span></code></pre></div><p>ç®€å•èµ·è§ï¼Œè¿™é‡Œæˆ‘åªæ˜¯é…ç½®äº†Redisçš„ç«¯å£å’Œåœ°å€ï¼Œç„¶åç»™ç¼“å­˜å–äº†ä¸€ä¸ªåå­—ï¼Œè¿™ä¸ªåå­—åœ¨åæ–‡ä¼šç”¨åˆ°ã€‚</p><p>å¦å¤–ï¼Œè¿˜éœ€è¦åœ¨é…ç½®ç±»ä¸Šæ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œè¡¨ç¤ºå¼€å¯ç¼“å­˜ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableCaching</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RediscacheApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(RediscacheApplication.class, args);    &#125;&#125;</code></pre></div><p>å®Œæˆäº†è¿™äº›é…ç½®ä¹‹åï¼ŒSpring Bootå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨åå°é…ç½®ä¸€ä¸ªRedisCacheManagerï¼Œç›¸å…³çš„é…ç½®æ˜¯åœ¨org.springframework.boot.autoconfigure.cache.RedisCacheConfigurationç±»ä¸­å®Œæˆçš„ã€‚éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass(RedisConnectionFactory.class)</span><span class="hljs-meta">@AutoConfigureAfter(RedisAutoConfiguration.class)</span><span class="hljs-meta">@ConditionalOnBean(RedisConnectionFactory.class)</span><span class="hljs-meta">@ConditionalOnMissingBean(CacheManager.class)</span><span class="hljs-meta">@Conditional(CacheCondition.class)</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisCacheConfiguration</span> </span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> RedisCacheManager <span class="hljs-title">cacheManager</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory,</span></span><span class="hljs-function"><span class="hljs-params">ResourceLoader resourceLoader)</span> </span>&#123;RedisCacheManagerBuilder builder = RedisCacheManager.builder(redisConnectionFactory).cacheDefaults(determineConfiguration(resourceLoader.getClassLoader()));List&lt;String&gt; cacheNames = <span class="hljs-keyword">this</span>.cacheProperties.getCacheNames();<span class="hljs-keyword">if</span> (!cacheNames.isEmpty()) &#123;builder.initialCacheNames(<span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(cacheNames));&#125;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.customizerInvoker.customize(builder.build());&#125;&#125;</code></pre></div><p>çœ‹ç±»ä¸Šçš„æ³¨è§£ï¼Œå‘ç°åœ¨ä¸‡äº‹ä¿±å¤‡çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ªRedisCacheManagerçš„Beanï¼Œè¿™ä¸ªRedisCacheManageré—´æ¥å®ç°äº†Springä¸­çš„Cacheæ¥å£ï¼Œæœ‰äº†è¿™ä¸ªBeanï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨Springä¸­çš„ç¼“å­˜æ³¨è§£å’Œæ¥å£äº†ï¼Œè€Œç¼“å­˜æ•°æ®åˆ™ä¼šè¢«è‡ªåŠ¨å­˜å‚¨åˆ°Redisä¸Šã€‚åœ¨å•æœºçš„Redisä¸­ï¼Œè¿™ä¸ªBeanç³»ç»Ÿä¼šè‡ªåŠ¨æä¾›ï¼Œå¦‚æœæ˜¯Redisé›†ç¾¤ï¼Œè¿™ä¸ªBeanéœ€è¦å¼€å‘è€…æ¥æä¾›ã€‚</p><h3 id="1-3-ç¼“å­˜ä½¿ç”¨"><a href="#1-3-ç¼“å­˜ä½¿ç”¨" class="headerlink" title="1.3 ç¼“å­˜ä½¿ç”¨"></a>1.3 ç¼“å­˜ä½¿ç”¨</h3><p>è¿™é‡Œä¸»è¦å‘å°ä¼™ä¼´ä»¬ä»‹ç»ç¼“å­˜ä¸­å‡ ä¸ªæ ¸å¿ƒçš„æ³¨è§£ä½¿ç”¨ã€‚</p><h4 id="CacheConfig"><a href="#CacheConfig" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h4><p>è¿™ä¸ªæ³¨è§£åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œç”¨æ¥æè¿°è¯¥ç±»ä¸­æ‰€æœ‰æ–¹æ³•ä½¿ç”¨çš„ç¼“å­˜åç§°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è¯¥æ³¨è§£ï¼Œç›´æ¥åœ¨å…·ä½“çš„ç¼“å­˜æ³¨è§£ä¸Šé…ç½®åç§°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-meta">@CacheConfig(cacheNames = &quot;c1&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;&#125;</code></pre></div><h4 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨æŸ¥è¯¢æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºå°†ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç¼“å­˜èµ·æ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„keyå°±æ˜¯æ–¹æ³•çš„å‚æ•°ï¼Œç¼“å­˜çš„valueå°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(key = &quot;#id&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Integer id,String username)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;getUserById&quot;</span>);    <span class="hljs-keyword">return</span> getUserFromDBById(id);&#125;</code></pre></div><p>å½“æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤å°±ä½¿ç”¨å¤šä¸ªå‚æ•°æ¥åškeyï¼Œå¦‚æœåªéœ€è¦å…¶ä¸­æŸä¸€ä¸ªå‚æ•°åškeyï¼Œåˆ™å¯ä»¥åœ¨@Cacheableæ³¨è§£ä¸­ï¼Œé€šè¿‡keyå±æ€§æ¥æŒ‡å®škeyï¼Œå¦‚ä¸Šä»£ç å°±è¡¨ç¤ºåªä½¿ç”¨idä½œä¸ºç¼“å­˜çš„keyï¼Œå¦‚æœå¯¹keyæœ‰å¤æ‚çš„è¦æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰keyGeneratorã€‚å½“ç„¶ï¼ŒSpring Cacheä¸­æä¾›äº†rootå¯¹è±¡ï¼Œå³<code>#root.</code>å¯ä»¥åœ¨ä¸å®šä¹‰keyGeneratorçš„æƒ…å†µä¸‹å®ç°ä¸€äº›å¤æ‚çš„æ•ˆæœï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13-2-20210524162051323-20210525152240881.png" alt="img"></p><p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç¼“å­˜çš„æ ¼å¼</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyKeyGenerator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">KeyGenerator</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">generate</span><span class="hljs-params">(Object target, Method method, Object... params)</span> </span>&#123;        String s = target.toString() + <span class="hljs-string">&quot;:&quot;</span> + method.getName() + <span class="hljs-string">&quot;:&quot;</span> + Arrays.toString(params);        <span class="hljs-keyword">return</span> s;    &#125;&#125;<span class="hljs-meta">@Service</span><span class="hljs-meta">@CacheConfig(cacheNames = &quot;c1&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123; <span class="hljs-meta">@Cacheable(keyGenerator = &quot;myKeyGenerator&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById2</span><span class="hljs-params">(Long id,String username)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;getUserById2:&quot;</span> + id);        User user = <span class="hljs-keyword">new</span> User();        user.setId(id);        user.setUsername(username);        <span class="hljs-keyword">return</span> user;    &#125;  &#125;</code></pre></div><h4 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨æ›´æ–°æ–¹æ³•ä¸Šï¼Œå½“æ•°æ®åº“ä¸­çš„æ•°æ®æ›´æ–°åï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¹Ÿè¦è·Ÿç€æ›´æ–°ï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œå¯ä»¥å°†æ–¹æ³•çš„è¿”å›å€¼è‡ªåŠ¨æ›´æ–°åˆ°å·²ç»å­˜åœ¨çš„keyä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œç¼“å­˜ï¼Œå¦åˆ™è¿›è¡Œæ›´æ–°</span><span class="hljs-meta">@CachePut(key = &quot;#user.id&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">updateUserById</span><span class="hljs-params">(User user)</span> </span>&#123;    <span class="hljs-keyword">return</span> user;&#125;</code></pre></div><h4 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨åˆ é™¤æ–¹æ³•ä¸Šï¼Œå½“æ•°æ®åº“ä¸­çš„æ•°æ®åˆ é™¤åï¼Œç›¸å…³çš„ç¼“å­˜æ•°æ®ä¹Ÿè¦è‡ªåŠ¨æ¸…é™¤ï¼Œè¯¥æ³¨è§£åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥é…ç½®æŒ‰ç…§æŸç§æ¡ä»¶åˆ é™¤ï¼ˆconditionå±æ€§ï¼‰æˆ–è€…æˆ–è€…é…ç½®æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼ˆallEntrieså±æ€§ï¼‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict()</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Integer id)</span> </span>&#123;    <span class="hljs-comment">//åœ¨è¿™é‡Œæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œ åˆ é™¤æ˜¯å»æ•°æ®åº“ä¸­åˆ é™¤</span>&#125;</code></pre></div><h3 id="1-4-æ€»ç»“"><a href="#1-4-æ€»ç»“" class="headerlink" title="1.4 æ€»ç»“"></a>1.4 æ€»ç»“</h3><p>åœ¨Spring Bootä¸­ï¼Œä½¿ç”¨Redisç¼“å­˜ï¼Œæ—¢å¯ä»¥ä½¿ç”¨RedisTemplateè‡ªå·±æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ˜¯Spring Cacheæä¾›çš„ç»Ÿä¸€æ¥å£ï¼Œå®ç°æ—¢å¯ä»¥æ˜¯Redisï¼Œä¹Ÿå¯ä»¥æ˜¯Ehcacheæˆ–è€…å…¶ä»–æ”¯æŒè¿™ç§è§„èŒƒçš„ç¼“å­˜æ¡†æ¶ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒSpring Cacheå’ŒRedisã€Ehcacheçš„å…³ç³»å°±åƒJDBCä¸å„ç§æ•°æ®åº“é©±åŠ¨çš„å…³ç³»ã€‚</p><h2 id="2-Spring-Cache-Ehcache"><a href="#2-Spring-Cache-Ehcache" class="headerlink" title="2. Spring Cache + Ehcache"></a>2. Spring Cache + Ehcache</h2><p>ç”¨æƒ¯äº† Redis ï¼Œå¾ˆå¤šäººå·²ç»å¿˜è®°äº†è¿˜æœ‰å¦ä¸€ä¸ªç¼“å­˜æ–¹æ¡ˆ Ehcache ï¼Œæ˜¯çš„ï¼Œåœ¨ Redis ä¸€ç»Ÿæ±Ÿæ¹–çš„æ—¶ä»£ï¼ŒEhcache æ¸æ¸æœ‰ç‚¹æ²¡è½äº†ï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸‹ Ehcache ï¼Œåœ¨æœ‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šç”¨åˆ° Ehcacheã€‚</p><p>Ehcache ä¹Ÿæ˜¯ Java é¢†åŸŸæ¯”è¾ƒä¼˜ç§€çš„ç¼“å­˜æ–¹æ¡ˆä¹‹ä¸€ï¼ŒEhcache è¿™ä¸ªç¼“å­˜çš„åå­—å¾ˆæœ‰æ„æ€ï¼Œæ­£ç€å¿µåç€å¿µï¼Œéƒ½æ˜¯ Ehcacheï¼ŒSpring Boot ä¸­å¯¹æ­¤ä¹Ÿæä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œè¿™ä¸ªæ”¯æŒä¸»è¦æ˜¯é€šè¿‡ Spring Cache æ¥å®ç°çš„ã€‚</p><p>Spring Cache å¯ä»¥æ•´åˆ Redisï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ•´åˆ Ehcacheï¼Œä¸¤ç§ç¼“å­˜æ–¹æ¡ˆçš„æ•´åˆè¿˜æ˜¯æ¯”è¾ƒç›¸ä¼¼ï¼Œä¸»è¦æ˜¯é…ç½®çš„å·®å¼‚ï¼Œå…·ä½“çš„ç”¨æ³•æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå°±ç±»ä¼¼äº JDBC å’Œ æ•°æ®åº“é©±åŠ¨çš„å…³ç³»ä¸€æ ·ã€‚å‰é¢é…ç½®å®Œæˆåï¼Œåé¢å…·ä½“ä½¿ç”¨çš„ API éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>å’Œ Spring Cache + Redis ç›¸æ¯”ï¼ŒSpring Cache + Ehcache ä¸»è¦æ˜¯é…ç½®æœ‰æ‰€å·®å¼‚ï¼Œå…·ä½“çš„ç”¨æ³•æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨æ­¥éª¤ã€‚</p><h3 id="2-1-é¡¹ç›®åˆ›å»º"><a href="#2-1-é¡¹ç›®åˆ›å»º" class="headerlink" title="2.1 é¡¹ç›®åˆ›å»º"></a>2.1 é¡¹ç›®åˆ›å»º</h3><p>é¦–å…ˆï¼Œæ¥åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¼•å…¥ Cache ä¾èµ–ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/17-1-20210525152240867.png" alt="img"></p><p>å·¥ç¨‹åˆ›å»ºå®Œæˆåï¼Œå¼•å…¥ Ehcache çš„ä¾èµ–ï¼ŒEhcache ç›®å‰æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/17-2-20210525152240892.png" alt="img"></p><p>è¿™é‡Œé‡‡ç”¨ç¬¬äºŒä¸ªï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ Ehcache ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sf.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.10.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><h3 id="2-2-æ·»åŠ -Ehcache-é…ç½®"><a href="#2-2-æ·»åŠ -Ehcache-é…ç½®" class="headerlink" title="2.2 æ·»åŠ  Ehcache é…ç½®"></a>2.2 æ·»åŠ  Ehcache é…ç½®</h3><p>åœ¨ resources ç›®å½•ä¸‹ï¼Œæ·»åŠ  ehcache çš„é…ç½®æ–‡ä»¶ ehcache.xml ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">diskStore</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;java.io.tmpdir/shiro-spring-sample&quot;</span>/&gt;</span>    &lt;defaultCache            maxElementsInMemory=&quot;10000&quot;            eternal=&quot;false&quot;            timeToIdleSeconds=&quot;120&quot;            timeToLiveSeconds=&quot;120&quot;            overflowToDisk=&quot;false&quot;            diskPersistent=&quot;false&quot;            diskExpiryThreadIntervalSeconds=&quot;120&quot;    /&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span></span><span class="hljs-tag">            <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;10000&quot;</span></span><span class="hljs-tag">            <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;true&quot;</span></span><span class="hljs-tag">            <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;true&quot;</span></span><span class="hljs-tag">            <span class="hljs-attr">diskPersistent</span>=<span class="hljs-string">&quot;true&quot;</span></span><span class="hljs-tag">            <span class="hljs-attr">diskExpiryThreadIntervalSeconds</span>=<span class="hljs-string">&quot;600&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span></code></pre></div><p>é…ç½®å«ä¹‰ï¼š</p><ul><li>name:ç¼“å­˜åç§°ã€‚</li><li>maxElementsInMemoryï¼šç¼“å­˜æœ€å¤§ä¸ªæ•°ã€‚</li><li>eternal:å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œä¸€ä½†è®¾ç½®äº†ï¼Œtimeoutå°†ä¸èµ·ä½œç”¨ã€‚</li><li>timeToIdleSecondsï¼šè®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“eternal=falseå¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§ã€‚</li><li>timeToLiveSecondsï¼šè®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰å…è®¸å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚æœ€å¤§æ—¶é—´ä»‹äºåˆ›å»ºæ—¶é—´å’Œå¤±æ•ˆæ—¶é—´ä¹‹é—´ã€‚ä»…å½“eternal=falseå¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯0.ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å­˜æ´»æ—¶é—´æ— ç©·å¤§ã€‚</li><li>overflowToDiskï¼šå½“å†…å­˜ä¸­å¯¹è±¡æ•°é‡è¾¾åˆ°maxElementsInMemoryæ—¶ï¼ŒEhcacheå°†ä¼šå¯¹è±¡å†™åˆ°ç£ç›˜ä¸­ã€‚</li><li>diskSpoolBufferSizeMBï¼šè¿™ä¸ªå‚æ•°è®¾ç½®DiskStoreï¼ˆç£ç›˜ç¼“å­˜ï¼‰çš„ç¼“å­˜åŒºå¤§å°ã€‚é»˜è®¤æ˜¯30MBã€‚æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒºã€‚</li><li>maxElementsOnDiskï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ã€‚</li><li>diskPersistentï¼šæ˜¯å¦ç¼“å­˜è™šæ‹Ÿæœºé‡å¯æœŸæ•°æ®ã€‚</li><li>diskExpiryThreadIntervalSecondsï¼šç£ç›˜å¤±æ•ˆçº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚</li><li>memoryStoreEvictionPolicyï¼šå½“è¾¾åˆ°maxElementsInMemoryé™åˆ¶æ—¶ï¼ŒEhcacheå°†ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥å»æ¸…ç†å†…å­˜ã€‚é»˜è®¤ç­–ç•¥æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ã€‚ä½ å¯ä»¥è®¾ç½®ä¸ºFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æˆ–æ˜¯LFUï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚</li><li>clearOnFlushï¼šå†…å­˜æ•°é‡æœ€å¤§æ—¶æ˜¯å¦æ¸…é™¤ã€‚</li><li>diskStore åˆ™è¡¨ç¤ºä¸´æ—¶ç¼“å­˜çš„ç¡¬ç›˜ç›®å½•ã€‚</li></ul><p><strong>æ³¨æ„</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼Œå¿…é¡»å« ehcache.xml ï¼Œå¦‚æœä¸€å®šè¦æ¢ä¸€ä¸ªåå­—ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ application.properties ä¸­æ˜ç¡®æŒ‡å®šé…ç½®æ–‡ä»¶åï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.cache.ehcache.config</span>=<span class="hljs-string">classpath:aaa.xml</span></code></pre></div><h3 id="2-3-å¼€å¯ç¼“å­˜"><a href="#2-3-å¼€å¯ç¼“å­˜" class="headerlink" title="2.3 å¼€å¯ç¼“å­˜"></a>2.3 å¼€å¯ç¼“å­˜</h3><p>å¼€å¯ç¼“å­˜çš„æ–¹å¼ï¼Œä¹Ÿå’Œ Redis ä¸­ä¸€æ ·ï¼Œå¦‚ä¸‹æ·»åŠ  <code>@EnableCaching</code> ä¾èµ–å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableCaching</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EhcacheApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(EhcacheApplication.class, args);    &#125;&#125;</code></pre></div><p>å…¶å®åˆ°è¿™ä¸€æ­¥ï¼ŒEhcache å°±ç®—é…ç½®å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥çš„ç”¨æ³•ï¼Œå’ŒRedisçš„å°±ä¸€æ ·äº†</p><h3 id="2-4-ä½¿ç”¨ç¼“å­˜"><a href="#2-4-ä½¿ç”¨ç¼“å­˜" class="headerlink" title="2.4 ä½¿ç”¨ç¼“å­˜"></a>2.4 ä½¿ç”¨ç¼“å­˜</h3><p>è¿™é‡Œä¸»è¦å‘å°ä¼™ä¼´ä»¬ä»‹ç»ç¼“å­˜ä¸­å‡ ä¸ªæ ¸å¿ƒçš„æ³¨è§£ä½¿ç”¨ã€‚</p><h4 id="CacheConfig-1"><a href="#CacheConfig-1" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h4><p>è¿™ä¸ªæ³¨è§£åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œç”¨æ¥æè¿°è¯¥ç±»ä¸­æ‰€æœ‰æ–¹æ³•ä½¿ç”¨çš„ç¼“å­˜åç§°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è¯¥æ³¨è§£ï¼Œç›´æ¥åœ¨å…·ä½“çš„ç¼“å­˜æ³¨è§£ä¸Šé…ç½®åç§°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-meta">@CacheConfig(cacheNames = &quot;user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;&#125;</code></pre></div><h4 id="Cacheable-1"><a href="#Cacheable-1" class="headerlink" title="@Cacheable"></a>@Cacheable</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨æŸ¥è¯¢æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºå°†ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç¼“å­˜èµ·æ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„ key å°±æ˜¯æ–¹æ³•çš„å‚æ•°ï¼Œç¼“å­˜çš„ value å°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(key = &quot;#id&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Integer id,String username)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;getUserById&quot;</span>);    <span class="hljs-keyword">return</span> getUserFromDBById(id);&#125;</code></pre></div><p>å½“æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤å°±ä½¿ç”¨å¤šä¸ªå‚æ•°æ¥åš key ï¼Œå¦‚æœåªéœ€è¦å…¶ä¸­æŸä¸€ä¸ªå‚æ•°åš key ï¼Œåˆ™å¯ä»¥åœ¨ @Cacheable æ³¨è§£ä¸­ï¼Œé€šè¿‡ key å±æ€§æ¥æŒ‡å®š key ï¼Œå¦‚ä¸Šä»£ç å°±è¡¨ç¤ºåªä½¿ç”¨ id ä½œä¸ºç¼“å­˜çš„ key ï¼Œå¦‚æœå¯¹ key æœ‰å¤æ‚çš„è¦æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰ keyGenerator ã€‚å½“ç„¶ï¼ŒSpring Cache ä¸­æä¾›äº†rootå¯¹è±¡ï¼Œå¯ä»¥åœ¨ä¸å®šä¹‰ keyGenerator çš„æƒ…å†µä¸‹å®ç°ä¸€äº›å¤æ‚çš„æ•ˆæœï¼Œroot å¯¹è±¡æœ‰å¦‚ä¸‹å±æ€§ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13-2-20210524162503768-20210525152240961.png" alt="img"></p><p>ä¹Ÿå¯ä»¥é€šè¿‡ keyGenerator è‡ªå®šä¹‰ key ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyKeyGenerator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">KeyGenerator</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">generate</span><span class="hljs-params">(Object target, Method method, Object... params)</span> </span>&#123;        <span class="hljs-keyword">return</span> method.getName()+Arrays.toString(params);    &#125;&#125;</code></pre></div><p>ç„¶ååœ¨æ–¹æ³•ä¸Šä½¿ç”¨è¯¥ keyGenerator ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(keyGenerator = &quot;myKeyGenerator&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(Long id)</span> </span>&#123;    User user = <span class="hljs-keyword">new</span> User();    user.setId(id);    user.setUsername(<span class="hljs-string">&quot;lisi&quot;</span>);    System.out.println(user);    <span class="hljs-keyword">return</span> user;&#125;</code></pre></div><h4 id="CachePut-1"><a href="#CachePut-1" class="headerlink" title="@CachePut"></a>@CachePut</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨æ›´æ–°æ–¹æ³•ä¸Šï¼Œå½“æ•°æ®åº“ä¸­çš„æ•°æ®æ›´æ–°åï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¹Ÿè¦è·Ÿç€æ›´æ–°ï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œå¯ä»¥å°†æ–¹æ³•çš„è¿”å›å€¼è‡ªåŠ¨æ›´æ–°åˆ°å·²ç»å­˜åœ¨çš„ key ä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@CachePut(key = &quot;#user.id&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">updateUserById</span><span class="hljs-params">(User user)</span> </span>&#123;    <span class="hljs-keyword">return</span> user;&#125;</code></pre></div><h4 id="CacheEvict-1"><a href="#CacheEvict-1" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h4><p>è¿™ä¸ªæ³¨è§£ä¸€èˆ¬åŠ åœ¨åˆ é™¤æ–¹æ³•ä¸Šï¼Œå½“æ•°æ®åº“ä¸­çš„æ•°æ®åˆ é™¤åï¼Œç›¸å…³çš„ç¼“å­˜æ•°æ®ä¹Ÿè¦è‡ªåŠ¨æ¸…é™¤ï¼Œè¯¥æ³¨è§£åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥é…ç½®æŒ‰ç…§æŸç§æ¡ä»¶åˆ é™¤ï¼ˆ condition å±æ€§ï¼‰æˆ–è€…æˆ–è€…é…ç½®æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼ˆ allEntries å±æ€§ï¼‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict()</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(Integer id)</span> </span>&#123;    <span class="hljs-comment">//åœ¨è¿™é‡Œæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œ åˆ é™¤æ˜¯å»æ•°æ®åº“ä¸­åˆ é™¤</span>&#125;</code></pre></div><h1 id="SpringBootå®‰å…¨ç®¡ç†"><a href="#SpringBootå®‰å…¨ç®¡ç†" class="headerlink" title="SpringBootå®‰å…¨ç®¡ç†"></a>SpringBootå®‰å…¨ç®¡ç†</h1><h2 id="1-Spring-Security"><a href="#1-Spring-Security" class="headerlink" title="1. Spring Security"></a>1. Spring Security</h2><p>Spring Security æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œå®é™…ä¸Šï¼Œåœ¨ Spring Boot å‡ºç°ä¹‹å‰ï¼ŒSpring Security å°±å·²ç»å‘å±•äº†å¤šå¹´äº†ï¼Œä½†æ˜¯ä½¿ç”¨çš„å¹¶ä¸å¤šï¼Œå®‰å…¨ç®¡ç†è¿™ä¸ªé¢†åŸŸï¼Œä¸€ç›´æ˜¯ Shiro çš„å¤©ä¸‹ã€‚</p><p>ç›¸å¯¹äº Shiroï¼Œåœ¨ SSM/SSH ä¸­æ•´åˆ Spring Security éƒ½æ˜¯æ¯”è¾ƒéº»çƒ¦çš„æ“ä½œï¼Œæ‰€ä»¥ï¼ŒSpring Security è™½ç„¶åŠŸèƒ½æ¯” Shiro å¼ºå¤§ï¼Œä½†æ˜¯ä½¿ç”¨åè€Œæ²¡æœ‰ Shiro å¤šï¼ˆShiro è™½ç„¶åŠŸèƒ½æ²¡æœ‰ Spring Security å¤šï¼Œä½†æ˜¯å¯¹äºå¤§éƒ¨åˆ†é¡¹ç›®è€Œè¨€ï¼ŒShiro ä¹Ÿå¤Ÿç”¨äº†ï¼‰ã€‚</p><p>è‡ªä»æœ‰äº† Spring Boot ä¹‹åï¼ŒSpring Boot å¯¹äº Spring Security æä¾›äº† è‡ªåŠ¨åŒ–é…ç½®æ–¹æ¡ˆï¼Œå¯ä»¥é›¶é…ç½®ä½¿ç”¨ Spring Securityã€‚</p><p>å› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¸¸è§çš„å®‰å…¨ç®¡ç†æŠ€æœ¯æ ˆçš„ç»„åˆæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>SSM + Shiro</li><li>Spring Boot/Spring Cloud + Spring Security</li></ul><blockquote><p>æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæ¨èçš„ç»„åˆè€Œå·²ï¼Œå¦‚æœå•çº¯ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œæ— è®ºæ€ä¹ˆç»„åˆï¼Œéƒ½æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚</p></blockquote><h3 id="1-1-é¡¹ç›®åˆ›å»º"><a href="#1-1-é¡¹ç›®åˆ›å»º" class="headerlink" title="1.1 é¡¹ç›®åˆ›å»º"></a>1.1 é¡¹ç›®åˆ›å»º</h3><p>åœ¨ Spring Boot ä¸­ä½¿ç”¨ Spring Security éå¸¸å®¹æ˜“ï¼Œå¼•å…¥ä¾èµ–å³å¯ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/25-1-20210525152241244.png" alt="img"></p><p>pom.xml ä¸­çš„ Spring Security ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>åªè¦åŠ å…¥ä¾èµ–ï¼Œé¡¹ç›®çš„æ‰€æœ‰æ¥å£éƒ½ä¼šè¢«è‡ªåŠ¨ä¿æŠ¤èµ·æ¥ã€‚</p><h3 id="1-2-åˆæ¬¡ä½“éªŒ"><a href="#1-2-åˆæ¬¡ä½“éªŒ" class="headerlink" title="1.2 åˆæ¬¡ä½“éªŒ"></a>1.2 åˆæ¬¡ä½“éªŒ</h3><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª HelloController:</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><p>è®¿é—® <code>/hello</code> ï¼Œéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/25-2-20210525152240990.png" alt="img"></p><p>å½“ç”¨æˆ·ä»æµè§ˆå™¨å‘é€è¯·æ±‚è®¿é—® <code>/hello</code> æ¥å£æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å› <code>302</code> å“åº”ç ï¼Œè®©å®¢æˆ·ç«¯é‡å®šå‘åˆ° <code>/login</code> é¡µé¢ï¼Œç”¨æˆ·åœ¨ <code>/login</code> é¡µé¢ç™»å½•ï¼Œç™»é™†æˆåŠŸä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨è·³è½¬åˆ° <code>/hello</code> æ¥å£</p><p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>POSTMAN</code> æ¥å‘é€è¯·æ±‚ï¼Œä½¿ç”¨ <code>POSTMAN</code> å‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼ˆè¿™æ ·å¯ä»¥é¿å…é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼‰ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/25-3-20210525152241103.png" alt="img"></p><p>é€šè¿‡ä»¥ä¸Šä¸¤ç§ä¸åŒçš„ç™»å½•æ–¹å¼ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒSpring Security æ”¯æŒä¸¤ç§ä¸åŒçš„è®¤è¯æ–¹å¼ï¼š</p><ul><li>å¯ä»¥é€šè¿‡ form è¡¨å•æ¥è®¤è¯</li><li>å¯ä»¥é€šè¿‡ HttpBasic æ¥è®¤è¯</li></ul><h3 id="1-3-ç”¨æˆ·åé…ç½®"><a href="#1-3-ç”¨æˆ·åé…ç½®" class="headerlink" title="1.3 ç”¨æˆ·åé…ç½®"></a>1.3 ç”¨æˆ·åé…ç½®</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç™»å½•çš„ç”¨æˆ·åæ˜¯ <code>user</code> ï¼Œå¯†ç åˆ™æ˜¯é¡¹ç›®å¯åŠ¨æ—¶éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä»å¯åŠ¨çš„æ§åˆ¶å°æ—¥å¿—ä¸­çœ‹åˆ°é»˜è®¤å¯†ç ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/25-4-20210525152241074.png" alt="img"></p><p>è¿™ä¸ªéšæœºç”Ÿæˆçš„å¯†ç ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šå˜ã€‚å¯¹ç™»å½•çš„ç”¨æˆ·å/å¯†ç è¿›è¡Œé…ç½®ï¼Œæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼ï¼š</p><ul><li>åœ¨ application.properties ä¸­è¿›è¡Œé…ç½®</li><li>é€šè¿‡ Java ä»£ç é…ç½®åœ¨å†…å­˜ä¸­</li><li>é€šè¿‡ Java ä»æ•°æ®åº“ä¸­åŠ è½½</li></ul><p>å‰ä¸¤ç§æ¯”è¾ƒç®€å•ï¼Œç¬¬ä¸‰ç§ä»£ç é‡ç•¥å¤§ï¼Œæœ¬æ–‡å°±å…ˆæ¥çœ‹çœ‹å‰ä¸¤ç§ï¼Œç¬¬ä¸‰ç§åé¢å†å•ç‹¬å†™æ–‡ç« ä»‹ç»ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ<a href="http://springboot.javaboy.org/2019/0725/springboot-springsecurity">å¾®äººäº‹é¡¹ç›®</a></p><h4 id="é…ç½®æ–‡ä»¶é…ç½®ç”¨æˆ·å-å¯†ç "><a href="#é…ç½®æ–‡ä»¶é…ç½®ç”¨æˆ·å-å¯†ç " class="headerlink" title="é…ç½®æ–‡ä»¶é…ç½®ç”¨æˆ·å/å¯†ç "></a>é…ç½®æ–‡ä»¶é…ç½®ç”¨æˆ·å/å¯†ç </h4><p>å¯ä»¥ç›´æ¥åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½®ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.security.user.name</span>=<span class="hljs-string">javaboy</span><span class="hljs-meta">spring.security.user.password</span>=<span class="hljs-string">123</span></code></pre></div><p>é…ç½®å®Œæˆåï¼Œé‡å¯é¡¹ç›®ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™é‡Œé…ç½®çš„ç”¨æˆ·å/å¯†ç ç™»å½•äº†</p><h4 id="Java-é…ç½®ç”¨æˆ·å-å¯†ç "><a href="#Java-é…ç½®ç”¨æˆ·å-å¯†ç " class="headerlink" title="Java é…ç½®ç”¨æˆ·å/å¯†ç "></a>Java é…ç½®ç”¨æˆ·å/å¯†ç </h4><p>ä¹Ÿå¯ä»¥åœ¨ Java ä»£ç ä¸­é…ç½®ç”¨æˆ·åå¯†ç ï¼Œé¦–å…ˆéœ€è¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Spring Security çš„é…ç½®ç±»ï¼Œé›†æˆè‡ª WebSecurityConfigurerAdapter ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-comment">//ä¸‹é¢è¿™ä¸¤è¡Œé…ç½®è¡¨ç¤ºåœ¨å†…å­˜ä¸­é…ç½®äº†ä¸¤ä¸ªç”¨æˆ·</span>        auth.inMemoryAuthentication()                .withUser(<span class="hljs-string">&quot;javaboy&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$OR3VSksVAmCzc.7WeaRPR.t0wyCsIj24k0Bne8iKWV1o.V9wsP8Xe&quot;</span>)                .and()          .withUser(<span class="hljs-string">&quot;lisi&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$p1H8iWa8I4.CA.7Z8bwLjes91ZpY.rYREGHQEInNtAp4NzL6PLKxi&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;&#125;</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬åœ¨ configure æ–¹æ³•ä¸­é…ç½®äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·çš„å¯†ç éƒ½æ˜¯åŠ å¯†ä¹‹åçš„å­—ç¬¦ä¸²(æ˜æ–‡æ˜¯ 123)ï¼Œ<strong>ä» Spring5 å¼€å§‹ï¼Œå¼ºåˆ¶è¦æ±‚å¯†ç è¦åŠ å¯†</strong>ï¼Œå¦‚æœéä¸æƒ³åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿‡æœŸçš„ PasswordEncoder çš„å®ä¾‹ NoOpPasswordEncoderï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšï¼Œæ¯•ç«Ÿä¸å®‰å…¨ã€‚</p><h3 id="1-4-åŠ å¯†æ–¹æ¡ˆ"><a href="#1-4-åŠ å¯†æ–¹æ¡ˆ" class="headerlink" title="1.4 åŠ å¯†æ–¹æ¡ˆ"></a>1.4 åŠ å¯†æ–¹æ¡ˆ</h3><p>å¯†ç åŠ å¯†æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åˆ°æ•£åˆ—å‡½æ•°ï¼Œåˆç§°æ•£åˆ—ç®—æ³•ã€å“ˆå¸Œå‡½æ•°ï¼Œè¿™æ˜¯ä¸€ç§ä»ä»»ä½•æ•°æ®ä¸­åˆ›å»ºæ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚æ•£åˆ—å‡½æ•°æŠŠæ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ï¼Œå°†æ•°æ®çš„æ ¼å¼å›ºå®šä¸‹æ¥ï¼Œç„¶åå°†æ•°æ®æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªæ•£åˆ—å€¼ã€‚æ•£åˆ—å€¼é€šå¸¸ç”¨ä¸€ä¸ªçŸ­çš„éšæœºå­—æ¯å’Œæ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²æ¥ä»£è¡¨ã€‚å¥½çš„æ•£åˆ—å‡½æ•°åœ¨è¾“å…¥åŸŸä¸­å¾ˆå°‘å‡ºç°æ•£åˆ—å†²çªã€‚åœ¨æ•£åˆ—è¡¨å’Œæ•°æ®å¤„ç†ä¸­ï¼Œä¸æŠ‘åˆ¶å†²çªæ¥åŒºåˆ«æ•°æ®ï¼Œä¼šä½¿å¾—æ•°æ®åº“è®°å½•æ›´éš¾æ‰¾åˆ°ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ•£åˆ—å‡½æ•°æœ‰ MD5 æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€å®‰å…¨æ•£åˆ—ç®—æ³•ï¼ˆSecure Hash Algorithmï¼‰ã€‚</p><p>ä½†æ˜¯ä»…ä»…ä½¿ç”¨æ•£åˆ—å‡½æ•°è¿˜ä¸å¤Ÿï¼Œä¸ºäº†å¢åŠ å¯†ç çš„å®‰å…¨æ€§ï¼Œä¸€èˆ¬åœ¨å¯†ç åŠ å¯†è¿‡ç¨‹ä¸­è¿˜éœ€è¦åŠ ç›ï¼Œæ‰€è°“çš„ç›å¯ä»¥æ˜¯ä¸€ä¸ªéšæœºæ•°ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·åï¼ŒåŠ ç›ä¹‹åï¼Œå³ä½¿å¯†ç æ˜æ–‡ç›¸åŒçš„ç”¨æˆ·ç”Ÿæˆçš„å¯†ç å¯†æ–‡ä¹Ÿä¸ç›¸åŒï¼Œè¿™å¯ä»¥æå¤§çš„æé«˜å¯†ç çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ä¼ ç»Ÿçš„åŠ ç›æ–¹å¼éœ€è¦åœ¨æ•°æ®åº“ä¸­æœ‰ä¸“é—¨çš„å­—æ®µæ¥è®°å½•ç›å€¼ï¼Œè¿™ä¸ªå­—æ®µå¯èƒ½æ˜¯ç”¨æˆ·åå­—æ®µï¼ˆå› ä¸ºç”¨æˆ·åå”¯ä¸€ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªä¸“é—¨è®°å½•ç›å€¼çš„å­—æ®µï¼Œè¿™æ ·çš„é…ç½®æ¯”è¾ƒç¹çã€‚ </p><p>Spring Security æä¾›äº†å¤šç§å¯†ç åŠ å¯†æ–¹æ¡ˆï¼Œå®˜æ–¹æ¨èä½¿ç”¨ BCryptPasswordEncoderï¼ŒBCryptPasswordEncoder ä½¿ç”¨ BCrypt å¼ºå“ˆå¸Œå‡½æ•°ï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ—¶å¯ä»¥é€‰æ‹©æä¾› strength å’Œ SecureRandom å®ä¾‹ã€‚strength è¶Šå¤§ï¼Œå¯†é’¥çš„è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œå¯†é’¥è¿­ä»£æ¬¡æ•°ä¸º 2^strengthã€‚strength å–å€¼åœ¨ 4~31 ä¹‹é—´ï¼Œé»˜è®¤ä¸º 10ã€‚</p><p>Spring Security ä¸­æä¾›äº† BCryptPasswordEncoder å¯†ç ç¼–ç å·¥å…·ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¯†ç çš„åŠ å¯†åŠ ç›ï¼Œç›¸åŒæ˜æ–‡åŠ å¯†å‡ºæ¥çš„ç»“æœæ€»æ˜¯ä¸åŒï¼Œè¿™æ ·å°±ä¸éœ€è¦ç”¨æˆ·å»é¢å¤–ä¿å­˜<strong>ç›</strong>çš„å­—æ®µäº†ï¼Œè¿™ä¸€ç‚¹æ¯” Shiro è¦æ–¹ä¾¿å¾ˆå¤šï¼Œè€Œ BCryptPasswordEncoder å°±æ˜¯ PasswordEncoder æ¥å£çš„å®ç°ç±»ï¼Œåªéœ€è¦æä¾› BCryptPasswordEncoder è¿™ä¸ª Bean çš„å®ä¾‹å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">10</span>);&#125;</code></pre></div><p>åˆ›å»º BCryptPasswordEncoder æ—¶ä¼ å…¥çš„å‚æ•° 10 å°±æ˜¯ strengthï¼Œå³å¯†é’¥çš„è¿­ä»£æ¬¡æ•°ï¼ˆä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œé»˜è®¤ä¸º 10ï¼‰ã€‚åŒæ—¶ï¼Œé…ç½®çš„å†…å­˜ç”¨æˆ·çš„å¯†ç ä¹Ÿä¸å†æ˜¯ 123 äº†ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">auth.inMemoryAuthentication().withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&quot;</span>).roles(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>).and().withUser(<span class="hljs-string">&quot;sang&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$eUHbAOMq4bpxTvOVz33LIehLe3fu6NwqC9tdOcxJXEhyZ4simqXTC&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>);</code></pre></div><p>è¿™é‡Œçš„å¯†ç å°±æ˜¯ä½¿ç”¨ BCryptPasswordEncoder åŠ å¯†åçš„å¯†ç ï¼Œè™½ç„¶ admin å’Œ sang åŠ å¯†åçš„å¯†ç ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ˜æ–‡éƒ½æ˜¯ 123ã€‚é…ç½®å®Œæˆåï¼Œä½¿ç”¨ admin/123 æˆ–è€… sang/123 å°±å¯ä»¥å®ç°ç™»å½•ã€‚</p><p>æœ¬æ¡ˆä¾‹ä½¿ç”¨äº†é…ç½®åœ¨å†…å­˜ä¸­çš„ç”¨æˆ·ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œå› æ­¤éœ€è¦åœ¨ç”¨æˆ·æ³¨å†Œæ—¶å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">reg</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder(<span class="hljs-number">10</span>);        String encodePasswod = encoder.encode(password);        <span class="hljs-keyword">return</span> saveToDb(username, encodePasswod);    &#125;&#125;</code></pre></div><p>ç”¨æˆ·å°†å¯†ç ä»å‰ç«¯ä¼ æ¥ä¹‹åï¼Œé€šè¿‡è°ƒç”¨ BCryptPasswordEncoder å®ä¾‹ä¸­çš„ encode æ–¹æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†ï¼ŒåŠ å¯†å®Œæˆåå°†å¯†æ–‡å­˜å…¥æ•°æ®åº“ã€‚</p><h3 id="1-5-ç™»å½•é…ç½®"><a href="#1-5-ç™»å½•é…ç½®" class="headerlink" title="1.5 ç™»å½•é…ç½®"></a>1.5 ç™»å½•é…ç½®</h3><p>å¯¹äºç™»å½•æ¥å£ï¼Œç™»å½•æˆåŠŸåçš„å“åº”ï¼Œç™»å½•å¤±è´¥åçš„å“åº”ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨ WebSecurityConfigurerAdapter çš„å®ç°ç±»ä¸­è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;      <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Autowired</span>    VerifyCodeFilter verifyCodeFilter;    <span class="hljs-comment">//httpé…ç½®</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.addFilterBefore(verifyCodeFilter, UsernamePasswordAuthenticationFilter.class);        http        .authorizeRequests()<span class="hljs-comment">//å¼€å¯ç™»å½•é…ç½®</span>        .antMatchers(<span class="hljs-string">&quot;/hello&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)<span class="hljs-comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œéœ€è¦å…·å¤‡ admin è¿™ä¸ªè§’è‰²</span>        .anyRequest().authenticated()<span class="hljs-comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>        .and()        .formLogin()        <span class="hljs-comment">//å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>        .loginPage(<span class="hljs-string">&quot;/login_p&quot;</span>)        <span class="hljs-comment">//ç™»å½•å¤„ç†æ¥å£</span>        .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)        <span class="hljs-comment">//å®šä¹‰ç™»å½•æ—¶ï¼Œç”¨æˆ·åçš„ keyï¼Œé»˜è®¤ä¸º username</span>        .usernameParameter(<span class="hljs-string">&quot;uname&quot;</span>)        <span class="hljs-comment">//å®šä¹‰ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç çš„ keyï¼Œé»˜è®¤ä¸º password</span>        .passwordParameter(<span class="hljs-string">&quot;passwd&quot;</span>)                  <span class="hljs-comment">//ç™»å½•æˆåŠŸçš„å¤„ç†å™¨</span>                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">200</span>);                        map.put(<span class="hljs-string">&quot;msg&quot;</span>, authentication.getPrincipal());                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));                        out.flush();                        out.close();                    &#125;                &#125;)                    <span class="hljs-comment">//ç™»å½•å¤±è´¥çš„å¤„ç†å™¨</span>               .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">401</span>);                        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> LockedException) &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;è´¦æˆ·è¢«é”å®šï¼Œç™»å½•å¤±è´¥!&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç è¾“å…¥é”™è¯¯ï¼Œç™»å½•å¤±è´¥!&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> DisabledException) &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œç™»å½•å¤±è´¥!&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;è´¦æˆ·è¿‡æœŸï¼Œç™»å½•å¤±è´¥!&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;å¯†ç è¿‡æœŸï¼Œç™»å½•å¤±è´¥!&quot;</span>);                        &#125; <span class="hljs-keyword">else</span> &#123;                            map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ç™»å½•å¤±è´¥!&quot;</span>);                        &#125;                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));                        out.flush();                        out.close();                    &#125;                &#125;)            .permitAll()<span class="hljs-comment">//å’Œè¡¨å•ç™»å½•ç›¸å…³çš„æ¥å£ç»Ÿç»Ÿéƒ½ç›´æ¥é€šè¿‡</span>            .and()            .logout()            .logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>)          <span class="hljs-comment">//æ³¨é”€æˆåŠŸçš„å¤„ç†å™¨</span>                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">200</span>);                        map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;æ³¨é”€ç™»å½•æˆåŠŸ!&quot;</span>);                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));                        out.flush();                        out.close();                    &#125;                &#125;)            .permitAll()            .and()            .httpBasic()            .and()            .csrf().disable();    &#125;&#125;</code></pre></div><p>æˆ‘ä»¬å¯ä»¥åœ¨ successHandler æ–¹æ³•ä¸­ï¼Œé…ç½®ç™»å½•æˆåŠŸçš„å›è°ƒï¼Œå¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»å¼€å‘çš„è¯ï¼Œç™»å½•æˆåŠŸåè¿”å› JSON å³å¯ï¼ŒåŒç†ï¼ŒfailureHandler æ–¹æ³•ä¸­é…ç½®ç™»å½•å¤±è´¥çš„å›è°ƒï¼ŒlogoutSuccessHandler ä¸­åˆ™é…ç½®æ³¨é”€æˆåŠŸçš„å›è°ƒã€‚</p><h4 id="å¤šä¸ªHttpçš„é…ç½®"><a href="#å¤šä¸ªHttpçš„é…ç½®" class="headerlink" title="å¤šä¸ªHttpçš„é…ç½®"></a><strong>å¤šä¸ªHttpçš„é…ç½®</strong></h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-comment">//ä¸éœ€è¦ç»§æ‰¿</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiHttpSecurityConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;  <span class="hljs-comment">//å…¬ç”¨</span>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.inMemoryAuthentication()                .withUser(<span class="hljs-string">&quot;javaboy&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$G3kVAJHvmRrr6sOj.j4xpO2Dsxl5EG8rHycPHFWyi9UMIhtdSH15u&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)                .and()                .withUser(<span class="hljs-string">&quot;æ±Ÿå—ä¸€ç‚¹é›¨&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$kWjG2GxWhm/2tN2ZBpi7bexXjUneIKFxIAaMYJzY7WcziZLCD4PZS&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);    &#125;    <span class="hljs-meta">@Configuration</span>    <span class="hljs-meta">@Order(1)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;            http.antMatcher(<span class="hljs-string">&quot;/admin/**&quot;</span>).authorizeRequests().anyRequest().hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>);        &#125;    &#125;    <span class="hljs-meta">@Configuration</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OtherSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;            http.authorizeRequests().anyRequest().authenticated()                    .and()                    .formLogin()                    .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)                    .permitAll()                    .and()                    .csrf().disable();        &#125;    &#125;&#125;</code></pre></div><h4 id="è¡¨è¾¾å¼æ§åˆ¶æ–¹æ³•æƒé™"><a href="#è¡¨è¾¾å¼æ§åˆ¶æ–¹æ³•æƒé™" class="headerlink" title="è¡¨è¾¾å¼æ§åˆ¶æ–¹æ³•æƒé™"></a>è¡¨è¾¾å¼æ§åˆ¶æ–¹æ³•æƒé™</h4><p>æ–¹æ³•çš„å®‰å…¨é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœåœ¨Configç±»ä¸ŠåŠ ä¸Šæ³¨è§£<code>@EnableGlobalMethodSecurity(prePostEnabled = true,securedEnabled = true)</code>å°±å¯ä»¥å¼€å¯æ–¹æ³•çš„å®‰å…¨</p><p>è¿™ä¸ªé…ç½®å¼€å¯äº†ä¸‰ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>@PreAuthorizeï¼šæ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™æ£€æŸ¥</li><li>@PostAuthorizeï¼šæ–¹æ³•æ‰§è¡Œåè¿›è¡Œæƒé™æ£€æŸ¥</li><li>@Securedï¼šç±»ä¼¼äº @PreAuthorize</li></ul><p>è¿™ä¸‰ä¸ªç»“åˆ SpEL ä¹‹åï¼Œç”¨æ³•éå¸¸çµæ´»ï¼Œè¿™é‡Œå’Œå¤§å®¶ç¨å¾®åˆ†äº«å‡ ä¸ª Demoã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-meta">@PreAuthorize(&quot;principal.username.equals(&#x27;javaboy&#x27;)&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;    <span class="hljs-meta">@PreAuthorize(&quot;hasRole(&#x27;admin&#x27;)&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin&quot;</span>;    &#125;    <span class="hljs-meta">@Secured(&#123;&quot;ROLE_user&quot;&#125;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user&quot;</span>;    &#125;    <span class="hljs-meta">@PreAuthorize(&quot;#age&gt;98&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;        <span class="hljs-keyword">return</span> String.valueOf(age);    &#125;&#125;</code></pre></div><ul><li>ç¬¬ä¸€ä¸ª hello æ–¹æ³•ï¼Œæ³¨è§£çš„çº¦æŸæ˜¯ï¼Œåªæœ‰å½“å‰ç™»å½•ç”¨æˆ·åä¸º javaboy çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®è¯¥æ–¹æ³•ã€‚</li><li>ç¬¬äºŒä¸ª admin æ–¹æ³•ï¼Œè¡¨ç¤ºè®¿é—®è¯¥æ–¹æ³•çš„ç”¨æˆ·å¿…é¡»å…·å¤‡ admin è§’è‰²ã€‚</li><li>ç¬¬ä¸‰ä¸ª user æ–¹æ³•ï¼Œè¡¨ç¤ºæ–¹æ³•è¯¥æ–¹æ³•çš„ç”¨æˆ·å¿…é¡»å…·å¤‡ user è§’è‰²ï¼Œä½†æ˜¯æ³¨æ„ user è§’è‰²éœ€è¦åŠ ä¸Š <code>ROLE_</code> å‰ç¼€ã€‚</li><li>ç¬¬å››ä¸ª getAge æ–¹æ³•ï¼Œè¡¨ç¤ºè®¿é—®è¯¥æ–¹æ³•çš„ age å‚æ•°å¿…é¡»å¤§äº 98ï¼Œå¦åˆ™è¯·æ±‚ä¸äºˆé€šè¿‡ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„è¡¨è¾¾å¼è¿˜æ˜¯éå¸¸ä¸°å¯Œï¼Œå¦‚æœæƒ³å¼•ç”¨æ–¹æ³•çš„å‚æ•°ï¼Œå‰é¢åŠ ä¸Šä¸€ä¸ª <code>#</code> å³å¯ï¼Œæ—¢å¯ä»¥å¼•ç”¨åŸºæœ¬ç±»å‹çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨å¯¹è±¡å‚æ•°ã€‚</p><h4 id="è¿‡æ»¤æ³¨è§£"><a href="#è¿‡æ»¤æ³¨è§£" class="headerlink" title="è¿‡æ»¤æ³¨è§£"></a>è¿‡æ»¤æ³¨è§£</h4><p>Spring Security ä¸­è¿˜æœ‰ä¸¤ä¸ªè¿‡æ»¤å‡½æ•° @PreFilter å’Œ @PostFilterï¼Œå¯ä»¥æ ¹æ®ç»™å‡ºçš„æ¡ä»¶ï¼Œè‡ªåŠ¨ç§»é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostFilter(&quot;filterObject.lastIndexOf(&#x27;2&#x27;)!=-1&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getAllUser</span><span class="hljs-params">()</span> </span>&#123;    List&lt;String&gt; users = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;        users.add(<span class="hljs-string">&quot;javaboy:&quot;</span> + i);    &#125;    <span class="hljs-keyword">return</span> users;&#125;<span class="hljs-meta">@PreFilter(filterTarget = &quot;ages&quot;,value = &quot;filterObject%2==0&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAllAge</span><span class="hljs-params">(List&lt;Integer&gt; ages,List&lt;String&gt; users)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;ages = &quot;</span> + ages);    System.out.println(<span class="hljs-string">&quot;users = &quot;</span> + users);&#125;</code></pre></div><ul><li>åœ¨ getAllUser æ–¹æ³•ä¸­ï¼Œå¯¹é›†åˆè¿›è¡Œè¿‡æ»¤ï¼Œåªè¿”å›åç¼€ä¸º 2 çš„å…ƒç´ ï¼ŒfilterObject è¡¨ç¤ºè¦è¿‡æ»¤çš„å…ƒç´ å¯¹è±¡ã€‚</li><li>åœ¨ getAllAge æ–¹æ³•ä¸­ï¼Œç”±äºæœ‰ä¸¤ä¸ªé›†åˆï¼Œå› æ­¤ä½¿ç”¨ filterTarget æŒ‡å®šè¿‡æ»¤å¯¹è±¡ã€‚</li></ul><h4 id="å¿½ç•¥æ‹¦æˆª"><a href="#å¿½ç•¥æ‹¦æˆª" class="headerlink" title="å¿½ç•¥æ‹¦æˆª"></a>å¿½ç•¥æ‹¦æˆª</h4><p>å¦‚æœæŸä¸€ä¸ªè¯·æ±‚åœ°å€ä¸éœ€è¦æ‹¦æˆªçš„è¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><ul><li>è®¾ç½®è¯¥åœ°å€åŒ¿åè®¿é—®</li><li>ç›´æ¥è¿‡æ»¤æ‰è¯¥åœ°å€ï¼Œå³è¯¥åœ°å€ä¸èµ° Spring Security è¿‡æ»¤å™¨é“¾</li></ul><p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        web.ignoring().antMatchers(<span class="hljs-string">&quot;/vercode&quot;</span>);    &#125;&#125;</code></pre></div><h3 id="1-7-è‡ªå®šä¹‰è¡¨å•ç™»å½•"><a href="#1-7-è‡ªå®šä¹‰è¡¨å•ç™»å½•" class="headerlink" title="1.7 è‡ªå®šä¹‰è¡¨å•ç™»å½•"></a>1.7 è‡ªå®šä¹‰è¡¨å•ç™»å½•</h3><p>ç»§ç»­å®Œå–„å‰é¢çš„ SecurityConfig ç±»ï¼Œç»§ç»­é‡å†™å®ƒçš„ <code>configure(WebSecurity web)</code> å’Œ <code>configure(HttpSecurity http)</code> æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    web.ignoring().antMatchers(<span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/images/**&quot;</span>);&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            .anyRequest().authenticated()            .and()            .formLogin()            .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)            .permitAll()            .and()            .csrf().disable();&#125;</code></pre></div><ul><li>web.ignoring() ç”¨æ¥é…ç½®å¿½ç•¥æ‰çš„ URL åœ°å€ï¼Œä¸€èˆ¬å¯¹äºé™æ€æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ­¤æ“ä½œã€‚</li><li>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ XML æ¥é…ç½® Spring Security ï¼Œé‡Œè¾¹ä¼šæœ‰ä¸€ä¸ªé‡è¦çš„æ ‡ç­¾ <code>&lt;http&gt;</code>ï¼ŒHttpSecurity æä¾›çš„é…ç½®æ–¹æ³• éƒ½å¯¹åº”äº†è¯¥æ ‡ç­¾ã€‚</li><li>authorizeRequests å¯¹åº”äº† <code>&lt;intercept-url&gt;</code>ã€‚</li><li>formLogin å¯¹åº”äº† <code>&lt;formlogin&gt;</code>ã€‚</li><li>and æ–¹æ³•è¡¨ç¤ºç»“æŸå½“å‰æ ‡ç­¾ï¼Œä¸Šä¸‹æ–‡å›åˆ°HttpSecurityï¼Œå¼€å¯æ–°ä¸€è½®çš„é…ç½®ã€‚</li><li>permitAll è¡¨ç¤ºç™»å½•ç›¸å…³çš„é¡µé¢/æ¥å£ä¸è¦è¢«æ‹¦æˆªã€‚</li><li>æœ€åè®°å¾—å…³é—­ csrf ï¼Œå…³äº csrf é—®é¢˜æˆ‘åˆ°åé¢ä¸“é—¨å’Œå¤§å®¶è¯´</li></ul><p>å½“æˆ‘ä»¬å®šä¹‰äº†ç™»å½•é¡µé¢ä¸º /login.html çš„æ—¶å€™ï¼ŒSpring Security ä¹Ÿä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æ³¨å†Œä¸€ä¸ª /login.html çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯ POST è¯·æ±‚ï¼Œç”¨æ¥å¤„ç†ç™»å½•é€»è¾‘ã€‚</p><p>æˆ‘ä»¬å°†ç™»å½•é¡µé¢çš„ç›¸å…³é™æ€æ–‡ä»¶æ‹·è´åˆ° Spring Boot é¡¹ç›®çš„ resources/static ç›®å½•ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com//2020/03/spring-security-2-7.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/spring-security-2-7.png" alt="img"></a></p><p>å‰ç«¯é¡µé¢æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œæˆ‘æŠŠæ ¸å¿ƒéƒ¨åˆ†åˆ—å‡ºæ¥ï¼ˆå®Œæ•´ä»£ç æˆ‘ä¼šä¸Šä¼ åˆ° GitHubï¼š<a href="https://github.com/lenve/spring-security-samples%EF%BC%89%EF%BC%9A">https://github.com/lenve/spring-security-samplesï¼‰ï¼š</a></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login.html&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;spin&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;pass&quot;</span>&gt;</span>å¯†ç <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pass&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;spin&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button login&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-check&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>form è¡¨å•ä¸­ï¼Œæ³¨æ„ action ä¸º <code>/login.html</code> </p><p>å®é™…ä¸Šå®ƒè¿˜æœ‰ä¸€ä¸ªéšè—çš„æ“ä½œï¼Œå°±æ˜¯ç™»å½•æ¥å£åœ°å€ä¹Ÿè®¾ç½®æˆ <code>/login.html</code> äº†ã€‚æ¢å¥è¯è¯´ï¼Œæ–°çš„ç™»å½•é¡µé¢å’Œç™»å½•æ¥å£åœ°å€éƒ½æ˜¯ <code>/login.html</code>ï¼Œç°åœ¨å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªè¯·æ±‚ï¼š</p><ul><li>GET <a href="http://localhost:8080/login.html">http://localhost:8080/login.html</a></li><li>POST <a href="http://localhost:8080/login.html">http://localhost:8080/login.html</a></li></ul><p>å‰é¢çš„ GET è¯·æ±‚ç”¨æ¥è·å–ç™»å½•é¡µé¢ï¼Œåé¢çš„ POST è¯·æ±‚ç”¨æ¥æäº¤ç™»å½•æ•°æ®ã€‚</p><p>æœ‰çš„å°ä¼™ä¼´ä¼šæ„Ÿåˆ°å¥‡æ€ªï¼Ÿä¸ºä»€ä¹ˆç™»å½•é¡µé¢å’Œç™»å½•æ¥å£ä¸èƒ½åˆ†å¼€é…ç½®å‘¢ï¼Ÿ</p><p>å…¶å®æ˜¯å¯ä»¥åˆ†å¼€é…ç½®çš„ï¼</p><p>åœ¨ SecurityConfig ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ loginProcessingUrl æ–¹æ³•æ¥æŒ‡å®šç™»å½•æ¥å£åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">.and().formLogin().loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>).loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>).permitAll().and()</code></pre></div><p>è¿™æ ·é…ç½®ä¹‹åï¼Œç™»å½•é¡µé¢åœ°å€å’Œç™»å½•æ¥å£åœ°å€å°±åˆ†å¼€äº†ï¼Œå„æ˜¯å„çš„ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ç™»å½•é¡µé¢é‡Œè¾¹çš„ action å±æ€§ï¼Œæ”¹ä¸º <code>/doLogin</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/doLogin&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--çœç•¥--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>æ­¤æ—¶ï¼Œå¯åŠ¨é¡¹ç›®é‡æ–°è¿›è¡Œç™»å½•ï¼Œæˆ‘ä»¬å‘ç°ä¾ç„¶å¯ä»¥ç™»å½•æˆåŠŸã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆé»˜è®¤æƒ…å†µä¸‹ä¸¤ä¸ªé…ç½®åœ°å€æ˜¯ä¸€æ ·çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œform è¡¨å•çš„ç›¸å…³é…ç½®åœ¨ FormLoginConfigurer ä¸­ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª AbstractAuthenticationFilterConfigurer ï¼Œæ‰€ä»¥å½“ FormLoginConfigurer åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒAbstractAuthenticationFilterConfigurer ä¹Ÿä¼šåˆå§‹åŒ–ï¼Œåœ¨ AbstractAuthenticationFilterConfigurer çš„æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">AbstractAuthenticationFilterConfigurer</span><span class="hljs-params">()</span> </span>&#123;setLoginPage(<span class="hljs-string">&quot;/login&quot;</span>);&#125;</code></pre></div><p>è¿™å°±æ˜¯é…ç½®é»˜è®¤çš„ loginPage ä¸º <code>/login</code>ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼ŒFormLoginConfigurer çš„åˆå§‹åŒ–æ–¹æ³• init æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨äº†çˆ¶ç±»çš„ init æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(H http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<span class="hljs-keyword">super</span>.init(http);initDefaultLoginFilter(http);&#125;</code></pre></div><p>è€Œåœ¨çˆ¶ç±»çš„ init æ–¹æ³•ä¸­ï¼Œåˆè°ƒç”¨äº† updateAuthenticationDefaultsï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateAuthenticationDefaults</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">if</span> (loginProcessingUrl == <span class="hljs-keyword">null</span>) &#123;loginProcessingUrl(loginPage);&#125;<span class="hljs-comment">//çœç•¥</span>&#125;</code></pre></div><p>ä»è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç»™ loginProcessingUrl è®¾ç½®å€¼çš„è¯ï¼Œé»˜è®¤å°±ä½¿ç”¨ loginPage ä½œä¸º loginProcessingUrlã€‚</p><p>è€Œå¦‚æœç”¨æˆ·é…ç½®äº† loginPageï¼Œåœ¨é…ç½®å®Œ loginPage ä¹‹åï¼ŒupdateAuthenticationDefaults æ–¹æ³•è¿˜æ˜¯ä¼šè¢«è°ƒç”¨ï¼Œæ­¤æ—¶å¦‚æœæ²¡æœ‰é…ç½® loginProcessingUrlï¼Œåˆ™ä½¿ç”¨æ–°é…ç½®çš„ loginPage ä½œä¸º loginProcessingUrlã€‚</p><h3 id="1-8-åŸºäºæ•°æ®åº“çš„è®¤è¯"><a href="#1-8-åŸºäºæ•°æ®åº“çš„è®¤è¯" class="headerlink" title="1.8 åŸºäºæ•°æ®åº“çš„è®¤è¯"></a>1.8 åŸºäºæ•°æ®åº“çš„è®¤è¯</h3><p><strong>åˆ›å»ºåº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs mysql">&#x2F;*!40101 SET NAMES utf8 *&#x2F;;&#x2F;*!40101 SET SQL_MODE&#x3D;&#39;&#39;*&#x2F;;&#x2F;*!40014 SET @OLD_UNIQUE_CHECKS&#x3D;@@UNIQUE_CHECKS, UNIQUE_CHECKS&#x3D;0 *&#x2F;;&#x2F;*!40014 SET @OLD_FOREIGN_KEY_CHECKS&#x3D;@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS&#x3D;0 *&#x2F;;&#x2F;*!40101 SET @OLD_SQL_MODE&#x3D;@@SQL_MODE, SQL_MODE&#x3D;&#39;NO_AUTO_VALUE_ON_ZERO&#39; *&#x2F;;&#x2F;*!40111 SET @OLD_SQL_NOTES&#x3D;@@SQL_NOTES, SQL_NOTES&#x3D;0 *&#x2F;;CREATE DATABASE &#x2F;*!32312 IF NOT EXISTS*&#x2F;&#96;security&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8 *&#x2F;;USE &#96;security&#96;;&#x2F;*Table structure for table &#96;role&#96; *&#x2F;DROP TABLE IF EXISTS &#96;role&#96;;CREATE TABLE &#96;role&#96; (  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,  &#96;name&#96; varchar(32) DEFAULT NULL,  &#96;nameZh&#96; varchar(32) DEFAULT NULL,  PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;&#x2F;*Data for the table &#96;role&#96; *&#x2F;insert  into &#96;role&#96;(&#96;id&#96;,&#96;name&#96;,&#96;nameZh&#96;) values (1,&#39;ROLE_dba&#39;,&#39;æ•°æ®åº“ç®¡ç†å‘˜&#39;),(2,&#39;ROLE_admin&#39;,&#39;ç³»ç»Ÿç®¡ç†å‘˜&#39;),(3,&#39;ROLE_user&#39;,&#39;ç”¨æˆ·&#39;);&#x2F;*Table structure for table &#96;user&#96; *&#x2F;DROP TABLE IF EXISTS &#96;user&#96;;CREATE TABLE &#96;user&#96; (  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,  &#96;username&#96; varchar(32) DEFAULT NULL,  &#96;password&#96; varchar(255) DEFAULT NULL,  &#96;enabled&#96; tinyint(1) DEFAULT NULL,  &#96;locked&#96; tinyint(1) DEFAULT NULL,  PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;&#x2F;*Data for the table &#96;user&#96; *&#x2F;insert  into &#96;user&#96;(&#96;id&#96;,&#96;username&#96;,&#96;password&#96;,&#96;enabled&#96;,&#96;locked&#96;) values (1,&#39;root&#39;,&#39;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#39;,1,0),(2,&#39;admin&#39;,&#39;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#39;,1,0),(3,&#39;sang&#39;,&#39;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#39;,1,0);&#x2F;*Table structure for table &#96;user_role&#96; *&#x2F;DROP TABLE IF EXISTS &#96;user_role&#96;;CREATE TABLE &#96;user_role&#96; (  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,  &#96;uid&#96; int(11) DEFAULT NULL,  &#96;rid&#96; int(11) DEFAULT NULL,  PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;5 DEFAULT CHARSET&#x3D;utf8;&#x2F;*Data for the table &#96;user_role&#96; *&#x2F;insert  into &#96;user_role&#96;(&#96;id&#96;,&#96;uid&#96;,&#96;rid&#96;) values (1,1,1),(2,1,2),(3,2,2),(4,3,3);&#x2F;*!40101 SET SQL_MODE&#x3D;@OLD_SQL_MODE *&#x2F;;&#x2F;*!40014 SET FOREIGN_KEY_CHECKS&#x3D;@OLD_FOREIGN_KEY_CHECKS *&#x2F;;&#x2F;*!40014 SET UNIQUE_CHECKS&#x3D;@OLD_UNIQUE_CHECKS *&#x2F;;&#x2F;*!40111 SET SQL_NOTES&#x3D;@OLD_SQL_NOTES *&#x2F;;</code></pre></div><p>å¾—åˆ°userè¡¨ã€user_roleè¡¨ã€roleè¡¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525102214396.png" alt="image-20210525102214396"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525102226106.png" alt="image-20210525102226106"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525102243104.png" alt="image-20210525102243104"></p><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://192.168.66.128:3306/security</span><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span></code></pre></div><p><strong>å®šä¹‰å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å®ç°è®¤è¯çš„æ¥å£</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-keyword">private</span> Boolean enabled;    <span class="hljs-keyword">private</span> Boolean locked;    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;   <span class="hljs-comment">//é‡å†™æ¥å£ä¸­çš„æ–¹æ³•</span>   <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> username;    &#125;<span class="hljs-comment">//è´¦æˆ·æ˜¯å¦æœªè¿‡æœŸï¼Œå¯¹åº”userä¸­çš„locked</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;<span class="hljs-comment">//æ˜¯å¦æ²¡æœ‰è¢«é”å®š</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> !locked;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> enabled;    &#125;<span class="hljs-comment">//è¿”å›ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (Role role : roles) &#123;          <span class="hljs-comment">//æ•°æ®åº“çš„roleè¡¨ä¸­ç”¨æˆ·å¿…é¡»ä»¥&quot;ROLE_&quot;å¼€å¤´</span>            authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName()));        &#125;        <span class="hljs-keyword">return</span> authorities;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> password;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String nameZh;    ...&#125;</code></pre></div><p><strong>åˆ›å»ºService</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    UserMapper userMapper;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;      <span class="hljs-comment">//æ–¹æ³•ä¸€  </span>      User user = userMapper.loadUserByUsername(username);        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;ç”¨æˆ·ä¸å­˜åœ¨!&quot;</span>);        &#125;       <span class="hljs-comment">//æ–¹æ³•äºŒ</span>        user.setRoles(userMapper.getUserRolesById(user.getId()));        <span class="hljs-keyword">return</span> user;    &#125;&#125;</code></pre></div><p><strong>Mapperçš„æ¥å£ä»¥åŠå®ç°ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;    <span class="hljs-function">User <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span></span>;    <span class="hljs-function">List&lt;Role&gt; <span class="hljs-title">getUserRolesById</span><span class="hljs-params">(Integer id)</span></span>;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.javaboy.securitydb.mapper.UserMapper&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadUserByUsername&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.javaboy.securitydb.bean.User&quot;</span>&gt;</span>        select * from user where username=#&#123;username&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserRolesById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.javaboy.securitydb.bean.Role&quot;</span>&gt;</span>        select * from role where id in (select rid from user_role where uid=#&#123;id&#125;)    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p><strong>Securityé…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    UserService userService;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(userService);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;      <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .antMatchers(<span class="hljs-string">&quot;/dba/**&quot;</span>).hasRole(<span class="hljs-string">&quot;dba&quot;</span>)                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)                .anyRequest().authenticated()                .and()                .formLogin()                .permitAll()                .and()                .csrf().disable();    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•æ¥å£Controller</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello security!&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/dba/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dba</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello dba!&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/admin/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello admin&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/user/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">user</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello user&quot;</span>;    &#125;&#125;</code></pre></div><h4 id="è§’è‰²ç»§æ‰¿"><a href="#è§’è‰²ç»§æ‰¿" class="headerlink" title="è§’è‰²ç»§æ‰¿"></a>è§’è‰²ç»§æ‰¿</h4><p>è§’è‰²ç»§æ‰¿å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å…¬å¸æ²»ç†å¯èƒ½éƒ½æ˜¯é‡‘å­—å¡”å½¢çš„ï¼Œä¸Šå¸å¯èƒ½å…·å¤‡ä¸‹å±çš„éƒ¨åˆ†ç”šè‡³æ‰€æœ‰æƒé™ï¼Œè¿™ä¸€ç°å®åœºæ™¯ï¼Œåæ˜ åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œå°±æ˜¯è§’è‰²ç»§æ‰¿äº†ã€‚ Spring Security ä¸­ä¸ºå¼€å‘è€…æä¾›äº†ç›¸å…³çš„è§’è‰²ç»§æ‰¿è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ä¸€è§£å†³æ–¹æ¡ˆåœ¨æœ€è¿‘çš„ Spring Security ç‰ˆæœ¬å˜è¿ä¸­ï¼Œä½¿ç”¨æ–¹æ³•æœ‰æ‰€å˜åŒ–</p><p>SpringSecurity åœ¨è§’è‰²ç»§æ‰¿ä¸Šæœ‰ä¸¤ç§ä¸åŒçš„å†™æ³•ï¼Œåœ¨ Spring Boot2.0.8ï¼ˆå¯¹åº” Spring Security ä¹Ÿæ˜¯ 5.0.11ï¼‰ä¸Šé¢æ˜¯ä¸€ç§å†™æ³•ï¼Œä» Spring Boot2.1.0ï¼ˆå¯¹åº” Spring Security5.1.1ï¼‰åˆæ˜¯å¦å¤–ä¸€ç§å†™æ³•</p><p><strong>ä»¥å‰çš„å†™æ³•</strong></p><p>è¿™é‡Œè¯´çš„ä»¥å‰å†™æ³•ï¼Œå°±æ˜¯æŒ‡ SpringBoot2.0.8ï¼ˆå«ï¼‰ä¹‹å‰çš„å†™æ³•ï¼Œåœ¨ä¹‹å‰çš„å†™æ³•ä¸­ï¼Œè§’è‰²ç»§æ‰¿åªéœ€è¦å¼€å‘è€…æä¾›ä¸€ä¸ª RoleHierarchy æ¥å£çš„å®ä¾‹å³å¯ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">RoleHierarchy <span class="hljs-title">roleHierarchy</span><span class="hljs-params">()</span> </span>&#123;    RoleHierarchyImpl roleHierarchy = <span class="hljs-keyword">new</span> RoleHierarchyImpl();    String hierarchy = <span class="hljs-string">&quot;ROLE_dba &gt; ROLE_admin ROLE_admin &gt; ROLE_user&quot;</span>;    roleHierarchy.setHierarchy(hierarchy);    <span class="hljs-keyword">return</span> roleHierarchy;&#125;</code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª RoleHierarchy æ¥å£çš„å®ä¾‹ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ¥æè¿°äº†è§’è‰²ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œ <code>ROLE_dba</code> å…·å¤‡ <code>ROLE_admin</code> çš„æ‰€æœ‰æƒé™ï¼Œè€Œ <code>ROLE_admin</code> åˆ™å…·å¤‡ <code>ROLE_user</code> çš„æ‰€æœ‰æƒé™ï¼Œç»§æ‰¿ä¸ç»§æ‰¿ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚æä¾›äº†è¿™ä¸ª Bean ä¹‹åï¼Œä»¥åæ‰€æœ‰å…·å¤‡ <code>ROLE_user</code> è§’è‰²æ‰èƒ½è®¿é—®çš„èµ„æºï¼Œ <code>ROLE_dba</code> å’Œ <code>ROLE_admin</code> ä¹Ÿéƒ½èƒ½è®¿é—®ï¼Œå…·å¤‡ <code>ROLE_amdin</code> è§’è‰²æ‰èƒ½è®¿é—®çš„èµ„æºï¼Œ <code>ROLE_dba</code> ä¹Ÿèƒ½è®¿é—®ã€‚</p><p><strong>ç°åœ¨çš„å†™æ³•</strong></p><p>ä½†æ˜¯ä¸Šé¢è¿™ç§å†™æ³•ä»…é™äº Spring Boot2.0.8ï¼ˆå«ï¼‰ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§å†™æ³•åˆ™ä¸è¢«æ”¯æŒï¼Œæ–°ç‰ˆçš„å†™æ³•æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function">RoleHierarchy <span class="hljs-title">roleHierarchy</span><span class="hljs-params">()</span> </span>&#123;    RoleHierarchyImpl roleHierarchy = <span class="hljs-keyword">new</span> RoleHierarchyImpl();    String hierarchy = <span class="hljs-string">&quot;ROLE_dba &gt; ROLE_admin \n ROLE_admin &gt; ROLE_user&quot;</span>;    roleHierarchy.setHierarchy(hierarchy);    <span class="hljs-keyword">return</span> roleHierarchy;&#125;</code></pre></div><p>å˜åŒ–ä¸»è¦å°±æ˜¯åˆ†éš”ç¬¦ï¼Œå°†åŸæ¥ç”¨ç©ºæ ¼éš”å¼€çš„åœ°æ–¹ï¼Œç°åœ¨ç”¨æ¢è¡Œç¬¦äº†ã€‚è¿™é‡Œè¡¨è¾¾å¼çš„å«ä¹‰ä¾ç„¶å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>ä¸Šé¢ä¸¤ç§ä¸åŒå†™æ³•éƒ½æ˜¯é…ç½®è§’è‰²çš„ç»§æ‰¿å…³ç³»ï¼Œé…ç½®å®Œæˆåï¼Œæ¥ä¸‹æ¥æŒ‡å®šè§’è‰²å’Œèµ„æºçš„å¯¹åº”å…³ç³»å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests().antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>)            .hasRole(<span class="hljs-string">&quot;admin&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/db/**&quot;</span>)            .hasRole(<span class="hljs-string">&quot;dba&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>)            .hasRole(<span class="hljs-string">&quot;user&quot;</span>)            .and()            .formLogin()            .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)            .permitAll()            .and()            .csrf().disable();&#125;</code></pre></div><p>è¿™ä¸ªè¡¨ç¤º <code>/db/**</code> æ ¼å¼çš„è·¯å¾„éœ€è¦å…·å¤‡ dba è§’è‰²æ‰èƒ½è®¿é—®ï¼Œ <code>/admin/**</code> æ ¼å¼çš„è·¯å¾„åˆ™éœ€è¦å…·å¤‡ admin è§’è‰²æ‰èƒ½è®¿é—®ï¼Œ <code>/user/**</code> æ ¼å¼çš„è·¯å¾„ï¼Œåˆ™éœ€è¦å…·å¤‡ user è§’è‰²æ‰èƒ½è®¿é—®ï¼Œæ­¤æ—¶æä¾›ç›¸å…³æ¥å£ï¼Œä¼šå‘ç°ï¼Œdba é™¤äº†è®¿é—® <code>/db/**</code>ï¼Œä¹Ÿèƒ½è®¿é—® <code>/admin/**</code> å’Œ <code>/user/**</code> ï¼Œadmin è§’è‰²é™¤äº†è®¿é—® <code>/admin/**</code> ï¼Œä¹Ÿèƒ½è®¿é—® <code>/user/**</code> ï¼Œuser è§’è‰²åˆ™åªèƒ½è®¿é—® <code>/user/**</code> ã€‚</p><h4 id="åŠ¨æ€æƒé™é…ç½®"><a href="#åŠ¨æ€æƒé™é…ç½®" class="headerlink" title="åŠ¨æ€æƒé™é…ç½®"></a><strong>åŠ¨æ€æƒé™é…ç½®</strong></h4><p>ç»§ç»­åˆ›å»ºè¡¨</p><div class="hljs code-wrapper"><pre><code class="hljs mysql">&#x2F;*Table structure for table &#96;menu&#96; *&#x2F;DROP TABLE IF EXISTS &#96;menu&#96;;CREATE TABLE &#96;menu&#96; (  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,  &#96;pattern&#96; varchar(128) DEFAULT NULL,  PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;&#x2F;*Data for the table &#96;menu&#96; *&#x2F;insert  into &#96;menu&#96;(&#96;id&#96;,&#96;pattern&#96;) values (1,&#39;&#x2F;db&#x2F;**&#39;),(2,&#39;&#x2F;admin&#x2F;**&#39;),(3,&#39;&#x2F;user&#x2F;**&#39;);&#x2F;*Table structure for table &#96;menu_role&#96; *&#x2F;DROP TABLE IF EXISTS &#96;menu_role&#96;;CREATE TABLE &#96;menu_role&#96; (  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,  &#96;mid&#96; int(11) DEFAULT NULL,  &#96;rid&#96; int(11) DEFAULT NULL,  PRIMARY KEY (&#96;id&#96;)) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;&#x2F;*Data for the table &#96;menu_role&#96; *&#x2F;insert  into &#96;menu_role&#96;(&#96;id&#96;,&#96;mid&#96;,&#96;rid&#96;) values (1,1,1),(2,2,2),(3,3,3);</code></pre></div><p>menuè¡¨ã€menu_roleè¡¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525105223533.png" alt="image-20210525105223533"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525105242464.png" alt="image-20210525105242464"></p><p><strong>æœ€ç»ˆçš„äº”å¼ è¡¨</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525105211929.png" alt="image-20210525105211929"></p><p>ä¸Šé¢çš„è§’è‰²ä¹‹é—´çš„æƒé™æ˜¯åœ¨Configç±»ä¸­å†™æ­»çš„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests()            .antMatchers(<span class="hljs-string">&quot;/dba/**&quot;</span>).hasRole(<span class="hljs-string">&quot;dba&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)            .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)            .anyRequest().authenticated()            .and()            .formLogin()            .permitAll()            .and()            .csrf().disable();&#125;</code></pre></div><p>å¦‚ä»Šè½¬æ¢åˆ°æ•°æ®åº“ä¸­åŠ¨æ€åŠ è½½ï¼Œ<strong>æ–°å¢å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String pattern;    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Menu&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, pattern=&#x27;&quot;</span> + pattern + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, roles=&quot;</span> + roles +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getRoles</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> roles;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRoles</span><span class="hljs-params">(List&lt;Role&gt; roles)</span> </span>&#123;        <span class="hljs-keyword">this</span>.roles = roles;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPattern</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> pattern;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPattern</span><span class="hljs-params">(String pattern)</span> </span>&#123;        <span class="hljs-keyword">this</span>.pattern = pattern;    &#125;&#125;</code></pre></div><p><strong>ServiceåŠMapper</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    MenuMapper menuMapper;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> menuMapper.getAllMenus();    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MenuMapper</span> </span>&#123;    <span class="hljs-function">List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p><strong>æŸ¥è¯¢ä¸€å¯¹å¤šçš„å…³ç³»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs mysql">select m.*,r.&#96;id&#96; as rid,r.&#96;name&#96; as rname,r.&#96;nameZh&#96; as rnameZh from menu m left join menu_role mr on m.&#96;id&#96;&#x3D;mr.&#96;mid&#96; left join role r on mr.&#96;rid&#96;&#x3D;r.&#96;id&#96;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210525111027555.png" alt="image-20210525111027555"></p><p><strong>å¯¹åº”çš„Menumapper.xml</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.javaboy.securitydy.mapper.MenuMapper&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.javaboy.securitydy.bean.Menu&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pattern&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roles&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.javaboy.securitydy.bean.Role&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rnameZh&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nameZh&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>            <span class="hljs-comment">&lt;!-- ä¸€å¯¹å¤šï¼Œéœ€è¦resultMap--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllMenus&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>        select m.*,r.`id` as rid,r.`name` as rname,r.`nameZh` as rnameZh from menu m left join menu_role mr on m.`id`=mr.`mid` left join role r on mr.`rid`=r.`id`    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p>åœ¨æ›´æ–°é…ç½®ç±»ä¹‹å‰ï¼Œå…ˆåˆ›å»ºè¿‡æ»¤å™¨æ ¹æ®urlåŒ¹é…ç”¨æˆ·è§’è‰²</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FilterInvocationSecurityMetadataSource</span> </span>&#123;    <span class="hljs-comment">//è·¯å¾„åŒ¹é…</span>    AntPathMatcher pathMatcher = <span class="hljs-keyword">new</span> AntPathMatcher();    <span class="hljs-meta">@Autowired</span>    MenuService menuService;    <span class="hljs-comment">//æ ¹æ®è¯·æ±‚çš„åœ°å€åˆ†æéœ€è¦é‚£ä¸ªè§’è‰²</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException </span>&#123;        String requestUrl = ((FilterInvocation) o).getRequestUrl();        List&lt;Menu&gt; allMenus = menuService.getAllMenus();        <span class="hljs-comment">//éå†ä»æ•°æ®åº“å–å‡ºçš„ç»“æœï¼Œå¼€å§‹åŒ¹é…</span>        <span class="hljs-keyword">for</span> (Menu menu : allMenus) &#123;            <span class="hljs-keyword">if</span> (pathMatcher.match(menu.getPattern(), requestUrl)) &#123;                <span class="hljs-comment">//urlå¯¹åº”å¾—ä¸Šåº“ä¸­çš„ç»“æœ</span>                List&lt;Role&gt; roles = menu.getRoles();                String[] rolesStr = <span class="hljs-keyword">new</span> String[roles.size()];                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; roles.size(); i++) &#123;                    rolesStr[i] = roles.get(i).getName();                &#125;                <span class="hljs-keyword">return</span> SecurityConfig.createList(rolesStr);            &#125;        &#125;        <span class="hljs-comment">//urlæ— æ³•åŒ¹é…ï¼Œç‰¹æ®Šæ ‡è®°</span>        <span class="hljs-keyword">return</span> SecurityConfig.createList(<span class="hljs-string">&quot;ROLE_login&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAllConfigAttributes</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; aClass)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><p>æ ¹æ®è¿‡æ»¤å™¨Collectionå¾—åˆ°çš„è¿”å›å€¼ï¼Œå†è¿›è¡Œå¤„ç†Collection</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAccessDecisionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccessDecisionManager</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decide</span><span class="hljs-params">(Authentication authentication, Object o, Collection&lt;ConfigAttribute&gt; collection)</span> <span class="hljs-keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;        <span class="hljs-keyword">for</span> (ConfigAttribute attribute : collection) &#123;            <span class="hljs-comment">//è¯´æ˜urlæ²¡åŒ¹é…ä¸Š</span>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;ROLE_login&quot;</span>.equals(attribute.getAttribute())) &#123;                <span class="hljs-comment">//å¦‚æœæ˜¯åŒ¿åç”¨æˆ·ï¼ŒæŠ›å¼‚å¸¸</span>                <span class="hljs-keyword">if</span> (authentication <span class="hljs-keyword">instanceof</span> AnonymousAuthenticationToken) &#123;                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;éæ³•è¯·æ±‚!&quot;</span>);                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;            <span class="hljs-comment">//åŒ¹é…å¾—ä¸Š</span>            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();            <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;                <span class="hljs-keyword">if</span> (authority.getAuthority().equals(attribute.getAttribute())) &#123;                    <span class="hljs-keyword">return</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;éæ³•è¯·æ±‚!&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(ConfigAttribute configAttribute)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; aClass)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><p><strong>æ›´æ–°é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    UserService userService;    <span class="hljs-comment">//æ³¨å…¥è¿‡æ»¤å™¨</span>    <span class="hljs-meta">@Autowired</span>    MyFilter myFilter;    <span class="hljs-comment">//æ³¨å…¥å¤„ç†</span>    <span class="hljs-meta">@Autowired</span>    MyAccessDecisionManager myAccessDecisionManager;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.userDetailsService(userService);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O o)</span> </span>&#123;                        <span class="hljs-comment">//ä½¿ç”¨è¿‡æ»¤å™¨å’Œå¤„ç†</span>                        o.setAccessDecisionManager(myAccessDecisionManager);                        o.setSecurityMetadataSource(myFilter);                        <span class="hljs-keyword">return</span> o;                    &#125;                &#125;)                .and()                .formLogin()                .permitAll()                .and()                .csrf().disable();    &#125;&#125;</code></pre></div><h3 id="1-9-ä½¿ç”¨JSONç™»å½•"><a href="#1-9-ä½¿ç”¨JSONç™»å½•" class="headerlink" title="1.9 ä½¿ç”¨JSONç™»å½•"></a>1.9 ä½¿ç”¨JSONç™»å½•</h3><h4 id="ä½¿ç”¨Key-Valueç™»å½•"><a href="#ä½¿ç”¨Key-Valueç™»å½•" class="headerlink" title="ä½¿ç”¨Key/Valueç™»å½•"></a>ä½¿ç”¨Key/Valueç™»å½•</h4><ul><li>åˆ›å»º Spring Boot å·¥ç¨‹</li></ul><p>é¦–å…ˆåˆ›å»º SpringBoot å·¥ç¨‹ï¼Œæ·»åŠ  SpringSecurity ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><ul><li>æ·»åŠ  Security é…ç½®</li></ul><p>åˆ›å»º SecurityConfigï¼Œå®Œæˆ SpringSecurity çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.inMemoryAuthentication().withUser(<span class="hljs-string">&quot;zhangsan&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$2O4EwLrrFPEboTfDOtC0F.RpUMk.3q3KvBHRx7XXKUMLBGjOOBs8q&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .anyRequest().authenticated()                .and()                .formLogin()                .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        RespBean ok = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼&quot;</span>,authentication.getPrincipal());                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok));                        out.flush();                        out.close();                    &#125;                &#125;)                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        RespBean error = RespBean.error(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥&quot;</span>);                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(error));                        out.flush();                        out.close();                    &#125;                &#125;)                .loginPage(<span class="hljs-string">&quot;/login&quot;</span>)                .permitAll()                .and()                .logout()                .logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>)                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        RespBean ok = RespBean.ok(<span class="hljs-string">&quot;æ³¨é”€æˆåŠŸï¼&quot;</span>);                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok));                        out.flush();                        out.close();                    &#125;                &#125;)                .permitAll()                .and()                .csrf()                .disable()                .exceptionHandling()                .accessDeniedHandler(<span class="hljs-keyword">new</span> AccessDeniedHandler() &#123;                    <span class="hljs-meta">@Override</span>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AccessDeniedException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;                        RespBean error = RespBean.error(<span class="hljs-string">&quot;æƒé™ä¸è¶³ï¼Œè®¿é—®å¤±è´¥&quot;</span>);                        resp.setStatus(<span class="hljs-number">403</span>);                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);                        PrintWriter out = resp.getWriter();                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(error));                        out.flush();                        out.close();                    &#125;                &#125;);    &#125;&#125;</code></pre></div><p>è¿™é‡Œçš„é…ç½®è™½ç„¶æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯å¾ˆåŸºç¡€ï¼Œé…ç½®å«ä¹‰ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œé¦–å…ˆæä¾› BCryptPasswordEncoder ä½œä¸º PasswordEncoder ï¼Œå¯ä»¥å®ç°å¯¹å¯†ç çš„è‡ªåŠ¨åŠ å¯†åŠ ç›ï¼Œéå¸¸æ–¹ä¾¿ï¼Œç„¶åæä¾›äº†ä¸€ä¸ªåä¸º <code>zhangsan</code> çš„ç”¨æˆ·ï¼Œå¯†ç æ˜¯ <code>123</code> ï¼Œè§’è‰²æ˜¯ <code>user</code> ï¼Œæœ€åé…ç½®ç™»å½•é€»è¾‘ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®ï¼Œç™»å½•æ¥å£æ˜¯ <code>/doLogin</code> ï¼Œç”¨æˆ·åçš„ key æ˜¯ username ï¼Œå¯†ç çš„ key æ˜¯ password ï¼ŒåŒæ—¶é…ç½®ç™»å½•æˆåŠŸã€ç™»å½•å¤±è´¥ä»¥åŠæ³¨é”€æˆåŠŸã€æƒé™ä¸è¶³æ—¶éƒ½ç»™ç”¨æˆ·è¿”å›JSONæç¤ºï¼Œå¦å¤–ï¼Œè¿™é‡Œè™½ç„¶é…ç½®äº†ç™»å½•é¡µé¢ä¸º <code>/login</code> ï¼Œå®é™…ä¸Šè¿™ä¸æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œè€Œæ˜¯ä¸€æ®µ JSON ï¼Œåœ¨ LoginController ä¸­æä¾›è¯¥æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">login</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•&quot;</span>);    &#125;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><p>è¿™é‡Œ <code>/login</code> åªæ˜¯ä¸€ä¸ª JSON æç¤ºï¼Œè€Œä¸æ˜¯é¡µé¢ï¼Œ <code>/hello</code> åˆ™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¥å£ã€‚</p><p>OKï¼Œåšå®Œä¸Šè¿°æ­¥éª¤å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼Œè¿è¡ŒSpringBooté¡¹ç›®ï¼Œè®¿é—® <code>/hello</code> æ¥å£ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="http://www.javaboy.org/images/boot/p1-1.png" alt="img"></p><p>æ­¤æ—¶å…ˆè°ƒç”¨ç™»å½•æ¥å£è¿›è¡Œç™»å½•ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p1-2.png" alt="img"></p><p>ç™»å½•æˆåŠŸåï¼Œå†å»è®¿é—® <code>/hello</code> æ¥å£å°±å¯ä»¥æˆåŠŸè®¿é—®äº†ã€‚</p><h4 id="ä½¿ç”¨JSONç™»å½•"><a href="#ä½¿ç”¨JSONç™»å½•" class="headerlink" title="ä½¿ç”¨JSONç™»å½•"></a>ä½¿ç”¨JSONç™»å½•</h4><p>ä¸Šé¢æ¼”ç¤ºçš„æ˜¯ä¸€ç§åŸå§‹çš„ç™»å½•æ–¹æ¡ˆï¼Œå¦‚æœæƒ³å°†ç”¨æˆ·åå¯†ç é€šè¿‡ JSON çš„æ–¹å¼è¿›è¡Œä¼ é€’ï¼Œåˆ™éœ€è¦è‡ªå®šä¹‰ç›¸å…³è¿‡æ»¤å™¨ï¼Œé€šè¿‡åˆ†ææºç æˆ‘ä»¬å‘ç°ï¼Œé»˜è®¤çš„ç”¨æˆ·åå¯†ç æå–åœ¨ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨ä¸­ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> <span class="hljs-keyword">extends</span></span><span class="hljs-class"><span class="hljs-title">AbstractAuthenticationProcessingFilter</span> </span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SPRING_SECURITY_FORM_USERNAME_KEY = <span class="hljs-string">&quot;username&quot;</span>;<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SPRING_SECURITY_FORM_PASSWORD_KEY = <span class="hljs-string">&quot;password&quot;</span>;<span class="hljs-keyword">private</span> String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;<span class="hljs-keyword">private</span> String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;<span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> postOnly = <span class="hljs-keyword">true</span>;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">super</span>(<span class="hljs-keyword">new</span> AntPathRequestMatcher(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>));&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request,</span></span><span class="hljs-function"><span class="hljs-params">HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;    <span class="hljs-keyword">if</span> (postOnly &amp;&amp; !request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());&#125;String username = obtainUsername(request);String password = obtainPassword(request);<span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;username = <span class="hljs-string">&quot;&quot;</span>;&#125;<span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;password = <span class="hljs-string">&quot;&quot;</span>;&#125;username = username.trim();UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(username, password);<span class="hljs-comment">// Allow subclasses to set the &quot;details&quot; property</span>setDetails(request, authRequest);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainPassword</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(passwordParameter);&#125;<span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">obtainUsername</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<span class="hljs-keyword">return</span> request.getParameter(usernameParameter);&#125;    <span class="hljs-comment">//...</span>    <span class="hljs-comment">//...</span>&#125;</code></pre></div><p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤çš„ç”¨æˆ·å/å¯†ç æå–å°±æ˜¯é€šè¿‡ request ä¸­çš„ getParameter æ¥æå–çš„ï¼Œå¦‚æœæƒ³ä½¿ç”¨ JSON ä¼ é€’ç”¨æˆ·åå¯†ç ï¼Œåªéœ€è¦å°†è¿™ä¸ªè¿‡æ»¤å™¨æ›¿æ¢æ‰å³å¯ï¼Œè‡ªå®šä¹‰è¿‡æ»¤å™¨å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;              <span class="hljs-keyword">if</span> (request.getContentType().equals(MediaType.APPLICATION_JSON_UTF8_VALUE)                || request.getContentType().equals(MediaType.APPLICATION_JSON_VALUE)) &#123;            ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">null</span>;            <span class="hljs-keyword">try</span> (InputStream is = request.getInputStream()) &#123;                Map&lt;String,String&gt; authenticationBean = mapper.readValue(is, Map.class);                authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(                        authenticationBean.get(<span class="hljs-string">&quot;username&quot;</span>), authenticationBean.get(<span class="hljs-string">&quot;password&quot;</span>));            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();                authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(                        <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);            &#125; <span class="hljs-keyword">finally</span> &#123;                setDetails(request, authRequest);                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);            &#125;        &#125;        <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.attemptAuthentication(request, response);        &#125;    &#125;&#125;</code></pre></div><p>è¿™é‡Œåªæ˜¯å°†ç”¨æˆ·å/å¯†ç çš„è·å–æ–¹æ¡ˆé‡æ–°ä¿®æ­£ä¸‹ï¼Œæ”¹ä¸ºäº†ä» JSON ä¸­è·å–ç”¨æˆ·åå¯†ç ï¼Œç„¶ååœ¨ SecurityConfig ä¸­ä½œå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    http.authorizeRequests().anyRequest().authenticated()            .and()            .formLogin()            .and().csrf().disable();    http.addFilterAt(customAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);&#125;<span class="hljs-meta">@Bean</span><span class="hljs-function">CustomAuthenticationFilter <span class="hljs-title">customAuthenticationFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;    CustomAuthenticationFilter filter = <span class="hljs-keyword">new</span> CustomAuthenticationFilter();    filter.setAuthenticationSuccessHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() &#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);            PrintWriter out = resp.getWriter();            RespBean respBean = RespBean.ok(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!&quot;</span>);            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));            out.flush();            out.close();        &#125;    &#125;);    filter.setAuthenticationFailureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() &#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);            PrintWriter out = resp.getWriter();            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥!&quot;</span>);            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));            out.flush();            out.close();        &#125;    &#125;);    filter.setAuthenticationManager(authenticationManagerBean());    <span class="hljs-keyword">return</span> filter;&#125;</code></pre></div><p>å°†è‡ªå®šä¹‰çš„ CustomAuthenticationFilter ç±»åŠ å…¥è¿›æ¥å³å¯ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ JSON è¿›è¡Œç™»å½•äº†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p1-3.png" alt="img"></p><h2 id="2-Shiro"><a href="#2-Shiro" class="headerlink" title="2. Shiro"></a>2. Shiro</h2><h3 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h3><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶å…·æœ‰ç›´è§‚ã€æ˜“ç”¨ç­‰ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ï¼Œè™½ç„¶å®ƒçš„åŠŸèƒ½ä¸å¦‚SpringSecurityé‚£ä¹ˆå¼ºå¤§ï¼Œä½†æ˜¯åœ¨æ™®é€šçš„é¡¹ç›®ä¸­ä¹Ÿå¤Ÿç”¨äº†ã€‚</p><h4 id="2-1-1-ç”±æ¥"><a href="#2-1-1-ç”±æ¥" class="headerlink" title="2.1.1 ç”±æ¥"></a>2.1.1 ç”±æ¥</h4><p>Shiroçš„å‰èº«æ˜¯JSecurityï¼Œ2004å¹´ï¼ŒLes Hazlewoodå’ŒJeremy Haileåˆ›åŠäº†Jsecurityã€‚å½“æ—¶ä»–ä»¬æ‰¾ä¸åˆ°é€‚ç”¨äºåº”ç”¨ç¨‹åºçº§åˆ«çš„åˆé€‚Javaå®‰å…¨æ¡†æ¶ï¼ŒåŒæ—¶åˆå¯¹JAASéå¸¸å¤±æœ›ã€‚2004å¹´åˆ°2008å¹´æœŸé—´ï¼ŒJSecurityæ‰˜ç®¡åœ¨SourceForgeä¸Šï¼Œè´¡çŒ®è€…åŒ…æ‹¬Peter Ledbrookã€Alan Ditzelå’ŒTim Veilã€‚2008å¹´ï¼ŒJSecurityé¡¹ç›®è´¡çŒ®ç»™äº†Apacheè½¯ä»¶åŸºé‡‘ä¼šï¼ˆASFï¼‰ï¼Œå¹¶è¢«æ¥çº³æˆä¸ºApache Incubatoré¡¹ç›®ï¼Œç”±å¯¼å¸ˆç®¡ç†ï¼Œç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ªé¡¶çº§Apacheé¡¹ç›®ã€‚æœŸé—´ï¼ŒJsecurityæ›¾çŸ­æš‚æ›´åä¸ºKiï¼Œéšåå› å•†æ ‡é—®é¢˜è¢«ç¤¾åŒºæ›´åä¸ºâ€œShiroâ€ã€‚éšåé¡¹ç›®æŒç»­åœ¨Apache Incubatorä¸­å­µåŒ–ï¼Œå¹¶å¢åŠ äº†è´¡çŒ®è€…Kalle Korhonenã€‚2010å¹´7æœˆï¼ŒShiroç¤¾åŒºå‘å¸ƒäº†1.0ç‰ˆï¼Œéšåç¤¾åŒºåˆ›å»ºäº†å…¶é¡¹ç›®ç®¡ç†å§”å‘˜ä¼šï¼Œå¹¶é€‰ä¸¾Les Hazlewoodä¸ºä¸»å¸­ã€‚2010å¹´9æœˆ22æ—¥ï¼ŒShrioæˆä¸ºApacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ï¼ˆTLPï¼‰ã€‚</p><h4 id="3-1-2-æœ‰å“ªäº›åŠŸèƒ½"><a href="#3-1-2-æœ‰å“ªäº›åŠŸèƒ½" class="headerlink" title="3.1.2 æœ‰å“ªäº›åŠŸèƒ½"></a>3.1.2 æœ‰å“ªäº›åŠŸèƒ½</h4><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å¼€æºå®‰å…¨æ¡†æ¶ï¼Œå®ƒå¹²å‡€åˆ©è½åœ°å¤„ç†èº«ä»½è®¤è¯ï¼Œæˆæƒï¼Œä¼ä¸šä¼šè¯ç®¡ç†å’ŒåŠ å¯†ã€‚Apache Shiroçš„é¦–è¦ç›®æ ‡æ˜¯æ˜“äºä½¿ç”¨å’Œç†è§£ã€‚å®‰å…¨æœ‰æ—¶å€™æ˜¯å¾ˆå¤æ‚çš„ï¼Œç”šè‡³æ˜¯ç—›è‹¦çš„ï¼Œä½†å®ƒæ²¡æœ‰å¿…è¦è¿™æ ·ã€‚æ¡†æ¶åº”è¯¥å°½å¯èƒ½æ©ç›–å¤æ‚çš„åœ°æ–¹ï¼Œéœ²å‡ºä¸€ä¸ªå¹²å‡€è€Œç›´è§‚çš„APIï¼Œæ¥ç®€åŒ–å¼€å‘äººå‘˜åœ¨åº”ç”¨ç¨‹åºå®‰å…¨ä¸Šæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½ å¯ä»¥ç”¨Apache Shiro æ‰€åšçš„äº‹æƒ…ï¼š</p><ul><li>éªŒè¯ç”¨æˆ·æ¥æ ¸å®ä»–ä»¬çš„èº«ä»½</li><li>å¯¹ç”¨æˆ·æ‰§è¡Œè®¿é—®æ§åˆ¶ï¼Œå¦‚ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«åˆ†é…äº†ä¸€ä¸ªç¡®å®šçš„å®‰å…¨è§’è‰²ï¼›åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«å…è®¸åšæŸäº‹</li><li>åœ¨ä»»ä½•ç¯å¢ƒä¸‹ä½¿ç”¨Session APIï¼Œå³ä½¿æ²¡æœ‰Webå®¹å™¨</li><li>åœ¨èº«ä»½éªŒè¯ï¼Œè®¿é—®æ§åˆ¶æœŸé—´æˆ–åœ¨ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº‹ä»¶ä½œå‡ºååº”</li><li>èšé›†ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å®‰å…¨æ•°æ®çš„æ•°æ®æºï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå•ä¸€çš„å¤åˆç”¨æˆ·â€œè§†å›¾â€</li><li>å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åŠŸèƒ½</li><li>ä¸ºæ²¡æœ‰å…³è”åˆ°ç™»å½•çš„ç”¨æˆ·å¯ç”¨â€Remember Meâ€æœåŠ¡</li></ul><p>Apache Shiroæ˜¯ä¸€ä¸ªæ‹¥æœ‰è®¸å¤šåŠŸèƒ½çš„ç»¼åˆæ€§çš„ç¨‹åºå®‰å…¨æ¡†æ¶ã€‚ä¸‹é¢çš„å›¾è¡¨å±•ç¤ºäº†Shiroçš„é‡ç‚¹ï¼š</p><p><a href="https://img-blog.csdnimg.cn/img_convert/a6a1cb5eb8a807afe4f4b2bd094a97ba.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/a6a1cb5eb8a807afe4f4b2bd094a97ba.png" alt="p306"></a></p><p>Shiroä¸­æœ‰å››å¤§åŸºçŸ³â€”â€”èº«ä»½éªŒè¯ï¼Œæˆæƒï¼Œä¼šè¯ç®¡ç†å’ŒåŠ å¯†</p><ol><li>Authenticationï¼šæœ‰æ—¶ä¹Ÿç®€ç§°ä¸ºâ€œç™»å½•â€ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯æ˜ç”¨æˆ·æ˜¯è°çš„è¡Œä¸ºã€‚</li><li>Authorizationï¼šè®¿é—®æ§åˆ¶çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å†³å®šâ€œè°â€å»è®¿é—®â€œä»€ä¹ˆâ€ã€‚</li><li>Session Managementï¼šç®¡ç†ç”¨æˆ·ç‰¹å®šçš„ä¼šè¯ï¼Œå³ä½¿åœ¨éWeb æˆ–EJB åº”ç”¨ç¨‹åºã€‚</li><li>Cryptographyï¼šé€šè¿‡ä½¿ç”¨åŠ å¯†ç®—æ³•ä¿æŒæ•°æ®å®‰å…¨åŒæ—¶æ˜“äºä½¿ç”¨ã€‚</li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼ŒShiroä¹Ÿæä¾›äº†é¢å¤–çš„åŠŸèƒ½æ¥è§£å†³åœ¨ä¸åŒç¯å¢ƒä¸‹æ‰€é¢ä¸´çš„å®‰å…¨é—®é¢˜ï¼Œå°¤å…¶æ˜¯ä»¥ä¸‹è¿™äº›ï¼š</p><ol><li>Web Supportï¼šShiroçš„webæ”¯æŒçš„APIèƒ½å¤Ÿè½»æ¾åœ°å¸®åŠ©ä¿æŠ¤Webåº”ç”¨ç¨‹åºã€‚</li><li>Cachingï¼šç¼“å­˜æ˜¯Apache Shiroä¸­çš„ç¬¬ä¸€å±‚å…¬æ°‘ï¼Œæ¥ç¡®ä¿å®‰å…¨æ“ä½œå¿«é€Ÿè€Œåˆé«˜æ•ˆã€‚</li><li>Concurrencyï¼šApache Shiroåˆ©ç”¨å®ƒçš„å¹¶å‘ç‰¹æ€§æ¥æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºã€‚</li><li>Testingï¼šæµ‹è¯•æ”¯æŒçš„å­˜åœ¨æ¥å¸®åŠ©ä½ ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚</li><li>â€œRun Asâ€ï¼šä¸€ä¸ªå…è®¸ç”¨æˆ·å‡è®¾ä¸ºå¦ä¸€ä¸ªç”¨æˆ·èº«ä»½ï¼ˆå¦‚æœå…è®¸ï¼‰çš„åŠŸèƒ½ï¼Œæœ‰æ—¶å€™åœ¨ç®¡ç†è„šæœ¬å¾ˆæœ‰ç”¨ã€‚</li><li>â€œRemember Meâ€ï¼šåœ¨ä¼šè¯ä¸­è®°ä½ç”¨æˆ·çš„èº«ä»½ï¼Œè¿™æ ·ç”¨æˆ·åªéœ€è¦åœ¨å¼ºåˆ¶ç™»å½•æ—¶å€™ç™»å½•ã€‚</li></ol><h3 id="2-2-Realm"><a href="#2-2-Realm" class="headerlink" title="2.2 Realm"></a>2.2 Realm</h3><h4 id="2-2-1-ç™»å½•æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„"><a href="#2-2-1-ç™»å½•æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„" class="headerlink" title="2.2.1 ç™»å½•æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„"></a>2.2.1 ç™»å½•æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹shiroå®˜æ–¹æ–‡æ¡£ä¸­è¿™æ ·ä¸€å¼ ç™»å½•æµç¨‹å›¾ï¼š</p><p><a href="https://img-blog.csdnimg.cn/img_convert/f8b6568be71a8cb15f49f862101dd661.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/f8b6568be71a8cb15f49f862101dd661.png" alt="p308"></a></p><p>å‚ç…§æ­¤å›¾ï¼Œæˆ‘ä»¬çš„ç™»å½•ä¸€å…±è¦ç»è¿‡å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>åº”ç”¨ç¨‹åºä»£ç è°ƒç”¨Subject.loginæ–¹æ³•ï¼Œä¼ é€’åˆ›å»ºå¥½çš„åŒ…å«ç»ˆç«¯ç”¨æˆ·çš„Principals(èº«ä»½)å’ŒCredentials(å‡­è¯)çš„AuthenticationTokenå®ä¾‹(å³ä¸Šæ–‡ä¾‹å­ä¸­çš„UsernamePasswordToken)ã€‚</li><li>Subjectå®ä¾‹ï¼Œé€šå¸¸æ˜¯DelegatingSubjectï¼ˆæˆ–å­ç±»ï¼‰å§”æ‰˜åº”ç”¨ç¨‹åºçš„SecurityManageré€šè¿‡è°ƒç”¨securityManager.login(token)å¼€å§‹çœŸæ­£çš„éªŒè¯å·¥ä½œ(åœ¨DelegatingSubjectç±»çš„loginæ–¹æ³•ä¸­æ‰“æ–­ç‚¹å³å¯çœ‹åˆ°)ã€‚</li><li>SubjectManagerä½œä¸ºä¸€ä¸ªåŸºæœ¬çš„â€œä¿æŠ¤ä¼â€çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¥æ”¶tokenä»¥åŠç®€å•åœ°å§”æ‰˜ç»™å†…éƒ¨çš„Authenticatorå®ä¾‹é€šè¿‡è°ƒç”¨authenticator.authenticate(token)ã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ªModularRealmAuthenticatorå®ä¾‹ï¼Œæ”¯æŒåœ¨èº«ä»½éªŒè¯ä¸­åè°ƒä¸€ä¸ªæˆ–å¤šä¸ªRealmå®ä¾‹ã€‚ModularRealmAuthenticatoræœ¬è´¨ä¸Šä¸ºApache Shiro æä¾›äº†PAM-style èŒƒå¼ï¼ˆå…¶ä¸­åœ¨PAM æœ¯è¯­ä¸­æ¯ä¸ªRealm éƒ½æ˜¯ä¸€ä¸ªâ€™moduleâ€™ï¼‰ã€‚</li><li>å¦‚æœåº”ç”¨ç¨‹åºä¸­é…ç½®äº†ä¸€ä¸ªä»¥ä¸Šçš„Realmï¼ŒModularRealmAuthenticatorå®ä¾‹å°†åˆ©ç”¨é…ç½®å¥½çš„AuthenticationStrategyæ¥å¯åŠ¨Multi-Realmè®¤è¯å°è¯•ã€‚åœ¨Realms è¢«èº«ä»½éªŒè¯è°ƒç”¨ä¹‹å‰ï¼ŒæœŸé—´å’Œä»¥åï¼ŒAuthenticationStrategyè¢«è°ƒç”¨ä½¿å…¶èƒ½å¤Ÿå¯¹æ¯ä¸ªRealmçš„ç»“æœä½œå‡ºååº”ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå•ä¸€çš„Realm è¢«é…ç½®ï¼Œå®ƒå°†è¢«ç›´æ¥è°ƒç”¨ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦ä¸ºä¸€ä¸ªå•ä¸€Realmçš„åº”ç”¨ä½¿ç”¨AuthenticationStrategyã€‚</li><li>æ¯ä¸ªé…ç½®çš„Realmç”¨æ¥å¸®åŠ©çœ‹å®ƒæ˜¯å¦æ”¯æŒæäº¤çš„AuthenticationTokenã€‚å¦‚æœæ”¯æŒï¼Œé‚£ä¹ˆæ”¯æŒRealmçš„getAuthenticationInfoæ–¹æ³•å°†ä¼šä¼´éšç€æäº¤çš„tokenè¢«è°ƒç”¨ã€‚</li></ol><h4 id="2-2-2-ä»€ä¹ˆæ˜¯Realm"><a href="#2-2-2-ä»€ä¹ˆæ˜¯Realm" class="headerlink" title="2.2.2 ä»€ä¹ˆæ˜¯Realm"></a>2.2.2 ä»€ä¹ˆæ˜¯Realm</h4><p>æ ¹æ®Realmæ–‡æ¡£ä¸Šçš„è§£é‡Šï¼ŒRealmsæ‹…å½“Shiroå’Œä½ çš„åº”ç”¨ç¨‹åºçš„å®‰å…¨æ•°æ®ä¹‹é—´çš„â€œæ¡¥æ¢â€æˆ–â€œè¿æ¥å™¨â€ã€‚å½“å®ƒå®é™…ä¸Šä¸å®‰å…¨ç›¸å…³çš„æ•°æ®å¦‚ç”¨æ¥æ‰§è¡Œèº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰åŠæˆæƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰çš„ç”¨æˆ·å¸æˆ·äº¤äº’æ—¶ï¼ŒShiroä»ä¸€ä¸ªæˆ–å¤šä¸ªä¸ºåº”ç”¨ç¨‹åºé…ç½®çš„Realm ä¸­å¯»æ‰¾è®¸å¤šè¿™æ ·çš„ä¸œè¥¿ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œ<strong>Realm æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å®šå®‰å…¨çš„DAO</strong>ï¼šå®ƒå°è£…äº†æ•°æ®æºçš„è¿æ¥è¯¦ç»†ä¿¡æ¯ï¼Œä½¿Shiro æ‰€éœ€çš„ç›¸å…³çš„æ•°æ®å¯ç”¨ã€‚å½“é…ç½®Shiro æ—¶ï¼Œä½ å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ªRealm ç”¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œ/æˆ–æˆæƒã€‚SecurityManagerå¯èƒ½é…ç½®å¤šä¸ªRealmsï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å¿…é¡»çš„ã€‚Shiro æä¾›äº†ç«‹å³å¯ç”¨çš„Realms æ¥è¿æ¥ä¸€äº›å®‰å…¨æ•°æ®æºï¼ˆå³ç›®å½•ï¼‰ï¼Œå¦‚LDAPï¼Œå…³ç³»æ•°æ®åº“ï¼ˆJDBCï¼‰ï¼Œæ–‡æœ¬é…ç½®æºï¼ŒåƒINI åŠå±æ€§æ–‡ä»¶ï¼Œä»¥åŠæ›´å¤šã€‚</p><h3 id="2-2-æ•´åˆSpringBoot"><a href="#2-2-æ•´åˆSpringBoot" class="headerlink" title="2.2 æ•´åˆSpringBoot"></a>2.2 æ•´åˆSpringBoot</h3><h4 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h4><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>è‡ªå®šä¹‰Realm</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;        String username = (String) token.getPrincipal();        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;javaboy&quot;</span>.equals(username)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(username, <span class="hljs-string">&quot;123&quot;</span>, getName());        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p>åœ¨ Realm ä¸­å®ç°ç®€å•çš„è®¤è¯æ“ä½œå³å¯ï¼Œä¸åšæˆæƒï¼Œæˆæƒçš„å…·ä½“å†™æ³•å’Œ SSM ä¸­çš„ Shiro ä¸€æ ·ï¼Œä¸èµ˜è¿°ã€‚è¿™é‡Œçš„è®¤è¯è¡¨ç¤ºç”¨æˆ·åå¿…é¡»æ˜¯ javaboy ï¼Œç”¨æˆ·å¯†ç å¿…é¡»æ˜¯ 123 ï¼Œæ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼Œå°±èƒ½ç™»å½•æˆåŠŸï¼</p><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">MyRealm <span class="hljs-title">myRealm</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyRealm();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">SecurityManager <span class="hljs-title">securityManager</span><span class="hljs-params">()</span> </span>&#123;        DefaultWebSecurityManager manager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();        manager.setRealm(myRealm());        <span class="hljs-keyword">return</span> manager;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">ShiroFilterFactoryBean <span class="hljs-title">shiroFilterFactoryBean</span><span class="hljs-params">()</span> </span>&#123;        ShiroFilterFactoryBean bean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();        bean.setSecurityManager(securityManager());        bean.setLoginUrl(<span class="hljs-string">&quot;/login&quot;</span>);        bean.setSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>);        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();        map.put(<span class="hljs-string">&quot;/doLogin&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);        map.put(<span class="hljs-string">&quot;/**&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);        bean.setFilterChainDefinitionMap(map);        <span class="hljs-keyword">return</span> bean;    &#125;&#125;</code></pre></div><p>åœ¨è¿™é‡Œè¿›è¡Œ Shiro çš„é…ç½®ä¸»è¦é…ç½® 3 ä¸ª Bean ï¼š</p><ul><li>é¦–å…ˆéœ€è¦æä¾›ä¸€ä¸ª Realm çš„å®ä¾‹</li><li>éœ€è¦é…ç½®ä¸€ä¸ª SecurityManagerï¼Œåœ¨ SecurityManager ä¸­é…ç½® Realm</li><li>é…ç½®ä¸€ä¸ª ShiroFilterFactoryBean ï¼Œåœ¨ ShiroFilterFactoryBean ä¸­æŒ‡å®šè·¯å¾„æ‹¦æˆªè§„åˆ™ç­‰</li><li>é…ç½®ç™»å½•å’Œæµ‹è¯•æ¥å£</li><li>å…¶ä¸­ï¼ŒShiroFilterFactoryBean çš„é…ç½®ç¨å¾®å¤šä¸€äº›ï¼Œé…ç½®å«ä¹‰å¦‚ä¸‹ï¼š<ul><li>setSecurityManager è¡¨ç¤ºæŒ‡å®š SecurityManager</li><li>setLoginUrl è¡¨ç¤ºæŒ‡å®šç™»å½•é¡µé¢</li><li>setSuccessUrl è¡¨ç¤ºæŒ‡å®šç™»å½•æˆåŠŸé¡µé¢</li><li>æ¥ä¸‹æ¥çš„ Map ä¸­é…ç½®äº†è·¯å¾„æ‹¦æˆªè§„åˆ™ï¼Œæ³¨æ„ï¼Œè¦æœ‰åº</li></ul></li></ul><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">loging</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;please login&quot;</span>;    &#125;    <span class="hljs-meta">@PostMapping(&quot;/doLogin&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doLogin</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        Subject subject = SecurityUtils.getSubject();        <span class="hljs-keyword">try</span> &#123;            subject.login(<span class="hljs-keyword">new</span> UsernamePasswordToken(username, password));            System.out.println(<span class="hljs-string">&quot;success&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (AuthenticationException e) &#123;            e.printStackTrace();            System.out.println(<span class="hljs-string">&quot;fail&gt;&gt;&quot;</span> + e.getMessage());        &#125;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello shiro!&quot;</span>;    &#125;&#125;</code></pre></div><h4 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h4><p>ä¸Šé¢è¿™ç§é…ç½®æ–¹å¼å®é™…ä¸Šç›¸å½“äºæŠŠ SSM ä¸­çš„ XML é…ç½®æ‹¿åˆ° Spring Boot ä¸­ç”¨ Java ä»£ç é‡æ–°å†™äº†ä¸€éï¼Œé™¤äº†è¿™ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Shiro å®˜æ–¹æä¾›çš„ Starter </p><p><strong>ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">shiro.sessionManager.sessionIdCookieEnabled</span>=<span class="hljs-string">true</span><span class="hljs-meta">shiro.sessionManager.sessionIdUrlRewritingEnabled</span>=<span class="hljs-string">true</span><span class="hljs-meta">shiro.unauthorizedUrl</span>=<span class="hljs-string">/unauthorizedurl</span><span class="hljs-meta">shiro.web.enabled</span>=<span class="hljs-string">true</span><span class="hljs-meta">shiro.successUrl</span>=<span class="hljs-string">/success</span><span class="hljs-meta">shiro.loginUrl</span>=<span class="hljs-string">/login</span></code></pre></div><ul><li>ç¬¬ä¸€è¡Œè¡¨ç¤ºæ˜¯å¦å…è®¸å°†sessionId æ”¾åˆ° cookie ä¸­</li><li>ç¬¬äºŒè¡Œè¡¨ç¤ºæ˜¯å¦å…è®¸å°† sessionId æ”¾åˆ° Url åœ°å€æ‹¦ä¸­</li><li>ç¬¬ä¸‰è¡Œè¡¨ç¤ºè®¿é—®æœªè·æˆæƒçš„é¡µé¢æ—¶ï¼Œé»˜è®¤çš„è·³è½¬è·¯å¾„ </li><li>ç¬¬å››è¡Œè¡¨ç¤ºå¼€å¯ shiro</li><li>ç¬¬äº”è¡Œè¡¨ç¤ºç™»å½•æˆåŠŸçš„è·³è½¬é¡µé¢ </li><li>ç¬¬å…­è¡Œè¡¨ç¤ºç™»å½•é¡µé¢</li></ul><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Realm <span class="hljs-title">realm</span><span class="hljs-params">()</span> </span>&#123;        TextConfigurationRealm realm = <span class="hljs-keyword">new</span> TextConfigurationRealm();        realm.setUserDefinitions(<span class="hljs-string">&quot;javaboy=123,user \n admin=123,admin&quot;</span>);        realm.setRoleDefinitions(<span class="hljs-string">&quot;admin=read,write \n user=read&quot;</span>);        <span class="hljs-keyword">return</span> realm;    &#125;  <span class="hljs-comment">//é…ç½®æ‹¦æˆªè§„åˆ™</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">ShiroFilterChainDefinition <span class="hljs-title">shiroFilterChainDefinition</span><span class="hljs-params">()</span> </span>&#123;        DefaultShiroFilterChainDefinition definition = <span class="hljs-keyword">new</span> DefaultShiroFilterChainDefinition();        definition.addPathDefinition(<span class="hljs-string">&quot;/doLogin&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);        definition.addPathDefinition(<span class="hljs-string">&quot;/**&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);        <span class="hljs-keyword">return</span> definition;    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello shiro!&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;please login&quot;</span>;    &#125;    <span class="hljs-meta">@PostMapping(&quot;/doLogin&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doLogin</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        Subject subject = SecurityUtils.getSubject();        <span class="hljs-keyword">try</span> &#123;            subject.login(<span class="hljs-keyword">new</span> UsernamePasswordToken(username, password));            System.out.println(<span class="hljs-string">&quot;success&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (AuthenticationException e) &#123;            e.printStackTrace();            System.out.println(<span class="hljs-string">&quot;fail&gt;&quot;</span> + e.getMessage());        &#125;    &#125;&#125;</code></pre></div><h2 id="3-OAuth2"><a href="#3-OAuth2" class="headerlink" title="3. OAuth2"></a>3. OAuth2</h2><h3 id="3-1-å¼•å…¥"><a href="#3-1-å¼•å…¥" class="headerlink" title="3.1 å¼•å…¥"></a>3.1 å¼•å…¥</h3><p>ä½åœ¨ä¸€ä¸ªå¤§å‹çš„å±…æ°‘å°åŒºï¼Œå°åŒºæœ‰é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥çš„æ—¶å€™éœ€è¦è¾“å…¥å¯†ç ï¼Œæˆ‘ç»å¸¸ç½‘è´­å’Œå¤–å–ï¼Œæ¯å¤©éƒ½æœ‰å¿«é€’å‘˜æ¥é€è´§ã€‚æˆ‘å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåŠæ³•ï¼Œè®©å¿«é€’å‘˜é€šè¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒºï¼Œå¦‚æœæˆ‘æŠŠè‡ªå·±çš„å¯†ç ï¼Œå‘Šè¯‰å¿«é€’å‘˜ï¼Œä»–å°±æ‹¥æœ‰äº†ä¸æˆ‘åŒæ ·çš„æƒé™ï¼Œè¿™æ ·å¥½åƒä¸å¤ªåˆé€‚ã€‚ä¸‡ä¸€æˆ‘æƒ³å–æ¶ˆä»–è¿›å…¥å°åŒºçš„æƒåŠ›ï¼Œä¹Ÿå¾ˆéº»çƒ¦ï¼Œæˆ‘è‡ªå·±çš„å¯†ç ä¹Ÿå¾—è·Ÿç€æ”¹äº†ï¼Œè¿˜å¾—é€šçŸ¥å…¶ä»–çš„å¿«é€’å‘˜ã€‚æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œè®©å¿«é€’å‘˜èƒ½å¤Ÿè‡ªç”±è¿›å…¥å°åŒºï¼Œåˆä¸å¿…çŸ¥é“å°åŒºå±…æ°‘çš„å¯†ç ï¼Œè€Œä¸”ä»–çš„å”¯ä¸€æƒé™å°±æ˜¯é€è´§ï¼Œå…¶ä»–éœ€è¦å¯†ç çš„åœºåˆï¼Œä»–éƒ½æ²¡æœ‰æƒé™ã€‚</p><h4 id="æˆæƒæœºåˆ¶çš„è®¾è®¡"><a href="#æˆæƒæœºåˆ¶çš„è®¾è®¡" class="headerlink" title="æˆæƒæœºåˆ¶çš„è®¾è®¡"></a>æˆæƒæœºåˆ¶çš„è®¾è®¡</h4><p>äºæ˜¯ï¼Œæˆ‘è®¾è®¡äº†ä¸€å¥—æˆæƒæœºåˆ¶ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œé—¨ç¦ç³»ç»Ÿçš„å¯†ç è¾“å…¥å™¨ä¸‹é¢ï¼Œå¢åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œå«åšâ€è·å–æˆæƒâ€ã€‚å¿«é€’å‘˜éœ€è¦é¦–å…ˆæŒ‰è¿™ä¸ªæŒ‰é’®ï¼Œå»ç”³è¯·æˆæƒã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œä»–æŒ‰ä¸‹æŒ‰é’®ä»¥åï¼Œå±‹ä¸»ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ï¼‰çš„æ‰‹æœºå°±ä¼šè·³å‡ºå¯¹è¯æ¡†ï¼šæœ‰äººæ­£åœ¨è¦æ±‚æˆæƒã€‚ç³»ç»Ÿè¿˜ä¼šæ˜¾ç¤ºè¯¥å¿«é€’å‘˜çš„å§“åã€å·¥å·å’Œæ‰€å±çš„å¿«é€’å…¬å¸ã€‚</p><p>æˆ‘ç¡®è®¤è¯·æ±‚å±å®ï¼Œå°±ç‚¹å‡»æŒ‰é’®ï¼Œå‘Šè¯‰é—¨ç¦ç³»ç»Ÿï¼Œæˆ‘åŒæ„ç»™äºˆä»–è¿›å…¥å°åŒºçš„æˆæƒã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œé—¨ç¦ç³»ç»Ÿå¾—åˆ°æˆ‘çš„ç¡®è®¤ä»¥åï¼Œå‘å¿«é€’å‘˜æ˜¾ç¤ºä¸€ä¸ªè¿›å…¥å°åŒºçš„ä»¤ç‰Œï¼ˆaccess tokenï¼‰ã€‚ä»¤ç‰Œå°±æ˜¯ç±»ä¼¼å¯†ç çš„ä¸€ä¸²æ•°å­—ï¼Œåªåœ¨çŸ­æœŸå†…ï¼ˆæ¯”å¦‚ä¸ƒå¤©ï¼‰æœ‰æ•ˆã€‚</p><p>ç¬¬å››æ­¥ï¼Œå¿«é€’å‘˜å‘é—¨ç¦ç³»ç»Ÿè¾“å…¥ä»¤ç‰Œï¼Œè¿›å…¥å°åŒºã€‚</p><p>æœ‰äººå¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯è¿œç¨‹ä¸ºå¿«é€’å‘˜å¼€é—¨ï¼Œè€Œè¦ä¸ºä»–å•ç‹¬ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼Ÿè¿™æ˜¯å› ä¸ºå¿«é€’å‘˜å¯èƒ½æ¯å¤©éƒ½ä¼šæ¥é€è´§ï¼Œç¬¬äºŒå¤©ä»–è¿˜å¯ä»¥å¤ç”¨è¿™ä¸ªä»¤ç‰Œã€‚å¦å¤–ï¼Œæœ‰çš„å°åŒºæœ‰å¤šé‡é—¨ç¦ï¼Œå¿«é€’å‘˜å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªä»¤ç‰Œé€šè¿‡å®ƒä»¬ã€‚</p><h4 id="äº’è”ç½‘åœºæ™¯"><a href="#äº’è”ç½‘åœºæ™¯" class="headerlink" title="äº’è”ç½‘åœºæ™¯"></a>äº’è”ç½‘åœºæ™¯</h4><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­æ¬åˆ°äº’è”ç½‘ï¼Œå°±æ˜¯ OAuth çš„è®¾è®¡äº†ã€‚</p><p>é¦–å…ˆï¼Œå±…æ°‘å°åŒºå°±æ˜¯å‚¨å­˜ç”¨æˆ·æ•°æ®çš„ç½‘ç»œæœåŠ¡ã€‚æ¯”å¦‚ï¼Œå¾®ä¿¡å‚¨å­˜äº†æˆ‘çš„å¥½å‹ä¿¡æ¯ï¼Œè·å–è¿™äº›ä¿¡æ¯ï¼Œå°±å¿…é¡»ç»è¿‡å¾®ä¿¡çš„â€é—¨ç¦ç³»ç»Ÿâ€ã€‚</p><p>å…¶æ¬¡ï¼Œå¿«é€’å‘˜ï¼ˆæˆ–è€…è¯´å¿«é€’å…¬å¸ï¼‰å°±æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæƒ³è¦ç©¿è¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒºã€‚</p><p>æœ€åï¼Œæˆ‘å°±æ˜¯ç”¨æˆ·æœ¬äººï¼ŒåŒæ„æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è¿›å…¥å°åŒºï¼Œè·å–æˆ‘çš„æ•°æ®ã€‚</p><p>ç®€å•è¯´ï¼ŒOAuth å°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ã€‚æ•°æ®çš„æ‰€æœ‰è€…å‘Šè¯‰ç³»ç»Ÿï¼ŒåŒæ„æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è¿›å…¥ç³»ç»Ÿï¼Œè·å–è¿™äº›æ•°æ®ã€‚ç³»ç»Ÿä»è€Œäº§ç”Ÿä¸€ä¸ªçŸ­æœŸçš„è¿›å…¥ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œç”¨æ¥ä»£æ›¿å¯†ç ï¼Œä¾›ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨ã€‚</p><h4 id="ä»¤ç‰Œä¸å¯†ç "><a href="#ä»¤ç‰Œä¸å¯†ç " class="headerlink" title="ä»¤ç‰Œä¸å¯†ç "></a>ä»¤ç‰Œä¸å¯†ç </h4><p>ä»¤ç‰Œï¼ˆtokenï¼‰ä¸å¯†ç ï¼ˆpasswordï¼‰çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥è¿›å…¥ç³»ç»Ÿï¼Œä½†æ˜¯æœ‰ä¸‰ç‚¹å·®å¼‚ã€‚</p><p>ï¼ˆ1ï¼‰ä»¤ç‰Œæ˜¯çŸ­æœŸçš„ï¼Œåˆ°æœŸä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œç”¨æˆ·è‡ªå·±æ— æ³•ä¿®æ”¹ã€‚å¯†ç ä¸€èˆ¬é•¿æœŸæœ‰æ•ˆï¼Œç”¨æˆ·ä¸ä¿®æ”¹ï¼Œå°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>ï¼ˆ2ï¼‰ä»¤ç‰Œå¯ä»¥è¢«æ•°æ®æ‰€æœ‰è€…æ’¤é”€ï¼Œä¼šç«‹å³å¤±æ•ˆã€‚ä»¥ä¸Šä¾‹è€Œè¨€ï¼Œå±‹ä¸»å¯ä»¥éšæ—¶å–æ¶ˆå¿«é€’å‘˜çš„ä»¤ç‰Œã€‚å¯†ç ä¸€èˆ¬ä¸å…è®¸è¢«ä»–äººæ’¤é”€ã€‚</p><p>ï¼ˆ3ï¼‰ä»¤ç‰Œæœ‰æƒé™èŒƒå›´ï¼ˆscopeï¼‰ï¼Œæ¯”å¦‚åªèƒ½è¿›å°åŒºçš„äºŒå·é—¨ã€‚å¯¹äºç½‘ç»œæœåŠ¡æ¥è¯´ï¼Œåªè¯»ä»¤ç‰Œå°±æ¯”è¯»å†™ä»¤ç‰Œæ›´å®‰å…¨ã€‚å¯†ç ä¸€èˆ¬æ˜¯å®Œæ•´æƒé™ã€‚</p><p>ä¸Šé¢è¿™äº›è®¾è®¡ï¼Œä¿è¯äº†ä»¤ç‰Œæ—¢å¯ä»¥è®©ç¬¬ä¸‰æ–¹åº”ç”¨è·å¾—æƒé™ï¼ŒåŒæ—¶åˆéšæ—¶å¯æ§ï¼Œä¸ä¼šå±åŠç³»ç»Ÿå®‰å…¨ã€‚è¿™å°±æ˜¯ OAuth2.0 çš„ä¼˜ç‚¹ã€‚</p><p>æ³¨æ„ï¼Œåªè¦çŸ¥é“äº†ä»¤ç‰Œï¼Œå°±èƒ½è¿›å…¥ç³»ç»Ÿã€‚ç³»ç»Ÿä¸€èˆ¬ä¸ä¼šå†æ¬¡ç¡®è®¤èº«ä»½ï¼Œæ‰€ä»¥ä»¤ç‰Œå¿…é¡»ä¿å¯†ï¼Œæ³„æ¼ä»¤ç‰Œä¸æ³„æ¼å¯†ç çš„åæœæ˜¯ä¸€æ ·çš„ã€‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œä¸€èˆ¬éƒ½è®¾ç½®å¾—å¾ˆçŸ­çš„åŸå› ã€‚</p><p>OAuth2.0 å¯¹äºå¦‚ä½•é¢å‘ä»¤ç‰Œçš„ç»†èŠ‚ï¼Œè§„å®šå¾—éå¸¸è¯¦ç»†ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€å…±åˆ†æˆå››ç§æˆæƒç±»å‹ï¼ˆauthorization grantï¼‰ï¼Œå³å››ç§é¢å‘ä»¤ç‰Œçš„æ–¹å¼ï¼Œé€‚ç”¨äºä¸åŒçš„äº’è”ç½‘åœºæ™¯ã€‚</p><h3 id="3-2-ç®€ä»‹"><a href="#3-2-ç®€ä»‹" class="headerlink" title="3.2 ç®€ä»‹"></a>3.2 ç®€ä»‹</h3><p>OAuth æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œè¯¥æ ‡å‡†å…è®¸ç”¨æˆ·è®©ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è¯¥ç”¨æˆ·åœ¨æŸä¸€ç½‘ç«™ä¸Šå­˜å‚¨çš„ç§å¯†èµ„æºï¼ˆå¦‚å¤´åƒã€ç…§ç‰‡ã€è§†é¢‘ç­‰ï¼‰ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ— éœ€å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚å®ç°è¿™ä¸€åŠŸèƒ½æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œè€Œä¸æ˜¯ç”¨æˆ·åå’Œå¯†ç æ¥è®¿é—®ä»–ä»¬å­˜æ”¾åœ¨ç‰¹å®šæœåŠ¡æä¾›è€…çš„æ•°æ®ã€‚é‡‡ç”¨ä»¤ç‰Œï¼ˆtokenï¼‰çš„æ–¹å¼å¯ä»¥è®©ç”¨æˆ·çµæ´»çš„å¯¹ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒæˆ–è€…æ”¶å›æƒé™ã€‚</p><p>OAuth2 æ˜¯ OAuth åè®®çš„ä¸‹ä¸€ç‰ˆæœ¬ï¼Œä½†ä¸å‘ä¸‹å…¼å®¹ OAuth 1.0ã€‚ä¼ ç»Ÿçš„ Web å¼€å‘ç™»å½•è®¤è¯ä¸€èˆ¬éƒ½æ˜¯åŸºäº session çš„ï¼Œä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ç»§ç»­ä½¿ç”¨ session å°±ä¼šæœ‰è®¸å¤šä¸ä¾¿ï¼Œå› ä¸ºç§»åŠ¨ç«¯ï¼ˆAndroidã€iOSã€å¾®ä¿¡å°ç¨‹åºç­‰ï¼‰è¦ä¹ˆä¸æ”¯æŒ cookieï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰ï¼Œè¦ä¹ˆä½¿ç”¨éå¸¸ä¸ä¾¿ï¼Œå¯¹äºè¿™äº›é—®é¢˜ï¼Œä½¿ç”¨ OAuth2 è®¤è¯éƒ½èƒ½è§£å†³ã€‚</p><p>å¯¹äºå¤§å®¶è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨äº’è”ç½‘åº”ç”¨ä¸­æœ€å¸¸è§çš„ OAuth2 åº”è¯¥å°±æ˜¯å„ç§ç¬¬ä¸‰æ–¹ç™»å½•äº†ï¼Œä¾‹å¦‚ QQ æˆæƒç™»å½•ã€å¾®ä¿¡æˆæƒç™»å½•ã€å¾®åšæˆæƒç™»å½•ã€GitHub æˆæƒç™»å½•ç­‰ç­‰ã€‚</p><h3 id="3-3-å››ç§æ¨¡å¼"><a href="#3-3-å››ç§æ¨¡å¼" class="headerlink" title="3.3 å››ç§æ¨¡å¼"></a>3.3 å››ç§æ¨¡å¼</h3><p>OAuth2 åè®®ä¸€å…±æ”¯æŒ 4 ç§ä¸åŒçš„æˆæƒæ¨¡å¼ï¼š</p><ol><li>æˆæƒç æ¨¡å¼ï¼šå¸¸è§çš„ç¬¬ä¸‰æ–¹å¹³å°ç™»å½•åŠŸèƒ½åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</li><li>ç®€åŒ–æ¨¡å¼ï¼šç®€åŒ–æ¨¡å¼æ˜¯ä¸éœ€è¦å®¢æˆ·ç«¯æœåŠ¡å™¨å‚ä¸ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­å‘æˆæƒæœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œä¸€èˆ¬å¦‚æœç½‘ç«™æ˜¯çº¯é™æ€é¡µé¢åˆ™å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</li><li>å¯†ç æ¨¡å¼ï¼šå¯†ç æ¨¡å¼æ˜¯ç”¨æˆ·æŠŠç”¨æˆ·åå¯†ç ç›´æ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¿™äº›ä¿¡æ¯å‘æˆæƒæœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚è¿™éœ€è¦ç”¨æˆ·å¯¹å®¢æˆ·ç«¯é«˜åº¦ä¿¡ä»»ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åº”ç”¨å’ŒæœåŠ¡æä¾›å•†å°±æ˜¯åŒä¸€å®¶å…¬å¸ï¼Œæˆ‘ä»¬è‡ªå·±åšå‰åç«¯åˆ†ç¦»ç™»å½•å°±å¯ä»¥é‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚</li><li>å®¢æˆ·ç«¯æ¨¡å¼ï¼šå®¢æˆ·ç«¯æ¨¡å¼æ˜¯æŒ‡å®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„åä¹‰è€Œä¸æ˜¯ç”¨æˆ·çš„åä¹‰å‘æœåŠ¡æä¾›è€…ç”³è¯·æˆæƒï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå®¢æˆ·ç«¯æ¨¡å¼å¹¶ä¸èƒ½ç®—ä½œ OAuth åè®®è¦è§£å†³çš„é—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œåœ¨ä¸€äº›å‰åç«¯åˆ†ç¦»åº”ç”¨æˆ–è€…ä¸ºç§»åŠ¨ç«¯æä¾›çš„è®¤è¯æˆæƒæœåŠ¡å™¨ä¸Šä½¿ç”¨è¿™ç§æ¨¡å¼è¿˜æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚</li></ol><h4 id="3-2-1-æˆæƒç æ¨¡å¼"><a href="#3-2-1-æˆæƒç æ¨¡å¼" class="headerlink" title="3.2.1 æˆæƒç æ¨¡å¼"></a>3.2.1 æˆæƒç æ¨¡å¼</h4><p>æˆæƒç æ¨¡å¼æ˜¯æœ€å®‰å…¨å¹¶ä¸”ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§æ¨¡å¼ã€‚å‡å¦‚æˆ‘è¦å¼•å…¥å¾®ä¿¡ç™»å½•åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘çš„æµç¨‹å¯èƒ½æ˜¯è¿™æ ·ï¼š</p><p><a href="http://img.itboyhub.com/2020/04/oauth-1-7.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/oauth-1-7.png" alt="å›¾ç‰‡æºè‡ªç½‘ç»œ"></a></p><p>åœ¨æˆæƒç æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ†æˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨ï¼ŒæˆæƒæœåŠ¡å™¨ç”¨æ¥æ´¾å‘ Tokenï¼Œæ‹¿ç€ Token åˆ™å¯ä»¥å»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œè¿™ä¸¤ä¸ªæœåŠ¡å™¨å¯ä»¥åˆ†å¼€ï¼Œä¹Ÿå¯ä»¥åˆå¹¶ã€‚</p><p>ä¸Šé¢è¿™å¼ æµç¨‹å›¾çš„å«ä¹‰ï¼Œå…·ä½“æ˜¯è¿™æ ·ï¼š</p><ul><li>é¦–å…ˆï¼Œåœ¨ç½‘é¡µä¸Šæ”¾ä¸€ä¸ªè¶…é“¾æ¥ï¼ˆæˆ‘çš„ç½‘ç«™ç›¸å½“äºæ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ï¼‰ï¼Œç”¨æˆ· A ï¼ˆæœåŠ¡æ–¹çš„ç”¨æˆ·ï¼Œä¾‹å¦‚å¾®ä¿¡ç”¨æˆ·ï¼‰ç‚¹å‡»è¿™ä¸ªè¶…é“¾æ¥å°±ä¼šå»è¯·æ±‚æˆæƒæœåŠ¡å™¨ï¼ˆå¾®ä¿¡çš„æˆæƒæœåŠ¡å™¨ï¼‰ï¼Œç”¨æˆ·ç‚¹å‡»çš„è¿‡ç¨‹å…¶å®ä¹Ÿå°±æ˜¯æˆ‘è·Ÿç”¨æˆ·è¦æˆæƒçš„è¿‡ç¨‹ï¼Œè¿™å°±æ˜¯ä¸Šå›¾ä¸­çš„ 1ã€2 æ­¥ã€‚</li><li>æ¥ä¸‹æ¥çš„ç¬¬ä¸‰æ­¥ï¼Œå°±æ˜¯ç”¨æˆ·ç‚¹å‡»äº†è¶…é“¾æ¥ä¹‹åï¼ŒåƒæˆæƒæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘æ”¾åœ¨ <a href="http://www.javaboy.org/">www.javaboy.org</a> ç½‘é¡µä¸Šçš„è¶…é“¾æ¥å¯èƒ½æœ‰å¦‚ä¸‹å‚æ•°ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">https</span>:<span class="hljs-string">//wx.qq.com/oauth/authorize?response_type=code&amp;client_id=javaboy&amp;redirect_uri=www.javaboy.org&amp;scope=all</span></code></pre></div><ol><li>response_type è¡¨ç¤ºæˆæƒç±»å‹ï¼Œä½¿ç”¨æˆæƒç æ¨¡å¼çš„æ—¶å€™è¿™é‡Œå›ºå®šä¸º codeï¼Œè¡¨ç¤ºè¦æ±‚è¿”å›æˆæƒç ï¼ˆå°†æ¥æ‹¿ç€è¿™ä¸ªæˆæƒç å»è·å– access_tokenï¼‰</li><li>client_id è¡¨ç¤ºå®¢æˆ·ç«¯ idï¼Œä¹Ÿå°±æ˜¯æˆ‘åº”ç”¨çš„ idã€‚æœ‰çš„å°ä¼™ä¼´å¯¹è¿™ä¸ªä¸å¥½ç†è§£ï¼Œæˆ‘è¯´ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘æƒ³è®©æˆ‘çš„ <a href="http://www.javaboy.org/">www.javaboy.org</a> æ¥å…¥å¾®ä¿¡ç™»å½•åŠŸèƒ½ï¼Œæˆ‘è‚¯å®šå¾—å»å¾®ä¿¡å¼€æ”¾å¹³å°æ³¨å†Œï¼Œå»å¡«å…¥æˆ‘è‡ªå·±åº”ç”¨çš„åŸºæœ¬ä¿¡æ¯ç­‰ç­‰ï¼Œå¼„å®Œä¹‹åï¼Œå¾®ä¿¡ä¼šç»™æˆ‘ä¸€ä¸ª APPIDï¼Œä¹Ÿå°±æ˜¯æˆ‘è¿™é‡Œçš„ client_idï¼Œæ‰€ä»¥ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒæˆæƒæœåŠ¡å™¨åœ¨æ ¡éªŒçš„æ—¶å€™ï¼Œä¼šåšä¸¤ä»¶äº‹ï¼š1.æ ¡éªŒå®¢æˆ·ç«¯çš„èº«ä»½ï¼›2.æ ¡éªŒç”¨æˆ·èº«ä»½ã€‚</li><li>redirect_uri è¡¨ç¤ºç”¨æˆ·ç™»å½•åœ¨æˆåŠŸ/å¤±è´¥åï¼Œè·³è½¬çš„åœ°å€ï¼ˆæˆåŠŸç™»å½•å¾®ä¿¡åï¼Œè·³è½¬åˆ° <a href="http://www.javaboy.org/">www.javaboy.org</a> ä¸­çš„å“ªä¸ªé¡µé¢ï¼‰ï¼Œè·³è½¬çš„æ—¶å€™ï¼Œè¿˜ä¼šæºå¸¦ä¸Šä¸€ä¸ªæˆæƒç å‚æ•°ã€‚</li><li>scope è¡¨ç¤ºæˆæƒèŒƒå›´ï¼Œå³ <a href="http://www.javaboy.org/">www.javaboy.org</a> è¿™ä¸ªç½‘ç«™æ‹¿ç€ç”¨æˆ·çš„ token éƒ½èƒ½å¹²å•¥ï¼ˆä¸€èˆ¬æ¥è¯´å°±æ˜¯è·å–ç”¨æˆ·éæ•æ„Ÿçš„åŸºæœ¬ä¿¡æ¯ï¼‰</li></ol><ul><li><p>æ¥ä¸‹æ¥ç¬¬å››æ­¥ï¼Œ<a href="http://www.javaboy.org/">www.javaboy.org</a> è¿™ä¸ªç½‘ç«™ï¼Œæ‹¿ç€ç¬¬ä¸‰æ­¥è·å–åˆ°çš„ code ä»¥åŠè‡ªå·±çš„ client_id å’Œ client_secret ä»¥åŠå…¶ä»–ä¸€äº›ä¿¡æ¯å»æˆæƒæœåŠ¡å™¨è¯·æ±‚ä»¤ç‰Œï¼Œå¾®ä¿¡çš„æˆæƒæœåŠ¡å™¨åœ¨æ ¡éªŒè¿‡è¿™äº›æ•°æ®ä¹‹åï¼Œå°±ä¼šå‘é€ä¸€ä¸ªä»¤ç‰Œå›æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬æ˜¯åœ¨åç«¯å®Œæˆçš„ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ js å»å®Œæˆã€‚</p></li><li><p>æ¥ä¸‹æ¥æ‹¿ç€è¿™ä¸ª tokenï¼Œæˆ‘ä»¬å°±å¯ä»¥å»è¯·æ±‚ç”¨æˆ·ä¿¡æ¯äº†ã€‚</p></li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è®¤ä¸ºæˆæƒç æ¨¡å¼æ˜¯å››ç§æ¨¡å¼ä¸­æœ€å®‰å…¨çš„ä¸€ç§æ¨¡å¼ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼æˆ‘ä»¬çš„ access_token ä¸ç”¨ç»è¿‡æµè§ˆå™¨æˆ–è€…ç§»åŠ¨ç«¯ Appï¼Œæ˜¯ç›´æ¥ä»æˆ‘ä»¬çš„åå°å‘é€åˆ°æˆæƒæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±å¾ˆå¤§ç¨‹åº¦å‡å°‘äº† access_token æ³„æ¼çš„é£é™©ã€‚</p><h4 id="3-3-2-ç®€åŒ–æ¨¡å¼"><a href="#3-3-2-ç®€åŒ–æ¨¡å¼" class="headerlink" title="3.3.2 ç®€åŒ–æ¨¡å¼"></a>3.3.2 ç®€åŒ–æ¨¡å¼</h4><p>æŠ€æœ¯æ ˆæ­å»ºçš„åšå®¢/ç”µå­ä¹¦éƒ½æ˜¯å…¸å‹çš„çº¯å‰ç«¯åº”ç”¨ï¼Œå°±æ˜¯åªæœ‰é¡µé¢ï¼Œæ²¡æœ‰åç«¯ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå¦‚æœæˆ‘æƒ³æ¥å…¥å¾®ä¿¡ç™»å½•è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†æˆ‘ä»¬è¯´çš„ç®€åŒ–æ¨¡å¼ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ç®€åŒ–æ¨¡å¼çš„æµç¨‹å›¾ï¼š</p><p><a href="http://img.itboyhub.com/2020/04/oauth-1-8.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/oauth-1-8.png" alt="å›¾ç‰‡æºè‡ªç½‘ç»œ"></a></p><p>è¿™ä¸ªæµç¨‹æ˜¯è¿™æ ·ï¼š</p><ol><li>åœ¨æˆ‘ <a href="http://www.javaboy.org/">www.javaboy.org</a> ç½‘ç«™ä¸Šæœ‰ä¸€ä¸ªå¾®ä¿¡ç™»å½•çš„è¶…é“¾æ¥ï¼Œè¿™ä¸ªè¶…é“¾æ¥ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</li></ol><div class="hljs code-wrapper"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>wx.qq.com<span class="hljs-regexp">/oauth/</span>authorize?response_type=token&amp;client_id=javaboy&amp;redirect_uri=www.javaboy.org&amp;scope=all</code></pre></div><p>è¿™é‡Œçš„å‚æ•°å’Œå‰é¢æˆæƒç æ¨¡å¼çš„åŸºæœ¬ç›¸åŒï¼Œåªæœ‰ response_type çš„å€¼ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯ tokenï¼Œè¡¨ç¤ºè¦æ±‚æˆæƒæœåŠ¡å™¨ç›´æ¥è¿”å› access_tokenã€‚</p><ol><li>ç”¨æˆ·ç‚¹å‡»æˆ‘è¿™ä¸ªè¶…é“¾æ¥ä¹‹åï¼Œå°±ä¼šè·³è½¬åˆ°å¾®ä¿¡ç™»å½•é¡µé¢ï¼Œç„¶åç”¨æˆ·è¿›è¡Œç™»å½•ã€‚</li><li>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå¾®ä¿¡ä¼šè‡ªåŠ¨é‡å®šå‘åˆ° redirect_uri å‚æ•°æŒ‡å®šçš„è·³è½¬ç½‘å€ï¼ŒåŒæ—¶æºå¸¦ä¸Š access_tokenï¼Œè¿™æ ·ç”¨æˆ·åœ¨å‰ç«¯å°±è·å–åˆ° access_token äº†ã€‚</li></ol><p>ç®€åŒ–æ¨¡å¼çš„å¼Šç«¯å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºæ²¡æœ‰åç«¯ï¼Œæ‰€ä»¥éå¸¸ä¸å®‰å…¨ï¼Œé™¤éä½ å¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ã€‚</p><h4 id="3-3-3-å¯†ç æ¨¡å¼"><a href="#3-3-3-å¯†ç æ¨¡å¼" class="headerlink" title="3.3.3 å¯†ç æ¨¡å¼"></a>3.3.3 å¯†ç æ¨¡å¼</h4><p>å¯†ç æ¨¡å¼åœ¨ Spring Cloud é¡¹ç›®ä¸­æœ‰ç€éå¸¸å¹¿æ³›çš„åº”ç”¨</p><p>å¯†ç æ¨¡å¼æœ‰ä¸€ä¸ªå‰æå°±æ˜¯ä½ é«˜åº¦ä¿¡ä»»ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼šå¦‚æœæˆ‘è¦åœ¨ <a href="http://www.javaboy.org/">www.javaboy.org</a> è¿™ä¸ªç½‘ç«™ä¸Šæ¥å…¥å¾®ä¿¡ç™»å½•ï¼Œæˆ‘ä½¿ç”¨äº†å¯†ç æ¨¡å¼ï¼Œé‚£ä½ å°±è¦åœ¨ <a href="http://www.javaboy.org/">www.javaboy.org</a> è¿™ä¸ªç½‘ç«™å»è¾“å…¥å¾®ä¿¡çš„ç”¨æˆ·åå¯†ç ï¼Œè¿™è‚¯å®šæ˜¯ä¸é è°±çš„ï¼Œæ‰€ä»¥å¯†ç æ¨¡å¼éœ€è¦ä½ éå¸¸ä¿¡ä»»ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚</p><p>å¾®æœåŠ¡ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åœºæ™¯ï¼Œå°±æ˜¯æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œç”¨å¯†ç æ¨¡å¼åšé‰´æƒæ˜¯éå¸¸æ°å½“ä¸è¿‡çš„äº†ã€‚è¿™ä¸ªä»¥åå†ç»†è¯´ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å¯†ç æ¨¡å¼çš„æµç¨‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/04/oauth-1-9.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/oauth-1-9.png" alt="img"></a></p><p>å¯†ç å¼çš„æµç¨‹æ¯”è¾ƒç®€å•ï¼š</p><ul><li>é¦–å…ˆ <a href="http://www.javaboy.org/">www.javaboy.org</a> ä¼šå‘é€ä¸€ä¸ª post è¯·æ±‚ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>wx.qq.com<span class="hljs-regexp">/oauth/</span>authorize?response_type=password&amp;client_id=javaboy&amp;username=æ±Ÿå—ä¸€ç‚¹é›¨&amp;password=<span class="hljs-number">123</span></code></pre></div><p>è¿™é‡Œçš„å‚æ•°å’Œå‰é¢æˆæƒç æ¨¡å¼çš„ç•¥æœ‰å·®å¼‚ï¼Œresponse_type çš„å€¼ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯ passwordï¼Œè¡¨ç¤ºå¯†ç å¼ï¼Œå¦å¤–å¤šäº†ç”¨æˆ·å/å¯†ç å‚æ•°ï¼Œæ²¡æœ‰é‡å®šå‘çš„ redirect_uri ï¼Œå› ä¸ºè¿™é‡Œä¸éœ€è¦é‡å®šå‘ã€‚</p><ul><li>å¾®ä¿¡æ ¡éªŒè¿‡ç”¨æˆ·å/å¯†ç ä¹‹åï¼Œç›´æ¥åœ¨ HTTP å“åº”ä¸­æŠŠ access_token è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h4 id="3-3-4-å®¢æˆ·ç«¯æ¨¡å¼"><a href="#3-3-4-å®¢æˆ·ç«¯æ¨¡å¼" class="headerlink" title="3.3.4 å®¢æˆ·ç«¯æ¨¡å¼"></a>3.3.4 å®¢æˆ·ç«¯æ¨¡å¼</h4><p>æœ‰çš„åº”ç”¨å¯èƒ½æ²¡æœ‰å‰ç«¯é¡µé¢ï¼Œå°±æ˜¯ä¸€ä¸ªåå°ï¼Œæ¯”å¦‚</p><ul><li><a href="https://mp.weixin.qq.com/s/f3QexxLp9vT6aE1Pl3jHGw">Spring Boot å¼€å‘å¾®ä¿¡å…¬ä¼—å·åå°ï¼Œçœ‹çœ‹æ¾å“¥å…¬ä¼—å·åå°æ˜¯æ€ä¹ˆå®ç°çš„ï¼</a></li><li><a href="https://mp.weixin.qq.com/s/1jTl9kBeFeibjbe5EbsCzg">Spring Boot å¦‚ä½•ç»™å¾®ä¿¡å…¬ä¼—å·è¿”å›æ¶ˆæ¯</a></li></ul><p>è¿™ç§åº”ç”¨å¼€å‘å¥½äº†å°±æ²¡æœ‰åå°ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®¢æˆ·ç«¯æ¨¡å¼çš„æµç¨‹å›¾ï¼š</p><p><a href="http://img.itboyhub.com/2020/04/oauth-1-10.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/oauth-1-10.png" alt="img"></a></p><p>è¿™ä¸ªæ­¥éª¤ä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸¤æ­¥ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æˆæƒæœåŠ¡å™¨ï¼Œè¯·æ±‚æ ¼å¼å¦‚ä¸‹ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">GET</span> <span class="hljs-string">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;client_id=APPID&amp;client_secret=APPSECRET</span></code></pre></div><p>è¿™é‡Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå«ä¹‰å¦‚ä¸‹ï¼š</p><p>grant_typeï¼Œè·å–access_tokenå¡«å†™client_credential</p><p>client_id å’Œ client_secret ç”¨æ¥ç¡®è®¤å®¢æˆ·ç«¯çš„èº«ä»½</p><ul><li>æˆæƒæœåŠ¡å™¨é€šè¿‡éªŒè¯åï¼Œä¼šç›´æ¥è¿”å› access_token ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>å¤§å®¶å‘ç°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¥½åƒæ²¡æœ‰ç”¨æˆ·ä»€ä¹ˆäº‹äº†ï¼æ˜¯çš„ï¼Œå®¢æˆ·ç«¯æ¨¡å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œå°±æ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ã€‚</p><p>åœ¨æ¥å…¥å¾®ä¿¡å…¬ä¼—å·åå°çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªè·å– Access_token çš„æ­¥éª¤ï¼Œå…¶å®å°±æ˜¯è¿™ç§æ¨¡å¼ï¼Œæˆ‘æˆªäº†ä¸€å¼ å¾®ä¿¡å¼€å‘å¹³å°æ–‡æ¡£çš„å›¾ï¼Œå¤§å®¶çœ‹ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2020/04/oauth-1-11.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/oauth-1-11.png" alt="img"></a></p><h3 id="3-4-æ•´åˆåˆ°SpringBoot"><a href="#3-4-æ•´åˆåˆ°SpringBoot" class="headerlink" title="3.4 æ•´åˆåˆ°SpringBoot"></a>3.4 æ•´åˆåˆ°SpringBoot</h3><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security.oauth<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-oauth2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.6.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">192.168.66.128</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-meta">spring.redis.password</span>=<span class="hljs-string">123</span><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span></code></pre></div><p><strong>æˆæƒæœåŠ¡å™¨é…ç½®ï¼ˆå¯†ç æ¨¡å¼ï¼‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableAuthorizationServer</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthorizationServerConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizationServerConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    AuthenticationManager authenticationManager;    <span class="hljs-meta">@Autowired</span>    RedisConnectionFactory redisConnectionFactory;    <span class="hljs-meta">@Autowired</span>    UserDetailsService userDetailsService;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();    &#125;    <span class="hljs-comment">//tokençš„é…ç½®</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(ClientDetailsServiceConfigurer clients)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        clients.inMemory()                .withClient(<span class="hljs-string">&quot;password&quot;</span>)                .authorizedGrantTypes(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;refresh_token&quot;</span>)                .accessTokenValiditySeconds(<span class="hljs-number">1800</span>)                .resourceIds(<span class="hljs-string">&quot;rid&quot;</span>)                .scopes(<span class="hljs-string">&quot;all&quot;</span>)                .secret(<span class="hljs-string">&quot;$2a$10$kwLIAqAupvY87OM.O25.Yu1QKEXV1imAv7jWbDaQRFUFWSnSiDEwG&quot;</span>);    &#125;    <span class="hljs-comment">//tokençš„å­˜å‚¨</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        endpoints.tokenStore(<span class="hljs-keyword">new</span> RedisTokenStore(redisConnectionFactory))                .authenticationManager(authenticationManager)                .userDetailsService(userDetailsService);    &#125;    <span class="hljs-comment">//ç™»å½•è®¤è¯</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthorizationServerSecurityConfigurer security)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        security.allowFormAuthenticationForClients();    &#125;&#125;</code></pre></div><p><strong>é…ç½®èµ„æºæœåŠ¡å™¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableResourceServer</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceServerConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResourceServerConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(ResourceServerSecurityConfigurer resources)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        resources.resourceId(<span class="hljs-string">&quot;rid&quot;</span>).stateless(<span class="hljs-keyword">true</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests().antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)                .anyRequest().authenticated();    &#125;&#125;</code></pre></div><p><strong>Securityé…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationManager <span class="hljs-title">authenticationManager</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.authenticationManager();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> UserDetailsService <span class="hljs-title">userDetailsService</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.userDetailsService();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.inMemoryAuthentication()                .withUser(<span class="hljs-string">&quot;javaboy&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$kwLIAqAupvY87OM.O25.Yu1QKEXV1imAv7jWbDaQRFUFWSnSiDEwG&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)                .and()                .withUser(<span class="hljs-string">&quot;æ±Ÿå—ä¸€ç‚¹é›¨&quot;</span>)                .password(<span class="hljs-string">&quot;$2a$10$kwLIAqAupvY87OM.O25.Yu1QKEXV1imAv7jWbDaQRFUFWSnSiDEwG&quot;</span>)                .roles(<span class="hljs-string">&quot;user&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.antMatcher(<span class="hljs-string">&quot;/oauth/**&quot;</span>)                .authorizeRequests()                .antMatchers(<span class="hljs-string">&quot;/oauth/**&quot;</span>).permitAll()                .and().csrf().disable();    &#125;&#125;</code></pre></div><h2 id="4-JWT"><a href="#4-JWT" class="headerlink" title="4. JWT"></a>4. JWT</h2><p>åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œä¸Šé¢ä»‹ç»äº†Oauth2çš„æ–¹å¼ï¼Œä¸è¿‡ JWT ç®—æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¸€ç§è§£å†³æ–¹æ¡ˆäº†ï¼Œæœ¬æ–‡å°±å’Œå¤§å®¶æ¥åˆ†äº«ä¸€ä¸‹å¦‚ä½•å°† Spring Security å’Œ JWT ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œè¿›è€Œå®ç°å‰åç«¯åˆ†ç¦»æ—¶çš„ç™»å½•è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="1-æ— çŠ¶æ€ç™»å½•"><a href="#1-æ— çŠ¶æ€ç™»å½•" class="headerlink" title="1 æ— çŠ¶æ€ç™»å½•"></a>1 æ— çŠ¶æ€ç™»å½•</h3><h4 id="1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ</h4><p>æœ‰çŠ¶æ€æœåŠ¡ï¼Œå³æœåŠ¡ç«¯éœ€è¦è®°å½•æ¯æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå…¸å‹çš„è®¾è®¡å¦‚Tomcatä¸­çš„Sessionã€‚ä¾‹å¦‚ç™»å½•ï¼šç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯sessionä¸­ï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä¸€ä¸ªcookieå€¼ï¼Œè®°å½•å¯¹åº”çš„sessionï¼Œç„¶åä¸‹æ¬¡è¯·æ±‚ï¼Œç”¨æˆ·æºå¸¦cookieå€¼æ¥ï¼ˆè¿™ä¸€æ­¥æœ‰æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«åˆ°å¯¹åº”sessionï¼Œä»è€Œæ‰¾åˆ°ç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç›®å‰æ¥çœ‹æœ€æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>æœåŠ¡ç«¯ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li><li>æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œä¸æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²</li></ul><h4 id="1-2-ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"><a href="#1-2-ä»€ä¹ˆæ˜¯æ— çŠ¶æ€" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"></a>1.2 ä»€ä¹ˆæ˜¯æ— çŠ¶æ€</h4><p>å¾®æœåŠ¡é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡ï¼Œå¯¹å¤–æä¾›çš„éƒ½ä½¿ç”¨RESTfulé£æ ¼çš„æ¥å£ã€‚è€ŒRESTfulé£æ ¼çš„ä¸€ä¸ªæœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ï¼šæœåŠ¡çš„æ— çŠ¶æ€æ€§ï¼Œå³ï¼š</p><ul><li>æœåŠ¡ç«¯ä¸ä¿å­˜ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚è€…ä¿¡æ¯</li><li>å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å¿…é¡»å…·å¤‡è‡ªæè¿°ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½</li></ul><p><strong>é‚£ä¹ˆè¿™ç§æ— çŠ¶æ€æ€§æœ‰å“ªäº›å¥½å¤„å‘¢ï¼Ÿ</strong></p><ul><li>å®¢æˆ·ç«¯è¯·æ±‚ä¸ä¾èµ–æœåŠ¡ç«¯çš„ä¿¡æ¯ï¼Œå¤šæ¬¡è¯·æ±‚ä¸éœ€è¦å¿…é¡»è®¿é—®åˆ°åŒä¸€å°æœåŠ¡å™¨</li><li>æœåŠ¡ç«¯çš„é›†ç¾¤å’ŒçŠ¶æ€å¯¹å®¢æˆ·ç«¯é€æ˜</li><li>æœåŠ¡ç«¯å¯ä»¥ä»»æ„çš„è¿ç§»å’Œä¼¸ç¼©ï¼ˆå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œé›†ç¾¤åŒ–éƒ¨ç½²ï¼‰</li><li>å‡å°æœåŠ¡ç«¯å­˜å‚¨å‹åŠ›</li></ul><h4 id="1-3-å¦‚ä½•å®ç°æ— çŠ¶æ€"><a href="#1-3-å¦‚ä½•å®ç°æ— çŠ¶æ€" class="headerlink" title="1.3.å¦‚ä½•å®ç°æ— çŠ¶æ€"></a>1.3.å¦‚ä½•å®ç°æ— çŠ¶æ€</h4><p>æ— çŠ¶æ€ç™»å½•çš„æµç¨‹ï¼š</p><ul><li>é¦–å…ˆå®¢æˆ·ç«¯å‘é€è´¦æˆ·å/å¯†ç åˆ°æœåŠ¡ç«¯è¿›è¡Œè®¤è¯</li><li>è®¤è¯é€šè¿‡åï¼ŒæœåŠ¡ç«¯å°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†å¹¶ä¸”ç¼–ç æˆä¸€ä¸ªtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li><li>ä»¥åå®¢æˆ·ç«¯æ¯æ¬¡å‘é€è¯·æ±‚ï¼Œéƒ½éœ€è¦æºå¸¦è®¤è¯çš„token</li><li>æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯å‘é€æ¥çš„tokenè¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ä¸”è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯</li></ul><h4 id="1-4-JWT"><a href="#1-4-JWT" class="headerlink" title="1.4 JWT"></a>1.4 JWT</h4><h5 id="1-4-1-ç®€ä»‹"><a href="#1-4-1-ç®€ä»‹" class="headerlink" title="1.4.1 ç®€ä»‹"></a>1.4.1 ç®€ä»‹</h5><p>JWTï¼Œå…¨ç§°æ˜¯Json Web Tokenï¼Œ æ˜¯ä¸€ç§JSONé£æ ¼çš„è½»é‡çº§çš„æˆæƒå’Œèº«ä»½è®¤è¯è§„èŒƒï¼Œå¯å®ç°æ— çŠ¶æ€ã€åˆ†å¸ƒå¼çš„Webåº”ç”¨æˆæƒï¼ŒJWT ä½œä¸ºä¸€ç§è§„èŒƒï¼Œå¹¶æ²¡æœ‰å’ŒæŸä¸€ç§è¯­è¨€ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¸¸ç”¨çš„Java å®ç°æ˜¯GitHub ä¸Šçš„å¼€æºé¡¹ç›® jjwtï¼Œåœ°å€å¦‚ä¸‹ï¼š<code>https://github.com/jwtk/jjwt</code></p><h5 id="1-4-2-JWTæ•°æ®æ ¼å¼"><a href="#1-4-2-JWTæ•°æ®æ ¼å¼" class="headerlink" title="1.4.2 JWTæ•°æ®æ ¼å¼"></a>1.4.2 JWTæ•°æ®æ ¼å¼</h5><p>JWTåŒ…å«ä¸‰éƒ¨åˆ†æ•°æ®ï¼š</p><ul><li><p>Headerï¼šå¤´éƒ¨ï¼Œé€šå¸¸å¤´éƒ¨æœ‰ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p><ul><li>å£°æ˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯JWT</li><li>åŠ å¯†ç®—æ³•ï¼Œè‡ªå®šä¹‰</li></ul><p>æˆ‘ä»¬ä¼šå¯¹å¤´éƒ¨è¿›è¡ŒBase64Urlç¼–ç ï¼ˆå¯è§£ç ï¼‰ï¼Œå¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p></li><li><p>Payloadï¼šè½½è·ï¼Œå°±æ˜¯æœ‰æ•ˆæ•°æ®ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­(RFC7519)ï¼Œè¿™é‡Œç»™äº†7ä¸ªç¤ºä¾‹ä¿¡æ¯ï¼š</p><ul><li>iss (issuer)ï¼šè¡¨ç¤ºç­¾å‘äºº</li><li>exp (expiration time)ï¼šè¡¨ç¤ºtokenè¿‡æœŸæ—¶é—´</li><li>sub (subject)ï¼šä¸»é¢˜</li><li>aud (audience)ï¼šå—ä¼—</li><li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</li><li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li><li>jti (JWT ID)ï¼šç¼–å·</li></ul><p>è¿™éƒ¨åˆ†ä¹Ÿä¼šé‡‡ç”¨Base64Urlç¼–ç ï¼Œå¾—åˆ°ç¬¬äºŒéƒ¨åˆ†æ•°æ®ã€‚</p></li><li><p>Signatureï¼šç­¾åï¼Œæ˜¯æ•´ä¸ªæ•°æ®çš„è®¤è¯ä¿¡æ¯ã€‚ä¸€èˆ¬æ ¹æ®å‰ä¸¤æ­¥çš„æ•°æ®ï¼Œå†åŠ ä¸ŠæœåŠ¡çš„çš„å¯†é’¥secretï¼ˆå¯†é’¥ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œä¸èƒ½æ³„éœ²ç»™å®¢æˆ·ç«¯ï¼‰ï¼Œé€šè¿‡Headerä¸­é…ç½®çš„åŠ å¯†ç®—æ³•ç”Ÿæˆã€‚ç”¨äºéªŒè¯æ•´ä¸ªæ•°æ®å®Œæ•´å’Œå¯é æ€§ã€‚</p></li></ul><p>ç”Ÿæˆçš„æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-2.png" alt="img"></p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ•°æ®é€šè¿‡ <code>.</code> éš”å¼€æˆäº†ä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«å¯¹åº”å‰é¢æåˆ°çš„ä¸‰éƒ¨åˆ†ï¼Œå¦å¤–ï¼Œè¿™é‡Œæ•°æ®æ˜¯ä¸æ¢è¡Œçš„ï¼Œå›¾ç‰‡æ¢è¡Œåªæ˜¯ä¸ºäº†å±•ç¤ºæ–¹ä¾¿è€Œå·²ã€‚</p><h5 id="1-4-3-JWTäº¤äº’æµç¨‹"><a href="#1-4-3-JWTäº¤äº’æµç¨‹" class="headerlink" title="1.4.3 JWTäº¤äº’æµç¨‹"></a>1.4.3 JWTäº¤äº’æµç¨‹</h5><p>æµç¨‹å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-3.png" alt="img"></p><p>æ­¥éª¤ç¿»è¯‘ï¼š</p><ol><li>åº”ç”¨ç¨‹åºæˆ–å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨è¯·æ±‚æˆæƒ</li><li>è·å–åˆ°æˆæƒåï¼ŒæˆæƒæœåŠ¡å™¨ä¼šå‘åº”ç”¨ç¨‹åºè¿”å›è®¿é—®ä»¤ç‰Œ</li><li>åº”ç”¨ç¨‹åºä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤èµ„æºï¼ˆå¦‚APIï¼‰</li></ol><p>å› ä¸ºJWTç­¾å‘çš„tokenä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ï¼Œè¿™æ ·æœåŠ¡çš„å°±æ— éœ€ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œç”šè‡³æ— éœ€å»æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿™æ ·å°±å®Œå…¨ç¬¦åˆäº†RESTfulçš„æ— çŠ¶æ€è§„èŒƒã€‚</p><h4 id="1-5-JWT-å­˜åœ¨çš„é—®é¢˜"><a href="#1-5-JWT-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="1.5 JWT å­˜åœ¨çš„é—®é¢˜"></a>1.5 JWT å­˜åœ¨çš„é—®é¢˜</h4><p>è¯´äº†è¿™ä¹ˆå¤šï¼ŒJWT ä¹Ÿä¸æ˜¯å¤©è¡£æ— ç¼ï¼Œç”±å®¢æˆ·ç«¯ç»´æŠ¤ç™»å½•çŠ¶æ€å¸¦æ¥çš„ä¸€äº›é—®é¢˜åœ¨è¿™é‡Œä¾ç„¶å­˜åœ¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><ol><li>ç»­ç­¾é—®é¢˜ï¼Œè¿™æ˜¯è¢«å¾ˆå¤šäººè¯Ÿç—…çš„é—®é¢˜ä¹‹ä¸€ï¼Œä¼ ç»Ÿçš„cookie+sessionçš„æ–¹æ¡ˆå¤©ç„¶çš„æ”¯æŒç»­ç­¾ï¼Œä½†æ˜¯jwtç”±äºæœåŠ¡ç«¯ä¸ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œå› æ­¤å¾ˆéš¾å®Œç¾è§£å†³ç»­ç­¾é—®é¢˜ï¼Œå¦‚æœå¼•å…¥redisï¼Œè™½ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯jwtä¹Ÿå˜å¾—ä¸ä¼¦ä¸ç±»äº†ã€‚</li><li>æ³¨é”€é—®é¢˜ï¼Œç”±äºæœåŠ¡ç«¯ä¸å†ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸€èˆ¬å¯ä»¥é€šè¿‡ä¿®æ”¹secretæ¥å®ç°æ³¨é”€ï¼ŒæœåŠ¡ç«¯secretä¿®æ”¹åï¼Œå·²ç»é¢å‘çš„æœªè¿‡æœŸçš„tokenå°±ä¼šè®¤è¯å¤±è´¥ï¼Œè¿›è€Œå®ç°æ³¨é”€ï¼Œä¸è¿‡æ¯•ç«Ÿæ²¡æœ‰ä¼ ç»Ÿçš„æ³¨é”€æ–¹ä¾¿ã€‚</li><li>å¯†ç é‡ç½®ï¼Œå¯†ç é‡ç½®åï¼ŒåŸæœ¬çš„tokenä¾ç„¶å¯ä»¥è®¿é—®ç³»ç»Ÿï¼Œè¿™æ—¶å€™ä¹Ÿéœ€è¦å¼ºåˆ¶ä¿®æ”¹secretã€‚</li><li>åŸºäºç¬¬2ç‚¹å’Œç¬¬3ç‚¹ï¼Œä¸€èˆ¬å»ºè®®ä¸åŒç”¨æˆ·å–ä¸åŒsecretã€‚</li></ol><h3 id="2-æ•´åˆåˆ°SpringBoot"><a href="#2-æ•´åˆåˆ°SpringBoot" class="headerlink" title="2 æ•´åˆåˆ°SpringBoot"></a>2 æ•´åˆåˆ°SpringBoot</h3><h4 id="2-1-ç¯å¢ƒæ­å»º"><a href="#2-1-ç¯å¢ƒæ­å»º" class="headerlink" title="2.1 ç¯å¢ƒæ­å»º"></a>2.1 ç¯å¢ƒæ­å»º</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼Œåˆ›å»ºæ—¶éœ€è¦æ·»åŠ Spring Securityä¾èµ–ï¼Œåˆ›å»ºå®Œæˆåï¼Œæ·»åŠ  <code>jjwt</code> ä¾èµ–ï¼Œå®Œæ•´çš„pom.xmlæ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶ååœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ User å¯¹è±¡å®ç° UserDetails æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-keyword">private</span> List&lt;GrantedAuthority&gt; authorities;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> username;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-comment">//çœç•¥getter/setter</span>&#125;</code></pre></div><p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·å¯¹è±¡ï¼Œå…ˆæ”¾ç€å¤‡ç”¨ï¼Œå†åˆ›å»ºä¸€ä¸ªHelloControllerï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello jwt !&quot;</span>;    &#125;    <span class="hljs-meta">@GetMapping(&quot;/admin&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello admin !&quot;</span>;    &#125;&#125;</code></pre></div><p>HelloController å¾ˆç®€å•ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ¥å£ï¼Œè®¾è®¡æ˜¯ <code>/hello</code> æ¥å£å¯ä»¥è¢«å…·æœ‰ user è§’è‰²çš„ç”¨æˆ·è®¿é—®ï¼Œè€Œ <code>/admin</code> æ¥å£åˆ™å¯ä»¥è¢«å…·æœ‰ admin è§’è‰²çš„ç”¨æˆ·è®¿é—®ã€‚</p><h4 id="2-2-JWT-è¿‡æ»¤å™¨é…ç½®"><a href="#2-2-JWT-è¿‡æ»¤å™¨é…ç½®" class="headerlink" title="2.2 JWT è¿‡æ»¤å™¨é…ç½®"></a>2.2 JWT è¿‡æ»¤å™¨é…ç½®</h4><p>æ¥ä¸‹æ¥æä¾›ä¸¤ä¸ªå’Œ JWT ç›¸å…³çš„è¿‡æ»¤å™¨é…ç½®ï¼š</p><ol><li>ä¸€ä¸ªæ˜¯ç”¨æˆ·ç™»å½•çš„è¿‡æ»¤å™¨ï¼Œåœ¨ç”¨æˆ·çš„ç™»å½•çš„è¿‡æ»¤å™¨ä¸­æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªtokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç™»å½•å¤±è´¥åˆ™ç»™å‰ç«¯ä¸€ä¸ªç™»å½•å¤±è´¥çš„æç¤ºã€‚</li><li>ç¬¬äºŒä¸ªè¿‡æ»¤å™¨åˆ™æ˜¯å½“å…¶ä»–è¯·æ±‚å‘é€æ¥ï¼Œæ ¡éªŒtokençš„è¿‡æ»¤å™¨ï¼Œå¦‚æœæ ¡éªŒæˆåŠŸï¼Œå°±è®©è¯·æ±‚ç»§ç»­æ‰§è¡Œã€‚</li></ol><p>è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtLoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAuthenticationProcessingFilter</span> </span>&#123;      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">JwtLoginFilter</span><span class="hljs-params">(String defaultFilterProcessesUrl, AuthenticationManager authenticationManager)</span> </span>&#123;            <span class="hljs-keyword">super</span>(<span class="hljs-keyword">new</span> AntPathRequestMatcher(defaultFilterProcessesUrl));        setAuthenticationManager(authenticationManager);    &#125;      <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> AuthenticationException, IOException, ServletException </span>&#123;        User user = <span class="hljs-keyword">new</span> ObjectMapper().readValue(req.getInputStream(), User.class);        <span class="hljs-keyword">return</span> getAuthenticationManager().authenticate(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(user.getUsername(), user.getPassword()));    &#125;      <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">successfulAuthentication</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, FilterChain chain, Authentication authResult)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        Collection&lt;? extends GrantedAuthority&gt; authorities = authResult.getAuthorities();        StringBuffer as = <span class="hljs-keyword">new</span> StringBuffer();        <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;            as.append(authority.getAuthority())                    .append(<span class="hljs-string">&quot;,&quot;</span>);        &#125;        String jwt = Jwts.builder()                .claim(<span class="hljs-string">&quot;authorities&quot;</span>, as)<span class="hljs-comment">//é…ç½®ç”¨æˆ·è§’è‰²</span>                .setSubject(authResult.getName())                .setExpiration(<span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>))                .signWith(SignatureAlgorithm.HS512,<span class="hljs-string">&quot;sang@123&quot;</span>)                .compact();        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);        PrintWriter out = resp.getWriter();        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(jwt));        out.flush();        out.close();    &#125;    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unsuccessfulAuthentication</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException failed)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);        PrintWriter out = resp.getWriter();        out.write(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥!&quot;</span>);        out.flush();        out.close();    &#125;&#125;</code></pre></div><p>å…³äºè¿™ä¸ªç±»ï¼Œæˆ‘è¯´å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li>è‡ªå®šä¹‰ JwtLoginFilter ç»§æ‰¿è‡ª AbstractAuthenticationProcessingFilterï¼Œå¹¶å®ç°å…¶ä¸­çš„ä¸‰ä¸ªé»˜è®¤æ–¹æ³•ã€‚</li><li>attemptAuthenticationæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»ç™»å½•å‚æ•°ä¸­æå–å‡ºç”¨æˆ·åå¯†ç ï¼Œç„¶åè°ƒç”¨AuthenticationManager.authenticate()æ–¹æ³•å»è¿›è¡Œè‡ªåŠ¨æ ¡éªŒã€‚</li><li>ç¬¬äºŒæ­¥å¦‚æœæ ¡éªŒæˆåŠŸï¼Œå°±ä¼šæ¥åˆ°successfulAuthenticationå›è°ƒä¸­ï¼Œåœ¨successfulAuthenticationæ–¹æ³•ä¸­ï¼Œå°†ç”¨æˆ·è§’è‰²éå†ç„¶åç”¨ä¸€ä¸ª <code>,</code> è¿æ¥èµ·æ¥ï¼Œç„¶åå†åˆ©ç”¨Jwtså»ç”Ÿæˆtokenï¼ŒæŒ‰ç…§ä»£ç çš„é¡ºåºï¼Œç”Ÿæˆè¿‡ç¨‹ä¸€å…±é…ç½®äº†å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ·è§’è‰²ã€ä¸»é¢˜ã€è¿‡æœŸæ—¶é—´ä»¥åŠåŠ å¯†ç®—æ³•å’Œå¯†é’¥ï¼Œç„¶åå°†ç”Ÿæˆçš„tokenå†™å‡ºåˆ°å®¢æˆ·ç«¯ã€‚</li><li>ç¬¬äºŒæ­¥å¦‚æœæ ¡éªŒå¤±è´¥å°±ä¼šæ¥åˆ°unsuccessfulAuthenticationæ–¹æ³•ä¸­ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªé”™è¯¯æç¤ºç»™å®¢æˆ·ç«¯å³å¯ã€‚</li></ol><p>å†æ¥çœ‹ç¬¬äºŒä¸ªtokenæ ¡éªŒçš„è¿‡æ»¤å™¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        HttpServletRequest req = (HttpServletRequest) servletRequest;        String jwtToken = req.getHeader(<span class="hljs-string">&quot;authorization&quot;</span>);        System.out.println(jwtToken);        Claims claims = Jwts.parser().setSigningKey(<span class="hljs-string">&quot;sang@123&quot;</span>).parseClaimsJws(jwtToken.replace(<span class="hljs-string">&quot;Bearer&quot;</span>,<span class="hljs-string">&quot;&quot;</span>))                .getBody();        String username = claims.getSubject();<span class="hljs-comment">//è·å–å½“å‰ç™»å½•ç”¨æˆ·å</span>        List&lt;GrantedAuthority&gt; authorities = AuthorityUtils.commaSeparatedStringToAuthorityList((String) claims.get(<span class="hljs-string">&quot;authorities&quot;</span>));        UsernamePasswordAuthenticationToken token = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(username, <span class="hljs-keyword">null</span>, authorities);        SecurityContextHolder.getContext().setAuthentication(token);        filterChain.doFilter(req,servletResponse);    &#125;&#125;</code></pre></div><p>å…³äºè¿™ä¸ªè¿‡æ»¤å™¨ï¼Œæˆ‘è¯´å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li>é¦–å…ˆä»è¯·æ±‚å¤´ä¸­æå–å‡º authorization å­—æ®µï¼Œè¿™ä¸ªå­—æ®µå¯¹åº”çš„valueå°±æ˜¯ç”¨æˆ·çš„tokenã€‚</li><li>å°†æå–å‡ºæ¥çš„tokenå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªClaimså¯¹è±¡ï¼Œå†ä»Claimså¯¹è±¡ä¸­æå–å‡ºå½“å‰ç”¨æˆ·åå’Œç”¨æˆ·è§’è‰²ï¼Œåˆ›å»ºä¸€ä¸ªUsernamePasswordAuthenticationTokenæ”¾åˆ°å½“å‰çš„Contextä¸­ï¼Œç„¶åæ‰§è¡Œè¿‡æ»¤é“¾ä½¿è¯·æ±‚ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</li></ol><p>å¦‚æ­¤ä¹‹åï¼Œä¸¤ä¸ªå’ŒJWTç›¸å…³çš„è¿‡æ»¤å™¨å°±ç®—é…ç½®å¥½äº†ã€‚</p><h4 id="2-3-Spring-Security-é…ç½®"><a href="#2-3-Spring-Security-é…ç½®" class="headerlink" title="2.3 Spring Security é…ç½®"></a>2.3 Spring Security é…ç½®</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é…ç½® Spring Security,å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.inMemoryAuthentication().withUser(<span class="hljs-string">&quot;admin&quot;</span>)                .password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)                .and()                .withUser(<span class="hljs-string">&quot;sang&quot;</span>)                .password(<span class="hljs-string">&quot;456&quot;</span>)                .roles(<span class="hljs-string">&quot;user&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .antMatchers(<span class="hljs-string">&quot;/hello&quot;</span>).hasRole(<span class="hljs-string">&quot;user&quot;</span>)                .antMatchers(<span class="hljs-string">&quot;/admin&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)                .antMatchers(HttpMethod.POST, <span class="hljs-string">&quot;/login&quot;</span>).permitAll()                .anyRequest().authenticated()                .and()                .addFilterBefore(<span class="hljs-keyword">new</span> JwtLoginFilter(<span class="hljs-string">&quot;/login&quot;</span>,authenticationManager()),UsernamePasswordAuthenticationFilter.class)                .addFilterBefore(<span class="hljs-keyword">new</span> JwtFilter(),UsernamePasswordAuthenticationFilter.class)                .csrf().disable();    &#125;&#125;</code></pre></div><ol><li>ç®€å•èµ·è§ï¼Œè¿™é‡Œæˆ‘å¹¶æœªå¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤é…ç½®äº†NoOpPasswordEncoderçš„å®ä¾‹ã€‚</li><li>ç®€å•èµ·è§ï¼Œè¿™é‡Œå¹¶æœªè¿æ¥æ•°æ®åº“ï¼Œæˆ‘ç›´æ¥åœ¨å†…å­˜ä¸­é…ç½®äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œä¸¤ä¸ªç”¨æˆ·å…·å¤‡ä¸åŒçš„è§’è‰²ã€‚</li><li>é…ç½®è·¯å¾„è§„åˆ™æ—¶ï¼Œ <code>/hello</code> æ¥å£å¿…é¡»è¦å…·å¤‡ user è§’è‰²æ‰èƒ½è®¿é—®ï¼Œ <code>/admin</code> æ¥å£å¿…é¡»è¦å…·å¤‡ admin è§’è‰²æ‰èƒ½è®¿é—®ï¼ŒPOST è¯·æ±‚å¹¶ä¸”æ˜¯ <code>/login</code> æ¥å£åˆ™å¯ä»¥ç›´æ¥é€šè¿‡ï¼Œå…¶ä»–æ¥å£å¿…é¡»è®¤è¯åæ‰èƒ½è®¿é—®ã€‚</li><li>æœ€åé…ç½®ä¸Šä¸¤ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨å¹¶ä¸”å…³é—­æ‰csrfä¿æŠ¤ã€‚</li></ol><h4 id="2-4-æµ‹è¯•"><a href="#2-4-æµ‹è¯•" class="headerlink" title="2.4 æµ‹è¯•"></a>2.4 æµ‹è¯•</h4><p>åšå®Œè¿™äº›ä¹‹åï¼Œæˆ‘ä»¬çš„ç¯å¢ƒå°±ç®—å®Œå…¨æ­å»ºèµ·æ¥äº†ï¼Œæ¥ä¸‹æ¥å¯åŠ¨é¡¹ç›®ç„¶ååœ¨ POSTMAN ä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-4.png" alt="img"></p><p>ç™»å½•æˆåŠŸåè¿”å›çš„å­—ç¬¦ä¸²å°±æ˜¯ç»è¿‡ base64url è½¬ç çš„tokenï¼Œä¸€å…±æœ‰ä¸‰éƒ¨åˆ†ï¼Œé€šè¿‡ä¸€ä¸ª <code>.</code> éš”å¼€ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç¬¬ä¸€ä¸ª <code>.</code> ä¹‹å‰çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ï¼Œå³Headerï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-5.png" alt="img"></p><p>å†å¯¹ä¸¤ä¸ª <code>.</code> ä¹‹é—´çš„å­—ç¬¦è§£ç ï¼Œå³ payloadï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-6.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è®¾ç½®ä¿¡æ¯ï¼Œç”±äºbase64å¹¶ä¸æ˜¯åŠ å¯†æ–¹æ¡ˆï¼Œåªæ˜¯ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼Œå› æ­¤ï¼Œä¸å»ºè®®å°†æ•æ„Ÿçš„ç”¨æˆ·ä¿¡æ¯æ”¾åˆ°tokenä¸­ã€‚</p><p>æ¥ä¸‹æ¥å†å»è®¿é—® <code>/hello</code> æ¥å£ï¼Œæ³¨æ„è®¤è¯æ–¹å¼é€‰æ‹© Bearer Tokenï¼ŒTokenå€¼ä¸ºåˆšåˆšè·å–åˆ°çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20-7.png" alt="img"></p><h2 id="5-åŒºåˆ«"><a href="#5-åŒºåˆ«" class="headerlink" title="5. åŒºåˆ«"></a>5. åŒºåˆ«</h2><h3 id="JWTå’ŒOAuth2"><a href="#JWTå’ŒOAuth2" class="headerlink" title="JWTå’ŒOAuth2"></a>JWTå’ŒOAuth2</h3><ul><li> oauth2æœ‰clientå’Œscopeçš„æ¦‚å¿µï¼Œjwtæ²¡æœ‰ã€‚å¦‚æœåªæ˜¯æ‹¿æ¥ç”¨äºé¢å¸ƒtokençš„è¯ï¼ŒäºŒè€…æ²¡åŒºåˆ«ã€‚å¸¸ç”¨çš„bearerç®—æ³•oauthã€jwtéƒ½å¯ä»¥ç”¨ã€‚åº”ç”¨åœºæ™¯ä¸åŒè€Œå·²  </li><li>Spring Cloud çš„æƒé™æ¡†æ¶å°±æ˜¯ç”¨çš„jwtå®ç°çš„oauth2 ã€‚äºŒè€…æ²¡æœ‰å¿…ç„¶è”ç³»  </li><li>TokenåŠŸèƒ½ä¸ä¸€æ ·ï¼ŒJWTçš„tokenæ˜¯åŒ…å«ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„ï¼Œç„¶åé€šè¿‡åŠ å¯†çš„æ–¹å¼ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨ç«¯æ‹¿åˆ°è¿™ä¸ªtokenä¹‹åä¸éœ€è¦å†å»æŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œè§£æå®Œtokenä¹‹åå°±èƒ½æ‹¿åˆ°ã€‚æƒ³æƒ³åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œç”¨æˆ·æœåŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ï¼Œä½†æ˜¯å…¶ä»–æœåŠ¡å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿä¼šéœ€è¦ç”¨æˆ·ä¿¡æ¯ï¼Œéš¾é“è¦æ¯æ¬¡ç”¨åˆ°éƒ½å»å–ä¸€æ¬¡å—ï¼Ÿ JWTéå¸¸é€‚åˆå¾®æœåŠ¡ã€‚  </li><li>OAuth2ç”¨åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•çš„æƒ…å†µ(æ¯”å¦‚ä½¿ç”¨weibo, qq, githubç™»å½•æŸä¸ªapp)ã€‚OAuth2æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„åè®®, æœ‰4ç§æˆæƒæ¨¡å¼, å…¶ä¸­çš„access codeæ¨¡å¼åœ¨å®ç°æ—¶å¯ä»¥ä½¿ç”¨jwtæ‰ç”Ÿæˆcode, ä¹Ÿå¯ä»¥ä¸ç”¨. å®ƒä»¬ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„è”ç³». </li><li>JWTæ˜¯ç”¨åœ¨å‰åç«¯åˆ†ç¦», éœ€è¦ç®€å•çš„å¯¹åå°APIè¿›è¡Œä¿æŠ¤æ—¶ä½¿ç”¨.(å‰åç«¯åˆ†ç¦»æ— session, é¢‘ç¹ä¼ ç”¨æˆ·å¯†ç ä¸å®‰å…¨)  </li><li>JWTæ˜¯ä¸€ç§è®¤è¯åè®® ã€‚JWTæä¾›äº†ä¸€ç§ç”¨äº**å‘å¸ƒæ¥å…¥ä»¤ç‰Œï¼ˆAccess Token),**å¹¶å¯¹å‘å¸ƒçš„ç­¾åæ¥å…¥ä»¤ç‰Œè¿›è¡ŒéªŒè¯çš„æ–¹æ³•ã€‚ ä»¤ç‰Œï¼ˆTokenï¼‰æœ¬èº«åŒ…å«äº†ä¸€ç³»åˆ—å£°æ˜ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è¿™äº›å£°æ˜é™åˆ¶ç”¨æˆ·å¯¹èµ„æºçš„è®¿é—®ã€‚  </li><li>OAuth2æ˜¯ä¸€ç§æˆæƒæ¡†æ¶ã€‚æä¾›äº†ä¸€å¥—è¯¦ç»†çš„æˆæƒæœºåˆ¶ï¼ˆæŒ‡å¯¼ï¼‰ã€‚ç”¨æˆ·æˆ–åº”ç”¨å¯ä»¥é€šè¿‡å…¬å¼€çš„æˆ–ç§æœ‰çš„è®¾ç½®ï¼Œæˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç‰¹å®šèµ„æºã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼ŒOauth2å’Œjwtæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç§ä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æˆæƒè®¤è¯çš„æ¡†æ¶ï¼Œå¦ä¸€ç§åˆ™æ˜¯è®¤è¯éªŒè¯çš„æ–¹å¼æ–¹æ³•ï¼ˆè½»é‡çº§æ¦‚å¿µï¼‰ã€‚OAuth2ä¸åƒJWTä¸€æ ·æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„æ ‡å‡†åè®®ï¼Œå› æ­¤åœ¨å®æ–½è¿‡ç¨‹ä¸­æ›´å®¹æ˜“å‡ºé”™ã€‚å°½ç®¡æœ‰å¾ˆå¤šç°æœ‰çš„åº“ï¼Œä½†æ˜¯æ¯ä¸ªåº“çš„æˆç†Ÿåº¦ä¹Ÿä¸å°½ç›¸åŒï¼ŒåŒæ ·å¾ˆå®¹æ˜“å¼•å…¥å„ç§é”™è¯¯ã€‚åœ¨å¸¸ç”¨çš„åº“ä¸­ä¹Ÿå¾ˆå®¹æ˜“å‘ç°ä¸€äº›å®‰å…¨æ¼æ´ã€‚</p><h3 id="OAuth2å’ŒShiro"><a href="#OAuth2å’ŒShiro" class="headerlink" title="OAuth2å’ŒShiro"></a>OAuth2å’ŒShiro</h3><p>ä¸€ã€æ€§è´¨ä¸åŒ</p><p>1ã€oauth2 ï¼šæ˜¯OAuthåè®®çš„å»¶ç»­ç‰ˆæœ¬ï¼Œä½†ä¸å‘å‰å…¼å®¹OAuth 2.0(å³å®Œå…¨åºŸæ­¢äº†OAuth1.0)ã€‚</p><p>2ã€shiroï¼šæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶ã€‚</p><p>äºŒã€è¯­è¨€ä¸åŒ</p><p>1ã€oauth2 ï¼šPHPã€JavaScriptï¼ŒJava</p><p>2ã€shiroï¼šJava</p><p>ä¸‰ã€ç”¨é€”ä¸åŒ</p><p>1ã€oauth2 ï¼šå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨ç”¨æˆ·è·å¾—è®¿é—®çš„æƒé™ã€‚</p><p>2ã€shiroï¼šæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚</p><h1 id="SpringBootä¸ä¸­é—´ä»¶"><a href="#SpringBootä¸ä¸­é—´ä»¶" class="headerlink" title="SpringBootä¸ä¸­é—´ä»¶"></a>SpringBootä¸ä¸­é—´ä»¶</h1><h2 id="1-WebSocket"><a href="#1-WebSocket" class="headerlink" title="1. WebSocket"></a>1. WebSocket</h2><h3 id="1-1-å¼•å…¥"><a href="#1-1-å¼•å…¥" class="headerlink" title="1.1 å¼•å…¥"></a>1.1 å¼•å…¥</h3><p>åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿå®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸º HTTP åè®®æœ‰ä¸€ä¸ªç¼ºé™·ï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³äº†è§£ä»Šå¤©çš„å¤©æ°”ï¼Œåªèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœã€‚HTTP åè®®åšä¸åˆ°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/bg2017051507.jpg" alt="img"></p><p>è¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨<a href="https://www.pubnub.com/blog/2014-12-01-http-long-polling/">â€œè½®è¯¢â€</a>ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯èŠå¤©å®¤ã€‚</p><p>è½®è¯¢çš„æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆå› ä¸ºå¿…é¡»ä¸åœè¿æ¥ï¼Œæˆ–è€… HTTP è¿æ¥å§‹ç»ˆæ‰“å¼€ï¼‰ã€‚å› æ­¤ï¼Œå·¥ç¨‹å¸ˆä»¬ä¸€ç›´åœ¨æ€è€ƒï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚WebSocket å°±æ˜¯è¿™æ ·å‘æ˜çš„ã€‚</p><p>WebSocket åè®®åœ¨2008å¹´è¯ç”Ÿï¼Œ2011å¹´æˆä¸ºå›½é™…æ ‡å‡†ã€‚æ‰€æœ‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒäº†ã€‚</p><p>å®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äº<a href="https://en.wikipedia.org/wiki/Push_technology">æœåŠ¡å™¨æ¨é€æŠ€æœ¯</a>çš„ä¸€ç§ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/bg2017051502.png" alt="img"></p><p>å…¶ä»–ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><p>ï¼ˆ1ï¼‰å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡å™¨ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“ã€‚</p><p>ï¼ˆ2ï¼‰ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯80å’Œ443ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§ HTTP ä»£ç†æœåŠ¡å™¨ã€‚</p><p>ï¼ˆ3ï¼‰æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆã€‚</p><p>ï¼ˆ4ï¼‰å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>ï¼ˆ5ï¼‰æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡ã€‚</p><p>ï¼ˆ6ï¼‰åè®®æ ‡è¯†ç¬¦æ˜¯<code>ws</code>ï¼ˆå¦‚æœåŠ å¯†ï¼Œåˆ™ä¸º<code>wss</code>ï¼‰ï¼ŒæœåŠ¡å™¨ç½‘å€å°±æ˜¯ URLã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">ws</span>:<span class="hljs-string">//example.com:80/some/path</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/bg2017051503.jpg" alt="img"></p><h3 id="1-2-æ•´åˆSpringBoot"><a href="#1-2-æ•´åˆSpringBoot" class="headerlink" title="1.2 æ•´åˆSpringBoot"></a>1.2 æ•´åˆSpringBoot</h3><h4 id="å®ç°ç¾¤èŠ"><a href="#å®ç°ç¾¤èŠ" class="headerlink" title="å®ç°ç¾¤èŠ"></a>å®ç°ç¾¤èŠ</h4><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å‰ç«¯åº“é›†æˆ--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sockjs-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å…¼å®¹æµè§ˆå™¨åè®®--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>stomp-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--jsæ–‡ä»¶çš„å®šä½å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webjars-locator-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String content;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getContent</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> content;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setContent</span><span class="hljs-params">(String content)</span> </span>&#123;        <span class="hljs-keyword">this</span>.content = content;    &#125;&#125;</code></pre></div><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebSocketMessageBroker</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketMessageBrokerConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry registry)</span> </span>&#123;        <span class="hljs-comment">//å¹¿æ’­å‰ç¼€</span>        registry.enableSimpleBroker(<span class="hljs-string">&quot;/topic&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> </span>&#123;        <span class="hljs-comment">//æ³¨å†Œç«¯ç‚¹ï¼Œå®šä¹‰å‰ç¼€ä¸ºchatçš„endpointå¹¶å¼€å¯sockjsçš„æ”¯æŒ</span>        registry.addEndpoint(<span class="hljs-string">&quot;/chat&quot;</span>).withSockJS();    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreetingController</span> </span>&#123;    <span class="hljs-meta">@MessageMapping(&quot;/hello&quot;)</span>    <span class="hljs-meta">@SendTo(&quot;/topic/greetings&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">greeting1</span><span class="hljs-params">(Message message)</span> </span>&#123;        <span class="hljs-keyword">return</span> message;    &#125;&#125;</code></pre></div><p><strong>å‰ç«¯é¡µé¢</strong></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç¾¤èŠ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/jquery/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/sockjs-client/sockjs.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/stomp-websocket/stomp.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>è¯·è¾“å…¥ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connect&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;è¿æ¥&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;disconnect&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&quot;disabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ–­å¼€è¿æ¥&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;chat&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>è¯·è¾“å…¥èŠå¤©å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;send&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;å‘é€&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversation&quot;</span>&gt;</span>ç¾¤èŠè¿›è¡Œä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#connect&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span>            connect();        &#125;)<span class="javascript">        $(<span class="hljs-string">&quot;#disconnect&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">            <span class="hljs-keyword">if</span> (stompClient != <span class="hljs-literal">null</span>) &#123;</span>                stompClient.disconnect();            &#125;<span class="javascript">            setConnected(<span class="hljs-literal">false</span>);</span>        &#125;)<span class="javascript">        $(<span class="hljs-string">&quot;#send&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">            stompClient.send(<span class="hljs-string">&#x27;/app/hello&#x27;</span>,&#123;&#125;,<span class="hljs-built_in">JSON</span>.stringify(&#123;<span class="hljs-string">&#x27;name&#x27;</span>:$(<span class="hljs-string">&quot;#name&quot;</span>).val(),<span class="hljs-string">&#x27;content&#x27;</span>:$(<span class="hljs-string">&quot;#content&quot;</span>).val()&#125;))</span>        &#125;)    &#125;)<span class="javascript">    <span class="hljs-keyword">var</span> stompClient = <span class="hljs-literal">null</span>;</span><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">&quot;#name&quot;</span>).val()) &#123;</span><span class="javascript">            <span class="hljs-keyword">return</span>;</span>        &#125;<span class="javascript">        <span class="hljs-keyword">var</span> socket = <span class="hljs-keyword">new</span> SockJS(<span class="hljs-string">&#x27;/chat&#x27;</span>);</span>        stompClient = Stomp.over(socket);<span class="javascript">        stompClient.connect(&#123;&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">success</span>) </span>&#123;</span><span class="javascript">            setConnected(<span class="hljs-literal">true</span>);</span><span class="javascript">            stompClient.subscribe(<span class="hljs-string">&#x27;/topic/greetings&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">                showGreeting(<span class="hljs-built_in">JSON</span>.parse(msg.body));</span>            &#125;);        &#125;)    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showGreeting</span>(<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#conversation&quot;</span>).append(<span class="hljs-string">&#x27;&lt;div&gt;&#x27;</span> + msg.name + <span class="hljs-string">&#x27;:&#x27;</span> + msg.content + <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span>);</span>    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setConnected</span>(<span class="hljs-params">flag</span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#connect&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>, flag);</span><span class="javascript">        $(<span class="hljs-string">&quot;#disconnect&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>, !flag);</span>        if (flag) &#123;<span class="javascript">            $(<span class="hljs-string">&quot;#chat&quot;</span>).show();</span><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">            $(<span class="hljs-string">&quot;#chat&quot;</span>).hide();</span>        &#125;    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h4 id="å®ç°å•èŠ"><a href="#å®ç°å•èŠ" class="headerlink" title="å®ç°å•èŠ"></a>å®ç°å•èŠ</h4><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å‰ç«¯åº“é›†æˆ--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sockjs-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å…¼å®¹æµè§ˆå™¨åè®®--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>stomp-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--jsæ–‡ä»¶çš„å®šä½å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webjars-locator-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String content;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getContent</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> content;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setContent</span><span class="hljs-params">(String content)</span> </span>&#123;        <span class="hljs-keyword">this</span>.content = content;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Chat</span> </span>&#123;    <span class="hljs-keyword">private</span> String from;    <span class="hljs-keyword">private</span> String content;    <span class="hljs-keyword">private</span> String to;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getFrom</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> from;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFrom</span><span class="hljs-params">(String from)</span> </span>&#123;        <span class="hljs-keyword">this</span>.from = from;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getContent</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> content;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setContent</span><span class="hljs-params">(String content)</span> </span>&#123;        <span class="hljs-keyword">this</span>.content = content;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> to;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTo</span><span class="hljs-params">(String to)</span> </span>&#123;        <span class="hljs-keyword">this</span>.to = to;    &#125;&#125;</code></pre></div><p><strong>Securityé…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        auth.inMemoryAuthentication()                .withUser(<span class="hljs-string">&quot;javaboy&quot;</span>)                .password(<span class="hljs-string">&quot;123&quot;</span>)                .roles(<span class="hljs-string">&quot;admin&quot;</span>)                .and()                .withUser(<span class="hljs-string">&quot;sang&quot;</span>)                .password(<span class="hljs-string">&quot;123&quot;</span>)                .roles(<span class="hljs-string">&quot;user&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.authorizeRequests()                .anyRequest().authenticated()                .and()                .formLogin().permitAll();    &#125;&#125;</code></pre></div><p><strong>socketé…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebSocketMessageBroker</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketMessageBrokerConfigurer</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry registry)</span> </span>&#123;        <span class="hljs-comment">//å¹¿æ’­å‰ç¼€</span>        registry.enableSimpleBroker(<span class="hljs-string">&quot;/topic&quot;</span>,<span class="hljs-string">&quot;/queue&quot;</span>);        registry.setApplicationDestinationPrefixes(<span class="hljs-string">&quot;/app&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> </span>&#123;        <span class="hljs-comment">//æ–°ç‰ˆSpringBootè¦å¼€å¯è¿æ¥åŸŸ</span>        registry.addEndpoint(<span class="hljs-string">&quot;/chat&quot;</span>).setAllowedOrigins(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>).withSockJS();    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreetingController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SimpMessagingTemplate simpMessagingTemplate;    <span class="hljs-meta">@MessageMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">greeting</span><span class="hljs-params">(Message message)</span> </span>&#123;        simpMessagingTemplate.convertAndSend(<span class="hljs-string">&quot;/topic/greetings&quot;</span>, message);    &#125;    <span class="hljs-meta">@MessageMapping(&quot;/chat&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">chat</span><span class="hljs-params">(Principal principal, Chat chat)</span> </span>&#123;        chat.setFrom(principal.getName());        simpMessagingTemplate.convertAndSendToUser(chat.getTo(), <span class="hljs-string">&quot;/queue/chat&quot;</span>, chat);    &#125;&#125;</code></pre></div><p><strong>å‰ç«¯é¡µé¢</strong></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç¾¤èŠ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/jquery/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/sockjs-client/sockjs.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/webjars/stomp-websocket/stomp.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connect&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;è¿æ¥&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;disconnect&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&quot;disabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ–­å¼€è¿æ¥&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>æ¶ˆæ¯å†…å®¹ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>ç›®æ ‡ç”¨æˆ·ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;to&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;å‘é€&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;send&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversation&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#connect&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span>            connect();        &#125;)<span class="javascript">        $(<span class="hljs-string">&quot;#disconnect&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">            <span class="hljs-keyword">if</span> (stompClient != <span class="hljs-literal">null</span>) &#123;</span>                stompClient.disconnect();            &#125;<span class="javascript">            setConnected(<span class="hljs-literal">false</span>);</span>        &#125;)<span class="javascript">        $(<span class="hljs-string">&quot;#send&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">            stompClient.send(<span class="hljs-string">&#x27;/app/chat&#x27;</span>, &#123;&#125;, <span class="hljs-built_in">JSON</span>.stringify(&#123;</span><span class="javascript">                <span class="hljs-string">&#x27;to&#x27;</span>: $(<span class="hljs-string">&quot;#to&quot;</span>).val(),</span><span class="javascript">                <span class="hljs-string">&#x27;content&#x27;</span>: $(<span class="hljs-string">&quot;#content&quot;</span>).val()</span>            &#125;))        &#125;)    &#125;)<span class="javascript">    <span class="hljs-keyword">var</span> stompClient = <span class="hljs-literal">null</span>;</span><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        <span class="hljs-keyword">var</span> socket = <span class="hljs-keyword">new</span> SockJS(<span class="hljs-string">&#x27;/chat&#x27;</span>);</span>        stompClient = Stomp.over(socket);<span class="javascript">        stompClient.connect(&#123;&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">success</span>) </span>&#123;</span><span class="javascript">            setConnected(<span class="hljs-literal">true</span>);</span><span class="javascript">            stompClient.subscribe(<span class="hljs-string">&#x27;/user/queue/chat&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">                showGreeting(<span class="hljs-built_in">JSON</span>.parse(msg.body));</span>            &#125;);        &#125;)    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showGreeting</span>(<span class="hljs-params">msg</span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#conversation&quot;</span>).append(<span class="hljs-string">&#x27;&lt;div&gt;&#x27;</span> + msg.from + <span class="hljs-string">&#x27;:&#x27;</span> + msg.content + <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span>);</span>    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setConnected</span>(<span class="hljs-params">flag</span>) </span>&#123;</span><span class="javascript">        $(<span class="hljs-string">&quot;#connect&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>, flag);</span><span class="javascript">        $(<span class="hljs-string">&quot;#disconnect&quot;</span>).prop(<span class="hljs-string">&quot;disabled&quot;</span>, !flag);</span>        if (flag) &#123;<span class="javascript">            $(<span class="hljs-string">&quot;#chat&quot;</span>).show();</span><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">            $(<span class="hljs-string">&quot;#chat&quot;</span>).hide();</span>        &#125;    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="2-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#2-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="2. æ¶ˆæ¯é˜Ÿåˆ—"></a>2. æ¶ˆæ¯é˜Ÿåˆ—</h2><h3 id="2-1-ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#2-1-ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>2.1 ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>è§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°</strong></p><p>(1)è§£è€¦</p><p>ä¼ ç»Ÿæ¨¡å¼:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3436b97edc32fbfdecda61aa1543e4c11603446712357.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«1"></p><p>ä¼ ç»Ÿæ¨¡å¼çš„ç¼ºç‚¹ï¼š</p><ul><li>ç³»ç»Ÿé—´è€¦åˆæ€§å¤ªå¼ºï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç³»ç»ŸAåœ¨ä»£ç ä¸­ç›´æ¥è°ƒç”¨ç³»ç»ŸBå’Œç³»ç»ŸCçš„ä»£ç ï¼Œå¦‚æœå°†æ¥Dç³»ç»Ÿæ¥å…¥ï¼Œç³»ç»ŸAè¿˜éœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿‡äºéº»çƒ¦ï¼</li></ul><p>ä¸­é—´ä»¶æ¨¡å¼:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/2c64f4b92100a42ad84a11bd5defbeb31603446712358.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«2"></p><p>ä¸­é—´ä»¶æ¨¡å¼çš„çš„ä¼˜ç‚¹ï¼š</p><ul><li>å°†æ¶ˆæ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéœ€è¦æ¶ˆæ¯çš„ç³»ç»Ÿè‡ªå·±ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è®¢é˜…ï¼Œä»è€Œç³»ç»ŸAä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ã€‚</li></ul><p>(2)å¼‚æ­¥</p><p>ä¼ ç»Ÿæ¨¡å¼:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/8c151f9dbfdf279ae55f37c683bc52b31603446712358.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«3"></p><p>ä¼ ç»Ÿæ¨¡å¼çš„ç¼ºç‚¹ï¼š</p><ul><li>ä¸€äº›éå¿…è¦çš„ä¸šåŠ¡é€»è¾‘ä»¥åŒæ­¥çš„æ–¹å¼è¿è¡Œï¼Œå¤ªè€—è´¹æ—¶é—´ã€‚</li></ul><p>ä¸­é—´ä»¶æ¨¡å¼:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/e13290419111dcb5c234f01693a376b81603446712358.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«4"></p><p>ä¸­é—´ä»¶æ¨¡å¼çš„çš„ä¼˜ç‚¹ï¼š</p><ul><li>å°†æ¶ˆæ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéå¿…è¦çš„ä¸šåŠ¡é€»è¾‘ä»¥å¼‚æ­¥çš„æ–¹å¼è¿è¡Œï¼ŒåŠ å¿«å“åº”é€Ÿåº¦</li></ul><p>(3)å‰Šå³°</p><p>ä¼ ç»Ÿæ¨¡å¼</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/ace4c2a7886db87fd0ae0e6ed11a99511603446712360.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«5"></p><p>ä¼ ç»Ÿæ¨¡å¼çš„ç¼ºç‚¹ï¼š</p><ul><li>å¹¶å‘é‡å¤§çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„è¯·æ±‚ç›´æ¥æ€¼åˆ°æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“è¿æ¥å¼‚å¸¸</li></ul><p>ä¸­é—´ä»¶æ¨¡å¼:</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/582691ee877b26dec97b30a3bf23ddf71603446712360.jpeg" alt="æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQã€RocketMQã€RabbitMQã€Kafkaä¸€äº›æ€»ç»“å’ŒåŒºåˆ«6"></p><p>ä¸­é—´ä»¶æ¨¡å¼çš„çš„ä¼˜ç‚¹ï¼š</p><ul><li>ç³»ç»ŸAæ…¢æ…¢çš„æŒ‰ç…§æ•°æ®åº“èƒ½å¤„ç†çš„å¹¶å‘é‡ï¼Œä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ…¢æ…¢æ‹‰å–æ¶ˆæ¯ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œè¿™ä¸ªçŸ­æš‚çš„é«˜å³°æœŸç§¯å‹æ˜¯å…è®¸çš„ã€‚</li></ul><h3 id="2-2-æ¶ˆæ¯é˜Ÿåˆ—çš„å¼Šç«¯"><a href="#2-2-æ¶ˆæ¯é˜Ÿåˆ—çš„å¼Šç«¯" class="headerlink" title="2.2 æ¶ˆæ¯é˜Ÿåˆ—çš„å¼Šç«¯"></a>2.2 æ¶ˆæ¯é˜Ÿåˆ—çš„å¼Šç«¯</h3><ul><li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½:æœ¬æ¥å…¶ä»–ç³»ç»Ÿåªè¦è¿è¡Œå¥½å¥½çš„ï¼Œé‚£ç³»ç»Ÿå°±æ˜¯æ­£å¸¸çš„ã€‚ç°åœ¨ä½ éè¦åŠ ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›å»ï¼Œé‚£æ¶ˆæ¯é˜Ÿåˆ—æŒ‚äº†ï¼Œä½ çš„ç³»ç»Ÿä¹Ÿä¼šæŒ‚ã€‚å› æ­¤ï¼Œç³»ç»Ÿå¯ç”¨æ€§é™ä½</li><li>ç³»ç»Ÿå¤æ‚æ€§å¢åŠ :è¦å¤šè€ƒè™‘å¾ˆå¤šæ–¹é¢çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸€è‡´æ€§é—®é¢˜ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Œå¦‚ä½•ä¿è¯ä¿è¯æ¶ˆæ¯å¯é ä¼ è¾“ã€‚å› æ­¤ï¼Œéœ€è¦è€ƒè™‘çš„ä¸œè¥¿æ›´å¤šï¼Œç³»ç»Ÿå¤æ‚æ€§å¢å¤§</li></ul><h3 id="2-3-å¦‚ä½•é€‰ç”¨"><a href="#2-3-å¦‚ä½•é€‰ç”¨" class="headerlink" title="2.3 å¦‚ä½•é€‰ç”¨"></a>2.3 å¦‚ä½•é€‰ç”¨</h3><table><thead><tr><th align="center">ç‰¹æ€§</th><th align="center">ActiveMQ</th><th align="center">RabbitMQ</th><th align="center">RocketMQ</th><th align="center">kafka</th></tr></thead><tbody><tr><td align="center">å¼€å‘è¯­è¨€</td><td align="center">java</td><td align="center">erlang</td><td align="center">java</td><td align="center">scala</td></tr><tr><td align="center">å•æœºååé‡</td><td align="center">ä¸‡çº§</td><td align="center">ä¸‡çº§</td><td align="center">10ä¸‡çº§</td><td align="center">10ä¸‡çº§</td></tr><tr><td align="center">æ—¶æ•ˆæ€§</td><td align="center">msçº§</td><td align="center">usçº§</td><td align="center">msçº§</td><td align="center">msçº§ä»¥å†…</td></tr><tr><td align="center">å¯ç”¨æ€§</td><td align="center">é«˜(ä¸»ä»æ¶æ„)</td><td align="center">é«˜(ä¸»ä»æ¶æ„)</td><td align="center">éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„)</td><td align="center">éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„)</td></tr><tr><td align="center">åŠŸèƒ½ç‰¹æ€§</td><td align="center">æˆç†Ÿçš„äº§å“ï¼Œåœ¨å¾ˆå¤šå…¬å¸å¾—åˆ°åº”ç”¨ï¼›æœ‰è¾ƒå¤šçš„æ–‡æ¡£ï¼›å„ç§åè®®æ”¯æŒè¾ƒå¥½</td><td align="center">åŸºäºerlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½;ç®¡ç†ç•Œé¢è¾ƒä¸°å¯Œ</td><td align="center">MQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ï¼Œæ‰©å±•æ€§ä½³</td><td align="center">åªæ”¯æŒä¸»è¦çš„MQåŠŸèƒ½ï¼Œåƒä¸€äº›æ¶ˆæ¯æŸ¥è¯¢ï¼Œæ¶ˆæ¯å›æº¯ç­‰åŠŸèƒ½æ²¡æœ‰æä¾›ï¼Œæ¯•ç«Ÿæ˜¯ä¸ºå¤§æ•°æ®å‡†å¤‡çš„ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸåº”ç”¨å¹¿ã€‚</td></tr></tbody></table><p>(1)ä¸­å°å‹è½¯ä»¶å…¬å¸ï¼Œå»ºè®®é€‰RabbitMQ.ä¸€æ–¹é¢ï¼Œerlangè¯­è¨€å¤©ç”Ÿå…·å¤‡é«˜å¹¶å‘çš„ç‰¹æ€§ï¼Œè€Œä¸”ä»–çš„ç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ã€‚æ­£æ‰€è°“ï¼Œæˆä¹Ÿè§ä½•ï¼Œè´¥ä¹Ÿè§ä½•ï¼ä»–çš„å¼Šç«¯ä¹Ÿåœ¨è¿™é‡Œï¼Œè™½ç„¶RabbitMQæ˜¯å¼€æºçš„ï¼Œç„¶è€Œå›½å†…æœ‰å‡ ä¸ªèƒ½å®šåˆ¶åŒ–å¼€å‘erlangçš„ç¨‹åºå‘˜å‘¢ï¼Ÿæ‰€å¹¸ï¼ŒRabbitMQçš„ç¤¾åŒºååˆ†æ´»è·ƒï¼Œå¯ä»¥è§£å†³å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„bugï¼Œè¿™ç‚¹å¯¹äºä¸­å°å‹å…¬å¸æ¥è¯´ååˆ†é‡è¦ã€‚ä¸è€ƒè™‘rocketmqå’Œkafkaçš„åŸå› æ˜¯ï¼Œä¸€æ–¹é¢ä¸­å°å‹è½¯ä»¶å…¬å¸ä¸å¦‚äº’è”ç½‘å…¬å¸ï¼Œæ•°æ®é‡æ²¡é‚£ä¹ˆå¤§ï¼Œé€‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåº”é¦–é€‰åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ï¼Œæ‰€ä»¥kafkaæ’é™¤ã€‚ä¸è€ƒè™‘rocketmqçš„åŸå› æ˜¯ï¼Œrocketmqæ˜¯é˜¿é‡Œå‡ºå“ï¼Œå¦‚æœé˜¿é‡Œæ”¾å¼ƒç»´æŠ¤rocketmqï¼Œä¸­å°å‹å…¬å¸ä¸€èˆ¬æŠ½ä¸å‡ºäººæ¥è¿›è¡Œrocketmqçš„å®šåˆ¶åŒ–å¼€å‘ï¼Œå› æ­¤ä¸æ¨èã€‚</p><p>(2)å¤§å‹è½¯ä»¶å…¬å¸ï¼Œæ ¹æ®å…·ä½“ä½¿ç”¨åœ¨rocketMqå’Œkafkaä¹‹é—´äºŒé€‰ä¸€ã€‚ä¸€æ–¹é¢ï¼Œå¤§å‹è½¯ä»¶å…¬å¸ï¼Œå…·å¤‡è¶³å¤Ÿçš„èµ„é‡‘æ­å»ºåˆ†å¸ƒå¼ç¯å¢ƒï¼Œä¹Ÿå…·å¤‡è¶³å¤Ÿå¤§çš„æ•°æ®é‡ã€‚é’ˆå¯¹rocketMQ,å¤§å‹è½¯ä»¶å…¬å¸ä¹Ÿå¯ä»¥æŠ½å‡ºäººæ‰‹å¯¹rocketMQè¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ï¼Œæ¯•ç«Ÿå›½å†…æœ‰èƒ½åŠ›æ”¹JAVAæºç çš„äººï¼Œè¿˜æ˜¯ç›¸å½“å¤šçš„ã€‚è‡³äºkafkaï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©ï¼Œå¦‚æœæœ‰æ—¥å¿—é‡‡é›†åŠŸèƒ½ï¼Œè‚¯å®šæ˜¯é¦–é€‰kafkaäº†ã€‚å…·ä½“è¯¥é€‰å“ªä¸ªï¼Œçœ‹ä½¿ç”¨åœºæ™¯ã€‚</p><h3 id="2-4-ä¿è¯æ˜¯é«˜å¯ç”¨"><a href="#2-4-ä¿è¯æ˜¯é«˜å¯ç”¨" class="headerlink" title="2.4 ä¿è¯æ˜¯é«˜å¯ç”¨"></a>2.4 ä¿è¯æ˜¯é«˜å¯ç”¨</h3><p>ä»¥rcoketMQä¸ºä¾‹ï¼Œä»–çš„é›†ç¾¤å°±æœ‰å¤šmaster æ¨¡å¼ã€å¤šmasterå¤šslaveå¼‚æ­¥å¤åˆ¶æ¨¡å¼ã€å¤š masterå¤šslaveåŒæ­¥åŒå†™æ¨¡å¼ã€‚å¤šmasterå¤šslaveæ¨¡å¼éƒ¨ç½²æ¶æ„å›¾<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/o_rocketcluster.png" alt="image"><br>ç±»ä¼¼äºkafkaï¼Œåªæ˜¯NameServeré›†ç¾¤ï¼Œåœ¨kafkaä¸­æ˜¯ç”¨zookeeperä»£æ›¿ï¼Œéƒ½æ˜¯ç”¨æ¥ä¿å­˜å’Œå‘ç°masterå’Œslaveç”¨çš„ã€‚é€šä¿¡è¿‡ç¨‹å¦‚ä¸‹:<br>Producer ä¸ NameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©)å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer è·å– Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Broker Master å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Broker å‘é€å¿ƒè·³ã€‚Producer åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ° Broker masterï¼Œä½†æ˜¯ Consumer åˆ™ä¸ä¸€æ ·ï¼Œå®ƒåŒæ—¶å’Œæä¾› Topic æœåŠ¡çš„ Master å’Œ Slaveå»ºç«‹é•¿è¿æ¥ï¼Œæ—¢å¯ä»¥ä» Broker Master è®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä» Broker Slave è®¢é˜…æ¶ˆæ¯ã€‚</p><h3 id="2-5-ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹"><a href="#2-5-ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹" class="headerlink" title="2.5 ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹"></a>2.5 ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</h3><p>åˆ†æ:è¿™ä¸ªé—®é¢˜å…¶å®æ¢ä¸€ç§é—®æ³•å°±æ˜¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„å¹‚ç­‰æ€§?è¿™ä¸ªé—®é¢˜å¯ä»¥è®¤ä¸ºæ˜¯æ¶ˆæ¯é˜Ÿåˆ—é¢†åŸŸçš„åŸºæœ¬é—®é¢˜ã€‚æ¢å¥è¯æ¥è¯´ï¼Œæ˜¯åœ¨è€ƒå¯Ÿä½ çš„è®¾è®¡èƒ½åŠ›ï¼Œè¿™ä¸ªé—®é¢˜çš„å›ç­”å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥ç­”ï¼Œæ²¡æœ‰å›ºå®šçš„ç­”æ¡ˆã€‚<br><strong>å›ç­”:å…ˆæ¥è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šé€ æˆé‡å¤æ¶ˆè´¹?</strong><br>å…¶å®æ— è®ºæ˜¯é‚£ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€ æˆé‡å¤æ¶ˆè´¹åŸå› å…¶å®éƒ½æ˜¯ç±»ä¼¼çš„ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶å€™ï¼Œæ¶ˆè´¹å®Œæ¯•åï¼Œä¼šå‘é€ä¸€ä¸ªç¡®è®¤ä¿¡æ¯ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å°±çŸ¥é“è¯¥æ¶ˆæ¯è¢«æ¶ˆè´¹äº†ï¼Œå°±ä¼šå°†è¯¥æ¶ˆæ¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚åªæ˜¯ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—å‘é€çš„ç¡®è®¤ä¿¡æ¯å½¢å¼ä¸åŒ,ä¾‹å¦‚RabbitMQæ˜¯å‘é€ä¸€ä¸ªACKç¡®è®¤æ¶ˆæ¯ï¼ŒRocketMQæ˜¯è¿”å›ä¸€ä¸ªCONSUME_SUCCESSæˆåŠŸæ ‡å¿—ï¼Œkafkaå®é™…ä¸Šæœ‰ä¸ªoffsetçš„æ¦‚å¿µï¼Œç®€å•è¯´ä¸€ä¸‹(å¦‚æœè¿˜ä¸æ‡‚ï¼Œå‡ºé—¨æ‰¾ä¸€ä¸ªkafkaå…¥é—¨åˆ°ç²¾é€šæ•™ç¨‹),å°±æ˜¯æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªoffsetï¼Œkafkaæ¶ˆè´¹è¿‡æ¶ˆæ¯åï¼Œéœ€è¦æäº¤offsetï¼Œè®©æ¶ˆæ¯é˜Ÿåˆ—çŸ¥é“è‡ªå·±å·²ç»æ¶ˆè´¹è¿‡äº†ã€‚é‚£é€ æˆé‡å¤æ¶ˆè´¹çš„åŸå› ?ï¼Œå°±æ˜¯å› ä¸ºç½‘ç»œä¼ è¾“ç­‰ç­‰æ•…éšœï¼Œç¡®è®¤ä¿¡æ¯æ²¡æœ‰ä¼ é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯¼è‡´æ¶ˆæ¯é˜Ÿåˆ—ä¸çŸ¥é“è‡ªå·±å·²ç»æ¶ˆè´¹è¿‡è¯¥æ¶ˆæ¯äº†ï¼Œå†æ¬¡å°†è¯¥æ¶ˆæ¯åˆ†å‘ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ã€‚<br>â€ƒ<strong>å¦‚ä½•è§£å†³?è¿™ä¸ªé—®é¢˜é’ˆå¯¹ä¸šåŠ¡åœºæ™¯æ¥ç­”åˆ†ä»¥ä¸‹å‡ ç‚¹</strong><br>â€ƒâ€ƒ(1)æ¯”å¦‚ï¼Œä½ æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯åšæ•°æ®åº“çš„insertæ“ä½œã€‚é‚£å°±å®¹æ˜“äº†ï¼Œç»™è¿™ä¸ªæ¶ˆæ¯åšä¸€ä¸ªå”¯ä¸€ä¸»é”®ï¼Œé‚£ä¹ˆå°±ç®—å‡ºç°é‡å¤æ¶ˆè´¹çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´ä¸»é”®å†²çªï¼Œé¿å…æ•°æ®åº“å‡ºç°è„æ•°æ®ã€‚<br>â€ƒâ€ƒ(2)å†æ¯”å¦‚ï¼Œä½ æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯åšredisçš„setçš„æ“ä½œï¼Œé‚£å°±å®¹æ˜“äº†ï¼Œä¸ç”¨è§£å†³ï¼Œå› ä¸ºä½ æ— è®ºsetå‡ æ¬¡ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œsetæ“ä½œæœ¬æ¥å°±ç®—å¹‚ç­‰æ“ä½œã€‚<br>â€ƒâ€ƒ(3)å¦‚æœä¸Šé¢ä¸¤ç§æƒ…å†µè¿˜ä¸è¡Œï¼Œä¸Šå¤§æ‹›ã€‚å‡†å¤‡ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»‹è´¨,æ¥åšæ¶ˆè´¹è®°å½•ã€‚ä»¥redisä¸ºä¾‹ï¼Œç»™æ¶ˆæ¯åˆ†é…ä¸€ä¸ªå…¨å±€idï¼Œåªè¦æ¶ˆè´¹è¿‡è¯¥æ¶ˆæ¯ï¼Œå°†&lt;id,message&gt;ä»¥K-Vå½¢å¼å†™å…¥redisã€‚é‚£æ¶ˆè´¹è€…å¼€å§‹æ¶ˆè´¹å‰ï¼Œå…ˆå»redisä¸­æŸ¥è¯¢æœ‰æ²¡æ¶ˆè´¹è®°å½•å³å¯ã€‚</p><h3 id="2-6-æ¶ˆè´¹çš„å¯é æ€§ä¼ è¾“"><a href="#2-6-æ¶ˆè´¹çš„å¯é æ€§ä¼ è¾“" class="headerlink" title="2.6 æ¶ˆè´¹çš„å¯é æ€§ä¼ è¾“"></a>2.6 æ¶ˆè´¹çš„å¯é æ€§ä¼ è¾“</h3><p>åˆ†æ:æˆ‘ä»¬åœ¨ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥åšåˆ°æ¶ˆæ¯ä¸èƒ½å¤šæ¶ˆè´¹ï¼Œä¹Ÿä¸èƒ½å°‘æ¶ˆè´¹ã€‚å¦‚æœæ— æ³•åšåˆ°å¯é æ€§ä¼ è¾“ï¼Œå¯èƒ½ç»™å…¬å¸å¸¦æ¥åƒä¸‡çº§åˆ«çš„è´¢äº§æŸå¤±ã€‚</p><p>å›ç­”:å…¶å®è¿™ä¸ªå¯é æ€§ä¼ è¾“ï¼Œæ¯ç§MQéƒ½è¦ä»ä¸‰ä¸ªè§’åº¦æ¥åˆ†æ:ç”Ÿäº§è€…å¼„ä¸¢æ•°æ®ã€æ¶ˆæ¯é˜Ÿåˆ—å¼„ä¸¢æ•°æ®ã€æ¶ˆè´¹è€…å¼„ä¸¢æ•°æ®</p><p><strong>ä»¥RabbitMQä¸ºä¾‹</strong></p><p>(1)ç”Ÿäº§è€…ä¸¢æ•°æ®<br>ä»ç”Ÿäº§è€…å¼„ä¸¢æ•°æ®è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼ŒRabbitMQæä¾›transactionå’Œconfirmæ¨¡å¼æ¥ç¡®ä¿ç”Ÿäº§è€…ä¸ä¸¢æ¶ˆæ¯ã€‚</p><p>transactionæœºåˆ¶å°±æ˜¯è¯´ï¼Œå‘é€æ¶ˆæ¯å‰ï¼Œå¼€å¯äº‹ç‰©(channel.txSelect())ï¼Œç„¶åå‘é€æ¶ˆæ¯ï¼Œå¦‚æœå‘é€è¿‡ç¨‹ä¸­å‡ºç°ä»€ä¹ˆå¼‚å¸¸ï¼Œäº‹ç‰©å°±ä¼šå›æ»š(channel.txRollback())ï¼Œå¦‚æœå‘é€æˆåŠŸåˆ™æäº¤äº‹ç‰©(channel.txCommit())ã€‚</p><p>ç„¶è€Œç¼ºç‚¹å°±æ˜¯ååé‡ä¸‹é™äº†ã€‚å› æ­¤ï¼ŒæŒ‰ç…§åšä¸»çš„ç»éªŒï¼Œç”Ÿäº§ä¸Šç”¨confirmæ¨¡å¼çš„å±…å¤šã€‚ä¸€æ—¦channelè¿›å…¥confirmæ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ID(ä»1å¼€å§‹)ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼ŒrabbitMQå°±ä¼šå‘é€ä¸€ä¸ªAckç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†.å¦‚æœrabiitMQæ²¡èƒ½å¤„ç†è¯¥æ¶ˆæ¯ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªNackæ¶ˆæ¯ç»™ä½ ï¼Œä½ å¯ä»¥è¿›è¡Œé‡è¯•æ“ä½œ</p><p>(2)æ¶ˆæ¯é˜Ÿåˆ—ä¸¢æ•°æ®</p><p>å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸¢æ•°æ®çš„æƒ…å†µï¼Œä¸€èˆ¬æ˜¯å¼€å¯æŒä¹…åŒ–ç£ç›˜çš„é…ç½®ã€‚è¿™ä¸ªæŒä¹…åŒ–é…ç½®å¯ä»¥å’Œconfirmæœºåˆ¶é…åˆä½¿ç”¨ï¼Œä½ å¯ä»¥åœ¨æ¶ˆæ¯æŒä¹…åŒ–ç£ç›˜åï¼Œå†ç»™ç”Ÿäº§è€…å‘é€ä¸€ä¸ªAckä¿¡å·ã€‚è¿™æ ·ï¼Œå¦‚æœæ¶ˆæ¯æŒä¹…åŒ–ç£ç›˜ä¹‹å‰ï¼ŒrabbitMQé˜µäº¡äº†ï¼Œé‚£ä¹ˆç”Ÿäº§è€…æ”¶ä¸åˆ°Ackä¿¡å·ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨é‡å‘ã€‚<br>é‚£ä¹ˆå¦‚ä½•æŒä¹…åŒ–å‘¢ï¼Œè¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹å§ï¼Œå…¶å®ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå°±ä¸‹é¢ä¸¤æ­¥</p><ul><li><p>å°†queueçš„æŒä¹…åŒ–æ ‡è¯†durableè®¾ç½®ä¸ºtrue,åˆ™ä»£è¡¨æ˜¯ä¸€ä¸ªæŒä¹…çš„é˜Ÿåˆ—</p></li><li><p>å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†deliveryMode=2</p><p>è¿™æ ·è®¾ç½®ä»¥åï¼ŒrabbitMQå°±ç®—æŒ‚äº†ï¼Œé‡å¯åä¹Ÿèƒ½æ¢å¤æ•°æ®</p></li></ul><p>(3)æ¶ˆè´¹è€…ä¸¢æ•°æ®</p><p>æ¶ˆè´¹è€…ä¸¢æ•°æ®ä¸€èˆ¬æ˜¯å› ä¸ºé‡‡ç”¨äº†è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ä¿¡æ¯ã€‚è¿™æ—¶rahbitMQä¼šç«‹å³å°†æ¶ˆæ¯åˆ é™¤ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœæ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸è€Œæ²¡èƒ½å¤„ç†è¯¥æ¶ˆæ¯ï¼Œå°±ä¼šä¸¢å¤±è¯¥æ¶ˆæ¯ã€‚<br>è‡³äºè§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯å³å¯ã€‚</p><h3 id="2-7-ä¿è¯æ¶ˆæ¯é¡ºåºæ€§"><a href="#2-7-ä¿è¯æ¶ˆæ¯é¡ºåºæ€§" class="headerlink" title="2.7 ä¿è¯æ¶ˆæ¯é¡ºåºæ€§"></a>2.7 ä¿è¯æ¶ˆæ¯é¡ºåºæ€§</h3><p>å›ç­”:é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡æŸç§ç®—æ³•ï¼Œå°†éœ€è¦ä¿æŒå…ˆåé¡ºåºçš„æ¶ˆæ¯æ”¾åˆ°åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­(kafkaä¸­å°±æ˜¯partition,rabbitMqä¸­å°±æ˜¯queue)ã€‚ç„¶ååªç”¨ä¸€ä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹è¯¥é˜Ÿåˆ—ã€‚</p><p>æœ‰çš„äººä¼šé—®:é‚£å¦‚æœä¸ºäº†ååé‡ï¼Œæœ‰å¤šä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹æ€ä¹ˆåŠï¼Ÿ<br>è¿™ä¸ªé—®é¢˜ï¼Œæ²¡æœ‰å›ºå®šå›ç­”çš„å¥—è·¯ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾®åšçš„æ“ä½œï¼Œå‘å¾®åšã€å†™è¯„è®ºã€åˆ é™¤å¾®åšï¼Œè¿™ä¸‰ä¸ªå¼‚æ­¥æ“ä½œã€‚å¦‚æœæ˜¯è¿™æ ·ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œé‚£åªè¦é‡è¯•å°±è¡Œã€‚æ¯”å¦‚ä½ ä¸€ä¸ªæ¶ˆè´¹è€…å…ˆæ‰§è¡Œäº†å†™è¯„è®ºçš„æ“ä½œï¼Œä½†æ˜¯è¿™æ—¶å€™ï¼Œå¾®åšéƒ½è¿˜æ²¡å‘ï¼Œå†™è¯„è®ºä¸€å®šæ˜¯å¤±è´¥çš„ï¼Œç­‰ä¸€æ®µæ—¶é—´ã€‚ç­‰å¦ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå…ˆæ‰§è¡Œå†™è¯„è®ºçš„æ“ä½œåï¼Œå†æ‰§è¡Œï¼Œå°±å¯ä»¥æˆåŠŸã€‚</p><p>æ€»ä¹‹ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘çš„è§‚ç‚¹æ˜¯ä¿è¯å…¥é˜Ÿæœ‰åºå°±è¡Œï¼Œå‡ºé˜Ÿä»¥åçš„é¡ºåºäº¤ç»™æ¶ˆè´¹è€…è‡ªå·±å»ä¿è¯ï¼Œæ²¡æœ‰å›ºå®šå¥—è·¯ã€‚</p><h2 id="3-ActiveMQ"><a href="#3-ActiveMQ" class="headerlink" title="3. ActiveMQ"></a>3. ActiveMQ</h2><h3 id="3-1-å®‰è£…"><a href="#3-1-å®‰è£…" class="headerlink" title="3.1 å®‰è£…"></a>3.1 å®‰è£…</h3><p>ä¸‹è½½æœ€æ–°çš„å‹ç¼©åŒ…</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526113352279.png" alt="image-20210526113352279"></p><p>ä¸‹è½½å®Œæˆååœ¨binç›®å½•ä¸‹æ‰§è¡Œ<code>./activemq start</code>å³å¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526113812627.png" alt="image-20210526113812627"></p><p>è´¦å·å¯†ç éƒ½æ˜¯admin</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526113848366.png" alt="image-20210526113848366"></p><h3 id="3-2-æ•´åˆåˆ°SpringBoot"><a href="#3-2-æ•´åˆåˆ°SpringBoot" class="headerlink" title="3.2 æ•´åˆåˆ°SpringBoot"></a>3.2 æ•´åˆåˆ°SpringBoot</h3><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.activemq.broker-url</span>=<span class="hljs-string">tcp://127.0.0.1:61616</span><span class="hljs-meta">spring.activemq.packages.trust-all</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.activemq.user</span>=<span class="hljs-string">adminx</span><span class="hljs-meta">spring.activemq.password</span>=<span class="hljs-string">admin</span></code></pre></div><p><strong>å¯åŠ¨ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivemqApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ActivemqApplication.class, args);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActiveMQQueue(<span class="hljs-string">&quot;hello.javaboy&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>å®ä½“ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> String content;    <span class="hljs-keyword">private</span> Date sendDate;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getContent</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> content;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Message&#123;&quot;</span> +                <span class="hljs-string">&quot;content=&#x27;&quot;</span> + content + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, sendDate=&quot;</span> + sendDate +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setContent</span><span class="hljs-params">(String content)</span> </span>&#123;        <span class="hljs-keyword">this</span>.content = content;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getSendDate</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> sendDate;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSendDate</span><span class="hljs-params">(Date sendDate)</span> </span>&#123;        <span class="hljs-keyword">this</span>.sendDate = sendDate;    &#125;&#125;</code></pre></div><p><strong>é…ç½®ç»„ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JmsComponent</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    JmsMessagingTemplate jmsMessagingTemplate;    <span class="hljs-meta">@Autowired</span>    Queue queue;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">(Message message)</span> </span>&#123;        jmsMessagingTemplate.convertAndSend(<span class="hljs-keyword">this</span>.queue, message);    &#125;    <span class="hljs-meta">@JmsListener(destination = &quot;hello.javaboy&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive</span><span class="hljs-params">(Message msg)</span> </span>&#123;        System.out.println(msg);    &#125;&#125;</code></pre></div><h2 id="4-RabbitMQ"><a href="#4-RabbitMQ" class="headerlink" title="4. RabbitMQ"></a>4. RabbitMQ</h2><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h3><p>å®‰è£…å‚è€ƒLinuxä¸­çš„æ•™ç¨‹</p><h3 id="2-æ•´åˆåˆ°SpringBoot-1"><a href="#2-æ•´åˆåˆ°SpringBoot-1" class="headerlink" title="2.æ•´åˆåˆ°SpringBoot"></a>2.æ•´åˆåˆ°SpringBoot</h3><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.rabbitmq.host</span>=<span class="hljs-string">192.168.66.131</span><span class="hljs-meta">spring.rabbitmq.username</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.password</span>=<span class="hljs-string">guest</span><span class="hljs-meta">spring.rabbitmq.port</span>=<span class="hljs-string">32771</span></code></pre></div><p>RabbitMQ æœ‰å››ç§äº¤æ¢æœºæ¨¡å¼ï¼š</p><ul><li>Direct Pattern ï¼ˆæ­¤æ¨¡å¼ä¸éœ€è¦é…ç½®äº¤æ¢æœºï¼‰</li><li>Fanout Pattern ( ç±»ä¼¼äºå¹¿æ’­ä¸€æ ·ï¼Œå°†æ¶ˆæ¯å‘é€ç»™å’Œä»–ç»‘å®šçš„é˜Ÿåˆ— )</li><li>Topic Pattern ( ç»‘å®šäº¤æ¢æœºæ—¶å¯ä»¥åšåŒ¹é…ã€‚ #ï¼šè¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚*ï¼šè¡¨ç¤ºä¸€ä¸ªå•è¯ )</li><li>Header Pattern ( å¸¦æœ‰å‚æ•°çš„åŒ¹é…è§„åˆ™ )</li></ul><h4 id="2-1-Directæ¨¡å¼"><a href="#2-1-Directæ¨¡å¼" class="headerlink" title="2.1 Directæ¨¡å¼"></a>2.1 Directæ¨¡å¼</h4><p>ç›´è¿äº¤æ¢æœºæ˜¯ä¸€ç§å¸¦è·¯ç”±åŠŸèƒ½çš„äº¤æ¢æœºï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¼šå’Œä¸€ä¸ªäº¤æ¢æœºç»‘å®šï¼Œé™¤æ­¤ä¹‹å¤–å†ç»‘å®šä¸€ä¸ª<code>routing_key</code>ï¼Œå½“æ¶ˆæ¯è¢«å‘é€çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ª<code>binding_key</code>ï¼Œè¿™ä¸ªæ¶ˆæ¯è¢«é€è¾¾äº¤æ¢æœºçš„æ—¶å€™ï¼Œå°±ä¼šè¢«è¿™ä¸ªäº¤æ¢æœºé€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—é‡Œé¢å»ã€‚åŒæ ·çš„ä¸€ä¸ª<code>binding_key</code>ä¹Ÿæ˜¯æ”¯æŒåº”ç”¨åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­çš„ã€‚è¿™æ ·å½“ä¸€ä¸ªäº¤æ¢æœºç»‘å®šå¤šä¸ªé˜Ÿåˆ—ï¼Œå°±ä¼šè¢«é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—å»å¤„ç†ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/1479657-3f2eff8920707c97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200" alt="img"></p><p>é€‚ç”¨åœºæ™¯ï¼šæœ‰ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æŠŠæ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ï¼Œè¿™æ ·å¯ä»¥æŒ‡æ´¾æ›´å¤šçš„èµ„æºå»å¤„ç†é«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ã€‚</p><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitDirectConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String DIRECTNAME = <span class="hljs-string">&quot;javaboy-direct&quot;</span>;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;hello.javaboy&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">DirectExchange <span class="hljs-title">directExchange</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectExchange(DIRECTNAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">binding</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue()).to(directExchange()).with(<span class="hljs-string">&quot;direct&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>æ¥æ”¶æœº</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DirectReceiver</span> </span>&#123;    <span class="hljs-meta">@RabbitListener(queues = &quot;hello.javaboy&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler1</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;handler1&gt;&gt;&gt;&quot;</span>+msg);    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><span class="hljs-meta">@SpringBootTest</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqApplicationTests</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RabbitTemplate rabbitTemplate;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;        rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;hello.javaboy&quot;</span>, <span class="hljs-string">&quot;hello javaboy!hahaha&quot;</span>);    &#125;&#125;</code></pre></div><h4 id="2-2-Fanoutæ¨¡å¼"><a href="#2-2-Fanoutæ¨¡å¼" class="headerlink" title="2.2 Fanoutæ¨¡å¼"></a>2.2 Fanoutæ¨¡å¼</h4><p>æ‰‡å½¢äº¤æ¢æœºæ˜¯æœ€åŸºæœ¬çš„äº¤æ¢æœºç±»å‹ï¼Œå®ƒæ‰€èƒ½åšçš„äº‹æƒ…éå¸¸ç®€å•â€”â€”â€”å¹¿æ’­æ¶ˆæ¯ã€‚æ‰‡å½¢äº¤æ¢æœºä¼šæŠŠèƒ½æ¥æ”¶åˆ°çš„æ¶ˆæ¯å…¨éƒ¨å‘é€ç»™ç»‘å®šåœ¨è‡ªå·±èº«ä¸Šçš„é˜Ÿåˆ—ã€‚å› ä¸ºå¹¿æ’­ä¸éœ€è¦â€œæ€è€ƒâ€ï¼Œæ‰€ä»¥æ‰‡å½¢äº¤æ¢æœºå¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ä¹Ÿæ˜¯æ‰€æœ‰çš„äº¤æ¢æœºç±»å‹é‡Œé¢æœ€å¿«çš„ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/1200.png" alt="img"></p><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitFanoutConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FANOUTNAME = <span class="hljs-string">&quot;javaboy-fanout&quot;</span>;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queueOne</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;queue-one&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queueTwo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;queue-two&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">FanoutExchange <span class="hljs-title">fanoutExchange</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FanoutExchange(FANOUTNAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">bindingOne</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueOne()).to(fanoutExchange());    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">bindingTwo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueTwo()).to(fanoutExchange());    &#125;&#125;</code></pre></div><p><strong>æ¥æ”¶æœº</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FanoutReceiver</span> </span>&#123;    <span class="hljs-meta">@RabbitListener(queues = &quot;queue-one&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler1</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;FanoutReceiver:handler1:&quot;</span> + msg);    &#125;    <span class="hljs-meta">@RabbitListener(queues = &quot;queue-two&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler2</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;FanoutReceiver:handler2:&quot;</span> + msg);    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;    rabbitTemplate.convertAndSend(RabbitFanoutConfig.FANOUTNAME,<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;hello fanout!&quot;</span>);&#125;</code></pre></div><h4 id="2-3-Topicæ¨¡å¼"><a href="#2-3-Topicæ¨¡å¼" class="headerlink" title="2.3 Topicæ¨¡å¼"></a>2.3 Topicæ¨¡å¼</h4><p>ç›´è¿äº¤æ¢æœºçš„<code>routing_key</code>æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€æ¡æ¶ˆæ¯å‘é€ç»™å¤šä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ¢æœºéœ€è¦ç»‘å®šä¸Šéå¸¸å¤šçš„<code>routing_key</code>ï¼Œå‡è®¾æ¯ä¸ªäº¤æ¢æœºä¸Šéƒ½ç»‘å®šä¸€å †çš„<code>routing_key</code>è¿æ¥åˆ°å„ä¸ªé˜Ÿåˆ—ä¸Šã€‚é‚£ä¹ˆæ¶ˆæ¯çš„ç®¡ç†å°±ä¼šå¼‚å¸¸åœ°å›°éš¾ã€‚</p><p>æ‰€ä»¥<code>RabbitMQ</code>æä¾›äº†ä¸€ç§ä¸»é¢˜äº¤æ¢æœºï¼Œå‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºä¸Šçš„æ¶ˆæ¯éœ€è¦æºå¸¦æŒ‡å®šè§„åˆ™çš„<code>routing_key</code>ï¼Œä¸»é¢˜äº¤æ¢æœºä¼šæ ¹æ®è¿™ä¸ªè§„åˆ™å°†æ•°æ®å‘é€åˆ°å¯¹åº”çš„(å¤šä¸ª)é˜Ÿåˆ—ä¸Šã€‚</p><p>ä¸»é¢˜äº¤æ¢æœºçš„<code>routing_key</code>éœ€è¦æœ‰ä¸€å®šçš„è§„åˆ™ï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—çš„<code>binding_key</code>éœ€è¦é‡‡ç”¨<code>*.#.*.....</code>çš„æ ¼å¼ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨<code>.</code>åˆ†å¼€ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>*</code>è¡¨ç¤ºä¸€ä¸ªå•è¯</li><li><code>#</code>è¡¨ç¤ºä»»æ„æ•°é‡ï¼ˆé›¶ä¸ªæˆ–å¤šä¸ªï¼‰å•è¯ã€‚</li></ul><p>å‡è®¾æœ‰ä¸€æ¡æ¶ˆæ¯çš„<code>routing_key</code>ä¸º<code>fast.rabbit.white</code>,é‚£ä¹ˆå¸¦æœ‰è¿™æ ·<code>binding_key</code>çš„å‡ ä¸ªé˜Ÿåˆ—éƒ½ä¼šæ¥æ”¶è¿™æ¡æ¶ˆæ¯ï¼š</p><ul><li>fast.<em>.</em></li><li><em>.</em>.white</li><li>fast.#</li><li>â€¦â€¦</li></ul><p>è¿™ä¸ªå›¾æ˜¯ç½‘ä¸Šæ‰¾çš„ï¼Œæ„Ÿè§‰å¯¹ä¸»é¢˜äº¤æ¢æœºçš„æè¿°æ¯”è¾ƒåˆ°ä½ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1479657-48e5409a26f0c75b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/571" alt="img"></p><p>ä¸»é¢˜äº¤æ¢æœº</p><p>å½“ä¸€ä¸ªé˜Ÿåˆ—çš„ç»‘å®šé”®ä¸º<code>#</code>çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°†ä¼šæ— è§†æ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œæ¥æ”¶æ‰€æœ‰çš„æ¶ˆæ¯</p><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitTopicConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TOPICNAME = <span class="hljs-string">&quot;javaboy-topic&quot;</span>;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">TopicExchange <span class="hljs-title">topicExchange</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TopicExchange(TOPICNAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">xiaomi</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;xiaomi&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">huawei</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;huawei&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">phone</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;phone&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">xiaomiBinding</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(xiaomi()).to(topicExchange()).with(<span class="hljs-string">&quot;xiaomi.#&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">huaweiBinding</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(huawei()).to(topicExchange()).with(<span class="hljs-string">&quot;huawei.#&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">phoneBinding</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(phone()).to(topicExchange()).with(<span class="hljs-string">&quot;#.phone.#&quot;</span>);    &#125;&#125;</code></pre></div><p><strong>æ¥æ”¶æœº</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TopicReceiver</span> </span>&#123;    <span class="hljs-meta">@RabbitListener(queues = &quot;xiaomi&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler1</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;TopicReceiver:handler1:&quot;</span> + msg);    &#125;    <span class="hljs-meta">@RabbitListener(queues = &quot;huawei&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler2</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;TopicReceiver:handler2:&quot;</span> + msg);    &#125;    <span class="hljs-meta">@RabbitListener(queues = &quot;phone&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler3</span><span class="hljs-params">(String msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;TopicReceiver:handler3:&quot;</span> + msg);    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME, <span class="hljs-string">&quot;xiaomi.news&quot;</span>, <span class="hljs-string">&quot;å°ç±³æ–°é—»&quot;</span>);    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME, <span class="hljs-string">&quot;vivo.phone&quot;</span>, <span class="hljs-string">&quot;vivo æ‰‹æœº&quot;</span>);    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME, <span class="hljs-string">&quot;huawei.phone&quot;</span>, <span class="hljs-string">&quot;åä¸ºæ‰‹æœº&quot;</span>);&#125;</code></pre></div><h4 id="2-4-Headeræ¨¡å¼"><a href="#2-4-Headeræ¨¡å¼" class="headerlink" title="2.4 Headeræ¨¡å¼"></a>2.4 Headeræ¨¡å¼</h4><p>é¦–éƒ¨äº¤æ¢æœºæ˜¯å¿½ç•¥<code>routing_key</code>çš„ä¸€ç§è·¯ç”±æ–¹å¼ã€‚è·¯ç”±å™¨å’Œäº¤æ¢æœºè·¯ç”±çš„è§„åˆ™æ˜¯é€šè¿‡<code>Headers</code>ä¿¡æ¯æ¥äº¤æ¢çš„ï¼Œè¿™ä¸ªæœ‰ç‚¹åƒ<code>HTTP</code>çš„<code>Headers</code>ã€‚å°†ä¸€ä¸ªäº¤æ¢æœºå£°æ˜æˆé¦–éƒ¨äº¤æ¢æœºï¼Œç»‘å®šä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶å€™ï¼Œå®šä¹‰ä¸€ä¸ª<code>Hash</code>çš„æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯å‘é€çš„æ—¶å€™ï¼Œä¼šæºå¸¦ä¸€ç»„hashæ•°æ®ç»“æ„çš„ä¿¡æ¯ï¼Œå½“<code>Hash</code>çš„å†…å®¹åŒ¹é…ä¸Šçš„æ—¶å€™ï¼Œæ¶ˆæ¯å°±ä¼šè¢«å†™å…¥é˜Ÿåˆ—ã€‚</p><p>ç»‘å®š<code>äº¤æ¢æœº</code>å’Œé˜Ÿåˆ—çš„æ—¶å€™ï¼ŒHashç»“æ„ä¸­è¦æ±‚æºå¸¦ä¸€ä¸ªé”®<code>â€œx-matchâ€</code>ï¼Œè¿™ä¸ªé”®çš„<code>Value</code>å¯ä»¥æ˜¯<code>any</code>æˆ–è€…<code>all</code>ï¼Œè¿™ä»£è¡¨æ¶ˆæ¯æºå¸¦çš„<code>Hash</code>æ˜¯éœ€è¦<code>å…¨éƒ¨åŒ¹é…(all)</code>ï¼Œè¿˜æ˜¯<code>ä»…åŒ¹é…ä¸€ä¸ªé”®</code>(any)å°±å¯ä»¥äº†ã€‚ç›¸æ¯”ç›´è¿äº¤æ¢æœºï¼Œé¦–éƒ¨äº¤æ¢æœºçš„ä¼˜åŠ¿æ˜¯åŒ¹é…çš„è§„åˆ™<code>ä¸è¢«</code>é™å®šä¸ºå­—ç¬¦ä¸²(string)</p><p><strong>é…ç½®ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitHeaderConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String HEADERNAME = <span class="hljs-string">&quot;javaboy-header&quot;</span>;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">HeadersExchange <span class="hljs-title">headersExchange</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HeadersExchange(HEADERNAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queueName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;name-queue&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Queue <span class="hljs-title">queueAge</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;age-queue&quot;</span>);    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">bindingName</span><span class="hljs-params">()</span> </span>&#123;        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        map.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueName()).to(headersExchange()).whereAny(map).match();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function">Binding <span class="hljs-title">bindingAge</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queueAge()).to(headersExchange()).where(<span class="hljs-string">&quot;age&quot;</span>).exists();    &#125;&#125;</code></pre></div><p><strong>æ¥æ”¶æœº</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeaderReceiver</span> </span>&#123;    <span class="hljs-meta">@RabbitListener(queues = &quot;name-queue&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler1</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;HeaderReceiver:handler1:&quot;</span> + <span class="hljs-keyword">new</span> String(msg, <span class="hljs-number">0</span>, msg.length));    &#125;    <span class="hljs-meta">@RabbitListener(queues = &quot;age-queue&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler2</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] msg)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;HeaderReceiver:handler2:&quot;</span> + <span class="hljs-keyword">new</span> String(msg, <span class="hljs-number">0</span>, msg.length));    &#125;&#125;</code></pre></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;    Message nameMsg = MessageBuilder.withBody(<span class="hljs-string">&quot;hello javaboy !&quot;</span>.getBytes()).setHeader(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;æ±Ÿå—ä¸€ç‚¹é›¨&quot;</span>).build();    Message ageMsg = MessageBuilder.withBody(<span class="hljs-string">&quot;hello 99 !&quot;</span>.getBytes()).setHeader(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;99&quot;</span>).build();    rabbitTemplate.send(RabbitHeaderConfig.HEADERNAME, <span class="hljs-keyword">null</span>, ageMsg);    rabbitTemplate.send(RabbitHeaderConfig.HEADERNAME, <span class="hljs-keyword">null</span>, nameMsg);&#125;</code></pre></div><h1 id="SpringBootä¼ä¸šçº§å¼€å‘"><a href="#SpringBootä¼ä¸šçº§å¼€å‘" class="headerlink" title="SpringBootä¼ä¸šçº§å¼€å‘"></a>SpringBootä¼ä¸šçº§å¼€å‘</h1><h2 id="1-é‚®ä»¶"><a href="#1-é‚®ä»¶" class="headerlink" title="1. é‚®ä»¶"></a>1. é‚®ä»¶</h2><h3 id="1-1-é‚®ä»¶åè®®"><a href="#1-1-é‚®ä»¶åè®®" class="headerlink" title="1.1 é‚®ä»¶åè®®"></a>1.1 é‚®ä»¶åè®®</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°å„ç§å„æ ·çš„é‚®ä»¶åè®®ï¼Œæ¯”å¦‚ SMTPã€POP3ã€IMAP ï¼Œé‚£ä¹ˆè¿™äº›åè®®æœ‰ä»€ä¹ˆä½œç”¨ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ </p><p>SMTP æ˜¯ä¸€ä¸ªåŸºäº TCP/IP çš„åº”ç”¨å±‚åè®®ï¼Œæ±Ÿæ¹–åœ°ä½æœ‰ç‚¹ç±»ä¼¼äº HTTPï¼ŒSMTP æœåŠ¡å™¨é»˜è®¤ç›‘å¬çš„ç«¯å£å·ä¸º 25 ã€‚çœ‹åˆ°è¿™é‡Œï¼Œå°ä¼™ä¼´ä»¬å¯èƒ½ä¼šæƒ³åˆ°æ—¢ç„¶ SMTP åè®®æ˜¯åŸºäº TCP/IP çš„åº”ç”¨å±‚åè®®ï¼Œé‚£ä¹ˆæˆ‘æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡ Socket å‘é€ä¸€å°é‚®ä»¶å‘¢ï¼Ÿå›ç­”æ˜¯è‚¯å®šçš„ã€‚ </p><p>ç”Ÿæ´»ä¸­æˆ‘ä»¬æŠ•é€’ä¸€å°é‚®ä»¶è¦ç»è¿‡å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š </p><ol><li>æ·±åœ³çš„å°ç‹å…ˆå°†é‚®ä»¶æŠ•é€’åˆ°æ·±åœ³çš„é‚®å±€ </li><li>æ·±åœ³çš„é‚®å±€å°†é‚®ä»¶è¿é€åˆ°ä¸Šæµ·çš„é‚®å±€ </li><li>ä¸Šæµ·çš„å°å¼ æ¥é‚®å±€å–é‚®ä»¶ </li></ol><p>è¿™æ˜¯ä¸€ä¸ªç¼©å‡ç‰ˆçš„ç”Ÿæ´»ä¸­é‚®ä»¶å‘é€è¿‡ç¨‹ã€‚è¿™ä¸‰ä¸ªæ­¥éª¤å¯ä»¥åˆ†åˆ«å¯¹åº”æˆ‘ä»¬çš„é‚®ä»¶å‘é€è¿‡ç¨‹ï¼Œå‡è®¾ä» <a href="mailto:aaa@qq.com">aaa@qq.com</a> å‘é€é‚®ä»¶åˆ° <a href="mailto:111@163.com">111@163.com</a> ï¼š </p><ol><li><a href="mailto:aaa@qq.com">aaa@qq.com</a> å…ˆå°†é‚®ä»¶æŠ•é€’åˆ°è…¾è®¯çš„é‚®ä»¶æœåŠ¡å™¨ </li><li>è…¾è®¯çš„é‚®ä»¶æœåŠ¡å™¨å°†æˆ‘ä»¬çš„é‚®ä»¶æŠ•é€’åˆ°ç½‘æ˜“çš„é‚®ä»¶æœåŠ¡å™¨ </li><li><a href="mailto:111@163.com">111@163.com</a> ç™»å½•ç½‘æ˜“çš„é‚®ä»¶æœåŠ¡å™¨æŸ¥çœ‹é‚®ä»¶ </li></ol><p>é‚®ä»¶æŠ•é€’å¤§è‡´å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ¶‰åŠåˆ°äº†å¤šä¸ªåè®®ï¼Œæˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸€ä¸‹ã€‚ </p><p>SMTP åè®®å…¨ç§°ä¸º <code>Simple Mail Transfer Protocol</code>ï¼Œè¯‘ä½œç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼Œå®ƒå®šä¹‰äº†é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶äº SMTP æœåŠ¡å™¨ä¹‹é—´ï¼Œä»¥åŠ SMTP æœåŠ¡å™¨ä¸ SMTP æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è§„åˆ™ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ <a href="mailto:aaa@qq.com">aaa@qq.com</a> ç”¨æˆ·å…ˆå°†é‚®ä»¶æŠ•é€’åˆ°è…¾è®¯çš„ SMTP æœåŠ¡å™¨è¿™ä¸ªè¿‡ç¨‹å°±ä½¿ç”¨äº† SMTP åè®®ï¼Œç„¶åè…¾è®¯çš„ SMTP æœåŠ¡å™¨å°†é‚®ä»¶æŠ•é€’åˆ°ç½‘æ˜“çš„ SMTP æœåŠ¡å™¨è¿™ä¸ªè¿‡ç¨‹ä¹Ÿä¾ç„¶ä½¿ç”¨äº† SMTP åè®®ï¼ŒSMTP æœåŠ¡å™¨å°±æ˜¯ç”¨æ¥æ”¶é‚®ä»¶ã€‚</p><p>è€Œ POP3 åè®®å…¨ç§°ä¸º Post Office Protocol ï¼Œè¯‘ä½œé‚®å±€åè®®ï¼Œå®ƒå®šä¹‰äº†é‚®ä»¶å®¢æˆ·ç«¯ä¸ POP3 æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è§„åˆ™ï¼Œé‚£ä¹ˆè¯¥åè®®åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°å‘¢ï¼Ÿå½“é‚®ä»¶åˆ°è¾¾ç½‘æ˜“çš„ SMTP æœåŠ¡å™¨ä¹‹åï¼Œ <a href="mailto:111@163.com">111@163.com</a> ç”¨æˆ·éœ€è¦ç™»å½•æœåŠ¡å™¨æŸ¥çœ‹é‚®ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¯¥åè®®å°±ç”¨ä¸Šäº†ï¼šé‚®ä»¶æœåŠ¡å•†éƒ½ä¼šä¸ºæ¯ä¸€ä¸ªç”¨æˆ·æä¾›ä¸“é—¨çš„é‚®ä»¶å­˜å‚¨ç©ºé—´ï¼ŒSMTP æœåŠ¡å™¨æ”¶åˆ°é‚®ä»¶ä¹‹åï¼Œå°±å°†é‚®ä»¶ä¿å­˜åˆ°ç›¸åº”ç”¨æˆ·çš„é‚®ä»¶å­˜å‚¨ç©ºé—´ä¸­ï¼Œå¦‚æœç”¨æˆ·è¦è¯»å–é‚®ä»¶ï¼Œå°±éœ€è¦é€šè¿‡é‚®ä»¶æœåŠ¡å•†çš„ POP3 é‚®ä»¶æœåŠ¡å™¨æ¥å®Œæˆã€‚</p><h3 id="1-2-é‚®ä»¶å‘é€"><a href="#1-2-é‚®ä»¶å‘é€" class="headerlink" title="1.2 é‚®ä»¶å‘é€"></a>1.2 é‚®ä»¶å‘é€</h3><p><strong>é¡¹ç›®åˆ›å»º</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºé¡¹ç›®äº†ï¼ŒSpring Boot ä¸­ï¼Œå¯¹äºé‚®ä»¶å‘é€æä¾›äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œå¼€å‘è€…åªéœ€è¦åŠ å…¥ç›¸å…³ä¾èµ–ï¼Œç„¶åé…ç½®ä¸€ä¸‹é‚®ç®±çš„åŸºæœ¬ä¿¡æ¯ï¼Œå°±å¯ä»¥å‘é€é‚®ä»¶äº†ã€‚</p><ul><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¼•å…¥é‚®ä»¶å‘é€ä¾èµ–ï¼š</li></ul><p><a href="http://www.javaboy.org/images/boot2/43-4.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/43-4.png" alt="img"></a></p><p>åˆ›å»ºå®Œæˆåï¼Œé¡¹ç›®ä¾èµ–å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><ul><li>é…ç½®é‚®ç®±åŸºæœ¬ä¿¡æ¯</li></ul><p>é¡¹ç›®åˆ›å»ºæˆåŠŸåï¼Œæ¥ä¸‹æ¥åœ¨ application.properties ä¸­é…ç½®é‚®ç®±çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span><span class="hljs-meta">spring.mail.port</span>=<span class="hljs-string">587</span><span class="hljs-meta">spring.mail.username</span>=<span class="hljs-string">xxxx@xxx.com</span><span class="hljs-meta">spring.mail.password</span>=<span class="hljs-string">xxxx</span><span class="hljs-meta">spring.mail.default-encoding</span>=<span class="hljs-string">UTF-8</span><span class="hljs-meta">spring.mail.properties.mail.smtp.socketFactoryClass</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span><span class="hljs-meta">spring.mail.properties.mail.debug</span>=<span class="hljs-string">true</span></code></pre></div><p>é…ç½®å«ä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>é…ç½® SMTP æœåŠ¡å™¨åœ°å€</li><li>SMTP æœåŠ¡å™¨çš„ç«¯å£</li><li>é…ç½®é‚®ç®±ç”¨æˆ·å</li><li>é…ç½®å¯†ç ï¼Œæ³¨æ„ï¼Œä¸æ˜¯çœŸæ­£çš„å¯†ç ï¼Œè€Œæ˜¯åˆšåˆšç”³è¯·åˆ°çš„æˆæƒç </li><li>é»˜è®¤çš„é‚®ä»¶ç¼–ç </li><li>é…é¥° SSL åŠ å¯†å·¥å‚</li><li>è¡¨ç¤ºå¼€å¯ DEBUG æ¨¡å¼ï¼Œè¿™æ ·ï¼Œé‚®ä»¶å‘é€è¿‡ç¨‹çš„æ—¥å¿—ä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿æ’æŸ¥é”™è¯¯</li></ul><p>å¦‚æœä¸çŸ¥é“ smtp æœåŠ¡å™¨çš„ç«¯å£æˆ–è€…åœ°å€çš„çš„è¯ï¼Œå¯ä»¥å‚è€ƒ è…¾è®¯çš„é‚®ç®±æ–‡æ¡£</p><ul><li><a href="https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=371">https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=371</a></li></ul><p>åšå®Œè¿™äº›ä¹‹åï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®å¥½é‚®ä»¶å‘é€ç±»ï¼Œç›¸å…³çš„é…ç½®åœ¨ <code>org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration</code> ç±»ä¸­ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass(&#123; MimeMessage.class, MimeType.class, MailSender.class &#125;)</span><span class="hljs-meta">@ConditionalOnMissingBean(MailSender.class)</span><span class="hljs-meta">@Conditional(MailSenderCondition.class)</span><span class="hljs-meta">@EnableConfigurationProperties(MailProperties.class)</span><span class="hljs-meta">@Import(&#123; MailSenderJndiConfiguration.class, MailSenderPropertiesConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSenderAutoConfiguration</span> </span>&#123;&#125;</code></pre></div><p>ä»è¿™æ®µä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¯¼å…¥äº†å¦å¤–ä¸€ä¸ªé…ç½® <code>MailSenderPropertiesConfiguration</code> ç±»ï¼Œè¿™ä¸ªç±»ä¸­ï¼Œæä¾›äº†é‚®ä»¶å‘é€ç›¸å…³çš„å·¥å…·ç±»ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;spring.mail&quot;, name = &quot;host&quot;)</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSenderPropertiesConfiguration</span> </span>&#123;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MailProperties properties;        MailSenderPropertiesConfiguration(MailProperties properties) &#123;                <span class="hljs-keyword">this</span>.properties = properties;        &#125;        <span class="hljs-meta">@Bean</span>        <span class="hljs-meta">@ConditionalOnMissingBean</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> JavaMailSenderImpl <span class="hljs-title">mailSender</span><span class="hljs-params">()</span> </span>&#123;                JavaMailSenderImpl sender = <span class="hljs-keyword">new</span> JavaMailSenderImpl();                applyProperties(sender);                <span class="hljs-keyword">return</span> sender;        &#125;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª <code>JavaMailSenderImpl</code> çš„å®ä¾‹ï¼Œ <code>JavaMailSenderImpl</code> æ˜¯ <code>JavaMailSender</code> çš„ä¸€ä¸ªå®ç°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>JavaMailSenderImpl</code> æ¥å®Œæˆé‚®ä»¶çš„å‘é€å·¥ä½œã€‚</p><h4 id="ç®€å•é‚®ä»¶"><a href="#ç®€å•é‚®ä»¶" class="headerlink" title="ç®€å•é‚®ä»¶"></a>ç®€å•é‚®ä»¶</h4><p>ç®€å•é‚®ä»¶å°±æ˜¯æŒ‡é‚®ä»¶å†…å®¹æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡æ¡£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>JavaMailSender javaMailSender;<span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSimpleMail</span><span class="hljs-params">()</span> </span>&#123;    SimpleMailMessage message = <span class="hljs-keyword">new</span> SimpleMailMessage();    message.setSubject(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶&quot;</span>);    message.setFrom(<span class="hljs-string">&quot;1510161612@qq.com&quot;</span>);    message.setTo(<span class="hljs-string">&quot;25xxxxx755@qq.com&quot;</span>);    message.setCc(<span class="hljs-string">&quot;37xxxxx37@qq.com&quot;</span>);    message.setBcc(<span class="hljs-string">&quot;14xxxxx098@qq.com&quot;</span>);    message.setSentDate(<span class="hljs-keyword">new</span> Date());    message.setText(<span class="hljs-string">&quot;è¿™æ˜¯æµ‹è¯•é‚®ä»¶çš„æ­£æ–‡&quot;</span>);    javaMailSender.send(message);&#125;</code></pre></div><p>ä»ä¸Šå¾€ä¸‹ï¼Œä»£ç å«ä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>æ„å»ºä¸€ä¸ªé‚®ä»¶å¯¹è±¡</li><li>è®¾ç½®é‚®ä»¶ä¸»é¢˜</li><li>è®¾ç½®é‚®ä»¶å‘é€è€…</li><li>è®¾ç½®é‚®ä»¶æ¥æ”¶è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªæ¥æ”¶è€…</li><li>è®¾ç½®é‚®ä»¶æŠ„é€äººï¼Œå¯ä»¥æœ‰å¤šä¸ªæŠ„é€äºº</li><li>è®¾ç½®éšç§˜æŠ„é€äººï¼Œå¯ä»¥æœ‰å¤šä¸ª</li><li>è®¾ç½®é‚®ä»¶å‘é€æ—¥æœŸ</li><li>è®¾ç½®é‚®ä»¶çš„æ­£æ–‡</li><li>å‘é€é‚®ä»¶</li></ul><h4 id="å¸¦é™„ä»¶çš„é‚®ä»¶"><a href="#å¸¦é™„ä»¶çš„é‚®ä»¶" class="headerlink" title="å¸¦é™„ä»¶çš„é‚®ä»¶"></a>å¸¦é™„ä»¶çš„é‚®ä»¶</h4><p>é‚®ä»¶çš„é™„ä»¶å¯ä»¥æ˜¯å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€šæ–‡ä»¶ï¼Œéƒ½æ˜¯æ”¯æŒçš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendAttachFileMail</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;    MimeMessage mimeMessage = javaMailSender.createMimeMessage();    MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage,<span class="hljs-keyword">true</span>);    helper.setSubject(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶&quot;</span>);    helper.setFrom(<span class="hljs-string">&quot;1510161612@qq.com&quot;</span>);    helper.setTo(<span class="hljs-string">&quot;25xxxxx755@qq.com&quot;</span>);    helper.setCc(<span class="hljs-string">&quot;37xxxxx37@qq.com&quot;</span>);    helper.setBcc(<span class="hljs-string">&quot;14xxxxx098@qq.com&quot;</span>);    helper.setSentDate(<span class="hljs-keyword">new</span> Date());    helper.setText(<span class="hljs-string">&quot;è¿™æ˜¯æµ‹è¯•é‚®ä»¶çš„æ­£æ–‡&quot;</span>);    helper.addAttachment(<span class="hljs-string">&quot;javaboy.jpg&quot;</span>,<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\Users\\sang\\Downloads\\javaboy.png&quot;</span>));    javaMailSender.send(mimeMessage);&#125;</code></pre></div><p>æ³¨æ„è¿™é‡Œåœ¨æ„å»ºé‚®ä»¶å¯¹è±¡ä¸Šå’Œå‰æ–‡æœ‰æ‰€å·®å¼‚ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ javaMailSender æ¥è·å–ä¸€ä¸ªå¤æ‚é‚®ä»¶å¯¹è±¡ï¼Œç„¶åå†åˆ©ç”¨ MimeMessageHelper å¯¹é‚®ä»¶è¿›è¡Œé…ç½®ï¼ŒMimeMessageHelper æ˜¯ä¸€ä¸ªé‚®ä»¶é…ç½®çš„è¾…åŠ©å·¥å…·ç±»ï¼Œåˆ›å»ºæ—¶å€™çš„ true è¡¨ç¤ºæ„å»ºä¸€ä¸ª multipart message ç±»å‹çš„é‚®ä»¶ï¼Œæœ‰äº† MimeMessageHelper ä¹‹åï¼Œæˆ‘ä»¬é’ˆå¯¹é‚®ä»¶çš„é…ç½®éƒ½æ˜¯ç”± MimeMessageHelper æ¥ä»£åŠ³ã€‚æœ€åé€šè¿‡ addAttachment æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªé™„ä»¶ã€‚</p><h4 id="å›¾ç‰‡èµ„æºçš„é‚®ä»¶"><a href="#å›¾ç‰‡èµ„æºçš„é‚®ä»¶" class="headerlink" title="å›¾ç‰‡èµ„æºçš„é‚®ä»¶"></a>å›¾ç‰‡èµ„æºçš„é‚®ä»¶</h4><p>å›¾ç‰‡èµ„æºå’Œé™„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå›¾ç‰‡èµ„æºæ˜¯æ”¾åœ¨é‚®ä»¶æ­£æ–‡ä¸­çš„ï¼Œå³ä¸€æ‰“å¼€é‚®ä»¶ï¼Œå°±èƒ½çœ‹åˆ°å›¾ç‰‡ã€‚ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä¸€äº›å…¬å¸ä¼šå¯¹é‚®ä»¶å†…å®¹çš„å¤§å°æœ‰é™åˆ¶ï¼ˆå› ä¸ºè¿™ç§æ–¹å¼æ˜¯å°†å›¾ç‰‡ä¸€èµ·å‘é€çš„ï¼‰ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendImgResMail</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;    MimeMessage mimeMessage = javaMailSender.createMimeMessage();    MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>);    helper.setSubject(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶&quot;</span>);    helper.setFrom(<span class="hljs-string">&quot;1510161612@qq.com&quot;</span>);    helper.setTo(<span class="hljs-string">&quot;25xxxxx755@qq.com&quot;</span>);    helper.setCc(<span class="hljs-string">&quot;37xxxxx37@qq.com&quot;</span>);    helper.setBcc(<span class="hljs-string">&quot;14xxxxx098@qq.com&quot;</span>);    helper.setSentDate(<span class="hljs-keyword">new</span> Date());    helper.setText(<span class="hljs-string">&quot;&lt;p&gt;hello å¤§å®¶å¥½ï¼Œè¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶ï¼Œè¿™å°é‚®ä»¶åŒ…å«ä¸¤ç§å›¾ç‰‡ï¼Œåˆ†åˆ«å¦‚ä¸‹&lt;/p&gt;&lt;p&gt;ç¬¬ä¸€å¼ å›¾ç‰‡ï¼š&lt;/p&gt;&lt;img src=&#x27;cid:p01&#x27;/&gt;&lt;p&gt;ç¬¬äºŒå¼ å›¾ç‰‡ï¼š&lt;/p&gt;&lt;img src=&#x27;cid:p02&#x27;/&gt;&quot;</span>,<span class="hljs-keyword">true</span>);    helper.addInline(<span class="hljs-string">&quot;p01&quot;</span>,<span class="hljs-keyword">new</span> FileSystemResource(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\Users\\sang\\Downloads\\javaboy.png&quot;</span>)));    helper.addInline(<span class="hljs-string">&quot;p02&quot;</span>,<span class="hljs-keyword">new</span> FileSystemResource(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\Users\\sang\\Downloads\\javaboy2.png&quot;</span>)));    javaMailSender.send(mimeMessage);&#125;</code></pre></div><p>è¿™é‡Œçš„é‚®ä»¶ text æ˜¯ä¸€ä¸ª HTML æ–‡æœ¬ï¼Œé‡Œè¾¹æ¶‰åŠåˆ°çš„å›¾ç‰‡èµ„æºå…ˆç”¨ä¸€ä¸ªå ä½ç¬¦å ç€ï¼ŒsetText æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° true è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª HTML æ–‡æœ¬ã€‚setText ä¹‹åï¼Œå†é€šè¿‡ addInline æ–¹æ³•æ¥æ·»åŠ å›¾ç‰‡èµ„æºã€‚</p><h3 id="1-3-Freemarkeré‚®ä»¶"><a href="#1-3-Freemarkeré‚®ä»¶" class="headerlink" title="1.3 Freemarkeré‚®ä»¶"></a>1.3 Freemarkeré‚®ä»¶</h3><p>é¦–å…ˆéœ€è¦å¼•å…¥ Freemarker ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶ååœ¨ <code>resources/templates</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>mail.ftl</code> ä½œä¸ºé‚®ä»¶å‘é€æ¨¡æ¿ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello æ¬¢è¿åŠ å…¥ xxx å¤§å®¶åº­ï¼Œæ‚¨çš„å…¥èŒä¿¡æ¯å¦‚ä¸‹ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å·¥å·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;num&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>è–ªæ°´<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;salary&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #ff1a0e&quot;</span>&gt;</span>ä¸€èµ·åŠªåŠ›åˆ›é€ è¾‰ç…Œ<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œå°†é‚®ä»¶æ¨¡æ¿æ¸²æŸ“æˆ HTML ï¼Œç„¶åå‘é€å³å¯ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendFreemarkerMail</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException, IOException, TemplateException </span>&#123;    MimeMessage mimeMessage = javaMailSender.createMimeMessage();    MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>);    helper.setSubject(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶&quot;</span>);    helper.setFrom(<span class="hljs-string">&quot;1510161612@qq.com&quot;</span>);    helper.setTo(<span class="hljs-string">&quot;25xxxxx755@qq.com&quot;</span>);    helper.setCc(<span class="hljs-string">&quot;37xxxxx37@qq.com&quot;</span>);    helper.setBcc(<span class="hljs-string">&quot;14xxxxx098@qq.com&quot;</span>);    helper.setSentDate(<span class="hljs-keyword">new</span> Date());    <span class="hljs-comment">//æ„å»º Freemarker çš„åŸºæœ¬é…ç½®</span>    Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.VERSION_2_3_0);    <span class="hljs-comment">// é…ç½®æ¨¡æ¿ä½ç½®</span>    ClassLoader loader = MailApplication.class.getClassLoader();    configuration.setClassLoaderForTemplateLoading(loader, <span class="hljs-string">&quot;templates&quot;</span>);    <span class="hljs-comment">//åŠ è½½æ¨¡æ¿</span>    Template template = configuration.getTemplate(<span class="hljs-string">&quot;mail.ftl&quot;</span>);    User user = <span class="hljs-keyword">new</span> User();    user.setUsername(<span class="hljs-string">&quot;javaboy&quot;</span>);    user.setNum(<span class="hljs-number">1</span>);    user.setSalary((<span class="hljs-keyword">double</span>) <span class="hljs-number">99999</span>);    StringWriter out = <span class="hljs-keyword">new</span> StringWriter();    <span class="hljs-comment">//æ¨¡æ¿æ¸²æŸ“ï¼Œæ¸²æŸ“çš„ç»“æœå°†è¢«ä¿å­˜åˆ° out ä¸­ ï¼Œå°†out ä¸­çš„ html å­—ç¬¦ä¸²å‘é€å³å¯</span>    template.process(user, out);    helper.setText(out.toString(),<span class="hljs-keyword">true</span>);    javaMailSender.send(mimeMessage);&#125;</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å¼•å…¥äº† <code>Freemarker</code> çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯ç›´æ¥ <code>new Configuration</code> æ¥é‡æ–°é…ç½® <code>Freemarker</code> çš„ï¼Œæ‰€ä»¥ Freemarker é»˜è®¤çš„é…ç½®è¿™é‡Œä¸ç”Ÿæ•ˆï¼Œå› æ­¤ï¼Œåœ¨å¡«å†™æ¨¡æ¿ä½ç½®æ—¶ï¼Œå€¼ä¸º <code>templates</code> </p><h3 id="1-4-Thymeleafé‚®ä»¶"><a href="#1-4-Thymeleafé‚®ä»¶" class="headerlink" title="1.4 Thymeleafé‚®ä»¶"></a>1.4 Thymeleafé‚®ä»¶</h3><p>æ¨èåœ¨ Spring Boot ä¸­ä½¿ç”¨ Thymeleaf æ¥æ„å»ºé‚®ä»¶æ¨¡æ¿ã€‚å› ä¸º Thymeleaf çš„è‡ªåŠ¨åŒ–é…ç½®æä¾›äº†ä¸€ä¸ª TemplateEngineï¼Œé€šè¿‡ TemplateEngine å¯ä»¥æ–¹ä¾¿çš„å°† Thymeleaf æ¨¡æ¿æ¸²æŸ“ä¸º HTML ï¼ŒåŒæ—¶ï¼ŒThymeleaf çš„è‡ªåŠ¨åŒ–é…ç½®åœ¨è¿™é‡Œæ˜¯ç»§ç»­æœ‰æ•ˆçš„ ã€‚</p><p>é¦–å…ˆï¼Œå¼•å…¥ Thymeleaf ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶åï¼Œåˆ›å»º <code>Thymeleaf</code> é‚®ä»¶æ¨¡æ¿ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;!DOCTYPE html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span> xmlns:th=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;&lt;head&gt;    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;hello æ¬¢è¿åŠ å…¥ xxx å¤§å®¶åº­ï¼Œæ‚¨çš„å…¥èŒä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;table border=<span class="hljs-string">&quot;1&quot;</span>&gt;    &lt;tr&gt;        &lt;td&gt;å§“å&lt;/td&gt;        &lt;td th:text=&quot;$&#123;username&#125;&quot;&gt;&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;td&gt;å·¥å·&lt;/td&gt;        &lt;td th:text=&quot;$&#123;num&#125;&quot;&gt;&lt;/td&gt;    &lt;/tr&gt;    &lt;tr&gt;        &lt;td&gt;è–ªæ°´&lt;/td&gt;        &lt;td th:text=&quot;$&#123;salary&#125;&quot;&gt;&lt;/td&gt;    &lt;/tr&gt;&lt;/table&gt;&lt;div style=&quot;color: #ff1a0e&quot;&gt;ä¸€èµ·åŠªåŠ›åˆ›é€ è¾‰ç…Œ&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div><p>æ¥ä¸‹æ¥å‘é€é‚®ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>TemplateEngine templateEngine;<span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendThymeleafMail</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;    MimeMessage mimeMessage = javaMailSender.createMimeMessage();    MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>);    helper.setSubject(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶&quot;</span>);    helper.setFrom(<span class="hljs-string">&quot;1510161612@qq.com&quot;</span>);    helper.setTo(<span class="hljs-string">&quot;25xxxxx755@qq.com&quot;</span>);    helper.setCc(<span class="hljs-string">&quot;37xxxxx37@qq.com&quot;</span>);    helper.setBcc(<span class="hljs-string">&quot;14xxxxx098@qq.com&quot;</span>);    helper.setSentDate(<span class="hljs-keyword">new</span> Date());    Context context = <span class="hljs-keyword">new</span> Context();    context.setVariable(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);    context.setVariable(<span class="hljs-string">&quot;num&quot;</span>,<span class="hljs-string">&quot;000001&quot;</span>);    context.setVariable(<span class="hljs-string">&quot;salary&quot;</span>, <span class="hljs-string">&quot;99999&quot;</span>);    String process = templateEngine.process(<span class="hljs-string">&quot;mail.html&quot;</span>, context);    helper.setText(process,<span class="hljs-keyword">true</span>);    javaMailSender.send(mimeMessage);&#125;</code></pre></div><h1 id="SpringBootåº”ç”¨ç›‘æ§"><a href="#SpringBootåº”ç”¨ç›‘æ§" class="headerlink" title="SpringBootåº”ç”¨ç›‘æ§"></a>SpringBootåº”ç”¨ç›‘æ§</h1><p>åº”ç”¨ç›‘æ§æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸€ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œè¿ç»´äººå‘˜ä¸å¯èƒ½ 24 å°æ—¶ç›¯ç€åº”ç”¨ï¼Œåº”ç”¨æŒ‚äº†åŠæ—¶è§£å†³ï¼Œè¿™ä¸ç°å®ã€‚æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå®æ—¶æŒæ¡åº”ç”¨çš„è¿è¡Œæ•°æ®ï¼Œä»¥ä¾¿ææ—©å‘ç°é—®é¢˜ï¼ŒåŒæ—¶åœ¨åº”ç”¨æŒ‚æ‰çš„æ—¶å€™è¿˜èƒ½å¤Ÿè‡ªåŠ¨æŠ¥è­¦ï¼Œè¿™æ ·æ‰èƒ½è§£æ”¾å¼€å‘äººå‘˜ã€‚</p><p>Spring Boot ä¸­ä¹Ÿæä¾›äº†ç”Ÿäº§çº§çš„åº”ç”¨ç›‘æ§æ–¹æ¡ˆï¼Œå¯¹äºå•ä½“åº”ç”¨ã€å¾®æœåŠ¡åº”ç”¨éƒ½æœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä»Šå¤©æ¾å“¥å°±æƒ³æ¥å’Œå¤§å®¶æ‹ä¸€æ‹ Spring Boot ä¸­çš„åº”ç”¨ç›‘æ§æ–¹æ¡ˆéƒ½æœ‰å“ªäº›ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥æ‹ä¸€ä¸‹åº”ç”¨ç›‘æ§éƒ½éœ€è¦å“ªäº›ä¸œè¥¿ï¼Ÿå…¶å®å°±ä¸¤ç‚¹ï¼š</p><ul><li>ä¿¡æ¯é‡‡é›†å™¨</li><li>æ•°æ®å¯è§†åŒ– UI</li></ul><p>ä¿¡æ¯é‡‡é›†å™¨ä¼šæ”¶é›†åº”ç”¨çš„å¥åº·ã€å®¡è®¡ã€æŒ‡æ ‡ã€HTTP è¯·æ±‚ç­‰ä¿¡æ¯ï¼Œå¹¶å°†ä¹‹æš´éœ²å‡ºæ¥ï¼Œæ•°æ®å¯è§†åŒ– UI åˆ™ä¼šé€šè¿‡ä»ªè¡¨ç›˜ã€å›¾å½¢ç­‰å±•ç¤ºè¿™äº›æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œåˆ†æã€æŠ¥è­¦ç­‰å¤„ç†ã€‚æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ã€‚</p><h2 id="1-Spring-Boot-Actuator"><a href="#1-Spring-Boot-Actuator" class="headerlink" title="1. Spring Boot Actuator"></a>1. Spring Boot Actuator</h2><h3 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h3><p>åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ä¿¡æ¯é‡‡é›†å™¨ä¸»è¦å°±æ˜¯ Spring Boot Actuatorï¼Œè¿™ä¸ªæ¨¡å—ç”± Spring Boot å®˜æ–¹æä¾›ï¼Œå®ƒåŒ…å«äº†è®¸å¤šç”Ÿäº§çº§åˆ«çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¥åº·æ£€æŸ¥ã€å®¡è®¡ã€æŒ‡æ ‡æ”¶é›†ã€HTTP è¯·æ±‚è¿½è¸ªç­‰ï¼ŒSpring Boot Actuator å°†è¿™äº›ä¿¡æ¯æ”¶é›†èµ·æ¥åï¼Œé€šè¿‡ HTTP å’Œ JMX ä¸¤ç§æ–¹å¼æš´éœ²ç»™å¤–éƒ¨æ¨¡å—ã€‚ä¾‹å¦‚ Spring Boot Actuator é€šè¿‡ <code>/health</code> ç«¯ç‚¹ï¼ˆendpointsï¼‰æä¾›äº†åº”ç”¨çš„å¥åº·ä¿¡æ¯ï¼Œå¼€å‘è€…åªéœ€è¦è®¿é—®è¯¥ç«¯ç‚¹å°±å¯ä»¥çœ‹åˆ°åº”ç”¨çš„å¥åº·ä¿¡æ¯ï¼Œä½†æ˜¯è¿™äº›ç«¯ç‚¹è¿”å›çš„æ•°æ®æ˜¯ JSON æ ¼å¼çš„ï¼Œä¸æ–¹ä¾¿æŸ¥çœ‹ï¼Œä¹Ÿä¸æ–¹ä¾¿åˆ†æï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSpring Boot Actuator éƒ½æ˜¯å’Œä¸€äº›å¤–éƒ¨æ¨¡å—ä¸€èµ·ä½¿ç”¨ã€‚</p><p>Spring Boot Actuator æ”¯æŒçš„ç«¯ç‚¹ä¸»è¦æœ‰å¦‚ä¸‹ä¸€äº›ï¼š</p><p><a href="http://img.itboyhub.com/2021/02/20210201202406.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20210201202406.png" alt="img"></a></p><p>å¦‚æœæ˜¯ Web åº”ç”¨ï¼Œåˆ™å†æ¬¡åŸºç¡€ä¸Šè¿˜æ”¯æŒå¦‚ä¸‹ç«¯ç‚¹ï¼š</p><p><a href="http://img.itboyhub.com/2021/02/20210201202855.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20210201202855.png" alt="img"></a></p><p>æåˆ° Spring Boot Actuatorï¼Œå°±è¿˜æœ‰ä¸€ä¸ªä¸œè¥¿éœ€è¦å’Œå¤§å®¶ä»‹ç»ï¼Œé‚£å°±æ˜¯ Micrometerï¼Œä» Spring Boot2.0 å¼€å§‹ï¼ŒActuator åº•å±‚æ”¹ä¸ºäº† Micrometerã€‚</p><p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ª Spring Boot é¡¹ç›®ä¸­å¼•å…¥ Actuator ä¾èµ–ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒé‡Œè¾¹åŒ…å«äº† Micrometerï¼š</p><p><a href="http://img.itboyhub.com/2021/01/spring-cloud/20210201162644.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20210201162644.png" alt="img"></a></p><p>Micrometer ä¸º Java å¹³å°ä¸Šçš„æ€§èƒ½æ•°æ®æ”¶é›†æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ APIï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ä½¿ç”¨ Micrometer çš„é€šç”¨ API æ¥æ”¶é›†æ€§èƒ½æŒ‡æ ‡å³å¯ï¼Œè€Œ Micrometer åˆ™ä¼šè´Ÿè´£å®Œæˆä¸ä¸åŒç›‘æ§ç³»ç»Ÿçš„é€‚é…å·¥ä½œï¼Œç±»ä¼¼äºä¸€ä¸ª Adapterï¼Œæœ‰äº†è¿™ä¸ª Adapterï¼Œåˆ‡æ¢ç›‘æ§ç³»ç»Ÿå°±å˜å¾—éå¸¸å®¹æ˜“ã€‚åŒæ—¶ Micrometer è¿˜æ”¯æŒæ¨é€æ•°æ®åˆ°å¤šä¸ªä¸åŒçš„ç›‘æ§ç³»ç»Ÿã€‚</p><p>è€Œ Spring Boot Actuator ä½¿ç”¨ Micrometer ä¸å¤–éƒ¨åº”ç”¨ç›‘è§†ç³»ç»Ÿè¿›è¡Œé›†æˆï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¼€å‘è€…åªéœ€è¦ç¨å¾®é…ç½®ä¸€ä¸‹å°±å¯ä»¥ä½¿å…¶å’Œå¤–éƒ¨åº”ç”¨ç›‘è§†ç³»ç»Ÿè¿›è¡Œæ•´åˆäº†ã€‚Micrometer æ”¯æŒçš„ç›‘æ§ç³»ç»Ÿæœ‰ï¼š</p><ul><li>AppOptics</li><li>Atlas</li><li>Datadog</li><li>Dynatrace</li><li>Elastic</li><li>Ganglia</li><li>Graphite</li><li>Humio</li><li>Influx</li><li>JMX</li><li>KairosDB</li><li>New Relic</li><li>Prometheus</li><li>SignalFx</li><li>Simple (in-memory)</li><li>StatsD</li><li>Wavefront</li></ul><h3 id="1-2-æ•´åˆåˆ°SpringBoot"><a href="#1-2-æ•´åˆåˆ°SpringBoot" class="headerlink" title="1.2 æ•´åˆåˆ°SpringBoot"></a>1.2 æ•´åˆåˆ°SpringBoot</h3><h4 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="headerlink" title="åŸºç¡€ç”¨æ³•"></a>åŸºç¡€ç”¨æ³•</h4><p><strong>å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¯åŠ¨åå¯ä»¥çœ‹åˆ°</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210527112349779.png" alt="image-20210527112349779"></p><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">management.endpoints.web.exposure.include</span>=<span class="hljs-string">*</span><span class="hljs-comment"># å¼€å¯ä¼˜é›…çš„å…³é—­</span><span class="hljs-meta">management.endpoints.shutdown.enabled</span>=<span class="hljs-string">true</span><span class="hljs-comment">#SecurityConfig</span><span class="hljs-meta">spring.security.user.name</span>=<span class="hljs-string">javaboy</span><span class="hljs-meta">spring.security.user.password</span>=<span class="hljs-string">123</span><span class="hljs-meta">spring.security.user.roles</span>=<span class="hljs-string">ADMIN</span></code></pre></div><p><strong>Securityé…ç½®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        http.requestMatcher(EndpointRequest.toAnyEndpoint())                .authorizeRequests()                .anyRequest().hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)                .and()                .httpBasic().and().csrf().disable();    &#125;&#125;</code></pre></div><h4 id="é…ç½®è·¯å¾„æ˜ å°„"><a href="#é…ç½®è·¯å¾„æ˜ å°„" class="headerlink" title="é…ç½®è·¯å¾„æ˜ å°„"></a>é…ç½®è·¯å¾„æ˜ å°„</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># ä»¥/å¼€å¤´</span><span class="hljs-meta">management.endpoints.web.base-path</span>=<span class="hljs-string">/</span><span class="hljs-comment"># bsä»£æ›¿beans</span><span class="hljs-meta">management.endpoints.web.path-mapping.beans</span>=<span class="hljs-string">bs</span></code></pre></div><h4 id="æ”¯æŒè·¨åŸŸ"><a href="#æ”¯æŒè·¨åŸŸ" class="headerlink" title="æ”¯æŒè·¨åŸŸ"></a>æ”¯æŒè·¨åŸŸ</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">management.endpoints.web.cors.allowed-origins</span>=<span class="hljs-string">http://localhost:8888</span><span class="hljs-meta">management.endpoints.web.cors.allowed-methods</span>=<span class="hljs-string">GET,POST</span></code></pre></div><h4 id="å¥åº·ä¿¡æ¯"><a href="#å¥åº·ä¿¡æ¯" class="headerlink" title="å¥åº·ä¿¡æ¯"></a>å¥åº·ä¿¡æ¯</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">management.endpoint.health.show-details</span>=<span class="hljs-string">when_authorized</span><span class="hljs-meta">management.endpoint.health.roles</span>=<span class="hljs-string">ADMIN</span><span class="hljs-meta">management.endpoint.health.status.order</span>=<span class="hljs-string">FATAL,DOWN,OUT_OF_SERVICE,UP,UNKNOWN</span><span class="hljs-meta">management.endpoint.health.status.http-mapping.FATAL</span>=<span class="hljs-string">503</span></code></pre></div><p>è‡ªå®šä¹‰å¥åº·</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaboyHealth</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HealthIndicator</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Health <span class="hljs-title">health</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">//       return Health.status(&quot;FATAL&quot;).withDetail(&quot;msg&quot;,&quot;å‘ç°ä¸¥é‡é—®é¢˜&quot;).build();</span>       <span class="hljs-keyword">return</span> Health.up().withDetail(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;ä¸€åˆ‡æ­£å¸¸...&quot;</span>).build();    &#125;&#125;</code></pre></div><h4 id="åº”ç”¨ä¿¡æ¯"><a href="#åº”ç”¨ä¿¡æ¯" class="headerlink" title="åº”ç”¨ä¿¡æ¯"></a>åº”ç”¨ä¿¡æ¯</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">info.app.encoding</span>=<span class="hljs-string">@project.build.sourceEncoding@</span><span class="hljs-meta">info.app.java.source</span>=<span class="hljs-string">@java.version@</span><span class="hljs-meta">info.app.java.target</span>=<span class="hljs-string">@java.version@</span><span class="hljs-meta">info.author.name</span>=<span class="hljs-string">lucifer</span><span class="hljs-meta">info.author.email</span>=<span class="hljs-string">xx@qq.com</span></code></pre></div><p>æˆ–è€…åœ¨é…ç½®ç±»ä¸­å®šä¹‰</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppInfo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InfoContributor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contribute</span><span class="hljs-params">(Info.Builder builder)</span> </span>&#123;        Map&lt;String, String&gt; link = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        link.put(<span class="hljs-string">&quot;site&quot;</span>, <span class="hljs-string">&quot;www.javaboy.org&quot;</span>);        link.put(<span class="hljs-string">&quot;site-2&quot;</span>, <span class="hljs-string">&quot;www.itboyhub.com&quot;</span>);        builder.withDetail(<span class="hljs-string">&quot;link&quot;</span>, link);    &#125;&#125;</code></pre></div><h4 id="gitç›¸å…³"><a href="#gitç›¸å…³" class="headerlink" title="gitç›¸å…³"></a>gitç›¸å…³</h4><p>å¼•å…¥ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>pl.project13.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>git-commit-id-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210527115729859.png" alt="image-20210527115729859"></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">management.info.git.mode</span>=<span class="hljs-string">full</span></code></pre></div><h4 id="æ„å»ºä¿¡æ¯"><a href="#æ„å»ºä¿¡æ¯" class="headerlink" title="æ„å»ºä¿¡æ¯"></a>æ„å»ºä¿¡æ¯</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>build-info<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210527115712060.png" alt="image-20210527115712060"></p><h3 id="1-3-Admin"><a href="#1-3-Admin" class="headerlink" title="1.3 Admin"></a>1.3 Admin</h3><p>è¿™ä¸ªç®—æ˜¯ Spring Boot ä¸­æœ€æœ€æ­£å®—çš„åº”ç”¨ç›‘æ§å¯è§†åŒ–å·¥å…·äº†ï¼Œçœ‹åå­—å°±çŸ¥é“æœ‰å¤šæ­£å®—ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®æ—¶ï¼Œé€‰æ‹©ä¾èµ–æ—¶å€™å°±æœ‰è¿™ä¸ªé€‰é¡¹ï¼š</p><p><a href="http://img.itboyhub.com/2021/02/20210201173448.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20210201173448.png" alt="img"></a></p><p>å¦‚æœæ˜¯<strong>å•ä½“åº”ç”¨</strong>å¾ˆå¤šäººå¯èƒ½ä¼šé€‰æ‹© Spring Boot Admin ä½œä¸ºç›‘æ§æ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œä¸è¿‡å®ƒä¹Ÿæ”¯æŒå¾®æœåŠ¡åº”ç”¨çš„(å¯ä»¥é€šè¿‡ Eurekaã€Consul ç­‰æ³¨å†Œä¸­å¿ƒè·å–åº”ç”¨ä¿¡æ¯)ï¼Œåªä¸è¿‡åœ¨å¾®æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ›´å¤šçš„é€‰æ‹© Grafana+Prometheus ç»„åˆã€‚</p><p>Spring Boot Admin ä¸»è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š</p><ul><li>æ˜¾ç¤ºåº”ç”¨å¥åº·ä¿¡æ¯ã€‚</li><li>æ˜¾ç¤ºåº”ç”¨è¿è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ JVM å’Œå†…å­˜æŒ‡æ ‡ã€æ•°æ®æºæŒ‡æ ‡ã€ç¼“å­˜æŒ‡æ ‡ç­‰ç­‰ã€‚</li><li>æ˜¾ç¤ºåº”ç”¨çš„æ„å»ºä¿¡æ¯ã€‚</li><li>æŸ¥çœ‹ JVM ç³»ç»Ÿå’Œç¯å¢ƒå±æ€§</li><li>æŸ¥çœ‹ Spring Boot é…ç½®å±æ€§</li><li>æ”¯æŒ Spring Cloud ä¸­çš„ç«¯ç‚¹åˆ·æ–°åŠŸèƒ½ /refresh-endpoint</li><li>æ–¹ä¾¿çš„æ—¥å¿—çº§åˆ«ç®¡ç†åŠŸèƒ½</li><li>å¯ä»¥ä¸ JMX-beans è¿›è¡Œäº¤äº’</li><li>æŸ¥çœ‹ Thread dump</li><li>æŸ¥çœ‹ http è¯·æ±‚</li><li>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</li><li>æŸ¥çœ‹å’Œåˆ é™¤æ´»åŠ¨ä¼šè¯</li><li>æŸ¥çœ‹ Flyway/Liquibase æ•°æ®åº“è¿ç§»</li><li>ä¸‹è½½ heapdump</li><li>çŠ¶æ€æ›´æ”¹é€šçŸ¥</li><li>â€¦</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒSpring Boot Admin ä¸ä»…ä»…æ˜¯å°† Actuator æ¥å£ä¸­çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†åˆ†æã€æŠ¥è­¦ç­‰åŠŸèƒ½ã€‚</p><p>Spring Boot Admin çš„æ˜¾ç¤ºç•Œé¢å¦‚ä¸‹ï¼š</p><p><a href="http://img.itboyhub.com/2021/02/20210201181913.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20210201181913.png" alt="img"></a></p><p><strong>åŸæœ¬å®¢æˆ·ç«¯ä¸Šå¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>è¿™é‡ŒæœåŠ¡ç«¯å¼•å…¥ä¾èµ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>å¯åŠ¨ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableAdminServer</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(AdminApplication.class, args);    &#125;&#125;</code></pre></div><p><strong>æœåŠ¡å™¨æ–‡ä»¶é…ç½®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span><span class="hljs-meta">spring.boot.admin.instance-auth.default-user-name</span>=<span class="hljs-string">javaboy</span><span class="hljs-meta">spring.boot.admin.instance-auth.default-password</span>=<span class="hljs-string">123</span></code></pre></div><p><strong>å®¢æˆ·ç«¯æ–‡ä»¶é…ç½®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.boot.admin.client.url</span>=<span class="hljs-string">http://localhost:8081</span></code></pre></div><h3 id="1-4-é‚®ä»¶æŠ¥è­¦"><a href="#1-4-é‚®ä»¶æŠ¥è­¦" class="headerlink" title="1.4 é‚®ä»¶æŠ¥è­¦"></a>1.4 é‚®ä»¶æŠ¥è­¦</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span><span class="hljs-meta">spring.mail.port</span>=<span class="hljs-string">465</span><span class="hljs-meta">spring.mail.username</span>=<span class="hljs-string">1510161612@qq.com</span><span class="hljs-meta">spring.mail.password</span>=<span class="hljs-string">laikremaxeyqfgbj</span><span class="hljs-meta">spring.mail.default-encoding</span>=<span class="hljs-string">utf-8</span><span class="hljs-meta">spring.mail.properties.mail.smtp.socketFactory.class</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span><span class="hljs-meta">spring.mail.properties.mail.debug</span>=<span class="hljs-string">true</span><span class="hljs-meta">spring.boot.admin.notify.mail.from</span>=<span class="hljs-string">1510161612@qq.com</span><span class="hljs-meta">spring.boot.admin.notify.mail.to</span>=<span class="hljs-string">1470249098@qq.com</span><span class="hljs-comment">#çŠ¶æ€å‘ç”Ÿå˜åŒ–å°±å‘</span><span class="hljs-meta">spring.boot.admin.notify.mail.ignore-changes</span>=<span class="hljs-string"></span></code></pre></div><h1 id="SpringBootæ‰“åŒ…å‘å¸ƒ"><a href="#SpringBootæ‰“åŒ…å‘å¸ƒ" class="headerlink" title="SpringBootæ‰“åŒ…å‘å¸ƒ"></a>SpringBootæ‰“åŒ…å‘å¸ƒ</h1><h2 id="1-å¯æ‰§è¡ŒJar"><a href="#1-å¯æ‰§è¡ŒJar" class="headerlink" title="1. å¯æ‰§è¡ŒJar"></a>1. å¯æ‰§è¡ŒJar</h2><p>Spring Boot ä¸­é»˜è®¤æ‰“åŒ…æˆçš„ jar å«åš å¯æ‰§è¡Œ jarï¼Œè¿™ç§ jar ä¸åŒäºæ™®é€šçš„ jarï¼Œæ™®é€šçš„ jar ä¸å¯ä»¥é€šè¿‡ <code>java -jar xxx.jar</code> å‘½ä»¤æ‰§è¡Œï¼Œæ™®é€šçš„ <code>jar</code> ä¸»è¦æ˜¯è¢«å…¶ä»–åº”ç”¨ä¾èµ–ï¼Œ<code>Spring Boot</code> æ‰“æˆçš„ <code>jar</code> å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯ä¸å¯ä»¥è¢«å…¶ä»–çš„åº”ç”¨æ‰€ä¾èµ–ï¼Œå³ä½¿å¼ºåˆ¶ä¾èµ–ï¼Œä¹Ÿæ— æ³•è·å–é‡Œè¾¹çš„ç±»ã€‚ä½†æ˜¯å¯æ‰§è¡Œ jar å¹¶ä¸æ˜¯ Spring Boot ç‹¬æœ‰çš„ï¼ŒJava å·¥ç¨‹æœ¬èº«å°±å¯ä»¥æ‰“åŒ…æˆå¯æ‰§è¡Œ jar ã€‚</p><p>æœ‰çš„å°ä¼™ä¼´å¯èƒ½å°±æœ‰ç–‘é—®äº†ï¼Œæ—¢ç„¶åŒæ ·æ˜¯æ‰§è¡Œ <code>mvn package</code> å‘½ä»¤è¿›è¡Œé¡¹ç›®æ‰“åŒ…ï¼Œä¸ºä»€ä¹ˆ Spring Boot é¡¹ç›®å°±æ‰“æˆäº†å¯æ‰§è¡Œ jar ï¼Œè€Œæ™®é€šé¡¹ç›®åˆ™æ‰“åŒ…æˆäº†ä¸å¯æ‰§è¡Œ jar å‘¢ï¼Ÿ</p><p>è¿™æˆ‘ä»¬å°±ä¸å¾—ä¸æ Spring Boot é¡¹ç›®ä¸­ä¸€ä¸ªé»˜è®¤çš„æ’ä»¶é…ç½® <code>spring-boot-maven-plugin</code> ï¼Œè¿™ä¸ªæ‰“åŒ…æ’ä»¶å­˜åœ¨ 5 ä¸ªæ–¹é¢çš„åŠŸèƒ½ï¼Œä»æ’ä»¶å‘½ä»¤å°±å¯ä»¥çœ‹å‡ºï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-1.png" alt="img"></p><p>äº”ä¸ªåŠŸèƒ½åˆ†åˆ«æ˜¯ï¼š</p><ul><li>build-infoï¼šç”Ÿæˆé¡¹ç›®çš„æ„å»ºä¿¡æ¯æ–‡ä»¶ build-info.properties</li><li>repackageï¼šè¿™ä¸ªæ˜¯é»˜è®¤ goalï¼Œåœ¨ <code>mvn package</code> æ‰§è¡Œä¹‹åï¼Œè¿™ä¸ªå‘½ä»¤å†æ¬¡æ‰“åŒ…ç”Ÿæˆå¯æ‰§è¡Œçš„ jarï¼ŒåŒæ—¶å°† <code>mvn package</code> ç”Ÿæˆçš„ jar é‡å‘½åä¸º <code>*.origin</code></li><li>runï¼šè¿™ä¸ªå¯ä»¥ç”¨æ¥è¿è¡Œ Spring Boot åº”ç”¨</li><li>startï¼šè¿™ä¸ªåœ¨ <code>mvn integration-test</code> é˜¶æ®µï¼Œè¿›è¡Œ <code>Spring Boot</code> åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li><li>stopï¼šè¿™ä¸ªåœ¨ <code>mvn integration-test</code> é˜¶æ®µï¼Œè¿›è¡Œ <code>Spring Boot</code> åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li></ul><p>è¿™é‡ŒåŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨å°±æ˜¯ repackage åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½è¦ä½¿ç”¨ï¼Œåˆ™éœ€è¦å¼€å‘è€…æ˜¾å¼é…ç½®</p><h2 id="2-æ‰“åŒ…"><a href="#2-æ‰“åŒ…" class="headerlink" title="2. æ‰“åŒ…"></a>2. æ‰“åŒ…</h2><p>æ‰“åŒ…çš„ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>repackage åŠŸèƒ½çš„ ä½œç”¨ï¼Œå°±æ˜¯åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œå¤šåšä¸€ç‚¹é¢å¤–çš„äº‹æƒ…ï¼š</p><ol><li>é¦–å…ˆ <code>mvn package</code> å‘½ä»¤ å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“æˆä¸€ä¸ª <code>jar</code>ï¼Œè¿™ä¸ª <code>jar</code> å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>jar</code>ï¼Œå¯ä»¥è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ï¼Œä½†æ˜¯ä¸å¯ä»¥è¢«æ‰§è¡Œ</li><li><code>repackage</code> å‘½ä»¤ï¼Œå¯¹ç¬¬ä¸€æ­¥ æ‰“åŒ…æˆçš„ <code>jar</code> è¿›è¡Œå†æ¬¡æ‰“åŒ…ï¼Œå°†ä¹‹æ‰“æˆä¸€ä¸ª å¯æ‰§è¡Œ <code>jar</code> ï¼Œé€šè¿‡å°†ç¬¬ä¸€æ­¥æ‰“æˆçš„ <code>jar</code> é‡å‘½åä¸º <code>*.original</code> æ–‡ä»¶</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å¯¹ä»»æ„ä¸€ä¸ª Spring Boot é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œå¯ä»¥æ‰§è¡Œ <code>mvn package</code> å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>IDEA</code> ä¸­ç‚¹å‡» <code>package</code> ï¼Œå¦‚ä¸‹ ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-2.png" alt="img"></p><p>æ‰“åŒ…æˆåŠŸä¹‹åï¼Œ <code>target</code> ä¸­çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-3.png" alt="img"></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ª <code>restful-0.0.1-SNAPSHOT.jar</code> è¡¨ç¤ºæ‰“åŒ…æˆçš„å¯æ‰§è¡Œ <code>jar</code> ï¼Œç¬¬äºŒä¸ª <code>restful-0.0.1-SNAPSHOT.jar.original</code> åˆ™æ˜¯åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ ï¼Œè¢«é‡å‘½åçš„ <code>jar</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¯æ‰§è¡Œ <code>jar</code>ï¼Œä½†æ˜¯å¯ä»¥è¢«å…¶ä»–é¡¹ç›®ä¾èµ–çš„ <code>jar</code>ã€‚é€šè¿‡å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„è§£å‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>å¯æ‰§è¡Œ <code>jar</code> è§£å‹ä¹‹åï¼Œç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-4.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯æ‰§è¡Œ jar ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±çš„ä»£ç æ˜¯å­˜åœ¨ äº <code>BOOT-INF/classes/</code> ç›®å½•ä¸‹ï¼Œå¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>META-INF</code> çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ª <code>MANIFEST.MF</code> æ–‡ä»¶ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">Manifest-Version: 1.0</span><span class="hljs-section">Implementation-Title: restful</span><span class="hljs-section">Implementation-Version: 0.0.1-SNAPSHOT</span><span class="hljs-section">Start-Class: org.javaboy.restful.RestfulApplication</span><span class="hljs-section">Spring-Boot-Classes: BOOT-INF/classes/</span><span class="hljs-section">Spring-Boot-Lib: BOOT-INF/lib/</span><span class="hljs-section">Build-Jdk-Spec: 1.8</span><span class="hljs-section">Spring-Boot-Version: 2.1.6.RELEASE</span><span class="hljs-section">Created-By: Maven Archiver 3.4.0</span><span class="hljs-section">Main-Class: org.springframework.boot.loader.JarLauncher</span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª <code>Start-Class</code>ï¼Œè¿™å°±æ˜¯å¯æ‰§è¡Œ <code>jar</code> çš„å…¥å£ç±»ï¼Œ<code>Spring-Boot-Classes</code> è¡¨ç¤ºæˆ‘ä»¬è‡ªå·±ä»£ç ç¼–è¯‘åçš„ä½ç½®ï¼Œ<code>Spring-Boot-Lib</code> åˆ™è¡¨ç¤ºé¡¹ç›®ä¾èµ–çš„ <code>jar</code> çš„ä½ç½®ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœè‡ªå·±è¦æ‰“ä¸€ä¸ªå¯æ‰§è¡Œ <code>jar</code> åŒ…çš„è¯ï¼Œé™¤äº†æ·»åŠ ç›¸å…³ä¾èµ–ä¹‹å¤–ï¼Œè¿˜éœ€è¦é…ç½® <code>META-INF/MANIFEST.MF</code> æ–‡ä»¶ã€‚</p><p>è¿™æ˜¯å¯æ‰§è¡Œ jar çš„ç»“æ„ï¼Œé‚£ä¹ˆä¸å¯æ‰§è¡Œ jar çš„ç»“æ„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬é¦–å…ˆå°†é»˜è®¤çš„åç¼€ <code>.original</code> é™¤å»ï¼Œç„¶åç»™æ–‡ä»¶é‡å‘½åï¼Œé‡å‘½åå®Œæˆï¼Œè¿›è¡Œè§£å‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-5.png" alt="img"></p><p>è§£å‹åå¯ä»¥çœ‹åˆ°ï¼Œä¸å¯æ‰§è¡Œ <code>jar</code> æ ¹ç›®å½•å°±ç›¸å½“äºæˆ‘ä»¬çš„ <code>classpath</code>ï¼Œè§£å‹ä¹‹åï¼Œç›´æ¥å°±èƒ½çœ‹åˆ°æˆ‘ä»¬çš„ä»£ç ï¼Œå®ƒä¹Ÿæœ‰ <code>META-INF/MANIFEST.MF</code> æ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰å¯åŠ¨ç±»ç­‰ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">Manifest-Version: 1.0</span><span class="hljs-section">Implementation-Title: restful</span><span class="hljs-section">Implementation-Version: 0.0.1-SNAPSHOT</span><span class="hljs-section">Build-Jdk-Spec: 1.8</span><span class="hljs-section">Created-By: Maven Archiver 3.4.0</span></code></pre></div><p><strong>æ³¨æ„</strong></p><p>è¿™ä¸ªä¸å¯ä»¥æ‰§è¡Œ <code>jar</code> ä¹Ÿæ²¡æœ‰å°†é¡¹ç›®çš„ä¾èµ–æ‰“åŒ…è¿›æ¥ã€‚</p><p>ä»è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ª <code>jar</code> ï¼Œè™½ç„¶éƒ½æ˜¯ <code>jar</code> åŒ…ï¼Œä½†æ˜¯å†…éƒ¨ç»“æ„æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå› æ­¤ä¸€ä¸ªå¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œå¦ä¸€ä¸ªåˆ™å¯ä»¥è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ã€‚</p><p><strong>è‡ªå®šä¹‰jaråŒ…åç¼€</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒSpring Boot ç›´æ¥æ‰“åŒ…æˆå¯æ‰§è¡Œ <code>jar</code> å°±å¯ä»¥äº†ï¼Œä¸å»ºè®®å°† Spring Boot ä½œä¸ºæ™®é€šçš„ <code>jar</code> è¢«å…¶ä»–çš„é¡¹ç›®æ‰€ä¾èµ–ã€‚å¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œå»ºè®®å°†è¢«ä¾èµ–çš„éƒ¨åˆ†ï¼Œå•ç‹¬æŠ½å‡ºæ¥åšä¸€ä¸ªæ™®é€šçš„ <code>Maven</code> é¡¹ç›®ï¼Œç„¶ååœ¨ Spring Boot ä¸­å¼•ç”¨è¿™ä¸ª <code>Maven</code> é¡¹ç›®ã€‚</p><p>å¦‚æœéè¦å°† Spring Boot æ‰“åŒ…æˆä¸€ä¸ªæ™®é€š <code>jar</code> è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ï¼ŒæŠ€æœ¯ä¸Šæ¥è¯´ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç»™ <code>spring-boot-maven-plugin</code> æ’ä»¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>é…ç½®çš„ <code>classifier</code> è¡¨ç¤ºå¯æ‰§è¡Œ <code>jar</code> çš„åå­—ï¼Œé…ç½®äº†è¿™ä¸ªä¹‹åï¼Œåœ¨æ’ä»¶æ‰§è¡Œ <code>repackage</code> å‘½ä»¤æ—¶ï¼Œå°±ä¸ä¼šç»™ <code>mvn package</code> æ‰€æ‰“æˆçš„ <code>jar</code> é‡å‘½åäº†ï¼Œæ‰€ä»¥ï¼Œæ‰“åŒ…åçš„ jar å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/23-6.png" alt="img"></p><p>ç¬¬ä¸€ä¸ª jar è¡¨ç¤ºå¯ä»¥è¢«å…¶ä»–é¡¹ç›®ä¾èµ–çš„ jar ï¼Œç¬¬äºŒä¸ª jar åˆ™è¡¨ç¤ºä¸€ä¸ªå¯æ‰§è¡Œ jarã€‚</p><p><strong>è¡¥å……</strong></p><p>å¯æ‰§è¡Œ jar çš„æ–‡ä»¶å¤§å°éƒ½å¾ˆå¤§ï¼Œå› ä¸ºåŒ…å«äº†æ‰“åŒ…é¡¹ç›®æ‰€ä¾èµ–çš„jaråŒ…ï¼Œå¦‚æœä¸éœ€è¦æ‰“åŒ…çš„æ—¶å€™æŠŠè¿™äº›åŒ…ä¹ŸåŠ è¿›æ¥ï¼Œå¯è¿›è¡Œå¦‚ä¸‹é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>org.javaboy.client.ClientApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span>ZIP<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.javaboy<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>è¿™æ ·æ‰“åŒ…åçš„jarä½“ç§¯å°±å¾ˆå°äº†ï¼Œå¦‚æœè¦æ‰§è¡Œéœ€è¦åŠ ä¸ŠåŸå…ˆlibæ‰€åœ¨çš„ç›®å½•</p><div class="hljs code-wrapper"><pre><code class="hljs shell">java -Dloader.path=./xx/BOOT-INF/lib/ -jar xxx-exec.jar</code></pre></div><p><strong>waråŒ…</strong></p><p>åœ¨åˆ›å»ºå·¥ç¨‹çš„æ—¶å€™é€‰æ‹©warï¼Œåœ¨ä¾èµ–ä¸­ä¼šå¤šä¸€ä¸ªtomcatçš„ä¾èµ–</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¹¶å¤šäº†ä¸€ä¸ªåˆå§‹åŒ–çš„ç±»</p>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring</title>
    <link href="/2021/08/01/Spring/"/>
    <url>/2021/08/01/Spring/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h1 id="ç¬¬ä¸€ç« ã€Springå·¥å‚"><a href="#ç¬¬ä¸€ç« ã€Springå·¥å‚" class="headerlink" title="ç¬¬ä¸€ç« ã€Springå·¥å‚"></a>ç¬¬ä¸€ç« ã€Springå·¥å‚</h1><h2 id="1-å¼•è¨€"><a href="#1-å¼•è¨€" class="headerlink" title="1. å¼•è¨€"></a>1. å¼•è¨€</h2><h3 id="1-1-EJBå­˜åœ¨çš„é—®é¢˜"><a href="#1-1-EJBå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="1.1 EJBå­˜åœ¨çš„é—®é¢˜"></a>1.1 EJBå­˜åœ¨çš„é—®é¢˜</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200411104428457.png" alt="image-20200411104428457"></p><h3 id="1-2-ä»€ä¹ˆæ˜¯Spring"><a href="#1-2-ä»€ä¹ˆæ˜¯Spring" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯Spring"></a>1.2 ä»€ä¹ˆæ˜¯Spring</h3><blockquote><p>Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„JavaEEè§£å†³æ–¹æ¡ˆï¼Œæ•´åˆä¼—å¤šä¼˜ç§€çš„è®¾è®¡æ¨¡å¼</p></blockquote><p><strong>è½»é‡çº§</strong></p><ul><li>å¯¹äºè¿è¡Œç¯å¢ƒæ˜¯æ²¡æœ‰é¢å¤–è¦æ±‚çš„<ul><li>å¼€æº tomcat resion jetty<br>æ”¶è´¹ weblogic  websphere </li></ul></li><li>ä»£ç ç§»æ¤æ€§é«˜<ul><li>ä¸éœ€è¦å®ç°é¢å¤–æ¥å£</li></ul></li></ul><p><strong>JavaEEçš„è§£å†³æ–¹æ¡ˆ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200411111041836.png" alt="image-20200411111041836"></p><p><strong>æ•´åˆè®¾è®¡æ¨¡å¼</strong></p><ul><li>å·¥å‚</li><li>ä»£ç†</li><li>æ¨¡æ¿</li><li>ç­–ç•¥</li></ul><h3 id="1-3-è®¾è®¡æ¨¡å¼"><a href="#1-3-è®¾è®¡æ¨¡å¼" class="headerlink" title="1.3 è®¾è®¡æ¨¡å¼"></a>1.3 è®¾è®¡æ¨¡å¼</h3><p><strong>å¹¿ä¹‰æ¦‚å¿µ</strong></p><blockquote><p>é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œè§£å†³ç‰¹å®šé—®é¢˜çš„ç»å…¸ä»£ç </p></blockquote><p><strong>ç‹­ä¹‰æ¦‚å¿µ</strong></p><blockquote><p>GOF4äººå¸®å®šä¹‰çš„23ç§è®¾è®¡æ¨¡å¼ï¼šå·¥å‚ã€é€‚é…å™¨ã€è£…é¥°å™¨ã€é—¨é¢ã€ä»£ç†ã€æ¨¡æ¿â€¦</p></blockquote><h3 id="1-4-å·¥å‚è®¾è®¡æ¨¡å¼"><a href="#1-4-å·¥å‚è®¾è®¡æ¨¡å¼" class="headerlink" title="1.4 å·¥å‚è®¾è®¡æ¨¡å¼"></a>1.4 å·¥å‚è®¾è®¡æ¨¡å¼</h3><h4 id="1-4-1-ä»€ä¹ˆæ˜¯å·¥å‚è®¾è®¡æ¨¡å¼"><a href="#1-4-1-ä»€ä¹ˆæ˜¯å·¥å‚è®¾è®¡æ¨¡å¼" class="headerlink" title="1.4.1 ä»€ä¹ˆæ˜¯å·¥å‚è®¾è®¡æ¨¡å¼"></a>1.4.1 ä»€ä¹ˆæ˜¯å·¥å‚è®¾è®¡æ¨¡å¼</h4><ul><li><p>æ¦‚å¿µï¼šé€šè¿‡å·¥å‚ç±»ï¼Œåˆ›å»ºå¯¹è±¡</p>  <div class="hljs code-wrapper"><pre><code class="hljs java">User user = <span class="hljs-keyword">new</span> User();UserDAO userDAO = <span class="hljs-keyword">new</span> UserDAOImpl();</code></pre></div></li><li><p>å¥½å¤„ï¼šè§£è€¦åˆ</p><ul><li><p>è€¦åˆï¼šæŒ‡å®šæ˜¯ä»£ç é—´çš„å¼ºå…³è”å…³ç³»ï¼Œä¸€æ–¹çš„æ”¹å˜ä¼šå½±å“åˆ°å¦ä¸€æ–¹</p></li><li><p>é—®é¢˜ï¼šä¸åˆ©äºä»£ç ç»´æŠ¤</p></li><li><p>ç®€å•ï¼šæŠŠæ¥å£çš„å®ç°ç±»ï¼Œç¡¬ç¼–ç åœ¨ç¨‹åºä¸­</p> <div class="hljs code-wrapper"><pre><code class="hljs java">UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();</code></pre></div></li></ul></li></ul><h4 id="1-4-2-ç®€å•å·¥å‚çš„è®¾è®¡"><a href="#1-4-2-ç®€å•å·¥å‚çš„è®¾è®¡" class="headerlink" title="1.4.2 ç®€å•å·¥å‚çš„è®¾è®¡"></a>1.4.2 ç®€å•å·¥å‚çš„è®¾è®¡</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<span class="hljs-comment">/* å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼š</span><span class="hljs-comment">1. ç›´æ¥è°ƒç”¨æ„é€ æ–¹æ³• åˆ›å»ºå¯¹è±¡  UserService userService = new UserServiceImpl();</span><span class="hljs-comment">2. é€šè¿‡åå°„çš„å½¢å¼ åˆ›å»ºå¯¹è±¡ è§£è€¦åˆ</span><span class="hljs-comment">//com.baizhiedu.basic.UserServiceImpl,ç±»åæ”¹å˜ä¹Ÿä¼šæ”¹å˜</span><span class="hljs-comment"> Class clazz = Class.forName(&quot;com.baizhiedu.basic.UserServiceImpl&quot;);</span><span class="hljs-comment">    UserService userService = (UserService)clazz.newInstance();*/</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title">getUserService</span><span class="hljs-params">()</span> </span>&#123;    UserService userService = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;                                     <span class="hljs-comment">//com.baizhiedu.basic.UserServiceImpl,ç±»åæ”¹å˜ä¹Ÿä¼šæ”¹å˜</span> Class clazz = Class.forName(<span class="hljs-string">&quot;com.baizhiedu.basic.UserServiceImpl&quot;</span>);    UserService userService = (UserService)clazz.newInstance();    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;        e.printStackTrace();    &#125; <span class="hljs-keyword">catch</span> (InstantiationException e) &#123;        e.printStackTrace();    &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;        e.printStackTrace();    &#125;    <span class="hljs-keyword">return</span> userService;&#125;&#125;</code></pre></div><p>é€šè¿‡åå°„çš„å½¢å¼åˆ›å»ºå¯¹è±¡æ¥è§£è€¦åˆï¼Œä½†<code>com.baizhiedu.basic.UserServiceImpl</code>æ”¹å˜<code>Class.forName(&quot;com.baizhiedu.basic.UserServiceImpl&quot;)</code>ä¹Ÿä¼šæ”¹å˜ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è§£è€¦ï¼Œå¯ä»¥åˆ©ç”¨Propertiesæ–‡ä»¶æ¥è¿›è¡Œç®¡ç†ï¼Œé…ç½®æ–‡ä»¶<code>applicationContext.properties</code></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># Properties é›†åˆ å­˜å‚¨ Propertiesæ–‡ä»¶çš„å†…å®¹</span><span class="hljs-comment"># ç‰¹æ®ŠMap key=String value=String</span><span class="hljs-comment"># Properties [userService = com.baizhiedu.xxx.UserServiceImpl]</span><span class="hljs-comment"># Properties.getProperty(&quot;userService&quot;)</span><span class="hljs-attr">userService</span> = <span class="hljs-string">com.baizhiedu.basic.UserServiceImpl</span><span class="hljs-attr">userDAO</span> = <span class="hljs-string">com.baizhiedu.basic.UserDAOImpl</span></code></pre></div><p><strong>ä¸‹é¢åˆ©ç”¨Propertiesæ¥è°ƒç”¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanFactory</span> </span>&#123;    <span class="hljs-comment">//åˆ›å»ºå¯¹è±¡</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Properties env = <span class="hljs-keyword">new</span> Properties();    <span class="hljs-keyword">static</span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//ç¬¬ä¸€æ­¥ è·å¾—IOè¾“å…¥æµ</span>            InputStream inputStream = BeanFactory.class.getResourceAsStream(<span class="hljs-string">&quot;/applicationContext.properties&quot;</span>);            <span class="hljs-comment">//ç¬¬äºŒæ­¥ æ–‡ä»¶å†…å®¹ å°è£… Propertiesé›†åˆä¸­ key = userService value = com.baizhixx.UserServiceImpl</span>            env.load(inputStream);          <span class="hljs-comment">//å…³é—­æµ</span>            inputStream.close();        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title">getUserService</span><span class="hljs-params">()</span> </span>&#123;    UserService userService = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;      <span class="hljs-comment">//åˆ©ç”¨getPropertyè°ƒç”¨applicationContext.propertiesä¸­çš„userService</span>        Class clazz = Class.forName(env.getProperty(<span class="hljs-string">&quot;userService&quot;</span>));        userService = (UserService) clazz.newInstance();    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;        e.printStackTrace();    &#125; <span class="hljs-keyword">catch</span> (InstantiationException e) &#123;        e.printStackTrace();    &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;        e.printStackTrace();    &#125;    <span class="hljs-keyword">return</span> userService;&#125;&#125;     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserDAO <span class="hljs-title">getUserDAO</span><span class="hljs-params">()</span></span>&#123;        UserDAO userDAO = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;          <span class="hljs-comment">//åŒç†</span>            Class clazz = Class.forName(env.getProperty(<span class="hljs-string">&quot;userDAO&quot;</span>));            userDAO = (UserDAO) clazz.newInstance();        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (InstantiationException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> userDAO;    &#125;&#125;</code></pre></div><h4 id="1-4-3-é€šç”¨å·¥å‚çš„è®¾è®¡"><a href="#1-4-3-é€šç”¨å·¥å‚çš„è®¾è®¡" class="headerlink" title="1.4.3 é€šç”¨å·¥å‚çš„è®¾è®¡"></a>1.4.3 é€šç”¨å·¥å‚çš„è®¾è®¡</h4><ul><li>ç®€å•å·¥å‚ä¼šå­˜åœ¨å¤§é‡çš„ä»£ç å†—ä½™</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200411181701143.png" alt="image-20200411181701143"></p><ul><li><p>é€šç”¨å·¥å‚çš„ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åˆ›å»ºä¸€åˆ‡æƒ³è¦çš„å¯¹è±¡</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanFactory</span></span>&#123;  <span class="hljs-comment">//ä¼ å‚</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">getBean</span><span class="hljs-params">(String key)</span></span>&#123;         Object ret = <span class="hljs-keyword">null</span>;         <span class="hljs-keyword">try</span> &#123;           <span class="hljs-comment">//ä¼ å…¥å‚æ•°keyï¼Œä¸å†æ‰‹å†™</span>             Class clazz = Class.forName(env.getProperty(key));             ret = clazz.newInstance();         &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();         &#125;         <span class="hljs-keyword">return</span> ret;     &#125;&#125;</code></pre></div></li></ul><h4 id="1-4-4-é€šç”¨å·¥å‚çš„ä½¿ç”¨æ–¹å¼"><a href="#1-4-4-é€šç”¨å·¥å‚çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="1.4.4 é€šç”¨å·¥å‚çš„ä½¿ç”¨æ–¹å¼"></a>1.4.4 é€šç”¨å·¥å‚çš„ä½¿ç”¨æ–¹å¼</h4><ul><li>å®šä¹‰ç±»å‹ (ç±»)</li><li>é€šè¿‡é…ç½®æ–‡ä»¶çš„é…ç½®å‘ŠçŸ¥å·¥å‚<code>applicationContext.properties</code><br> <code>key = value</code></li><li>é€šè¿‡å·¥å‚è·å¾—ç±»çš„å¯¹è±¡<br> <code>Object ret = BeanFactory.getBean(&quot;key&quot;)</code></li></ul><h3 id="1-5-æ€»ç»“"><a href="#1-5-æ€»ç»“" class="headerlink" title="1.5 æ€»ç»“"></a>1.5 æ€»ç»“</h3><p><strong>Springæœ¬è´¨</strong></p><p>å·¥å‚ <code>ApplicationContext (applicationContext.xml)</code></p><h2 id="2-ç¬¬ä¸€ä¸ªSpringç¨‹åº"><a href="#2-ç¬¬ä¸€ä¸ªSpringç¨‹åº" class="headerlink" title="2. ç¬¬ä¸€ä¸ªSpringç¨‹åº"></a>2. ç¬¬ä¸€ä¸ªSpringç¨‹åº</h2><h3 id="2-1-è½¯ä»¶ç‰ˆæœ¬"><a href="#2-1-è½¯ä»¶ç‰ˆæœ¬" class="headerlink" title="2.1 è½¯ä»¶ç‰ˆæœ¬"></a>2.1 è½¯ä»¶ç‰ˆæœ¬</h3><ul><li><strong>JDK1.8+</strong></li><li><strong>Maven3.5+</strong></li><li><strong>IDEA2018+</strong></li><li><strong>SpringFramework 5.1.4</strong> </li></ul><h3 id="2-2-ç¯å¢ƒæ­å»º"><a href="#2-2-ç¯å¢ƒæ­å»º" class="headerlink" title="2.2 ç¯å¢ƒæ­å»º"></a>2.2 ç¯å¢ƒæ­å»º</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>Springçš„é…ç½®æ–‡ä»¶</p><ul><li>é…ç½®æ–‡ä»¶çš„æ”¾ç½®ä½ç½®ï¼šä»»æ„ä½ç½®</li><li>é…ç½®æ–‡ä»¶çš„å‘½å <ul><li>å»ºè®®ï¼š<code>applicationContext.xml</code></li></ul></li></ul><p>æ—¥ååº”ç”¨Springæ¡†æ¶æ—¶ï¼Œéœ€è¦è¿›è¡Œé…ç½®æ–‡ä»¶è·¯å¾„çš„è®¾ç½®</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200413114751707.png" alt="image-20200413114751707"></p><h3 id="2-3-Springçš„æ ¸å¿ƒAPI"><a href="#2-3-Springçš„æ ¸å¿ƒAPI" class="headerlink" title="2.3 Springçš„æ ¸å¿ƒAPI"></a>2.3 Springçš„æ ¸å¿ƒAPI</h3><p><code>ApplicationContext</code></p><ul><li>ä½œç”¨ï¼šSpringæä¾›çš„ApplicationContextè¿™ä¸ªå·¥å‚ï¼Œç”¨äºå¯¹è±¡çš„åˆ›å»º</li><li>å¥½å¤„ï¼šè§£è€¦åˆ</li></ul><p><strong>ApplicationContextæ¥å£ç±»å‹</strong></p><ul><li>æ¥å£ï¼šå±è”½å®ç°çš„å·®å¼‚</li><li>éwebç¯å¢ƒ ï¼š <code>ClassPathXmlApplicationContext (main junit)</code></li><li>webç¯å¢ƒ  ï¼š <code> XmlWebApplicationContext</code></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200413142452724.png" alt="image-20200413142452724"></p><p><strong>é‡é‡çº§èµ„æº</strong></p><ul><li>ApplicationContextå·¥å‚çš„å¯¹è±¡å ç”¨å¤§é‡å†…å­˜</li><li>ä¸ä¼šé¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ ï¼š ä¸€ä¸ªåº”ç”¨åªä¼šåˆ›å»ºä¸€ä¸ªå·¥å‚å¯¹è±¡</li><li>ApplicationContextå·¥å‚ï¼šä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„(å¤šçº¿ç¨‹å¹¶å‘è®¿é—®)</li></ul><h3 id="2-4-ç¨‹åºå¼€å‘"><a href="#2-4-ç¨‹åºå¼€å‘" class="headerlink" title="2.4 ç¨‹åºå¼€å‘"></a>2.4 ç¨‹åºå¼€å‘</h3><p>åˆ›å»ºç±»å‹ï¼Œé…ç½®æ–‡ä»¶çš„é…ç½® <code>applicationContext.xml</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.basic.Person&quot;</span>/&gt;</span></code></pre></div><p> é€šè¿‡å·¥å‚ç±»ï¼Œè·å¾—å¯¹è±¡<code>ApplicationContext</code>ä¸<code>ClassPathXmlApplicationContext</code></p><div class="hljs code-wrapper"><pre><code class="hljs java">ApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;/applicationContext.xml&quot;</span>);Person person = (Person)ctx.getBean(<span class="hljs-string">&quot;person&quot;</span>);</code></pre></div><h3 id="2-5-ç»†èŠ‚åˆ†æ"><a href="#2-5-ç»†èŠ‚åˆ†æ" class="headerlink" title="2.5 ç»†èŠ‚åˆ†æ"></a>2.5 ç»†èŠ‚åˆ†æ</h3><p><strong>åè¯è§£é‡Š</strong></p><blockquote><p>Springå·¥å‚åˆ›å»ºçš„å¯¹è±¡ï¼Œå«åšbeanæˆ–è€…ç»„ä»¶(componet)        </p></blockquote><p><strong>Springå·¥å‚çš„ç›¸å…³çš„æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡è¿™ç§æ–¹å¼è·å¾—å¯¹è±¡ï¼Œå°±ä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢</span>Person person = ctx.getBean(<span class="hljs-string">&quot;person&quot;</span>, Person.class);System.out.println(<span class="hljs-string">&quot;person = &quot;</span> + person);        <span class="hljs-comment">//å½“å‰Springçš„é…ç½®æ–‡ä»¶ä¸­ åªèƒ½æœ‰ä¸€ä¸ª&lt;bean classæ˜¯Personç±»å‹</span>Person person = ctx.getBean(Person.class);System.out.println(<span class="hljs-string">&quot;person = &quot;</span> + person);        <span class="hljs-comment">//è·å–çš„æ˜¯ Springå·¥å‚é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰beanæ ‡ç­¾çš„idå€¼  person person1</span>String[] beanDefinitionNames = ctx.getBeanDefinitionNames();<span class="hljs-keyword">for</span> (String beanDefinitionName : beanDefinitionNames) &#123;  System.out.println(<span class="hljs-string">&quot;beanDefinitionName = &quot;</span> + beanDefinitionName);&#125;        <span class="hljs-comment">//æ ¹æ®ç±»å‹è·å¾—Springé…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„idå€¼</span>String[] beanNamesForType = ctx.getBeanNamesForType(Person.class);<span class="hljs-keyword">for</span> (String id : beanNamesForType) &#123;  System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + id);&#125;        <span class="hljs-comment">//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šidå€¼å¾—bean</span><span class="hljs-keyword">if</span> (ctx.containsBeanDefinition(<span class="hljs-string">&quot;a&quot;</span>)) &#123;  System.out.println(<span class="hljs-string">&quot;true = &quot;</span> + <span class="hljs-keyword">true</span>);&#125;<span class="hljs-keyword">else</span>&#123;  System.out.println(<span class="hljs-string">&quot;false = &quot;</span> + <span class="hljs-keyword">false</span>);&#125;      <span class="hljs-comment">//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šidå€¼å¾—bean</span><span class="hljs-keyword">if</span> (ctx.containsBean(<span class="hljs-string">&quot;person&quot;</span>)) &#123;  System.out.println(<span class="hljs-string">&quot;true = &quot;</span> + <span class="hljs-keyword">true</span>);&#125;<span class="hljs-keyword">else</span>&#123;  System.out.println(<span class="hljs-string">&quot;false = &quot;</span> + <span class="hljs-keyword">false</span>);&#125;</code></pre></div><p><strong>é…ç½®æ–‡ä»¶ä¸­éœ€è¦æ³¨æ„çš„ç»†èŠ‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1. åªé…ç½®classå±æ€§</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.basic.Person&quot;</span>/&gt;</span></span><span class="hljs-bullet">1.</span> ä¸Šè¿°è¿™ç§é…ç½® æœ‰idå€¼com.baizhiedu.basic.Person#0<span class="hljs-bullet">2.</span> å¦‚æœè¿™ä¸ªbeanåªéœ€è¦ä½¿ç”¨ä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥çœç•¥idå€¼<span class="hljs-code"> å¦‚æœè¿™ä¸ªbeanä¼šä½¿ç”¨å¤šæ¬¡ï¼Œæˆ–è€…è¢«å…¶ä»–beanå¼•ç”¨åˆ™éœ€è¦è®¾ç½®idå€¼</span><span class="hljs-code"></span><span class="hljs-code"># 2. nameå±æ€§</span><span class="hljs-code">ä½œç”¨ï¼šç”¨äºåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸ºbeanå¯¹è±¡å®šä¹‰åˆ«å(å°å)</span><span class="hljs-code">ç›¸åŒï¼š</span><span class="hljs-code">   1. ctx.getBean(&quot;id|name&quot;)--&gt;object</span><span class="hljs-code">   </span><span class="hljs-code">   2. &lt;bean id=&quot;&quot; class=&quot;&quot;</span><span class="hljs-code">      ç­‰æ•ˆ</span><span class="hljs-code">      &lt;bean name=&quot;&quot; class=&quot;&quot;</span><span class="hljs-code">åŒºåˆ«ï¼š</span><span class="hljs-code">   1. åˆ«åå¯ä»¥å®šä¹‰å¤šä¸ª,ä½†æ˜¯idå±æ€§åªèƒ½æœ‰ä¸€ä¸ªå€¼</span><span class="hljs-code">   </span><span class="hljs-code">   2. XMLçš„idå±æ€§çš„å€¼ï¼Œä»¥å‰å‘½åè¦æ±‚ï¼šå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œå­—æ¯ æ•°å­— ä¸‹åˆ’çº¿ è¿å­—ç¬¦ ä¸èƒ½ä»¥ç‰¹æ®Šå­—ç¬¦å¼€å¤´ å¦‚/person</span><span class="hljs-code">      nameå±æ€§çš„å€¼ï¼Œå‘½åæ²¡æœ‰è¦æ±‚ å¦‚/person</span><span class="hljs-code">      nameå±æ€§ä¼šåº”ç”¨åœ¨ç‰¹æ®Šå‘½åçš„åœºæ™¯ä¸‹</span><span class="hljs-code">      XMLå‘å±•åˆ°äº†ä»Šå¤©ï¼šIDå±æ€§çš„é™åˆ¶ï¼Œä¸å­˜åœ¨ å¯ä»¥ä½¿ç”¨/person</span><span class="hljs-code">   </span><span class="hljs-code">   3. ä»£ç </span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java">  <span class="hljs-comment">//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šidå€¼å¾—bean,ä¸èƒ½åˆ¤æ–­nameå€¼    </span><span class="hljs-keyword">if</span> (ctx.containsBeanDefinition(<span class="hljs-string">&quot;person&quot;</span>)) &#123;          System.out.println(<span class="hljs-string">&quot;true = &quot;</span> + <span class="hljs-keyword">true</span>);      &#125;<span class="hljs-keyword">else</span>&#123;          System.out.println(<span class="hljs-string">&quot;false = &quot;</span> + <span class="hljs-keyword">false</span>);      &#125;  <span class="hljs-comment">//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šidå€¼å¾—bean,ä¹Ÿå¯ä»¥åˆ¤æ–­nameå€¼</span>  <span class="hljs-keyword">if</span> (ctx.containsBean(<span class="hljs-string">&quot;p&quot;</span>)) &#123;      System.out.println(<span class="hljs-string">&quot;true = &quot;</span> + <span class="hljs-keyword">true</span>);  &#125;<span class="hljs-keyword">else</span>&#123;      System.out.println(<span class="hljs-string">&quot;false = &quot;</span> + <span class="hljs-keyword">false</span>);  &#125;</code></pre></div><h3 id="2-6-Springå·¥å‚çš„åº•å±‚å®ç°åŸç†-ç®€æ˜“ç‰ˆ"><a href="#2-6-Springå·¥å‚çš„åº•å±‚å®ç°åŸç†-ç®€æ˜“ç‰ˆ" class="headerlink" title="2.6 Springå·¥å‚çš„åº•å±‚å®ç°åŸç†(ç®€æ˜“ç‰ˆ)"></a>2.6 Springå·¥å‚çš„åº•å±‚å®ç°åŸç†(ç®€æ˜“ç‰ˆ)</h3><p>Springå·¥å‚æ˜¯å¯ä»¥<strong>è°ƒç”¨å¯¹è±¡ç§æœ‰çš„æ„é€ æ–¹æ³•</strong>åˆ›å»ºå¯¹è±¡</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200415113032782.png" alt="image-20200415113032782"></p><h3 id="2-7-æ€è€ƒ"><a href="#2-7-æ€è€ƒ" class="headerlink" title="2.7 æ€è€ƒ"></a>2.7 æ€è€ƒ</h3><p>é—®é¢˜ï¼šæœªæ¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡ï¼Œéƒ½ä¼šäº¤ç»™Springå·¥å‚æ¥åˆ›å»ºå‘¢ï¼Ÿ<br>å›ç­”ï¼šç†è®ºä¸Š æ˜¯çš„ï¼Œä½†æ˜¯æœ‰ç‰¹ä¾‹ ï¼š<strong>å®ä½“å¯¹è±¡(entity)æ˜¯ä¸ä¼šäº¤ç»™Springåˆ›å»º</strong>ï¼Œå®ƒæ˜¯ç”±æŒä¹…å±‚æ¡†æ¶è¿›è¡Œåˆ›å»º</p><h2 id="3-Spring5-xä¸æ—¥å¿—æ¡†æ¶çš„æ•´åˆ"><a href="#3-Spring5-xä¸æ—¥å¿—æ¡†æ¶çš„æ•´åˆ" class="headerlink" title="3. Spring5.xä¸æ—¥å¿—æ¡†æ¶çš„æ•´åˆ"></a>3. Spring5.xä¸æ—¥å¿—æ¡†æ¶çš„æ•´åˆ</h2><blockquote><p>Springä¸æ—¥å¿—æ¡†æ¶è¿›è¡Œæ•´åˆï¼Œæ—¥å¿—æ¡†æ¶å°±å¯ä»¥åœ¨æ§åˆ¶å°ä¸­ï¼Œè¾“å‡ºSpringæ¡†æ¶è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›é‡è¦çš„ä¿¡æ¯ã€‚<br>å¥½å¤„ï¼šä¾¿äºäº†è§£Springæ¡†æ¶çš„è¿è¡Œè¿‡ç¨‹ï¼Œåˆ©äºç¨‹åºçš„è°ƒè¯•</p></blockquote><p><strong>é»˜è®¤</strong></p><p>  Spring1.2.3æ—©æœŸéƒ½æ˜¯äº<code>commons-logging.jar</code><br>  Spring5.xé»˜è®¤æ•´åˆçš„æ—¥å¿—æ¡†æ¶ <code>logback log4j2</code></p><p><strong>Spring5.xæ•´åˆlog4j</strong> </p><ul><li>å¼•å…¥<code>log4j jar</code>åŒ…</li><li>å¼•å…¥<code>log4.properties</code>é…ç½®æ–‡ä»¶</li></ul><p><code>pom</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><code>log4j.properties</code></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># resourcesæ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹</span><span class="hljs-comment">### é…ç½®æ ¹</span><span class="hljs-meta">log4j.rootLogger</span> = <span class="hljs-string">debug,console</span><span class="hljs-comment">### æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°æ˜¾ç¤º</span><span class="hljs-meta">log4j.appender.console</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><span class="hljs-meta">log4j.appender.console.Target</span>=<span class="hljs-string">System.out</span><span class="hljs-meta">log4j.appender.console.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><span class="hljs-meta">log4j.appender.console.layout.ConversionPattern</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p %c&#123;1&#125;:%L - %m%n</span></code></pre></div><h2 id="4-æ³¨å…¥-Injection"><a href="#4-æ³¨å…¥-Injection" class="headerlink" title="4. æ³¨å…¥(Injection)"></a>4. æ³¨å…¥(Injection)</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯æ³¨å…¥"><a href="#4-1-ä»€ä¹ˆæ˜¯æ³¨å…¥" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯æ³¨å…¥"></a>4.1 ä»€ä¹ˆæ˜¯æ³¨å…¥</h3><blockquote><p>é€šè¿‡Springå·¥å‚åŠé…ç½®æ–‡ä»¶ï¼Œä¸ºæ‰€åˆ›å»ºå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹å€¼</p></blockquote><h4 id="4-1-1-ä¸ºä»€ä¹ˆéœ€è¦æ³¨å…¥"><a href="#4-1-1-ä¸ºä»€ä¹ˆéœ€è¦æ³¨å…¥" class="headerlink" title="4.1.1 ä¸ºä»€ä¹ˆéœ€è¦æ³¨å…¥"></a>4.1.1 ä¸ºä»€ä¹ˆéœ€è¦æ³¨å…¥</h4><p><strong>é€šè¿‡ç¼–ç çš„æ–¹å¼ï¼Œä¸ºæˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œå­˜åœ¨è€¦åˆ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200415185212664.png" alt="image-20200415185212664"></p><h4 id="4-1-2-å¦‚ä½•è¿›è¡Œæ³¨å…¥-å¼€å‘æ­¥éª¤"><a href="#4-1-2-å¦‚ä½•è¿›è¡Œæ³¨å…¥-å¼€å‘æ­¥éª¤" class="headerlink" title="4.1.2 å¦‚ä½•è¿›è¡Œæ³¨å…¥[å¼€å‘æ­¥éª¤]"></a>4.1.2 å¦‚ä½•è¿›è¡Œæ³¨å…¥[å¼€å‘æ­¥éª¤]</h4><p>ç±»çš„æˆå‘˜å˜é‡æä¾›set getæ–¹æ³•</p><p>é…ç½®springçš„é…ç½®æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.basic.Person&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>xiaojr<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>é€šè¿‡æ³¨å…¥ï¼Œè¾¾åˆ°<strong>è§£è€¦åˆ</strong>çš„ç›®çš„</p><h3 id="4-2-Springæ³¨å…¥çš„åŸç†åˆ†æ-ç®€æ˜“ç‰ˆ"><a href="#4-2-Springæ³¨å…¥çš„åŸç†åˆ†æ-ç®€æ˜“ç‰ˆ" class="headerlink" title="4.2 Springæ³¨å…¥çš„åŸç†åˆ†æ(ç®€æ˜“ç‰ˆ)"></a>4.2 Springæ³¨å…¥çš„åŸç†åˆ†æ(ç®€æ˜“ç‰ˆ)</h3><p><strong>Springé€šè¿‡åº•å±‚è°ƒç”¨å¯¹è±¡å±æ€§å¯¹åº”çš„setæ–¹æ³•ï¼Œå®Œæˆæˆå‘˜å˜é‡çš„èµ‹å€¼ï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºsetæ³¨å…¥</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200415191157364.png" alt="image-20200415191157364"></p><h2 id="5-Setæ³¨å…¥è¯¦è§£"><a href="#5-Setæ³¨å…¥è¯¦è§£" class="headerlink" title="5. Setæ³¨å…¥è¯¦è§£"></a>5. Setæ³¨å…¥è¯¦è§£</h2><p>é’ˆå¯¹äºä¸åŒç±»å‹çš„æˆå‘˜å˜é‡ï¼Œåœ¨<code>&lt;property&gt;</code>æ ‡ç­¾ï¼Œéœ€è¦åµŒå¥—å…¶ä»–æ ‡ç­¾</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>    xxxxx<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416090518713.png" alt="image-20200416090518713"></p><h3 id="5-1-JDKå†…ç½®ç±»å‹"><a href="#5-1-JDKå†…ç½®ç±»å‹" class="headerlink" title="5.1 JDKå†…ç½®ç±»å‹"></a>5.1 JDKå†…ç½®ç±»å‹</h3><p>åœ¨<code>&lt;property&gt;</code>æ ‡ç­¾é‡Œæ·»åŠ </p><h4 id="5-1-1-String-8ç§åŸºæœ¬ç±»å‹"><a href="#5-1-1-String-8ç§åŸºæœ¬ç±»å‹" class="headerlink" title="5.1.1 String+8ç§åŸºæœ¬ç±»å‹"></a>5.1.1 String+8ç§åŸºæœ¬ç±»å‹</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></code></pre></div><h4 id="5-1-2-æ•°ç»„"><a href="#5-1-2-æ•°ç»„" class="headerlink" title="5.1.2 æ•°ç»„"></a>5.1.2 æ•°ç»„</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns@zparkhr.com.cn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>liucy@zparkhr.com.cn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>chenyn@zparkhr.com.cn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span></code></pre></div><h4 id="5-1-3-Seté›†åˆ"><a href="#5-1-3-Seté›†åˆ" class="headerlink" title="5.1.3 Seté›†åˆ"></a>5.1.3 Seté›†åˆ</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>11111<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>112222<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span># Setå¦‚æœä¸åŠ èŒƒæ€§ï¼Œå¯ä»¥å­˜ä»»ä½•çš„æ ‡ç­¾<span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span></span>   &lt;set <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span></code></pre></div><h4 id="5-1-4-Listé›†åˆ"><a href="#5-1-4-Listé›†åˆ" class="headerlink" title="5.1.4 Listé›†åˆ"></a>5.1.4 Listé›†åˆ</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>11111<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>2222<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span># åŒç†äºset<span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span></span>   &lt;set <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span></code></pre></div><h4 id="5-1-5-Mapé›†åˆ"><a href="#5-1-5-Mapé›†åˆ" class="headerlink" title="5.1.5 Mapé›†åˆ"></a>5.1.5 Mapé›†åˆ</h4><div class="hljs code-wrapper"><pre><code class="hljs xml">æ³¨æ„ï¼š map -- entry  -- keyæœ‰ç‰¹å®šçš„æ ‡ç­¾  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>                       å€¼æ ¹æ®å¯¹åº”ç±»å‹é€‰æ‹©å¯¹åº”ç±»å‹çš„æ ‡ç­¾<span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>3434334343<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>chenyn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span></span>  &lt;/entry&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span></code></pre></div><h4 id="5-1-6-Properites"><a href="#5-1-6-Properites" class="headerlink" title="5.1.6 Properites"></a>5.1.6 Properites</h4><div class="hljs code-wrapper"><pre><code class="hljs xml">Propertiesç±»å‹ ç‰¹æ®Šçš„Map key=String value=String <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;key1&quot;</span>&gt;</span>value1<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;key2&quot;</span>&gt;</span>value2<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span></code></pre></div><h4 id="5-1-7-å¤æ‚çš„JDKç±»å‹-Date"><a href="#5-1-7-å¤æ‚çš„JDKç±»å‹-Date" class="headerlink" title="5.1.7 å¤æ‚çš„JDKç±»å‹ (Date)"></a>5.1.7 å¤æ‚çš„JDKç±»å‹ (Date)</h4><p>éœ€è¦ç¨‹åºå‘˜è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼Œå¤„ç†</p><h3 id="5-2-ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"><a href="#5-2-ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="5.2 ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"></a>5.2 ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹</h3><h4 id="5-2-1-ç¬¬ä¸€ç§æ–¹å¼"><a href="#5-2-1-ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="5.2.1 ç¬¬ä¸€ç§æ–¹å¼"></a>5.2.1 ç¬¬ä¸€ç§æ–¹å¼</h4><p>ä¸ºæˆå‘˜å˜é‡æä¾›<code>set get</code>æ–¹æ³•</p><p>é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæ³¨å…¥(èµ‹å€¼)</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxxx.UserServiceImpl&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.UserDAOImpl&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h4 id="5-2-2-ç¬¬äºŒç§æ–¹å¼"><a href="#5-2-2-ç¬¬äºŒç§æ–¹å¼" class="headerlink" title="5.2.2 ç¬¬äºŒç§æ–¹å¼"></a>5.2.2 ç¬¬äºŒç§æ–¹å¼</h4><p>ç¬¬ä¸€ç§èµ‹å€¼æ–¹å¼å­˜åœ¨çš„é—®é¢˜</p><ul><li>é…ç½®æ–‡ä»¶ä»£ç å†—ä½™</li><li>è¢«æ³¨å…¥çš„å¯¹è±¡<code>&lt;bean class=&quot;xxx.UserDAOImpl&quot;/&gt;</code>,å¤šæ¬¡åˆ›å»ºï¼Œæµªè´¹å†…å­˜èµ„æº</li></ul><p>ä¸ºæˆå‘˜å˜é‡æä¾›<code>set get</code>æ–¹æ³•</p><p>é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.UserDAOImpl&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.UserServiceImpl&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>#Spring4.x åºŸé™¤äº† <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">local</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span> åŸºæœ¬ç­‰æ•ˆ <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></code></pre></div><h3 id="5-3-Setæ³¨å…¥çš„ç®€åŒ–å†™æ³•"><a href="#5-3-Setæ³¨å…¥çš„ç®€åŒ–å†™æ³•" class="headerlink" title="5.3 Setæ³¨å…¥çš„ç®€åŒ–å†™æ³•"></a>5.3 Setæ³¨å…¥çš„ç®€åŒ–å†™æ³•</h3><h4 id="5-3-1-åŸºäºå±æ€§ç®€åŒ–"><a href="#5-3-1-åŸºäºå±æ€§ç®€åŒ–" class="headerlink" title="5.3.1 åŸºäºå±æ€§ç®€åŒ–"></a>5.3.1 åŸºäºå±æ€§ç®€åŒ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml">JDKç±»å‹æ³¨å…¥ <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>æ›¿æ¢ä¸º<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;suns&quot;</span>/&gt;</span>æ³¨æ„ï¼švalueå±æ€§ åªèƒ½ç®€åŒ– 8ç§åŸºæœ¬ç±»å‹+String æ³¨å…¥æ ‡ç­¾ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>æ›¿æ¢ä¸º<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span></code></pre></div><h4 id="5-3-2-åŸºäºpå‘½åç©ºé—´ç®€åŒ–"><a href="#5-3-2-åŸºäºpå‘½åç©ºé—´ç®€åŒ–" class="headerlink" title="5.3.2 åŸºäºpå‘½åç©ºé—´ç®€åŒ–"></a>5.3.2 åŸºäºpå‘½åç©ºé—´ç®€åŒ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml">JDKç±»å‹æ³¨å…¥ <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxxx.Person&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>æ›¿æ¢ä¸º<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.Person&quot;</span> <span class="hljs-attr">p:name</span>=<span class="hljs-string">&quot;suns&quot;</span> <span class="hljs-attr">p:id</span>=<span class="hljs-string">&quot;123&quot;</span>/&gt;</span>æ³¨æ„ï¼švalueå±æ€§ åªèƒ½ç®€åŒ– 8ç§åŸºæœ¬ç±»å‹+String æ³¨å…¥æ ‡ç­¾ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xx.UserServiceImpl&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>æ›¿æ¢ä¸º<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.UserServiceImpl&quot;</span> <span class="hljs-attr">p:userDAO-ref</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span></code></pre></div><h2 id="6-æ„é€ æ³¨å…¥"><a href="#6-æ„é€ æ³¨å…¥" class="headerlink" title="6 æ„é€ æ³¨å…¥"></a>6 æ„é€ æ³¨å…¥</h2><ul><li>æ³¨å…¥ï¼šé€šè¿‡Springçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºæˆå‘˜å˜é‡èµ‹å€¼</li><li>Setæ³¨å…¥ï¼šSpringè°ƒç”¨Setæ–¹æ³• é€šè¿‡é…ç½®æ–‡ä»¶ ä¸ºæˆå‘˜å˜é‡èµ‹å€¼</li><li>æ„é€ æ³¨å…¥ï¼šSpringè°ƒç”¨æ„é€ æ–¹æ³• é€šè¿‡é…ç½®æ–‡ä»¶ ä¸ºæˆå‘˜å˜é‡èµ‹å€¼</li></ul><h3 id="6-1-å¼€å‘æ­¥éª¤"><a href="#6-1-å¼€å‘æ­¥éª¤" class="headerlink" title="6.1 å¼€å‘æ­¥éª¤"></a>6.1 å¼€å‘æ­¥éª¤</h3><p>æä¾›æœ‰å‚æ„é€ æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Customer</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> age)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;        <span class="hljs-keyword">this</span>.age = age;    &#125;&#125;</code></pre></div><p>Springçš„é…ç½®æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.basic.constructer.Customer&quot;</span>&gt;</span> æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéœ€è¦ä¸¤ä¸ªæ„é€ æ ‡ç­¾  <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>102<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h3 id="6-2-æ„é€ æ–¹æ³•é‡è½½"><a href="#6-2-æ„é€ æ–¹æ³•é‡è½½" class="headerlink" title="6.2 æ„é€ æ–¹æ³•é‡è½½"></a>6.2 æ„é€ æ–¹æ³•é‡è½½</h3><h4 id="6-2-1-å‚æ•°ä¸ªæ•°ä¸åŒæ—¶"><a href="#6-2-1-å‚æ•°ä¸ªæ•°ä¸åŒæ—¶" class="headerlink" title="6.2.1 å‚æ•°ä¸ªæ•°ä¸åŒæ—¶"></a>6.2.1 å‚æ•°ä¸ªæ•°ä¸åŒæ—¶</h4><p>é€šè¿‡æ§åˆ¶<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾çš„æ•°é‡è¿›è¡ŒåŒºåˆ† </p><h4 id="6-2-2-æ„é€ å‚æ•°ä¸ªæ•°ç›¸åŒæ—¶"><a href="#6-2-2-æ„é€ å‚æ•°ä¸ªæ•°ç›¸åŒæ—¶" class="headerlink" title="6.2.2 æ„é€ å‚æ•°ä¸ªæ•°ç›¸åŒæ—¶"></a>6.2.2 æ„é€ å‚æ•°ä¸ªæ•°ç›¸åŒæ—¶</h4><p>é€šè¿‡åœ¨æ ‡ç­¾å¼•å…¥ typeå±æ€§ è¿›è¡Œç±»å‹çš„åŒºåˆ†<code> &lt;constructor-arg type=&quot;&quot;&gt;</code></p><h3 id="6-3-æ³¨å…¥çš„æ€»ç»“"><a href="#6-3-æ³¨å…¥çš„æ€»ç»“" class="headerlink" title="6.3 æ³¨å…¥çš„æ€»ç»“"></a>6.3 æ³¨å…¥çš„æ€»ç»“</h3><p>æœªæ¥çš„å®æˆ˜ä¸­ï¼Œåº”ç”¨setæ³¨å…¥è¿˜æ˜¯æ„é€ æ³¨å…¥ï¼Ÿ</p><p>ç­”æ¡ˆï¼š<strong>setæ³¨å…¥æ›´å¤š</strong><br>       1. æ„é€ æ³¨å…¥éº»çƒ¦ (é‡è½½)<br>              2. Springæ¡†æ¶åº•å±‚ å¤§é‡åº”ç”¨äº† setæ³¨å…¥</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416155620897.png" alt="image-20200416155620897"></p><h2 id="7-åè½¬æ§åˆ¶ä¸ä¾èµ–æ³¨å…¥"><a href="#7-åè½¬æ§åˆ¶ä¸ä¾èµ–æ³¨å…¥" class="headerlink" title="7. åè½¬æ§åˆ¶ä¸ä¾èµ–æ³¨å…¥"></a>7. åè½¬æ§åˆ¶ä¸ä¾èµ–æ³¨å…¥</h2><h3 id="7-1-åè½¬-è½¬ç§»-æ§åˆ¶-IOC-Inverse-of-Control"><a href="#7-1-åè½¬-è½¬ç§»-æ§åˆ¶-IOC-Inverse-of-Control" class="headerlink" title="7.1 åè½¬(è½¬ç§»)æ§åˆ¶(IOC Inverse of Control)"></a>7.1 åè½¬(è½¬ç§»)æ§åˆ¶(IOC Inverse of Control)</h3><ul><li>æ§åˆ¶ï¼šå¯¹äºæˆå‘˜<strong>å˜é‡èµ‹å€¼</strong>çš„æ§åˆ¶æƒ</li><li>åè½¬æ§åˆ¶ï¼šæŠŠå¯¹äºæˆå‘˜å˜é‡èµ‹å€¼çš„æ§åˆ¶æƒï¼Œä»ä»£ç ä¸­<strong>åè½¬(è½¬ç§»)åˆ°Springå·¥å‚å’Œé…ç½®æ–‡ä»¶</strong>ä¸­å®Œæˆ<ul><li>å¥½å¤„ï¼šè§£è€¦åˆ</li></ul></li><li>åº•å±‚å®ç°ï¼šå·¥å‚è®¾è®¡æ¨¡å¼</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416161127972.png" alt="image-20200416161127972"></p><h3 id="7-2-ä¾èµ–æ³¨å…¥-Dependency-Injection-DI"><a href="#7-2-ä¾èµ–æ³¨å…¥-Dependency-Injection-DI" class="headerlink" title="7.2 ä¾èµ–æ³¨å…¥ (Dependency Injection  DI)"></a>7.2 ä¾èµ–æ³¨å…¥ (Dependency Injection  DI)</h3><ul><li><p>æ³¨å…¥ï¼šé€šè¿‡Springçš„å·¥å‚åŠé…ç½®æ–‡ä»¶ï¼Œä¸ºå¯¹è±¡ï¼ˆbeanï¼Œç»„ä»¶ï¼‰çš„æˆå‘˜å˜é‡èµ‹å€¼</p></li><li><p>ä¾èµ–æ³¨å…¥ï¼šå½“ä¸€ä¸ªç±»éœ€è¦å¦ä¸€ä¸ªç±»æ—¶ï¼Œå°±æ„å‘³ç€ä¾èµ–ï¼Œä¸€æ—¦å‡ºç°ä¾èµ–ï¼Œå°±å¯ä»¥æŠŠå¦ä¸€ä¸ªç±»ä½œä¸ºæœ¬ç±»çš„æˆå‘˜å˜é‡ï¼Œæœ€ç»ˆé€šè¿‡Springé…ç½®æ–‡ä»¶è¿›è¡Œæ³¨å…¥(èµ‹å€¼)</p><ul><li> å¥½å¤„ï¼šè§£è€¦åˆ</li></ul></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416162615816.png" alt="image-20200416162615816"></p><h2 id="8-Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡"><a href="#8-Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡" class="headerlink" title="8. Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡"></a>8. Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416164044047.png" alt="image-20200416164044047"></p><h3 id="8-1-ä»€ä¹ˆæ˜¯å¤æ‚å¯¹è±¡"><a href="#8-1-ä»€ä¹ˆæ˜¯å¤æ‚å¯¹è±¡" class="headerlink" title="8.1 ä»€ä¹ˆæ˜¯å¤æ‚å¯¹è±¡"></a>8.1 ä»€ä¹ˆæ˜¯å¤æ‚å¯¹è±¡</h3><blockquote><p>å¤æ‚å¯¹è±¡ï¼šæŒ‡çš„å°±æ˜¯ä¸èƒ½ç›´æ¥é€šè¿‡newæ„é€ æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡</p></blockquote><ul><li>Connection</li><li>SqlSessionFactory</li></ul><h3 id="8-2-Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡çš„3ç§æ–¹å¼"><a href="#8-2-Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡çš„3ç§æ–¹å¼" class="headerlink" title="8.2 Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡çš„3ç§æ–¹å¼"></a>8.2 Springå·¥å‚åˆ›å»ºå¤æ‚å¯¹è±¡çš„3ç§æ–¹å¼</h3><h4 id="8-2-1-FactoryBeanæ¥å£"><a href="#8-2-1-FactoryBeanæ¥å£" class="headerlink" title="8.2.1 FactoryBeanæ¥å£"></a>8.2.1 FactoryBeanæ¥å£</h4><p><strong>å¼€å‘æ­¥éª¤</strong></p><ul><li><p>å®ç°FactoryBeanæ¥å£ <img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200416204458451.png" alt="image-20200416204458451"></p></li><li><p>Springé…ç½®æ–‡ä»¶çš„é…ç½®</p><p>å¦‚æœClassä¸­æŒ‡å®šçš„ç±»å‹æ˜¯<code>FactoryBean</code>æ¥å£çš„å®ç°ç±»ï¼Œé‚£ä¹ˆé€šè¿‡idå€¼è·å¾—çš„æ˜¯è¿™ä¸ªç±»æ‰€åˆ›å»ºçš„å¤æ‚å¯¹è±¡  <code>Connection</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.factorybean.ConnectionFactoryBean&quot;</span>/&gt;</span></code></pre></div></li><li><p>ç»†èŠ‚</p><ul><li><p>å¦‚æœå°±æƒ³è·å¾—<code>FactoryBean</code>ç±»å‹çš„å¯¹è±¡<code>ctx.getBean(&quot;&amp;conn&quot;)</code>è·å¾—å°±æ˜¯<code>ConnectionFactoryBean</code>å¯¹è±¡</p></li><li><p><code>isSingleton</code>æ–¹æ³• è¿”å›  true åªä¼šåˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡</p><ul><li>è¿”å› false æ¯ä¸€æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ é—®é¢˜ï¼šæ ¹æ®è¿™ä¸ªå¯¹è±¡çš„ç‰¹ç‚¹ ï¼Œå†³å®šæ˜¯è¿”å›<code>true (SqlSessionFactory) </code>è¿˜æ˜¯<code> false  (Connection)</code></li><li>å¦‚æœæ˜¯è¿æ¥å¯¹è±¡<code>Connection</code>ï¼Œéœ€è¦è¿”å›falseï¼Œå› ä¸ºä¼šå‡ºç°å¹¶å‘é—®é¢˜</li></ul></li><li><p>mysqlé«˜ç‰ˆæœ¬è¿æ¥åˆ›å»ºæ—¶ï¼Œéœ€è¦åˆ¶å®šSSLè¯ä¹¦ï¼Œè§£å†³é—®é¢˜çš„æ–¹å¼</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">url</span> = <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/suns?useSSL=false&quot;</span></code></pre></div></li><li><p>ä¾èµ–æ³¨å…¥çš„ä½“ä¼š(DI)</p><p>æŠŠ<code>ConnectionFactoryBean</code>ä¸­ä¾èµ–çš„4ä¸ªå­—ç¬¦ä¸²ä¿¡æ¯ ï¼Œè¿›è¡Œé…ç½®æ–‡ä»¶çš„æ³¨å…¥<br>å¥½å¤„ï¼šè§£è€¦åˆ</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.factorybean.ConnectionFactoryBean&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/suns?useSSL=false&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div></li></ul></li></ul><p><strong>FactoryBeançš„å®ç°åŸç†[ç®€æ˜“ç‰ˆ]</strong></p><p>æ¥å£å›è°ƒ</p><ul><li>ä¸ºä»€ä¹ˆSpringè§„å®š<code>FactoryBean</code>æ¥å£ å®ç° å¹¶ä¸”<code> getObject()</code>?</li><li><code>ctx.getBean(&quot;conn&quot;) </code>è·å¾—æ˜¯å¤æ‚å¯¹è±¡ <code>Connection</code> è€Œæ²¡æœ‰è·å¾— <code>ConnectionFactoryBean(&amp;)</code></li></ul><p>Springå†…éƒ¨è¿è¡Œæµç¨‹</p><ul><li>é€šè¿‡connè·å¾— <code>ConnectionFactoryBean</code>ç±»çš„å¯¹è±¡ ï¼Œè¿›è€Œé€šè¿‡<code>instanceof </code>åˆ¤æ–­å‡ºæ˜¯<code>FactoryBean</code>æ¥å£çš„å®ç°ç±»</li><li>SpringæŒ‰ç…§è§„å®š <code>getObject() ---&gt; Connection</code></li><li>è¿”å›<code>Connection </code></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200417114723005.png" alt="image-20200417114723005"></p><p><strong>FactoryBeanæ€»ç»“</strong></p><p>Springä¸­ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯SpringåŸç”Ÿæä¾›çš„ï¼Œåç»­è®²è§£Springæ•´åˆå…¶ä»–æ¡†æ¶ï¼Œå¤§é‡åº”ç”¨<code>FactoryBean</code></p><h4 id="8-2-2-å®ä¾‹å·¥å‚"><a href="#8-2-2-å®ä¾‹å·¥å‚" class="headerlink" title="8.2.2 å®ä¾‹å·¥å‚"></a>8.2.2 å®ä¾‹å·¥å‚</h4><ul><li>é¿å…Springæ¡†æ¶çš„ä¾µå…¥ï¼Œå¦‚æœä»¥åç”¨å…¶ä»–æ¡†æ¶ï¼Œä¼šè¢«Springæ¡†æ¶æ‰€æŸç¼š</li><li>æ•´åˆé—ç•™ç³»ç»Ÿ </li></ul><p><strong>å¼€å‘æ­¥éª¤</strong></p><p>é—ç•™çš„ConnectionFactoryç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConnectionFactory</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;        Connection conn = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);            conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring?useSSL=false&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;1234&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> conn;    &#125;&#125;</code></pre></div><p>ç›´æ¥ç”¨é…ç½®æ–‡ä»¶æ•´åˆ</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.factorybean.ConnectionFactory&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conn&quot;</span>  <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;connFactory&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;getConnection&quot;</span>/&gt;</span></code></pre></div><h4 id="8-2-3-é™æ€å·¥å‚"><a href="#8-2-3-é™æ€å·¥å‚" class="headerlink" title="8.2.3 é™æ€å·¥å‚"></a>8.2.3 é™æ€å·¥å‚</h4><p>åŸå…ˆæ˜¯</p><div class="hljs code-wrapper"><pre><code class="hljs java">ConnectionFactory cf = <span class="hljs-keyword">new</span> ConnectionFactory();cf.getConnection();</code></pre></div><p>é™æ€å·¥å‚æ˜¯</p><div class="hljs code-wrapper"><pre><code class="hljs java">staticFactoryBean.getConnection();</code></pre></div><p><strong>å¼€å‘æ­¥éª¤</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StaticFactoryBean</span> </span>&#123;<span class="hljs-comment">// é™æ€æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;        Connection conn = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);            conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring?useSSL=false&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;1234&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> conn;    &#125;&#125;</code></pre></div><p>é…ç½®æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conn&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.factorybean.StaticConnectionFactory&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;getConnection&quot;</span>/&gt;</span></code></pre></div><h3 id="8-3-Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ€»ç»“"><a href="#8-3-Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ€»ç»“" class="headerlink" title="8.3 Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ€»ç»“"></a>8.3 Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ€»ç»“</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200417152030222.png" alt="image-20200417152030222"></p><h2 id="9-æ§åˆ¶Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ¬¡æ•°"><a href="#9-æ§åˆ¶Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ¬¡æ•°" class="headerlink" title="9. æ§åˆ¶Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ¬¡æ•°"></a>9. æ§åˆ¶Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„æ¬¡æ•°</h2><h3 id="9-1-å¦‚ä½•æ§åˆ¶ç®€å•å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°"><a href="#9-1-å¦‚ä½•æ§åˆ¶ç®€å•å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°" class="headerlink" title="9.1 å¦‚ä½•æ§åˆ¶ç®€å•å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°"></a>9.1 å¦‚ä½•æ§åˆ¶ç®€å•å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;account&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;singleton|prototype&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxxx.Account&quot;</span>/&gt;</span>&lt;sigleton:åªä¼šåˆ›å»ºä¸€æ¬¡ç®€å•å¯¹è±¡é»˜è®¤å€¼&gt;é»˜è®¤&lt;prototype:æ¯ä¸€æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡&gt;</code></pre></div><h3 id="9-2-å¦‚ä½•æ§åˆ¶å¤æ‚å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°"><a href="#9-2-å¦‚ä½•æ§åˆ¶å¤æ‚å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°" class="headerlink" title="9.2 å¦‚ä½•æ§åˆ¶å¤æ‚å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°"></a>9.2 å¦‚ä½•æ§åˆ¶å¤æ‚å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°</h3><div class="hljs code-wrapper"><pre><code class="hljs java">FactoryBean&#123;   isSingleton()&#123;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>  åªä¼šåˆ›å»ºä¸€æ¬¡      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span> æ¯ä¸€æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„   &#125;&#125;</code></pre></div><p>å¦‚æ²¡æœ‰isSingletonæ–¹æ³• è¿˜æ˜¯é€šè¿‡scopeå±æ€§ è¿›è¡Œå¯¹è±¡åˆ›å»ºæ¬¡æ•°çš„æ§åˆ¶</p><h3 id="9-3-ä¸ºä»€ä¹ˆè¦æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Ÿ"><a href="#9-3-ä¸ºä»€ä¹ˆè¦æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Ÿ" class="headerlink" title="9.3 ä¸ºä»€ä¹ˆè¦æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Ÿ"></a>9.3 ä¸ºä»€ä¹ˆè¦æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Ÿ</h3><blockquote><p>å¥½å¤„ï¼šèŠ‚çœä¸åˆ«è¦çš„å†…å­˜æµªè´¹ </p></blockquote><ul><li><p>ä»€ä¹ˆæ ·çš„å¯¹è±¡åªåˆ›å»ºä¸€æ¬¡ï¼Ÿ</p><ul><li>SqlSessionFactory</li><li>DAO</li><li>Service</li></ul></li><li><p>ä»€ä¹ˆæ ·çš„å¯¹è±¡ æ¯ä¸€æ¬¡éƒ½è¦åˆ›å»ºæ–°çš„ï¼Ÿ</p><ul><li>Connection</li><li>SqlSession | Session</li><li>Struts2 Action</li></ul></li></ul><h1 id="ç¬¬äºŒç« ã€Springå·¥å‚é«˜çº§ç‰¹æ€§"><a href="#ç¬¬äºŒç« ã€Springå·¥å‚é«˜çº§ç‰¹æ€§" class="headerlink" title="ç¬¬äºŒç« ã€Springå·¥å‚é«˜çº§ç‰¹æ€§"></a>ç¬¬äºŒç« ã€Springå·¥å‚é«˜çº§ç‰¹æ€§</h1><h2 id="1ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>1ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200418155427918.png" alt="image-20200418155427918"></p><h3 id="1-1-ä»€ä¹ˆæ˜¯å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1-1-ä»€ä¹ˆæ˜¯å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>1.1 ä»€ä¹ˆæ˜¯å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h3><blockquote><p>æŒ‡çš„æ˜¯ä¸€ä¸ªå¯¹è±¡åˆ›å»ºã€å­˜æ´»ã€æ¶ˆäº¡çš„ä¸€ä¸ªå®Œæ•´è¿‡ç¨‹</p></blockquote><h3 id="1-2-ä¸ºä»€ä¹ˆè¦å­¦ä¹ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1-2-ä¸ºä»€ä¹ˆè¦å­¦ä¹ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆè¦å­¦ä¹ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>1.2 ä¸ºä»€ä¹ˆè¦å­¦ä¹ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h3><blockquote><p>ç”±Springè´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€å­˜æ´»ã€é”€æ¯ï¼Œäº†è§£ç”Ÿå‘½å‘¨æœŸï¼Œæœ‰åˆ©äºæˆ‘ä»¬ä½¿ç”¨å¥½Springä¸ºæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡</p></blockquote><h3 id="1-3-ç”Ÿå‘½å‘¨æœŸçš„3ä¸ªé˜¶æ®µ"><a href="#1-3-ç”Ÿå‘½å‘¨æœŸçš„3ä¸ªé˜¶æ®µ" class="headerlink" title="1.3 ç”Ÿå‘½å‘¨æœŸçš„3ä¸ªé˜¶æ®µ"></a>1.3 ç”Ÿå‘½å‘¨æœŸçš„3ä¸ªé˜¶æ®µ</h3><h4 id="åˆ›å»ºé˜¶æ®µ"><a href="#åˆ›å»ºé˜¶æ®µ" class="headerlink" title="åˆ›å»ºé˜¶æ®µ"></a>åˆ›å»ºé˜¶æ®µ</h4><p>Springå·¥å‚ä½•æ—¶åˆ›å»ºå¯¹è±¡</p><ul><li><p>scope=â€singletonâ€</p><ul><li>Springå·¥å‚åˆ›å»ºçš„åŒæ—¶ï¼Œå¯¹è±¡çš„åˆ›å»º</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java">æ³¨æ„ï¼šè®¾ç½®scope=singleton è¿™ç§æƒ…å†µä¸‹ ä¹Ÿéœ€è¦åœ¨è·å–å¯¹è±¡çš„åŒæ—¶ï¼Œåˆ›å»ºå¯¹è±¡ï¼ŒåŠ ä¸Šæ ‡ç­¾ &lt;bean lazy-init=<span class="hljs-string">&quot;true&quot;</span>/&gt;</code></pre></div></li><li><p>scope=â€prototypeâ€</p><ul><li>Springå·¥å‚ä¼šåœ¨è·å–å¯¹è±¡çš„åŒæ—¶ï¼Œåˆ›å»ºå¯¹è±¡</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java">ctx.getBean(<span class="hljs-string">&quot;&quot;</span>)</code></pre></div></li></ul><h4 id="åˆå§‹åŒ–é˜¶æ®µ"><a href="#åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µ"></a><strong>åˆå§‹åŒ–é˜¶æ®µ</strong></h4><p>Springå·¥å‚åœ¨åˆ›å»ºå®Œå¯¹è±¡åï¼Œè°ƒç”¨å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå®Œæˆå¯¹åº”çš„åˆå§‹åŒ–æ“ä½œ</p><ol><li>åˆå§‹åŒ–æ–¹æ³•æä¾›ï¼šç¨‹åºå‘˜æ ¹æ®éœ€æ±‚ï¼Œæä¾›åˆå§‹åŒ–æ–¹æ³•ï¼Œæœ€ç»ˆå®Œæˆåˆå§‹åŒ–æ“ä½œ</li><li>åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ï¼šSpringå·¥å‚è¿›è¡Œè°ƒç”¨</li></ol><ul><li><p>InitializingBeanæ¥å£</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ç¨‹åºå‘˜æ ¹æ®éœ€æ±‚ï¼Œå®ç°çš„æ–¹æ³•ï¼Œå®Œæˆåˆå§‹åŒ–æ“ä½œ</span>implements InitializingBean  <span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterProperitesSet</span><span class="hljs-params">()</span></span>&#123;  &#125;</code></pre></div></li><li><p>å¯¹è±¡ä¸­æä¾›ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myInit</span><span class="hljs-params">()</span></span>&#123;  &#125;&lt;bean id=<span class="hljs-string">&quot;product&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;xxx.Product&quot;</span> init-method=<span class="hljs-string">&quot;myInit&quot;</span>/&gt;</code></pre></div></li><li><p>ç»†èŠ‚åˆ†æ</p><ul><li><p>å¦‚æœä¸€ä¸ªå¯¹è±¡å³å®ç°InitializingBean åŒæ—¶åˆæä¾›çš„ æ™®é€šçš„åˆå§‹åŒ–æ–¹æ³•  é¡ºåº</p><ul><li>InitializingBean </li><li>æ™®é€šåˆå§‹åŒ–æ–¹æ³•</li></ul></li><li><p><strong>æ³¨å…¥ä¸€å®šå‘ç”Ÿåœ¨åˆå§‹åŒ–æ“ä½œçš„å‰é¢</strong></p><ul><li><p>ä»€ä¹ˆå«åšåˆå§‹åŒ–æ“ä½œ</p><blockquote><p>èµ„æºçš„åˆå§‹åŒ–ï¼šæ•°æ®åº“ IO ç½‘ç»œ â€¦..</p></blockquote></li></ul></li></ul></li></ul><h4 id="é”€æ¯é˜¶æ®µ"><a href="#é”€æ¯é˜¶æ®µ" class="headerlink" title="é”€æ¯é˜¶æ®µ"></a><strong>é”€æ¯é˜¶æ®µ</strong></h4><blockquote><p>Springé”€æ¯å¯¹è±¡å‰ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„é”€æ¯æ–¹æ³•ï¼Œå®Œæˆé”€æ¯æ“ä½œ</p></blockquote><ol><li>Springä»€ä¹ˆæ—¶å€™é”€æ¯æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Ÿ<br><code>ctx.close();</code></li><li>é”€æ¯æ–¹æ³•ï¼šç¨‹åºå‘˜æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œå®šä¹‰é”€æ¯æ–¹æ³•ï¼Œå®Œæˆé”€æ¯æ“ä½œ<br>   è°ƒç”¨ï¼šSpringå·¥å‚å®Œæˆè°ƒç”¨</li></ol><ul><li><p>DisposableBean</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;  &#125;</code></pre></div></li><li><p>å®šä¹‰ä¸€ä¸ªæ™®é€šçš„é”€æ¯æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myDestroy</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;&#125;&lt;bean id=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;&quot;</span> init-method=<span class="hljs-string">&quot;&quot;</span> destroy-method=<span class="hljs-string">&quot;myDestroy&quot;</span>/&gt;</code></pre></div></li><li><p>ç»†èŠ‚åˆ†æ</p><ul><li><p>é”€æ¯æ–¹æ³•çš„æ“ä½œåªé€‚ç”¨äº<code> scope=&quot;singleton&quot;</code></p></li><li><p>ä»€ä¹ˆå«åšé”€æ¯æ“ä½œ</p><blockquote><p>ä¸»è¦æŒ‡çš„å°±æ˜¯ èµ„æºçš„é‡Šæ”¾æ“ä½œ  io.close()     connection.close();</p></blockquote></li></ul></li></ul><h2 id="2-é…ç½®æ–‡ä»¶å‚æ•°åŒ–"><a href="#2-é…ç½®æ–‡ä»¶å‚æ•°åŒ–" class="headerlink" title="2. é…ç½®æ–‡ä»¶å‚æ•°åŒ–"></a>2. é…ç½®æ–‡ä»¶å‚æ•°åŒ–</h2><blockquote><p>æŠŠSpringé…ç½®æ–‡ä»¶ä¸­éœ€è¦ç»å¸¸ä¿®æ”¹çš„å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œè½¬ç§»åˆ°ä¸€ä¸ªæ›´å°çš„é…ç½®æ–‡ä»¶ä¸­</p></blockquote><ul><li>Springçš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨éœ€è¦ç»å¸¸ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Ÿ<br> å­˜åœ¨ ä»¥æ•°æ®åº“è¿æ¥ç›¸å…³çš„å‚æ•° ä»£è¡¨</li><li>ç»å¸¸å˜åŒ–å­—ç¬¦ä¸²ï¼Œåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç›´æ¥ä¿®æ”¹<br> ä¸åˆ©äºé¡¹ç›®ç»´æŠ¤(ä¿®æ”¹)</li><li>è½¬ç§»åˆ°ä¸€ä¸ªå°çš„é…ç½®æ–‡ä»¶(.properties)<br> åˆ©äºç»´æŠ¤(ä¿®æ”¹)</li></ul><p>é…ç½®æ–‡ä»¶å‚æ•°åŒ–ï¼šåˆ©äºSpringé…ç½®æ–‡ä»¶çš„ç»´æŠ¤(ä¿®æ”¹)</p><h3 id="é…ç½®æ–‡ä»¶å‚æ•°çš„å¼€å‘æ­¥éª¤"><a href="#é…ç½®æ–‡ä»¶å‚æ•°çš„å¼€å‘æ­¥éª¤" class="headerlink" title="é…ç½®æ–‡ä»¶å‚æ•°çš„å¼€å‘æ­¥éª¤"></a>é…ç½®æ–‡ä»¶å‚æ•°çš„å¼€å‘æ­¥éª¤</h3><p>æä¾›ä¸€ä¸ªå°çš„é…ç½®æ–‡ä»¶<code>(.properities)</code></p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">åå­—ï¼šéšä¾¿</span><span class="hljs-attr">æ”¾ç½®ä½ç½®ï¼šéšä¾¿</span><span class="hljs-meta">jdbc.driverClassName</span> = <span class="hljs-string">com.mysql.jdbc.Driver</span><span class="hljs-meta">jdbc.url</span> = <span class="hljs-string">jdbc:mysql://localhost:3306/suns?useSSL=false</span><span class="hljs-meta">jdbc.username</span> = <span class="hljs-string">root</span><span class="hljs-meta">jdbc.password</span> = <span class="hljs-string">123456</span></code></pre></div><p>Springçš„é…ç½®æ–‡ä»¶ä¸å°é…ç½®æ–‡ä»¶è¿›è¡Œæ•´åˆ</p><p><code>applicationContext.xml</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:/db.properties&quot;</span>/&gt;</span></code></pre></div><p>åœ¨Springé…ç½®æ–‡ä»¶ä¸­é€šè¿‡<code>$&#123;key&#125;</code>è·å–å°é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200418171133796.png" alt="image-20200418171133796"></p><h2 id="3-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"><a href="#3-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨" class="headerlink" title="3. è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"></a>3. è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</h2><h3 id="3-1-ç±»å‹è½¬æ¢å™¨"><a href="#3-1-ç±»å‹è½¬æ¢å™¨" class="headerlink" title="3.1 ç±»å‹è½¬æ¢å™¨"></a>3.1 ç±»å‹è½¬æ¢å™¨</h3><blockquote><p>ä½œç”¨ï¼šSpringé€šè¿‡ç±»å‹è½¬æ¢å™¨æŠŠé…ç½®æ–‡ä»¶ä¸­å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œè½¬æ¢æˆäº†å¯¹è±¡ä¸­æˆå‘˜å˜é‡å¯¹åº”ç±»å‹çš„æ•°æ®ï¼Œè¿›è€Œå®Œæˆäº†æ³¨å…¥</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200418201732220.png" alt="image-20200418201732220"></p><h3 id="3-2-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"><a href="#3-2-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨" class="headerlink" title="3.2 è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"></a>3.2 è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</h3><blockquote><p>åŸå› ï¼šå½“Springå†…éƒ¨æ²¡æœ‰æä¾›ç‰¹å®šç±»å‹è½¬æ¢å™¨æ—¶ï¼Œè€Œç¨‹åºå‘˜åœ¨åº”ç”¨çš„è¿‡ç¨‹ä¸­è¿˜éœ€è¦ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç¨‹åºå‘˜è‡ªå·±å®šä¹‰ç±»å‹è½¬æ¢å™¨</p></blockquote><p><strong>ç±» implements Converteræ¥å£</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Date</span>&gt; </span>&#123;   <span class="hljs-comment">/*</span><span class="hljs-comment">       convertæ–¹æ³•ä½œç”¨ï¼šString ---&gt;  Date</span><span class="hljs-comment">                      SimpleDateFormat sdf = new SimpleDateFormat();</span><span class="hljs-comment">                      sdf.parset(String) ---&gt; Date</span><span class="hljs-comment">       param:source ä»£è¡¨çš„æ˜¯é…ç½®æ–‡ä»¶ä¸­ æ—¥æœŸå­—ç¬¦ä¸² &lt;value&gt;2020-10-11&lt;/value&gt;</span><span class="hljs-comment"></span><span class="hljs-comment">       return : å½“æŠŠè½¬æ¢å¥½çš„Dateä½œä¸ºconvertæ–¹æ³•çš„è¿”å›å€¼åï¼ŒSpringè‡ªåŠ¨çš„ä¸ºbirthdayå±æ€§è¿›è¡Œæ³¨å…¥ï¼ˆèµ‹å€¼ï¼‰</span><span class="hljs-comment"></span><span class="hljs-comment">     */</span>  <span class="hljs-meta">@Override</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;    Date date = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;      SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);      date = sdf.parse(source);    &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;      e.printStackTrace();    &#125;    <span class="hljs-keyword">return</span> date;  &#125;&#125;</code></pre></div><p><strong>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</strong></p><ul><li>MyDateConverterå¯¹è±¡åˆ›å»ºå‡ºæ¥</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDateConverter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxxx.MyDateConverter&quot;</span>/&gt;</span></code></pre></div><ul><li><p>ç±»å‹è½¬æ¢å™¨çš„æ³¨å†Œ</p><p>ç›®çš„ï¼šå‘ŠçŸ¥Springæ¡†æ¶ï¼Œæˆ‘ä»¬æ‰€åˆ›å»ºçš„MyDateConverteræ˜¯ä¸€ä¸ªç±»å‹è½¬æ¢å™¨</p></li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç”¨äºæ³¨å†Œç±»å‹è½¬æ¢å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversionService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;converters&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myDateConverter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h3 id="3-3-ç»†èŠ‚"><a href="#3-3-ç»†èŠ‚" class="headerlink" title="3.3 ç»†èŠ‚"></a>3.3 ç»†èŠ‚</h3><p>MyDateConverterä¸­çš„æ—¥æœŸçš„æ ¼å¼ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œç”±é…ç½®æ–‡ä»¶å®Œæˆèµ‹å€¼</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Date</span>&gt; </span>&#123;    <span class="hljs-keyword">private</span> String pattern;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPattern</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> pattern;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPattern</span><span class="hljs-params">(String pattern)</span> </span>&#123;        <span class="hljs-keyword">this</span>.pattern = pattern;    &#125;    <span class="hljs-comment">/*</span><span class="hljs-comment">       convertæ–¹æ³•ä½œç”¨ï¼šString ---&gt;  Date</span><span class="hljs-comment">                      SimpleDateFormat sdf = new SimpleDateFormat();</span><span class="hljs-comment">                      sdf.parset(String) ---&gt; Date</span><span class="hljs-comment">       param:source ä»£è¡¨çš„æ˜¯é…ç½®æ–‡ä»¶ä¸­ æ—¥æœŸå­—ç¬¦ä¸² &lt;value&gt;2020-10-11&lt;/value&gt;</span><span class="hljs-comment"></span><span class="hljs-comment">       return : å½“æŠŠè½¬æ¢å¥½çš„Dateä½œä¸ºconvertæ–¹æ³•çš„è¿”å›å€¼åï¼ŒSpringè‡ªåŠ¨çš„ä¸ºbirthdayå±æ€§è¿›è¡Œæ³¨å…¥ï¼ˆèµ‹å€¼ï¼‰</span><span class="hljs-comment"></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;        Date date = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(pattern);            date = sdf.parse(source);        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> date;    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Springåˆ›å»ºMyDateConverterç±»å‹å¯¹è±¡--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDateConverter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.converter.MyDateConverter&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p><code>ConversionSeviceFactoryBean </code><strong>å®šä¹‰ idå±æ€§ å€¼å¿…é¡»</strong> <code>conversionService </code></p><p>Springæ¡†æ¶å†…ç½®æ—¥æœŸç±»å‹çš„è½¬æ¢å™¨</p><div class="hljs code-wrapper"><pre><code class="hljs markdown">æ—¥æœŸæ ¼å¼ï¼š2020/05/01 (ä¸æ”¯æŒ ï¼š2020-05-01)</code></pre></div><h2 id="4-åç½®å¤„ç†Bean"><a href="#4-åç½®å¤„ç†Bean" class="headerlink" title="4. åç½®å¤„ç†Bean"></a>4. åç½®å¤„ç†Bean</h2><blockquote><p>BeanPostProcessorä½œç”¨ï¼šå¯¹Springå·¥å‚æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿›è¡Œå†åŠ å·¥</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs markdown">AOPåº•å±‚å®ç°ï¼šæ³¨æ„ï¼šBeanPostProcessoræ¥å£<span class="hljs-code">          xxxx()&#123;</span><span class="hljs-code">                 </span><span class="hljs-code">          &#125;</span></code></pre></div><p><strong>åç½®å¤„ç†Beançš„è¿è¡ŒåŸç†åˆ†æ</strong><br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200420155053027.png" alt="image-20200420155053027"></p><p>ç¨‹åºå‘˜å®ç°BeanPostProcessorè§„å®šæ¥å£ä¸­çš„æ–¹æ³•ï¼š</p><ul><li><p><code>Object postProcessBeforeInitiallization(Object bean String beanName)</code><br>ä½œç”¨ï¼šSpringåˆ›å»ºå®Œå¯¹è±¡ï¼Œå¹¶è¿›è¡Œæ³¨å…¥åï¼Œå¯ä»¥è¿è¡ŒBeforeæ–¹æ³•è¿›è¡ŒåŠ å·¥<br>è·å¾—Springåˆ›å»ºå¥½çš„å¯¹è±¡ ï¼šé€šè¿‡æ–¹æ³•çš„å‚æ•°<br>æœ€ç»ˆé€šè¿‡è¿”å›å€¼äº¤ç»™Springæ¡†æ¶ </p></li><li><p><code>Object postProcessAfterInitiallization(Object bean String beanName)</code><br>ä½œç”¨ï¼šSpringæ‰§è¡Œå®Œå¯¹è±¡çš„åˆå§‹åŒ–æ“ä½œåï¼Œå¯ä»¥è¿è¡ŒAfteræ–¹æ³•è¿›è¡ŒåŠ å·¥<br>è·å¾—Springåˆ›å»ºå¥½çš„å¯¹è±¡ ï¼šé€šè¿‡æ–¹æ³•çš„å‚æ•°<br>æœ€ç»ˆé€šè¿‡è¿”å›å€¼äº¤ç»™Springæ¡†æ¶ </p></li></ul><p>å®æˆ˜ä¸­ï¼š</p><ul><li><strong>å¾ˆå°‘å¤„ç†Springçš„åˆå§‹åŒ–æ“ä½œ</strong>ï¼šæ²¡æœ‰å¿…è¦åŒºåˆ†Before Afterã€‚<strong>åªéœ€è¦å®ç°å…¶ä¸­çš„ä¸€ä¸ªAfteræ–¹æ³•</strong>å³å¯<br>æ³¨æ„ï¼š<div class="hljs code-wrapper"><pre><code>`postProcessBeforeInitiallization``return bean`å¯¹è±¡</code></pre></div></li></ul><p><strong>BeanPostProcessorçš„å¼€å‘æ­¥éª¤</strong></p><ul><li>ç±» å®ç° BeanPostProcessoræ¥å£</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanPostProcessor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        Categroy categroy = (Categroy) bean;        categroy.setName(<span class="hljs-string">&quot;xiaowb&quot;</span>);        <span class="hljs-keyword">return</span> categroy;    &#125;&#125;</code></pre></div><ul><li>Springçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myBeanPostProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.MyBeanPostProcessor&quot;</span>/&gt;</span></code></pre></div><ul><li>BeanPostProcessorç»†èŠ‚</li></ul><p> BeanPostProcessorä¼šå¯¹Springå·¥å‚ä¸­æ‰€æœ‰åˆ›å»ºçš„å¯¹è±¡è¿›è¡ŒåŠ å·¥ï¼Œå¦‚æœå·¥å‚åˆ›å»ºäº†å¤šä¸ªä¸åŒçš„å¯¹è±¡ï¼Œè¦æ³¨æ„åŒºåˆ«ä¼ å…¥çš„å¯¹è±¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span>  Category) &#123;        Category category = (Category) bean;        category.setName(<span class="hljs-string">&quot;xwb&quot;</span>);        <span class="hljs-keyword">return</span> category;    &#125;    <span class="hljs-keyword">return</span> bean;&#125;</code></pre></div><h1 id="ç¬¬ä¸‰ç« ã€Spring-AOP"><a href="#ç¬¬ä¸‰ç« ã€Spring-AOP" class="headerlink" title="ç¬¬ä¸‰ç« ã€Spring AOP"></a>ç¬¬ä¸‰ç« ã€Spring AOP</h1><h2 id="1-é™æ€ä»£ç†è®¾è®¡æ¨¡å¼"><a href="#1-é™æ€ä»£ç†è®¾è®¡æ¨¡å¼" class="headerlink" title="1. é™æ€ä»£ç†è®¾è®¡æ¨¡å¼"></a>1. é™æ€ä»£ç†è®¾è®¡æ¨¡å¼</h2><h3 id="1-1-ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†è®¾è®¡æ¨¡å¼"><a href="#1-1-ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†è®¾è®¡æ¨¡å¼" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†è®¾è®¡æ¨¡å¼"></a>1.1 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†è®¾è®¡æ¨¡å¼</h3><p>åœ¨JavaEEåˆ†å±‚å¼€å‘å¼€å‘ä¸­ï¼Œé‚£ä¸ªå±‚æ¬¡å¯¹äºæˆ‘ä»¬æ¥è®²æœ€é‡è¦?</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">DAO</span> <span class="hljs-string">---&gt; Service --&gt; Controller </span><span class="hljs-attr">JavaEEåˆ†å±‚å¼€å‘ä¸­ï¼Œæœ€ä¸ºé‡è¦çš„æ˜¯Serviceå±‚</span></code></pre></div><p>Service å±‚ä¸­åŒ…å«äº†å“ªäº›ä»£ç ï¼Ÿ</p><ul><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼ˆä»£ç é‡è¾ƒå¤šï¼‰ï¼šä¸šåŠ¡è¿ç®—ï¼ŒDAO è°ƒç”¨</li><li><strong>é¢å¤–åŠŸèƒ½</strong>ï¼ˆé™„åŠ åŠŸèƒ½ï¼Œä¸å±äºä¸šåŠ¡ï¼Œå¯æœ‰å¯æ— ï¼Œä»£ç é‡å°ï¼‰ï¼šäº‹åŠ¡ã€æ—¥å¿—ã€æ€§èƒ½ â€¦</li></ul><p>é¢å¤–åŠŸèƒ½ä¹¦å†™åœ¨ Service å±‚å¥½ä¸å¥½?</p><ul><li>Service å±‚çš„è°ƒç”¨è€…çš„è§’åº¦ï¼ˆController)ï¼šéœ€è¦åœ¨ Service å±‚ä¹¦å†™é¢å¤–åŠŸèƒ½</li><li>è½¯ä»¶è®¾è®¡è€…ï¼šService å±‚ä¸éœ€è¦é¢å¤–åŠŸèƒ½</li></ul><p> æ‹¿ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥åšå¯¹æ¯”ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ <strong>å¼•å…¥ä¸€ä¸ªä»£ç†</strong><br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200422110206172.png" alt="image-20200422110206172"></p><h3 id="1-2-ä»£ç†è®¾è®¡æ¨¡å¼"><a href="#1-2-ä»£ç†è®¾è®¡æ¨¡å¼" class="headerlink" title="1.2 ä»£ç†è®¾è®¡æ¨¡å¼"></a>1.2 ä»£ç†è®¾è®¡æ¨¡å¼</h3><h4 id="1-2-1-æ¦‚å¿µ"><a href="#1-2-1-æ¦‚å¿µ" class="headerlink" title="1.2.1 æ¦‚å¿µ"></a>1.2.1 æ¦‚å¿µ</h4><blockquote><p>é€šè¿‡ä»£ç†ç±»ï¼Œä¸ºåŸå§‹ç±»ï¼ˆç›®æ ‡ï¼‰å¢åŠ é¢å¤–çš„åŠŸèƒ½<br>å¥½å¤„ï¼šåˆ©äºåŸå§‹ç±»(ç›®æ ‡)çš„ç»´æŠ¤</p></blockquote><h4 id="1-2-2-åè¯è§£é‡Š"><a href="#1-2-2-åè¯è§£é‡Š" class="headerlink" title="1.2.2 åè¯è§£é‡Š"></a>1.2.2 åè¯è§£é‡Š</h4><p><strong>ç›®æ ‡ç±» / åŸå§‹ç±»</strong>ï¼šæŒ‡çš„æ˜¯ <strong>ä¸šåŠ¡ç±»</strong> (æ ¸å¿ƒåŠŸèƒ½ â€“&gt; ä¸šåŠ¡è¿ç®—ã€DAOè°ƒç”¨)<br><strong>ç›®æ ‡æ–¹æ³• / åŸå§‹æ–¹æ³•</strong>ï¼šç›®æ ‡ç±»ï¼ˆåŸå§‹ç±»ï¼‰ä¸­çš„æ–¹æ³•å°±æ˜¯ç›®æ ‡æ–¹æ³•ï¼ˆåŸå§‹æ–¹æ³•ï¼‰<br><strong>é¢å¤–åŠŸèƒ½ / é™„åŠ åŠŸèƒ½</strong>ï¼šæ—¥å¿—ã€äº‹åŠ¡ã€æ€§èƒ½ â€¦</p><h4 id="1-2-3-ä»£ç†å¼€å‘çš„æ ¸å¿ƒè¦ç´ "><a href="#1-2-3-ä»£ç†å¼€å‘çš„æ ¸å¿ƒè¦ç´ " class="headerlink" title="1.2.3 ä»£ç†å¼€å‘çš„æ ¸å¿ƒè¦ç´ "></a>1.2.3 ä»£ç†å¼€å‘çš„æ ¸å¿ƒè¦ç´ </h4><div class="hljs code-wrapper"><pre><code class="hljs java">ä»£ç†ç±» = ç›®æ ‡ç±»(åŸå§‹ç±») + é¢å¤–åŠŸèƒ½ + åŸå§‹ç±»(ç›®æ ‡ç±»)å®ç°ç›¸åŒçš„æ¥å£æˆ¿ä¸œ ---&gt; <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span></span>&#123;               m1               m2          &#125;          UserServiceImpl implements UserService&#123;               m1 ---&gt; ä¸šåŠ¡è¿ç®— DAOè°ƒç”¨               m2           &#125;ä¸­ä»‹ --- ä»£ç†ç±»ï¼šè¦å®ç°ç›®æ ‡ç±»ç›¸åŒçš„æ¥å£          UserServiceProxy implements UserService               m1               m2</code></pre></div><h4 id="1-2-4-ç¼–ç "><a href="#1-2-4-ç¼–ç " class="headerlink" title="1.2.4 ç¼–ç "></a>1.2.4 ç¼–ç </h4><p><strong>é™æ€ä»£ç†</strong>ï¼šä¸ºæ¯ä¸€ä¸ªåŸå§‹ç±»ï¼Œæ‰‹å·¥ç¼–å†™ä¸€ä¸ªä»£ç†ç±» (.java .class)</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span></span>;<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span></span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.register ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.login ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><p><strong>ä»£ç†ç±»ä¸­å¿…é¡»æœ‰åŸå§‹ç±»</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200422114654195.png" alt="image-20200422114654195"></p><h4 id="1-2-5-é™æ€ä»£ç†å­˜åœ¨çš„é—®é¢˜"><a href="#1-2-5-é™æ€ä»£ç†å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="1.2.5 é™æ€ä»£ç†å­˜åœ¨çš„é—®é¢˜"></a>1.2.5 é™æ€ä»£ç†å­˜åœ¨çš„é—®é¢˜</h4><ul><li><strong>é™æ€ç±»æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸åˆ©äºé¡¹ç›®ç®¡ç†</strong><br><code>UserServiceImpl</code>ã€<code>UserServiceProxy</code><br><code>OrderServiceImpl</code>ã€<code>OrderServiceProxy</code><br>â€¦</li><li><strong>é¢å¤–åŠŸèƒ½ç»´æŠ¤æ€§å·®</strong>ï¼šåœ¨ä»£ç†ç±»ä¸­ä¿®æ”¹é¢å¤–åŠŸèƒ½è¾ƒä¸ºéº»çƒ¦</li></ul><h2 id="2-Springçš„åŠ¨æ€ä»£ç†å¼€å‘"><a href="#2-Springçš„åŠ¨æ€ä»£ç†å¼€å‘" class="headerlink" title="2. Springçš„åŠ¨æ€ä»£ç†å¼€å‘"></a>2. Springçš„åŠ¨æ€ä»£ç†å¼€å‘</h2><h3 id="2-1-SpringåŠ¨æ€ä»£ç†çš„æ¦‚å¿µ"><a href="#2-1-SpringåŠ¨æ€ä»£ç†çš„æ¦‚å¿µ" class="headerlink" title="2.1 SpringåŠ¨æ€ä»£ç†çš„æ¦‚å¿µ"></a>2.1 SpringåŠ¨æ€ä»£ç†çš„æ¦‚å¿µ</h3><blockquote><p>æ¦‚å¿µï¼šé€šè¿‡ä»£ç†ç±»ä¸ºåŸå§‹ç±»(ç›®æ ‡ç±»)å¢åŠ é¢å¤–åŠŸèƒ½<br>å¥½å¤„ï¼šåˆ©äºåŸå§‹ç±»(ç›®æ ‡ç±»)çš„ç»´æŠ¤</p></blockquote><h3 id="2-2-æ­å»ºå¼€å‘ç¯å¢ƒ"><a href="#2-2-æ­å»ºå¼€å‘ç¯å¢ƒ" class="headerlink" title="2.2 æ­å»ºå¼€å‘ç¯å¢ƒ"></a>2.2 æ­å»ºå¼€å‘ç¯å¢ƒ</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjrt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="2-3-SpringåŠ¨æ€ä»£ç†çš„å¼€å‘æ­¥éª¤"><a href="#2-3-SpringåŠ¨æ€ä»£ç†çš„å¼€å‘æ­¥éª¤" class="headerlink" title="2.3 SpringåŠ¨æ€ä»£ç†çš„å¼€å‘æ­¥éª¤"></a>2.3 SpringåŠ¨æ€ä»£ç†çš„å¼€å‘æ­¥éª¤</h3><ul><li>åˆ›å»ºåŸå§‹å¯¹è±¡(ç›®æ ‡å¯¹è±¡)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span></span>;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.register ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.login ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.proxy.UserServiceImpl&quot;</span>/&gt;</span></code></pre></div><ul><li>é¢å¤–åŠŸèƒ½<br>MethodBeforeAdviceæ¥å£</li></ul><p>é¢å¤–çš„åŠŸèƒ½ä¹¦å†™åœ¨æ¥å£çš„å®ç°ä¸­ï¼Œè¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿è¡Œé¢å¤–åŠŸèƒ½</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Before</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodBeforeAdvice</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä½œç”¨: æŠŠéœ€è¦è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿è¡Œçš„é¢å¤–åŠŸèƒ½, ä¹¦å†™åœ¨ before æ–¹æ³•ä¸­</span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">(Method method, Object[] objects, Object o)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---method before advice log---&quot;</span>);    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.dynamic.Before&quot;</span>/&gt;</span></code></pre></div><ul><li>å®šä¹‰åˆ‡å…¥ç‚¹</li></ul><blockquote><p>åˆ‡å…¥ç‚¹ï¼šé¢å¤–åŠŸèƒ½åŠ å…¥çš„ä½ç½®</p><p>ç›®çš„ï¼šç”±ç¨‹åºå‘˜æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œå†³å®šé¢å¤–åŠŸèƒ½åŠ å…¥ç»™é‚£ä¸ªåŸå§‹æ–¹æ³•registerã€login</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç®€å•çš„æµ‹è¯•ï¼šæ‰€æœ‰æ–¹æ³•éƒ½åšä¸ºåˆ‡å…¥ç‚¹ï¼Œéƒ½åŠ å…¥é¢å¤–çš„åŠŸèƒ½ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *(..))&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span></code></pre></div><ul><li>ç»„è£… (2 3æ•´åˆ)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/aop</span></span><span class="hljs-tag"><span class="hljs-string">                           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.aop.UserServiceImpl&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- é¢å¤–åŠŸèƒ½ --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.aop.Before&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--åˆ‡å…¥ç‚¹:é¢å¤–åŠŸèƒ½çš„åŠ å…¥--&gt;</span>    <span class="hljs-comment">&lt;!--â½¬çš„ï¼šç”±ç¨‹åºå‘˜æ ¹æ®â¾ƒâ¼°çš„éœ€è¦ï¼Œå†³å®šé¢å¤–åŠŸèƒ½åŠ å…¥ç»™å“ªä¸ªåŸå§‹æ–¹æ³•(registerã€login)--&gt;</span>   <span class="hljs-comment">&lt;!-- ç®€å•çš„æµ‹è¯•ï¼šæ‰€æœ‰æ–¹æ³•éƒ½åšä¸ºåˆ‡å…¥ç‚¹ï¼Œéƒ½åŠ å…¥é¢å¤–çš„åŠŸèƒ½--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* * (..))&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!--è¡¨è¾¾çš„å«ä¹‰: æ‰€æœ‰çš„æ–¹æ³• éƒ½åŠ å…¥beforeçš„é¢å¤–åŠŸèƒ½--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pc&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><ul><li>è°ƒç”¨</li></ul><p>ç›®çš„ï¼šè·å¾— Spring å·¥å‚åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¹¶è¿›è¡Œè°ƒç”¨<br>æ³¨æ„ï¼š </p><ol><li>Spring çš„å·¥å‚é€šè¿‡åŸå§‹å¯¹è±¡çš„ id å€¼è·å¾—çš„æ˜¯ä»£ç†å¯¹è±¡</li><li>è·å¾—ä»£ç†å¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡å£°æ˜æ¥å£ç±»å‹ï¼Œè¿›è¡Œå¯¹è±¡çš„å­˜å‚¨</li></ol><div class="hljs code-wrapper"><pre><code class="hljs java">ç›®çš„ï¼šè·å¾—Springå·¥å‚åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¹¶è¿›è¡Œè°ƒç”¨  ApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;/applicationContext.xml&quot;</span>);æ³¨æ„ï¼š     <span class="hljs-number">1.</span> Springçš„å·¥å‚é€šè¿‡åŸå§‹å¯¹è±¡çš„idå€¼è·å¾—çš„æ˜¯ä»£ç†å¯¹è±¡     <span class="hljs-number">2.</span> è·å¾—ä»£ç†å¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡å£°æ˜æ¥å£ç±»å‹ï¼Œè¿›è¡Œå¯¹è±¡çš„å­˜å‚¨     UserService userService=(UserService)ctx.getBean(<span class="hljs-string">&quot;userService&quot;</span>);userService.login(<span class="hljs-string">&quot;&quot;</span>);userService.register()</code></pre></div><h3 id="2-4-åŠ¨æ€ä»£ç†ç»†èŠ‚åˆ†æ"><a href="#2-4-åŠ¨æ€ä»£ç†ç»†èŠ‚åˆ†æ" class="headerlink" title="2.4 åŠ¨æ€ä»£ç†ç»†èŠ‚åˆ†æ"></a>2.4 åŠ¨æ€ä»£ç†ç»†èŠ‚åˆ†æ</h3><ul><li><strong>Springåˆ›å»ºçš„åŠ¨æ€ä»£ç†ç±»åœ¨å“ªé‡Œï¼Ÿ</strong></li></ul><blockquote><p>Springæ¡†æ¶åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯ï¼Œåœ¨JVMåˆ›å»ºçš„ï¼Œè¿è¡Œåœ¨JVMå†…éƒ¨ï¼Œç­‰ç¨‹åºç»“æŸåï¼Œä¼šå’ŒJVMä¸€èµ·æ¶ˆå¤±</p><p>ä»€ä¹ˆå«åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯:é€šè¿‡ç¬¬ä¸‰æ–¹åŠ¨æ€å­—èŠ‚ç æ¡†æ¶ï¼Œåœ¨JVMä¸­åˆ›å»ºå¯¹åº”ç±»çš„å­—èŠ‚ç ï¼Œè¿›è€Œåˆ›å»ºå¯¹è±¡ï¼Œå½“è™šæ‹Ÿæœºç»“æŸï¼ŒåŠ¨æ€å­—èŠ‚ç è·Ÿç€æ¶ˆå¤±</p><p>ç»“è®ºï¼šåŠ¨æ€ä»£ç†ä¸éœ€è¦å®šä¹‰ç±»æ–‡ä»¶ï¼Œéƒ½æ˜¯JVMè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åˆ›å»ºçš„ï¼Œæ‰€ä»¥ä¸ä¼šé€ æˆé™æ€ä»£ç†ï¼Œç±»æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œå½±å“é¡¹ç›®ç®¡ç†çš„é—®é¢˜</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200423165547079.png" alt="image-20200423165547079"></p><ul><li><strong>åŠ¨æ€ä»£ç†ç¼–ç¨‹ç®€åŒ–ä»£ç†çš„å¼€å‘</strong></li></ul><blockquote><p>åœ¨é¢å¤–åŠŸèƒ½ä¸æ”¹å˜çš„å‰æä¸‹ï¼Œåˆ›å»ºå…¶ä»–ç›®æ ‡ç±»ï¼ˆåŸå§‹ç±»ï¼‰çš„ä»£ç†å¯¹è±¡æ—¶ï¼Œåªéœ€è¦æŒ‡å®šåŸå§‹(ç›®æ ‡)å¯¹è±¡å³å¯</p></blockquote><ul><li>åŠ¨æ€ä»£ç†é¢å¤–åŠŸèƒ½çš„ç»´æŠ¤æ€§å¤§å¤§å¢å¼º</li></ul><h2 id="3-SpringåŠ¨æ€ä»£ç†è¯¦è§£"><a href="#3-SpringåŠ¨æ€ä»£ç†è¯¦è§£" class="headerlink" title="3. SpringåŠ¨æ€ä»£ç†è¯¦è§£"></a>3. SpringåŠ¨æ€ä»£ç†è¯¦è§£</h2><h3 id="3-1-é¢å¤–åŠŸèƒ½çš„è¯¦è§£"><a href="#3-1-é¢å¤–åŠŸèƒ½çš„è¯¦è§£" class="headerlink" title="3.1 é¢å¤–åŠŸèƒ½çš„è¯¦è§£"></a>3.1 é¢å¤–åŠŸèƒ½çš„è¯¦è§£</h3><ul><li><p>MethodBeforeAdviceåˆ†æ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Before</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodBeforeAdvice</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä½œç”¨: æŠŠéœ€è¦è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿è¡Œçš„é¢å¤–åŠŸèƒ½, ä¹¦å†™åœ¨ before æ–¹æ³•ä¸­</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * Method: é¢å¤–åŠŸèƒ½æ‰€å¢åŠ ç»™çš„é‚£ä¸ªåŸå§‹æ–¹æ³•</span><span class="hljs-comment">     *                          login</span><span class="hljs-comment">     *                          register</span><span class="hljs-comment">     *                          --------</span><span class="hljs-comment">     *                          showOrder</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * Object[]:  é¢å¤–åŠŸèƒ½æ‰€å¢åŠ ç»™çš„é‚£ä¸ªåŸå§‹æ–¹æ³•çš„å‚æ•°</span><span class="hljs-comment">     *                          String name,String password</span><span class="hljs-comment">     *                          User</span><span class="hljs-comment">     *                          --------</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * Object: é¢å¤–åŠŸèƒ½æ‰€å¢åŠ ç»™çš„é‚£ä¸ªåŸå§‹å¯¹è±¡</span><span class="hljs-comment">     *                          UserServiceImpl</span><span class="hljs-comment">     *                          ---------------</span><span class="hljs-comment">     *                          OrderServiceImpl</span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">(Method method, Object[] objects, Object o)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---new method before advice log---&quot;</span>);    &#125;&#125;</code></pre></div></li><li><p>MethodInterceptor(æ–¹æ³•æ‹¦æˆªå™¨)</p><blockquote><p>methodinterceptoræ¥å£ï¼šé¢å¤–åŠŸèƒ½å¯ä»¥æ ¹æ®éœ€è¦è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œ å‰ã€åã€å‰å</p></blockquote><ul><li>å‚æ•°ï¼š<code>MethodInvocation</code>ï¼šé¢å¤–åŠŸèƒ½æ‰€å¢åŠ ç»™çš„é‚£ä¸ªåŸå§‹æ–¹æ³• (login, register)</li><li>è¿”å›å€¼ï¼š<code>Object</code>ï¼šåŸå§‹æ–¹æ³•çš„è¿”å›å€¼ (æ²¡æœ‰å°±è¿”å› null)</li><li><code>invocation.proceed()</code>ï¼šåŸå§‹æ–¹æ³•è¿è¡Œ</li></ul><p>é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³• <strong>ä¹‹å‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å‰---&quot;</span>);        Object ret = methodInvocation.proceed(); <span class="hljs-comment">// åŸå§‹æ–¹æ³•è¿è¡Œ, è·å–åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</span>        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div><p>é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œ <strong>ä¹‹å</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        Object ret = methodInvocation.proceed(); <span class="hljs-comment">// åŸå§‹æ–¹æ³•è¿è¡Œ, è·å–åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</span>        System.out.println(<span class="hljs-string">&quot;---é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å---&quot;</span>);        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div><p>é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œ <strong>ä¹‹å‰ï¼Œä¹‹å</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å¸¸ç”¨äºäº‹åŠ¡</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;    System.out.println(<span class="hljs-string">&quot;---é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å‰---&quot;</span>);        Object ret = methodInvocation.proceed(); <span class="hljs-comment">// åŸå§‹æ–¹æ³•è¿è¡Œ, è·å–åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</span>        System.out.println(<span class="hljs-string">&quot;---é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œä¹‹å---&quot;</span>);        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div><p>é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        Object ret = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            ret = methodInvocation.proceed(); <span class="hljs-comment">// åŸå§‹æ–¹æ³•è¿è¡Œ, è·å–åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</span>        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;            System.out.println(<span class="hljs-string">&quot;---é¢å¤–åŠŸèƒ½è¿è¡Œåœ¨åŸå§‹æ–¹æ³•æŠ›å¼‚å¸¸çš„æ—¶å€™---&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div><p>MethodInterceptorå½±å“åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---log---&quot;</span>);        Object ret = methodInvocation.proceed();      <span class="hljs-comment">//åŸå§‹æ–¹æ³•è¿”å›ä¸ºtrueï¼Œè¿™é‡Œè®¾ä¸ºfalseä¼šå½±å“</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;&#125;</code></pre></div></li></ul><h3 id="3-2-åˆ‡å…¥ç‚¹è¯¦è§£"><a href="#3-2-åˆ‡å…¥ç‚¹è¯¦è§£" class="headerlink" title="3.2 åˆ‡å…¥ç‚¹è¯¦è§£"></a>3.2 åˆ‡å…¥ç‚¹è¯¦è§£</h3><p>åˆ‡å…¥ç‚¹å†³å®šé¢å¤–åŠŸèƒ½åŠ å…¥ä½ç½®ï¼ˆæ–¹æ³•ï¼‰</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--execution(* * (..)) åŒ¹é…äº†æ‰€æœ‰æ–¹æ³•--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* * (..))&quot;</span>/&gt;</span></code></pre></div><ul><li><code>execution()</code>ï¼š<strong>åˆ‡å…¥ç‚¹å‡½æ•°</strong></li><li><code>* *(..)</code>ï¼š<strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong></li></ul><h4 id="3-2-1-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"><a href="#3-2-1-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼" class="headerlink" title="3.2.1 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"></a>3.2.1 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h4><p>æ–¹æ³•åˆ‡å…¥ç‚¹è¡¨è¾¾å¼<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200425105040237.png" alt="image-20200425105040237"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">*</span> <span class="hljs-emphasis">* (..)    --&gt; æ‰€æœ‰æ–¹æ³•</span><span class="hljs-emphasis"></span><span class="hljs-emphasis">*</span>  ---&gt;  ä¿®é¥°ç¬¦ è¿”å›å€¼<span class="hljs-bullet">*</span>  ---&gt;  æ–¹æ³•å() ---&gt;  å‚æ•°è¡¨.. ---&gt;  å¯¹äºå‚æ•°æ²¡æœ‰è¦æ±‚ (å‚æ•°æœ‰æ²¡æœ‰ï¼Œå‚æ•°æœ‰â¼ä¸ªéƒ½è¡Œï¼Œå‚æ•°æ˜¯ä»€ä¹ˆç±»å‹çš„éƒ½è¡Œ)</code></pre></div><ul><li><p>å®šä¹‰loginæ–¹æ³•ä½œä¸ºåˆ‡å…¥ç‚¹</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å®šä¹‰loginä½œä¸ºåˆ‡å…¥ç‚¹ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login (..))&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!-- å®šä¹‰registerä½œä¸ºåˆ‡å…¥ç‚¹ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* register (..))&quot;</span>/&gt;</span></code></pre></div></li><li><p>å®šä¹‰loginæ–¹æ³•ä¸”loginæ–¹æ³•æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•° ä½œä¸ºåˆ‡å…¥ç‚¹</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login (String,String))&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!-- â¾® java.lang java.lang åŒ…ä¸­çš„ç±»å‹, å¿…é¡»è¦å†™å…¨é™å®šå --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* register (com.yusael.proxy.User))&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--  ..å¯ä»¥å’Œå…·ä½“çš„å‚æ•°ç±»å‹è¿ç”¨ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login(String, ..))&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!-- === login(String), login(String,String), login(String,com.baizhi.edu.proxy.User) --&gt;</span></code></pre></div></li></ul><p>ä¸Šè¯‰è¡¨è¾¾å¼çš„åˆ‡å…¥ç‚¹ä¸å¤Ÿç²¾å‡†</p><p><strong>ç²¾å‡†æ–¹æ³•åˆ‡å…¥ç‚¹é™å®š</strong></p><p>ä¿®é¥°ç¬¦ è¿”å›å€¼         åŒ….ç±».æ–¹æ³•(å‚æ•°)    *   </p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy.UserServiceImpl.login(..))&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy.UserServiceImpl.login(String, String))&quot;</span>/&gt;</span></code></pre></div><p><strong>ç±»åˆ‡å…¥ç‚¹</strong></p><blockquote><p>æŒ‡å®š **ç‰¹å®šç±»ä½œä¸ºåˆ‡å…¥ç‚¹(é¢å¤–åŠŸèƒ½åŠ å…¥çš„ä½ç½®)**ï¼Œè¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½ä¼šåŠ ä¸Šå¯¹åº”çš„é¢å¤–åŠŸèƒ½</p></blockquote><ul><li><p>è¯­æ³•1</p><div class="hljs code-wrapper"><pre><code class="hljs xml"># ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•åŠ å…¥äº†é¢å¤–åŠŸèƒ½<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy.UserServiceImpl.*(..))&quot;</span>/&gt;</span></code></pre></div></li><li><p>è¯­æ³•2 </p><div class="hljs code-wrapper"><pre><code class="hljs xml"># å¿½ç•¥åŒ…1. ç±»åªå­˜åœ¨ä¸€çº§åŒ…<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *.UserServiceImpl.*(..))&quot;</span>/&gt;</span>2. ç±»å­˜åœ¨å¤šçº§åŒ…<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *..UserServiceImpl.*(..))&quot;</span>/&gt;</span></code></pre></div></li></ul><p><strong>åŒ…åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆå®æˆ˜ç”¨çš„å¤šï¼‰</strong></p><blockquote><p>æŒ‡å®šåŒ…ä½œä¸ºé¢å¤–åŠŸèƒ½åŠ å…¥çš„ä½ç½®ï¼Œè‡ªç„¶åŒ…ä¸­çš„æ‰€æœ‰ç±»åŠå…¶æ–¹æ³•éƒ½ä¼šåŠ å…¥é¢å¤–çš„åŠŸèƒ½</p></blockquote><ul><li><p>è¯­æ³•1</p><div class="hljs code-wrapper"><pre><code class="hljs xml"># åˆ‡å…¥ç‚¹åŒ…ä¸­çš„æ‰€æœ‰ç±»ï¼Œå¿…é¡»åœ¨proxyä¸­ï¼Œä¸èƒ½åœ¨proxyåŒ…çš„â¼¦åŒ…ä¸­<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy.*.*(..))&quot;</span>/&gt;</span></code></pre></div></li><li><p>è¯­æ³•2</p><div class="hljs code-wrapper"><pre><code class="hljs xml"># åˆ‡å…¥ç‚¹å½“å‰åŒ…åŠå…¶â¼¦åŒ…éƒ½ç”Ÿæ•ˆ<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy..*.*(..))&quot;</span>/&gt;</span></code></pre></div></li></ul><h4 id="3-2-2-åˆ‡å…¥ç‚¹å‡½æ•°"><a href="#3-2-2-åˆ‡å…¥ç‚¹å‡½æ•°" class="headerlink" title="3.2.2 åˆ‡å…¥ç‚¹å‡½æ•°"></a>3.2.2 åˆ‡å…¥ç‚¹å‡½æ•°</h4><blockquote><p>åˆ‡å…¥ç‚¹å‡½æ•°ï¼šç”¨äºæ‰§è¡Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p></blockquote><ul><li>execution</li></ul><p><code>execution</code> æ˜¯æœ€ä¸ºé‡è¦çš„åˆ‡å…¥ç‚¹å‡½æ•°ï¼ŒåŠŸèƒ½æœ€å…¨ï¼›å¯ä»¥æ‰§è¡Œæ‰§è¡Œ <strong>æ–¹æ³•åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong>ã€<strong>ç±»åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong>ã€<strong>åŒ…åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong><br>å¼Šç«¯ï¼š<code>execution</code> æ‰§â¾åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ ï¼Œä¹¦å†™éº»çƒ¦</p><div class="hljs code-wrapper"><pre><code class="hljs xml">execution(* com.yusael.proxy..*.*(..))</code></pre></div><p>æ³¨æ„ï¼šå…¶ä»–çš„ åˆ‡å…¥ç‚¹å‡½æ•° ç®€åŒ–çš„æ˜¯ <code>execution</code> çš„ä¹¦å†™å¤æ‚åº¦ï¼ŒåŠŸèƒ½ä¸Šå®Œå…¨â¼€è‡´</p><ul><li>args</li></ul><p><code>args</code> ä½œç”¨ï¼šä¸»è¦ç”¨äº <strong>å‡½æ•°(æ–¹æ³•) å‚æ•°çš„åŒ¹é…</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml">åˆ‡å…¥ç‚¹ï¼šæ–¹æ³•å‚æ•°å¿…é¡»å¾—æ˜¯ 2 ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°# ä½¿ç”¨ execution<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *(String, String))&quot;</span>/&gt;</span># ä½¿ç”¨ args<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;args(String, String)&quot;</span>/&gt;</span></code></pre></div><ul><li>within</li></ul><p><code>within</code> ä½œç”¨ï¼šä¸»è¦ç”¨äºè¿›è¡Œ <strong>ç±»ã€åŒ…åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong> çš„åŒ¹é…</p><div class="hljs code-wrapper"><pre><code class="hljs xml">åˆ‡å…¥ç‚¹: UserServiceImpl è¿™ä¸ªç±»# ä½¿ç”¨ execution<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;expression(* *..UserServiceImpl.*(..))&quot;</span>/&gt;</span># ä½¿ç”¨ within<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;within(*..UserServiceImpl)&quot;</span>/&gt;</span>åˆ‡å…¥ç‚¹: com.yusael.proxy è¿™ä¸ªåŒ…# ä½¿ç”¨ execution<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.proxy..*.*(..)&quot;</span>/&gt;</span># ä½¿ç”¨ within<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;within(com.yusael.proxy..*)&quot;</span>/&gt;</span></code></pre></div><ul><li>@annotation</li></ul><p>ä½œç”¨ï¼šä¸ºå…·æœ‰ç‰¹æ®Šæ³¨è§£çš„ <strong>æ–¹æ³•</strong> åŠ å…¥é¢å¤–åŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ï¼š<code>Log</code></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.METHOD)</span><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Log &#123;&#125;</code></pre></div><p>ç„¶åæˆ‘ä»¬è¦ä¸ºä½¿ç”¨äº† <code>Log</code> æ³¨è§£çš„æ–¹æ³•åŠ å…¥é¢å¤–åŠŸèƒ½</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;@annotation(com.yusael.Log)&quot;</span>/&gt;</span></code></pre></div><p><strong>åˆ‡å…¥ç‚¹å‡½æ•°çš„é€»è¾‘è¿ç®—</strong></p><blockquote><p>æŒ‡çš„æ˜¯ æ•´åˆå¤šä¸ªåˆ‡å…¥ç‚¹å‡½æ•°ä¸€èµ·é…åˆå·¥ä½œï¼Œè¿›è€Œå®Œæˆæ›´ä¸ºå¤æ‚çš„éœ€æ±‚</p></blockquote><ul><li><p>andä¸æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs xml">æ¡ˆä¾‹: æ–¹æ³•åå« login åŒæ—¶ å‚æ•°æ˜¯ 2ä¸ªå­—ç¬¦ä¸²# execution<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login(String, String))&quot;</span>/&gt;</span># execution and args<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login(..)) and args(String, String))&quot;</span>/&gt;</span></code></pre></div></li><li><p>oræˆ–æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs xml">æ¡ˆä¾‹: æ–¹æ³•åå« register æˆ– login çš„â½…æ³•ä½œä¸ºåˆ‡â¼Šç‚¹<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* login(..)) or execution(* register(..))&quot;</span>/&gt;</span></code></pre></div></li></ul><h2 id="4-AOPç¼–ç¨‹"><a href="#4-AOPç¼–ç¨‹" class="headerlink" title="4. AOPç¼–ç¨‹"></a>4. AOPç¼–ç¨‹</h2><h3 id="4-1-AOPæ¦‚å¿µ"><a href="#4-1-AOPæ¦‚å¿µ" class="headerlink" title="4.1 AOPæ¦‚å¿µ"></a>4.1 AOPæ¦‚å¿µ</h3><blockquote><p>POP (Producer Oriented Programingï¼‰</p><ul><li>é¢å‘è¿‡ç¨‹ï¼ˆæ–¹æ³•ã€å‡½æ•°ï¼‰ç¼–ç¨‹ â€”â€” C</li><li>ä»¥è¿‡ç¨‹ä¸ºåŸºæœ¬å•ä½çš„ç¨‹åºå¼€å‘ï¼Œé€šè¿‡è¿‡ç¨‹é—´çš„å½¼æ­¤ååŒï¼Œç›¸äº’è°ƒç”¨ï¼Œå®Œæˆç¨‹åºçš„æ„å»º</li></ul><p>OOP (Object Oritened Programing)</p><ul><li>é¢å‘å¯¹è±¡ç¼–ç¨‹ â€”â€” Java</li><li>ä»¥å¯¹è±¡ä¸ºåŸºæœ¬å•ä½çš„ç¨‹åºå¼€å‘ï¼Œé€šè¿‡å¯¹è±¡é—´çš„å½¼æ­¤ååŒï¼Œç›¸äº’è°ƒç”¨ï¼Œå®Œæˆç¨‹åºçš„æ„å»º</li></ul><p>AOP (Aspect Oriented Programing)</p><ul><li>é¢å‘åˆ‡é¢ç¼–ç¨‹ = SpringåŠ¨æ€ä»£ç†å¼€å‘</li><li>ä»¥åˆ‡é¢ä¸ºåŸºæœ¬å•ä½çš„ç¨‹åºå¼€å‘ï¼Œé€šè¿‡åˆ‡é¢é—´çš„å½¼æ­¤ååŒï¼Œç›¸äº’è°ƒç”¨ï¼Œå®Œæˆç¨‹åºçš„æ„å»º</li><li>åˆ‡é¢ = åˆ‡å…¥ç‚¹ + é¢å¤–åŠŸèƒ½</li></ul></blockquote><ul><li>æœ¬è´¨å°±æ˜¯ Spring çš„åŠ¨æ€ä»£ç†å¼€å‘ï¼Œé€šè¿‡ä»£ç†ç±»ä¸ºåŸå§‹ç±»å¢åŠ é¢å¤–åŠŸèƒ½</li><li>å¥½å¤„ï¼šåˆ©äºåŸå§‹ç±»çš„ç»´æŠ¤</li><li>æ³¨æ„ï¼šAOP ç¼–ç¨‹ä¸å¯èƒ½å–ä»£ OOPï¼ŒAOP æ˜¯ OOP ç¼–ç¨‹çš„è¡¥å……</li></ul><h3 id="4-2-AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤"><a href="#4-2-AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤" class="headerlink" title="4.2 AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤"></a>4.2 AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤</h3><ol><li>åŸå§‹å¯¹è±¡</li><li>é¢å¤–åŠŸèƒ½ (<code>MethodInterceptor</code>)</li><li>åˆ‡å…¥ç‚¹</li><li>ç»„è£…åˆ‡é¢ (é¢å¤–åŠŸèƒ½+åˆ‡å…¥ç‚¹)</li></ol><h3 id="4-3-åˆ‡é¢çš„åè¯è§£é‡Š"><a href="#4-3-åˆ‡é¢çš„åè¯è§£é‡Š" class="headerlink" title="4.3 åˆ‡é¢çš„åè¯è§£é‡Š"></a>4.3 åˆ‡é¢çš„åè¯è§£é‡Š</h3><p>åˆ‡é¢ = åˆ‡å…¥ç‚¹ + é¢å¤–åŠŸèƒ½ å‡ ä½•å­¦<br>é¢ = ç‚¹ + ç›¸åŒçš„æ€§è´¨</p><p><strong>ç”±å„ä¸ªç±»å…·æœ‰çš„ç›¸åŒé¢å¤–åŠŸèƒ½ï¼Œæ„æˆäº†ä¸€ä¸ªåˆ‡é¢</strong></p><p><strong>ä¸åŒçš„é¢å¤–åŠŸèƒ½ï¼Œæ„æˆäº†å¤šä¸ªåˆ‡é¢</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200427134740273.png" alt="image-20200427134740273"></p><h2 id="5-AOPçš„åº•å±‚å®ç°åŸç†"><a href="#5-AOPçš„åº•å±‚å®ç°åŸç†" class="headerlink" title="5. AOPçš„åº•å±‚å®ç°åŸç†"></a>5. AOPçš„åº•å±‚å®ç°åŸç†</h2><h3 id="5-1-æ ¸å¿ƒé—®é¢˜"><a href="#5-1-æ ¸å¿ƒé—®é¢˜" class="headerlink" title="5.1 æ ¸å¿ƒé—®é¢˜"></a>5.1 æ ¸å¿ƒé—®é¢˜</h3><ul><li>AOP å¦‚ä½•åˆ›å»ºåŠ¨æ€ä»£ç†ç±»ï¼Ÿ<br><strong>åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯</strong></li><li>Spring å·¥å‚å¦‚ä½•åŠ å·¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Ÿ<br><strong>é€šè¿‡åŸå§‹å¯¹è±¡çš„ id å€¼ï¼Œè·å¾—çš„æ˜¯ä»£ç†å¯¹è±¡</strong></li></ul><h3 id="5-2-åŠ¨æ€ä»£ç†ç±»çš„åˆ›å»ºï¼ˆé‡ç‚¹ï¼‰"><a href="#5-2-åŠ¨æ€ä»£ç†ç±»çš„åˆ›å»ºï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="5.2 åŠ¨æ€ä»£ç†ç±»çš„åˆ›å»ºï¼ˆé‡ç‚¹ï¼‰"></a>5.2 åŠ¨æ€ä»£ç†ç±»çš„åˆ›å»ºï¼ˆé‡ç‚¹ï¼‰</h3><h4 id="5-2-1-JDKçš„åŠ¨æ€ä»£ç†"><a href="#5-2-1-JDKçš„åŠ¨æ€ä»£ç†" class="headerlink" title="5.2.1 JDKçš„åŠ¨æ€ä»£ç†"></a>5.2.1 JDKçš„åŠ¨æ€ä»£ç†</h4><ul><li><code>Proxy.newProxyInstance</code>æ–¹æ³•å‚æ•°è¯¦è§£<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200428175248912.png" alt="image-20200428175248912"></li></ul><p><strong>ç±»åŠ è½½å™¨</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200428175316276.png" alt="image-20200428175316276"></p><ul><li><p>ç¼–ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestJDKProxy</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     1. å€Ÿâ½¤ç±»åŠ è½½å™¨  TestJDKProxy æˆ– UserServiceImpl éƒ½å¯ä»¥</span><span class="hljs-comment">     2. JDK8.x å‰å¿…é¡»åŠ  final</span><span class="hljs-comment">     final UserService userService = new UserServiceImpl();</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">// 1. åˆ›å»ºåŸå§‹å¯¹è±¡</span>        UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();        <span class="hljs-comment">// 2. JDK åŠ¨æ€ä»£ç†</span>        InvocationHandler handler = <span class="hljs-keyword">new</span> InvocationHandler() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;                System.out.println(<span class="hljs-string">&quot;---- proxy log ----&quot;</span>);                <span class="hljs-comment">// åŸå§‹æ–¹æ³•è¿è¡Œ</span>                Object ret = method.invoke(userService, args);                <span class="hljs-keyword">return</span> ret;            &#125;        &#125;;        <span class="hljs-comment">//å€Ÿç”¨ClassLoader</span>        UserService userServiceProxy = (UserService) Proxy.                newProxyInstance(TestJDKProxy.class.getClassLoader(),                                userService.getClass().getInterfaces(),                                handler);        userServiceProxy.login(<span class="hljs-string">&quot;luci&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);        userServiceProxy.register(<span class="hljs-keyword">new</span> User());    &#125;&#125;</code></pre></div></li></ul><h4 id="5-2-2-CGlibçš„åŠ¨æ€ä»£ç†"><a href="#5-2-2-CGlibçš„åŠ¨æ€ä»£ç†" class="headerlink" title="5.2.2 CGlibçš„åŠ¨æ€ä»£ç†"></a>5.2.2 CGlibçš„åŠ¨æ€ä»£ç†</h4><blockquote><p>CGlibåˆ›å»ºåŠ¨æ€ä»£ç†çš„åŸç†ï¼šçˆ¶å­ç»§æ‰¿å…³ç³»åˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒåŸå§‹ç±»ä½œä¸ºçˆ¶ç±»ï¼Œä»£ç†ç±»ä½œä¸ºå­ç±»ï¼Œè¿™æ ·æ—¢å¯ä»¥ä¿è¯2è€…æ–¹æ³•ä¸€è‡´ï¼ŒåŒæ—¶åœ¨ä»£ç†ç±»ä¸­æä¾›æ–°çš„å®ç°(é¢å¤–åŠŸèƒ½+åŸå§‹æ–¹æ³•)</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200429111709226.png" alt="image-20200429111709226"></p><ul><li><p>CGlibç¼–ç  </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCglib</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">// 1. åˆ›å»ºåŸå§‹å¯¹è±¡</span>        UserService userService = <span class="hljs-keyword">new</span> UserService();        <span class="hljs-comment">/*</span><span class="hljs-comment">         2. é€šè¿‡ cglib æ–¹å¼åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡</span><span class="hljs-comment">         å¯¹æ¯” jdk åŠ¨æ€ä»£ç† ---&gt; Proxy.newProxyInstance(classLoader, interface, invocationHandler);</span><span class="hljs-comment"></span><span class="hljs-comment">         Enhancer.setClassLoader()</span><span class="hljs-comment">         Enhancer.setSuperClass()</span><span class="hljs-comment">         Enhancer.setCallBack() ---&gt; MethodInterceptor(cglib)</span><span class="hljs-comment">         Enhancer.createProxy() ---&gt; åˆ›å»ºä»£ç†å¯¹è±¡</span><span class="hljs-comment">         */</span>        Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer();        enhancer.setClassLoader(TestCglib.class.getClassLoader());        enhancer.setSuperclass(userService.getClass());        MethodInterceptor interceptor = <span class="hljs-keyword">new</span> MethodInterceptor() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;                System.out.println(<span class="hljs-string">&quot;--- cglib log ----&quot;</span>);                Object ret = method.invoke(userService, args); <span class="hljs-comment">// æ‰§è¡ŒåŸå§‹æ–¹æ³•</span>                <span class="hljs-keyword">return</span> ret;            &#125;        &#125;;<span class="hljs-comment">//é¢å¤–åŠŸèƒ½</span>        enhancer.setCallback(interceptor);      <span class="hljs-comment">//åˆ›å»ºä»£ç†</span>        UserService userServiceProxy = (UserService) enhancer.create();        userServiceProxy.login(<span class="hljs-string">&quot;zhenyu&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);        userServiceProxy.register(<span class="hljs-keyword">new</span> User());    &#125;&#125;</code></pre></div></li><li><p>æ€»ç»“</p><ol><li>JDK åŠ¨æ€ä»£ç†<br><code>Proxy.newProxyInstance</code>ï¼šé€šè¿‡æ¥å£åˆ›å»ºä»£ç†çš„å®ç°ç±»</li><li>Cglib åŠ¨æ€ä»£ç†<br><code>Enhancer</code>ï¼šé€šè¿‡ç»§æ‰¿â½—ç±»åˆ›å»ºçš„ä»£ç†ç±»</li></ol></li></ul><h3 id="5-3-Springå·¥å‚å¦‚ä½•åŠ å·¥åŸå§‹å¯¹è±¡"><a href="#5-3-Springå·¥å‚å¦‚ä½•åŠ å·¥åŸå§‹å¯¹è±¡" class="headerlink" title="5.3 Springå·¥å‚å¦‚ä½•åŠ å·¥åŸå§‹å¯¹è±¡"></a>5.3 Springå·¥å‚å¦‚ä½•åŠ å·¥åŸå§‹å¯¹è±¡</h3><ul><li><p>æ€è·¯åˆ†æï¼šä¸»è¦é€šè¿‡ <code>BeanPostProcessor</code> å°†åŸå§‹å¯¹è±¡åŠ å·¥ä¸ºä»£ç†å¯¹è±¡<br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200430113353205.png" alt="image-20200430113353205"></p></li><li><p>ç¼–ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProxyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanPostProcessor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        InvocationHandler handler = <span class="hljs-keyword">new</span> InvocationHandler() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;                System.out.println(<span class="hljs-string">&quot;--- new log ---&quot;</span>);                Object ret = method.invoke(bean, args);                <span class="hljs-keyword">return</span> ret;            &#125;        &#125;;        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(ProxyBeanPostProcessor.class.getClassLoader(), bean.getClass().getInterfaces(), handler);    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.factory.UserServiceImpl&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--1. å®ç° BeanPostProcessor è¿›è¡ŒåŠ å·¥--&gt;</span><span class="hljs-comment">&lt;!--2. é…ç½®æ–‡ä»¶ä¸­å¯¹ BeanPostProcessor è¿›è¡Œé…ç½®--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;proxyBeanPostProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.factory.ProxyBeanPostProcessor&quot;</span>/&gt;</span></code></pre></div></li></ul><h2 id="6-åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹"><a href="#6-åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹" class="headerlink" title="6. åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹"></a>6. åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹</h2><h3 id="6-1-åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤"><a href="#6-1-åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤" class="headerlink" title="6.1 åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤"></a>6.1 åŸºäºæ³¨è§£çš„AOPç¼–ç¨‹çš„å¼€å‘æ­¥éª¤</h3><ul><li>åŸå§‹å¯¹è±¡</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span></span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.register ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-comment">// throw new RuntimeException(&quot;æµ‹è¯•å¼‚å¸¸&quot;);</span>    &#125;    <span class="hljs-meta">@Log</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.login ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><ul><li><p>é¢å¤–åŠŸèƒ½</p></li><li><p>åˆ‡å…¥ç‚¹</p></li><li><p>ç»„è£…åˆ‡é¢</p> <div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><span class="hljs-comment">    1. é¢å¤–åŠŸèƒ½</span><span class="hljs-comment">        public class MyAround implements MethodInterceptor &#123;</span><span class="hljs-comment">            public Object invoke(MethodInvocation invocation) &#123;</span><span class="hljs-comment">                Object ret = invocation.invoke();</span><span class="hljs-comment">                return ret;</span><span class="hljs-comment">            &#125;</span><span class="hljs-comment">        &#125;</span><span class="hljs-comment">        &lt;bean id=&quot;around&quot; class=&quot;com.yusael.dynamic.Around&quot;/&gt;</span><span class="hljs-comment"></span><span class="hljs-comment">    2. åˆ‡å…¥ç‚¹</span><span class="hljs-comment">        &lt;aop:config&gt;</span><span class="hljs-comment">            &lt;aop:pointcut id=&quot;pc&quot; expression=&quot;execution(* login(..)))&quot;/&gt;</span><span class="hljs-comment">            &lt;aop:advisor advice-ref=&quot;around&quot; pointcut-ref=&quot;pc&quot;/&gt;</span><span class="hljs-comment">        &lt;/aop:config&gt;</span><span class="hljs-comment"> */</span><span class="hljs-comment">//é€šè¿‡åˆ‡é¢ç±»å®šä¹‰äº†é¢å¤–åŠŸèƒ½ @Around </span><span class="hljs-comment">//åˆ‡å…¥ç‚¹ @Around(&quot;execution(* login(..))&quot;)</span><span class="hljs-comment">//åˆ‡é¢ç±» @Aspect</span><span class="hljs-meta">@Aspect</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;    <span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---- aspect log ----&quot;</span>);        Object ret = joinPoint.proceed();        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div> <div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.aspect.UserServiceImpl&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--</span><span class="hljs-comment">        åˆ‡é¢:</span><span class="hljs-comment">            1. é¢å¤–åŠŸèƒ½</span><span class="hljs-comment">            2. åˆ‡å…¥ç‚¹å•Š</span><span class="hljs-comment">            3. ç»„è£…åˆ‡é¢</span><span class="hljs-comment">    --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;around&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.aspect.MyAspect&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--å‘ŠçŸ¥ Spring åŸºäºæ³¨è§£è¿›è¡Œ AOP ç¼–ç¨‹--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div></li></ul><h3 id="6-2-ç»†èŠ‚"><a href="#6-2-ç»†èŠ‚" class="headerlink" title="6.2 ç»†èŠ‚"></a>6.2 ç»†èŠ‚</h3><p><strong>åˆ‡å…¥ç‚¹å¤ç”¨</strong>ï¼šåœ¨åˆ‡é¢ç±»ä¸­å®šä¹‰â¼€ä¸ªå‡½æ•°ï¼Œä¸Šé¢ç”¨ <code>@Pointcut</code> æ³¨è§£<br>é€šè¿‡è¿™ç§æ–¹å¼å®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œåç»­æ›´åŠ æœ‰åˆ©äºåˆ‡å…¥ç‚¹å¤ç”¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;    <span class="hljs-meta">@Pointcut(&quot;execution(* login(..))&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myPoincut</span><span class="hljs-params">()</span> </span>&#123;&#125;    <span class="hljs-meta">@Around(value = &quot;myPoincut()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---- aspect log ----&quot;</span>);        Object ret = joinPoint.proceed();        <span class="hljs-keyword">return</span> ret;    &#125;    <span class="hljs-meta">@Around(value = &quot;myPoincut()&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">around1</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        System.out.println(<span class="hljs-string">&quot;---- aspect transaction ----&quot;</span>);        Object ret = joinPoint.proceed();        <span class="hljs-keyword">return</span> ret;    &#125;&#125;</code></pre></div><p><strong>åŠ¨æ€ä»£ç†çš„åˆ›å»ºæ–¹å¼</strong> </p><p>AOP åº•å±‚å®ç° 2 ç§ä»£ç†åˆ›å»ºæ–¹å¼ï¼š</p><ol><li>JDKï¼šé€šè¿‡ <strong>å®ç°æ¥å£ï¼Œåšæ–°çš„å®ç°ç±»</strong> åˆ›å»ºä»£ç†å¯¹è±¡</li><li>Cglibï¼šé€šè¿‡ <strong>ç»§æ‰¿çˆ¶ç±»ï¼Œåšæ–°çš„å­ç±»</strong> åˆ›å»ºä»£ç†å¯¹è±¡</li></ol><p><strong>é»˜è®¤æƒ…å†µ AOP ç¼–ç¨‹ åº•å±‚åº”ç”¨ JDKåŠ¨æ€ä»£ç†åˆ›å»ºæ–¹å¼</strong>ã€‚</p><p>åŸºäºæ³¨è§£çš„ AOP å¼€å‘ ä¸­åˆ‡æ¢ä¸º Cglibï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span></code></pre></div><p>ä¼ ç»Ÿçš„ AOP å¼€å‘ ä¸­åˆ‡æ¢ä¸º Cglibï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span></code></pre></div><h2 id="7-AOPå¼€å‘ä¸­çš„ä¸€ä¸ªå‘"><a href="#7-AOPå¼€å‘ä¸­çš„ä¸€ä¸ªå‘" class="headerlink" title="7. AOPå¼€å‘ä¸­çš„ä¸€ä¸ªå‘"></a>7. AOPå¼€å‘ä¸­çš„ä¸€ä¸ªå‘</h2><p><strong>å‘ï¼</strong>ï¼šåœ¨åŒâ¼€ä¸ªä¸šåŠ¡ç±»ä¸­ï¼Œè¿›â¾ä¸šåŠ¡æ–¹æ³•é—´çš„ç›¸äº’è°ƒç”¨ï¼Œåªæœ‰æœ€å¤–å±‚çš„æ–¹æ³•ï¼Œæ‰æ˜¯åŠ å…¥äº†é¢å¤–åŠŸèƒ½(å†…éƒ¨çš„æ–¹æ³•ï¼Œé€šè¿‡æ™®é€šçš„æ–¹å¼è°ƒç”¨ï¼Œéƒ½è°ƒç”¨çš„æ˜¯åŸå§‹æ–¹æ³•)ã€‚å¦‚æœæƒ³è®©å†…å±‚çš„æ–¹æ³•ä¹Ÿè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±è¦å®ç° <code>AppicationContextAware</code> è·å¾—â¼¯å‚ï¼Œè¿›è€Œè·å¾—ä»£ç†å¯¹è±¡</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span>, <span class="hljs-title">ApplicationContextAware</span> </span>&#123;    <span class="hljs-keyword">private</span> ApplicationContext ctx;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        <span class="hljs-keyword">this</span>.ctx = applicationContext;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(User user)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.register ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-comment">// this.login(&quot;zhenyu&quot;, &quot;123456&quot;); // è¿™ä¹ˆå†™è°ƒç”¨çš„æ˜¯æœ¬ç±»çš„ login æ–¹æ³•, å³åŸå§‹å¯¹è±¡çš„ login æ–¹æ³•</span>        <span class="hljs-comment">// ä¸ºä»€ä¹ˆä¸åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªå·¥å‚è·å–ä»£ç†å¯¹è±¡å‘¢ï¼Ÿ</span>        <span class="hljs-comment">// Springçš„å·¥å‚æ˜¯é‡é‡çº§èµ„æº, ä¸€ä¸ªåº”ç”¨ä¸­åº”è¯¥åªåˆ›å»ºä¸€ä¸ªå·¥å‚.</span>        <span class="hljs-comment">// å› æ­¤æˆ‘ä»¬å¿…é¡»é€šè¿‡ ApplicationContextAware æ‹¿åˆ°å·²ç»åˆ›å»ºå¥½çš„å·¥å‚</span>        UserService userService = (UserService) ctx.getBean(<span class="hljs-string">&quot;userService&quot;</span>);        userService.login(<span class="hljs-string">&quot;yusael&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String name, String password)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;UserServiceImpl.login ä¸šåŠ¡è¿ç®— + DAO&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><h2 id="8-AOPé˜¶æ®µçŸ¥è¯†æ€»ç»“"><a href="#8-AOPé˜¶æ®µçŸ¥è¯†æ€»ç»“" class="headerlink" title="8. AOPé˜¶æ®µçŸ¥è¯†æ€»ç»“"></a>8. AOPé˜¶æ®µçŸ¥è¯†æ€»ç»“</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200503162625116.png" alt="image-20200503162625116"></p><h1 id="ç¬¬å››ç« ã€SpringæŒä¹…å±‚"><a href="#ç¬¬å››ç« ã€SpringæŒä¹…å±‚" class="headerlink" title="ç¬¬å››ç« ã€SpringæŒä¹…å±‚"></a>ç¬¬å››ç« ã€SpringæŒä¹…å±‚</h1><hr><h2 id="1-æŒä¹…å±‚æ•´åˆ"><a href="#1-æŒä¹…å±‚æ•´åˆ" class="headerlink" title="1. æŒä¹…å±‚æ•´åˆ"></a>1. æŒä¹…å±‚æ•´åˆ</h2><h3 id="1-1Springæ¡†æ¶ä¸ºä»€ä¹ˆè¦ä¸æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆ"><a href="#1-1Springæ¡†æ¶ä¸ºä»€ä¹ˆè¦ä¸æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆ" class="headerlink" title="1.1Springæ¡†æ¶ä¸ºä»€ä¹ˆè¦ä¸æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆ"></a>1.1Springæ¡†æ¶ä¸ºä»€ä¹ˆè¦ä¸æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆ</h3><ul><li>JavaEEå¼€å‘éœ€è¦æŒä¹…å±‚è¿›è¡Œæ•°æ®åº“çš„è®¿é—®æ“ä½œ</li><li>JDBCã€Hibernateã€MyBatis è¿›è¡ŒæŒä¹…å¼€å‘è¿‡ç¨‹å­˜åœ¨å¤§é‡çš„ä»£ç å†—ä½™</li><li>Spring åŸºäºæ¨¡æ¿è®¾è®¡æ¨¡å¼å¯¹äºä¸Šè¿°çš„æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œäº†å°è£…</li></ul><h3 id="1-2-Springå¯ä»¥ä¸é‚£äº›æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆï¼Ÿ"><a href="#1-2-Springå¯ä»¥ä¸é‚£äº›æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆï¼Ÿ" class="headerlink" title="1.2 Springå¯ä»¥ä¸é‚£äº›æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆï¼Ÿ"></a>1.2 Springå¯ä»¥ä¸é‚£äº›æŒä¹…å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆï¼Ÿ</h3><ul><li>JDBC â€”â€” <code>JDBCTemplate</code></li><li>Hibernateï¼ˆJPAï¼‰â€”â€” <code>HibernateTemplate</code></li><li><strong>MyBatis</strong> â€”â€” <code>SqlSessionFactoryBean</code>ã€<code>MapperScannerConfigure</code></li></ul><h2 id="2-Springä¸MyBatisæ•´åˆ"><a href="#2-Springä¸MyBatisæ•´åˆ" class="headerlink" title="2. Springä¸MyBatisæ•´åˆ"></a>2. Springä¸MyBatisæ•´åˆ</h2><h3 id="2-1-MyBatiså¼€å‘æ­¥éª¤çš„å›é¡¾"><a href="#2-1-MyBatiså¼€å‘æ­¥éª¤çš„å›é¡¾" class="headerlink" title="2.1 MyBatiså¼€å‘æ­¥éª¤çš„å›é¡¾"></a>2.1 MyBatiså¼€å‘æ­¥éª¤çš„å›é¡¾</h3><ul><li>å®ä½“ç±» <code>User</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(Integer id, String name, String password)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;        <span class="hljs-keyword">this</span>.name = name;        <span class="hljs-keyword">this</span>.password = password;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> password;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;        <span class="hljs-keyword">this</span>.password = password;    &#125;&#125;</code></pre></div><ul><li>å®ä½“åˆ«å <code>mybatis-config.xml</code> é…ç½®ç¹ç</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Confi 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.yusael.mybatis.User&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;mysql&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mysql&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">transactionManager</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/yus?useSSL=false&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1234&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><ul><li>è¡¨ t_users</li></ul><div class="hljs code-wrapper"><pre><code class="hljs mysql">create table t_users values (id int(11) primary key auto_increment,name varchar(12),password varchar(12));</code></pre></div><ul><li>åˆ›å»º DAO æ¥å£ï¼š<code>UserDAO</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDAO</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(User user)</span></span>;&#125;</code></pre></div><ul><li>å®ç°Mapperæ–‡ä»¶ï¼š<code>UserDAOMapper.xml</code> é…ç½®ç¹ç </li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.yusael.mybatis.UserDAO&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>        insert into t_users(name, password) values (#&#123;name&#125;, #&#123;password&#125;)    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><ul><li>æ³¨å†Œ Mapper æ–‡ä»¶ <code>mybatis-config.xml</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;UserDAOMapper.xml&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div><ul><li>MybatisAPIè°ƒç”¨  ä»£ç å†—ä½™ </li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMybatis</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        InputStream inputStream = Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>);        SqlSessionFactory sqlSessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);        SqlSession session = sqlSessionFactory.openSession();        UserDAO userDAO = session.getMapper(UserDAO.class);        User user = <span class="hljs-keyword">new</span> User();        user.setName(<span class="hljs-string">&quot;yusael&quot;</span>);        user.setPassword(<span class="hljs-string">&quot;123456&quot;</span>);        userDAO.save(user);        session.commit();    &#125;&#125;</code></pre></div><h3 id="2-2-Mybatisåœ¨å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜"><a href="#2-2-Mybatisåœ¨å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜" class="headerlink" title="2.2 Mybatisåœ¨å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜"></a>2.2 Mybatisåœ¨å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜</h3><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># é…ç½®ç¹ç  ä»£ç å†—ä½™ </span><span class="hljs-bullet">1.</span> å®ä½“<span class="hljs-bullet">2.</span> å®ä½“åˆ«å         é…ç½®ç¹ç <span class="hljs-bullet">3.</span> è¡¨<span class="hljs-bullet">4.</span> åˆ›å»ºDAOæ¥å£<span class="hljs-bullet">5.</span> å®ç°Mapperæ–‡ä»¶<span class="hljs-bullet">6.</span> æ³¨å†ŒMapperæ–‡ä»¶   é…ç½®ç¹ç <span class="hljs-bullet">7.</span> MybatisAPIè°ƒç”¨  ä»£ç å†—ä½™</code></pre></div><h3 id="2-3-Springä¸Mybatisæ•´åˆæ€è·¯åˆ†æ"><a href="#2-3-Springä¸Mybatisæ•´åˆæ€è·¯åˆ†æ" class="headerlink" title="2.3 Springä¸Mybatisæ•´åˆæ€è·¯åˆ†æ"></a>2.3 Springä¸Mybatisæ•´åˆæ€è·¯åˆ†æ</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200504141407141.png" alt="image-20200504141407141"></p><h3 id="2-4-Springä¸Mybatisæ•´åˆçš„å¼€å‘æ­¥éª¤"><a href="#2-4-Springä¸Mybatisæ•´åˆçš„å¼€å‘æ­¥éª¤" class="headerlink" title="2.4 Springä¸Mybatisæ•´åˆçš„å¼€å‘æ­¥éª¤"></a>2.4 Springä¸Mybatisæ•´åˆçš„å¼€å‘æ­¥éª¤</h3><ul><li><p>é…ç½®æ–‡ä»¶ï¼ˆ<code>ApplicationContext.xml</code>) è¿›è¡Œç›¸å…³é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs xml">#é…ç½® æ˜¯éœ€è¦é…ç½®ä¸€æ¬¡ <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span> <span class="hljs-comment">&lt;!--åˆ›å»ºSqlSessionFactory--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ssfb&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;SqlSessionFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span>&gt;</span>         æŒ‡å®š å®ä½“ç±»æ‰€åœ¨çš„åŒ…  com.baizhiedu.entity  User                                                 Product    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span>&gt;</span>          æŒ‡å®š é…ç½®æ–‡ä»¶(æ˜ å°„æ–‡ä»¶)çš„è·¯å¾„ è¿˜æœ‰é€šç”¨é…ç½®           com.baizhiedu.mapper/*Mapper.xml     <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--DAOæ¥å£çš„å®ç°ç±»</span><span class="hljs-comment">    session ---&gt;</span> session.getMapper() --- xxxDAOå®ç°ç±»å¯¹è±¡     XXXDAO  ---&gt; xXXDAO--&gt;<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scanner&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MapperScannerConfigure&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ssfb&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePacakge&quot;</span>&gt;</span>        æŒ‡å®š DAOæ¥å£æ”¾ç½®çš„åŒ…  com.baizhiedu.dao     <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div></li><li><p>ç¼–ç </p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># å®æˆ˜ç»å¸¸æ ¹æ®éœ€æ±‚ å†™çš„ä»£ç </span><span class="hljs-bullet">1.</span> å®ä½“<span class="hljs-bullet">2.</span> è¡¨<span class="hljs-bullet">3.</span> åˆ›å»ºDAOæ¥å£<span class="hljs-bullet">4.</span> å®ç°Mapperæ–‡ä»¶</code></pre></div></li></ul><h3 id="2-5-Springä¸Mybatisæ•´åˆç¼–ç "><a href="#2-5-Springä¸Mybatisæ•´åˆç¼–ç " class="headerlink" title="2.5 Springä¸Mybatisæ•´åˆç¼–ç "></a>2.5 Springä¸Mybatisæ•´åˆç¼–ç </h3><ul><li><p><strong>æ­å»ºå¼€å‘ç¯å¢ƒ(jar)</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.18<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.48<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div></li><li><p><strong>Springé…ç½®æ–‡ä»¶çš„é…ç½®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è¿æ¥æ± --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/suns?useSSL=false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--åˆ›å»ºSqlSessionFactory SqlSessionFactoryBean--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.baizhiedu.entity&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>classpath:com.baizhiedu.mapper/*Mapper.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--åˆ›å»ºDAOå¯¹è±¡ MapperScannerConfigure--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scanner&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.baizhiedu.dao&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div></li><li><p><strong>ç¼–ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å®ä½“<span class="hljs-bullet">2.</span> è¡¨<span class="hljs-bullet">3.</span> DAOæ¥å£<span class="hljs-bullet">4.</span> Mapperæ–‡ä»¶é…ç½®</code></pre></div></li><li><p>å®ä½“ <code>com.yusael.entity.User</code></p></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> password;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;        <span class="hljs-keyword">this</span>.password = password;    &#125;&#125;</code></pre></div><ul><li>è¡¨ <code>t_user</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs mysql">create table t_users values (id int(11) primary key auto_increment,name varchar(12),password varchar(12));</code></pre></div><ul><li>DAOæ¥å£ <code>com.yusael.dao.UserDAO</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDAO</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(User user)</span></span>;&#125;</code></pre></div><ul><li>Mapperæ–‡ä»¶é…ç½® <code>resources/applicationContext.xml</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!--è¿æ¥æ± --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/yus?useSSL=false&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1234&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>        <span class="hljs-comment">&lt;!--åˆ›å»ºSqlSessionFactory SqlSessionFactoryBean--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.yusael.entity&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>classpath:com.yusael.dao/*Mapper.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>        <span class="hljs-comment">&lt;!--åˆ›å»ºDAOå¯¹è±¡ MapperScannerConfigure--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scanner&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.yusael.dao&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><ul><li><code>UserDAOMapper.xml</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>insert into t_users (name,password) values (#&#123;name&#125;,#&#123;password&#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><ul><li>æµ‹è¯•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç”¨äºæµ‹è¯•: Spring ä¸ Mybatis çš„æ•´åˆ</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;    ApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;/applicationContext.xml&quot;</span>);    UserDAO userDAO = (UserDAO) ctx.getBean(<span class="hljs-string">&quot;userDAO&quot;</span>);    User user = <span class="hljs-keyword">new</span> User();    user.setName(<span class="hljs-string">&quot;xiaojr&quot;</span>);    user.setPassword(<span class="hljs-string">&quot;999999&quot;</span>);    userDAO.save(user);&#125;</code></pre></div><h3 id="2-6-Springä¸Mybatisæ•´åˆç»†èŠ‚"><a href="#2-6-Springä¸Mybatisæ•´åˆç»†èŠ‚" class="headerlink" title="2.6 Springä¸Mybatisæ•´åˆç»†èŠ‚"></a>2.6 Springä¸Mybatisæ•´åˆç»†èŠ‚</h3><p>é—®é¢˜ï¼šSpring ä¸ Myabatis æ•´åˆåï¼Œä¸ºä»€ä¹ˆ DAO ä¸æäº¤äº‹åŠ¡ï¼Œä½†æ˜¯æ•°æ®èƒ½å¤Ÿæ’å…¥æ•°æ®åº“ä¸­ï¼Ÿ</p><ul><li>Mybatis æä¾›çš„è¿æ¥æ± å¯¹è±¡ â€”&gt; åˆ›å»º<code> Connection Connection.setAutoCommit(false)</code> æ‰‹å·¥çš„æ§åˆ¶äº†äº‹åŠ¡ï¼Œæ“ä½œå®Œæˆåï¼Œéœ€è¦æ‰‹å·¥æäº¤</li><li>Druidï¼ˆC3P0ã€DBCPï¼‰ä½œä¸ºè¿æ¥æ±  â€”&gt; åˆ›å»º<code>Connection Connection.setAutoCommit(true)</code>é»˜è®¤å€¼ä¸º trueï¼Œä¿æŒè‡ªåŠ¨æ§åˆ¶äº‹åŠ¡ï¼Œä¸€æ¡ sql è‡ªåŠ¨æäº¤</li></ul><p>ç­”æ¡ˆï¼šå› ä¸º Spring ä¸ Mybatis æ•´åˆæ—¶ï¼Œå¼•å…¥äº†å¤–éƒ¨è¿æ¥æ± å¯¹è±¡ï¼Œä¿æŒè‡ªåŠ¨çš„äº‹åŠ¡æäº¤è¿™ä¸ªæœºåˆ¶<code>Connection.setAutoCommit(true)</code>ï¼Œä¸éœ€è¦æ‰‹å·¥è¿›è¡Œäº‹åŠ¡çš„æ“ä½œï¼Œä¹Ÿèƒ½è¿›è¡Œäº‹åŠ¡çš„æäº¤</p><p>æ³¨æ„ï¼šå®æˆ˜ä¸­ï¼Œè¿˜æ˜¯ä¼šæ‰‹å·¥æ§åˆ¶äº‹åŠ¡ï¼ˆå¤šæ¡SQLä¸€èµ·æˆåŠŸï¼Œä¸€èµ·å¤±è´¥ï¼‰ï¼Œåç»­Springé€šè¿‡äº‹åŠ¡æ§åˆ¶è§£å†³è¿™ä¸ªé—®é¢˜</p><h2 id="3-Springçš„äº‹åŠ¡å¤„ç†"><a href="#3-Springçš„äº‹åŠ¡å¤„ç†" class="headerlink" title="3. Springçš„äº‹åŠ¡å¤„ç†"></a>3. Springçš„äº‹åŠ¡å¤„ç†</h2><h3 id="3-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#3-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="3.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>3.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h3><blockquote><p>ä¿è¯ä¸šåŠ¡æ“ä½œå®Œæ•´æ€§çš„ä¸€ç§æ•°æ®åº“æœºåˆ¶</p><p>äº‹åŠ¡çš„4ç‰¹ç‚¹ï¼š <strong>A C I D</strong></p><ul><li>A åŸå­æ€§</li><li>C ä¸€è‡´æ€§</li><li>I éš”ç¦»æ€§</li><li>D æŒä¹…æ€§</li></ul></blockquote><h3 id="3-2-å¦‚ä½•æ§åˆ¶äº‹åŠ¡"><a href="#3-2-å¦‚ä½•æ§åˆ¶äº‹åŠ¡" class="headerlink" title="3.2 å¦‚ä½•æ§åˆ¶äº‹åŠ¡"></a>3.2 å¦‚ä½•æ§åˆ¶äº‹åŠ¡</h3><div class="hljs code-wrapper"><pre><code class="hljs markdown">JDBC:<span class="hljs-code">    Connection.setAutoCommit(false);</span><span class="hljs-code">    Connection.commit();</span><span class="hljs-code">    Connection.rollback();</span><span class="hljs-code">Mybatisï¼š</span><span class="hljs-code">    Mybatisè‡ªåŠ¨å¼€å¯äº‹åŠ¡</span><span class="hljs-code">    </span><span class="hljs-code">    sqlSession(Connection).commit();</span><span class="hljs-code">    sqlSession(Connection).rollback();</span><span class="hljs-code"></span><span class="hljs-code">ç»“è®ºï¼šæ§åˆ¶äº‹åŠ¡çš„åº•å±‚ éƒ½æ˜¯Connectionå¯¹è±¡å®Œæˆçš„</span></code></pre></div><h3 id="3-3-Springæ§åˆ¶äº‹åŠ¡çš„å¼€å‘"><a href="#3-3-Springæ§åˆ¶äº‹åŠ¡çš„å¼€å‘" class="headerlink" title="3.3 Springæ§åˆ¶äº‹åŠ¡çš„å¼€å‘"></a>3.3 Springæ§åˆ¶äº‹åŠ¡çš„å¼€å‘</h3><blockquote><p>Springæ˜¯é€šè¿‡AOPçš„æ–¹å¼è¿›è¡Œäº‹åŠ¡å¼€å‘</p></blockquote><h4 id="3-3-1-åŸå§‹å¯¹è±¡"><a href="#3-3-1-åŸå§‹å¯¹è±¡" class="headerlink" title="3.3.1 åŸå§‹å¯¹è±¡"></a>3.3.1 åŸå§‹å¯¹è±¡</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XXXUserServiceImpl</span></span>&#123;   <span class="hljs-keyword">private</span> xxxDAO xxxDAO   set get   <span class="hljs-number">1.</span> åŸå§‹å¯¹è±¡ ---&gt; åŸå§‹æ–¹æ³• ---&gt; æ ¸å¿ƒåŠŸèƒ½ (ä¸šåŠ¡å¤„ç†+DAOè°ƒç”¨)   <span class="hljs-number">2.</span> DAOä½œä¸ºServiceçš„æˆå‘˜å˜é‡ï¼Œä¾èµ–æ³¨å…¥çš„æ–¹å¼è¿›è¡Œèµ‹å€¼&#125;</code></pre></div><h4 id="3-3-2-é¢å¤–åŠŸèƒ½"><a href="#3-3-2-é¢å¤–åŠŸèƒ½" class="headerlink" title="3.3.2 é¢å¤–åŠŸèƒ½"></a>3.3.2 é¢å¤–åŠŸèƒ½</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ä»¥ä¸‹ä»£ç Springå·²ç»å°è£…å¥½ï¼Œé€šè¿‡</span><span class="hljs-comment">//org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="hljs-comment">//éœ€è¦æ³¨å…¥è¿æ¥æ± DataSource </span><span class="hljs-number">1.</span> <span class="hljs-comment">//å®ç°MethodInterceptor</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span></span>&#123;      <span class="hljs-keyword">try</span>&#123;        Connection.setAutoCommit(<span class="hljs-keyword">false</span>);        Object ret = invocation.proceed();        Connection.commit();      &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;        Connection.rollback();      &#125;        <span class="hljs-keyword">return</span> ret;   &#125;<span class="hljs-number">2.</span> <span class="hljs-comment">//ä½¿ç”¨æ³¨è§£@Aspect</span>   <span class="hljs-comment">//@Around </span></code></pre></div><h4 id="3-3-3-åˆ‡å…¥ç‚¹"><a href="#3-3-3-åˆ‡å…¥ç‚¹" class="headerlink" title="3.3.3 åˆ‡å…¥ç‚¹"></a>3.3.3 åˆ‡å…¥ç‚¹</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span> äº‹åŠ¡çš„é¢å¤–åŠŸèƒ½åŠ å…¥ç»™é‚£äº›ä¸šåŠ¡æ–¹æ³•ã€‚<span class="hljs-number">1.</span> ç±»ä¸Šï¼šç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½ä¼šåŠ å…¥äº‹åŠ¡<span class="hljs-number">2.</span> æ–¹æ³•ä¸Šï¼šè¿™ä¸ªæ–¹æ³•ä¼šåŠ å…¥äº‹åŠ¡</code></pre></div><h4 id="3-3-4-ç»„è£…åˆ‡é¢"><a href="#3-3-4-ç»„è£…åˆ‡é¢" class="headerlink" title="3.3.4 ç»„è£…åˆ‡é¢"></a>3.3.4 ç»„è£…åˆ‡é¢</h4><div class="hljs code-wrapper"><pre><code class="hljs xml">1. åˆ‡å…¥ç‚¹2. é¢å¤–åŠŸèƒ½<span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></code></pre></div><h3 id="3-4-Springæ§åˆ¶äº‹åŠ¡çš„ç¼–ç "><a href="#3-4-Springæ§åˆ¶äº‹åŠ¡çš„ç¼–ç " class="headerlink" title="3.4 Springæ§åˆ¶äº‹åŠ¡çš„ç¼–ç "></a>3.4 Springæ§åˆ¶äº‹åŠ¡çš„ç¼–ç </h3><ul><li><p>æ­å»ºå¼€å‘ç¯å¢ƒ (jar)</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div></li><li><p>ç¼–ç </p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.service.UserServiceImpl&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--DataSourceTransactionManager--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>@Transactionalpublic class UserServiceImpl implements UserService &#123;    private UserDAO userDAO;<span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></code></pre></div></li><li><p>ç»†èŠ‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--tx:annotation-drivenè¦ä»¥txç»“å°¾--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>è¿›è¡ŒåŠ¨æ€ä»£ç†åº•å±‚å®ç°çš„åˆ‡æ¢   proxy-target-class    é»˜è®¤ false JDK        true  Cglib</code></pre></div></li></ul><h2 id="4-Springä¸­çš„äº‹åŠ¡å±æ€§-Transaction-Attribute"><a href="#4-Springä¸­çš„äº‹åŠ¡å±æ€§-Transaction-Attribute" class="headerlink" title="4.  Springä¸­çš„äº‹åŠ¡å±æ€§(Transaction Attribute)"></a>4.  Springä¸­çš„äº‹åŠ¡å±æ€§(Transaction Attribute)</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§"><a href="#4-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§"></a>4.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§</h3><blockquote><p>å±æ€§ï¼šæè¿°ç‰©ä½“ç‰¹å¾çš„ä¸€ç³»åˆ—å€¼<br>æ€§åˆ« èº«é«˜ ä½“é‡ â€¦<br>äº‹åŠ¡å±æ€§ï¼šæè¿°äº‹åŠ¡ç‰¹å¾çš„ä¸€ç³»åˆ—å€¼ </p><ul><li>éš”ç¦»å±æ€§</li><li>ä¼ æ’­å±æ€§</li><li>åªè¯»å±æ€§</li><li>è¶…æ—¶å±æ€§</li><li>å¼‚å¸¸å±æ€§ </li></ul></blockquote><h3 id="4-2-å¦‚ä½•æ·»åŠ äº‹åŠ¡å±æ€§"><a href="#4-2-å¦‚ä½•æ·»åŠ äº‹åŠ¡å±æ€§" class="headerlink" title="4.2 å¦‚ä½•æ·»åŠ äº‹åŠ¡å±æ€§"></a>4.2 å¦‚ä½•æ·»åŠ äº‹åŠ¡å±æ€§</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span>(isloation=,propagation=,readOnly=,timeout=,rollbackFor=,noRollbackFor=,)</code></pre></div><h3 id="4-3-äº‹åŠ¡å±æ€§è¯¦è§£"><a href="#4-3-äº‹åŠ¡å±æ€§è¯¦è§£" class="headerlink" title="4.3 äº‹åŠ¡å±æ€§è¯¦è§£"></a>4.3 äº‹åŠ¡å±æ€§è¯¦è§£</h3><h4 id="4-3-1-éš”ç¦»å±æ€§-ISOLATION"><a href="#4-3-1-éš”ç¦»å±æ€§-ISOLATION" class="headerlink" title="4.3.1 éš”ç¦»å±æ€§ (ISOLATION)"></a>4.3.1 éš”ç¦»å±æ€§ (ISOLATION)</h4><ul><li><p>éš”ç¦»å±æ€§çš„æ¦‚å¿µ</p><div class="hljs code-wrapper"><pre><code class="hljs markdown">æ¦‚å¿µï¼šä»–æè¿°äº†äº‹åŠ¡è§£å†³å¹¶å‘é—®é¢˜çš„ç‰¹å¾<span class="hljs-bullet">1.</span> ä»€ä¹ˆæ˜¯å¹¶å‘<span class="hljs-code">       å¤šä¸ªäº‹åŠ¡(ç”¨æˆ·)åœ¨åŒä¸€æ—¶é—´ï¼Œè®¿é—®æ“ä½œäº†ç›¸åŒçš„æ•°æ®</span><span class="hljs-code">       </span><span class="hljs-code">       åŒä¸€æ—¶é—´ï¼š0.000å‡ ç§’ å¾®å°å‰ å¾®å°å</span><span class="hljs-code">2. å¹¶å‘ä¼šäº§ç”Ÿé‚£äº›é—®é¢˜</span><span class="hljs-code">       1. è„è¯»</span><span class="hljs-code">       2. ä¸å¯é‡å¤è¯»</span><span class="hljs-code">       3. å¹»å½±è¯»</span><span class="hljs-code">3. å¹¶å‘é—®é¢˜å¦‚ä½•è§£å†³</span><span class="hljs-code">       é€šè¿‡éš”ç¦»å±æ€§è§£å†³ï¼Œéš”ç¦»å±æ€§ä¸­è®¾ç½®ä¸åŒçš„å€¼ï¼Œè§£å†³å¹¶å‘å¤„ç†è¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚</span></code></pre></div></li><li><p>äº‹åŠ¡å¹¶å‘äº§ç”Ÿçš„é—®é¢˜</p><ul><li><p>è„è¯»</p><blockquote><p>ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡ä¸­æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚ä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜è§£å†³æ–¹æ¡ˆ  @Transactional(isolation=Isolation.READ_COMMITTED)</p></blockquote></li><li><p>ä¸å¯é‡å¤è¯»</p><blockquote><p>ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®ï¼Œä½†æ˜¯è¯»å–ç»“æœä¸ä¸€æ ·ã€‚ä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜æ³¨æ„ï¼š1 ä¸æ˜¯è„è¯» 2 ä¸€ä¸ªäº‹åŠ¡ä¸­è§£å†³æ–¹æ¡ˆ @Transactional(isolation=Isolation.REPEATABLE_READ)<br>æœ¬è´¨ï¼š ä¸€æŠŠè¡Œé”</p></blockquote></li><li><p>å¹»å½±è¯»</p><blockquote><p>ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡å¯¹æ•´è¡¨è¿›è¡ŒæŸ¥è¯¢ç»Ÿè®¡ï¼Œä½†æ˜¯ç»“æœä¸ä¸€æ ·ï¼Œä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜è§£å†³æ–¹æ¡ˆ @Transactional(isolation=Isolation.SERIALIZABLE)<br>æœ¬è´¨ï¼šè¡¨é” </p></blockquote></li><li><p>æ€»ç»“</p><blockquote><p>ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡å¯¹æ•´è¡¨è¿›è¡ŒæŸ¥è¯¢ç»Ÿè®¡ï¼Œä½†æ˜¯ç»“æœä¸ä¸€æ ·ï¼Œä¼šåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜è§£å†³æ–¹æ¡ˆ @Transactional(isolation=Isolation.SERIALIZABLE)<br>æœ¬è´¨ï¼šè¡¨é” </p></blockquote></li></ul></li><li><p>æ•°æ®åº“å¯¹äºéš”ç¦»å±æ€§çš„æ”¯æŒ</p><table><thead><tr><th>éš”ç¦»å±æ€§çš„å€¼</th><th>MySQL</th><th>Oracle</th></tr></thead><tbody><tr><td>ISOLATION_READ_COMMITTED</td><td>âœ…</td><td>âœ…</td></tr><tr><td>IOSLATION_REPEATABLE_READ</td><td>âœ…</td><td>â</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>âœ…</td><td>âœ…</td></tr></tbody></table><p>Oracleä¸æ”¯æŒREPEATABLE_READå€¼ å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»</p><p>é‡‡ç”¨çš„æ˜¯å¤šç‰ˆæœ¬æ¯”å¯¹çš„æ–¹å¼ è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜</p></li><li><p>é»˜è®¤éš”ç¦»å±æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs markdown">ISOLATION<span class="hljs-emphasis">_DEFAULTï¼šä¼šè°ƒç”¨ä¸åŒæ•°æ®åº“æ‰€è®¾ç½®çš„é»˜è®¤éš”ç¦»å±æ€§</span><span class="hljs-emphasis"></span><span class="hljs-emphasis">MySQL : REPEATABLE_</span>READ Oracle: READ<span class="hljs-emphasis">_COMMITTED  </span></code></pre></div><ul><li><p>æŸ¥çœ‹æ•°æ®åº“é»˜è®¤éš”ç¦»å±æ€§</p><ul><li><p>MySQL</p><div class="hljs code-wrapper"><pre><code class="hljs mysql">select @@tx_isolation;</code></pre></div></li><li><p>Oracle</p><div class="hljs code-wrapper"><pre><code class="hljs mysql">SELECT s.sid, s.serial#,   CASE BITAND(t.flag, POWER(2, 28))      WHEN 0 THEN &#39;READ COMMITTED&#39;      ELSE &#39;SERIALIZABLE&#39;   END AS isolation_levelFROM v$transaction t JOIN v$session s ON t.addr &#x3D; s.taddrAND s.sid &#x3D; sys_context(&#39;USERENV&#39;, &#39;SID&#39;);</code></pre></div></li></ul></li></ul></li><li><p>éš”ç¦»å±æ€§åœ¨å®æˆ˜ä¸­çš„å»ºè®®</p><ul><li>æ¨èä½¿ç”¨ Spring é»˜è®¤æŒ‡å®šçš„ <code>ISOLATION_DEFAULT</code></li><li>æœªæ¥çš„å®æˆ˜ä¸­ï¼Œé‡åˆ°å¹¶å‘è®¿é—®çš„æƒ…å†µï¼Œå¾ˆå°‘è§</li><li>å¦‚æœçœŸçš„é‡åˆ°å¹¶å‘é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆï¼š<strong>ä¹è§‚é”</strong><br>Hibernate(JPA)ï¼šversion<br>MyBatisï¼šé€šè¿‡æ‹¦æˆªå™¨è‡ªå®šä¹‰å¼€å‘</li></ul></li></ul><h4 id="4-3-2-ä¼ æ’­å±æ€§-PROPAGATION"><a href="#4-3-2-ä¼ æ’­å±æ€§-PROPAGATION" class="headerlink" title="4.3.2 ä¼ æ’­å±æ€§(PROPAGATION)"></a>4.3.2 ä¼ æ’­å±æ€§(PROPAGATION)</h4><p><strong>ä¼ æ’­å±æ€§çš„æ¦‚å¿µ</strong></p><blockquote><p>æ¦‚å¿µï¼šä»–æè¿°äº†äº‹åŠ¡è§£å†³åµŒå¥—é—®é¢˜çš„ç‰¹å¾</p><p>ä»€ä¹ˆå«åšäº‹åŠ¡çš„åµŒå¥—ï¼šä»–æŒ‡çš„æ˜¯ä¸€ä¸ªå¤§çš„äº‹åŠ¡ä¸­ï¼ŒåŒ…å«äº†è‹¥å¹²ä¸ªå°çš„äº‹åŠ¡</p><p>é—®é¢˜ï¼šå¤§äº‹åŠ¡ä¸­èå…¥äº†å¾ˆå¤šå°çš„äº‹åŠ¡ï¼Œä»–ä»¬å½¼æ­¤å½±å“ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´å¤–éƒ¨å¤§çš„äº‹åŠ¡ï¼Œä¸§å¤±äº†äº‹åŠ¡çš„åŸå­æ€§</p></blockquote><p><strong>ä¼ æ’­å±æ€§çš„å€¼åŠå…¶ç”¨æ³•</strong></p><table><thead><tr><th>ä¼ æ’­å±æ€§çš„å€¼</th><th>å¤–éƒ¨ä¸å­˜åœ¨äº‹åŠ¡</th><th>å¤–éƒ¨å­˜åœ¨äº‹åŠ¡</th><th>ç”¨æ³•</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>REQUIRED</td><td>å¼€å¯æ–°çš„äº‹åŠ¡</td><td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td><td>@Transactional(propagation = Propagation.REQUIRED)</td><td>å¢åˆ æ”¹æ–¹æ³•</td></tr><tr><td>SUPPORTS</td><td>ä¸å¼€å¯äº‹åŠ¡</td><td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td><td>@Transactional(propagation = Propagation.SUPPORTS)</td><td>æŸ¥è¯¢æ–¹æ³•</td></tr><tr><td>REQUIRES_NEW</td><td>å¼€å¯æ–°çš„äº‹åŠ¡</td><td>æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡ï¼Œåˆ›å»ºæ–°çš„äº‹åŠ¡</td><td>@Transactional(propagation = Propagation.REQUIRES_NEW)</td><td>æ—¥å¿—è®°å½•æ–¹æ³•ä¸­</td></tr><tr><td>NOT_SUPPORTED</td><td>ä¸å¼€å¯äº‹åŠ¡</td><td>æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡</td><td>@Transactional(propagation = Propagation.NOT_SUPPORTED)</td><td>åŠå…¶ä¸å¸¸ç”¨</td></tr><tr><td>NEVER</td><td>ä¸å¼€å¯äº‹åŠ¡</td><td>æŠ›å‡ºå¼‚å¸¸</td><td>@Transactional(propagation = Propagation.NEVER)</td><td>åŠå…¶ä¸å¸¸ç”¨</td></tr><tr><td>MANDATORY</td><td>æŠ›å‡ºå¼‚å¸¸</td><td>èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td><td>@Transactional(propagation = Propagation.MANDATORY)</td><td>åŠå…¶ä¸å¸¸ç”¨</td></tr></tbody></table><ul><li><p>é»˜è®¤çš„ä¼ æ’­å±æ€§</p><blockquote><p>REQUIREDæ˜¯ä¼ æ’­å±æ€§çš„é»˜è®¤å€¼</p></blockquote></li><li><p>æ¨èä¼ æ’­å±æ€§çš„ä½¿ç”¨æ–¹å¼</p><blockquote><p>å¢åˆ æ”¹ æ–¹æ³•ï¼šç›´æ¥ä½¿ç”¨é»˜è®¤å€¼REQUIRED æŸ¥è¯¢   </p><p>æŸ¥è¯¢ æ–¹æ³•ï¼šæ˜¾ç¤ºæŒ‡å®šä¼ æ’­å±æ€§çš„å€¼ä¸ºSUPPORTS  </p></blockquote></li></ul><h4 id="4-3-3-åªè¯»å±æ€§-readOnly"><a href="#4-3-3-åªè¯»å±æ€§-readOnly" class="headerlink" title="4.3.3 åªè¯»å±æ€§(readOnly)"></a>4.3.3 åªè¯»å±æ€§(readOnly)</h4><blockquote><p>é’ˆå¯¹äºåªè¿›è¡ŒæŸ¥è¯¢æ“ä½œçš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¯ä»¥åŠ å…¥åªè¯»å±æ€§ï¼Œæä¾›è¿è¡Œæ•ˆç‡<br>é»˜è®¤å€¼ï¼šfalse </p><p>@Transactional(readOnly = true)</p></blockquote><h4 id="4-3-4-è¶…æ—¶å±æ€§-timeout"><a href="#4-3-4-è¶…æ—¶å±æ€§-timeout" class="headerlink" title="4.3.4 è¶…æ—¶å±æ€§(timeout)"></a>4.3.4 è¶…æ—¶å±æ€§(timeout)</h4><p>æŒ‡å®šäº†äº‹åŠ¡ç­‰å¾…çš„æœ€é•¿æ—¶é—´</p><ul><li>ä¸ºä»€ä¹ˆäº‹åŠ¡ä¼šè¿›è¡Œç­‰å¾…ï¼Ÿ<br>å½“å‰äº‹åŠ¡è®¿é—®æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½è®¿é—®çš„æ•°æ®è¢«åˆ«çš„äº‹åŠ¡è¿›è¡ŒåŠ é”çš„å¤„ç†ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ¬äº‹åŠ¡å°±å¿…é¡»è¿›è¡Œç­‰å¾…ã€‚</li><li>ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯ ç§’</li><li>å¦‚ä½•ä½¿ç”¨ï¼š@Transactional(timeout = 2)</li><li>è¶…æ—¶å±æ€§çš„é»˜è®¤å€¼ï¼š-1<br>-1 è¡¨ç¤ºè¶…æ—¶å±æ€§ç”±å¯¹åº”çš„æ•°æ®åº“æ¥æŒ‡å®šï¼ˆä¸€èˆ¬ä¸ä¼šä¸»åŠ¨æŒ‡å®šï¼Œ-1 å³å¯ï¼‰</li></ul><h4 id="4-3-5-å¼‚å¸¸å±æ€§"><a href="#4-3-5-å¼‚å¸¸å±æ€§" class="headerlink" title="4.3.5 å¼‚å¸¸å±æ€§"></a>4.3.5 å¼‚å¸¸å±æ€§</h4><p>Spring äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼š</p><ul><li>é»˜è®¤å¯¹äº <code>RuntimeException</code> åŠå…¶å­ç±»ï¼Œé‡‡ç”¨ <strong>å›æ»š</strong> çš„ç­–ç•¥</li><li>é»˜è®¤å¯¹äº <code>Exception</code> åŠå…¶å­ç±»ï¼Œé‡‡ç”¨ <strong>æäº¤</strong> çš„ç­–ç•¥</li></ul><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(rollbackFor = java.lang.Exception.class, xxx, xxx)</span><span class="hljs-meta">@Transactional(noRollbackFor = java.lang.RuntimeException, xxx, xxx)</span></code></pre></div><h3 id="4-4-äº‹åŠ¡å±æ€§å¸¸è§é…ç½®æ€»ç»“"><a href="#4-4-äº‹åŠ¡å±æ€§å¸¸è§é…ç½®æ€»ç»“" class="headerlink" title="4.4 äº‹åŠ¡å±æ€§å¸¸è§é…ç½®æ€»ç»“"></a>4.4 äº‹åŠ¡å±æ€§å¸¸è§é…ç½®æ€»ç»“</h3><ul><li>éš”ç¦»å±æ€§ é»˜è®¤å€¼</li><li>ä¼ æ’­å±æ€§ Requiredï¼ˆé»˜è®¤å€¼ï¼‰å¢åˆ æ”¹ã€Supports æŸ¥è¯¢æ“ä½œ</li><li>åªè¯»å±æ€§ readOnly=false å¢åˆ æ”¹ï¼Œtrue æŸ¥è¯¢æ“ä½œ</li><li>è¶…æ—¶å±æ€§ é»˜è®¤å€¼ -1</li><li>å¼‚å¸¸å±æ€§ é»˜è®¤å€¼</li></ul><p>å¢åˆ æ”¹æ“ä½œï¼š<code>@Transactional</code><br>æŸ¥è¯¢æ“ä½œï¼š<code>@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)</code></p><h3 id="4-5-åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®æ–¹å¼-äº‹åŠ¡å¼€å‘çš„ç¬¬äºŒç§å½¢å¼"><a href="#4-5-åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®æ–¹å¼-äº‹åŠ¡å¼€å‘çš„ç¬¬äºŒç§å½¢å¼" class="headerlink" title="4.5 åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®æ–¹å¼(äº‹åŠ¡å¼€å‘çš„ç¬¬äºŒç§å½¢å¼)"></a>4.5 åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®æ–¹å¼(äº‹åŠ¡å¼€å‘çš„ç¬¬äºŒç§å½¢å¼)</h3><p>åŸºäºæ³¨è§£ <code>@Transaction</code> çš„äº‹åŠ¡é…ç½®å›é¡¾ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.yusael.service.UserServiceImpl&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--DataSourceTransactionManager--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>@Transactionalpublic class UserServiceImpl implements UserService &#123;    private UserDAO userDAO;<span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></code></pre></div><p>åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--DataSourceTransactionManager--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-comment">&lt;!--ä¸åŒç‚¹--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;register&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;DEFAULT&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span>          <span class="hljs-comment">&lt;!--ç­‰æ•ˆäº </span><span class="hljs-comment">          @Transactional(isolation=,propagation=,)</span><span class="hljs-comment">          public void register()&#123;</span><span class="hljs-comment">        </span><span class="hljs-comment">          &#125;--&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.service.UserServiceImpl.register(..))&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pc&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span></code></pre></div><p>åŸºäºæ ‡ç­¾çš„äº‹åŠ¡é…ç½®åœ¨ <strong>å®æˆ˜</strong> ä¸­çš„åº”ç”¨æ–¹å¼ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span>       ç¼–ç¨‹æ—¶å€™, serviceä¸­è´Ÿè´£è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„æ–¹æ³• éƒ½ä»¥ modify å¼€å¤´       æŸ¥è¯¢æ“ä½œ å‘½åæ— æ‰€è°“      txçš„é¡ºåºè¡¨ç¤ºåŒ¹é…çš„é¡ºåº        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;register&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;modify*&quot;</span>/&gt;</span>é™¤äº†modify*ï¼Œ*è¡¨ç¤ºå‰©ä¸‹çš„éƒ½æ»¡è¶³...        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;SUPPORTS&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.yusael.service..*.*(..))&quot;</span>/&gt;</span>   åº”ç”¨çš„è¿‡ç¨‹ä¸­, å°† service éƒ½æ”¾åˆ° service åŒ…ä¸‹    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pc&quot;</span>/&gt;</span>&lt;/aop:config</code></pre></div><h2 id="5-Springå¼€å‘è¿‡ç¨‹ä¸­å¤šé…ç½®æ–‡ä»¶çš„å¤„ç†"><a href="#5-Springå¼€å‘è¿‡ç¨‹ä¸­å¤šé…ç½®æ–‡ä»¶çš„å¤„ç†" class="headerlink" title="5. Springå¼€å‘è¿‡ç¨‹ä¸­å¤šé…ç½®æ–‡ä»¶çš„å¤„ç†"></a>5. Springå¼€å‘è¿‡ç¨‹ä¸­å¤šé…ç½®æ–‡ä»¶çš„å¤„ç†</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown">Springä¼šæ ¹æ®éœ€è¦ï¼ŒæŠŠé…ç½®ä¿¡æ¯åˆ†é—¨åˆ«ç±»çš„æ”¾ç½®åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œä¾¿äºåç»­çš„ç®¡ç†åŠç»´æŠ¤ã€‚DAO  ------  applicationContext-dao.xml Service ---  applicationContext-service.xmlAction  ---  applicationContext-action.xmlæ³¨æ„ï¼šè™½ç„¶æä¾›äº†å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯åç»­åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜è¦è¿›è¡Œæ•´åˆ</code></pre></div><p>é€šé…ç¬¦æ–¹å¼</p><div class="hljs code-wrapper"><pre><code class="hljs xml">1. éwebç¯å¢ƒ   ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;/applicationContext-*.xml&quot;);2. webç¯å¢ƒ   <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:applicationContext-*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span></code></pre></div><p>&lt;importæ ‡ç­¾</p><div class="hljs code-wrapper"><pre><code class="hljs xml">applicationContext.xml ç›®çš„ æ•´åˆå…¶ä»–é…ç½®å†…å®¹    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;applicationContext-dao.xml &quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;applicationContext-service.xml &quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;applicationContext-action.xml &quot;</span> /&gt;</span>    1. éwebç¯å¢ƒ   ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;/applicationContext.xml&quot;);2. webç¯å¢ƒ   <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span></code></pre></div><h1 id="ç¬¬äº”ç« ã€Springæ³¨è§£ç¼–ç¨‹"><a href="#ç¬¬äº”ç« ã€Springæ³¨è§£ç¼–ç¨‹" class="headerlink" title="ç¬¬äº”ç« ã€Springæ³¨è§£ç¼–ç¨‹"></a>ç¬¬äº”ç« ã€Springæ³¨è§£ç¼–ç¨‹</h1><h2 id="1-æ³¨è§£åŸºç¡€æ¦‚å¿µ"><a href="#1-æ³¨è§£åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1. æ³¨è§£åŸºç¡€æ¦‚å¿µ"></a>1. æ³¨è§£åŸºç¡€æ¦‚å¿µ</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ³¨è§£ç¼–ç¨‹"><a href="#1-1-ä»€ä¹ˆæ˜¯æ³¨è§£ç¼–ç¨‹" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æ³¨è§£ç¼–ç¨‹"></a>1.1 ä»€ä¹ˆæ˜¯æ³¨è§£ç¼–ç¨‹</h3><ul><li>åœ¨ ç±» æˆ–è€… æ–¹æ³• ä¸ŠåŠ å…¥ç‰¹å®šçš„æ³¨è§£ï¼ˆ<code>@xxx</code>ï¼‰ï¼Œå®Œæˆç‰¹å®šåŠŸèƒ½çš„å¼€å‘</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XXX</span></span>&#123;&#125;</code></pre></div><h3 id="1-2-ä¸ºä»€ä¹ˆè¦è®²è§£æ³¨è§£ç¼–ç¨‹"><a href="#1-2-ä¸ºä»€ä¹ˆè¦è®²è§£æ³¨è§£ç¼–ç¨‹" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆè¦è®²è§£æ³¨è§£ç¼–ç¨‹"></a>1.2 ä¸ºä»€ä¹ˆè¦è®²è§£æ³¨è§£ç¼–ç¨‹</h3><ul><li>æ³¨è§£å¼€å‘æ–¹ä¾¿ï¼Œä»£ç ç®€å•ï¼Œå¼€å‘é€Ÿåº¦å¤§å¤§æé«˜</li><li>æ³¨è§£å¼€å‘æ˜¯ Spring å¼€å‘æ½®æµ<br>Spring 2.x å¼•å…¥æ³¨è§£ï¼ŒSpring 3.x å®Œå–„æ³¨è§£ï¼ŒSpringBoot æ™®åŠã€æ¨å¹¿æ³¨è§£ç¼–ç¨‹</li></ul><h3 id="1-3-æ³¨è§£çš„ä½œç”¨"><a href="#1-3-æ³¨è§£çš„ä½œç”¨" class="headerlink" title="1.3 æ³¨è§£çš„ä½œç”¨"></a>1.3 æ³¨è§£çš„ä½œç”¨</h3><ul><li><p>æ›¿æ¢XMLè¿™ç§é…ç½®å½¢å¼ï¼Œç®€åŒ–é…ç½®</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200527164703807.png" alt="image-20200527164703807"></p></li><li><p>æ›¿æ¢æ¥å£ï¼Œå®ç°è°ƒç”¨åŒæ–¹çš„å¥‘çº¦æ€§ </p><blockquote><p>é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œåœ¨åŠŸèƒ½è°ƒç”¨è€…å’ŒåŠŸèƒ½æä¾›è€…ä¹‹é—´è¾¾æˆçº¦å®šï¼Œè¿›è€Œè¿›è¡ŒåŠŸèƒ½çš„è°ƒç”¨ã€‚å› ä¸ºæ³¨è§£åº”ç”¨æ›´ä¸ºæ–¹ä¾¿çµæ´»ï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„å¼€å‘ä¸­ï¼Œæ›´æ¨èé€šè¿‡æ³¨è§£çš„å½¢å¼ï¼Œå®Œæˆ</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200527171704953.png" alt="image-20200527171704953"></p></li></ul><h3 id="1-4-Springæ³¨è§£çš„å‘å±•å†ç¨‹"><a href="#1-4-Springæ³¨è§£çš„å‘å±•å†ç¨‹" class="headerlink" title="1.4 Springæ³¨è§£çš„å‘å±•å†ç¨‹"></a>1.4 Springæ³¨è§£çš„å‘å±•å†ç¨‹</h3><ul><li>Spring 2.xï¼š å¼€å§‹æ”¯æŒæ³¨è§£ç¼–ç¨‹ <code>@Component</code>ã€<code>@Service</code>ã€<code>@Scope</code>â€¦<br>ç›®çš„ï¼šæä¾›çš„è¿™äº›æ³¨è§£åªæ˜¯ä¸ºäº†æŸäº› XML çš„é…ç½®ï¼Œä½œä¸º XML å¼€å‘çš„æœ‰ç›Šè¡¥å……ã€‚</li><li>Spring 3.xï¼š <code>@Configuration</code>ã€<code>@Bean</code>â€¦<br>ç›®çš„ï¼šå½»åº•æ›¿æ¢ XMLï¼ŒåŸºäºçº¯æ³¨è§£</li><li>Spring 4.xï¼š <strong>SpringBoot</strong> æå€¡ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘</li></ul><h3 id="1-5-Springæ³¨è§£å¼€å‘çš„ä¸€ä¸ªé—®é¢˜"><a href="#1-5-Springæ³¨è§£å¼€å‘çš„ä¸€ä¸ªé—®é¢˜" class="headerlink" title="1.5 Springæ³¨è§£å¼€å‘çš„ä¸€ä¸ªé—®é¢˜"></a>1.5 Springæ³¨è§£å¼€å‘çš„ä¸€ä¸ªé—®é¢˜</h3><blockquote><p>SpringåŸºäºæ³¨è§£è¿›è¡Œé…ç½®åï¼Œè¿˜èƒ½å¦è§£è€¦åˆå‘¢ï¼Ÿ</p><p>åœ¨Springæ¡†æ¶åº”ç”¨æ³¨è§£æ—¶ï¼Œå¦‚æœå¯¹æ³¨è§£é…ç½®çš„å†…å®¹ä¸æ»¡æ„ï¼Œå¯ä»¥é€šè¿‡Springé…ç½®æ–‡ä»¶è¿›è¡Œè¦†ç›–çš„</p></blockquote><h2 id="2-Springçš„åŸºç¡€æ³¨è§£ï¼ˆSpring2-xï¼‰"><a href="#2-Springçš„åŸºç¡€æ³¨è§£ï¼ˆSpring2-xï¼‰" class="headerlink" title="2. Springçš„åŸºç¡€æ³¨è§£ï¼ˆSpring2.xï¼‰"></a>2. Springçš„åŸºç¡€æ³¨è§£ï¼ˆSpring2.xï¼‰</h2><blockquote><p>è¿™ä¸ªé˜¶æ®µçš„æ³¨è§£ï¼Œä»…ä»…æ˜¯ç®€åŒ–XMLçš„é…ç½®ï¼Œå¹¶ä¸èƒ½å®Œå…¨æ›¿ä»£XML</p></blockquote><h3 id="2-1-å¯¹è±¡åˆ›å»ºç›¸å…³æ³¨è§£"><a href="#2-1-å¯¹è±¡åˆ›å»ºç›¸å…³æ³¨è§£" class="headerlink" title="2.1 å¯¹è±¡åˆ›å»ºç›¸å…³æ³¨è§£"></a>2.1 å¯¹è±¡åˆ›å»ºç›¸å…³æ³¨è§£</h3><p><strong>æ­å»ºå¼€å‘ç¯å¢ƒ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.baizhiedu&quot;</span>/&gt;</span>ä½œç”¨ï¼šè®©Springæ¡†æ¶åœ¨è®¾ç½®åŒ…åŠå…¶å­åŒ…ä¸­æ‰«æå¯¹åº”çš„æ³¨è§£ï¼Œä½¿å…¶ç”Ÿæ•ˆã€‚</code></pre></div><p><strong>å¯¹è±¡åˆ›å»ºç›¸å…³æ³¨è§£</strong></p><h4 id="Componentæ³¨è§£"><a href="#Componentæ³¨è§£" class="headerlink" title="@Componentæ³¨è§£"></a><code>@Component</code>æ³¨è§£</h4><p>ä½œç”¨ï¼šæ›¿æ¢åŸæœ‰Springé…ç½®æ–‡ä»¶ä¸­çš„ <code>&lt;bean&gt;</code> æ ‡ç­¾</p><ul><li><code>id</code> å±æ€§ï¼šåœ¨ <code>@Component</code> ä¸­æä¾›äº†é»˜è®¤çš„è®¾ç½®æ–¹å¼ï¼šé¦–å•è¯é¦–å­—æ¯å°å†™ï¼ˆUserDAO â€“&gt; userDAOï¼‰</li><li><code>class</code> å±æ€§ï¼šé€šè¿‡åå°„è·å¾—çš„ <code>class</code> çš„å†…å®¹</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200528112232356.png" alt="image-20200528112232356"></p><p><code>@Component </code>ç»†èŠ‚</p><ul><li><p>å¦‚ä½•æ˜¾ç¤ºæŒ‡å®šå·¥å‚åˆ›å»ºå¯¹è±¡çš„idå€¼</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component(&quot;u&quot;)</span></code></pre></div></li><li><p>Springé…ç½®æ–‡ä»¶è¦†ç›–æ³¨è§£é…ç½®å†…å®¹</p><div class="hljs code-wrapper"><pre><code class="hljs xml">applicationContext.xml<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;u&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.bean.User&quot;</span>/&gt;</span>idå€¼ classçš„å€¼ è¦å’Œ æ³¨è§£ä¸­çš„è®¾ç½®ä¿æŒä¸€å€¼</code></pre></div></li><li><p>@Componentçš„è¡ç”Ÿæ³¨è§£</p><ul><li><code>@Repository</code>ã€<code>@Service</code>ã€<code>@Controller</code> éƒ½æ˜¯ <code>@Component</code> çš„ <strong>è¡ç”Ÿæ³¨è§£</strong></li><li>æœ¬è´¨ä¸Šè¿™äº›è¡ç”Ÿæ³¨è§£å°±æ˜¯ <code>@Component</code>ï¼Œé€šè¿‡æºç å¯ä»¥çœ‹è§ä»–ä»¬éƒ½ä½¿ç”¨äº†<code>@Component</code>ï¼Œå®ƒä»¬çš„å­˜åœ¨æ˜¯ä¸ºäº†ï¼š<strong>æ›´åŠ å‡†ç¡®çš„è¡¨è¾¾ä¸€ä¸ªç±»å‹çš„ä½œç”¨</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDAO</span> </span>&#123;&#125;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;&#125;<span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;&#125;</code></pre></div><p>æ³¨æ„ï¼šSpring æ•´åˆ Mybatis å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ä½¿ç”¨ <code>@Repository</code>ã€<code>@Component</code></p></li><li><p>```JAVA<br>@Repository  â€”&gt;  XXXDAO<br>  @Repository<br>  public class UserDAO{</p><p>  }<br>@Service<br>  @Service<br>  public class UserService{</p><p>  }<br>@Controller<br>  @Controller<br>  public class RegAction{</p><p>  }<br>æ³¨æ„ï¼šæœ¬è´¨ä¸Šè¿™äº›è¡ç”Ÿæ³¨è§£å°±æ˜¯@Component </p><div class="hljs code-wrapper"><pre><code> ä½œç”¨ &lt;bean   ç»†èŠ‚ @Service(&quot;s&quot;)</code></pre></div><p>ç›®çš„ï¼šæ›´åŠ å‡†ç¡®çš„è¡¨è¾¾ä¸€ä¸ªç±»å‹çš„ä½œç”¨</p><p>æ³¨æ„ï¼šSpringæ•´åˆMybatiså¼€å‘è¿‡ç¨‹ä¸­ ä¸ä½¿ç”¨@Repository @Component</p><div class="hljs code-wrapper"><pre><code class="hljs autohotkey">#### `@Scope`æ³¨è§£ä½œç”¨ï¼šæ§åˆ¶ç®€å•å¯¹è±¡åˆ›å»ºæ¬¡æ•°æ³¨æ„ï¼šä¸æ·»åŠ  `@Scope`ï¼ŒSpring æä¾›é»˜è®¤å€¼ `singleton````xml&lt;bean id=<span class="hljs-string">&quot;&quot;</span> class=<span class="hljs-string">&quot;&quot;</span> scope=<span class="hljs-string">&quot;singleton|prototype&quot;</span>/&gt;</code></pre></div></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºå•ä¾‹å¯¹è±¡</span><span class="hljs-meta">@Component</span><span class="hljs-meta">@Scope(&quot;singleton&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>&#123;&#125;<span class="hljs-comment">// åˆ›å»ºå¤šä¾‹å¯¹è±¡</span><span class="hljs-meta">@Component</span><span class="hljs-meta">@Scope(&quot;prototype&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>&#123;&#125;</code></pre></div><h4 id="Lazyæ³¨è§£"><a href="#Lazyæ³¨è§£" class="headerlink" title="@Lazyæ³¨è§£"></a><code>@Lazy</code>æ³¨è§£</h4><p>ä½œç”¨ï¼šå»¶è¿Ÿåˆ›å»ºå•å®ä¾‹å¯¹è±¡<br>æ³¨æ„ï¼šä¸€æ—¦ä½¿ç”¨ <code>@Lazy</code> æ³¨è§£åï¼ŒSpring ä¼šåœ¨ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæ‰åˆ›å»ºè¿™ä¸ªå¯¹è±¡</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">lazy</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span></span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@Lazy</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;Account.Account&quot;</span>);    &#125;&#125;</code></pre></div><h4 id="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç›¸å…³æ³¨è§£"><a href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç›¸å…³æ³¨è§£" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç›¸å…³æ³¨è§£"></a>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç›¸å…³æ³¨è§£</h4><p>åˆå§‹åŒ–ç›¸å…³æ–¹æ³•ï¼š <code>@PostConstruct</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml">InitializingBean<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></code></pre></div><p>é”€æ¯æ–¹æ³•ï¼š<code>@PreDestory</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml">DisposableBean<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">destory-method</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></code></pre></div><p>æ³¨æ„ï¼š</p><ul><li>ä¸Šè¿°çš„ä¸¤ä¸ªæ³¨è§£å¹¶ä¸æ˜¯ Spring æä¾›çš„ï¼Œç”± <strong>JSR(JavaEEè§„èŒƒ)520</strong> æä¾›</li><li>å†æ¬¡éªŒè¯ï¼Œé€šè¿‡æ³¨è§£å®ç°äº†æ¥å£çš„å¥‘çº¦æ€§</li></ul><h3 id="2-2-æ³¨å…¥ç›¸å…³æ³¨è§£"><a href="#2-2-æ³¨å…¥ç›¸å…³æ³¨è§£" class="headerlink" title="2.2 æ³¨å…¥ç›¸å…³æ³¨è§£"></a>2.2 æ³¨å…¥ç›¸å…³æ³¨è§£</h3><h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a><code>@Autowired</code></h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200601114751016.png" alt="image-20200601114751016"></p><p><code>@Autowired</code> æ³¨è§£ <strong>åŸºäºç±»å‹è¿›è¡Œæ³¨å…¥</strong> [æ¨è]ï¼š</p><ul><li>æ³¨å…¥å¯¹è±¡çš„ç±»å‹ï¼Œå¿…é¡»ä¸ç›®æ ‡æˆå‘˜å˜é‡ç±»å‹ç›¸åŒæˆ–è€…æ˜¯å…¶å­ç±»ï¼ˆå®ç°ç±»ï¼‰</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><span class="hljs-keyword">private</span> UserDAO userDAO;</code></pre></div><p><code>@Autowired</code>ã€<code>@Qualifier</code> æ³¨è§£è”åˆå®ç° <strong>åŸºäºåå­—è¿›è¡Œæ³¨å…¥</strong> [äº†è§£]</p><ul><li>æ³¨å…¥å¯¹è±¡çš„ id å€¼ï¼Œå¿…é¡»ä¸ <code>@Qualifier</code> æ³¨è§£ä¸­è®¾ç½®çš„åå­—ç›¸åŒ</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><span class="hljs-meta">@Qualifier(&quot;userDAOImpl&quot;)</span><span class="hljs-keyword">private</span> UserDAO userDAO;</code></pre></div><p><code>@Autowired</code> æ³¨è§£æ”¾ç½®ä½ç½®ï¼š</p><ul><li>æ”¾ç½®åœ¨å¯¹åº”æˆå‘˜å˜é‡çš„ set æ–¹æ³•ä¸Šï¼Œè°ƒç”¨ set æ–¹æ³•èµ‹å€¼ï¼ˆåœ¨ set é‡Œå†™çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼‰</li><li><strong>ç›´æ¥æ”¾ç½®åœ¨æˆå‘˜å˜é‡ä¸Š</strong>ï¼ŒSpring é€šè¿‡<strong>åå°„ç›´æ¥å¯¹æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼ [æ¨è]</strong></li></ul><p>JavaEE è§„èŒƒä¸­ç±»ä¼¼åŠŸèƒ½çš„æ³¨è§£ï¼š</p><ul><li>JSR250 æä¾›çš„ <code>@Resource(name=&quot;xxx&quot;)</code> <strong>åŸºäºåå­—è¿›è¡Œæ³¨å…¥</strong><br>ç­‰ä»·äº <code>@Autowired</code> ä¸ <code>@Qualifier</code> è”åˆå®ç°çš„æ•ˆæœ<br>æ³¨æ„ï¼š<code>@Resource</code> æ³¨è§£å¦‚æœåå­—æ²¡æœ‰é…å¯¹æˆåŠŸï¼Œä¼šç»§ç»­ <strong>æŒ‰ç…§ç±»å‹è¿›è¡Œæ³¨å…¥</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Resource(name=&quot;userDAOImpl&quot;)</span><span class="hljs-keyword">private</span> UserDAO userDAO;</code></pre></div><ul><li>JSR330 æä¾›çš„ <code>@Injection</code> ä½œç”¨ä¸ <code>@Autowired</code> å®Œå…¨ä¸€æ ·ï¼Œä¸€èˆ¬ç”¨åœ¨ EJB3.0 ä¸­</li></ul><h4 id="JDKç±»å‹-valueã€-PropertySource"><a href="#JDKç±»å‹-valueã€-PropertySource" class="headerlink" title="JDKç±»å‹@valueã€@PropertySource"></a>JDKç±»å‹<code>@value</code>ã€<code>@PropertySource</code></h4><p>æ–¹æ³•ä¸€ï¼š<code>@value</code> æ³¨è§£çš„åŸºæœ¬ä½¿ç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> è®¾ç½®xxx.properties    id = 10   name = suns<span class="hljs-bullet">2.</span> Springçš„å·¥å‚è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:/xxx.properties&quot;</span>/&gt;</span></span><span class="hljs-bullet">3.</span> ä»£ç ä¸­è¿›è¡Œæ³¨å…¥   å±æ€§ @Value(&quot;$&#123;key&#125;&quot;)</code></pre></div><p>æ–¹æ³•äºŒï¼šä½¿ç”¨ <code>@PropertySource</code> å–ä»£ xmlé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> è®¾ç½®xxx.properties    id = 10   name = suns<span class="hljs-bullet">2.</span> åœ¨å®ä½“ç±»ä¸Šåº”ç”¨@PropertySource(&quot;classpath:/xx.properties&quot;)<span class="hljs-bullet">3.</span> ä»£ç    å±æ€§ @Value(&quot;$&#123;key&#125;&quot;)</code></pre></div><p><code>@value</code> æ³¨è§£ä½¿ç”¨ç»†èŠ‚ï¼š</p><ul><li><code>@Value</code> æ³¨è§£ä¸èƒ½åº”ç”¨åœ¨é™æ€æˆå‘˜å˜é‡ä¸Šï¼Œå¦‚æœä½¿ç”¨ï¼Œè·å–çš„å€¼ä¸º null</li><li><code>@Value</code> æ³¨è§£ + Properties è¿™ç§æ–¹å¼ï¼Œä¸èƒ½æ³¨å…¥é›†åˆç±»å‹<ul><li>Spring æä¾›æ–°çš„é…ç½®å½¢å¼ <strong>YAML(YML)</strong> (æ›´å¤šçš„ç”¨äºSpringBootä¸­)</li></ul></li></ul><h3 id="2-3-æ³¨è§£æ‰«æè¯¦è§£"><a href="#2-3-æ³¨è§£æ‰«æè¯¦è§£" class="headerlink" title="2.3 æ³¨è§£æ‰«æè¯¦è§£"></a>2.3 æ³¨è§£æ‰«æè¯¦è§£</h3><p>è¿™æ ·é…ç½®ï¼Œä¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ… </p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.baizhiedu&quot;</span>/&gt;</span></code></pre></div><h4 id="2-3-1-æ’é™¤æ–¹å¼"><a href="#2-3-1-æ’é™¤æ–¹å¼" class="headerlink" title="2.3.1 æ’é™¤æ–¹å¼"></a>2.3.1 æ’é™¤æ–¹å¼</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><p><code>type=&quot;xxx&quot;</code>ï¼Œ<code>xxx</code> æœ‰ä»¥ä¸‹å‡ ä¸ªå¯é€‰é¡¹ï¼š</p><ul><li><code>assignable</code>ï¼šæ’é™¤ç‰¹å®šçš„ç±»å‹</li><li><code>annotation</code>ï¼šæ’é™¤ç‰¹å®šçš„æ³¨è§£</li><li><code>aspectj</code>ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨<br>åŒ…åˆ‡å…¥ç‚¹ï¼š <code>com.yusael.bean..*</code><br>ç±»åˆ‡å…¥ç‚¹ï¼š <code>*..User</code></li><li><code>regex</code>ï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸å¸¸ç”¨ï¼Œä¸åˆ‡å…¥ç‚¹ç±»ä¼¼</li><li><code>custom</code>ï¼šè‡ªå®šä¹‰æ’é™¤ç­–ç•¥ï¼Œå¸¸ç”¨äºæ¡†æ¶åº•å±‚å¼€å‘ï¼ˆåœ¨ SpringBoot æºç ä¸­å¤§é‡ä½¿ç”¨ï¼‰</li></ul><p>æ’é™¤ç­–ç•¥å¯ä»¥å åŠ ä½¿ç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;assignable&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;com.yusael.bean.User&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;aspectj&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;com.yusael.injection..*&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><h4 id="2-3-1-åŒ…å«æ–¹å¼"><a href="#2-3-1-åŒ…å«æ–¹å¼" class="headerlink" title="2.3.1 åŒ…å«æ–¹å¼"></a>2.3.1 åŒ…å«æ–¹å¼</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><p>ä¸æ’é™¤æ–¹å¼ä½¿ç”¨çš„åŒºåˆ«ï¼š</p><ul><li><code>use-default-filters=&quot;false&quot;</code> è®© Spring é»˜è®¤çš„æ³¨è§£æ‰«ææ–¹å¼å¤±æ•ˆ</li><li><code>&lt;context:include-filter type=&quot;&quot; expression=&quot;&quot;/&gt;</code> ç”¨äºæŒ‡å®šæ‰«æå“ªäº›æ³¨è§£<br><code>type=&quot;xxx&quot;</code> ä¸æ’é™¤æ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢</li></ul><p>åŒ…å«ç­–ç•¥ä¹Ÿå¯ä»¥å åŠ ä½¿ç”¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.baizhiedu&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><h3 id="2-4-å¯¹äºæ³¨è§£å¼€å‘çš„æ€è€ƒ"><a href="#2-4-å¯¹äºæ³¨è§£å¼€å‘çš„æ€è€ƒ" class="headerlink" title="2.4 å¯¹äºæ³¨è§£å¼€å‘çš„æ€è€ƒ"></a>2.4 å¯¹äºæ³¨è§£å¼€å‘çš„æ€è€ƒ</h3><p>Spring é€šè¿‡æ³¨è§£é…ç½®ï¼Œä¸é€šè¿‡xmlæ–‡ä»¶è¿›è¡Œé…ç½®æ˜¯äº’é€šçš„</p><div class="hljs code-wrapper"><pre><code class="hljs markdown">// é€šè¿‡æ³¨è§£é…ç½®UserDAOImpl@Repositorypublic class UserDAOImpl&#123;&#125;public class UserServiceImpl&#123;   private UserDAO userDAO;   set    get&#125;// é€šè¿‡xmlé…ç½®åˆ›å»ºuserDAOå¯¹è±¡<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.UserServiceImpl&quot;</span>&gt;</span></span>   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDAOImpl&quot;</span>/&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span></code></pre></div><p><strong>ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æ³¨è§£ ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨é…ç½®æ–‡ä»¶</strong></p><p>åŸºç¡€æ³¨è§£ï¼ˆ<code>@Component</code>ã€<code>@Autowired</code>ã€<code>@Value</code>ï¼‰ç”¨äºç¨‹åºå‘˜å¼€å‘ç±»å‹çš„é…ç½®ï¼š</p><ul><li>åœ¨ç¨‹åºå‘˜å¼€å‘çš„ç±»å‹ä¸Šï¼Œå¯ä»¥åŠ å…¥å¯¹åº”æ³¨è§£è¿›è¡Œå¯¹è±¡çš„åˆ›å»º<ul><li>Userã€UserServiceã€UserDAOã€UserActionâ€¦ è¿™äº›ç±»éƒ½å¾ˆé€‚åˆç”¨æ³¨è§£</li></ul></li><li>åº”ç”¨å…¶ä»–éç¨‹åºå‘˜å¼€å‘çš„ç±»å‹æ—¶ï¼ˆæ¡†æ¶è‡ªå¸¦çš„ç±»ï¼‰ï¼Œéœ€è¦ä½¿ç”¨<code>&lt;bean&gt;</code>æ ‡ç­¾è¿›è¡Œé…ç½®<ul><li>SqlSessionFactoryBeanã€MapperScannerConfigure ç­‰ Spring åˆ›å»ºçš„ç±»ï¼Œæ— æ³•ä½¿ç”¨æ³¨è§£</li></ul></li></ul><h2 id="3-Springçš„é«˜çº§æ³¨è§£ï¼ˆSpring3-x-åŠä»¥ä¸Š"><a href="#3-Springçš„é«˜çº§æ³¨è§£ï¼ˆSpring3-x-åŠä»¥ä¸Š" class="headerlink" title="3. Springçš„é«˜çº§æ³¨è§£ï¼ˆSpring3.x åŠä»¥ä¸Š)"></a>3. Springçš„é«˜çº§æ³¨è§£ï¼ˆSpring3.x åŠä»¥ä¸Š)</h2><h3 id="3-1-é…ç½®Bean"><a href="#3-1-é…ç½®Bean" class="headerlink" title="3.1 é…ç½®Bean"></a>3.1 é…ç½®Bean</h3><p>Spring åœ¨ 3.x æä¾›çš„æ–°çš„æ³¨è§£<code>@Configuration</code>ï¼Œç”¨äºæ›¿æ¢ XML é…ç½®æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span> </span>&#123;&#125;</code></pre></div><ul><li>é…ç½®Beanåœ¨åº”ç”¨çš„è¿‡ç¨‹ä¸­ æ›¿æ¢äº†XMLå…·ä½“ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿ</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200703100033265.png" alt="image-20200703100033265"></p><ul><li><strong>ä½¿ç”¨äº† <code>@Configuration</code> åï¼Œç”¨ <code>AnnotationConfigApplicationContext</code> åˆ›å»ºå·¥å‚ï¼š</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java">æ–¹æ³•<span class="hljs-number">1</span>: æŒ‡å®šé…ç½®beançš„ClassApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);æ–¹æ³•<span class="hljs-number">2</span>: æŒ‡å®šé…ç½®beanæ‰€åœ¨çš„è·¯å¾„(æŸä¸ªåŒ…åŠå…¶å­åŒ…)ApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(<span class="hljs-string">&quot;com.yusael&quot;</span>);</code></pre></div><p><code>@Configuration</code> <strong>æ³¨è§£çš„æœ¬è´¨</strong>ï¼šæŸ¥çœ‹æºç å¯çŸ¥ï¼Œå®ƒä¹Ÿæ˜¯ <code>@Component</code> æ³¨è§£çš„è¡ç”Ÿæ³¨è§£<br>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ <code>&lt;context:component-scan</code> è¿›è¡Œæ‰«æï¼Œä½†æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåšï¼Œå› ä¸ºæ³¨è§£å°±æ˜¯ä¸ºäº†å–ä»£ xml</p><ul><li><p><strong>é…ç½®Beanå¼€å‘çš„ç»†èŠ‚åˆ†æ</strong></p><ul><li><p>åŸºäºæ³¨è§£å¼€å‘ä½¿ç”¨æ—¥å¿—</p><blockquote><p>SpringåŸºäºæ³¨è§£çš„å¼€å‘ä¸èƒ½é›†æˆLog4jï¼Œæ¨èä½¿ç”¨é›†æˆlogbackï¼Œéœ€è¦è‡ªå·±å¼•å…¥ </p></blockquote><ul><li><p>å¼•å…¥ç›¸å…³jar</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.logback-extensions<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-ext-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.1.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div></li><li><p>å¼•å…¥logbacké…ç½®æ–‡ä»¶ <code>(logback.xml)</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>            <span class="hljs-comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;DEBUG&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div></li></ul></li><li><p>@Configurationæ³¨è§£çš„æœ¬è´¨</p><blockquote><p>æœ¬è´¨ï¼šä¹Ÿæ˜¯@Componentæ³¨è§£çš„è¡ç”Ÿæ³¨è§£</p><p>å¯ä»¥åº”ç”¨&lt;context:component-scanè¿›è¡Œæ‰«æï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸å¸¸ç”¨</p></blockquote></li></ul></li></ul><h3 id="3-2-Beanæ³¨è§£"><a href="#3-2-Beanæ³¨è§£" class="headerlink" title="3.2 @Beanæ³¨è§£"></a>3.2 @Beanæ³¨è§£</h3><blockquote><p>@Beanæ³¨è§£åœ¨é…ç½®beanä¸­è¿›è¡Œä½¿ç”¨ï¼Œç­‰åŒäºXMLé…ç½®æ–‡ä»¶ä¸­çš„&lt;beanæ ‡ç­¾</p></blockquote><h4 id="3-2-1-Beanæ³¨è§£çš„åŸºæœ¬ä½¿ç”¨"><a href="#3-2-1-Beanæ³¨è§£çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.2.1 @Beanæ³¨è§£çš„åŸºæœ¬ä½¿ç”¨"></a>3.2.1 @Beanæ³¨è§£çš„åŸºæœ¬ä½¿ç”¨</h4><p>å¯¹è±¡çš„åˆ›å»º</p><p><strong>ç®€å•å¯¹è±¡</strong>ï¼šç›´æ¥èƒ½å¤Ÿé€šè¿‡ new æ–¹å¼åˆ›å»ºçš„å¯¹è±¡</p><ul><li>Userã€UserServiceã€UserDAO</li></ul><p><strong>å¤æ‚å¯¹è±¡</strong>ï¼šä¸èƒ½é€šè¿‡ new çš„æ–¹å¼ç›´æ¥åˆ›å»ºçš„å¯¹è±¡</p><ul><li>Connectionã€SqlSessionFactory</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200703150632630.png" alt="image-20200703150632630"></p><p><code>@Bean</code> æ³¨è§£<strong>åˆ›å»ºå¤æ‚å¯¹è±¡</strong>çš„æ³¨æ„äº‹é¡¹ï¼šé—ç•™ç³»ç»Ÿæ•´åˆ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">conn1</span><span class="hljs-params">()</span> </span>&#123;Connection conn = <span class="hljs-keyword">null</span>;<span class="hljs-keyword">try</span> &#123;ConnectionFactoryBean factoryBean = <span class="hljs-keyword">new</span> ConnectionFactoryBean();conn = factoryBean.getObject();&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;e.printStackTrace();&#125;<span class="hljs-keyword">return</span> conn;&#125;</code></pre></div><p><code>@Bean</code> æ³¨è§£åˆ›å»ºå¯¹è±¡ï¼Œ<strong>è‡ªå®šä¹‰ id å€¼</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean(&quot;id&quot;)</span></code></pre></div><p><code>@Bean</code> æ³¨è§£åˆ›å»ºå¯¹è±¡ï¼Œ<strong>æ§åˆ¶å¯¹è±¡åˆ›å»ºæ¬¡æ•°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-meta">@Scope(&quot;singleton|prototype&quot;)</span> <span class="hljs-comment">//é»˜è®¤å€¼ singleton</span></code></pre></div><h4 id="3-2-2-Beanæ³¨è§£çš„æ³¨å…¥"><a href="#3-2-2-Beanæ³¨è§£çš„æ³¨å…¥" class="headerlink" title="3.2.2  @Beanæ³¨è§£çš„æ³¨å…¥"></a>3.2.2  @Beanæ³¨è§£çš„æ³¨å…¥</h4><ul><li><p>ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span></span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> UserDAO <span class="hljs-title">userDAO</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDAOImpl();&#125;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">(UserDAO userDAO)</span> </span>&#123;UserServiceImpl userService = <span class="hljs-keyword">new</span> UserServiceImpl();userService.setUserDAO(userDAO);<span class="hljs-keyword">return</span> userService;<span class="hljs-comment">//ç®€åŒ–å†™æ³•</span><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">()</span> </span>&#123;UserServiceImpl userService = <span class="hljs-keyword">new</span> UserServiceImpl();userService.setUserDAO(userDAO());<span class="hljs-keyword">return</span> userService;&#125;  &#125;</code></pre></div></li><li><p>JDKç±»å‹çš„æ³¨å…¥</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">customer</span><span class="hljs-params">()</span> </span>&#123;Customer customer = <span class="hljs-keyword">new</span> Customer();customer.setId(<span class="hljs-number">1</span>);customer.setName(<span class="hljs-string">&quot;xiaohei&quot;</span>);<span class="hljs-keyword">return</span> customer;&#125;</code></pre></div><ul><li><p>JDKç±»å‹æ³¨å…¥çš„ç»†èŠ‚åˆ†æ</p><p>å¦‚æœç›´æ¥åœ¨ä»£ç ä¸­è¿›è¡Œ set æ–¹æ³•çš„è°ƒç”¨ï¼Œä¼šå­˜åœ¨è€¦åˆçš„é—®é¢˜ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶è§£å†³ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@PropertySource(&quot;classpath:/init.properties&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig1</span> </span>&#123;<span class="hljs-meta">@Value(&quot;$&#123;id&#125;&quot;)</span><span class="hljs-keyword">private</span> Integer id;<span class="hljs-meta">@Value(&quot;$&#123;name&#125;&quot;)</span><span class="hljs-keyword">private</span> String name;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">customer</span><span class="hljs-params">()</span> </span>&#123;Customer customer = <span class="hljs-keyword">new</span> Customer();customer.setId(id);customer.setName(name);<span class="hljs-keyword">return</span> customer;&#125;&#125;</code></pre></div></li></ul></li></ul><h3 id="3-3-ComponentScanæ³¨è§£"><a href="#3-3-ComponentScanæ³¨è§£" class="headerlink" title="3.3  @ComponentScanæ³¨è§£"></a>3.3  @ComponentScanæ³¨è§£</h3><p><code>@ComponentScan</code> æ³¨è§£åœ¨é…ç½® bean ä¸­è¿›è¡Œä½¿ç”¨ï¼Œç­‰åŒäº XML é…ç½®æ–‡ä»¶ä¸­çš„ <code>&lt;context:component-scan&gt;</code> æ ‡ç­¾</p><p>ç›®çš„ï¼šè¿›è¡Œç›¸å…³æ³¨è§£çš„æ‰«æï¼ˆ<code>@Component</code>ã€<code>@Value</code>ã€<code>@Autowired</code> â€¦)</p><h4 id="3-3-1-åŸºæœ¬ä½¿ç”¨"><a href="#3-3-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.3.1 åŸºæœ¬ä½¿ç”¨"></a>3.3.1 åŸºæœ¬ä½¿ç”¨</h4><ul><li>XML æ–¹å¼ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael.scan&quot;</span>/&gt;</span></code></pre></div><ul><li>æ³¨è§£æ–¹å¼</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.yusael.scan&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig2</span> </span>&#123;&#125;</code></pre></div><h4 id="3-3-2-æ’é™¤ã€åŒ…å«çš„ä½¿ç”¨"><a href="#3-3-2-æ’é™¤ã€åŒ…å«çš„ä½¿ç”¨" class="headerlink" title="3.3.2 æ’é™¤ã€åŒ…å«çš„ä½¿ç”¨"></a>3.3.2 æ’é™¤ã€åŒ…å«çš„ä½¿ç”¨</h4><p><strong>æ’é™¤</strong></p><ul><li>XML æ–¹å¼ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;assignable&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;com.yusael.bean.User&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><ul><li><strong>æ³¨è§£æ–¹å¼</strong>ï¼š<br>æ’é™¤ç‰¹å®šçš„æ³¨è§£ï¼š<code>type = FilterType.ANNOTATION, value=&#123;&#125;</code><br>æ’é™¤ç‰¹å®šçš„ç±»å‹ï¼š<code>type = FilterType.ASSIGNABLE_TYPE , value=&#123;]</code><br>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼š<code>type = FilterType.ASPECTJ, pattern=&quot;&quot;</code><br>æ­£åˆ™è¡¨è¾¾å¼ï¼š<code>type = FilterType.REGEX, pattern=&quot;&quot;</code><br>è‡ªå®šä¹‰æ’é™¤ç­–ç•¥ï¼š<code>type = FilterType.CUSTOM, pattern=&quot;&quot;</code></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.yusael.scan&quot;,</span><span class="hljs-meta"> excludeFilters = &#123;@ComponentScan.Filter(type= FilterType.ANNOTATION, value=&#123;Service.class&#125;),</span><span class="hljs-meta">                   @ComponentScan.Filter(type= FilterType.ASPECTJ, pattern = &quot;*..User1&quot;)&#125;)</span></code></pre></div><p><strong>åŒ…å«</strong></p><ul><li>XML æ–¹å¼ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.yusael&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span></code></pre></div><ul><li>æ³¨è§£æ–¹å¼ï¼šå‚æ•°ä¸æ’é™¤ç­–ç•¥ä¸­ä¸€æ ·</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.yusaael.scan&quot;,</span><span class="hljs-meta">useDefaultFilters = false,</span><span class="hljs-meta">includeFilters = &#123;@ComponentScan.Filter(type= FilterType.ANNOTATION,value=&#123;Service.class&#125;)&#125;)</span></code></pre></div><h3 id="3-4-Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„å¤šç§é…ç½®æ–¹å¼"><a href="#3-4-Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„å¤šç§é…ç½®æ–¹å¼" class="headerlink" title="3.4 Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„å¤šç§é…ç½®æ–¹å¼"></a>3.4 Springå·¥å‚åˆ›å»ºå¯¹è±¡çš„å¤šç§é…ç½®æ–¹å¼</h3><h4 id="3-4-1-å¤šç§é…ç½®æ–¹å¼çš„åº”ç”¨åœºæ™¯"><a href="#3-4-1-å¤šç§é…ç½®æ–¹å¼çš„åº”ç”¨åœºæ™¯" class="headerlink" title="3.4.1 å¤šç§é…ç½®æ–¹å¼çš„åº”ç”¨åœºæ™¯"></a>3.4.1 å¤šç§é…ç½®æ–¹å¼çš„åº”ç”¨åœºæ™¯</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200706174301418.png" alt="image-20200706174301418"></p><h4 id="3-4-2-é…ç½®ä¼˜å…ˆçº§"><a href="#3-4-2-é…ç½®ä¼˜å…ˆçº§" class="headerlink" title="3.4.2 é…ç½®ä¼˜å…ˆçº§"></a>3.4.2 é…ç½®ä¼˜å…ˆçº§</h4><p>é…ç½®ä¼˜å…ˆçº§ï¼š<code>@Component</code> åŠå…¶è¡ç”Ÿæ³¨è§£   **&lt;**   <code>@Bean</code>    **&lt;**    é…ç½®æ–‡ä»¶<code>&lt;bean&gt;</code>æ ‡ç­¾</p><ul><li>ä¼˜å…ˆçº§é«˜çš„é…ç½®ï¼Œä¼šè¦†ç›–ä¼˜å…ˆçº§ä½é…ç½®</li><li>é…ç½®è¦†ç›–ï¼šid å€¼éœ€è¦ä¿æŒä¸€è‡´</li></ul><p>é€šè¿‡é…ç½®ä¼˜å…ˆçº§ï¼Œå¯ä»¥è§£å†³åŸºäºæ³¨è§£è¿›è¡Œé…ç½®çš„è€¦åˆé—®é¢˜ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-comment">//@ImportResource(&quot;applicationContext.xml&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig4</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDAO <span class="hljs-title">userDAO</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDAOImpl();    &#125;&#125;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ImportResource(&quot;applicationContext.xml&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig5</span></span>&#123;  &#125;<span class="hljs-comment">//applicationContext.xmlè¦†ç›–æ—§å®ç°</span>&lt;bean id=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;com.baizhiedu.injection.UserDAOImplNew&quot;</span>/&gt;</code></pre></div><h3 id="3-5-æ•´åˆå¤šä¸ªé…ç½®ä¿¡æ¯"><a href="#3-5-æ•´åˆå¤šä¸ªé…ç½®ä¿¡æ¯" class="headerlink" title="3.5 æ•´åˆå¤šä¸ªé…ç½®ä¿¡æ¯"></a>3.5 æ•´åˆå¤šä¸ªé…ç½®ä¿¡æ¯</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰å¤šä¸ªé…ç½®ä¿¡æ¯</p><blockquote><p>æ‹†åˆ†å¤šä¸ªé…ç½®beançš„å¼€å‘ï¼Œæ˜¯ä¸€ç§æ¨¡å—åŒ–å¼€å‘çš„å½¢å¼ï¼Œä¹Ÿä½“ç°äº†é¢å‘å¯¹è±¡å„å¸å…¶èŒçš„è®¾è®¡æ€æƒ³</p></blockquote><p>å¤šé…ç½®ä¿¡æ¯æ•´åˆçš„æ–¹å¼</p><ul><li>å¤šä¸ªé…ç½®Beançš„æ•´åˆ</li><li>é…ç½®Beanä¸<code>@Component</code>ç›¸å…³æ³¨è§£çš„æ•´åˆ</li><li>é…ç½®Beanä¸SpringXMLé…ç½®æ–‡ä»¶çš„æ•´åˆ</li></ul><p>æ•´åˆå¤šç§é…ç½®éœ€è¦å…³æ³¨é‚£äº›è¦ç‚¹</p><ul><li>å¦‚ä½•ä½¿å¤šé…ç½®çš„ä¿¡æ¯æ±‡æ€»æˆä¸€ä¸ªæ•´ä½“</li><li>å¦‚ä½•å®ç°è·¨é…ç½®çš„æ³¨å…¥</li></ul><h4 id="3-5-1-å¤šä¸ªé…ç½®Beançš„æ•´åˆ"><a href="#3-5-1-å¤šä¸ªé…ç½®Beançš„æ•´åˆ" class="headerlink" title="3.5.1. å¤šä¸ªé…ç½®Beançš„æ•´åˆ"></a>3.5.1. å¤šä¸ªé…ç½®Beançš„æ•´åˆ</h4><p><strong>å¤šé…ç½®çš„ä¿¡æ¯æ±‡æ€»</strong></p><ul><li><p>base-packageè¿›è¡Œå¤šä¸ªé…ç½®Beançš„æ•´åˆ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200707170421669.png" alt="image-20200707170421669"></p></li><li><p><code>@Import</code></p><ul><li>å¯ä»¥åˆ›å»ºå¯¹è±¡</li><li>å¤šé…ç½®beançš„æ•´åˆ</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200707170745814.png" alt="image-20200707170745814"></p></li><li><p>åœ¨å·¥å‚åˆ›å»ºæ—¶ï¼ŒæŒ‡å®šå¤šä¸ªé…ç½®Beançš„Classå¯¹è±¡ ã€äº†è§£ã€‘</p><div class="hljs code-wrapper"><pre><code class="hljs java">ApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(AppConfig1.class,AppConfig2.class);</code></pre></div></li><li><p>è·¨é…ç½®è¿›è¡Œæ³¨å…¥</p><p>åœ¨åº”ç”¨é…ç½® Bean çš„è¿‡ç¨‹ä¸­ï¼Œä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼è¿›è¡Œé…ç½®ä¿¡æ¯çš„æ±‡æ€»ï¼Œå…¶æ“ä½œæ–¹å¼éƒ½æ˜¯é€šè¿‡æˆå‘˜å˜é‡åŠ å…¥ <code>@Autowired</code> æ³¨è§£å®Œæˆ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import(AppConfig2.class)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig1</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> UserDAO userDAO;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">()</span> </span>&#123;        UserServiceImpl userService = <span class="hljs-keyword">new</span> UserServiceImpl();        userService.setUserDAO(userDAO);        <span class="hljs-keyword">return</span> userService;    &#125;&#125;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig2</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDAO <span class="hljs-title">userDAO</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDAOImpl();    &#125;&#125;</code></pre></div></li></ul><h4 id="3-5-2-é…ç½®Beanä¸-Componentç›¸å…³æ³¨è§£çš„æ•´åˆ"><a href="#3-5-2-é…ç½®Beanä¸-Componentç›¸å…³æ³¨è§£çš„æ•´åˆ" class="headerlink" title="3.5.2 é…ç½®Beanä¸@Componentç›¸å…³æ³¨è§£çš„æ•´åˆ"></a>3.5.2 é…ç½®Beanä¸@Componentç›¸å…³æ³¨è§£çš„æ•´åˆ</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span>/<span class="hljs-meta">@Repository</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDAOImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDAO</span></span>&#123;&#125;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(&quot;UserDaoæ‰€åœ¨çš„åŒ…&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig3</span> </span>&#123;       <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> UserDAO userDAO;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">()</span> </span>&#123;        UserServiceImpl userService = <span class="hljs-keyword">new</span> UserServiceImpl();        userService.setUserDAO(userDAO);        <span class="hljs-keyword">return</span> userService;    &#125;&#125;ApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(AppConfig3.class);</code></pre></div><h4 id="3-5-3-é…ç½®Beanä¸é…ç½®æ–‡ä»¶æ•´åˆ"><a href="#3-5-3-é…ç½®Beanä¸é…ç½®æ–‡ä»¶æ•´åˆ" class="headerlink" title="3.5.3  é…ç½®Beanä¸é…ç½®æ–‡ä»¶æ•´åˆ"></a>3.5.3  é…ç½®Beanä¸é…ç½®æ–‡ä»¶æ•´åˆ</h4><p>ä¸»è¦ç”¨äºï¼š</p><ul><li>é—ç•™ç³»ç»Ÿçš„æ•´åˆ</li><li>é…ç½®è¦†ç›–</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDAOImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDAO</span></span>&#123;&#125;&lt;bean id=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;com.baizhiedu.injection.UserDAOImpl&quot;</span>/&gt;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ImportResource(&quot;applicationContext.xml&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig4</span> </span>&#123;      <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> UserDAO userDAO;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">()</span> </span>&#123;        UserServiceImpl userService = <span class="hljs-keyword">new</span> UserServiceImpl();        userService.setUserDAO(userDAO);        <span class="hljs-keyword">return</span> userService;    &#125;&#125;ApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(AppConfig4.class);</code></pre></div><h3 id="3-6-é…ç½®Beanåº•å±‚å®ç°åŸç†"><a href="#3-6-é…ç½®Beanåº•å±‚å®ç°åŸç†" class="headerlink" title="3.6 é…ç½®Beanåº•å±‚å®ç°åŸç†"></a>3.6 é…ç½®Beanåº•å±‚å®ç°åŸç†</h3><blockquote><p>Spring åœ¨é…ç½® Bean ä¸­åŠ å…¥äº† <code>@Configuration</code> æ³¨è§£åï¼ŒSpringåº•å±‚å°±ä¼šé€šè¿‡AOPçš„æ–¹å¼æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Œå³ Cglib çš„ä»£ç†æ–¹å¼ï¼Œæ¥è¿›è¡Œå¯¹è±¡ç›¸å…³çš„é…ç½®ã€å¤„ç†</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200709114200371.png" alt="image-20200709114200371"> </p><h2 id="4-å››ç»´ä¸€ä½“çš„å¼€å‘æ€æƒ³"><a href="#4-å››ç»´ä¸€ä½“çš„å¼€å‘æ€æƒ³" class="headerlink" title="4. å››ç»´ä¸€ä½“çš„å¼€å‘æ€æƒ³"></a>4. å››ç»´ä¸€ä½“çš„å¼€å‘æ€æƒ³</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯å››ç»´ä¸€ä½“"><a href="#4-1-ä»€ä¹ˆæ˜¯å››ç»´ä¸€ä½“" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯å››ç»´ä¸€ä½“"></a>4.1 ä»€ä¹ˆæ˜¯å››ç»´ä¸€ä½“</h3><blockquote><p>Springå¼€å‘ä¸€ä¸ªåŠŸèƒ½çš„4ç§å½¢å¼ï¼Œè™½ç„¶å¼€å‘æ–¹å¼ä¸åŒï¼Œä½†æ˜¯æœ€ç»ˆæ•ˆæœæ˜¯ä¸€æ ·çš„</p><ul><li>åŸºäºschema </li><li>åŸºäºç‰¹å®šåŠŸèƒ½æ³¨è§£ </li><li>åŸºäºåŸå§‹&lt;bean </li><li>åŸºäº@Beanæ³¨è§£</li></ul></blockquote><h3 id="4-2-å››ç»´ä¸€ä½“çš„å¼€å‘æ¡ˆä¾‹"><a href="#4-2-å››ç»´ä¸€ä½“çš„å¼€å‘æ¡ˆä¾‹" class="headerlink" title="4.2 å››ç»´ä¸€ä½“çš„å¼€å‘æ¡ˆä¾‹"></a>4.2 å››ç»´ä¸€ä½“çš„å¼€å‘æ¡ˆä¾‹</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">1.</span>&lt;context:property-placehoder<span class="hljs-number">2.</span><span class="hljs-meta">@PropertySource</span>  ã€æ¨èã€‘<span class="hljs-number">3.</span>&lt;bean id=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;PropertySourcePlaceholderConfigure&quot;</span>/&gt;  &lt;property name=<span class="hljs-string">&quot;location&quot;</span> value=<span class="hljs-string">&quot;classpath:xx.properties&quot;</span>/&gt;<span class="hljs-number">4.</span><span class="hljs-meta">@Bean</span>            ã€æ¨èã€‘</code></pre></div><h2 id="5-çº¯æ³¨è§£ç‰ˆAOPç¼–ç¨‹"><a href="#5-çº¯æ³¨è§£ç‰ˆAOPç¼–ç¨‹" class="headerlink" title="5. çº¯æ³¨è§£ç‰ˆAOPç¼–ç¨‹"></a>5. çº¯æ³¨è§£ç‰ˆAOPç¼–ç¨‹</h2><h3 id="5-1-æ­å»ºç¯å¢ƒ"><a href="#5-1-æ­å»ºç¯å¢ƒ" class="headerlink" title="5.1 æ­å»ºç¯å¢ƒ"></a>5.1 æ­å»ºç¯å¢ƒ</h3><ul><li>åº”ç”¨é…ç½®Bean </li><li>æ³¨è§£æ‰«æ</li></ul><h3 id="5-2-å¼€å‘æ­¥éª¤"><a href="#5-2-å¼€å‘æ­¥éª¤" class="headerlink" title="5.2 å¼€å‘æ­¥éª¤"></a>5.2 å¼€å‘æ­¥éª¤</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">1.</span> åŸå§‹å¯¹è±¡   <span class="hljs-meta">@Service</span>/<span class="hljs-meta">@Component</span>   <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span></span>&#123;   &#125;<span class="hljs-number">2.</span> åˆ›å»ºåˆ‡é¢ç±» ï¼ˆé¢å¤–åŠŸèƒ½ åˆ‡å…¥ç‚¹ ç»„è£…åˆ‡é¢ï¼‰    <span class="hljs-meta">@Aspect</span>    <span class="hljs-meta">@Component</span>    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;        <span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">arround</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;            System.out.println(<span class="hljs-string">&quot;----aspect log ------&quot;</span>);            Object ret = joinPoint.proceed();            <span class="hljs-keyword">return</span> ret;        &#125;    &#125;<span class="hljs-number">3.</span> Springçš„é…ç½®æ–‡ä»¶ä¸­   &lt;aop:aspectj-autoproxy /&gt;   <span class="hljs-meta">@EnableAspectjAutoProxy</span> ---&gt; é…ç½®Bean</code></pre></div><h3 id="5-3-æ³¨è§£AOPç»†èŠ‚åˆ†æ"><a href="#5-3-æ³¨è§£AOPç»†èŠ‚åˆ†æ" class="headerlink" title="5.3 æ³¨è§£AOPç»†èŠ‚åˆ†æ"></a>5.3 æ³¨è§£AOPç»†èŠ‚åˆ†æ</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">1.</span> ä»£ç†åˆ›å»ºæ–¹å¼çš„åˆ‡æ¢ JDK Cglib    &lt;aop:aspectj-autoproxy proxy-target-<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-keyword">true</span>|<span class="hljs-keyword">false</span> /&gt;   <span class="hljs-meta">@EnableAspectjAutoProxy(proxyTargetClass = &quot;true|false&quot;)</span><span class="hljs-number">2.</span> SpringBoot AOPçš„å¼€å‘æ–¹å¼     <span class="hljs-meta">@EnableAspectjAutoProxy</span> å·²ç»è®¾ç½®å¥½äº†     <span class="hljs-number">1.</span> åŸå§‹å¯¹è±¡     <span class="hljs-meta">@Service(@Component)</span>     <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span></span>&#123;     &#125;    <span class="hljs-number">2.</span> åˆ›å»ºåˆ‡é¢ç±» ï¼ˆé¢å¤–åŠŸèƒ½ åˆ‡å…¥ç‚¹ ç»„è£…åˆ‡é¢ï¼‰      <span class="hljs-meta">@Aspect</span>      <span class="hljs-meta">@Component</span>      <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;        <span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">arround</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;          System.out.println(<span class="hljs-string">&quot;----aspect log ------&quot;</span>);          Object ret = joinPoint.proceed();          <span class="hljs-keyword">return</span> ret;        &#125;      &#125;<span class="hljs-comment">//Spring AOP ä»£ç†é»˜è®¤å®ç° JDK  SpringBOOT AOP ä»£ç†é»˜è®¤å®ç° Cglib </span></code></pre></div><h3 id="5-4-çº¯æ³¨è§£ç‰ˆSpring-MyBatisæ•´åˆ"><a href="#5-4-çº¯æ³¨è§£ç‰ˆSpring-MyBatisæ•´åˆ" class="headerlink" title="5.4 çº¯æ³¨è§£ç‰ˆSpring+MyBatisæ•´åˆ"></a>5.4 çº¯æ³¨è§£ç‰ˆSpring+MyBatisæ•´åˆ</h3><p><strong>åŸºç¡€é…ç½® ï¼ˆé…ç½®Beanï¼‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml">1. è¿æ¥æ±   <span class="hljs-comment">&lt;!--è¿æ¥æ± --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/suns?useSSL=false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>   @Bean   public DataSource dataSource()&#123;      DruidDataSource dataSource = new DruidDataSource();      dataSource.setDriverClassName(&quot;&quot;);      dataSource.setUrl();      ...      return dataSource;   &#125;2. SqlSessionFactoryBean    <span class="hljs-comment">&lt;!--åˆ›å»ºSqlSessionFactory SqlSessionFactoryBean--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.baizhiedu.entity&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>classpath:com.baizhiedu.mapper/*Mapper.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    @Bean    public SqlSessionFactoryBean sqlSessionFactoryBean(DataSource dataSource)&#123;         SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();         sqlSessionFactoryBean.setDataSource(dataSource);         sqlSessionFactoryBean.setTypeAliasesPackage(&quot;&quot;);         ...         return sqlSessionFactoryBean;    &#125;3. MapperScannerConfigure    <span class="hljs-comment">&lt;!--åˆ›å»ºDAOå¯¹è±¡ MapperScannerConfigure--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scanner&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.baizhiedu.dao&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>  @MapperScan(basePackages=&#123;&quot;com.baizhiedu.dao&quot;&#125;) ---&gt; é…ç½®beanå®Œæˆ</code></pre></div><p><strong>ç¼–ç </strong></p><ul><li>å®ä½“</li><li>è¡¨</li><li>DAOæ¥å£</li><li>Mapperæ–‡ä»¶ </li></ul><h4 id="5-4-1-MapperLocationsç¼–ç æ—¶é€šé…çš„å†™æ³•"><a href="#5-4-1-MapperLocationsç¼–ç æ—¶é€šé…çš„å†™æ³•" class="headerlink" title="5.4.1 MapperLocationsç¼–ç æ—¶é€šé…çš„å†™æ³•"></a>5.4.1 MapperLocationsç¼–ç æ—¶é€šé…çš„å†™æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//è®¾ç½®Mapperæ–‡ä»¶çš„è·¯å¾„</span>sqlSessionFactoryBean.setMapperLocations(Resource..);Resource resouce = <span class="hljs-keyword">new</span> ClassPathResouce(<span class="hljs-string">&quot;UserDAOMapper.xml&quot;</span>)sqlSessionFactoryBean.setMapperLocations(<span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">&quot;UserDAOMapper.xml&quot;</span>));&lt;property name=<span class="hljs-string">&quot;mapperLocations&quot;</span>&gt;   &lt;list&gt;     &lt;value&gt;classpath:com.baizhiedu.mapper<span class="hljs-comment">/*Mapper.xml&lt;/value&gt;</span><span class="hljs-comment">   &lt;/list&gt;</span><span class="hljs-comment">&lt;/property&gt;</span><span class="hljs-comment">//ä¼ å…¥çš„æ˜¯ä¸€ç»„Mapperæ–‡ä»¶ï¼Œä¸é€‚ç”¨ä¸Šé¢setMapperLocationsçš„æ–¹å¼</span></code></pre></div><p><strong>æ›´å¥½çš„å†™æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">ResourcePatternResolver resolver = <span class="hljs-keyword">new</span> PathMatchingResourcePatternResolver();Resource[] resources = resolver.getResources(<span class="hljs-string">&quot;com.baizhi.mapper/*Mapper.xml&quot;</span>);sqlSessionFactoryBean.setMapperLocations(resources)</code></pre></div><h4 id="5-4-2-é…ç½®Beanæ•°æ®è€¦åˆçš„é—®é¢˜"><a href="#5-4-2-é…ç½®Beanæ•°æ®è€¦åˆçš„é—®é¢˜" class="headerlink" title="5.4.2 é…ç½®Beanæ•°æ®è€¦åˆçš„é—®é¢˜"></a>5.4.2 é…ç½®Beanæ•°æ®è€¦åˆçš„é—®é¢˜</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">mybatis.driverClassName</span> = <span class="hljs-string">com.mysql.jdbc.Driver</span><span class="hljs-meta">mybatis.url</span> = <span class="hljs-string">jdbc:mysql://localhost:3306/suns?useSSL=false</span><span class="hljs-meta">mybatis.username</span> = <span class="hljs-string">root</span><span class="hljs-meta">mybatis.password</span> = <span class="hljs-string">123456</span><span class="hljs-meta">mybatis.typeAliasesPackages</span> = <span class="hljs-string">com.baizhiedu.mybatis</span><span class="hljs-meta">mybatis.mapperLocations</span> = <span class="hljs-string">com.baizhiedu.mapper/*Mapper.xml</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-meta">@PropertySource(&quot;classpath:mybatis.properties&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisProperties</span> </span>&#123;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.driverClassName&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String driverClassName;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.url&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String url;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.username&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String username;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.password&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String password;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.typeAliasesPackages&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String typeAliasesPackages;    <span class="hljs-meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String mapperLocations;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisAutoConfiguration</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> MybatisProperties mybatisProperties;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>&#123;        DruidDataSource dataSource = <span class="hljs-keyword">new</span> DruidDataSource();        dataSource.setDriverClassName(mybatisProperties.getDriverClassName());        dataSource.setUrl(mybatisProperties.getUrl());        dataSource.setUsername(mybatisProperties.getUsername());        dataSource.setPassword(mybatisProperties.getPassword());        <span class="hljs-keyword">return</span> dataSource;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionFactoryBean <span class="hljs-title">sqlSessionFactoryBean</span><span class="hljs-params">(DataSource dataSource)</span> </span>&#123;        SqlSessionFactoryBean sqlSessionFactoryBean = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();        sqlSessionFactoryBean.setDataSource(dataSource);        sqlSessionFactoryBean.setTypeAliasesPackage(mybatisProperties.getTypeAliasesPackages(<span class="hljs-string">&quot;&quot;</span>));        <span class="hljs-comment">//sqlSessionFactoryBean.setMapperLocations(new ClassPathResource(&quot;UserDAOMapper.xml&quot;));</span>        <span class="hljs-keyword">try</span> &#123;            ResourcePatternResolver resolver = <span class="hljs-keyword">new</span> PathMatchingResourcePatternResolver();            Resource[] resources = resolver.getResources(mybatisProperties.getMapperLocations());            sqlSessionFactoryBean.setMapperLocations(resources);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> sqlSessionFactoryBean;    &#125;&#125;</code></pre></div><h2 id="6-çº¯æ³¨è§£ç‰ˆäº‹åŠ¡ç¼–ç¨‹"><a href="#6-çº¯æ³¨è§£ç‰ˆäº‹åŠ¡ç¼–ç¨‹" class="headerlink" title="6. çº¯æ³¨è§£ç‰ˆäº‹åŠ¡ç¼–ç¨‹"></a>6. çº¯æ³¨è§£ç‰ˆäº‹åŠ¡ç¼–ç¨‹</h2><div class="hljs code-wrapper"><pre><code class="hljs xml">1. åŸå§‹å¯¹è±¡ XXXService   <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.baizhiedu.service.UserServiceImpl&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDAO&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDAO&quot;</span>/&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>   @Service   public class UserServiceImpl implements UserService&#123;         @Autowired         private UserDAO userDAO;   &#125;2. é¢å¤–åŠŸèƒ½   <span class="hljs-comment">&lt;!--DataSourceTransactionManager--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    @Bean    public DataSourceTransactionManager dataSourceTransactionManager(DataSource dataSource)&#123;          DataSourceTransactionManager dstm = new DataSourceTransactionManager();          dstm.setDataSource(dataSource);          return dstm;     &#125;3. äº‹åŠ¡å±æ€§    @Transactional    @Service    public class UserServiceImpl implements UserService &#123;        @Autowired        private UserDAO userDAO;4. åŸºäºSchemaçš„äº‹åŠ¡é…ç½®    <span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span>   @EnableTransactionManager ---&gt; é…ç½®Bean</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ApplicationContext ctx = new AnnotationConfigApplicationContext(&quot;com.baizhiedu.mybatis&quot;);   SpringBoot å®ç°æ€æƒ³<span class="hljs-bullet">2.</span> æ³¨è§£ç‰ˆMVCæ•´åˆï¼ŒSpringMVCä¸­è¿›è¡Œè¯¦ç»†è®²è§£   SpringMyBatis ---&gt;DAO  äº‹åŠ¡åŸºäºæ³¨è§£ --&gt; Service   Controller    org.springframework.web.context.ContextLoaderListener ---&gt; XMLå·¥å‚ æ— æ³•æä¾› new AnnotationConfigApplicationContext</code></pre></div><h2 id="7-Springæ¡†æ¶ä¸­YMLçš„ä½¿ç”¨"><a href="#7-Springæ¡†æ¶ä¸­YMLçš„ä½¿ç”¨" class="headerlink" title="7. Springæ¡†æ¶ä¸­YMLçš„ä½¿ç”¨"></a>7. Springæ¡†æ¶ä¸­YMLçš„ä½¿ç”¨</h2><h3 id="7-1-ä»€ä¹ˆæ˜¯YML"><a href="#7-1-ä»€ä¹ˆæ˜¯YML" class="headerlink" title="7.1 ä»€ä¹ˆæ˜¯YML"></a>7.1 ä»€ä¹ˆæ˜¯YML</h3><blockquote><p>YML(YAML) æ˜¯ä¸€ç§æ–°å½¢å¼çš„é…ç½®æ–‡ä»¶ï¼Œæ¯” XML æ›´ç®€å•ï¼Œæ¯” Properties æ›´å¼ºå¤§</p></blockquote><h3 id="7-2-Propertiesè¿›è¡Œé…ç½®é—®é¢˜"><a href="#7-2-Propertiesè¿›è¡Œé…ç½®é—®é¢˜" class="headerlink" title="7.2 Propertiesè¿›è¡Œé…ç½®é—®é¢˜"></a>7.2 Propertiesè¿›è¡Œé…ç½®é—®é¢˜</h3><blockquote><ul><li>Properties è¡¨è¾¾è¿‡äºç¹çï¼Œæ— æ³•è¡¨è¾¾æ•°æ®çš„å†…åœ¨è”ç³»</li><li>Properties æ— æ³•è¡¨è¾¾å¯¹è±¡ã€é›†åˆç±»å‹</li></ul></blockquote><h3 id="7-3-YMLè¯­æ³•ç®€ä»‹"><a href="#7-3-YMLè¯­æ³•ç®€ä»‹" class="headerlink" title="7.3 YMLè¯­æ³•ç®€ä»‹"></a>7.3 YMLè¯­æ³•ç®€ä»‹</h3><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">å®šä¹‰ymlæ–‡ä»¶</span>    <span class="hljs-string">xxx.yml</span> <span class="hljs-string">xxx.yaml</span><span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">è¯­æ³•</span>   <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">åŸºæœ¬è¯­æ³•</span>      <span class="hljs-attr">name:</span> <span class="hljs-string">suns</span>      <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>   <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">å¯¹è±¡æ¦‚å¿µ</span>       <span class="hljs-attr">account:</span>          <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>         <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>   <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">å®šä¹‰é›†åˆ</span>       <span class="hljs-attr">service:</span>          <span class="hljs-bullet">-</span> <span class="hljs-number">11111</span>         <span class="hljs-bullet">-</span> <span class="hljs-number">22222</span></code></pre></div><h3 id="7-4-Springä¸YMLé›†æˆæ€è·¯çš„åˆ†æ"><a href="#7-4-Springä¸YMLé›†æˆæ€è·¯çš„åˆ†æ" class="headerlink" title="7.4 Springä¸YMLé›†æˆæ€è·¯çš„åˆ†æ"></a>7.4 Springä¸YMLé›†æˆæ€è·¯çš„åˆ†æ</h3><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å‡†å¤‡ymlé…ç½®æ–‡ä»¶    init.yml   name: suns   password: 123456<span class="hljs-bullet">2.</span> è¯»å–yml è½¬æ¢æˆ Properties   YamlPropertiesFactoryBean.setResources( ymlé…ç½®æ–‡ä»¶çš„è·¯å¾„ new ClassPathResource();)    YamlPropertiesFactoryBean.getObject() ---&gt; Properties <span class="hljs-bullet">3.</span> åº”ç”¨PropertySourcesPlaceholderConfigurer   PropertySourcesPlaceholderConfigurer.setProperties();<span class="hljs-bullet">4.</span> ç±»ä¸­ @Valueæ³¨è§£ æ³¨å…¥</code></pre></div><h3 id="7-5-Springä¸YMLé›†æˆç¼–ç "><a href="#7-5-Springä¸YMLé›†æˆç¼–ç " class="headerlink" title="7.5 Springä¸YMLé›†æˆç¼–ç "></a>7.5 Springä¸YMLé›†æˆç¼–ç </h3><p><strong>ç¯å¢ƒæ­å»º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.yaml<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>snakeyaml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>æœ€ä½ç‰ˆæœ¬ 1.18</code></pre></div><p><strong>ç¼–ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//1. å‡†å¤‡ymlé…ç½®æ–‡ä»¶</span><span class="hljs-comment">//2. é…ç½®Beanä¸­æ“ä½œ å®ŒæˆYAMLè¯»å– ä¸ PropertySourcePlaceholderConfigureçš„åˆ›å»º </span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> PropertySourcesPlaceholderConfigurer <span class="hljs-title">configurer</span><span class="hljs-params">()</span> </span>&#123;YamlPropertiesFactoryBean yamlPropertiesFactoryBean = <span class="hljs-keyword">new</span> YamlPropertiesFactoryBean();      <span class="hljs-comment">//è¯»å–</span>        yamlPropertiesFactoryBean.setResources(<span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">&quot;init.yml&quot;</span>));        Properties properties = yamlPropertiesFactoryBean.getObject();      <span class="hljs-comment">//åˆ›å»ºå¥½é›†åˆ</span>PropertySourcesPlaceholderConfigurer configurer = <span class="hljs-keyword">new</span> PropertySourcesPlaceholderConfigurer();        configurer.setProperties(properties);        <span class="hljs-keyword">return</span> configurer;    &#125;<span class="hljs-comment">//3. ç±» åŠ å…¥ @Valueæ³¨è§£ </span></code></pre></div><h3 id="7-6-Springä¸YMLé›†æˆçš„é—®é¢˜"><a href="#7-6-Springä¸YMLé›†æˆçš„é—®é¢˜" class="headerlink" title="7.6 Springä¸YMLé›†æˆçš„é—®é¢˜"></a>7.6 Springä¸YMLé›†æˆçš„é—®é¢˜</h3><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> é›†åˆå¤„ç†çš„é—®é¢˜   SpringELè¡¨è¾¾å¼è§£å†³   list:111,222,333   @Value(&quot;#&#123;&#x27;$&#123;list&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)<span class="hljs-bullet">2.</span> å¯¹è±¡ç±»å‹çš„YAMLè¿›è¡Œé…ç½®æ—¶ è¿‡äºç¹ç    @Value(&quot;$&#123;account.name&#125;&quot;)<span class="hljs-section"># SpringBootè§£å†³äº†ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ï¼Œåˆ©ç”¨@ConfigurationProperties</span></code></pre></div><h1 id="ç¬¬å…­ç« ã€SpringMVC"><a href="#ç¬¬å…­ç« ã€SpringMVC" class="headerlink" title="ç¬¬å…­ç« ã€SpringMVC"></a>ç¬¬å…­ç« ã€SpringMVC</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><blockquote><p>Spring Web MVC æ˜¯ä¸€ç§åŸºäº Java çš„å®ç°äº† Web MVC è®¾è®¡æ¨¡å¼çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§ Web æ¡†æ¶ï¼Œå³ä½¿ç”¨äº† MVC æ¶æ„æ¨¡å¼çš„æ€æƒ³ï¼Œå°† web å±‚è¿›è¡ŒèŒè´£è§£è€¦ï¼ŒåŸºäºè¯·æ±‚é©±åŠ¨æŒ‡çš„å°±æ˜¯ä½¿ç”¨è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œæ¡†æ¶çš„ç›®çš„å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼€å‘ï¼ŒSpring Web MVC ä¹Ÿæ˜¯è¦ç®€åŒ–æˆ‘ä»¬æ—¥å¸¸ Web å¼€å‘çš„ã€‚åœ¨ ä¼ ç»Ÿçš„ Jsp/Servlet æŠ€æœ¯ä½“ç³»ä¸­ï¼Œå¦‚æœè¦å¼€å‘æ¥å£ï¼Œä¸€ä¸ªæ¥å£å¯¹åº”ä¸€ä¸ª Servletï¼Œä¼šå¯¼è‡´æˆ‘ä»¬å¼€å‘å‡ºè®¸å¤š Servletï¼Œä½¿ç”¨ SpringMVC å¯ä»¥æœ‰æ•ˆçš„ç®€åŒ–è¿™ä¸€æ­¥éª¤</p></blockquote><blockquote><p>Spring Web MVC ä¹Ÿæ˜¯æœåŠ¡åˆ°å·¥ä½œè€…æ¨¡å¼çš„å®ç°ï¼Œä½†è¿›è¡Œå¯ä¼˜åŒ–ã€‚å‰ç«¯æ§åˆ¶å™¨æ˜¯ <code>DispatcherServlet</code>ï¼›åº”ç”¨æ§åˆ¶å™¨å¯ä»¥æ‹†ä¸ºå¤„ç†å™¨æ˜ å°„å™¨<code>(Handler Mapping</code>)è¿›è¡Œå¤„ç†å™¨ç®¡ç†å’Œè§†å›¾è§£æå™¨(<code>View Resolver</code>)è¿›è¡Œè§†å›¾ç®¡ç†ï¼›é¡µé¢æ§åˆ¶å™¨/åŠ¨ä½œ/å¤„ç†å™¨ä¸º Controller æ¥å£ï¼ˆä»…åŒ…å« <code>ModelAndView handleRequest</code>(request, response) æ–¹æ³•ï¼Œä¹Ÿæœ‰äººç§°ä½œ Handlerï¼‰çš„å®ç°ï¼ˆä¹Ÿå¯ä»¥æ˜¯ä»»ä½•çš„ POJO ç±»ï¼‰ï¼›æ”¯æŒæœ¬åœ°åŒ–ï¼ˆLocaleï¼‰è§£æã€ä¸»é¢˜ï¼ˆThemeï¼‰è§£æåŠæ–‡ä»¶ä¸Šä¼ ç­‰ï¼›æä¾›äº†éå¸¸çµæ´»çš„æ•°æ®éªŒè¯ã€æ ¼å¼åŒ–å’Œæ•°æ®ç»‘å®šæœºåˆ¶ï¼›æä¾›äº†å¼ºå¤§çš„çº¦å®šå¤§äºé…ç½®ï¼ˆæƒ¯ä¾‹ä¼˜å…ˆåŸåˆ™ï¼‰çš„å¥‘çº¦å¼ç¼–ç¨‹æ”¯æŒ</p></blockquote><p><strong>Spring Web MVCèƒ½å¸®æˆ‘ä»¬åšä»€ä¹ˆ</strong></p><ul><li>è®©æˆ‘ä»¬èƒ½éå¸¸ç®€å•çš„è®¾è®¡å‡ºå¹²å‡€çš„ Web å±‚å’Œè–„è–„çš„ Web å±‚ï¼›</li><li>è¿›è¡Œæ›´ç®€æ´çš„ Web å±‚çš„å¼€å‘ï¼›</li><li>å¤©ç”Ÿä¸ Spring æ¡†æ¶é›†æˆï¼ˆå¦‚ IoC å®¹å™¨ã€AOP ç­‰ï¼‰ï¼›</li><li>æä¾›å¼ºå¤§çš„çº¦å®šå¤§äºé…ç½®çš„å¥‘çº¦å¼ç¼–ç¨‹æ”¯æŒï¼›</li><li>èƒ½ç®€å•çš„è¿›è¡Œ Web å±‚çš„å•å…ƒæµ‹è¯•ï¼›</li><li>æ”¯æŒçµæ´»çš„ URL åˆ°é¡µé¢æ§åˆ¶å™¨çš„æ˜ å°„ï¼›</li><li>éå¸¸å®¹æ˜“ä¸å…¶ä»–è§†å›¾æŠ€æœ¯é›†æˆï¼Œå¦‚ Velocityã€FreeMarker ç­‰ç­‰ï¼Œå› ä¸ºæ¨¡å‹æ•°æ®ä¸æ”¾åœ¨ç‰¹å®šçš„ API é‡Œï¼Œè€Œæ˜¯æ”¾åœ¨ä¸€ä¸ª Model é‡Œï¼ˆMap æ•°æ®ç»“æ„å®ç°ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«å…¶ä»–æ¡†æ¶ä½¿ç”¨ï¼‰ï¼›</li><li>éå¸¸çµæ´»çš„æ•°æ®éªŒè¯ã€æ ¼å¼åŒ–å’Œæ•°æ®ç»‘å®šæœºåˆ¶ï¼Œèƒ½ä½¿ç”¨ä»»ä½•å¯¹è±¡è¿›è¡Œæ•°æ®ç»‘å®šï¼Œä¸å¿…å®ç°ç‰¹å®šæ¡†æ¶çš„ APIï¼›</li><li>æä¾›ä¸€å¥—å¼ºå¤§çš„ JSP æ ‡ç­¾åº“ï¼Œç®€åŒ– JSP å¼€å‘ï¼›</li><li>æ”¯æŒçµæ´»çš„æœ¬åœ°åŒ–ã€ä¸»é¢˜ç­‰è§£æï¼›</li><li>æ›´åŠ ç®€å•çš„å¼‚å¸¸å¤„ç†ï¼›</li><li>å¯¹é™æ€èµ„æºçš„æ”¯æŒï¼›</li><li>æ”¯æŒ RESTful é£æ ¼</li></ul><h2 id="2-HelloWorld"><a href="#2-HelloWorld" class="headerlink" title="2. HelloWorld"></a>2. HelloWorld</h2><ul><li>åœ¨<code> pom.xml</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  spring-webmvc çš„ä¾èµ–ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><p>æ·»åŠ  <code>spring-webmvc</code> ä¾èµ–ä¹‹åï¼Œ<code>spring-webã€spring-aopã€spring-context</code>ç­‰ç­‰å°±å…¨éƒ¨éƒ½åŠ å…¥è¿›æ¥äº†</p><ul><li>å‡†å¤‡ä¸€ä¸ª Controllerï¼Œå³ä¸€ä¸ªå¤„ç†æµè§ˆå™¨è¯·æ±‚çš„æ¥å£ã€‚</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Controller</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¿™å°±æ˜¯ä¸€ä¸ªè¯·æ±‚å¤„ç†æ¥å£</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req è¿™å°±æ˜¯å‰ç«¯å‘é€æ¥çš„è¯·æ±‚</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp è¿™å°±æ˜¯æœåŠ¡ç«¯ç»™å‰ç«¯çš„å“åº”</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›å€¼æ˜¯ä¸€ä¸ª ModelAndViewï¼ŒModel ç›¸å½“äºæ˜¯æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼ŒView æ˜¯æˆ‘ä»¬çš„è§†å›¾</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">handleRequest</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);        mv.addObject(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> mv;    &#125;&#125;</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬æˆ‘ä»¬åˆ›å»ºå‡ºæ¥çš„ Controller å°±æ˜¯å‰ç«¯è¯·æ±‚å¤„ç†æ¥å£</p><ul><li>åˆ›å»ºè§†å›¾</li></ul><p>è¿™é‡Œæˆ‘ä»¬å°±é‡‡ç”¨ jsp ä½œä¸ºè§†å›¾ï¼Œåœ¨ webapp ç›®å½•ä¸‹åˆ›å»º<code>hello.jsp</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;hello $&#123;name&#125;!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div><ul><li>åœ¨ <code>resources</code> ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code> spring-servlet.xml</code> çš„ springmvc çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ demo ï¼Œå› æ­¤å¯ä»¥å…ˆä¸ç”¨æ·»åŠ  spring çš„é…ç½®</li></ul><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> <span class="hljs-comment">&lt;!--MyControllerå®ä¾‹--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.javaboy.helloworld.MyController&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;/hello&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--è¿™ä¸ªæ˜¯å¤„ç†å™¨æ˜ å°„å™¨ï¼Œè¿™ç§æ–¹å¼ï¼Œè¯·æ±‚åœ°å€å…¶å®å°±æ˜¯ä¸€ä¸ª Bean çš„åå­—ï¼Œç„¶åæ ¹æ®è¿™ä¸ª bean çš„åå­—æŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerMapping&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/hello&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>   <span class="hljs-comment">&lt;!--å¤„ç†é€‚é…å™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerAdapter&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--è§†å›¾è§£æå™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/jsp/&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><ul><li>åŠ è½½ springmvc é…ç½®æ–‡ä»¶</li></ul><p>åœ¨ web é¡¹ç›®å¯åŠ¨æ—¶ï¼ŒåŠ è½½ springmvc é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ˜¯åœ¨ <code>web.xml</code>ä¸­å®Œæˆçš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span></code></pre></div><p>æ‰€æœ‰è¯·æ±‚éƒ½å°†è‡ªåŠ¨æ‹¦æˆªä¸‹æ¥ï¼Œæ‹¦æˆªä¸‹æ¥åï¼Œè¯·æ±‚äº¤ç»™ <code>DispatcherServlet</code> å»å¤„ç†ï¼Œåœ¨åŠ è½½ <code>DispatcherServlet</code> æ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé»˜è®¤çš„è§„åˆ™ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æ”¾åœ¨ <code>webapp/WEB-INF/ </code>ç›®å½•ä¸‹ï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶çš„åå­—ç­‰äº <code>DispatcherServlet</code> çš„åå­—+ <code>-servlet</code>ï¼ˆå³è¿™é‡Œçš„é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯ <code>webapp/WEB-INF/springmvc-servlet.xml</code>ï¼‰ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå¯ä»¥ä¸ç”¨æ·»åŠ <code> init-param</code> å‚æ•°ï¼Œå³ä¸ç”¨æ‰‹åŠ¨é…ç½® springmvc çš„é…ç½®æ–‡ä»¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨åŠ è½½</p><ul><li><p>é…ç½®å¹¶å¯åŠ¨é¡¹ç›®</p></li><li><p>é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæµè§ˆå™¨è¾“å…¥ <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼š</p></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/2-1.png" alt="2-1.png"></p><h2 id="3-SpringMVC-å·¥ä½œæµç¨‹"><a href="#3-SpringMVC-å·¥ä½œæµç¨‹" class="headerlink" title="3. SpringMVC å·¥ä½œæµç¨‹"></a>3. SpringMVC å·¥ä½œæµç¨‹</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3-1.png" alt="3-1.png"></p><ul><li><code>DispatcherServlet</code>ï¼šå‰ç«¯æ§åˆ¶å™¨</li></ul><p>ç”¨æˆ·è¯·æ±‚åˆ°è¾¾å‰ç«¯æ§åˆ¶å™¨ï¼Œå®ƒå°±ç›¸å½“äº mvc æ¨¡å¼ä¸­çš„cï¼ŒDispatcherServlet æ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œç›¸å½“äºæ˜¯ SpringMVC çš„å¤§è„‘ï¼Œç”±å®ƒè°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ŒDispatcherServlet çš„å­˜åœ¨é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><ul><li><code>HandlerMapping</code>ï¼šå¤„ç†å™¨æ˜ å°„å™¨</li></ul><p>HandlerMapping è´Ÿè´£æ ¹æ®ç”¨æˆ·è¯·æ±‚æ‰¾åˆ° Handler å³å¤„ç†å™¨ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ Controllerï¼‰ï¼ŒSpringMVC æä¾›äº†ä¸åŒçš„æ˜ å°„å™¨å®ç°ä¸åŒçš„æ˜ å°„æ–¹å¼ï¼Œä¾‹å¦‚ï¼šé…ç½®æ–‡ä»¶æ–¹å¼ï¼Œå®ç°æ¥å£æ–¹å¼ï¼Œæ³¨è§£æ–¹å¼ç­‰ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ–¹å¼æ˜¯æ³¨è§£æ–¹å¼ã€‚</p><ul><li><code>Handler</code>ï¼šå¤„ç†å™¨</li></ul><p>Handler æ˜¯ç»§ DispatcherServlet å‰ç«¯æ§åˆ¶å™¨çš„åç«¯æ§åˆ¶å™¨ï¼Œåœ¨DispatcherServlet çš„æ§åˆ¶ä¸‹ Handler å¯¹å…·ä½“çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚ç”±äº Handler æ¶‰åŠåˆ°å…·ä½“çš„ç”¨æˆ·ä¸šåŠ¡è¯·æ±‚ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µéœ€è¦ç¨‹åºå‘˜æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘ Handlerã€‚ï¼ˆè¿™é‡Œæ‰€è¯´çš„ Handler å°±æ˜¯æŒ‡æˆ‘ä»¬çš„ Controllerï¼‰</p><ul><li><code>HandlAdapter</code>ï¼šå¤„ç†å™¨é€‚é…å™¨</li></ul><p>é€šè¿‡ HandlerAdapter å¯¹å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ï¼Œé€šè¿‡æ‰©å±•é€‚é…å™¨å¯ä»¥å¯¹æ›´å¤šç±»å‹çš„å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œã€‚</p><ul><li><code>ViewResolver</code>ï¼šè§†å›¾è§£æå™¨</li></ul><p>ViewResolver è´Ÿè´£å°†å¤„ç†ç»“æœç”Ÿæˆ View è§†å›¾ï¼ŒViewResolver é¦–å…ˆæ ¹æ®é€»è¾‘è§†å›¾åè§£ææˆç‰©ç†è§†å›¾åå³å…·ä½“çš„é¡µé¢åœ°å€ï¼Œå†ç”Ÿæˆ View è§†å›¾å¯¹è±¡ï¼Œæœ€åå¯¹ View è¿›è¡Œæ¸²æŸ“å°†å¤„ç†ç»“æœé€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚ SpringMVC æ¡†æ¶æä¾›äº†å¾ˆå¤šçš„ View è§†å›¾ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šjstlViewã€freemarkerViewã€pdfView ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦é€šè¿‡é¡µé¢æ ‡ç­¾æˆ–é¡µé¢æ¨¡ç‰ˆæŠ€æœ¯å°†æ¨¡å‹æ•°æ®é€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ï¼Œéœ€è¦ç”±ç¨‹åºå‘˜æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘å…·ä½“çš„é¡µé¢ã€‚</p><h2 id="4-DispatcherServlet"><a href="#4-DispatcherServlet" class="headerlink" title="4. DispatcherServlet"></a>4. DispatcherServlet</h2><h3 id="4-1-DispatcherServletä½œç”¨"><a href="#4-1-DispatcherServletä½œç”¨" class="headerlink" title="4.1 DispatcherServletä½œç”¨"></a>4.1 DispatcherServletä½œç”¨</h3><p><code>DispatcherServlet </code>æ˜¯å‰ç«¯æ§åˆ¶å™¨è®¾è®¡æ¨¡å¼çš„å®ç°ï¼Œæä¾› Spring Web MVC çš„é›†ä¸­è®¿é—®ç‚¹ï¼Œè€Œä¸”è´Ÿè´£èŒè´£çš„åˆ†æ´¾ï¼Œè€Œä¸”ä¸ Spring IoC å®¹å™¨æ— ç¼é›†æˆï¼Œä»è€Œå¯ä»¥è·å¾— Spring çš„æ‰€æœ‰å¥½å¤„ã€‚<code>DispatcherServlet</code> ä¸»è¦ç”¨ä½œèŒè´£è°ƒåº¦å·¥ä½œï¼Œæœ¬èº«ä¸»è¦ç”¨äºæ§åˆ¶æµç¨‹ï¼Œä¸»è¦èŒè´£å¦‚ä¸‹ï¼š</p><ul><li>æ–‡ä»¶ä¸Šä¼ è§£æï¼Œå¦‚æœè¯·æ±‚ç±»å‹æ˜¯ <code>multipart</code> å°†é€šè¿‡ <code>MultipartResolver</code> è¿›è¡Œæ–‡ä»¶ä¸Šä¼ è§£æï¼›</li><li>é€šè¿‡<code> HandlerMapping</code>ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼ˆè¿”å›ä¸€ä¸ª <code>HandlerExecutionChain</code>ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªå¤„ç†å™¨ã€å¤šä¸ª <code>HandlerInterceptor</code> æ‹¦æˆªå™¨ï¼‰ï¼›</li><li>é€šè¿‡ <code>HandlerAdapter</code> æ”¯æŒå¤šç§ç±»å‹çš„å¤„ç†å™¨(<code>HandlerExecutionChain </code>ä¸­çš„å¤„ç†å™¨)ï¼›</li><li>é€šè¿‡ <code>ViewResolver </code>è§£æé€»è¾‘è§†å›¾ååˆ°å…·ä½“è§†å›¾å®ç°ï¼›</li><li>æœ¬åœ°åŒ–è§£æï¼›</li><li>æ¸²æŸ“å…·ä½“çš„è§†å›¾ç­‰ï¼›</li><li>å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸å°†äº¤ç»™ <code>HandlerExceptionResolver </code>æ¥è§£æ</li></ul><h3 id="4-2-DispathcherServleté…ç½®è¯¦è§£"><a href="#4-2-DispathcherServleté…ç½®è¯¦è§£" class="headerlink" title="4.2 DispathcherServleté…ç½®è¯¦è§£"></a>4.2 DispathcherServleté…ç½®è¯¦è§£</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></code></pre></div><ul><li><code>load-on-startup</code>ï¼šè¡¨ç¤ºå¯åŠ¨å®¹å™¨æ—¶åˆå§‹åŒ–è¯¥ Servletï¼›</li><li><code>url-pattern</code>ï¼šè¡¨ç¤ºå“ªäº›è¯·æ±‚äº¤ç»™ Spring Web MVC å¤„ç†ï¼Œ â€œ/â€ æ˜¯ç”¨æ¥å®šä¹‰é»˜è®¤ servlet æ˜ å°„çš„ã€‚ä¹Ÿå¯ä»¥å¦‚ <code>*.html</code>è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ä»¥ html ä¸ºæ‰©å±•åçš„è¯·æ±‚</li><li><code>contextConfigLocation</code>ï¼šè¡¨ç¤º SpringMVC é…ç½®æ–‡ä»¶çš„è·¯å¾„</li></ul><p>å…¶ä»–çš„å‚æ•°é…ç½®ï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">contextClass</td><td align="left">å®ç°WebApplicationContextæ¥å£çš„ç±»ï¼Œå½“å‰çš„servletç”¨å®ƒæ¥åˆ›å»ºä¸Šä¸‹æ–‡ã€‚å¦‚æœè¿™ä¸ªå‚æ•°æ²¡æœ‰æŒ‡å®šï¼Œ é»˜è®¤ä½¿ç”¨XmlWebApplicationContextã€‚</td></tr><tr><td align="left">contextConfigLocation</td><td align="left">ä¼ ç»™ä¸Šä¸‹æ–‡å®ä¾‹ï¼ˆç”±contextClassæŒ‡å®šï¼‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡å®šä¸Šä¸‹æ–‡çš„ä½ç½®ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«åˆ†æˆå¤šä¸ªå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ æ¥æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ï¼ˆåœ¨å¤šä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœåŒä¸€ä¸ªbeanè¢«å®šä¹‰ä¸¤æ¬¡ï¼Œåé¢ä¸€ä¸ªä¼˜å…ˆï¼‰ã€‚</td></tr><tr><td align="left">namespace</td><td align="left">WebApplicationContextå‘½åç©ºé—´ã€‚é»˜è®¤å€¼æ˜¯[server-name]-servletã€‚</td></tr></tbody></table><h3 id="4-3-Spring-é…ç½®"><a href="#4-3-Spring-é…ç½®" class="headerlink" title="4.3 Spring é…ç½®"></a>4.3 Spring é…ç½®</h3><p>ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œåªæœ‰ SpringMVCï¼Œæ²¡æœ‰ Springï¼ŒWeb é¡¹ç›®ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼ŒSpring å’Œ SpringMVC æ˜¯åˆ†å¼€é…ç½®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹ä¸Šé¢çš„é¡¹ç›®ç»§ç»­è¿›è¡Œå®Œå–„ï¼Œæ·»åŠ  Spring ç›¸å…³é…ç½®ã€‚</p><p>é¦–å…ˆï¼Œé¡¹ç›®æ·»åŠ ä¸€ä¸ª service åŒ…ï¼Œæä¾›ä¸€ä¸ª HelloService ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello &quot;</span> + name;    &#125;&#125;</code></pre></div><p>ç°åœ¨ï¼Œå‡è®¾æˆ‘éœ€è¦å°† HelloService æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­å¹¶ä½¿ç”¨å®ƒï¼Œè¿™ä¸ªæ˜¯å±äº Spring å±‚çš„ Beanï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å°†é™¤äº† Controller ä¹‹å¤–çš„æ‰€æœ‰ Bean æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ï¼Œè€Œå°† Controller æ³¨å†Œåˆ° SpringMVC å®¹å™¨ä¸­ï¼Œç°åœ¨ï¼Œåœ¨ resources ç›®å½•ä¸‹æ·»åŠ  <code>applicationContext.xml </code>ä½œä¸º spring çš„é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.javaboy&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><p>ä½†æ˜¯ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æˆ‘ä»¬åœ¨ web.xml ä¸­å¯¹å…¶è¿›è¡Œé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span></code></pre></div><p>é¦–å…ˆé€šè¿‡ <code>context-param</code> æŒ‡å®š Spring é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¹Ÿæœ‰ä¸€äº›é»˜è®¤è§„åˆ™ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶åé»˜è®¤å°±å« <code>applicationContext.xml </code>ï¼Œå¹¶ä¸”ï¼Œå¦‚æœä½ å°†è¿™ä¸ªé…ç½®æ–‡ä»¶æ”¾åœ¨ WEB-INF ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥ä¸ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®äº†ï¼Œåªéœ€è¦æŒ‡å®šç›‘å¬å™¨å°±å¯ä»¥äº†ã€‚è¿™æ®µé…ç½®æ˜¯ Spring é›†æˆ Web ç¯å¢ƒçš„é€šç”¨é…ç½®ï¼›ä¸€èˆ¬ç”¨äºåŠ è½½é™¤ Web å±‚çš„ Beanï¼ˆå¦‚DAOã€Service ç­‰ï¼‰ï¼Œä»¥ä¾¿äºä¸å…¶ä»–ä»»ä½•Webæ¡†æ¶é›†æˆã€‚</p><ul><li><code>contextConfigLocation</code>ï¼šè¡¨ç¤ºç”¨äºåŠ è½½ Bean çš„é…ç½®æ–‡ä»¶ï¼›</li><li><code>contextClass</code>ï¼šè¡¨ç¤ºç”¨äºåŠ è½½ Bean çš„ <code>ApplicationContext </code>å®ç°ç±»ï¼Œé»˜è®¤<code> WebApplicationContext</code></li></ul><p>é…ç½®å®Œæˆä¹‹åï¼Œè¿˜éœ€è¦ä¿®æ”¹ MyControllerï¼Œåœ¨ MyController ä¸­æ³¨å…¥ HelloSerivce:</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@org</span>.springframework.stereotype.Controller(<span class="hljs-string">&quot;/hello&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Controller</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HelloService helloService;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¿™å°±æ˜¯ä¸€ä¸ªè¯·æ±‚å¤„ç†æ¥å£</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req è¿™å°±æ˜¯å‰ç«¯å‘é€æ¥çš„è¯·æ±‚</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp è¿™å°±æ˜¯æœåŠ¡ç«¯ç»™å‰ç«¯çš„å“åº”</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›å€¼æ˜¯ä¸€ä¸ª ModelAndViewï¼ŒModel ç›¸å½“äºæ˜¯æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼ŒView æ˜¯æˆ‘ä»¬çš„è§†å›¾</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">handleRequest</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(helloService.hello(<span class="hljs-string">&quot;javaboy&quot;</span>));        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);        mv.addObject(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> mv;    &#125;&#125;</code></pre></div><p><strong>æ³¨æ„</strong></p><p>ä¸ºäº†åœ¨ SpringMVC å®¹å™¨ä¸­èƒ½å¤Ÿæ‰«æåˆ°<code> MyController</code> ï¼Œè¿™é‡Œç»™ <code>MyController</code> æ·»åŠ äº† <code>@Controller</code> æ³¨è§£ï¼ŒåŒæ—¶ï¼Œç”±äºæˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„<code>HandlerMapping</code>æ˜¯ <code>BeanNameUrlHandlerMapping</code>ï¼ˆæ„å‘³ç€è¯·æ±‚åœ°å€å°±æ˜¯å¤„ç†å™¨ Bean çš„åå­—ï¼‰ï¼Œæ‰€ä»¥ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æŒ‡å®š<code>MyController</code>çš„åå­—ã€‚</p><p>æœ€åï¼Œä¿®æ”¹ SpringMVC çš„é…ç½®æ–‡ä»¶ï¼Œå°† Bean é…ç½®ä¸ºæ‰«æå½¢å¼ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åªæ‰«æController--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.javaboy.helloworld&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerMapping&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/hello&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerAdapter&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--è§†å›¾è§£æå™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/jsp/&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>é…ç½®å®Œæˆåï¼Œå†æ¬¡å¯åŠ¨é¡¹ç›®ï¼ŒSpring å®¹å™¨ä¹Ÿå°†ä¼šè¢«åˆ›å»ºã€‚è®¿é—® /hello æ¥å£ï¼Œ<code>HelloService</code> ä¸­çš„ hello æ–¹æ³•å°±ä¼šè‡ªåŠ¨è¢«è°ƒç”¨</p><h3 id="4-4-ä¸¤ä¸ªå®¹å™¨"><a href="#4-4-ä¸¤ä¸ªå®¹å™¨" class="headerlink" title="4.4 ä¸¤ä¸ªå®¹å™¨"></a>4.4 ä¸¤ä¸ªå®¹å™¨</h3><p>å½“ Spring å’Œ SpringMVC åŒæ—¶å‡ºç°ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­å°†å­˜åœ¨ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ˜¯ Spring å®¹å™¨ï¼Œå¦ä¸€ä¸ªæ˜¯ SpringMVC å®¹å™¨ï¼ŒSpring å®¹å™¨é€šè¿‡ <code>ContextLoaderListener</code> æ¥åŠ è½½ï¼ŒSpringMVC å®¹å™¨åˆ™é€šè¿‡<code> DispatcherServlet</code> æ¥åŠ è½½ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨ä¸ä¸€æ ·ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5-4-1.png" alt="5-4-1.png"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š</p><ul><li><code>ContextLoaderListener</code> åˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„ Bean æ˜¯å¯¹äºæ•´ä¸ªåº”ç”¨ç¨‹åºå…±äº«çš„ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ä»€ä¹ˆè¡¨ç°å±‚æŠ€æœ¯ï¼Œä¸€èˆ¬å¦‚ DAO å±‚ã€Service å±‚ Beanï¼›</li><li><code>DispatcherServlet</code> åˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„ Bean æ˜¯åªå¯¹ Spring Web MVC æœ‰æ•ˆçš„ Beanï¼Œå¦‚ Controllerã€HandlerMappingã€HandlerAdapter ç­‰ç­‰ï¼Œè¯¥åˆå§‹åŒ–ä¸Šä¸‹æ–‡åº”è¯¥åªåŠ è½½ Webç›¸å…³ç»„ä»¶</li><li>æ‰€ä»¥Controlleré‡Œé¢èƒ½<code>@Autowired</code>Serviceï¼Œè€ŒServiceé‡Œä¸èƒ½<code>@Autowired</code>Controller</li></ul><p><strong>ä¸ºä»€ä¹ˆä¸åœ¨ Spring å®¹å™¨ä¸­æ‰«ææ‰€æœ‰ Beanï¼Ÿ</strong></p><p>è¿™ä¸ªæ˜¯ä¸å¯èƒ½çš„ã€‚å› ä¸ºè¯·æ±‚è¾¾åˆ°æœåŠ¡ç«¯åï¼Œæ‰¾ <code>DispatcherServlet</code> å»å¤„ç†ï¼Œåªä¼šå» SpringMVC å®¹å™¨ä¸­æ‰¾ï¼Œè¿™å°±æ„å‘³ç€ Controller å¿…é¡»åœ¨ SpringMVC å®¹å™¨ä¸­æ‰«æã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸åœ¨ SpringMVC å®¹å™¨ä¸­æ‰«ææ‰€æœ‰ Beanï¼Ÿ</strong></p><p>è¿™ä¸ªæ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥åœ¨ SpringMVC å®¹å™¨ä¸­æ‰«ææ‰€æœ‰ Beanã€‚ä¸å†™åœ¨ä¸€èµ·ï¼Œæœ‰ä¸¤ä¸ªæ–¹é¢çš„åŸå› ï¼š</p><ul><li>ä¸ºäº†æ–¹ä¾¿é…ç½®æ–‡ä»¶çš„ç®¡ç†</li><li>åœ¨ Spring+SpringMVC+Hibernate ç»„åˆä¸­ï¼Œå®é™…ä¸Šä¹Ÿä¸æ”¯æŒè¿™ç§å†™æ³•</li></ul><h2 id="5-å¤„ç†å™¨è¯¦è§£"><a href="#5-å¤„ç†å™¨è¯¦è§£" class="headerlink" title="5. å¤„ç†å™¨è¯¦è§£"></a>5. å¤„ç†å™¨è¯¦è§£</h2><h3 id="5-1-HandlerMapping"><a href="#5-1-HandlerMapping" class="headerlink" title="5.1 HandlerMapping"></a>5.1 HandlerMapping</h3><blockquote><p>æ³¨æ„ï¼Œä¸‹æ–‡æ‰€è¯´çš„å¤„ç†å™¨å³æˆ‘ä»¬å¹³æ—¶æ‰€è§åˆ°çš„ Controller</p></blockquote><p><code>HandlerMapping</code> ï¼Œä¸­æ–‡è¯‘ä½œå¤„ç†å™¨æ˜ å°„å™¨ï¼Œåœ¨ SpringMVC ä¸­ï¼Œç³»ç»Ÿæä¾›äº†å¾ˆå¤š <code>HandlerMapping</code>ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/6-1.png" alt="6-1.png"></p><p><code>HandlerMapping</code> æ˜¯è´Ÿè´£æ ¹æ® request è¯·æ±‚æ‰¾åˆ°å¯¹åº”çš„ Handler å¤„ç†å™¨åŠ Interceptor æ‹¦æˆªå™¨ï¼Œå°†å®ƒä»¬å°è£…åœ¨ <code>HandlerExecutionChain </code>å¯¹è±¡ä¸­è¿”å›ç»™å‰ç«¯æ§åˆ¶å™¨ã€‚</p><ul><li><code>BeanNameUrlHandlerMapping</code></li></ul><p><code>BeanNameUrl</code> å¤„ç†å™¨æ˜ å°„å™¨ï¼Œæ ¹æ®è¯·æ±‚çš„ url ä¸ Spring å®¹å™¨ä¸­å®šä¹‰çš„ bean çš„ name è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œä» Spring å®¹å™¨ä¸­æ‰¾åˆ° bean å®ä¾‹ï¼Œå°±æ˜¯è¯´ï¼Œè¯·æ±‚çš„ Url åœ°å€å°±æ˜¯å¤„ç†å™¨ Bean çš„åå­—ã€‚</p><p>è¿™ä¸ª <code>HandlerMapping</code> é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerMapping&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/hello&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><ul><li><code>SimpleUrlHandlerMapping</code></li></ul><p><code>SimpleUrlHandlerMapping</code> æ˜¯ <code>BeanNameUrlHandlerMapping </code>çš„å¢å¼ºç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥å°† url å’Œå¤„ç†å™¨ bean çš„ id è¿›è¡Œç»Ÿä¸€æ˜ å°„é…ç½®:</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerMapping&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mappings&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;/hello&quot;</span>&gt;</span>myController<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;/hello2&quot;</span>&gt;</span>myController2<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>æ³¨æ„ï¼Œåœ¨ props ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªè¯·æ±‚è·¯å¾„å’Œå¤„ç†å™¨å®ä¾‹çš„æ˜ å°„å…³ç³»</p><h3 id="5-2-HandlerAdapter"><a href="#5-2-HandlerAdapter" class="headerlink" title="5.2 HandlerAdapter"></a>5.2 HandlerAdapter</h3><p><code>HandlerAdapter</code>ï¼Œä¸­æ–‡è¯‘ä½œå¤„ç†å™¨é€‚é…å™¨</p><p><code>HandlerAdapter</code> ä¼šæ ¹æ®é€‚é…å™¨æ¥å£å¯¹åç«¯æ§åˆ¶å™¨è¿›è¡ŒåŒ…è£…ï¼ˆé€‚é…ï¼‰ï¼ŒåŒ…è£…åå³å¯å¯¹å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œï¼Œé€šè¿‡æ‰©å±•å¤„ç†å™¨é€‚é…å™¨å¯ä»¥æ‰§è¡Œå¤šç§ç±»å‹çš„å¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨äº†é€‚é…å™¨è®¾è®¡æ¨¡å¼</p><p>åœ¨ SpringMVC ä¸­ï¼Œ<code>HandlerAdapter</code> ä¹Ÿæœ‰è¯¸å¤šå®ç°ç±»ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/6-2.png" alt="6-2.png"></p><ul><li><code>SimpleControllerHandlerAdapter</code></li></ul><p><code>SimpleControllerHandlerAdapter</code> ç®€å•æ§åˆ¶å™¨å¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰€æœ‰å®ç°äº† <code>org.springframework.web.servlet.mvc.Controller</code> æ¥å£çš„ Bean é€šè¿‡æ­¤é€‚é…å™¨è¿›è¡Œé€‚é…ã€æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¼€å‘çš„æ¥å£æ˜¯é€šè¿‡å®ç° Controller æ¥å£æ¥å®Œæˆçš„ï¼ˆä¸æ˜¯é€šè¿‡æ³¨è§£å¼€å‘çš„æ¥å£ï¼‰ï¼Œé‚£ä¹ˆ HandlerAdapter å¿…é¡»æ˜¯ <code>SimpleControllerHandlerAdapter</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span> /&gt;</span></code></pre></div><ul><li><code>HttpRequestHandlerAdapter</code></li></ul><p><code>HttpRequestHandlerAdapter</code>ï¼Œhttp è¯·æ±‚å¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰€æœ‰å®ç°äº† <code>org.springframework.web.HttpRequestHandler</code> æ¥å£çš„ Bean é€šè¿‡æ­¤é€‚é…å™¨è¿›è¡Œé€‚é…ã€æ‰§è¡Œã€‚</p><p>ä¾‹å¦‚å­˜åœ¨å¦‚ä¸‹æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpRequestHandler</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleRequest</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        System.out.println(<span class="hljs-string">&quot;-----MyController2-----&quot;</span>);    &#125;&#125;&lt;bean <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;</span> id=<span class="hljs-string">&quot;handlerMapping&quot;</span>&gt;    &lt;property name=<span class="hljs-string">&quot;mappings&quot;</span>&gt;        &lt;props&gt;            &lt;prop key=&quot;/hello2&quot;&gt;myController2&lt;/prop&gt;        &lt;/props&gt;    &lt;/property&gt;&lt;/bean&gt;&lt;bean <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter&quot;</span> id=<span class="hljs-string">&quot;handlerAdapter&quot;</span>/&gt;</code></pre></div><h3 id="5-3-æœ€ä½³å®è·µ"><a href="#5-3-æœ€ä½³å®è·µ" class="headerlink" title="5.3 æœ€ä½³å®è·µ"></a>5.3 æœ€ä½³å®è·µ</h3><p>å„ç§æƒ…å†µéƒ½å¤§æ¦‚äº†è§£äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¡¹ç›®ä¸­çš„å…·ä½“å®è·µã€‚</p><ul><li>ç»„ä»¶è‡ªåŠ¨æ‰«æ</li></ul><p>web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä¸å†é€šè¿‡ XML æˆ–è€… Java é…ç½®æ¥åˆ›å»ºä¸€ä¸ª Bean çš„å®ä¾‹ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç»„ä»¶æ‰«ææ¥å®ç° Bean çš„é…ç½®ï¼Œå¦‚æœè¦æ‰«æå¤šä¸ªåŒ…ï¼Œå¤šä¸ªåŒ…ä¹‹é—´ç”¨ , éš”å¼€å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.sang&quot;</span>/&gt;</span></code></pre></div><ul><li><code>HandlerMapping</code></li></ul><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯<code> RequestMappingHandlerMapping</code>ï¼Œè¿™ä¸ªæ˜¯æ ¹æ®å¤„ç†å™¨ä¸­çš„æ³¨è§£ï¼Œæ¥åŒ¹é…è¯·æ±‚ï¼ˆå³<code> @RequestMapping</code> æ³¨è§£ä¸­çš„ url å±æ€§ï¼‰ã€‚å› ä¸ºåœ¨ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡å®ç°ç±»æ¥å¼€å‘æ¥å£çš„ï¼Œç›¸å½“äºè¿˜æ˜¯ä¸€ä¸ªç±»ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>RequestMappingHandlerMapping</code>æ¥åšå¤„ç†å™¨æ˜ å°„å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­å¼€å‘å‡ºå¤šä¸ªæ¥å£</p><ul><li><code>HandlerAdapter</code></li></ul><p>å¯¹äºä¸Šé¢æåˆ°çš„é€šè¿‡ <code>@RequestMapping </code>æ³¨è§£æ‰€å®šä¹‰å‡ºæ¥çš„æ¥å£æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯è¦é€šè¿‡ <code>RequestMappingHandlerAdapter </code>è¿™ä¸ªé€‚é…å™¨æ¥å®ç°</p><p>ä¾‹å¦‚æˆ‘ä»¬å¼€å‘ä¸€ä¸ªæ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController3</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/hello3&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello3&quot;</span>);    &#125;&#125;</code></pre></div><p>è¦èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦ <code>RequestMappingHandlerMapping</code> æ‰èƒ½å®šä½åˆ°éœ€è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œéœ€è¦ <code>RequestMappingHandlerAdapter</code>ï¼Œæ‰èƒ½æ‰§è¡Œå®šä½åˆ°çš„æ–¹æ³•ï¼Œä¿®æ”¹<code> spring-servlet.xml</code> çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.javaboy.helloworld&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--æ‰¾åˆ°æ–¹æ³•--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerMapping&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--æ‰§è¡Œæ–¹æ³•--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;handlerAdapter&quot;</span>/&gt;</span>      <span class="hljs-comment">&lt;!--è§†å›¾è§£æå™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/jsp/&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><p>ç„¶åï¼Œå¯åŠ¨é¡¹ç›®ï¼Œè®¿é—® /hello3 æ¥å£ï¼Œå°±å¯ä»¥çœ‹åˆ°ç›¸åº”çš„é¡µé¢äº†ã€‚</p><ul><li><strong>ç»§ç»­ä¼˜åŒ–</strong></li></ul><p>ç”±äºå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ <code>RequestMappingHandlerMapping </code>å’Œ <code>RequestMappingHandlerAdapter </code>ï¼Œè¿™ä¸¤ä¸ªæœ‰ä¸€ä¸ªç®€åŒ–çš„å†™æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span></code></pre></div><p>å¯ä»¥ç”¨è¿™ä¸€è¡Œé…ç½®ï¼Œä»£æ›¿ <code>RequestMappingHandlerMapping</code> å’Œ <code>RequestMappingHandlerAdapter</code> çš„ä¸¤è¡Œé…ç½®ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.javaboy.helloworld&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span>    <span class="hljs-comment">&lt;!--è§†å›¾è§£æå™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/jsp/&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><p>è®¿é—®æ•ˆæœå’Œä¸Šä¸€æ­¥çš„æ•ˆæœä¸€æ ·ã€‚<strong>è¿™æ˜¯æˆ‘ä»¬å®é™…å¼€å‘ä¸­ï¼Œæœ€ç»ˆé…ç½®çš„å½¢æ€</strong></p><h2 id="6-Controller"><a href="#6-Controller" class="headerlink" title="6. Controller"></a>6. Controller</h2><h3 id="6-1-RequestMapping"><a href="#6-1-RequestMapping" class="headerlink" title="6.1 @RequestMapping"></a>6.1 @RequestMapping</h3><p>è¿™ä¸ªæ³¨è§£ç”¨æ¥æ ‡è®°ä¸€ä¸ªæ¥å£ï¼Œè¿™ç®—æ˜¯æˆ‘ä»¬åœ¨æ¥å£å¼€å‘ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„æ³¨è§£ä¹‹ä¸€</p><h4 id="6-1-1-è¯·æ±‚-URL"><a href="#6-1-1-è¯·æ±‚-URL" class="headerlink" title="6.1.1 è¯·æ±‚ URL"></a>6.1.1 è¯·æ±‚ URL</h4><p>æ ‡è®°è¯·æ±‚ URL å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ç›¸åº”çš„æ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>è¿™é‡Œ<code>@RequestMapping(â€œ/helloâ€)</code>è¡¨ç¤ºå½“è¯·æ±‚åœ°å€ä¸º /hello çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è§¦å‘ã€‚å…¶ä¸­ï¼Œåœ°å€å¯ä»¥æ˜¯å¤šä¸ªï¼Œå°±æ˜¯å¯ä»¥å¤šä¸ªåœ°å€æ˜ å°„åˆ°åŒä¸€ä¸ªæ–¹æ³•ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&#123;&quot;/hello&quot;,&quot;/hello2&quot;&#125;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>è¿™ä¸ªé…ç½®ï¼Œè¡¨ç¤º /hello å’Œ /hello2 éƒ½å¯ä»¥è®¿é—®åˆ°è¯¥æ–¹æ³•</p><h4 id="6-1-2-è¯·æ±‚çª„åŒ–"><a href="#6-1-2-è¯·æ±‚çª„åŒ–" class="headerlink" title="6.1.2 è¯·æ±‚çª„åŒ–"></a>6.1.2 è¯·æ±‚çª„åŒ–</h4><p>åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¼šå­˜åœ¨å¤šä¸ªæ¥å£ï¼Œä¾‹å¦‚è®¢å•ç›¸å…³çš„æ¥å£éƒ½æ˜¯ /order/xxx æ ¼å¼çš„ï¼Œç”¨æˆ·ç›¸å…³çš„æ¥å£éƒ½æ˜¯ /user/xxx æ ¼å¼çš„ã€‚ä¸ºäº†æ–¹ä¾¿å¤„ç†ï¼Œè¿™é‡Œçš„å‰ç¼€ï¼ˆå°±æ˜¯ /orderã€/userï¼‰å¯ä»¥ç»Ÿä¸€åœ¨ Controller ä¸Šé¢å¤„ç†ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&#123;&quot;/hello&quot;,&quot;/hello2&quot;&#125;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>å½“ç±»ä¸ŠåŠ äº† <code>@RequestMapping</code> æ³¨è§£ä¹‹åï¼Œæ­¤æ—¶ï¼Œè¦æƒ³è®¿é—®åˆ° hello ï¼Œåœ°å€å°±åº”è¯¥æ˜¯ <code>/user/hello</code> æˆ–è€… <code>/user/hello2</code></p><h4 id="6-1-3-è¯·æ±‚æ–¹æ³•é™å®š"><a href="#6-1-3-è¯·æ±‚æ–¹æ³•é™å®š" class="headerlink" title="6.1.3 è¯·æ±‚æ–¹æ³•é™å®š"></a>6.1.3 è¯·æ±‚æ–¹æ³•é™å®š</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œå¯ä»¥è¢« GET è¯·æ±‚è®¿é—®åˆ°ï¼Œä¹Ÿå¯ä»¥è¢« POST è¯·æ±‚è®¿é—®åˆ°ï¼Œä½†æ˜¯ DELETE è¯·æ±‚ä»¥åŠ PUT è¯·æ±‚ä¸å¯ä»¥è®¿é—®åˆ°</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„è®¿é—®æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(value = &quot;/hello&quot;,method = RequestMethod.GET)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>é€šè¿‡ <code>@RequestMapping</code> æ³¨è§£ï¼ŒæŒ‡å®šäº†è¯¥æ¥å£åªèƒ½è¢« GET è¯·æ±‚è®¿é—®åˆ°ï¼Œæ­¤æ—¶ï¼Œè¯¥æ¥å£å°±ä¸å¯ä»¥è¢« POST ä»¥åŠè¯·æ±‚è¯·æ±‚è®¿é—®åˆ°äº†ã€‚å¼ºè¡Œè®¿é—®ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/7-1-1.png" alt="7-1-1.png"></p><p>å½“ç„¶ï¼Œé™å®šçš„æ–¹æ³•ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(value = &quot;/hello&quot;,method = &#123;RequestMethod.GET,RequestMethod.POST,RequestMethod.PUT,RequestMethod.DELETE&#125;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>æ­¤æ—¶ï¼Œè¿™ä¸ªæ¥å£å°±å¯ä»¥è¢« GETã€POSTã€PUTã€ä»¥åŠ DELETE è®¿é—®åˆ°äº†ã€‚ä½†æ˜¯ï¼Œç”±äº JSP æ”¯æ”¯æŒ GETã€POST ä»¥åŠ HEAD ï¼Œæ‰€ä»¥è¿™ä¸ªæµ‹è¯•ï¼Œä¸èƒ½ä½¿ç”¨ JSP åšé¡µé¢æ¨¡æ¿ã€‚å¯ä»¥è®²è§†å›¾æ¢æˆå…¶ä»–çš„ï¼Œæˆ–è€…è¿”å› JSONï¼Œè¿™é‡Œå°±ä¸å½±å“äº†ã€‚</p><h3 id="6-2-Controller-æ–¹æ³•çš„è¿”å›å€¼"><a href="#6-2-Controller-æ–¹æ³•çš„è¿”å›å€¼" class="headerlink" title="6.2 Controller æ–¹æ³•çš„è¿”å›å€¼"></a>6.2 Controller æ–¹æ³•çš„è¿”å›å€¼</h3><h4 id="6-2-1-è¿”å›-ModelAndView"><a href="#6-2-1-è¿”å›-ModelAndView" class="headerlink" title="6.2.1 è¿”å› ModelAndView"></a>6.2.1 è¿”å› ModelAndView</h4><p>å¦‚æœæ˜¯å‰åç«¯ä¸åˆ†çš„å¼€å‘ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿”å› <code>ModelAndView</code>ï¼Œå³æ•°æ®æ¨¡å‹+è§†å›¾ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;hello&quot;</span>);        mv.addObject(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;javaboy&quot;</span>);        <span class="hljs-keyword">return</span> mv;    &#125;&#125;</code></pre></div><p>Model ä¸­ï¼Œæ”¾æˆ‘ä»¬çš„æ•°æ®ï¼Œç„¶ååœ¨<code> ModelAndView</code> ä¸­æŒ‡å®šè§†å›¾åç§°ã€‚</p><h4 id="6-2-2-è¿”å›-Void"><a href="#6-2-2-è¿”å›-Void" class="headerlink" title="6.2.2 è¿”å› Void"></a>6.2.2 è¿”å› Void</h4><p>æ²¡æœ‰è¿”å›å€¼ã€‚æ²¡æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸ä¸€å®šçœŸçš„æ²¡æœ‰è¿”å›å€¼ï¼Œåªæ˜¯æ–¹æ³•çš„è¿”å›å€¼ä¸º voidï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ç»™å‰ç«¯è¿”å›ã€‚<strong>å®é™…ä¸Šï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ç†è§£ä¸º Servlet ä¸­çš„é‚£ä¸€å¥—æ–¹æ¡ˆã€‚</strong></p><blockquote><p>æ³¨æ„ï¼Œç”±äºé»˜è®¤çš„ Maven é¡¹ç›®æ²¡æœ‰ Servletï¼Œå› æ­¤è¿™é‡Œéœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªä¾èµ–ï¼š</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><ul><li>é€šè¿‡ <code>HttpServletRequest </code>åšæœåŠ¡ç«¯è·³è½¬</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello2&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello2</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;    req.getRequestDispatcher(<span class="hljs-string">&quot;/jsp/hello.jsp&quot;</span>).forward(req,resp);<span class="hljs-comment">//æœåŠ¡å™¨ç«¯è·³è½¬</span>&#125;</code></pre></div><ul><li>é€šè¿‡ <code>HttpServletResponse</code> åšé‡å®šå‘</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello3&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello3</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    resp.sendRedirect(<span class="hljs-string">&quot;/hello.jsp&quot;</span>);&#125;</code></pre></div><p>ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨æŒ‡å®šå“åº”å¤´å»å®ç°é‡å®šå‘ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello3&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello3</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    resp.setStatus(<span class="hljs-number">302</span>);    resp.addHeader(<span class="hljs-string">&quot;Location&quot;</span>, <span class="hljs-string">&quot;/jsp/hello.jsp&quot;</span>);&#125;</code></pre></div><ul><li>é€šè¿‡ <code>HttpServletResponse</code> ç»™å‡ºå“åº”</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello4&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello4</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    resp.setContentType(<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>);    PrintWriter out = resp.getWriter();    out.write(<span class="hljs-string">&quot;hello javaboy!&quot;</span>);    out.flush();    out.close();&#125;</code></pre></div><p>è¿™ç§æ–¹å¼ï¼Œæ—¢å¯ä»¥è¿”å› JSONï¼Œä¹Ÿå¯ä»¥è¿”å›æ™®é€šå­—ç¬¦ä¸²ã€‚</p><h4 id="6-2-3-è¿”å›å­—ç¬¦ä¸²"><a href="#6-2-3-è¿”å›å­—ç¬¦ä¸²" class="headerlink" title="6.2.3 è¿”å›å­—ç¬¦ä¸²"></a>6.2.3 è¿”å›å­—ç¬¦ä¸²</h4><ul><li><strong>è¿”å›é€»è¾‘è§†å›¾å</strong></li></ul><p>å‰é¢çš„ ModelAndView å¯ä»¥æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒModel å’Œ Viewï¼Œåœ¨ SpringMVC ä¸­ï¼ŒModel æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‚æ•°ä¸­æŒ‡å®šï¼Œç„¶åè¿”å›å€¼æ˜¯é€»è¾‘è§†å›¾åï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello5&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello5</span><span class="hljs-params">(Model model)</span> </span>&#123;    model.addAttribute(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;lucifer&quot;</span>);<span class="hljs-comment">//è¿™æ˜¯æ•°æ®æ¨¡å‹</span>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<span class="hljs-comment">//è¡¨ç¤ºå»æŸ¥æ‰¾ä¸€ä¸ªåä¸º hello çš„è§†å›¾</span>&#125;</code></pre></div><ul><li><strong>æœåŠ¡ç«¯è·³è½¬</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello5&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello5</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;forward:/jsp/hello.jsp&quot;</span>;&#125;</code></pre></div><p>forward åé¢è·Ÿä¸Šè·³è½¬çš„è·¯å¾„ã€‚</p><ul><li><strong>å®¢æˆ·ç«¯è·³è½¬</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello5&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello5</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/hello&quot;</span>;&#125;</code></pre></div><p>è¿™ç§ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æµè§ˆå™¨é‡å®šå‘ã€‚</p><ul><li><strong>çœŸçš„è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</strong></li></ul><p>ä¸Šé¢ä¸‰ä¸ªè¿”å›çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯ç”±ç‰¹æ®Šå«ä¹‰çš„ï¼Œå¦‚æœä¸€å®šè¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªæ³¨æ„ï¼š<code>@ResponseBody</code> ï¼Œè¿™ä¸ªæ³¨è§£è¡¨ç¤ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯è¦å±•ç¤ºå‡ºæ¥è¿”å›å€¼ï¼Œæ²¡æœ‰ç‰¹æ®Šå«ä¹‰ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/hello5&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello5</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/hello&quot;</span>;&#125;</code></pre></div><p>ä¸Šé¢ä»£ç è¡¨ç¤ºå°±æ˜¯æƒ³è¿”å›ä¸€æ®µå†…å®¹ä¸º <code>redirect:/user/hello</code> çš„å­—ç¬¦ä¸²ï¼Œä»–æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¦‚æœå•çº¯çš„è¿”å›ä¸€ä¸ªä¸­æ–‡å­—ç¬¦ä¸²ï¼Œæ˜¯ä¼šä¹±ç çš„ï¼Œå¯ä»¥åœ¨ <code>@RequestMapping</code> ä¸­æ·»åŠ  produces å±æ€§æ¥è§£å†³ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/hello5&quot;,produces = &quot;text/html;charset=utf-8&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello5</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Java è¯­è¨€ç¨‹åºè®¾è®¡&quot;</span>;&#125;</code></pre></div><h3 id="6-3-å‚æ•°ç»‘å®š"><a href="#6-3-å‚æ•°ç»‘å®š" class="headerlink" title="6.3 å‚æ•°ç»‘å®š"></a>6.3 å‚æ•°ç»‘å®š</h3><h4 id="6-3-1-é»˜è®¤æ”¯æŒçš„å‚æ•°ç±»å‹"><a href="#6-3-1-é»˜è®¤æ”¯æŒçš„å‚æ•°ç±»å‹" class="headerlink" title="6.3.1 é»˜è®¤æ”¯æŒçš„å‚æ•°ç±»å‹"></a>6.3.1 é»˜è®¤æ”¯æŒçš„å‚æ•°ç±»å‹</h4><p>é»˜è®¤æ”¯æŒçš„å‚æ•°ç±»å‹ï¼Œå°±æ˜¯å¯ä»¥ç›´æ¥å†™åœ¨<code> @RequestMapping</code> æ‰€æ³¨è§£çš„æ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹ï¼Œä¸€å…±æœ‰å››ç±»ï¼š</p><ul><li><strong>HttpServletRequest</strong></li><li><strong>HttpServletResponse</strong></li><li><strong>HttpSession</strong></li><li><strong>Model/ModelMap</strong></li></ul><p>è¿™å‡ ä¸ªä¾‹å­å¯ä»¥å‚è€ƒä¸Šä¸€å°èŠ‚</p><p>åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸­ï¼Œé»˜è®¤çš„å‚æ•°å°±æ˜¯è¿™å‡ ä¸ªï¼Œå¦‚æœåœ¨æ–¹æ³•ä¸­ï¼Œåˆšå¥½éœ€è¦è¿™å‡ ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠè¿™å‡ ä¸ªå‚æ•°åŠ å…¥åˆ°æ–¹æ³•ä¸­ã€‚</p><h4 id="6-3-2-ç®€å•æ•°æ®ç±»å‹"><a href="#6-3-2-ç®€å•æ•°æ®ç±»å‹" class="headerlink" title="6.3.2 ç®€å•æ•°æ®ç±»å‹"></a>6.3.2 ç®€å•æ•°æ®ç±»å‹</h4><p><code>Integerã€Booleanã€Double </code>ç­‰ç­‰ç®€å•æ•°æ®ç±»å‹ä¹Ÿéƒ½æ˜¯æ”¯æŒçš„ã€‚ä¾‹å¦‚æ·»åŠ ä¸€æœ¬ä¹¦ï¼š</p><p>é¦–å…ˆï¼Œåœ¨ /jsp/ ç›®å½•ä¸‹åˆ›å»º <code>add book.jsp</code> ä½œä¸ºå›¾ä¹¦æ·»åŠ é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=<span class="hljs-string">&quot;/doAdd&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;ä¹¦åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä½œè€…ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;author&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä»·æ ¼ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;price&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;æ˜¯å¦ä¸Šæ¶ï¼š&lt;/td&gt;            &lt;td&gt;                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;æ˜¯                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;false&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;å¦            &lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;           &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;               &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æ·»åŠ &quot;</span>&gt;           &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div><p>åˆ›å»ºæ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨æä¾›ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯è®¿é—® jsp é¡µé¢ï¼Œå¦ä¸€ä¸ªæ˜¯æä¾›æ·»åŠ æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/book&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addBook</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;addbook&quot;</span>;    &#125;    <span class="hljs-meta">@RequestMapping(value = &quot;/doAdd&quot;,method = RequestMethod.POST)</span>    <span class="hljs-meta">@ResponseBody</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAdd</span><span class="hljs-params">(String name,String author,Double price,Boolean ispublic)</span> </span>&#123;        System.out.println(name);        System.out.println(author);        System.out.println(price);        System.out.println(ispublic);    &#125;&#125;</code></pre></div><p>æ³¨æ„ï¼Œç”±äº doAdd æ–¹æ³•ç¡®å®ä¸æƒ³è¿”å›ä»»ä½•å€¼ï¼Œæ‰€ä»¥éœ€è¦ç»™è¯¥æ–¹æ³•æ·»åŠ  <code>@ResponseBody </code>æ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸ç”¨å†å»æŸ¥æ‰¾ç›¸å…³è§†å›¾äº†ã€‚å¦å¤–ï¼Œ POST è¯·æ±‚ä¼ ä¸Šæ¥çš„ä¸­æ–‡ä¼šä¹±ç ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ <code>web.xml</code> ä¸­å†é¢å¤–æ·»åŠ ä¸€ä¸ªç¼–ç è¿‡æ»¤å™¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>forceRequestEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>forceResponseEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span></code></pre></div><p>æœ€åï¼Œæµè§ˆå™¨ä¸­è¾“å…¥ <a href="http://localhost:8080/book">http://localhost:8080/book</a> ï¼Œå°±å¯ä»¥æ‰§è¡Œæ·»åŠ æ“ä½œï¼ŒæœåŠ¡ç«¯ä¼šæ‰“å°å‡ºæ¥ç›¸åº”çš„æ—¥å¿—ã€‚</p><p>åœ¨ä¸Šé¢çš„ç»‘å®šä¸­ï¼Œæœ‰ä¸€ä¸ªè¦æ±‚ï¼Œè¡¨å•ä¸­å­—æ®µçš„ name å±æ€§è¦å’Œæ¥å£ä¸­çš„å˜é‡åä¸€ä¸€å¯¹åº”ï¼Œæ‰èƒ½æ˜ å°„æˆåŠŸï¼Œå¦åˆ™æœåŠ¡ç«¯æ¥æ”¶ä¸åˆ°å‰ç«¯ä¼ æ¥çš„æ•°æ®ã€‚æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬çš„æœåŠ¡ç«¯çš„æ¥å£å˜é‡åå¯èƒ½å’Œå‰ç«¯ä¸ä¸€è‡´ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@RequestParam </code>æ³¨è§£æ¥è§£å†³ã€‚</p><ul><li><code>@RequestParam</code></li></ul><p>è¿™ä¸ªæ³¨è§£çš„çš„åŠŸèƒ½ä¸»è¦æœ‰ä¸‰æ–¹é¢ï¼š</p><ol><li>ç»™å˜é‡å–åˆ«å</li><li>è®¾ç½®å˜é‡æ˜¯å¦å¿…å¡«</li><li>ç»™å˜é‡è®¾ç½®é»˜è®¤å€¼</li></ol><p>å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/doAdd&quot;,method = RequestMethod.POST)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAdd</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;name&quot;)</span> String bookname, String author, Double price, Boolean ispublic)</span> </span>&#123;    System.out.println(bookname);    System.out.println(author);    System.out.println(price);    System.out.println(ispublic);&#125;</code></pre></div><p>æ³¨è§£ä¸­çš„ â€œnameâ€ è¡¨ç¤ºç»™ bookname è¿™ä¸ªå˜é‡å–çš„åˆ«åï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œbookname å°†æ¥æ”¶å‰ç«¯ä¼ æ¥çš„ name è¿™ä¸ªå˜é‡çš„å€¼ã€‚åœ¨è¿™ä¸ªæ³¨è§£ä¸­ï¼Œè¿˜å¯ä»¥æ·»åŠ  <code>required </code>å±æ€§å’Œ <code>defaultValue</code> å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/doAdd&quot;,method = RequestMethod.POST)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAdd</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;name&quot;,required = true,defaultValue = &quot;ä¸‰å›½æ¼”ä¹‰&quot;)</span> String bookname, String author, Double price, Boolean ispublic)</span> </span>&#123;    System.out.println(bookname);    System.out.println(author);    System.out.println(price);    System.out.println(ispublic);&#125;</code></pre></div><p>required å±æ€§é»˜è®¤ä¸º trueï¼Œå³åªè¦æ·»åŠ äº† <code>@RequestParam</code> æ³¨è§£ï¼Œè¿™ä¸ªå‚æ•°é»˜è®¤å°±æ˜¯å¿…å¡«çš„ï¼Œå¦‚æœä¸å¡«ï¼Œè¯·æ±‚æ— æ³•æäº¤ï¼Œä¼šæŠ¥ 400 é”™è¯¯ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸æ˜¯å¿…å¡«é¡¹ï¼Œå¯ä»¥æ‰‹åŠ¨æŠŠ required å±æ€§è®¾ç½®ä¸º falseã€‚ä½†æ˜¯ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº† defaultValueï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå‰ç«¯ä¸ä¼ è¯¥å‚æ•°åˆ°åç«¯ï¼Œå³ä½¿ required å±æ€§ä¸º trueï¼Œå®ƒä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p><h4 id="6-3-3-å®ä½“ç±»"><a href="#6-3-3-å®ä½“ç±»" class="headerlink" title="6.3.3 å®ä½“ç±»"></a>6.3.3 å®ä½“ç±»</h4><p>å‚æ•°é™¤äº†æ˜¯ç®€å•æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥æ˜¯å®ä½“ç±»ã€‚å®é™…ä¸Šï¼Œåœ¨å¼€å‘ä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å®ä½“ç±»ã€‚</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ”¹ç”¨ä¸€ä¸ª Book å¯¹è±¡æ¥æ¥æ”¶å‰ç«¯ä¼ æ¥çš„æ•°æ®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-keyword">private</span> Double price;    <span class="hljs-keyword">private</span> Boolean ispublic;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Book&#123;&quot;</span> +                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, author=&#x27;&quot;</span> + author + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, price=&quot;</span> + price +                <span class="hljs-string">&quot;, ispublic=&quot;</span> + ispublic +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAuthor</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAuthor</span><span class="hljs-params">(String author)</span> </span>&#123;        <span class="hljs-keyword">this</span>.author = author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Double <span class="hljs-title">getPrice</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> price;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrice</span><span class="hljs-params">(Double price)</span> </span>&#123;        <span class="hljs-keyword">this</span>.price = price;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">getIspublic</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> ispublic;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setIspublic</span><span class="hljs-params">(Boolean ispublic)</span> </span>&#123;        <span class="hljs-keyword">this</span>.ispublic = ispublic;    &#125;&#125;</code></pre></div><p>æœåŠ¡ç«¯æ¥æ”¶æ•°æ®æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/doAdd&quot;,method = RequestMethod.POST)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAdd</span><span class="hljs-params">(Book book)</span> </span>&#123;    System.out.println(book);&#125;</code></pre></div><p>å‰ç«¯é¡µé¢ä¼ å€¼çš„æ—¶å€™å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œåªéœ€è¦å†™å±æ€§åå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å†™ book å¯¹è±¡åã€‚</p><p>å½“ç„¶ï¼Œå¯¹è±¡ä¸­å¯èƒ½è¿˜æœ‰å¯¹è±¡ã€‚ä¾‹å¦‚å¦‚ä¸‹å¯¹è±¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Double price;    <span class="hljs-keyword">private</span> Boolean ispublic;    <span class="hljs-keyword">private</span> Author author;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAuthor</span><span class="hljs-params">(Author author)</span> </span>&#123;        <span class="hljs-keyword">this</span>.author = author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Book&#123;&quot;</span> +                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, price=&quot;</span> + price +                <span class="hljs-string">&quot;, ispublic=&quot;</span> + ispublic +                <span class="hljs-string">&quot;, author=&quot;</span> + author +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Double <span class="hljs-title">getPrice</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> price;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrice</span><span class="hljs-params">(Double price)</span> </span>&#123;        <span class="hljs-keyword">this</span>.price = price;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">getIspublic</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> ispublic;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setIspublic</span><span class="hljs-params">(Boolean ispublic)</span> </span>&#123;        <span class="hljs-keyword">this</span>.ispublic = ispublic;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Author</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Author&#123;&quot;</span> +                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, age=&quot;</span> + age +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> age;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;        <span class="hljs-keyword">this</span>.age = age;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;&#125;</code></pre></div><p>Book å¯¹è±¡ä¸­ï¼Œæœ‰ä¸€ä¸ª Author å±æ€§ï¼Œå¦‚ä½•ç»™ Author å±æ€§ä¼ å€¼å‘¢ï¼Ÿå‰ç«¯å†™æ³•å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=<span class="hljs-string">&quot;/doAdd&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;ä¹¦åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä½œè€…å§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;author.name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä½œè€…å¹´é¾„ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;author.age&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä»·æ ¼ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;price&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;æ˜¯å¦ä¸Šæ¶ï¼š&lt;/td&gt;            &lt;td&gt;                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;æ˜¯                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;false&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;å¦            &lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;           &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;               &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æ·»åŠ &quot;</span>&gt;           &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div><p>è¿™æ ·åœ¨åç«¯ç›´æ¥ç”¨ Book å¯¹è±¡å°±å¯ä»¥æ¥æ”¶åˆ°æ‰€æœ‰æ•°æ®äº†ã€‚</p><h4 id="6-3-4-è‡ªå®šä¹‰å‚æ•°ç»‘å®š"><a href="#6-3-4-è‡ªå®šä¹‰å‚æ•°ç»‘å®š" class="headerlink" title="6.3.4 è‡ªå®šä¹‰å‚æ•°ç»‘å®š"></a>6.3.4 è‡ªå®šä¹‰å‚æ•°ç»‘å®š</h4><p>å‰é¢çš„è½¬æ¢ï¼Œéƒ½æ˜¯ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢çš„ï¼Œè¿™ç§è½¬æ¢ä»…é™äºåŸºæœ¬æ•°æ®ç±»å‹ã€‚ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œç³»ç»Ÿæ— æ³•è‡ªåŠ¨è½¬æ¢ï¼Œä¾‹å¦‚æ—¥æœŸã€‚ä¾‹å¦‚å‰ç«¯ä¼ ä¸€ä¸ªæ—¥æœŸåˆ°åç«¯ï¼Œåç«¯ä¸æ˜¯ç”¨å­—ç¬¦ä¸²æ¥æ”¶ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ª Date å¯¹è±¡æ¥æ”¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°å‚æ•°ç±»å‹è½¬æ¢å¤±è´¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰å‚æ•°ç±»å‹è½¬æ¢å™¨ï¼Œå°†æ—¥æœŸå­—ç¬¦ä¸²æ‰‹åŠ¨è½¬ä¸ºä¸€ä¸ª Date å¯¹è±¡ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Date</span>&gt; </span>&#123;    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);      <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">return</span> sdf.parse(source);        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p>åœ¨è‡ªå®šä¹‰çš„å‚æ•°ç±»å‹è½¬æ¢å™¨ä¸­ï¼Œå°†ä¸€ä¸ª String è½¬ä¸º Date å¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†è¿™ä¸ªè½¬æ¢å™¨æ³¨å†Œä¸ºä¸€ä¸ª Beanã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®è¯¥ Beanï¼Œä½¿ä¹‹ç”Ÿæ•ˆã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">conversion-service</span>=<span class="hljs-string">&quot;conversionService&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversionService&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;converters&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;dateConverter&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>é…ç½®å®Œæˆåï¼Œåœ¨æœåŠ¡ç«¯å°±å¯ä»¥æ¥æ”¶å‰ç«¯ä¼ æ¥çš„æ—¥æœŸå‚æ•°äº†ã€‚</p><h4 id="6-3-5-é›†åˆç±»çš„å‚æ•°"><a href="#6-3-5-é›†åˆç±»çš„å‚æ•°" class="headerlink" title="6.3.5 é›†åˆç±»çš„å‚æ•°"></a>6.3.5 é›†åˆç±»çš„å‚æ•°</h4><ul><li><strong>String æ•°ç»„</strong></li></ul><p>String æ•°ç»„å¯ä»¥ç›´æ¥ç”¨æ•°ç»„å»æ¥æ”¶ï¼Œå‰ç«¯ä¼ é€’çš„æ—¶å€™ï¼Œæ•°ç»„çš„ä¼ é€’å…¶å®å°±å¤šç›¸åŒçš„ keyï¼Œè¿™ç§ä¸€èˆ¬ç”¨åœ¨ checkbox ä¸­è¾ƒå¤šã€‚</p><p>ä¾‹å¦‚å‰ç«¯å¢åŠ å…´è¶£çˆ±å¥½ä¸€é¡¹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/doAdd&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;ä¹¦åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä½œè€…å§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;author.name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä½œè€…å¹´é¾„ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;author.age&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å‡ºç”Ÿæ—¥æœŸï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;date&quot; name=&quot;author.birthday&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å…´è¶£çˆ±å¥½ï¼š&lt;/td&gt;            &lt;td&gt;                &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;favorites&quot;</span> value=<span class="hljs-string">&quot;è¶³çƒ&quot;</span>&gt;è¶³çƒ                &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;favorites&quot;</span> value=<span class="hljs-string">&quot;ç¯®çƒ&quot;</span>&gt;ç¯®çƒ                &lt;input type=<span class="hljs-string">&quot;checkbox&quot;</span> name=<span class="hljs-string">&quot;favorites&quot;</span> value=<span class="hljs-string">&quot;ä¹’ä¹“çƒ&quot;</span>&gt;ä¹’ä¹“çƒ            &lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ä»·æ ¼ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;price&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;æ˜¯å¦ä¸Šæ¶ï¼š&lt;/td&gt;            &lt;td&gt;                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;æ˜¯                &lt;input type=<span class="hljs-string">&quot;radio&quot;</span> value=<span class="hljs-string">&quot;false&quot;</span> name=<span class="hljs-string">&quot;ispublic&quot;</span>&gt;å¦            &lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;           &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;               &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æ·»åŠ &quot;</span>&gt;           &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><p>åœ¨æœåŠ¡ç«¯ç”¨ä¸€ä¸ªæ•°ç»„å»æ¥æ”¶ favorites å¯¹è±¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/doAdd&quot;,method = RequestMethod.POST)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAdd</span><span class="hljs-params">(Book book,String[] favorites)</span> </span>&#123;    System.out.println(Arrays.toString(favorites));    System.out.println(book);&#125;</code></pre></div><p>æ³¨æ„ï¼Œå‰ç«¯ä¼ æ¥çš„æ•°ç»„å¯¹è±¡ï¼ŒæœåŠ¡ç«¯ä¸å¯ä»¥ä½¿ç”¨ List é›†åˆå»æ¥æ”¶ã€‚</p><ul><li><strong>List é›†åˆ</strong></li></ul><p>å¦‚æœéœ€è¦ä½¿ç”¨ List é›†åˆæ¥æ”¶å‰ç«¯ä¼ æ¥çš„æ•°æ®ï¼ŒList é›†åˆæœ¬èº«éœ€è¦æ”¾åœ¨ä¸€ä¸ªå°è£…å¯¹è±¡ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒList ä¸­ï¼Œå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚ä¾‹å¦‚æœ‰ä¸€ä¸ªç­çº§ç±»ï¼Œç­çº§é‡Œè¾¹æœ‰å­¦ç”Ÿï¼Œå­¦ç”Ÿæœ‰å¤šä¸ªï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> List&lt;Student&gt; students;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MyClass&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, students=&quot;</span> + students +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Student&gt; <span class="hljs-title">getStudents</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> students;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setStudents</span><span class="hljs-params">(List&lt;Student&gt; students)</span> </span>&#123;        <span class="hljs-keyword">this</span>.students = students;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;&#125;</code></pre></div><p>æ·»åŠ ç­çº§çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ é€’å¤šä¸ª Studentï¼Œå‰ç«¯é¡µé¢å†™æ³•å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/addclass&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;ç­çº§ç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[0].id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[0].name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[1].id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[1].name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;                &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><p>æœåŠ¡ç«¯ç›´æ¥æ¥æ”¶æ•°æ®å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addclass&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addClass</span><span class="hljs-params">(MyClass myClass)</span> </span>&#123;    System.out.println(myClass);&#125;</code></pre></div><ul><li><strong>Map</strong></li></ul><p>ç›¸å¯¹äºå®ä½“ç±»è€Œè¨€ï¼ŒMap æ˜¯ä¸€ç§æ¯”è¾ƒçµæ´»çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œ<strong>Map å¯ç»´æŠ¤æ€§æ¯”è¾ƒå·®ï¼Œå› æ­¤ä¸€èˆ¬ä¸æ¨èä½¿ç”¨</strong>ã€‚</p><p>ä¾‹å¦‚ç»™ä¸Šé¢çš„ç­çº§ç±»æ·»åŠ å…¶ä»–å±æ€§ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> List&lt;Student&gt; students;    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; info;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MyClass&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, students=&quot;</span> + students +                <span class="hljs-string">&quot;, info=&quot;</span> + info +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getInfo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> info;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setInfo</span><span class="hljs-params">(Map&lt;String, Object&gt; info)</span> </span>&#123;        <span class="hljs-keyword">this</span>.info = info;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Student&gt; <span class="hljs-title">getStudents</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> students;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setStudents</span><span class="hljs-params">(List&lt;Student&gt; students)</span> </span>&#123;        <span class="hljs-keyword">this</span>.students = students;    &#125;&#125;</code></pre></div><p>åœ¨å‰ç«¯ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼ç»™ info è¿™ä¸ª Map èµ‹å€¼ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/addclass&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;ç­çº§ç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ç­çº§åç§°ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;info[&#x27;name&#x27;]&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;ç­çº§ä½ç½®ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;info[&#x27;pos&#x27;]&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[0].id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[0].name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[1].id&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;students[1].name&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;                &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><h3 id="6-4-ControllerAdvice"><a href="#6-4-ControllerAdvice" class="headerlink" title="6.4 @ControllerAdvice"></a>6.4 <strong>@ControllerAdvice</strong></h3><p><code>@ControllerAdvice </code>ï¼Œå¾ˆå¤šåˆå­¦è€…å¯èƒ½éƒ½æ²¡æœ‰å¬è¯´è¿‡è¿™ä¸ªæ³¨è§£ï¼Œå®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ³¨è§£ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¢å¼ºçš„ Controllerã€‚ä½¿ç”¨è¿™ä¸ª Controller ï¼Œå¯ä»¥å®ç°ä¸‰ä¸ªæ–¹é¢çš„åŠŸèƒ½ï¼š</p><ul><li>å…¨å±€å¼‚å¸¸å¤„ç†</li><li>å…¨å±€æ•°æ®ç»‘å®š</li><li>å…¨å±€æ•°æ®é¢„å¤„ç†</li></ul><blockquote><p>@ControllerAdviceè¿”å›çš„æ˜¯é¡µé¢ï¼Œå¯¹åº”äº@Controllerï¼›@RestControllerAdviceè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå¯¹åº”äº@RestController</p></blockquote><p>çµæ´»ä½¿ç”¨è¿™ä¸‰ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¾ˆå¤šå·¥ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯ SpringMVC æä¾›çš„åŠŸèƒ½ï¼Œåœ¨ Spring Boot ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸‹é¢åˆ†åˆ«æ¥çœ‹</p><h4 id="6-4-1-å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#6-4-1-å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="6.4.1 å…¨å±€å¼‚å¸¸å¤„ç†"></a>6.4.1 å…¨å±€å¼‚å¸¸å¤„ç†</h4><p>ä½¿ç”¨ <code>@ControllerAdvice </code>å®ç°å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œåªéœ€è¦å®šä¹‰ç±»ï¼Œæ·»åŠ è¯¥æ³¨è§£å³å¯å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyGlobalExceptionHandler</span> </span>&#123;    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">customException</span><span class="hljs-params">(Exception e)</span> </span>&#123;        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView();        mv.addObject(<span class="hljs-string">&quot;message&quot;</span>, e.getMessage());        mv.setViewName(<span class="hljs-string">&quot;myerror&quot;</span>);        <span class="hljs-keyword">return</span> mv;    &#125;&#125;</code></pre></div><p>åœ¨è¯¥ç±»ä¸­ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œä¸åŒçš„æ–¹æ³•å¤„ç†ä¸åŒçš„å¼‚å¸¸ï¼Œä¾‹å¦‚ä¸“é—¨å¤„ç†ç©ºæŒ‡é’ˆçš„æ–¹æ³•ã€ä¸“é—¨å¤„ç†æ•°ç»„è¶Šç•Œçš„æ–¹æ³•â€¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‘ä¸Šé¢ä»£ç ä¸€æ ·ï¼Œåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p><code>@ExceptionHandler</code> æ³¨è§£ç”¨æ¥æŒ‡æ˜å¼‚å¸¸çš„å¤„ç†ç±»å‹ï¼Œå³å¦‚æœè¿™é‡ŒæŒ‡å®šä¸º<code> NullpointerException</code>ï¼Œåˆ™æ•°ç»„è¶Šç•Œå¼‚å¸¸å°±ä¸ä¼šè¿›åˆ°è¿™ä¸ªæ–¹æ³•ä¸­æ¥ã€‚</p><h4 id="6-4-2-å…¨å±€æ•°æ®ç»‘å®š"><a href="#6-4-2-å…¨å±€æ•°æ®ç»‘å®š" class="headerlink" title="6.4.2 å…¨å±€æ•°æ®ç»‘å®š"></a>6.4.2 å…¨å±€æ•°æ®ç»‘å®š</h4><p>å…¨å±€æ•°æ®ç»‘å®šåŠŸèƒ½å¯ä»¥ç”¨æ¥åšä¸€äº›åˆå§‹åŒ–çš„æ•°æ®æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å…¬å…±çš„æ•°æ®å®šä¹‰åœ¨æ·»åŠ äº†<code> @ControllerAdvice</code> æ³¨è§£çš„ç±»ä¸­ï¼Œè¿™æ ·ï¼Œåœ¨æ¯ä¸€ä¸ª Controller çš„æ¥å£ä¸­ï¼Œå°±éƒ½èƒ½å¤Ÿè®¿é—®å¯¼è‡´è¿™äº›æ•°æ®ã€‚</p><p>ä½¿ç”¨æ­¥éª¤ï¼Œé¦–å…ˆå®šä¹‰å…¨å±€æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyGlobalExceptionHandler</span> </span>&#123;    <span class="hljs-meta">@ModelAttribute(name = &quot;md&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">mydata</span><span class="hljs-params">()</span> </span>&#123;        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        map.put(<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">99</span>);        map.put(<span class="hljs-string">&quot;gender&quot;</span>, <span class="hljs-string">&quot;ç”·&quot;</span>);        <span class="hljs-keyword">return</span> map;    &#125;&#125;</code></pre></div><p>ä½¿ç”¨<code>@ModelAttribute</code>æ³¨è§£æ ‡è®°è¯¥æ–¹æ³•çš„è¿”å›æ•°æ®æ˜¯ä¸€ä¸ªå…¨å±€æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå…¨å±€æ•°æ®çš„ key å°±æ˜¯è¿”å›çš„å˜é‡åï¼Œvalue å°±æ˜¯æ–¹æ³•è¿”å›å€¼ï¼Œå½“ç„¶å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>@ModelAttribute</code> æ³¨è§£çš„ name å±æ€§å»é‡æ–°æŒ‡å®š keyã€‚</p><p>å®šä¹‰å®Œæˆåï¼Œåœ¨ä»»ä½•ä¸€ä¸ªController çš„æ¥å£ä¸­ï¼Œéƒ½å¯ä»¥è·å–åˆ°è¿™é‡Œå®šä¹‰çš„æ•°æ®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(Model model)</span> </span>&#123;        Map&lt;String, Object&gt; map = model.asMap();        System.out.println(map);        <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello controller advice&quot;</span>;    &#125;&#125;</code></pre></div><h4 id="6-4-3-å…¨å±€æ•°æ®é¢„å¤„ç†"><a href="#6-4-3-å…¨å±€æ•°æ®é¢„å¤„ç†" class="headerlink" title="6.4.3 å…¨å±€æ•°æ®é¢„å¤„ç†"></a>6.4.3 å…¨å±€æ•°æ®é¢„å¤„ç†</h4><p>è€ƒè™‘æˆ‘æœ‰ä¸¤ä¸ªå®ä½“ç±»ï¼ŒBook å’Œ Authorï¼Œåˆ†åˆ«å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Long price;    <span class="hljs-comment">//getter/setter</span>&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Author</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-comment">//getter/setter</span>&#125;</code></pre></div><p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘å®šä¹‰ä¸€ä¸ªæ•°æ®æ·»åŠ æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/book&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">(Book book, Author author)</span> </span>&#123;    System.out.println(book);    System.out.println(author);&#125;</code></pre></div><p>è¿™ä¸ªæ—¶å€™ï¼Œæ·»åŠ æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºä¸¤ä¸ªå®ä½“ç±»éƒ½æœ‰ä¸€ä¸ª name å±æ€§ï¼Œä»å‰ç«¯ä¼ é€’æ—¶ ï¼Œæ— æ³•åŒºåˆ†ã€‚æ­¤æ—¶ï¼Œé€šè¿‡<code>@ControllerAdvice</code>çš„å…¨å±€æ•°æ®é¢„å¤„ç†å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>è§£å†³æ­¥éª¤å¦‚ä¸‹:</p><p>1.ç»™æ¥å£ä¸­çš„å˜é‡å–åˆ«å</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/book&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute(&quot;b&quot;)</span> Book book, <span class="hljs-meta">@ModelAttribute(&quot;a&quot;)</span> Author author)</span> </span>&#123;    System.out.println(book);    System.out.println(author);&#125;</code></pre></div><p>2.è¿›è¡Œè¯·æ±‚æ•°æ®é¢„å¤„ç†<br>åœ¨<code>@ControllerAdvice</code>æ ‡è®°çš„ç±»ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç :</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@InitBinder(&quot;b&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">b</span><span class="hljs-params">(WebDataBinder binder)</span> </span>&#123;    binder.setFieldDefaultPrefix(<span class="hljs-string">&quot;b.&quot;</span>);&#125;<span class="hljs-meta">@InitBinder(&quot;a&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">a</span><span class="hljs-params">(WebDataBinder binder)</span> </span>&#123;    binder.setFieldDefaultPrefix(<span class="hljs-string">&quot;a.&quot;</span>);&#125;</code></pre></div><p><code>@InitBinder(â€œbâ€)</code> æ³¨è§£è¡¨ç¤ºè¯¥æ–¹æ³•ç”¨æ¥å¤„ç†å’ŒBookå’Œç›¸å…³çš„å‚æ•°,åœ¨æ–¹æ³•ä¸­,ç»™å‚æ•°æ·»åŠ ä¸€ä¸ª b å‰ç¼€,å³è¯·æ±‚å‚æ•°è¦æœ‰bå‰ç¼€.</p><p>3.å‘é€è¯·æ±‚</p><p>è¯·æ±‚å‘é€æ—¶,é€šè¿‡ç»™ä¸åŒå¯¹è±¡çš„å‚æ•°æ·»åŠ ä¸åŒçš„å‰ç¼€,å¯ä»¥å®ç°å‚æ•°çš„åŒºåˆ†.</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5-1.png" alt="img"></p><h4 id="6-3-4-æ€»ç»“"><a href="#6-3-4-æ€»ç»“" class="headerlink" title="6.3.4 æ€»ç»“"></a>6.3.4 æ€»ç»“</h4><p>è¿™å°±æ˜¯ <code>@ControllerAdvice </code>çš„å‡ ä¸ªç®€å•ç”¨æ³•ï¼Œè¿™äº›ç‚¹æ—¢å¯ä»¥åœ¨ä¼ ç»Ÿçš„ SSM é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ Spring Boot + Spring Cloud å¾®æœåŠ¡ä¸­ä½¿ç”¨</p><h2 id="7-æ–‡ä»¶ä¸Šä¼ "><a href="#7-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="7. æ–‡ä»¶ä¸Šä¼ "></a>7. æ–‡ä»¶ä¸Šä¼ </h2><p>SpringMVC ä¸­å¯¹æ–‡ä»¶ä¸Šä¼ åšäº†å°è£…ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„å®ç°æ–‡ä»¶ä¸Šä¼ ã€‚ä» Spring3.1 å¼€å§‹ï¼Œå¯¹äºæ–‡ä»¶ä¸Šä¼ ï¼Œæä¾›äº†ä¸¤ä¸ªå¤„ç†å™¨ï¼š</p><ul><li><strong>CommonsMultipartResolver</strong></li><li><strong>StandardServletMultipartResolver</strong></li></ul><p>ç¬¬ä¸€ä¸ªå¤„ç†å™¨å…¼å®¹æ€§è¾ƒå¥½ï¼Œå¯ä»¥å…¼å®¹ Servlet3.0 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯å®ƒä¾èµ–äº†<code>commons-fileupload</code>è¿™ä¸ªç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨è¿™ä¸ªï¼Œä¸€å®šè¦æ·»åŠ  <code>commons-fileupload </code>ä¾èµ–</p><p>ç¬¬äºŒä¸ªå¤„ç†å™¨å…¼å®¹æ€§è¾ƒå·®ï¼Œå®ƒé€‚ç”¨äº Servlet3.0 ä¹‹åçš„ç‰ˆæœ¬ï¼Œå®ƒä¸ä¾èµ–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä½¿ç”¨å®ƒï¼Œå¯ä»¥ç›´æ¥åšæ–‡ä»¶ä¸Šä¼ </p><h3 id="7-1-CommonsMultipartResolver"><a href="#7-1-CommonsMultipartResolver" class="headerlink" title="7.1 CommonsMultipartResolver"></a>7.1 CommonsMultipartResolver</h3><p>ä½¿ç”¨<code> CommonsMultipartResolver</code> åšæ–‡ä»¶ä¸Šä¼ ï¼Œéœ€è¦é¦–å…ˆæ·»åŠ  <code>commons-fileupload </code>ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶åï¼Œåœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½® <code>MultipartResolver</code>ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;multipartResolver&quot;</span>/&gt;</span></code></pre></div><p><strong>æ³¨æ„ï¼Œè¿™ä¸ª Bean ä¸€å®šè¦æœ‰ idï¼Œå¹¶ä¸” id å¿…é¡»æ˜¯ <code>multipartResolver</code></strong></p><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»º jsp é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/upload&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span>&gt;    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;&lt;/form&gt;</code></pre></div><p>æ³¨æ„æ–‡ä»¶ä¸Šä¼ è¯·æ±‚æ˜¯ POST è¯·æ±‚ï¼Œ<code>enctype</code> ä¸€å®šæ˜¯<code> multipart/form-data</code>ï¼ŒåŒæ—¶<code>MultipartFile file</code>çš„<code>file</code>è¦å’Œjspä¸­çš„ä¸€è‡´</p><p>ç„¶åï¼Œå¼€å‘æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadController</span> </span>&#123;    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;/yyyy/MM/dd/&quot;</span>);    <span class="hljs-meta">@RequestMapping(&quot;/upload&quot;)</span>    <span class="hljs-meta">@ResponseBody</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file, HttpServletRequest req)</span> </span>&#123;      <span class="hljs-comment">//1.å‡†å¤‡æ–‡ä»¶å¤¹</span>        String format = sdf.format(<span class="hljs-keyword">new</span> Date());        String realPath = req.getServletContext().getRealPath(<span class="hljs-string">&quot;/img&quot;</span>) + format;        File folder = <span class="hljs-keyword">new</span> File(realPath);        <span class="hljs-keyword">if</span> (!folder.exists()) &#123;            folder.mkdirs();        &#125;      <span class="hljs-comment">//2.å‡†å¤‡æ–‡ä»¶å</span>        String oldName = file.getOriginalFilename();        String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));      <span class="hljs-comment">//3.å­˜å‚¨</span>        <span class="hljs-keyword">try</span> &#123;            file.transferTo(<span class="hljs-keyword">new</span> File(folder, newName));        <span class="hljs-comment">//4.ç»„è£…url</span>            String url = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + <span class="hljs-string">&quot;/img&quot;</span> + format + newName;            <span class="hljs-keyword">return</span> url;        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;failed&quot;</span>;    &#125;&#125;</code></pre></div><p>è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ æ–¹æ³•ä¸­ï¼Œä¸€å…±åšäº†å››ä»¶äº‹ï¼š</p><ul><li>è§£å†³æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œè¿™é‡Œæ˜¯ä¿å­˜åœ¨é¡¹ç›®è¿è¡Œç›®å½•ä¸‹çš„ img ç›®å½•ä¸‹ï¼Œç„¶ååˆ©ç”¨æ—¥æœŸç»§ç»­å®åˆ†ç±»</li><li>å¤„ç†æ–‡ä»¶åé—®é¢˜ï¼Œä½¿ç”¨ UUID åšæ–°çš„æ–‡ä»¶åï¼Œç”¨æ¥ä»£æ›¿æ—§çš„æ–‡ä»¶åï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢æ–‡ä»¶åå†²çª</li><li>ä¿å­˜æ–‡ä»¶</li><li>ç”Ÿæˆæ–‡ä»¶è®¿é—®è·¯å¾„</li></ul><blockquote><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œåœ¨ SpringMVC ä¸­ï¼Œé™æ€èµ„æºé»˜è®¤éƒ½æ˜¯è¢«è‡ªåŠ¨æ‹¦æˆªçš„ï¼Œæ— æ³•è®¿é—®ï¼Œæ„å‘³ç€ä¸Šä¼ æˆåŠŸçš„å›¾ç‰‡æ— æ³•è®¿é—®ï¼Œå› æ­¤ï¼Œè¿˜éœ€è¦æˆ‘ä»¬åœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå†æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/&quot;</span>/&gt;</span></code></pre></div><p>å®Œæˆä¹‹åï¼Œå°±å¯ä»¥è®¿é—® jsp é¡µé¢ï¼Œåšæ–‡ä»¶ä¸Šä¼ äº†</p><p>å½“ç„¶ï¼Œé»˜è®¤çš„é…ç½®ä¸ä¸€å®šæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±æ‰‹åŠ¨é…ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°ç­‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;multipartResolver&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--é»˜è®¤çš„ç¼–ç --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultEncoding&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--ä¸Šä¼ çš„æ€»æ–‡ä»¶å¤§å°--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxUploadSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1048576&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--ä¸Šä¼ çš„å•ä¸ªæ–‡ä»¶å¤§å°--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxUploadSizePerFile&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1048576&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--å†…å­˜ä¸­æœ€å¤§çš„æ•°æ®é‡ï¼Œè¶…è¿‡è¿™ä¸ªæ•°æ®é‡ï¼Œæ•°æ®å°±è¦å¼€å§‹å¾€ç¡¬ç›˜ä¸­å†™äº†--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxInMemorySize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;4096&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!--ä¸´æ—¶ç›®å½•ï¼Œè¶…è¿‡ maxInMemorySize é…ç½®çš„å¤§å°åï¼Œæ•°æ®å¼€å§‹å¾€ä¸´æ—¶ç›®å½•å†™ï¼Œç­‰å…¨éƒ¨ä¸Šä¼ å®Œæˆåï¼Œå†å°†æ•°æ®åˆå¹¶åˆ°æ­£å¼çš„æ–‡ä»¶ä¸Šä¼ ç›®å½•--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;uploadTempDir&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;file:///E:\\tmp&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h3 id="7-2-StandardServletMultipartResolver"><a href="#7-2-StandardServletMultipartResolver" class="headerlink" title="7.2 StandardServletMultipartResolver"></a>7.2 StandardServletMultipartResolver</h3><p>è¿™ç§æ–‡ä»¶ä¸Šä¼ æ–¹å¼ï¼Œä¸éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹ jarï¼ˆä¸»è¦æ˜¯ä¸éœ€è¦æ·»åŠ <code>commons-fileupload</code>è¿™ä¸ªä¾èµ–ï¼‰ï¼Œä½†æ˜¯ä¹Ÿä¸æ”¯æŒ Servlet3.0 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p><p>ä½¿ç”¨ <code>StandardServletMultipartResolver</code> ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆåœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®è¿™ä¸ª Bean</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;multipartResolver&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p><strong>æ³¨æ„ï¼Œè¿™é‡Œ Bean çš„åå­—ä¾ç„¶å«<code> multipartResolver</code></strong></p><p>é…ç½®å®Œæˆåï¼Œæ³¨æ„ï¼Œè¿™ä¸ª Bean æ— æ³•ç›´æ¥é…ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°ç­‰é™åˆ¶ã€‚éœ€è¦åœ¨<code>web.xml</code>ä¸­è¿›è¡Œé…ç½®ï¼ˆè¿™é‡Œï¼Œå³ä½¿ä¸éœ€è¦é™åˆ¶æ–‡ä»¶ä¸Šä¼ å¤§å°ï¼Œä¹Ÿéœ€è¦åœ¨ <code>web.xml </code>ä¸­é…ç½® <code>multipart-config</code>ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">multipart-config</span>&gt;</span>        <span class="hljs-comment">&lt;!--æ–‡ä»¶ä¿å­˜çš„ä¸´æ—¶ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç³»ç»Ÿä¸ä¼šä¸»åŠ¨åˆ›å»º--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">location</span>&gt;</span>E:\\temp<span class="hljs-tag">&lt;/<span class="hljs-name">location</span>&gt;</span>        <span class="hljs-comment">&lt;!--ä¸Šä¼ çš„å•ä¸ªæ–‡ä»¶å¤§å°--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">max-file-size</span>&gt;</span>1048576<span class="hljs-tag">&lt;/<span class="hljs-name">max-file-size</span>&gt;</span>        <span class="hljs-comment">&lt;!--ä¸Šä¼ çš„æ€»æ–‡ä»¶å¤§å°--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">max-request-size</span>&gt;</span>1048576<span class="hljs-tag">&lt;/<span class="hljs-name">max-request-size</span>&gt;</span>        <span class="hljs-comment">&lt;!--è¿™ä¸ªå°±æ˜¯å†…å­˜ä¸­ä¿å­˜çš„æ–‡ä»¶æœ€å¤§å¤§å°--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">file-size-threshold</span>&gt;</span>4096<span class="hljs-tag">&lt;/<span class="hljs-name">file-size-threshold</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">multipart-config</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></code></pre></div><p>é…ç½®å®Œæˆåï¼Œå°±å¯ä»¥æµ‹è¯•æ–‡ä»¶ä¸Šä¼ äº†ï¼Œæµ‹è¯•æ–¹å¼å’Œä¸Šé¢ä¸€æ ·ã€‚</p><h3 id="7-3-å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#7-3-å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="7.3 å¤šæ–‡ä»¶ä¸Šä¼ "></a>7.3 å¤šæ–‡ä»¶ä¸Šä¼ </h3><p>å¤šæ–‡ä»¶ä¸Šä¼ åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ key ç›¸åŒçš„æ–‡ä»¶ï¼Œå¦ä¸€ç§æ˜¯ key ä¸åŒçš„æ–‡ä»¶ã€‚</p><h4 id="8-3-1-key-ç›¸åŒçš„æ–‡ä»¶"><a href="#8-3-1-key-ç›¸åŒçš„æ–‡ä»¶" class="headerlink" title="8.3.1 key ç›¸åŒçš„æ–‡ä»¶"></a>8.3.1 key ç›¸åŒçš„æ–‡ä»¶</h4><p>è¿™ç§ä¸Šä¼ ï¼Œå‰ç«¯é¡µé¢ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/upload2&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;files&quot;</span> <span class="hljs-attr">multiple</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>ä¸»è¦æ˜¯ input èŠ‚ç‚¹ä¸­å¤šäº† <code>multiple</code> å±æ€§ã€‚åç«¯ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¥æ”¶æ–‡ä»¶å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/upload2&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">upload2</span><span class="hljs-params">(MultipartFile[] files, HttpServletRequest req)</span> </span>&#123;    String format = sdf.format(<span class="hljs-keyword">new</span> Date());    String realPath = req.getServletContext().getRealPath(<span class="hljs-string">&quot;/img&quot;</span>) + format;    File folder = <span class="hljs-keyword">new</span> File(realPath);    <span class="hljs-keyword">if</span> (!folder.exists()) &#123;        folder.mkdirs();    &#125;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-keyword">for</span> (MultipartFile file : files) &#123;            String oldName = file.getOriginalFilename();            String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));            file.transferTo(<span class="hljs-keyword">new</span> File(folder, newName));            String url = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + <span class="hljs-string">&quot;/img&quot;</span> + format + newName;            System.out.println(url);        &#125;    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><h4 id="8-3-2-key-ä¸åŒçš„æ–‡ä»¶"><a href="#8-3-2-key-ä¸åŒçš„æ–‡ä»¶" class="headerlink" title="8.3.2 key ä¸åŒçš„æ–‡ä»¶"></a>8.3.2 key ä¸åŒçš„æ–‡ä»¶</h4><p>key ä¸åŒçš„ï¼Œä¸€èˆ¬å‰ç«¯å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/upload3&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file1&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file2&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>è¿™ç§ï¼Œåœ¨åç«¯ç”¨ä¸åŒçš„å˜é‡æ¥æ¥æ”¶å°±è¡Œäº†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/upload3&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">upload3</span><span class="hljs-params">(MultipartFile file1, MultipartFile file2, HttpServletRequest req)</span> </span>&#123;    String format = sdf.format(<span class="hljs-keyword">new</span> Date());    String realPath = req.getServletContext().getRealPath(<span class="hljs-string">&quot;/img&quot;</span>) + format;    File folder = <span class="hljs-keyword">new</span> File(realPath);    <span class="hljs-keyword">if</span> (!folder.exists()) &#123;        folder.mkdirs();    &#125;    <span class="hljs-keyword">try</span> &#123;        String oldName = file1.getOriginalFilename();        String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));        file1.transferTo(<span class="hljs-keyword">new</span> File(folder, newName));        String url1 = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + <span class="hljs-string">&quot;/img&quot;</span> + format + newName;        System.out.println(url1);        String oldName2 = file2.getOriginalFilename();        String newName2 = UUID.randomUUID().toString() + oldName2.substring(oldName2.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));        file2.transferTo(<span class="hljs-keyword">new</span> File(folder, newName2));        String url2 = req.getScheme() + <span class="hljs-string">&quot;://&quot;</span> + req.getServerName() + <span class="hljs-string">&quot;:&quot;</span> + req.getServerPort() + <span class="hljs-string">&quot;/img&quot;</span> + format + newName2;        System.out.println(url2);    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><h2 id="8-å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#8-å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="8. å…¨å±€å¼‚å¸¸å¤„ç†"></a>8. å…¨å±€å¼‚å¸¸å¤„ç†</h2><p>é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šæŠ›å‡ºå¤šä¸ªå¼‚å¸¸ï¼Œæˆ‘ä»¬ä¸å¯ä»¥ç›´æ¥å°†å¼‚å¸¸çš„å †æ ˆä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·ï¼Œæœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>ç”¨æˆ·ä½“éªŒä¸å¥½</li><li>éå¸¸ä¸å®‰å…¨</li></ul><p>æ‰€ä»¥ï¼Œé’ˆå¯¹å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼ŒSpringMVC ä¸­ï¼Œé’ˆå¯¹å…¨å±€å¼‚å¸¸ä¹Ÿæä¾›äº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>@ControllerAdvice</code> å’Œ <code>@ExceptionHandler </code>ä¸¤ä¸ªæ³¨è§£æ¥å¤„ç†çš„ã€‚</p><p>ä»¥ç¬¬å…«èŠ‚çš„æ–‡ä»¶ä¸Šä¼ å¤§å°è¶…å‡ºé™åˆ¶ä¸ºä¾‹ï¼Œè‡ªå®šä¹‰å¼‚å¸¸ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç±»å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><span class="hljs-comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ Controllerï¼Œä¸»è¦ç”¨æ¥åšå…¨å±€æ•°æ®å¤„ç†</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyException</span> </span>&#123;    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">fileuploadException</span><span class="hljs-params">(Exception e)</span> </span>&#123;        ModelAndView error = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;error&quot;</span>);        error.addObject(<span class="hljs-string">&quot;error&quot;</span>, e.getMessage());        <span class="hljs-keyword">return</span> error;    &#125;&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼š</p><ul><li><code>@ControllerAdvice</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ Controllerï¼Œä¸»è¦ç”¨æ¥åšå…¨å±€æ•°æ®å¤„ç†</li><li><code>@ExceptionHandler</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œè¿™ä¸ªæ³¨è§£çš„å‚æ•°ï¼Œè¡¨ç¤ºéœ€è¦æ‹¦æˆªçš„å¼‚å¸¸ï¼Œå‚æ•°ä¸º Exception è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰å¼‚å¸¸ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å…·ä½“åˆ°æŸä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœå…·ä½“åˆ°æŸä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆå‘ç”Ÿäº†å…¶ä»–å¼‚å¸¸åˆ™ä¸ä¼šè¢«æ‹¦æˆªåˆ°ã€‚</li><li>å¼‚å¸¸æ–¹æ³•çš„å®šä¹‰ï¼Œå’Œ Controller ä¸­æ–¹æ³•çš„å®šä¹‰ä¸€æ ·ï¼Œå¯ä»¥è¿”å› <code>ModelAndview</code>ï¼Œä¹Ÿå¯ä»¥è¿”å› String æˆ–è€… void</li></ul><p>ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼ŒæŒ‡æŒ¥æ‹¦æˆªæ–‡ä»¶ä¸Šä¼ å¼‚å¸¸ï¼Œå…¶ä»–å¼‚å¸¸å’Œå®ƒæ²¡å…³ç³»ï¼Œä¸ä¼šè¿›å…¥åˆ°è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†çš„æ–¹æ³•ä¸­æ¥ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><span class="hljs-comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ Controllerï¼Œä¸»è¦ç”¨æ¥åšå…¨å±€æ•°æ®å¤„ç†</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyException</span> </span>&#123;    <span class="hljs-meta">@ExceptionHandler(MaxUploadSizeExceededException.class)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">fileuploadException</span><span class="hljs-params">(MaxUploadSizeExceededException e)</span> </span>&#123;        ModelAndView error = <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">&quot;error&quot;</span>);        error.addObject(<span class="hljs-string">&quot;error&quot;</span>, e.getMessage());        <span class="hljs-keyword">return</span> error;    &#125;&#125;</code></pre></div><h2 id="9-æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"><a href="#9-æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ" class="headerlink" title="9. æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"></a>9. æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ</h2><p>B/S ç³»ç»Ÿä¸­å¯¹ http è¯·æ±‚æ•°æ®çš„æ ¡éªŒå¤šæ•°åœ¨å®¢æˆ·ç«¯è¿›è¡Œï¼Œè¿™ä¹Ÿæ˜¯å‡ºäºç®€å•åŠç”¨æˆ·ä½“éªŒæ€§ä¸Šè€ƒè™‘ï¼Œä½†æ˜¯åœ¨ä¸€äº›å®‰å…¨æ€§è¦æ±‚é«˜çš„ç³»ç»Ÿä¸­æœåŠ¡ç«¯æ ¡éªŒæ˜¯ä¸å¯ç¼ºå°‘çš„ï¼Œå®é™…ä¸Šï¼Œå‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿï¼Œå‡¡æ˜¯æ¶‰åŠåˆ°æ•°æ®æ ¡éªŒï¼Œéƒ½éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡ŒäºŒæ¬¡æ ¡éªŒã€‚ä¸ºä»€ä¹ˆè¦åœ¨æœåŠ¡ç«¯è¿›è¡ŒäºŒæ¬¡æ ¡éªŒå‘¢ï¼Ÿè¿™éœ€è¦ç†è§£å®¢æˆ·ç«¯æ ¡éªŒå’ŒæœåŠ¡ç«¯æ ¡éªŒå„è‡ªçš„ç›®çš„ã€‚</p><ol><li>å®¢æˆ·ç«¯æ ¡éªŒï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œä¾‹å¦‚ç”¨æˆ·è¾“å…¥ä¸€ä¸ªé‚®ç®±åœ°å€ï¼Œè¦æ ¡éªŒè¿™ä¸ªé‚®ç®±åœ°å€æ˜¯å¦åˆæ³•ï¼Œæ²¡æœ‰å¿…è¦å‘é€åˆ°æœåŠ¡ç«¯è¿›è¡Œæ ¡éªŒï¼Œç›´æ¥åœ¨å‰ç«¯ç”¨ js è¿›è¡Œæ ¡éªŒå³å¯ã€‚ä½†æ˜¯å¤§å®¶éœ€è¦æ˜ç™½çš„æ˜¯ï¼Œå‰ç«¯æ ¡éªŒæ— æ³•ä»£æ›¿åç«¯æ ¡éªŒï¼Œå‰ç«¯æ ¡éªŒå¯ä»¥æœ‰æ•ˆçš„æé«˜ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯æ— æ³•ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œå› ä¸ºåœ¨ B/S æ¶æ„ä¸­ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„æ‹¿åˆ°è¯·æ±‚åœ°å€ï¼Œç„¶åç›´æ¥å‘é€è¯·æ±‚ï¼Œä¼ é€’éæ³•å‚æ•°ã€‚</li><li>æœåŠ¡ç«¯æ ¡éªŒï¼Œè™½ç„¶ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œä½†æ˜¯å¯ä»¥æœ‰æ•ˆçš„ä¿è¯æ•°æ®å®‰å…¨ä¸å®Œæ•´æ€§ã€‚</li><li>ç»¼ä¸Šï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œä¸¤ä¸ªä¸€èµ·ç”¨ã€‚</li></ol><p>Spring æ”¯æŒ JSR-303 éªŒè¯æ¡†æ¶ï¼ŒJSR-303 æ˜¯ JAVA EE 6 ä¸­çš„ä¸€é¡¹å­è§„èŒƒï¼Œå«åš Bean Validationï¼Œå®˜æ–¹å‚è€ƒå®ç°æ˜¯ Hibernate Validatorï¼ˆä¸Hibernate ORM æ²¡æœ‰å…³ç³»ï¼‰ï¼ŒJSR-303 ç”¨äºå¯¹ Java Bean ä¸­çš„å­—æ®µçš„å€¼è¿›è¡ŒéªŒè¯ã€‚</p><h3 id="9-1-æ™®é€šæ ¡éªŒ"><a href="#9-1-æ™®é€šæ ¡éªŒ" class="headerlink" title="9.1 æ™®é€šæ ¡éªŒ"></a>9.1 æ™®é€šæ ¡éªŒ</h3><p>æ™®é€šæ ¡éªŒï¼Œæ˜¯è¿™é‡Œæœ€åŸºæœ¬çš„ç”¨æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åŠ å…¥æ ¡éªŒéœ€è¦çš„ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.1.0.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æ ¡éªŒçš„ Beanï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;validatorFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;providerClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.hibernate.validator.HibernateValidator&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">validator</span>=<span class="hljs-string">&quot;validatorFactoryBean&quot;</span>/&gt;</span></code></pre></div><p>é…ç½®æ—¶ï¼Œæä¾›ä¸€ä¸ª <code>LocalValidatorFactoryBean</code> çš„å®ä¾‹ï¼Œç„¶å Bean çš„æ ¡éªŒä½¿ç”¨<code> HibernateValidator</code></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªæ·»åŠ å­¦ç”Ÿçš„é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/addstudent&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å­¦ç”Ÿç¼–å·ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å­¦ç”Ÿå§“åï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å­¦ç”Ÿé‚®ç®±ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å­¦ç”Ÿå¹´é¾„ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>åœ¨è¿™é‡Œéœ€è¦æäº¤çš„æ•°æ®ä¸­ï¼Œå‡è®¾å­¦ç”Ÿç¼–å·ä¸èƒ½ä¸ºç©ºï¼Œå­¦ç”Ÿå§“åé•¿åº¦ä¸èƒ½è¶…è¿‡ 10 ä¸”ä¸èƒ½ä¸ºç©ºï¼Œé‚®ç®±åœ°å€è¦åˆæ³•ï¼Œå¹´é¾„ä¸èƒ½è¶…è¿‡ 150ã€‚é‚£ä¹ˆåœ¨å®šä¹‰å®ä½“ç±»çš„æ—¶å€™ï¼Œå°±å¯ä»¥åŠ å…¥è¿™ä¸ªåˆ¤æ–­æ¡ä»¶äº†ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;    <span class="hljs-meta">@NotNull</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@NotNull</span>    <span class="hljs-meta">@Size(min = 2,max = 10)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Email</span>    <span class="hljs-keyword">private</span> String email;    <span class="hljs-meta">@Max(150)</span>    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> email;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, email=&#x27;&quot;</span> + email + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, age=&quot;</span> + age +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span><span class="hljs-params">(String email)</span> </span>&#123;        <span class="hljs-keyword">this</span>.email = email;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> age;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;        <span class="hljs-keyword">this</span>.age = age;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼š</p><ul><li><code>@NotNull </code>è¡¨ç¤ºè¿™ä¸ªå­—æ®µä¸èƒ½ä¸ºç©º</li><li><code>@Size </code>ä¸­æè¿°äº†è¿™ä¸ªå­—ç¬¦ä¸²é•¿åº¦çš„é™åˆ¶</li><li><code>@Email </code>è¡¨ç¤ºè¿™ä¸ªå­—æ®µçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªé‚®ç®±åœ°å€</li><li><code>@Max </code>è¡¨ç¤ºè¿™ä¸ªå­—æ®µçš„æœ€å¤§å€¼</li></ul><p>å®šä¹‰å®Œæˆåï¼Œæ¥ä¸‹æ¥ï¼Œåœ¨ Controller ä¸­å®šä¹‰æ¥å£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/addstudent&quot;)</span>    <span class="hljs-meta">@ResponseBody</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addStudent</span><span class="hljs-params">(<span class="hljs-meta">@Validated</span> Student student, BindingResult result)</span> </span>&#123;        <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-comment">//æ ¡éªŒæœªé€šè¿‡ï¼Œè·å–æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥</span>            List&lt;ObjectError&gt; allErrors = result.getAllErrors();            <span class="hljs-keyword">for</span> (ObjectError allError : allErrors) &#123;                System.out.println(allError.getObjectName()+<span class="hljs-string">&quot;:&quot;</span>+allError.getDefaultMessage());            &#125;        &#125;    &#125;&#125;</code></pre></div><p>åœ¨è¿™é‡Œï¼š</p><ul><li><code>@Validated </code>è¡¨ç¤º Student ä¸­å®šä¹‰çš„æ ¡éªŒè§„åˆ™å°†ä¼šç”Ÿæ•ˆ</li><li><code>BindingResult</code> è¡¨ç¤ºå‡ºé”™ä¿¡æ¯ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸ä¸ºç©ºï¼Œè¡¨ç¤ºæœ‰é”™è¯¯ï¼Œå¦åˆ™æ ¡éªŒé€šè¿‡ã€‚</li></ul><p>æ¥ä¸‹æ¥å°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ã€‚è®¿é—® jsp é¡µé¢ï¼Œç„¶åæ·»åŠ  Studentï¼ŒæŸ¥çœ‹æ ¡éªŒè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰“å°å‡ºæ¥çš„é”™è¯¯ä¿¡æ¯æ—¶ç³»ç»Ÿé»˜è®¤çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚è‡ªå®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p><p>ç”±äº properties æ–‡ä»¶ä¸­çš„ä¸­æ–‡ä¼šä¹±ç ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å…ˆä¿®æ”¹ä¸€ä¸‹ IDEA é…ç½®ï¼Œç‚¹<code> Fileâ€“&gt;Settings-&gt;Editorâ€“&gt;File Encodings</code>ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/10-1-20210520170449224.png" alt="10-1.png"></p><p>ç„¶åå®šä¹‰é”™è¯¯æç¤ºæ–‡æœ¬ï¼Œåœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª MyMessage.properties æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">student.id.notnull</span>=<span class="hljs-string">id ä¸èƒ½ä¸ºç©º</span><span class="hljs-meta">student.name.notnull</span>=<span class="hljs-string">name ä¸èƒ½ä¸ºç©º</span><span class="hljs-meta">student.name.length</span>=<span class="hljs-string">name æœ€å°é•¿åº¦ä¸º 2 ï¼Œæœ€å¤§é•¿åº¦ä¸º 10</span><span class="hljs-meta">student.email.error</span>=<span class="hljs-string">email åœ°å€éæ³•</span><span class="hljs-meta">student.age.error</span>=<span class="hljs-string">å¹´é¾„ä¸èƒ½è¶…è¿‡ 150</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ SpringMVC é…ç½®ä¸­ï¼ŒåŠ è½½è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;validatorFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;providerClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.hibernate.validator.HibernateValidator&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;validationMessageSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;bundleMessageSource&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ReloadableResourceBundleMessageSource&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bundleMessageSource&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basenames&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>          <span class="hljs-comment">&lt;!--æ²¡æœ‰åç¼€ --&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>classpath:MyMessage<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultEncoding&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheSeconds&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;300&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">validator</span>=<span class="hljs-string">&quot;validatorFactoryBean&quot;</span>/&gt;</span></code></pre></div><p>æœ€åï¼Œåœ¨å®ä½“ç±»ä¸Šçš„æ³¨è§£ä¸­ï¼ŒåŠ ä¸Šæ ¡éªŒå‡ºé”™æ—¶çš„ä¿¡æ¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;    <span class="hljs-meta">@NotNull(message = &quot;&#123;student.id.notnull&#125;&quot;)</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@NotNull(message = &quot;&#123;student.name.notnull&#125;&quot;)</span>    <span class="hljs-meta">@Size(min = 2,max = 10,message = &quot;&#123;student.name.length&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Email(message = &quot;&#123;student.email.error&#125;&quot;)</span>    <span class="hljs-keyword">private</span> String email;    <span class="hljs-meta">@Max(value = 150,message = &quot;&#123;student.age.error&#125;&quot;)</span>    <span class="hljs-keyword">private</span> Integer age;</code></pre></div><p>é…ç½®å®Œæˆåï¼Œå¦‚æœæ ¡éªŒå†å‡ºé”™ï¼Œå°±ä¼šå±•ç¤ºæˆ‘ä»¬è‡ªå·±çš„å‡ºé”™ä¿¡æ¯äº†ã€‚</p><h3 id="9-2-åˆ†ç»„æ ¡éªŒ"><a href="#9-2-åˆ†ç»„æ ¡éªŒ" class="headerlink" title="9.2 åˆ†ç»„æ ¡éªŒ"></a>9.2 åˆ†ç»„æ ¡éªŒ</h3><p>ç”±äºæ ¡éªŒè§„åˆ™éƒ½æ˜¯å®šä¹‰åœ¨å®ä½“ç±»ä¸Šé¢çš„ï¼Œä½†æ˜¯ï¼Œåœ¨ä¸åŒçš„æ•°æ®æäº¤ç¯å¢ƒä¸‹ï¼Œæ ¡éªŒè§„åˆ™å¯èƒ½ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·çš„ id æ˜¯è‡ªå¢é•¿çš„ï¼Œæ·»åŠ çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨ä¼ é€’ç”¨æˆ· idï¼Œä½†æ˜¯ä¿®æ”¹çš„æ—¶å€™åˆ™å¿…é¡»ä¼ é€’ç”¨æˆ· idï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ†ç»„æ ¡éªŒã€‚</p><p>åˆ†ç»„æ ¡éªŒï¼Œé¦–å…ˆéœ€è¦å®šä¹‰æ ¡éªŒç»„ï¼Œæ‰€è°“çš„æ ¡éªŒç»„ï¼Œå…¶å®å°±æ˜¯<strong>ç©ºæ¥å£</strong>ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ValidationGroup1</span> </span>&#123;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ValidationGroup2</span> </span>&#123;&#125;</code></pre></div><p>ç„¶åï¼Œåœ¨å®ä½“ç±»ä¸­ï¼ŒæŒ‡å®šæ¯ä¸€ä¸ªæ ¡éªŒè§„åˆ™æ‰€å±çš„ç»„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;    <span class="hljs-meta">@NotNull(message = &quot;&#123;student.id.notnull&#125;&quot;,groups = ValidationGroup1.class)</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@NotNull(message = &quot;&#123;student.name.notnull&#125;&quot;,groups = &#123;ValidationGroup1.class, ValidationGroup2.class&#125;)</span>    <span class="hljs-meta">@Size(min = 2,max = 10,message = &quot;&#123;student.name.length&#125;&quot;,groups = &#123;ValidationGroup1.class, ValidationGroup2.class&#125;)</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-meta">@Email(message = &quot;&#123;student.email.error&#125;&quot;,groups = &#123;ValidationGroup1.class, ValidationGroup2.class&#125;)</span>    <span class="hljs-keyword">private</span> String email;    <span class="hljs-meta">@Max(value = 150,message = &quot;&#123;student.age.error&#125;&quot;,groups = &#123;ValidationGroup2.class&#125;)</span>    <span class="hljs-keyword">private</span> Integer age;</code></pre></div><p>åœ¨ group ä¸­æŒ‡å®šæ¯ä¸€ä¸ªæ ¡éªŒè§„åˆ™æ‰€å±çš„ç»„ï¼Œä¸€ä¸ªè§„åˆ™å¯ä»¥å±äºä¸€ä¸ªç»„ï¼Œä¹Ÿå¯ä»¥å±äºå¤šä¸ªç»„ã€‚</p><p>æœ€åï¼Œåœ¨æ¥æ”¶å‚æ•°çš„åœ°æ–¹ï¼ŒæŒ‡å®šæ ¡éªŒç»„ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> </span>&#123;    <span class="hljs-meta">@RequestMapping(&quot;/addstudent&quot;)</span>    <span class="hljs-meta">@ResponseBody</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addStudent</span><span class="hljs-params">(<span class="hljs-meta">@Validated(ValidationGroup2.class)</span> Student student, BindingResult result)</span> </span>&#123;        <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-comment">//æ ¡éªŒæœªé€šè¿‡ï¼Œè·å–æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥</span>            List&lt;ObjectError&gt; allErrors = result.getAllErrors();            <span class="hljs-keyword">for</span> (ObjectError allError : allErrors) &#123;                System.out.println(allError.getObjectName()+<span class="hljs-string">&quot;:&quot;</span>+allError.getDefaultMessage());            &#125;        &#125;    &#125;&#125;</code></pre></div><p>é…ç½®å®Œæˆåï¼Œå±äº<code> ValidationGroup2</code> è¿™ä¸ªç»„çš„æ ¡éªŒè§„åˆ™ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚</p><h3 id="9-3-æ ¡éªŒæ³¨è§£"><a href="#9-3-æ ¡éªŒæ³¨è§£" class="headerlink" title="9.3 æ ¡éªŒæ³¨è§£"></a>9.3 æ ¡éªŒæ³¨è§£</h3><p>æ ¡éªŒæ³¨è§£ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>@Null è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º null</li><li>@NotNull è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸ä¸º null</li><li>@AssertTrue è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º true</li><li>@AssertFalse è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ä¸º false</li><li>@Min(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li>@Max(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li>@DecimalMin(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li>@DecimalMax(value) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li>@Size(max=, min=) è¢«æ³¨è§£çš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</li><li>@Digits (integer, fraction) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</li><li>@Past è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</li><li>@Future è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</li><li>@Pattern(regex=,flag=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</li><li>@NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº0</li><li>@Email è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€</li><li>@Length(min=,max=) è¢«æ³¨è§£çš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</li><li>@NotEmpty è¢«æ³¨è§£çš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º</li><li>@Range(min=,max=,message=) è¢«æ³¨è§£çš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</li></ul><h2 id="10-æ•°æ®å›æ˜¾"><a href="#10-æ•°æ®å›æ˜¾" class="headerlink" title="10. æ•°æ®å›æ˜¾"></a>10. æ•°æ®å›æ˜¾</h2><h3 id="10-1-æ•°æ®å›æ˜¾åŸºæœ¬ç”¨æ³•"><a href="#10-1-æ•°æ®å›æ˜¾åŸºæœ¬ç”¨æ³•" class="headerlink" title="10.1 æ•°æ®å›æ˜¾åŸºæœ¬ç”¨æ³•"></a>10.1 æ•°æ®å›æ˜¾åŸºæœ¬ç”¨æ³•</h3><p>æ•°æ®å›æ˜¾å°±æ˜¯å½“ç”¨æˆ·æ•°æ®æäº¤å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨å¡«å……å¥½å·²ç»è¾“å…¥çš„æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨ Ajax æ¥åšæ•°æ®æäº¤ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰æ•°æ®å›æ˜¾è¿™ä¸ªéœ€æ±‚çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯é€šè¿‡è¡¨å•åšæ•°æ®æäº¤ï¼Œé‚£ä¹ˆæ•°æ®å›æ˜¾å°±éå¸¸æœ‰å¿…è¦äº†ã€‚</p><h4 id="10-1-1-ç®€å•æ•°æ®ç±»å‹"><a href="#10-1-1-ç®€å•æ•°æ®ç±»å‹" class="headerlink" title="10.1.1 ç®€å•æ•°æ®ç±»å‹"></a>10.1.1 ç®€å•æ•°æ®ç±»å‹</h4><p>ç®€å•æ•°æ®ç±»å‹ï¼Œå®é™…ä¸Šæ¡†æ¶åœ¨è¿™é‡Œæ²¡æœ‰æä¾›ä»»ä½•å½¢å¼çš„æ”¯æŒï¼Œå°±æ˜¯æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨é…ç½®ã€‚æˆ‘ä»¬ç»§ç»­åœ¨ç¬¬ 10 å°èŠ‚çš„ä¾‹å­ä¸Šæ¼”ç¤º Demoã€‚åŠ å…¥æäº¤çš„ Student æ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆé‡æ–°å›åˆ°æ·»åŠ  Student é¡µé¢ï¼Œå¹¶ä¸”é¢„è®¾ä¹‹å‰å·²ç»å¡«å¥½çš„æ•°æ®ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥æ”¹é€ ä¸€ä¸‹<code> student.jsp</code> é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/addstudent&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;id&quot; value=&quot;$&#123;id&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;$&#123;name&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿé‚®ç®±ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;email&quot; value=&quot;$&#123;email&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå¹´é¾„ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;age&quot; value=&quot;$&#123;age&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;                &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><p>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œä½¿ç”¨ç®€å•æ•°æ®ç±»å‹å»æ¥æ”¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addstudent&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addStudent2</span><span class="hljs-params">(Integer id, String name, String email, Integer age, Model model)</span> </span>&#123;    model.addAttribute(<span class="hljs-string">&quot;id&quot;</span>, id);    model.addAttribute(<span class="hljs-string">&quot;name&quot;</span>, name);    model.addAttribute(<span class="hljs-string">&quot;email&quot;</span>, email);    model.addAttribute(<span class="hljs-string">&quot;age&quot;</span>, age);    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;student&quot;</span>;&#125;</code></pre></div><p>è¿™ç§æ–¹å¼ï¼Œç›¸å½“äºæ¡†æ¶æ²¡æœ‰åšä»»ä½•å·¥ä½œï¼Œå°±æ˜¯æˆ‘ä»¬æ‰‹åŠ¨åšæ•°æ®å›æ˜¾çš„ã€‚æ­¤æ—¶è®¿é—®é¡µé¢ï¼ŒæœåŠ¡ç«¯ä¼šå†æ¬¡å®šä½åˆ°è¯¥é¡µé¢ï¼Œè€Œä¸”æ•°æ®å·²ç»é¢„å¡«å¥½</p><h4 id="10-1-2-å®ä½“ç±»"><a href="#10-1-2-å®ä½“ç±»" class="headerlink" title="10.1.2 å®ä½“ç±»"></a>10.1.2 å®ä½“ç±»</h4><p>ä¸Šé¢è¿™ç§ç®€å•æ•°æ®ç±»å‹çš„å›æ˜¾ï¼Œå®é™…ä¸Šéå¸¸éº»çƒ¦ï¼Œå› ä¸ºéœ€è¦å¼€å‘è€…åœ¨æœåŠ¡ç«¯ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨è®¾ç½®ã€‚å¦‚æœä½¿ç”¨å¯¹è±¡çš„è¯ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆéº»çƒ¦äº†ï¼Œå› ä¸º SpringMVC åœ¨é¡µé¢è·³è½¬æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å¯¹è±¡å¡«å……è¿›è¿”å›çš„æ•°æ®ä¸­</p><p>æ­¤æ—¶ï¼Œé¦–å…ˆä¿®æ”¹ä¸€ä¸‹<code> student.jsp</code> é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/addstudent&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;id&quot; value=&quot;$&#123;student.id&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;$&#123;student.name&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿé‚®ç®±ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;email&quot; value=&quot;$&#123;student.email&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå¹´é¾„ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;age&quot; value=&quot;$&#123;student.age&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;                &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><p>æ³¨æ„ï¼Œåœ¨é¢„å¡«æ•°æ®ä¸­ï¼Œå¤šäº†ä¸€ä¸ª <code>student.</code> å‰ç¼€ã€‚è¿™ student å°±æ˜¯æœåŠ¡ç«¯æ¥æ”¶æ•°æ®çš„å˜é‡åï¼ŒæœåŠ¡ç«¯çš„å˜é‡åå’Œè¿™é‡Œçš„ student è¦ä¿æŒä¸€è‡´ã€‚æœåŠ¡ç«¯å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addstudent&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addStudent</span><span class="hljs-params">(<span class="hljs-meta">@Validated(ValidationGroup2.class)</span> Student student, BindingResult result)</span> </span>&#123;    <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">//æ ¡éªŒæœªé€šè¿‡ï¼Œè·å–æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥</span>        List&lt;ObjectError&gt; allErrors = result.getAllErrors();        <span class="hljs-keyword">for</span> (ObjectError allError : allErrors) &#123;            System.out.println(allError.getObjectName()+<span class="hljs-string">&quot;:&quot;</span>+allError.getDefaultMessage());        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;student&quot;</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;&#125;</code></pre></div><p>æ³¨æ„ï¼ŒæœåŠ¡ç«¯ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œå°±è¯´è¦è¿”å›çš„é¡µé¢å°±è¡Œäº†ï¼Œstudent è¿™ä¸ªå˜é‡ä¼šè¢«è‡ªåŠ¨å¡«å……åˆ°è¿”å›çš„ Model ä¸­ã€‚å˜é‡åå°±æ˜¯å¡«å……æ—¶å€™çš„ keyã€‚å¦‚æœæƒ³è‡ªå®šä¹‰è¿™ä¸ª keyï¼Œå¯ä»¥åœ¨å‚æ•°ä¸­å†™å‡ºæ¥ Modelï¼Œç„¶åæ‰‹åŠ¨åŠ å…¥ Student å¯¹è±¡ï¼Œå°±åƒç®€å•æ•°æ®ç±»å‹å›æ˜¾é‚£æ ·ã€‚</p><p>å¦ä¸€ç§å®šä¹‰å›æ˜¾å˜é‡åˆ«åçš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨<code>@ModelAttribute</code>æ³¨è§£</p><h3 id="10-2-ModelAttribute"><a href="#10-2-ModelAttribute" class="headerlink" title="10.2 @ModelAttribute"></a>10.2 @ModelAttribute</h3><p><code>@ModelAttribute</code> è¿™ä¸ªæ³¨è§£ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŠŸèƒ½ï¼š</p><ul><li>åœ¨æ•°æ®å›æ˜¾æ—¶ï¼Œç»™å˜é‡å®šä¹‰åˆ«å</li><li>å®šä¹‰å…¨å±€æ•°æ®</li></ul><h4 id="10-2-1-å®šä¹‰åˆ«å"><a href="#10-2-1-å®šä¹‰åˆ«å" class="headerlink" title="10.2.1 å®šä¹‰åˆ«å"></a>10.2.1 å®šä¹‰åˆ«å</h4><p>åœ¨æ•°æ®å›æ˜¾æ—¶ï¼Œç»™å˜é‡å®šä¹‰åˆ«åï¼Œéå¸¸å®¹æ˜“ï¼Œç›´æ¥åŠ è¿™ä¸ªæ³¨è§£å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addstudent&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addStudent</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute(&quot;s&quot;)</span> <span class="hljs-meta">@Validated(ValidationGroup2.class)</span> Student student, BindingResult result)</span> </span>&#123;    <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">//æ ¡éªŒæœªé€šè¿‡ï¼Œè·å–æ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥</span>        List&lt;ObjectError&gt; allErrors = result.getAllErrors();        <span class="hljs-keyword">for</span> (ObjectError allError : allErrors) &#123;            System.out.println(allError.getObjectName()+<span class="hljs-string">&quot;:&quot;</span>+allError.getDefaultMessage());        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;student&quot;</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;&#125;</code></pre></div><p>è¿™æ ·å®šä¹‰å®Œæˆåï¼Œåœ¨å‰ç«¯å†æ¬¡è®¿é—®å›æ˜¾çš„å˜é‡æ—¶ï¼Œå˜é‡åç§°å°±ä¸æ˜¯ student äº†ï¼Œè€Œæ˜¯ sï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;/addstudent&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿç¼–å·ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;id&quot; value=&quot;$&#123;s.id&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå§“åï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;$&#123;s.name&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿé‚®ç®±ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;email&quot; value=&quot;$&#123;s.email&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;å­¦ç”Ÿå¹´é¾„ï¼š&lt;/td&gt;            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;age&quot; value=&quot;$&#123;s.age&#125;&quot;&gt;&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td colspan=<span class="hljs-string">&quot;2&quot;</span>&gt;                &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;            &lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;&lt;/form&gt;</code></pre></div><h4 id="10-2-2-å®šä¹‰å…¨å±€æ•°æ®"><a href="#10-2-2-å®šä¹‰å…¨å±€æ•°æ®" class="headerlink" title="10.2.2 å®šä¹‰å…¨å±€æ•°æ®"></a>10.2.2 å®šä¹‰å…¨å±€æ•°æ®</h4><p>å‡è®¾æœ‰ä¸€ä¸ª Controller ä¸­æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›æ•°æ®ç»™å‰ç«¯ï¼Œä½†æ˜¯æ¯ä¸ªæ–¹æ³•è¿”å›ç»™å‰ç«¯çš„æ•°æ®åˆä¸å¤ªä¸€æ ·ï¼Œè™½ç„¶ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰æ–¹æ³•çš„è¿”å›å€¼åˆæœ‰ä¸€äº›å…¬å…±çš„éƒ¨åˆ†ã€‚å¯ä»¥å°†è¿™äº›å…¬å…±çš„éƒ¨åˆ†æå–å‡ºæ¥å•ç‹¬å°è£…æˆä¸€ä¸ªæ–¹æ³•ï¼Œç”¨ <code>@ModelAttribute </code>æ³¨è§£æ¥æ ‡è®°ã€‚</p><p>ä¾‹å¦‚åœ¨ä¸€ä¸ª Controller ä¸­ ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ModelAttribute(&quot;info&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">info</span><span class="hljs-params">()</span> </span>&#123;    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;lucifer&quot;</span>);    map.put(<span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;www.github.com&quot;</span>);    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p>å½“ç”¨æˆ·è®¿é—®å½“å‰ Controller ä¸­çš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨è¿”å›æ•°æ®æ—¶ï¼Œéƒ½ä¼šå°†æ·»åŠ äº†<code>@ModelAttribute</code>æ³¨è§£çš„æ–¹æ³•çš„è¿”å›å€¼ï¼Œä¸€èµ·è¿”å›ç»™å‰ç«¯ã€‚<code>@ModelAttribute </code>æ³¨è§£ä¸­çš„ info è¡¨ç¤ºè¿”å›æ•°æ®çš„ key</p><h2 id="11-JSON"><a href="#11-JSON" class="headerlink" title="11. JSON"></a>11. JSON</h2><h3 id="11-1-è¿”å›-JSON"><a href="#11-1-è¿”å›-JSON" class="headerlink" title="11.1 è¿”å› JSON"></a>11.1 è¿”å› JSON</h3><p>ç›®å‰ä¸»æµçš„ JSON å¤„ç†å·¥å…·ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><ul><li><strong>jackson</strong></li><li><strong>gson</strong></li><li><strong>fastjson</strong></li></ul><p>åœ¨ SpringMVC ä¸­ï¼Œå¯¹ jackson å’Œ gson éƒ½æä¾›äº†ç›¸åº”çš„æ”¯æŒï¼Œå°±æ˜¯å¦‚æœä½¿ç”¨è¿™ä¸¤ä¸ªä½œä¸º JSON è½¬æ¢å™¨ï¼Œåªéœ€è¦æ·»åŠ å¯¹åº”çš„ä¾èµ–å°±å¯ä»¥äº†ï¼Œè¿”å›çš„å¯¹è±¡å’Œè¿”å›çš„é›†åˆã€Map ç­‰éƒ½ä¼šè‡ªåŠ¨è½¬ä¸º JSONï¼Œä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ fastjsonï¼Œé™¤äº†æ·»åŠ ç›¸åº”çš„ä¾èµ–ä¹‹å¤–ï¼Œè¿˜éœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½® <code>HttpMessageConverter</code> è½¬æ¢å™¨ã€‚å…¶å®å‰ä¸¤ä¸ªä¹Ÿæ˜¯ä½¿ç”¨ <code>HttpMessageConverter </code>è½¬æ¢å™¨ï¼Œä½†æ˜¯æ˜¯ SpringMVC è‡ªåŠ¨æä¾›çš„ï¼ŒSpringMVC æ²¡æœ‰ç»™ fastjson æä¾›ç›¸åº”çš„è½¬æ¢å™¨</p><h4 id="11-1-1-jackson"><a href="#11-1-1-jackson" class="headerlink" title="11.1.1 jackson"></a>11.1.1 jackson</h4><p>jackson æ˜¯ä¸€ä¸ªä½¿ç”¨æ¯”è¾ƒå¤šï¼Œæ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿çš„ JSON å¤„ç†å·¥å…·ï¼Œåœ¨ SpringMVC ä¸­ä½¿ç”¨ jackson ï¼Œåªéœ€è¦æ·»åŠ  jackson çš„ä¾èµ–å³å¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.10.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ä¾èµ–æ·»åŠ æˆåŠŸåï¼Œå‡¡æ˜¯åœ¨æ¥å£ä¸­ç›´æ¥è¿”å›çš„å¯¹è±¡ï¼Œé›†åˆç­‰ç­‰ï¼Œéƒ½ä¼šè‡ªåŠ¨è½¬ä¸º JSONã€‚å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAuthor</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAuthor</span><span class="hljs-params">(String author)</span> </span>&#123;        <span class="hljs-keyword">this</span>.author = author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;&#125;<span class="hljs-meta">@RequestMapping(&quot;/book&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">getBookById</span><span class="hljs-params">()</span> </span>&#123;    Book book = <span class="hljs-keyword">new</span> Book();    book.setId(<span class="hljs-number">1</span>);    book.setName(<span class="hljs-string">&quot;ä¸‰å›½æ¼”ä¹‰&quot;</span>);    book.setAuthor(<span class="hljs-string">&quot;ç½—è´¯ä¸­&quot;</span>);    <span class="hljs-keyword">return</span> book;&#125;</code></pre></div><p>è¿™é‡Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯åœ¨å‰ç«¯æ¥æ”¶åˆ°çš„åˆ™æ˜¯ä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šé€šè¿‡ <code>HttpMessageConverter </code>è‡ªåŠ¨è½¬ä¸º JSON å­—ç¬¦ä¸²</p><p>å¦‚æœæƒ³è¿”å›ä¸€ä¸ª JSON æ•°ç»„ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/books&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getAllBooks</span><span class="hljs-params">()</span> </span>&#123;    List&lt;Book&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;Book&gt;();    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;        Book book = <span class="hljs-keyword">new</span> Book();        book.setId(i);        book.setName(<span class="hljs-string">&quot;ä¸‰å›½æ¼”ä¹‰:&quot;</span> + i);        book.setAuthor(<span class="hljs-string">&quot;ç½—è´¯ä¸­:&quot;</span> + i);        list.add(book);    &#125;    <span class="hljs-keyword">return</span> list;&#125;</code></pre></div><p>æ·»åŠ äº† jackson ï¼Œå°±èƒ½å¤Ÿè‡ªåŠ¨è¿”å› JSONï¼Œè¿™ä¸ªä¾èµ–äºä¸€ä¸ªåä¸º<code> HttpMessageConverter</code> çš„ç±»ï¼Œè¿™æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„ä½œç”¨æ˜¯ Http æ¶ˆæ¯è½¬æ¢å™¨ï¼Œæ—¢ç„¶æ˜¯æ¶ˆæ¯è½¬æ¢å™¨ï¼Œå®ƒæä¾›äº†ä¸¤æ–¹é¢çš„åŠŸèƒ½ï¼š</p><ul><li>å°†è¿”å›çš„å¯¹è±¡è½¬ä¸º JSON</li><li>å°†å‰ç«¯æäº¤ä¸Šæ¥çš„ JSON è½¬ä¸ºå¯¹è±¡</li></ul><p>ä½†æ˜¯ï¼Œ<code>HttpMessageConverter </code>åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”±å„ä¸ª JSON å·¥å…·æä¾›ç›¸åº”çš„å®ç°ï¼Œåœ¨ jackson ä¸­ï¼Œå®ç°çš„åå­—å«åš <code>MappingJackson2HttpMessageConverter</code>ï¼Œè€Œè¿™ä¸ªä¸œè¥¿çš„åˆå§‹åŒ–ï¼Œåˆ™ç”± SpringMVC æ¥å®Œæˆã€‚é™¤éè‡ªå·±æœ‰ä¸€äº›è‡ªå®šä¹‰é…ç½®çš„éœ€æ±‚ï¼Œå¦åˆ™ä¸€èˆ¬æ¥è¯´ä¸éœ€è¦è‡ªå·±æä¾› <code>MappingJackson2HttpMessageConverter</code></p><p>ä¸¾ä¸€ä¸ªç®€å•çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚æ¯ä¸€æœ¬ä¹¦ï¼Œéƒ½æœ‰ä¸€ä¸ªå‡ºç‰ˆæ—¥æœŸï¼Œä¿®æ”¹ Book ç±»å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-keyword">private</span> Date publish;    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getPublish</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> publish;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPublish</span><span class="hljs-params">(Date publish)</span> </span>&#123;        <span class="hljs-keyword">this</span>.publish = publish;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;        <span class="hljs-keyword">this</span>.name = name;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAuthor</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAuthor</span><span class="hljs-params">(String author)</span> </span>&#123;        <span class="hljs-keyword">this</span>.author = author;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;    &#125;&#125;</code></pre></div><p>ç„¶ååœ¨æ„é€  Book æ—¶æ·»åŠ æ—¥æœŸå±æ€§ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/book&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">getBookById</span><span class="hljs-params">()</span> </span>&#123;    Book book = <span class="hljs-keyword">new</span> Book();    book.setId(<span class="hljs-number">1</span>);    book.setName(<span class="hljs-string">&quot;ä¸‰å›½æ¼”ä¹‰&quot;</span>);    book.setAuthor(<span class="hljs-string">&quot;ç½—è´¯ä¸­&quot;</span>);    book.setPublish(<span class="hljs-keyword">new</span> Date());    <span class="hljs-keyword">return</span> book;&#125;</code></pre></div><p>è®¿é—® <code>/book </code>æ¥å£ï¼Œè¿”å›çš„ json æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/12-1-1.png" alt="12-1-1.png"></p><p>å¦‚æœæˆ‘ä»¬æƒ³è‡ªå·±å®šåˆ¶è¿”å›æ—¥æœŸçš„æ ¼å¼ï¼Œç®€å•çš„åŠæ³•ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ³¨è§£æ¥å®ç°ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String author;    <span class="hljs-meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;,timezone = &quot;Asia/Shanghai&quot;)</span>    <span class="hljs-keyword">private</span> Date publish;</code></pre></div><p>æ³¨æ„è¿™é‡Œä¸€å®šè¦è®¾ç½®æ—¶åŒº</p><p>è¿™æ ·ï¼Œå°±å¯ä»¥å®šåˆ¶è¿”å›çš„æ—¥æœŸæ ¼å¼äº†</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥åŠ åœ¨å±æ€§ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨ç±»ä¸Šï¼Œä¹Ÿå°±è¯´ï¼Œæœ€å¤§å¯ä»¥ä½œç”¨åˆ°ä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰æ—¥æœŸå±æ€§ä¸Šã€‚å¦‚æœé¡¹ç›®ä¸­æœ‰å¾ˆå¤šå®ä½“ç±»éƒ½éœ€è¦åšæ—¥æœŸæ ¼å¼åŒ–ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æä¾›ä¸€ä¸ª jackson çš„ <code>HttpMesageConverter </code>å®ä¾‹ï¼Œåœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œè‡ªå·±å»é…ç½®ç›¸å…³å±æ€§ï¼Œè¿™é‡Œçš„é…ç½®å°†æ˜¯ä¸€ä¸ªå…¨å±€é…ç½®</p><p>åœ¨ SpringMVC é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;objectMapper&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dateFormat&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;timeZone&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>æ·»åŠ å®Œæˆåï¼Œå»æ‰ Book å®ä½“ç±»ä¸­æ—¥æœŸæ ¼å¼åŒ–çš„æ³¨è§£ï¼Œå†è¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><h4 id="11-1-2-gson"><a href="#11-1-2-gson" class="headerlink" title="11.1.2 gson"></a>11.1.2 gson</h4><p>gson æ˜¯ Google æ¨å‡ºçš„ä¸€ä¸ª JSON è§£æå™¨ï¼Œä¸»è¦åœ¨ Android å¼€å‘ä¸­ä½¿ç”¨è¾ƒå¤šï¼Œä¸è¿‡ï¼ŒWeb å¼€å‘ä¸­ä¹Ÿæ˜¯æ”¯æŒè¿™ä¸ªçš„ï¼Œè€Œä¸” SpringMVC è¿˜é’ˆå¯¹ Gson æä¾›äº†ç›¸å…³çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œä»¥è‡´æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªè¦æ·»åŠ  gson ä¾èµ–ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ gson æ¥åš JSON è§£æ</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>å¦‚æœé¡¹ç›®ä¸­ï¼ŒåŒæ—¶å­˜åœ¨ jackson å’Œ gson çš„è¯ï¼Œé‚£ä¹ˆé»˜è®¤ä½¿ç”¨çš„æ˜¯ jacksonï¼Œåœ¨ <code>org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter</code> ç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼ŒåŠ è½½é¡ºåºå°±æ˜¯å…ˆåŠ è½½ jackson çš„ <code>HttpMessageConverter</code>ï¼ŒååŠ è½½ gson çš„<code> HttpMessageConverter</code></p><p>åŠ å®Œä¾èµ–ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥è¿”å› JSON å­—ç¬¦ä¸²äº†ã€‚ä½¿ç”¨ Gson æ—¶ï¼Œå¦‚æœæƒ³åšè‡ªå®šä¹‰é…ç½®ï¼Œåˆ™éœ€è¦è‡ªå®šä¹‰ <code>HttpMessageConverter</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.json.GsonHttpMessageConverter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gson&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.google.gson.Gson&quot;</span> <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;gsonBuilder&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;create&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.google.gson.GsonBuilder&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;gsonBuilder&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dateFormat&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h4 id="11-1-3-fastjson"><a href="#11-1-3-fastjson" class="headerlink" title="11.1.3 fastjson"></a>11.1.3 fastjson</h4><p>fastjson å·ç§°æœ€å¿«çš„ JSON è§£æå™¨ï¼Œä½†æ˜¯ä¹Ÿæ˜¯è¿™ä¸‰ä¸ªä¸­ BUG æœ€å¤šçš„ä¸€ä¸ªã€‚åœ¨ SpringMVC å¹¶æ²¡é’ˆå¯¹ fastjson æä¾›ç›¸åº”çš„<code> HttpMessageConverter</code>ï¼Œæ‰€ä»¥ï¼Œfastjson åœ¨ä½¿ç”¨æ—¶ï¼Œä¸€å®šè¦è‡ªå·±æ‰‹åŠ¨é…ç½® <code>HttpMessageConverter</code>ï¼ˆå‰é¢ä¸¤ä¸ªå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦ï¼Œç›´æ¥æ·»åŠ ä¾èµ–å°±å¯ä»¥äº†ï¼‰</p><p>ä½¿ç”¨ fastjsonï¼Œæˆ‘ä»¬é¦–å…ˆæ·»åŠ  fastjson ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.60<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶ååœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­é…ç½® <code>HttpMessageConverter</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fastJsonConfig&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.fastjson.support.config.FastJsonConfig&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dateFormat&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>fastjson é»˜è®¤ä¸­æ–‡ä¹±ç ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®è§£å†³</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpMessageConverter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fastJsonConfig&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.fastjson.support.config.FastJsonConfig&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dateFormat&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;supportedMediaTypes&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>application/json;charset=utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><h3 id="12-2-æ¥æ”¶-JSON"><a href="#12-2-æ¥æ”¶-JSON" class="headerlink" title="12.2 æ¥æ”¶ JSON"></a>12.2 æ¥æ”¶ JSON</h3><p>æµè§ˆå™¨ä¼ æ¥çš„å‚æ•°ï¼Œå¯ä»¥æ˜¯ <code>key/value </code>å½¢å¼çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª JSON å­—ç¬¦ä¸²ã€‚åœ¨ <code>Jsp/Servlet</code> ä¸­ï¼Œæˆ‘ä»¬æ¥æ”¶ <code>key/value</code> å½¢å¼çš„å‚æ•°ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡<code>getParameter</code>æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯å•†æˆ·ä¼ å…¥çš„æ˜¯ JSON æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ ¼å¼è¿›è¡Œè§£æï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addbook2&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook2</span><span class="hljs-params">(HttpServletRequest req)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();    Book book = om.readValue(req.getInputStream(), Book.class);    System.out.println(book);&#125;</code></pre></div><p>ä½†æ˜¯è¿™ç§è§£ææ–¹å¼æœ‰ç‚¹éº»çƒ¦ï¼Œåœ¨ SpringMVC ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ³¨è§£æ¥å¿«é€Ÿçš„å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬ä¸ºä¸€ä¸ªå¯¹è±¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/addbook3&quot;)</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook3</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span> </span>&#123;    System.out.println(book);&#125;</code></pre></div><p>è¿™æ ·å°±å¯ä»¥ç›´æ¥æ”¶åˆ°å‰ç«¯ä¼ æ¥çš„ JSON å­—ç¬¦ä¸²äº†ã€‚è¿™ä¹Ÿæ˜¯ <code>HttpMessageConverter </code>æä¾›çš„ç¬¬äºŒä¸ªåŠŸèƒ½</p><h2 id="12-RESTful"><a href="#12-RESTful" class="headerlink" title="12. RESTful"></a>12. RESTful</h2><p>è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹æ„è¯†åˆ°ï¼Œç½‘ç«™å³è½¯ä»¶ï¼Œè€Œä¸”æ˜¯ä¸€ç§æ–°å‹çš„è½¯ä»¶ã€‚è¿™ç§â€äº’è”ç½‘è½¯ä»¶â€é‡‡ç”¨å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼ï¼Œå»ºç«‹åœ¨åˆ†å¸ƒå¼ä½“ç³»ä¸Šï¼Œé€šè¿‡äº’è”ç½‘é€šä¿¡ï¼Œå…·æœ‰é«˜å»¶æ—¶ï¼ˆhigh latencyï¼‰ã€é«˜å¹¶å‘ç­‰ç‰¹ç‚¹ã€‚ç½‘ç«™å¼€å‘ï¼Œå®Œå…¨å¯ä»¥é‡‡ç”¨è½¯ä»¶å¼€å‘çš„æ¨¡å¼ã€‚ä½†æ˜¯ä¼ ç»Ÿä¸Šï¼Œè½¯ä»¶å’Œç½‘ç»œæ˜¯ä¸¤ä¸ªä¸åŒçš„é¢†åŸŸï¼Œå¾ˆå°‘æœ‰äº¤é›†ï¼›è½¯ä»¶å¼€å‘ä¸»è¦é’ˆå¯¹å•æœºç¯å¢ƒï¼Œç½‘ç»œåˆ™ä¸»è¦ç ”ç©¶ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ã€‚äº’è”ç½‘çš„å…´èµ·ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªé¢†åŸŸå¼€å§‹èåˆï¼Œç°åœ¨æˆ‘ä»¬å¿…é¡»è€ƒè™‘ï¼Œå¦‚ä½•å¼€å‘åœ¨äº’è”ç½‘ç¯å¢ƒä¸­ä½¿ç”¨çš„è½¯ä»¶ã€‚</p><p>RESTful æ¶æ„ï¼Œå°±æ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ç§äº’è”ç½‘è½¯ä»¶æ¶æ„ã€‚å®ƒç»“æ„æ¸…æ™°ã€ç¬¦åˆæ ‡å‡†ã€æ˜“äºç†è§£ã€æ‰©å±•æ–¹ä¾¿ï¼Œæ‰€ä»¥æ­£å¾—åˆ°è¶Šæ¥è¶Šå¤šç½‘ç«™çš„é‡‡ç”¨ã€‚</p><p>RESTful å®ƒä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ¶æ„ï¼Œä¸æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œ<strong>è€Œæ˜¯ä¸€ç§è§„èŒƒ</strong>ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘å…´èµ·ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½å¾ˆå°‘æåŠ RESTfulï¼Œä¸»è¦æ˜¯å› ä¸ºç”¨çš„å°‘ï¼Œç§»åŠ¨äº’è”ç½‘å…´èµ·åï¼ŒRESTful å¾—åˆ°äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œå› ä¸ºåœ¨ç§»åŠ¨äº’è”ç½‘å…´èµ·ä¹‹åï¼Œæˆ‘ä»¬å†å¼€å‘åç«¯åº”ç”¨ï¼Œå°±ä¸ä»…ä»…åªæ˜¯å¼€å‘ä¸€ä¸ªç½‘ç«™äº†ï¼Œè¿˜å¯¹åº”äº†å¤šä¸ªå‰ç«¯ï¼ˆAndroidã€iOSã€HTML5 ç­‰ç­‰ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡åç«¯æ¥å£æ˜¯ï¼Œå°±éœ€è¦è€ƒè™‘æ¥å£çš„å½¢å¼ï¼Œæ ¼å¼ï¼Œå‚æ•°çš„ä¼ é€’ç­‰ç­‰è¯¸å¤šé—®é¢˜äº†ã€‚</p><h3 id="12-1-èµ·æº"><a href="#12-1-èµ·æº" class="headerlink" title="12.1 èµ·æº"></a>12.1 èµ·æº</h3><p>REST è¿™ä¸ªè¯ï¼Œæ˜¯ Roy Thomas Fielding åœ¨ä»– 2000 å¹´çš„åšå£«è®ºæ–‡ä¸­æå‡ºçš„ã€‚</p><p>Fielding æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äººï¼Œä»–æ˜¯ HTTP åè®®ï¼ˆ1.0ç‰ˆå’Œ1.1ç‰ˆï¼‰çš„ä¸»è¦è®¾è®¡è€…ã€Apache æœåŠ¡å™¨è½¯ä»¶çš„ä½œè€…ä¹‹ä¸€ã€Apache åŸºé‡‘ä¼šçš„ç¬¬ä¸€ä»»ä¸»å¸­ã€‚æ‰€ä»¥ï¼Œä»–çš„è¿™ç¯‡è®ºæ–‡ä¸€ç»å‘è¡¨ï¼Œå°±å¼•èµ·äº†å…³æ³¨ï¼Œå¹¶ä¸”ç«‹å³å¯¹äº’è”ç½‘å¼€å‘äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚</p><p>ä»–è¿™æ ·ä»‹ç»è®ºæ–‡çš„å†™ä½œç›®çš„ï¼š</p><p>â€œæœ¬æ–‡ç ”ç©¶è®¡ç®—æœºç§‘å­¦ä¸¤å¤§å‰æ²¿â€”-è½¯ä»¶å’Œç½‘ç»œâ€”-çš„äº¤å‰ç‚¹ã€‚é•¿æœŸä»¥æ¥ï¼Œè½¯ä»¶ç ”ç©¶ä¸»è¦å…³æ³¨è½¯ä»¶è®¾è®¡çš„åˆ†ç±»ã€è®¾è®¡æ–¹æ³•çš„æ¼”åŒ–ï¼Œå¾ˆå°‘å®¢è§‚åœ°è¯„ä¼°ä¸åŒçš„è®¾è®¡é€‰æ‹©å¯¹ç³»ç»Ÿè¡Œä¸ºçš„å½±å“ã€‚è€Œç›¸ååœ°ï¼Œç½‘ç»œç ”ç©¶ä¸»è¦å…³æ³¨ç³»ç»Ÿä¹‹é—´é€šä¿¡è¡Œä¸ºçš„ç»†èŠ‚ã€å¦‚ä½•æ”¹è¿›ç‰¹å®šé€šä¿¡æœºåˆ¶çš„è¡¨ç°ï¼Œå¸¸å¸¸å¿½è§†äº†ä¸€ä¸ªäº‹å®ï¼Œé‚£å°±æ˜¯æ”¹å˜åº”ç”¨ç¨‹åºçš„äº’åŠ¨é£æ ¼æ¯”æ”¹å˜äº’åŠ¨åè®®ï¼Œå¯¹æ•´ä½“è¡¨ç°æœ‰æ›´å¤§çš„å½±å“ã€‚æˆ‘è¿™ç¯‡æ–‡ç« çš„å†™ä½œç›®çš„ï¼Œå°±æ˜¯æƒ³åœ¨ç¬¦åˆæ¶æ„åŸç†çš„å‰æä¸‹ï¼Œç†è§£å’Œè¯„ä¼°ä»¥ç½‘ç»œä¸ºåŸºç¡€çš„åº”ç”¨è½¯ä»¶çš„æ¶æ„è®¾è®¡ï¼Œå¾—åˆ°ä¸€ä¸ªåŠŸèƒ½å¼ºã€æ€§èƒ½å¥½ã€é€‚å®œé€šä¿¡çš„æ¶æ„ã€‚â€</p><h3 id="12-2-åç§°"><a href="#12-2-åç§°" class="headerlink" title="12.2 åç§°"></a>12.2 åç§°</h3><p>Fielding å°†ä»–å¯¹äº’è”ç½‘è½¯ä»¶çš„æ¶æ„åŸåˆ™ï¼Œå®šåä¸ºRESTï¼Œå³ Representational State Transfer çš„ç¼©å†™ã€‚æˆ‘å¯¹è¿™ä¸ªè¯ç»„çš„ç¿»è¯‘æ˜¯â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚</p><p>å¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆ REST åŸåˆ™ï¼Œå°±ç§°å®ƒä¸º RESTful æ¶æ„ã€‚</p><p>è¦ç†è§£ RESTful æ¶æ„ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯å»ç†è§£ Representational State Transfer è¿™ä¸ªè¯ç»„åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå®ƒçš„æ¯ä¸€ä¸ªè¯ä»£è¡¨äº†ä»€ä¹ˆæ¶µä¹‰ã€‚å¦‚æœä½ æŠŠè¿™ä¸ªåç§°ææ‡‚äº†ï¼Œä¹Ÿå°±ä¸éš¾ä½“ä¼š REST æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„è®¾è®¡ã€‚</p><h3 id="12-3-èµ„æºï¼ˆResourcesï¼‰"><a href="#12-3-èµ„æºï¼ˆResourcesï¼‰" class="headerlink" title="12.3 èµ„æºï¼ˆResourcesï¼‰"></a>12.3 èµ„æºï¼ˆResourcesï¼‰</h3><p>REST çš„åç§°â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ä¸­ï¼Œçœç•¥äº†ä¸»è¯­ã€‚â€è¡¨ç°å±‚â€å…¶å®æŒ‡çš„æ˜¯â€èµ„æºâ€ï¼ˆResourcesï¼‰çš„â€è¡¨ç°å±‚â€ã€‚</p><p>æ‰€è°“â€èµ„æºâ€ï¼Œå°±æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå®ä½“ï¼Œæˆ–è€…è¯´æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå…·ä½“ä¿¡æ¯ã€‚å®ƒå¯ä»¥æ˜¯ä¸€æ®µæ–‡æœ¬ã€ä¸€å¼ å›¾ç‰‡ã€ä¸€é¦–æ­Œæ›²ã€ä¸€ç§æœåŠ¡ï¼Œæ€»ä¹‹å°±æ˜¯ä¸€ä¸ªå…·ä½“çš„å®åœ¨ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ª URI ï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰æŒ‡å‘å®ƒï¼Œæ¯ç§èµ„æºå¯¹åº”ä¸€ä¸ªç‰¹å®šçš„ URIã€‚è¦è·å–è¿™ä¸ªèµ„æºï¼Œè®¿é—®å®ƒçš„ URI å°±å¯ä»¥ï¼Œå› æ­¤ URI å°±æˆäº†æ¯ä¸€ä¸ªèµ„æºçš„åœ°å€æˆ–ç‹¬ä¸€æ— äºŒçš„è¯†åˆ«ç¬¦ã€‚</p><p>æ‰€è°“â€ä¸Šç½‘â€ï¼Œå°±æ˜¯ä¸äº’è”ç½‘ä¸Šä¸€ç³»åˆ—çš„â€èµ„æºâ€äº’åŠ¨ï¼Œè°ƒç”¨å®ƒçš„ URIã€‚</p><blockquote><p>åœ¨ RESTful é£æ ¼çš„åº”ç”¨ä¸­ï¼Œæ¯ä¸€ä¸ª URI éƒ½ä»£è¡¨äº†ä¸€ä¸ªèµ„æºã€‚</p></blockquote><h3 id="12-4-è¡¨ç°å±‚ï¼ˆRepresentationï¼‰"><a href="#12-4-è¡¨ç°å±‚ï¼ˆRepresentationï¼‰" class="headerlink" title="12.4 è¡¨ç°å±‚ï¼ˆRepresentationï¼‰"></a>12.4 è¡¨ç°å±‚ï¼ˆRepresentationï¼‰</h3><p>â€œèµ„æºâ€æ˜¯ä¸€ç§ä¿¡æ¯å®ä½“ï¼Œå®ƒå¯ä»¥æœ‰å¤šç§å¤–åœ¨è¡¨ç°å½¢å¼ã€‚æˆ‘ä»¬æŠŠâ€èµ„æºâ€å…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼ï¼Œå«åšå®ƒçš„â€è¡¨ç°å±‚â€ï¼ˆRepresentationï¼‰ã€‚</p><p>æ¯”å¦‚ï¼Œæ–‡æœ¬å¯ä»¥ç”¨ txt æ ¼å¼è¡¨ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ HTML æ ¼å¼ã€XML æ ¼å¼ã€JSON æ ¼å¼è¡¨ç°ï¼Œç”šè‡³å¯ä»¥é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼›å›¾ç‰‡å¯ä»¥ç”¨ JPG æ ¼å¼è¡¨ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ PNG æ ¼å¼è¡¨ç°ã€‚</p><p>URI åªä»£è¡¨èµ„æºçš„å®ä½“ï¼Œä¸ä»£è¡¨å®ƒçš„å½¢å¼ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œæœ‰äº›ç½‘å€æœ€åçš„ â€œ.htmlâ€ åç¼€åæ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºè¿™ä¸ªåç¼€åè¡¨ç¤ºæ ¼å¼ï¼Œå±äº â€œè¡¨ç°å±‚â€ èŒƒç•´ï¼Œè€Œ URI åº”è¯¥åªä»£è¡¨â€èµ„æºâ€çš„ä½ç½®ã€‚å®ƒçš„å…·ä½“è¡¨ç°å½¢å¼ï¼Œåº”è¯¥åœ¨ HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ç”¨ Accept å’Œ Content-Type å­—æ®µæŒ‡å®šï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ‰æ˜¯å¯¹â€è¡¨ç°å±‚â€çš„æè¿°ã€‚</p><h3 id="12-5-çŠ¶æ€è½¬åŒ–ï¼ˆState-Transferï¼‰"><a href="#12-5-çŠ¶æ€è½¬åŒ–ï¼ˆState-Transferï¼‰" class="headerlink" title="12.5 çŠ¶æ€è½¬åŒ–ï¼ˆState Transferï¼‰"></a>12.5 çŠ¶æ€è½¬åŒ–ï¼ˆState Transferï¼‰</h3><p>è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œå°±ä»£è¡¨äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ä¸€ä¸ªäº’åŠ¨è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°æ•°æ®å’ŒçŠ¶æ€çš„å˜åŒ–ã€‚</p><p>äº’è”ç½‘é€šä¿¡åè®® HTTP åè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚å› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ“ä½œæœåŠ¡å™¨ï¼Œå¿…é¡»é€šè¿‡æŸç§æ‰‹æ®µï¼Œè®©æœåŠ¡å™¨ç«¯å‘ç”Ÿâ€çŠ¶æ€è½¬åŒ–â€ï¼ˆState Transferï¼‰ã€‚è€Œè¿™ç§è½¬åŒ–æ˜¯å»ºç«‹åœ¨è¡¨ç°å±‚ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å°±æ˜¯â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚</p><p>å®¢æˆ·ç«¯ç”¨åˆ°çš„æ‰‹æ®µï¼Œåªèƒ½æ˜¯ HTTP åè®®ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ HTTP åè®®é‡Œé¢ï¼Œå››ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯ï¼šGETã€POSTã€PUTã€DELETEã€‚å®ƒä»¬åˆ†åˆ«å¯¹åº”å››ç§åŸºæœ¬æ“ä½œï¼š</p><ul><li>GET ç”¨æ¥è·å–èµ„æº</li><li>POST ç”¨æ¥æ–°å»ºèµ„æºï¼ˆä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°èµ„æºï¼‰</li><li>PUT ç”¨æ¥æ›´æ–°èµ„æº</li><li>DELETE ç”¨æ¥åˆ é™¤èµ„æº</li></ul><h3 id="12-6-ç»¼è¿°"><a href="#12-6-ç»¼è¿°" class="headerlink" title="12.6 ç»¼è¿°"></a>12.6 ç»¼è¿°</h3><p>ç»¼åˆä¸Šé¢çš„è§£é‡Šï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä»€ä¹ˆæ˜¯ RESTful æ¶æ„ï¼š</p><ul><li><strong>æ¯ä¸€ä¸ª URI ä»£è¡¨ä¸€ç§èµ„æºï¼›</strong></li><li><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¼ é€’è¿™ç§èµ„æºçš„æŸç§è¡¨ç°å±‚ï¼›</strong></li><li><strong>å®¢æˆ·ç«¯é€šè¿‡å››ä¸ª HTTP åŠ¨è¯ï¼Œå¯¹æœåŠ¡å™¨ç«¯èµ„æºè¿›è¡Œæ“ä½œï¼Œå®ç°â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€</strong></li></ul><h3 id="12-7-è¯¯åŒº"><a href="#12-7-è¯¯åŒº" class="headerlink" title="12.7 è¯¯åŒº"></a>12.7 è¯¯åŒº</h3><p>RESTful æ¶æ„æœ‰ä¸€äº›å…¸å‹çš„è®¾è®¡è¯¯åŒºã€‚</p><p>æœ€å¸¸è§çš„ä¸€ç§è®¾è®¡é”™è¯¯ï¼Œå°±æ˜¯ URI åŒ…å«åŠ¨è¯ã€‚å› ä¸ºâ€èµ„æºâ€è¡¨ç¤ºä¸€ç§å®ä½“ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åè¯ï¼ŒURI ä¸åº”è¯¥æœ‰åŠ¨è¯ï¼ŒåŠ¨è¯åº”è¯¥æ”¾åœ¨ HTTP åè®®ä¸­ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸä¸ª URI æ˜¯ /posts/show/1ï¼Œå…¶ä¸­ show æ˜¯åŠ¨è¯ï¼Œè¿™ä¸ª URI å°±è®¾è®¡é”™äº†ï¼Œæ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ /posts/1ï¼Œç„¶åç”¨ GET æ–¹æ³•è¡¨ç¤º showã€‚</p><p>å¦‚æœæŸäº›åŠ¨ä½œæ˜¯HTTPåŠ¨è¯è¡¨ç¤ºä¸äº†çš„ï¼Œä½ å°±åº”è¯¥æŠŠåŠ¨ä½œåšæˆä¸€ç§èµ„æºã€‚æ¯”å¦‚ç½‘ä¸Šæ±‡æ¬¾ï¼Œä»è´¦æˆ· 1 å‘è´¦æˆ· 2 æ±‡æ¬¾ 500 å…ƒï¼Œé”™è¯¯çš„ URI æ˜¯ï¼š</p><ul><li>POST /accounts/1/transfer/500/to/2</li></ul><p>æ­£ç¡®çš„å†™æ³•æ˜¯æŠŠåŠ¨è¯ transfer æ”¹æˆåè¯ transactionï¼Œèµ„æºä¸èƒ½æ˜¯åŠ¨è¯ï¼Œä½†æ˜¯å¯ä»¥æ˜¯ä¸€ç§æœåŠ¡ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">POST</span> <span class="hljs-string">/transaction HTTP/1.1</span><span class="hljs-attr">Host</span>: <span class="hljs-string">127.0.0.1</span><span class="hljs-attr">from</span>=<span class="hljs-string">1&amp;to=2&amp;amount=500.00</span></code></pre></div><p>å¦ä¸€ä¸ªè®¾è®¡è¯¯åŒºï¼Œå°±æ˜¯åœ¨URIä¸­åŠ å…¥ç‰ˆæœ¬å·ï¼š</p><ul><li><a href="http://www.example.com/app/1.0/foo">http://www.example.com/app/1.0/foo</a></li><li><a href="http://www.example.com/app/1.1/foo">http://www.example.com/app/1.1/foo</a></li><li><a href="http://www.example.com/app/2.0/foo">http://www.example.com/app/2.0/foo</a></li></ul><p>å› ä¸ºä¸åŒçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç†è§£æˆåŒä¸€ç§èµ„æºçš„ä¸åŒè¡¨ç°å½¢å¼ï¼Œæ‰€ä»¥åº”è¯¥é‡‡ç”¨åŒä¸€ä¸ª URIã€‚ç‰ˆæœ¬å·å¯ä»¥åœ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯çš„ Accept å­—æ®µä¸­è¿›è¡ŒåŒºåˆ†ï¼ˆå‚è§ Versioning REST Servicesï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">Accept</span>: <span class="hljs-string">vnd.example-com.foo+json; version=1.0</span><span class="hljs-attr">Accept</span>: <span class="hljs-string">vnd.example-com.foo+json; version=1.1</span><span class="hljs-attr">Accept</span>: <span class="hljs-string">vnd.example-com.foo+json; version=2.0</span></code></pre></div><h3 id="12-8-å‘½åè§„åˆ™"><a href="#12-8-å‘½åè§„åˆ™" class="headerlink" title="12.8 å‘½åè§„åˆ™"></a>12.8 å‘½åè§„åˆ™</h3><p>è·¯å¾„åˆç§°â€ç»ˆç‚¹â€ï¼ˆendpointï¼‰ï¼Œè¡¨ç¤º API çš„å…·ä½“ç½‘å€ã€‚å®é™…å¼€å‘ä¸­å¸¸è§çš„è§„èŒƒå¦‚ä¸‹ï¼š</p><ol><li><strong>ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼ŒAPI ä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚</strong>å› ä¸º REST ä¸­çš„èµ„æºå¾€å¾€å’Œæ•°æ®åº“ä¸­çš„è¡¨å¯¹åº”ï¼Œè€Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„â€é›†åˆâ€ï¼ˆcollectionï¼‰ã€‚å¦‚æœ API è°ƒç”¨å¹¶ä¸æ¶‰åŠèµ„æºï¼ˆå¦‚è®¡ç®—ï¼Œç¿»è¯‘ç­‰æ“ä½œï¼‰çš„è¯ï¼Œå¯ä»¥ç”¨åŠ¨è¯ã€‚æ¯”å¦‚ï¼š<code>GET /calculate?param1=11&amp;param2=33</code> ã€‚</li><li><strong>ä¸ç”¨å¤§å†™å­—æ¯ï¼Œå»ºè®®ç”¨ä¸­æ  - ä¸ç”¨ä¸‹æ  _</strong> ã€‚æ¯”å¦‚é‚€è¯·ç å†™æˆ <code>invitation-code</code>è€Œä¸æ˜¯ <del>invitation_code</del> ã€‚</li><li><strong>å–„ç”¨ç‰ˆæœ¬åŒ– API</strong>ã€‚å½“æˆ‘ä»¬çš„ API å‘ç”Ÿäº†é‡å¤§æ”¹å˜è€Œä¸å…¼å®¹å‰æœŸç‰ˆæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ URL æ¥å®ç°ç‰ˆæœ¬åŒ–ï¼Œæ¯”å¦‚ <code>Http://api.example.com/v1</code>ã€<code>http://apiv1.example.com</code> ã€‚ç‰ˆæœ¬ä¸å¿…éè¦æ˜¯æ•°å­—ï¼Œåªæ˜¯æ•°å­—ç”¨çš„æœ€å¤šï¼Œæ—¥æœŸã€å­£èŠ‚éƒ½å¯ä»¥ä½œä¸ºç‰ˆæœ¬æ ‡è¯†ç¬¦ï¼Œé¡¹ç›®å›¢é˜Ÿè¾¾æˆå…±è¯†å°±å¯ã€‚</li><li><strong>æ¥å£å°½é‡ä½¿ç”¨åè¯ï¼Œé¿å…ä½¿ç”¨åŠ¨è¯ã€‚</strong> RESTful API æ“ä½œï¼ˆHTTP Methodï¼‰çš„æ˜¯èµ„æºï¼ˆåè¯ï¼‰è€Œä¸æ˜¯åŠ¨ä½œï¼ˆåŠ¨è¯ï¼‰ã€‚</li></ol><blockquote><p>GET    /classesï¼šåˆ—å‡ºæ‰€æœ‰ç­çº§<br>POST   /classesï¼šæ–°å»ºä¸€ä¸ªç­çº§<br>GET    /classes/classIdï¼šè·å–æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯<br>PUT    /classes/classIdï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘æ•´ä½“æ›´æ–°ï¼‰<br>PATCH  /classes/classIdï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘éƒ¨åˆ†æ›´æ–°ï¼‰<br>DELETE /classes/classIdï¼šåˆ é™¤æŸä¸ªç­çº§<br>GET    /classes/classId/teachersï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰è€å¸ˆçš„ä¿¡æ¯<br>GET    /classes/classId/studentsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯<br>DELETE classes/classId/teachers/IDï¼šåˆ é™¤æŸä¸ªæŒ‡å®šç­çº§ä¸‹çš„æŒ‡å®šçš„è€å¸ˆçš„ä¿¡æ¯</p></blockquote><p>ç†æ¸…èµ„æºçš„å±‚æ¬¡ç»“æ„ï¼Œæ¯”å¦‚ä¸šåŠ¡é’ˆå¯¹çš„èŒƒå›´æ˜¯å­¦æ ¡ï¼Œé‚£ä¹ˆå­¦æ ¡ä¼šæ˜¯ä¸€çº§èµ„æº:<code>/schools</code>ï¼Œè€å¸ˆ: <code>/schools/teachers</code>ï¼Œå­¦ç”Ÿ: <code>/schools/students</code> å°±æ˜¯äºŒçº§èµ„æº</p><p><strong>è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰</strong></p><p>å¦‚æœæˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™éœ€è¦æ·»åŠ ç‰¹å®šæ¡ä»¶çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ url å‚æ•°çš„å½¢å¼ã€‚æ¯”å¦‚æˆ‘ä»¬è¦æŸ¥è¯¢ state çŠ¶æ€ä¸º active å¹¶ä¸” name ä¸º guidegege çš„ç­çº§ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">GET</span>    <span class="hljs-string">/classes?state=active&amp;name=guidegege</span></code></pre></div><p>æ¯”å¦‚æˆ‘ä»¬è¦å®ç°åˆ†é¡µæŸ¥è¯¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">GET</span>    <span class="hljs-string">/classes?page=1&amp;size=10 //æŒ‡å®šç¬¬1é¡µï¼Œæ¯é¡µ10ä¸ªæ•°æ®</span></code></pre></div><p><strong>çŠ¶æ€ç ï¼ˆStatus Codesï¼‰</strong></p><table><thead><tr><th>2xxï¼šæˆåŠŸ</th><th>3xxï¼šé‡å®šå‘</th><th>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯</th><th>5xxï¼šæœåŠ¡å™¨é”™è¯¯</th></tr></thead><tbody><tr><td>200 æˆåŠŸ</td><td>301 æ°¸ä¹…é‡å®šå‘</td><td>400 é”™è¯¯è¯·æ±‚</td><td>500 æœåŠ¡å™¨é”™è¯¯</td></tr><tr><td>201 åˆ›å»º</td><td>304 èµ„æºæœªä¿®æ”¹</td><td>401 æœªæˆæƒ</td><td>502 ç½‘å…³é”™è¯¯</td></tr><tr><td></td><td></td><td>403 ç¦æ­¢è®¿é—®</td><td>504 ç½‘å…³è¶…æ—¶</td></tr><tr><td></td><td></td><td>404 æœªæ‰¾åˆ°</td><td></td></tr><tr><td></td><td></td><td>405 è¯·æ±‚æ–¹æ³•ä¸å¯¹</td><td></td></tr></tbody></table><h3 id="12-9-SpringMVC-çš„æ”¯æŒ"><a href="#12-9-SpringMVC-çš„æ”¯æŒ" class="headerlink" title="12.9 SpringMVC çš„æ”¯æŒ"></a>12.9 SpringMVC çš„æ”¯æŒ</h3><p>SpringMVC å¯¹ RESTful æä¾›äº†éå¸¸å…¨é¢çš„æ”¯æŒï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªæ³¨è§£ï¼š</p><ul><li><code>@RestController</code></li></ul><p>è¿™ä¸ªæ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="hljs-meta">@Documented</span><span class="hljs-meta">@Controller</span><span class="hljs-meta">@ResponseBody</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RestController &#123;<span class="hljs-comment">/**</span><span class="hljs-comment"> * The value may indicate a suggestion for a logical component name,</span><span class="hljs-comment"> * to be turned into a Spring bean in case of an autodetected component.</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the suggested component name, if any (or empty String otherwise)</span><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 4.0.1</span><span class="hljs-comment"> */</span><span class="hljs-meta">@AliasFor(annotation = Controller.class)</span><span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> &quot;&quot;</span>;&#125;</code></pre></div><p>ä¸€èˆ¬ï¼Œç›´æ¥ç”¨ <code>@RestController</code> æ¥æ ‡è®° Controllerï¼Œå¯ä»¥ä¸ä½¿ç”¨ <code>@Controller</code></p><p>è¯·æ±‚æ–¹æ³•ä¸­ï¼Œæä¾›äº†å¸¸è§çš„è¯·æ±‚æ–¹æ³•ï¼š</p><ul><li><code>@PostMapping</code></li><li><code>@GetMapping</code></li><li><code>@PutMapping</code></li><li><code>@DeleteMapping</code></li></ul><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªæå–è¯·æ±‚åœ°å€ä¸­çš„å‚æ•°çš„æ³¨è§£ <code>@PathVariable</code></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/book/&#123;id&#125;&quot;)</span><span class="hljs-comment">//http://localhost:8080/book/2</span><span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">getBookById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;    Book book = <span class="hljs-keyword">new</span> Book();    book.setId(id);    <span class="hljs-keyword">return</span> book;&#125;</code></pre></div><p>å‚æ•° 2 å°†è¢«ä¼ é€’åˆ° id è¿™ä¸ªå˜é‡ä¸Š</p><h2 id="13-é™æ€èµ„æºè®¿é—®"><a href="#13-é™æ€èµ„æºè®¿é—®" class="headerlink" title="13. é™æ€èµ„æºè®¿é—®"></a>13. é™æ€èµ„æºè®¿é—®</h2><p>åœ¨ SpringMVC ä¸­ï¼Œé™æ€èµ„æºï¼Œé»˜è®¤éƒ½æ˜¯è¢«æ‹¦æˆªçš„ï¼Œä¾‹å¦‚ htmlã€jsã€cssã€jpgã€pngã€txtã€pdf ç­‰ç­‰ï¼Œéƒ½æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ã€‚å› ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½è¢«æ‹¦æˆªäº†ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹é™æ€èµ„æºï¼Œæˆ‘ä»¬è¦åšé¢å¤–å¤„ç†ï¼Œå¤„ç†æ–¹å¼å¾ˆç®€å•ï¼Œç›´æ¥åœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/static/html/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/static/html/&quot;</span>/&gt;</span></code></pre></div><p>mapping è¡¨ç¤ºæ˜ å°„è§„åˆ™ï¼Œä¹Ÿæ˜¯æ‹¦æˆªè§„åˆ™ï¼Œå°±æ˜¯è¯´ï¼Œå¦‚æœè¯·æ±‚åœ°å€æ˜¯<code>/static/html</code>è¿™æ ·çš„æ ¼å¼çš„è¯ï¼Œé‚£ä¹ˆå¯¹åº”çš„èµ„æºå°±å»<code>/static/html/</code>è¿™ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾ã€‚</p><p>åœ¨æ˜ å°„è·¯å¾„çš„å®šä¹‰ä¸­ï¼Œæœ€åæ˜¯ä¸¤ä¸ª *ï¼Œè¿™æ˜¯ä¸€ç§ Ant é£æ ¼çš„è·¯å¾„åŒ¹é…ç¬¦å·ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªé€šé…ç¬¦ï¼š</p><table><thead><tr><th align="left">é€šé…ç¬¦</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">**</td><td align="left">åŒ¹é…å¤šå±‚è·¯å¾„</td></tr><tr><td align="left">*</td><td align="left">åŒ¹é…ä¸€å±‚è·¯å¾„</td></tr><tr><td align="left">?</td><td align="left">åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td></tr></tbody></table><p>ä¸€ä¸ªæ¯”è¾ƒåŸå§‹çš„é…ç½®æ–¹å¼å¯èƒ½å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/static/html/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/static/html/&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/static/js/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/static/js/&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/static/css/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/static/css/&quot;</span>/&gt;</span></code></pre></div><p>ä½†æ˜¯ï¼Œç”±äº ** å¯ä»¥è¡¨ç¤ºå¤šçº§è·¯å¾„ï¼Œæ‰€ä»¥ï¼Œä»¥ä¸Šé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç®€åŒ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/&quot;</span>/&gt;</span></code></pre></div><h2 id="14-æ‹¦æˆªå™¨"><a href="#14-æ‹¦æˆªå™¨" class="headerlink" title="14. æ‹¦æˆªå™¨"></a>14. æ‹¦æˆªå™¨</h2><p>SpringMVC ä¸­çš„æ‹¦æˆªå™¨ï¼Œç›¸å½“äº<code>Jsp/Servlet</code>ä¸­çš„è¿‡æ»¤å™¨ï¼Œåªä¸è¿‡æ‹¦æˆªå™¨çš„åŠŸèƒ½æ›´ä¸ºå¼ºå¤§ã€‚</p><p>æ‹¦æˆªå™¨çš„å®šä¹‰éå¸¸å®¹æ˜“ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInterceptor1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¿™ä¸ªæ˜¯è¯·æ±‚é¢„å¤„ç†çš„æ–¹æ³•ï¼Œåªæœ‰å½“è¿™ä¸ªæ–¹æ³•è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œåé¢çš„æ–¹æ³•æ‰ä¼šæ‰§è¡Œ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor1:preHandle&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor1:postHandle&quot;</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor1:afterCompletion&quot;</span>);    &#125;&#125;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInterceptor2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¿™ä¸ªæ˜¯è¯·æ±‚é¢„å¤„ç†çš„æ–¹æ³•ï¼Œåªæœ‰å½“è¿™ä¸ªæ–¹æ³•è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œåé¢çš„æ–¹æ³•æ‰ä¼šæ‰§è¡Œ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor2:preHandle&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor2:postHandle&quot;</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">&quot;MyInterceptor2:afterCompletion&quot;</span>);    &#125;&#125;</code></pre></div><p>æ‹¦æˆªå™¨å®šä¹‰å¥½ä¹‹åï¼Œéœ€è¦åœ¨ SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myInterceptor1&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myInterceptor2&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span></code></pre></div><p>å¦‚æœå­˜åœ¨å¤šä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>preHandle æŒ‰æ‹¦æˆªå™¨å®šä¹‰é¡ºåºè°ƒç”¨</li><li>postHandler æŒ‰æ‹¦æˆªå™¨å®šä¹‰é€†åºè°ƒç”¨</li><li>afterCompletion æŒ‰æ‹¦æˆªå™¨å®šä¹‰é€†åºè°ƒç”¨</li><li>postHandler åœ¨æ‹¦æˆªå™¨é“¾å†…æ‰€æœ‰æ‹¦æˆªå™¨è¿”æˆåŠŸè°ƒç”¨</li><li>afterCompletion åªæœ‰ preHandle è¿”å› true æ‰è°ƒç”¨</li></ul><h1 id="ç¬¬ä¸ƒç« ã€SpringMVCæ•´åˆ"><a href="#ç¬¬ä¸ƒç« ã€SpringMVCæ•´åˆ" class="headerlink" title="ç¬¬ä¸ƒç« ã€SpringMVCæ•´åˆ"></a>ç¬¬ä¸ƒç« ã€SpringMVCæ•´åˆ</h1><h2 id="1-MVCæ¡†æ¶æ•´åˆæ€æƒ³"><a href="#1-MVCæ¡†æ¶æ•´åˆæ€æƒ³" class="headerlink" title="1. MVCæ¡†æ¶æ•´åˆæ€æƒ³"></a>1. MVCæ¡†æ¶æ•´åˆæ€æƒ³</h2><h3 id="1-1-æ­å»ºWebè¿è¡Œç¯å¢ƒ"><a href="#1-1-æ­å»ºWebè¿è¡Œç¯å¢ƒ" class="headerlink" title="1.1 æ­å»ºWebè¿è¡Œç¯å¢ƒ"></a>1.1 æ­å»ºWebè¿è¡Œç¯å¢ƒ</h3><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-beans<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.18<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.48<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjrt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="1-2-ä¸ºä»€ä¹ˆè¦æ•´åˆMVCæ¡†æ¶"><a href="#1-2-ä¸ºä»€ä¹ˆè¦æ•´åˆMVCæ¡†æ¶" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆè¦æ•´åˆMVCæ¡†æ¶"></a>1.2 ä¸ºä»€ä¹ˆè¦æ•´åˆMVCæ¡†æ¶</h3><ul><li>MVCæ¡†æ¶æä¾›äº†æ§åˆ¶å™¨(Controller)è°ƒç”¨Service<br>DAO â€”&gt; Service </li><li>è¯·æ±‚å“åº”çš„å¤„ç†</li><li>æ¥å—è¯·æ±‚å‚æ•° request.getParameter(â€œâ€)</li><li>æ§åˆ¶ç¨‹åºçš„è¿è¡Œæµç¨‹</li><li>è§†å›¾è§£æ (JSP JSON Freemarker Thyemeleaf )</li></ul><h3 id="1-3-Springå¯ä»¥æ•´åˆé‚£äº›MVCæ¡†æ¶"><a href="#1-3-Springå¯ä»¥æ•´åˆé‚£äº›MVCæ¡†æ¶" class="headerlink" title="1.3 Springå¯ä»¥æ•´åˆé‚£äº›MVCæ¡†æ¶"></a>1.3 Springå¯ä»¥æ•´åˆé‚£äº›MVCæ¡†æ¶</h3><ul><li>struts1 </li><li>webwork</li><li>jsf</li><li>struts2</li><li>springMVC </li></ul><h3 id="1-4-Springæ•´åˆMVCæ¡†æ¶çš„æ ¸å¿ƒæ€è·¯"><a href="#1-4-Springæ•´åˆMVCæ¡†æ¶çš„æ ¸å¿ƒæ€è·¯" class="headerlink" title="1.4 Springæ•´åˆMVCæ¡†æ¶çš„æ ¸å¿ƒæ€è·¯"></a>1.4 Springæ•´åˆMVCæ¡†æ¶çš„æ ¸å¿ƒæ€è·¯</h3><h4 id="1-4-1-å‡†å¤‡å·¥å‚"><a href="#1-4-1-å‡†å¤‡å·¥å‚" class="headerlink" title="1.4.1 å‡†å¤‡å·¥å‚"></a>1.4.1 å‡†å¤‡å·¥å‚</h4><p><strong>Web å¼€å‘è¿‡ç¨‹ä¸­å¦‚ä½•åˆ›å»ºå·¥å‚?</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">ApplicationContext ctx = <span class="hljs-keyword">new</span> WebXmlApplicationContext(<span class="hljs-string">&quot;/applicationContext.xml&quot;</span>);</code></pre></div><p><strong>å¦‚ä½•ä¿è¯å·¥å‚å”¯ä¸€ï¼ŒåŒæ—¶è¢«å…±ç”¨ï¼Ÿ</strong></p><ul><li>å…±ç”¨ï¼šå·¥å‚å­˜å‚¨åœ¨ <code>ServletContext</code> è¿™ä¸ªä½œç”¨åŸŸä¸­ï¼Œ<code>ServletContext.setAttribute(&quot;xxx&quot;, ctx);</code></li><li>å”¯ä¸€ï¼šåœ¨ <code>ServletContext</code> å¯¹è±¡åˆ›å»ºçš„åŒæ—¶åˆ›å»ºå·¥å‚<ul><li><code>ServletContextListener</code> åœ¨ <code>ServletContext</code> å¯¹è±¡åˆ›å»ºçš„åŒæ—¶ï¼Œè¢«è°ƒç”¨ï¼ˆåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼‰ï¼ŒæŠŠåˆ›å»ºå·¥å‚çš„ä»£ç å†™åœ¨ <code>ServletContextListener</code> ä¸­ï¼Œä¹Ÿä¼šä¿è¯åªè°ƒç”¨ä¸€æ¬¡ï¼Œä¿è¯äº†å·¥å‚çš„å”¯ä¸€æ€§</li></ul></li></ul><p><strong>Spring å°è£…äº†ä¸€ä¸ª <code>ContextLoaderListener</code>ï¼Œä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š</strong></p><ol><li>åˆ›å»ºå·¥å‚</li><li>æŠŠå·¥å‚å­˜åœ¨ <code>ServletContext</code> ä¸­</li></ol><p><code>ContextLoaderListener</code> ä½¿ç”¨æ–¹å¼ï¼š<code>web.xml</code> ä¸­</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span> org.springframework.web.context.ContextLoaderListener <span class="hljs-tag">&lt;/<span class="hljs-name">listen-class</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span> contextConfigLocation <span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span> classpath:applicationContext.xml <span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span></code></pre></div><p>åŒæ—¶éœ€è¦åœ¨<code>web.xml</code> ä¸­ä¹Ÿéœ€è¦åŠ ä¸ŠMVCç›¸å…³</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>      <span class="hljs-comment">&lt;!--MVCçš„é…ç½®æ–‡ä»¶--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></code></pre></div><h4 id="1-4-2-ä»£ç æ•´åˆ"><a href="#1-4-2-ä»£ç æ•´åˆ" class="headerlink" title="1.4.2 ä»£ç æ•´åˆ"></a>1.4.2 ä»£ç æ•´åˆ</h4><blockquote><p>ä¾èµ–æ³¨å…¥ï¼šæŠŠSeviceå¯¹è±¡æ³¨å…¥ä¸ªæ§åˆ¶å™¨å¯¹è±¡</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200520143653347.png" alt="image-20200520143653347"></p><h2 id="2-åŸºäºæ³¨è§£SpringMVC"><a href="#2-åŸºäºæ³¨è§£SpringMVC" class="headerlink" title="2 .åŸºäºæ³¨è§£SpringMVC"></a>2 .åŸºäºæ³¨è§£SpringMVC</h2><h3 id="2-1-åˆ›å»ºå·¥ç¨‹"><a href="#2-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="2.1 åˆ›å»ºå·¥ç¨‹"></a>2.1 åˆ›å»ºå·¥ç¨‹</h3><p>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ Maven å·¥ç¨‹ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œå¯ä»¥ä¸å¿…åˆ›å»º Web å·¥ç¨‹ï¼‰ï¼Œå¹¶æ·»åŠ  SpringMVC çš„ä¾èµ–ï¼ŒåŒæ—¶ï¼Œè¿™é‡Œç¯å¢ƒçš„æ­å»ºéœ€è¦ç”¨åˆ° Servlet ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥ Servlet çš„ä¾èµ–ï¼ˆä¸€å®šä¸èƒ½ä½¿ç”¨ä½ç‰ˆæœ¬çš„ Servletï¼‰ï¼Œæœ€ç»ˆçš„ pom.xml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.6.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="2-2-æ·»åŠ -Spring-é…ç½®"><a href="#2-2-æ·»åŠ -Spring-é…ç½®" class="headerlink" title="2.2 æ·»åŠ  Spring é…ç½®"></a>2.2 æ·»åŠ  Spring é…ç½®</h3><p>å·¥ç¨‹åˆ›å»ºæˆåŠŸä¹‹åï¼Œé¦–å…ˆæ·»åŠ  Spring çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;, useDefaultFilters = true, excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION, classes = Controller.class)&#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringConfig</span> </span>&#123;&#125;</code></pre></div><ul><li><code>@Configuration</code> æ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œåœ¨æˆ‘ä»¬è¿™é‡Œï¼Œè¿™ä¸ªé…ç½®çš„ä½œç”¨ç±»ä¼¼äº<code> applicationContext.xml</code></li><li><code>@ComponentScan </code>æ³¨è§£è¡¨ç¤ºé…ç½®åŒ…æ‰«æï¼Œé‡Œè¾¹çš„å±æ€§å’Œ xml é…ç½®ä¸­çš„å±æ€§éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œ<code>useDefaultFilters</code> è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤å™¨ï¼Œç„¶ååˆé™¤å» Controller æ³¨è§£ï¼Œå³åœ¨ Spring å®¹å™¨ä¸­æ‰«æé™¤äº† Controller ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰ Bean ã€‚</li></ul><h3 id="2-3-æ·»åŠ -SpringMVC-é…ç½®"><a href="#2-3-æ·»åŠ -SpringMVC-é…ç½®" class="headerlink" title="2.3 æ·»åŠ  SpringMVC é…ç½®"></a>2.3 æ·»åŠ  SpringMVC é…ç½®</h3><p>æ¥ä¸‹æ¥å†æ¥åˆ›å»º springmvc çš„é…ç½®æ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;,useDefaultFilters = false,includeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION,classes = Controller.class)&#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> </span>&#123;&#125;</code></pre></div><p><strong>æ³¨æ„ï¼Œå¦‚æœä¸éœ€è¦åœ¨ SpringMVC ä¸­æ·»åŠ å…¶ä»–çš„é¢å¤–é…ç½®ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚å³ è§†å›¾è§£æå™¨ã€JSON è§£æã€æ–‡ä»¶ä¸Šä¼ â€¦â€¦ç­‰ç­‰ï¼Œå¦‚æœéƒ½ä¸éœ€è¦é…ç½®çš„è¯ï¼Œè¿™æ ·å°±å¯ä»¥äº†</strong></p><h3 id="2-4-é…ç½®-web-xml"><a href="#2-4-é…ç½®-web-xml" class="headerlink" title="2.4 é…ç½® web.xml"></a>2.4 é…ç½® web.xml</h3><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ web.xml æ–‡ä»¶ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java ä»£ç å»ä»£æ›¿ web.xml æ–‡ä»¶ï¼Œè¿™é‡Œä¼šç”¨åˆ° <code>WebApplicationInitializer</code> ï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebInit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebApplicationInitializer</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStartup</span><span class="hljs-params">(ServletContext servletContext)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;        <span class="hljs-comment">//é¦–å…ˆæ¥åŠ è½½ SpringMVC çš„é…ç½®æ–‡ä»¶</span>        AnnotationConfigWebApplicationContext ctx = <span class="hljs-keyword">new</span> AnnotationConfigWebApplicationContext();        ctx.register(SpringMVCConfig.class);        <span class="hljs-comment">// æ·»åŠ  DispatcherServlet</span>        ServletRegistration.Dynamic springmvc = servletContext.addServlet(<span class="hljs-string">&quot;springmvc&quot;</span>, <span class="hljs-keyword">new</span> DispatcherServlet(ctx));        <span class="hljs-comment">// ç»™ DispatcherServlet æ·»åŠ è·¯å¾„æ˜ å°„</span>        springmvc.addMapping(<span class="hljs-string">&quot;/&quot;</span>);        <span class="hljs-comment">// ç»™ DispatcherServlet æ·»åŠ å¯åŠ¨æ—¶æœº</span>        springmvc.setLoadOnStartup(<span class="hljs-number">1</span>);    &#125;&#125;</code></pre></div><p><code>WebInit</code> çš„ä½œç”¨ç±»ä¼¼äº web.xmlï¼Œè¿™ä¸ªç±»éœ€è¦å®ç° <code>WebApplicationInitializer</code> æ¥å£ï¼Œå¹¶å®ç°æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œ<code>onStartup</code> æ–¹æ³•ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åšä¸€äº›é¡¹ç›®åˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚åŠ è½½ SpringMVC å®¹å™¨ï¼Œæ·»åŠ è¿‡æ»¤å™¨ï¼Œæ·»åŠ  Listenerã€æ·»åŠ  Servlet ç­‰ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>ç”±äºæˆ‘ä»¬åœ¨ WebInit ä¸­åªæ˜¯æ·»åŠ äº† SpringMVC çš„é…ç½®ï¼Œè¿™æ ·é¡¹ç›®åœ¨å¯åŠ¨æ—¶åªä¼šå»åŠ è½½ SpringMVC å®¹å™¨ï¼Œè€Œä¸ä¼šå»åŠ è½½ Spring å®¹å™¨ï¼Œå¦‚æœä¸€å®šè¦åŠ è½½ Spring å®¹å™¨ï¼Œéœ€è¦æˆ‘ä»¬ä¿®æ”¹ SpringMVC çš„é…ç½®ï¼Œåœ¨ SpringMVC é…ç½®çš„åŒ…æ‰«æä¸­ä¹Ÿå»æ‰«æ<code>@Configuration</code>æ³¨è§£ï¼Œè¿›è€ŒåŠ è½½ Spring å®¹å™¨ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç›´æ¥åœ¨é¡¹ç›®ä¸­èˆå¼ƒ Spring é…ç½®ï¼Œç›´æ¥å°†æ‰€æœ‰é…ç½®æ”¾åˆ° SpringMVC çš„é…ç½®ä¸­æ¥å®Œæˆï¼Œè¿™ä¸ªåœ¨ SSM æ•´åˆæ—¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œè¾ƒå¤šé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œç¬¬äºŒç§æ–¹æ¡ˆï¼ŒSpringMVC çš„é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> </span>&#123;&#125;</code></pre></div><p>è¿™ç§æ–¹æ¡ˆä¸­ï¼Œæ‰€æœ‰çš„æ³¨è§£éƒ½åœ¨ SpringMVC ä¸­æ‰«æï¼Œé‡‡ç”¨è¿™ç§æ–¹æ¡ˆçš„è¯ï¼Œåˆ™ Spring çš„é…ç½®æ–‡ä»¶å°±å¯ä»¥åˆ é™¤äº†</p><h3 id="2-5-æµ‹è¯•"><a href="#2-5-æµ‹è¯•" class="headerlink" title="2.5 æµ‹è¯•"></a>2.5 æµ‹è¯•</h3><p>æœ€åï¼Œæ·»åŠ ä¸€ä¸ª HelloController ï¼Œç„¶åå¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><p>å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®æ¥å£ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/10-1.png" alt="img"></p><h3 id="2-6-å…¶ä»–é…ç½®"><a href="#2-6-å…¶ä»–é…ç½®" class="headerlink" title="2.6 å…¶ä»–é…ç½®"></a>2.6 å…¶ä»–é…ç½®</h3><h4 id="2-6-1-é™æ€èµ„æºè¿‡æ»¤"><a href="#2-6-1-é™æ€èµ„æºè¿‡æ»¤" class="headerlink" title="2.6.1 é™æ€èµ„æºè¿‡æ»¤"></a>2.6.1 é™æ€èµ„æºè¿‡æ»¤</h4><p>é™æ€èµ„æºè¿‡æ»¤åœ¨ SpringMVC çš„ XML ä¸­çš„é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/&quot;</span>/&gt;</span></code></pre></div><p>åœ¨ Java é…ç½®çš„ SSM ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦é…ç½®é™æ€èµ„æºè¿‡æ»¤ï¼Œéœ€è¦è®© SpringMVC çš„é…ç½®ç»§æ‰¿ <code>WebMvcConfigurationSupport </code>ï¼Œè¿›è€Œé‡å†™ <code>WebMvcConfigurationSupport </code>ä¸­çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;        registry.addResourceHandler(<span class="hljs-string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/&quot;</span>);    &#125;&#125;</code></pre></div><p>é‡å†™ addResourceHandlers æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­é…ç½®é™æ€èµ„æºè¿‡æ»¤ï¼Œè¿™é‡Œæˆ‘å°†é™æ€èµ„æºæ”¾åœ¨ resources ç›®å½•ä¸‹ï¼Œæ‰€ä»¥èµ„æºä½ç½®æ˜¯ <code>classpath:/</code> ï¼Œå½“ç„¶ï¼Œèµ„æºä¹Ÿå¯ä»¥æ”¾åœ¨ webapp ç›®å½•ä¸‹ï¼Œæ­¤æ—¶åªéœ€è¦ä¿®æ”¹é…ç½®ä¸­çš„èµ„æºä½ç½®å³å¯ã€‚å¦‚æœé‡‡ç”¨ Java æ¥é…ç½® SSM ç¯å¢ƒï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥ä¸å¿…ä½¿ç”¨ webapp ç›®å½•ï¼Œé™¤éè¦ä½¿ç”¨ JSP åšé¡µé¢æ¨¡æ¿ï¼Œå¦åˆ™å¯ä»¥å¿½ç•¥ webapp ç›®å½•ã€‚</p><h4 id="2-6-2-è§†å›¾è§£æå™¨"><a href="#2-6-2-è§†å›¾è§£æå™¨" class="headerlink" title="2.6.2 è§†å›¾è§£æå™¨"></a>2.6.2 è§†å›¾è§£æå™¨</h4><p>åœ¨ XML æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼é…ç½®è§†å›¾è§£æå™¨ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre></div><p>å¦‚æœé€šè¿‡ Java ç±»ï¼Œä¸€æ ·ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚</p><p>é¦–å…ˆä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ  webapp ç›®å½•ï¼Œwebapp ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ª jsp ç›®å½•ï¼Œjsp ç›®å½•ä¸­æ·»åŠ  jsp æ–‡ä»¶ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/10-2.png" alt="img"></p><p>ç„¶åå¼•å…¥ JSP çš„ä¾èµ–ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç„¶åï¼Œåœ¨é…ç½®ç±»ä¸­ï¼Œç»§ç»­é‡å†™æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureViewResolvers</span><span class="hljs-params">(ViewResolverRegistry registry)</span> </span>&#123;        registry.jsp(<span class="hljs-string">&quot;/jsp/&quot;</span>, <span class="hljs-string">&quot;.jsp&quot;</span>);    &#125;&#125;</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ <code>Controller</code> ä¸­æ·»åŠ æ§åˆ¶å™¨å³å¯è®¿é—® JSP é¡µé¢ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController2</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;/hello2&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;    &#125;&#125;</code></pre></div><h4 id="2-6-3-è·¯å¾„æ˜ å°„"><a href="#2-6-3-è·¯å¾„æ˜ å°„" class="headerlink" title="2.6.3 è·¯å¾„æ˜ å°„"></a>2.6.3 è·¯å¾„æ˜ å°„</h4><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„æ§åˆ¶å™¨çš„ä½œç”¨ä»…ä»…åªæ˜¯ä¸€ä¸ªè·³è½¬ï¼Œå°±åƒä¸Šé¢å°èŠ‚ä¸­çš„æ§åˆ¶å™¨ï¼Œé‡Œè¾¹æ²¡æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œåƒè¿™ç§æƒ…å†µï¼Œå¯ä»¥ä¸ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è·¯å¾„æ˜ å°„æ¥å®ç°é¡µé¢è®¿é—®ã€‚å¦‚æœåœ¨ <code>XML</code> ä¸­é…ç½®è·¯å¾„æ˜ å°„ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/hello&quot;</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">status-code</span>=<span class="hljs-string">&quot;200&quot;</span>/&gt;</span></code></pre></div><p>è¿™è¡Œé…ç½®ï¼Œè¡¨ç¤ºå¦‚æœç”¨æˆ·è®¿é—® <code>/hello</code> è¿™ä¸ªè·¯å¾„ï¼Œåˆ™ç›´æ¥å°†åä¸º <code>hello</code> çš„è§†å›¾è¿”å›ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”å“åº”ç ä¸º <code>200</code>ï¼Œè¿™ä¸ªé…ç½®å°±å¯ä»¥æ›¿ä»£ <code>Controller</code> ä¸­çš„æ–¹æ³•ã€‚</p><p>ç›¸åŒçš„éœ€æ±‚ï¼Œå¦‚æœåœ¨ <code>Java</code> ä»£ç ä¸­ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;        registry.addViewController(<span class="hljs-string">&quot;/hello3&quot;</span>).setViewName(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;&#125;</code></pre></div><p>æ­¤æ—¶ï¼Œç”¨æˆ·è®¿é—® <code>/hello3</code> æ¥å£ï¼Œå°±èƒ½çœ‹åˆ°åä¸º <code>hello</code> çš„è§†å›¾æ–‡ä»¶</p><h4 id="2-6-4-JSON-é…ç½®"><a href="#2-6-4-JSON-é…ç½®" class="headerlink" title="2.6.4 JSON é…ç½®"></a>2.6.4 JSON é…ç½®</h4><p>SpringMVC å¯ä»¥æ¥æ”¶JSON å‚æ•°ï¼Œä¹Ÿå¯ä»¥è¿”å› JSON å‚æ•°ï¼Œè¿™ä¸€åˆ‡ä¾èµ–äº <code>HttpMessageConverter</code></p><p><code>HttpMessageConverter </code>å¯ä»¥å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬ä¸º å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡è½¬ä¸º JSON å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šå®ƒçš„åº•å±‚è¿˜æ˜¯ä¾èµ–äºå…·ä½“çš„ JSON åº“</p><p>æ‰€æœ‰çš„ JSON åº“è¦åœ¨ SpringMVC ä¸­è‡ªåŠ¨è¿”å›æˆ–è€…æ¥æ”¶ JSONï¼Œéƒ½å¿…é¡»æä¾›å’Œè‡ªå·±ç›¸å…³çš„ <code>HttpMessageConverter </code></p><p>SpringMVC ä¸­ï¼Œé»˜è®¤æä¾›äº†<code>Jackson</code>å’Œ <code>gson </code>çš„ <code>HttpMessageConverter</code> ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>MappingJackson2HttpMessageConverter</code> å’Œ <code>GsonHttpMessageConverter </code></p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬åœ¨ SpringMVC ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨ JSON ï¼Œå¯¹äº jackson å’Œ gson æˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¾èµ–ï¼ŒåŠ å®Œä¾èµ–å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚å…·ä½“çš„é…ç½®æ˜¯åœ¨ <code>AllEncompassingFormHttpMessageConverter</code> ç±»ä¸­å®Œæˆçš„</p><p>å¦‚æœå¼€å‘è€…ä½¿ç”¨äº†<code> fastjson</code>ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringMVC å¹¶æ²¡æœ‰æä¾›<code> fastjson</code> çš„ <code>HttpMessageConverter </code>ï¼Œè¿™ä¸ªéœ€è¦æˆ‘ä»¬è‡ªå·±æä¾›ï¼Œå¦‚æœæ˜¯åœ¨ XML é…ç½®ä¸­ï¼Œ<code>fastjson</code> é™¤äº†åŠ ä¾èµ–ï¼Œè¿˜è¦æ˜¾å¼é…ç½® <code>HttpMessageConverter</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span></code></pre></div><p>åœ¨ Java é…ç½®çš„ SSM ä¸­ï¼Œæˆ‘ä»¬ä¸€æ ·ä¹Ÿå¯ä»¥æ·»åŠ è¿™æ ·çš„é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringMVCConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;        FastJsonHttpMessageConverter converter = <span class="hljs-keyword">new</span> FastJsonHttpMessageConverter();        converter.setDefaultCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        FastJsonConfig fastJsonConfig = <span class="hljs-keyword">new</span> FastJsonConfig();        fastJsonConfig.setCharset(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));        converter.setFastJsonConfig(fastJsonConfig);        converters.add(converter);    &#125;&#125;</code></pre></div><p>ç„¶åï¼Œå°±å¯ä»¥åœ¨æ¥å£ä¸­ç›´æ¥è¿”å› JSON äº†ï¼Œæ­¤æ—¶çš„ JSON æ•°æ®å°†é€šè¿‡<code>fastjson</code>ç”Ÿæˆ</p><h2 id="3-Spring-Boot-ä¸­è‡ªå®šä¹‰-SpringMVC"><a href="#3-Spring-Boot-ä¸­è‡ªå®šä¹‰-SpringMVC" class="headerlink" title="3.Spring Boot ä¸­è‡ªå®šä¹‰ SpringMVC"></a>3.Spring Boot ä¸­è‡ªå®šä¹‰ SpringMVC</h2><p>ç”¨è¿‡ Spring Boot çš„å°ä¼™ä¼´éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥ <code>spring-boot-starter-web</code> ä¾èµ–ï¼ŒSpringMVC çš„ä¸€æ•´å¥—ä¸œè¥¿å°±ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬é…ç½®å¥½ï¼Œä½†æ˜¯ï¼ŒçœŸå®çš„é¡¹ç›®ç¯å¢ƒæ¯”è¾ƒå¤æ‚ï¼Œç³»ç»Ÿè‡ªå¸¦çš„é…ç½®ä¸ä¸€å®šæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¾€å¾€æˆ‘ä»¬è¿˜éœ€è¦ç»“åˆå®é™…æƒ…å†µè‡ªå®šä¹‰é…ç½®ã€‚</p><h3 id="3-1-æ¦‚è§ˆ"><a href="#3-1-æ¦‚è§ˆ" class="headerlink" title="3.1 æ¦‚è§ˆ"></a>3.1 æ¦‚è§ˆ</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®ï¼Œè·Ÿè‡ªå®šä¹‰ SpringMVC ç›¸å…³çš„ç±»å’Œæ³¨è§£ä¸»è¦æœ‰å¦‚ä¸‹å››ä¸ªï¼š</p><ul><li>WebMvcConfigurerAdapter</li><li>WebMvcConfigurer</li><li>WebMvcConfigurationSupport</li><li>@EnableWebMvc</li></ul><p>è¿™å››ä¸ªä¸­ï¼Œé™¤äº†ç¬¬å››ä¸ªæ˜¯æ³¨è§£ï¼Œå¦å¤–ä¸‰ä¸ªä¸¤ä¸ªç±»ä¸€ä¸ªæ¥å£ï¼Œé‡Œè¾¹çš„æ–¹æ³•çœ‹èµ·æ¥å¥½åƒéƒ½ç±»ä¼¼ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨æ•ˆæœå´å¤§ä¸ç›¸åŒï¼Œå› æ­¤å¾ˆå¤šå°ä¼™ä¼´å®¹æ˜“ææ··ã€‚</p><h3 id="3-2-WebMvcConfigurerAdapter"><a href="#3-2-WebMvcConfigurerAdapter" class="headerlink" title="3.2 WebMvcConfigurerAdapter"></a>3.2 WebMvcConfigurerAdapter</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ WebMvcConfigurerAdapterï¼Œè¿™ä¸ªæ˜¯åœ¨ Spring Boot 1.x ä¸­æˆ‘ä»¬è‡ªå®šä¹‰ SpringMVC æ—¶ç»§æ‰¿çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»æœ¬èº«æ˜¯å®ç°äº† WebMvcConfigurer æ¥å£ï¼Œç„¶åæŠ½è±¡ç±»é‡Œè¾¹éƒ½æ˜¯ç©ºæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„å£°æ˜ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcConfigurerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-comment">//å„ç§ SpringMVC é…ç½®çš„æ–¹æ³•</span>&#125;</code></pre></div><p>å†æ¥çœ‹çœ‹è¿™ä¸ªç±»çš„æ³¨é‡Šï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * An implementation of &#123;<span class="hljs-doctag">@link</span> WebMvcConfigurer&#125; with empty methods allowing</span><span class="hljs-comment"> * subclasses to override only the methods they&#x27;re interested in.</span><span class="hljs-comment"> * <span class="hljs-doctag">@deprecated</span> as of 5.0 &#123;<span class="hljs-doctag">@link</span> WebMvcConfigurer&#125; has default methods (made</span><span class="hljs-comment"> * possible by a Java 8 baseline) and can be implemented directly without the</span><span class="hljs-comment"> * need for this adapter</span><span class="hljs-comment"> */</span></code></pre></div><p>è¿™æ®µæ³¨é‡Šå…³äºè¿™ä¸ªç±»è¯´çš„å¾ˆæ˜ç™½äº†ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿçœ‹åˆ°ï¼Œä» Spring5 å¼€å§‹ï¼Œç”±äºæˆ‘ä»¬è¦ä½¿ç”¨ Java8ï¼Œè€Œ Java8 ä¸­çš„æ¥å£å…è®¸å­˜åœ¨ default æ–¹æ³•ï¼Œå› æ­¤å®˜æ–¹å»ºè®®æˆ‘ä»¬ç›´æ¥å®ç° WebMvcConfigurer æ¥å£ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ WebMvcConfigurerAdapter ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ Spring Boot 1.x çš„æ—¶ä»£ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ SpringMVC é…ç½®ï¼Œç›´æ¥ç»§æ‰¿ WebMvcConfigurerAdapter ç±»å³å¯ã€‚</strong></p><h3 id="3-3-WebMvcConfigurer"><a href="#3-3-WebMvcConfigurer" class="headerlink" title="3.3 WebMvcConfigurer"></a>3.3 WebMvcConfigurer</h3><p>æ ¹æ®ä¸Šä¸€å°èŠ‚çš„è§£é‡Šï¼Œå°ä¼™ä¼´ä»¬å·²ç»æ˜ç™½äº†ï¼ŒWebMvcConfigurer æ˜¯æˆ‘ä»¬åœ¨ Spring Boot 2.x ä¸­å®ç°è‡ªå®šä¹‰é…ç½®çš„æ–¹æ¡ˆã€‚</p><p>WebMvcConfigurer æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å’Œ WebMvcConfigurerAdapter ä¸­å®šä¹‰çš„ç©ºæ–¹æ³•å…¶å®ä¸€æ ·ï¼Œæ‰€ä»¥ç”¨æ³•ä¸Šæ¥è¯´ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰å·®åˆ«ï¼Œä» Spring Boot 1.x åˆ‡æ¢åˆ° Spring Boot 2.x ï¼Œåªéœ€è¦æŠŠç»§æ‰¿ç±»æ”¹æˆå®ç°æ¥å£å³å¯ã€‚</p><p>æ¾å“¥åœ¨ä¹‹å‰çš„æ¡ˆä¾‹ä¸­(<a href="https://mp.weixin.qq.com/s/tm1IqiEvRZwDAb-F5yJ5Aw">40 ç¯‡åŸåˆ›å¹²è´§ï¼Œå¸¦ä½ è¿›å…¥ Spring Boot æ®¿å ‚ï¼</a>)ï¼Œå‡¡æ˜¯æ¶‰åŠåˆ°è‡ªå®šä¹‰ SpringMVC é…ç½®çš„åœ°æ–¹ï¼Œä¹Ÿéƒ½æ˜¯é€šè¿‡å®ç° WebMvcConfigurer æ¥å£æ¥å®Œæˆçš„ã€‚</p><h3 id="3-4-WebMvcConfigurationSupport"><a href="#3-4-WebMvcConfigurationSupport" class="headerlink" title="3.4 WebMvcConfigurationSupport"></a>3.4 WebMvcConfigurationSupport</h3><p>å‰é¢ä¸¤ä¸ªéƒ½å¥½ç†è§£ï¼Œè¿˜æœ‰ä¸€ä¸ª WebMvcConfigurationSupport ï¼Œè¿™ä¸ªåˆæ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ</p><p>æ¾å“¥ä¹‹å‰æœ‰ä¸€ç¯‡æ–‡ç« ä¸­ç”¨è¿‡è¿™ä¸ªç±»ï¼Œä¸çŸ¥é“å°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰ç•™æ„ï¼Œå°±æ˜¯ä¸‹é¢è¿™ç¯‡ï¼š</p><ul><li><a href="https://mp.weixin.qq.com/s/NC_0oaeBzRjCB34U_ZWxIQ">çº¯ Java ä»£ç æ­å»º SSM ç¯å¢ƒ</a></li></ul><p>è¿™ç¯‡æ–‡ç« æˆ‘æ”¾å¼ƒäº† Spring å’Œ SpringMVC çš„ xml é…ç½®æ–‡ä»¶ï¼Œè½¬è€Œç”¨ Java ä»£æ›¿è¿™ä¸¤ä¸ª xml é…ç½®ã€‚é‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘è‡ªå®šä¹‰ SpringMVC é…ç½®çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡ç»§æ‰¿ WebMvcConfigurationSupport ç±»æ¥å®ç°çš„ã€‚åœ¨ WebMvcConfigurationSupport ç±»ä¸­ï¼Œæä¾›äº†ç”¨ Java é…ç½® SpringMVC æ‰€éœ€è¦çš„æ‰€æœ‰æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„æ‘˜è¦ï¼š</p><p><a href="http://www.javaboy.org/images/boot/37-1.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/37-1.png" alt="img"></a></p><p>æœ‰ä¸€ç‚¹çœ¼ç†Ÿï¼Œå¯èƒ½æœ‰å°ä¼™ä¼´å‘ç°äº†ï¼Œè¿™é‡Œçš„æ–¹æ³•å…¶å®å’Œå‰é¢ä¸¤ä¸ªç±»ä¸­çš„æ–¹æ³•åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚</p><p>åœ¨è¿™é‡Œé¦–å…ˆå¤§å®¶éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒWebMvcConfigurationSupport ç±»æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ SpringMVC çš„é…ç½®æ˜¯å¯ä»¥é€šè¿‡ç»§æ‰¿ WebMvcConfigurationSupport æ¥å®ç°çš„ã€‚ä½†æ˜¯ç»§æ‰¿ WebMvcConfigurationSupport è¿™ç§æ“ä½œæˆ‘ä»¬ä¸€èˆ¬åªåœ¨ Java é…ç½®çš„ SSM é¡¹ç›®ä¸­ä½¿ç”¨ï¼ŒSpring Boot ä¸­åŸºæœ¬ä¸Šä¸ä¼šè¿™ä¹ˆå†™ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å°ä¼™ä¼´ä»¬çŸ¥é“ï¼ŒSpring Boot ä¸­ï¼ŒSpringMVC ç›¸å…³çš„è‡ªåŠ¨åŒ–é…ç½®æ˜¯åœ¨ WebMvcAutoConfiguration é…ç½®ç±»ä¸­å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªé…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><span class="hljs-meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><span class="hljs-meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><span class="hljs-meta">ValidationAutoConfiguration.class &#125;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>&#123;&#125;</code></pre></div><p>æˆ‘ä»¬ä»è¿™ä¸ªç±»çš„æ³¨è§£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„ç”Ÿæ•ˆæ¡ä»¶æœ‰ä¸€æ¡ï¼Œå°±æ˜¯å½“ä¸å­˜åœ¨ WebMvcConfigurationSupport çš„å®ä¾‹æ—¶ï¼Œè¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®æ‰ä¼šç”Ÿç”Ÿæ•ˆã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ Spring Boot ä¸­è‡ªå®šä¹‰ SpringMVC é…ç½®æ—¶é€‰æ‹©äº†ç»§æ‰¿ WebMvcConfigurationSupportï¼Œå°±ä¼šå¯¼è‡´ Spring Boot ä¸­ SpringMVC çš„è‡ªåŠ¨åŒ–é…ç½®å¤±æ•ˆã€‚</p><blockquote><p>Spring Boot ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šè‡ªåŠ¨åŒ–é…ç½®ï¼Œå¾ˆå¤šæ—¶å€™å½“æˆ‘ä»¬ä¿®æ”¹è¿™äº›é…ç½®çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯è¦å…¨ç›˜å¦å®š Spring Boot æä¾›çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯é’ˆå¯¹æŸä¸€ä¸ªé…ç½®åšå‡ºä¿®æ”¹ï¼Œå…¶ä»–çš„é…ç½®è¿˜æ˜¯æŒ‰ç…§ Spring Boot é»˜è®¤çš„è‡ªåŠ¨åŒ–é…ç½®æ¥ï¼Œè€Œç»§æ‰¿ WebMvcConfigurationSupport æ¥å®ç°å¯¹ SpringMVC çš„é…ç½®ä¼šå¯¼è‡´æ‰€æœ‰çš„ SpringMVC è‡ªåŠ¨åŒ–é…ç½®å¤±æ•ˆï¼Œå› æ­¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸é€‰æ‹©è¿™ç§æ–¹æ¡ˆã€‚</p></blockquote><p>åœ¨ Java æ­å»ºçš„ SSM é¡¹ç›®ä¸­(<a href="https://mp.weixin.qq.com/s/NC_0oaeBzRjCB34U_ZWxIQ">çº¯ Java ä»£ç æ­å»º SSM ç¯å¢ƒ</a>)ï¼Œå› ä¸ºæœ¬èº«å°±æ²¡ä»€ä¹ˆè‡ªåŠ¨åŒ–é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†ç»§æ‰¿ WebMvcConfigurationSupportã€‚</p><h3 id="3-5-EnableWebMvc"><a href="#3-5-EnableWebMvc" class="headerlink" title="3.5 @EnableWebMvc"></a>3.5 @EnableWebMvc</h3><p>æœ€åè¿˜æœ‰ä¸€ä¸ª @EnableWebMvc æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å¾ˆå¥½ç†è§£ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å¯ç”¨ WebMvcConfigurationSupportã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ³¨è§£çš„å®šä¹‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * Adding this annotation to an &#123;<span class="hljs-doctag">@code</span> <span class="hljs-doctag">@Configuration</span>&#125; class imports the Spring MVC</span><span class="hljs-comment"> * configuration from &#123;<span class="hljs-doctag">@link</span> WebMvcConfigurationSupport&#125;, e.g.:</span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œå°±ä¼šè‡ªåŠ¨å¯¼å…¥ WebMvcConfigurationSupportï¼Œæ‰€ä»¥åœ¨ Spring Boot ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸å»ºè®®ä½¿ç”¨ @EnableWebMvc æ³¨è§£ï¼Œå› ä¸ºå®ƒä¸€æ ·ä¼šå¯¼è‡´ Spring Boot ä¸­çš„ SpringMVC è‡ªåŠ¨åŒ–é…ç½®å¤±æ•ˆã€‚</p><h3 id="3-6-æ€»ç»“"><a href="#3-6-æ€»ç»“" class="headerlink" title="3.6 æ€»ç»“"></a>3.6 æ€»ç»“</h3><ul><li>Spring Boot 1.x ä¸­ï¼Œè‡ªå®šä¹‰ SpringMVC é…ç½®å¯ä»¥é€šè¿‡ç»§æ‰¿ WebMvcConfigurerAdapter æ¥å®ç°ã€‚</li><li>Spring Boot 2.x ä¸­ï¼Œè‡ªå®šä¹‰ SpringMVC é…ç½®å¯ä»¥é€šè¿‡å®ç° WebMvcConfigurer æ¥å£æ¥å®Œæˆã€‚</li><li>å¦‚æœåœ¨ Spring Boot ä¸­ä½¿ç”¨ç»§æ‰¿ WebMvcConfigurationSupport æ¥å®ç°è‡ªå®šä¹‰ SpringMVC é…ç½®ï¼Œæˆ–è€…åœ¨ Spring Boot ä¸­ä½¿ç”¨äº† @EnableWebMvc æ³¨è§£ï¼Œéƒ½ä¼šå¯¼è‡´ Spring Boot ä¸­é»˜è®¤çš„ SpringMVC è‡ªåŠ¨åŒ–é…ç½®å¤±æ•ˆã€‚</li><li>åœ¨çº¯ Java é…ç½®çš„ SSM ç¯å¢ƒä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰ SpringMVC é…ç½®ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼Œç¬¬ä¸€ç§å°±æ˜¯ç›´æ¥ç»§æ‰¿è‡ª WebMvcConfigurationSupport æ¥å®Œæˆ SpringMVC é…ç½®ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯å®ç° WebMvcConfigurer æ¥å£æ¥å®Œæˆè‡ªå®šä¹‰ SpringMVC é…ç½®ï¼Œå¦‚æœä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œåˆ™éœ€è¦ç»™ SpringMVC çš„é…ç½®ç±»ä¸Šé¢å¤–æ·»åŠ  @EnableWebMvc æ³¨è§£ï¼Œè¡¨ç¤ºå¯ç”¨ WebMvcConfigurationSupportï¼Œè¿™æ ·é…ç½®æ‰ä¼šç”Ÿæ•ˆã€‚æ¢å¥è¯è¯´ï¼Œåœ¨çº¯ Java é…ç½®çš„ SSM ä¸­ï¼Œå¦‚æœä½ éœ€è¦è‡ªå®šä¹‰ SpringMVC é…ç½®ï¼Œä½ ç¦»ä¸å¼€ WebMvcConfigurationSupport ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å»ºè®®é€šè¿‡ç»§æ‰¿ WebMvcConfigurationSupport æ¥å®ç°è‡ªåŠ¨åŒ–é…ç½®ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis</title>
    <link href="/2021/08/01/Redis/"/>
    <url>/2021/08/01/Redis/</url>
    
    <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><blockquote><p>æœ¬æ–‡æ•´ç†Redisç›¸å…³åŸºç¡€ä»¥åŠåº”ç”¨çš„çŸ¥è¯†ï¼Œä¾›å‚è€ƒ</p></blockquote><h1 id="1-NoSQLçš„å¼•è¨€"><a href="#1-NoSQLçš„å¼•è¨€" class="headerlink" title="1.  NoSQLçš„å¼•è¨€"></a>1.  NoSQLçš„å¼•è¨€</h1><p><strong>NoSQL</strong>(<code> Not Only SQL</code> )ï¼Œæ„å³<strong>ä¸ä»…ä»…æ˜¯SQL</strong>, æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚Nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»,æ—©æœŸå°±æœ‰äººæå‡º,å‘å±•è‡³2009å¹´è¶‹åŠ¿è¶Šå‘é«˜æ¶¨ã€‚</p><h1 id="2-ä¸ºä»€ä¹ˆæ˜¯NoSQL"><a href="#2-ä¸ºä»€ä¹ˆæ˜¯NoSQL" class="headerlink" title="2. ä¸ºä»€ä¹ˆæ˜¯NoSQL"></a>2. ä¸ºä»€ä¹ˆæ˜¯NoSQL</h1><p>éšç€äº’è”ç½‘ç½‘ç«™çš„å…´èµ·ï¼Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“åœ¨åº”ä»˜åŠ¨æ€ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„çº¯åŠ¨æ€ç½‘ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæš´éœ²äº†å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ã€‚å¦‚<code>å•†åŸç½‘ç«™ä¸­å¯¹å•†å“æ•°æ®é¢‘ç¹æŸ¥è¯¢</code>ã€<code>å¯¹çƒ­æœå•†å“çš„æ’è¡Œç»Ÿè®¡</code>ã€<code>è®¢å•è¶…æ—¶é—®é¢˜</code>ã€ä»¥åŠå¾®ä¿¡æœ‹å‹åœˆï¼ˆéŸ³é¢‘ï¼Œè§†é¢‘ï¼‰å­˜å‚¨ç­‰ç›¸å…³ä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å®ç°å°±æ˜¾å¾—éå¸¸å¤æ‚ï¼Œè™½ç„¶èƒ½å®ç°ç›¸åº”åŠŸèƒ½ä½†æ˜¯åœ¨æ€§èƒ½ä¸Šå´ä¸æ˜¯é‚£ä¹ˆä¹è§‚ã€‚nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»çš„å‡ºç°ï¼Œæ›´å¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå®ƒå‘Šè¯‰äº†ä¸–ç•Œä¸ä»…ä»…æ˜¯sqlã€‚</p><h1 id="3-NoSQLçš„å››å¤§åˆ†ç±»"><a href="#3-NoSQLçš„å››å¤§åˆ†ç±»" class="headerlink" title="3. NoSQLçš„å››å¤§åˆ†ç±»"></a>3. NoSQLçš„å››å¤§åˆ†ç±»</h1><h2 id="3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“"><a href="#3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“"></a>3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è¯´æ˜: </span><span class="hljs-bullet">-</span> è¿™ä¸€ç±»æ•°æ®åº“ä¸»è¦ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªç‰¹å®šçš„é”®å’Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç‰¹å®šçš„æ•°æ®ã€‚<span class="hljs-section"># 2.ç‰¹ç‚¹</span><span class="hljs-bullet">-</span> Key/valueæ¨¡å‹å¯¹äºITç³»ç»Ÿæ¥è¯´çš„ä¼˜åŠ¿åœ¨äºç®€å•ã€æ˜“éƒ¨ç½²ã€‚  <span class="hljs-bullet">-</span> ä½†æ˜¯å¦‚æœDBAåªå¯¹éƒ¨åˆ†å€¼è¿›è¡ŒæŸ¥è¯¢æˆ–æ›´æ–°çš„æ—¶å€™ï¼ŒKey/valueå°±æ˜¾å¾—æ•ˆç‡ä½ä¸‹äº†ã€‚<span class="hljs-section"># 3.ç›¸å…³äº§å“</span><span class="hljs-bullet">-</span> Tokyo Cabinet/Tyrant,<span class="hljs-bullet">-</span> <span class="hljs-code">`Redis`</span>å†…å­˜<span class="hljs-bullet">-</span> <span class="hljs-code">`SSDB`</span>ç¡¬ç›˜<span class="hljs-bullet">-</span> Voldemort <span class="hljs-bullet">-</span> Oracle BDB</code></pre></div><h2 id="3-2-åˆ—å­˜å‚¨æ•°æ®åº“"><a href="#3-2-åˆ—å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.2 åˆ—å­˜å‚¨æ•°æ®åº“"></a>3.2 åˆ—å­˜å‚¨æ•°æ®åº“</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è¯´æ˜</span><span class="hljs-bullet">-</span> è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥åº”å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„æµ·é‡æ•°æ®ã€‚<span class="hljs-section"># 2.ç‰¹ç‚¹</span><span class="hljs-bullet">-</span> é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚è¿™äº›åˆ—æ˜¯ç”±åˆ—å®¶æ—æ¥å®‰æ’çš„ã€‚<span class="hljs-section"># 3.ç›¸å…³äº§å“</span><span class="hljs-bullet">-</span> Cassandraã€<span class="hljs-code">`HBase`</span>ã€Riak.</code></pre></div><h2 id="3-3-æ–‡æ¡£å‹æ•°æ®åº“"><a href="#3-3-æ–‡æ¡£å‹æ•°æ®åº“" class="headerlink" title="3.3 æ–‡æ¡£å‹æ•°æ®åº“"></a>3.3 æ–‡æ¡£å‹æ•°æ®åº“</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è¯´æ˜</span><span class="hljs-bullet">-</span> æ–‡æ¡£å‹æ•°æ®åº“çš„çµæ„Ÿæ˜¯æ¥è‡ªäºLotus NotesåŠå…¬è½¯ä»¶çš„ï¼Œè€Œä¸”å®ƒåŒç¬¬ä¸€ç§é”®å€¼å­˜å‚¨ç›¸ç±»ä¼¼è¯¥ç±»å‹çš„æ•°æ®æ¨¡å‹æ˜¯ç‰ˆæœ¬åŒ–çš„æ–‡æ¡£ï¼ŒåŠç»“æ„åŒ–çš„æ–‡æ¡£ä»¥ç‰¹å®šçš„æ ¼å¼å­˜å‚¨ï¼Œæ¯”å¦‚JSONã€‚æ–‡æ¡£å‹æ•°æ®åº“å¯ä»¥çœ‹ä½œæ˜¯é”®å€¼æ•°æ®åº“çš„å‡çº§ç‰ˆï¼Œå…è®¸ä¹‹é—´åµŒå¥—é”®å€¼ã€‚è€Œä¸”æ–‡æ¡£å‹æ•°æ®åº“æ¯”é”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜<span class="hljs-section"># 2.ç‰¹ç‚¹</span><span class="hljs-bullet">-</span> ä»¥æ–‡æ¡£å½¢å¼å­˜å‚¨<span class="hljs-section"># 3.ç›¸å…³äº§å“</span><span class="hljs-bullet">-</span> <span class="hljs-code">`MongoDB`</span>ã€CouchDBã€ MongoDb(4.x). å›½å†…ä¹Ÿæœ‰æ–‡æ¡£å‹æ•°æ®åº“SequoiaDBï¼Œå·²ç»å¼€æºã€‚</code></pre></div><h2 id="3-4-å›¾å½¢-Graph-æ•°æ®åº“"><a href="#3-4-å›¾å½¢-Graph-æ•°æ®åº“" class="headerlink" title="3.4 å›¾å½¢(Graph)æ•°æ®åº“"></a>3.4 å›¾å½¢(Graph)æ•°æ®åº“</h2> <div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è¯´æ˜</span><span class="hljs-bullet">-</span> å›¾å½¢ç»“æ„çš„æ•°æ®åº“åŒå…¶ä»–è¡Œåˆ—ä»¥åŠåˆšæ€§ç»“æ„çš„SQLæ•°æ®åº“ä¸åŒï¼Œå®ƒæ˜¯ä½¿ç”¨çµæ´»çš„å›¾å½¢æ¨¡å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰©å±•åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚<span class="hljs-section"># 2.ç‰¹ç‚¹</span><span class="hljs-bullet">-</span> NoSQLæ•°æ®åº“æ²¡æœ‰æ ‡å‡†çš„æŸ¥è¯¢è¯­è¨€(SQL)ï¼Œå› æ­¤è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢éœ€è¦åˆ¶å®šæ•°æ®æ¨¡å‹ã€‚è®¸å¤šNoSQLæ•°æ®åº“éƒ½æœ‰RESTå¼çš„æ•°æ®æ¥å£æˆ–è€…æŸ¥è¯¢APIã€‚<span class="hljs-section"># 3.ç›¸å…³äº§å“</span><span class="hljs-bullet">-</span> Neo4Jã€<span class="hljs-code">`InfoGrid`</span>ã€ Infinite Graphã€</code></pre></div><hr><h1 id="4-NoSQLåº”ç”¨åœºæ™¯"><a href="#4-NoSQLåº”ç”¨åœºæ™¯" class="headerlink" title="4. NoSQLåº”ç”¨åœºæ™¯"></a>4. NoSQLåº”ç”¨åœºæ™¯</h1><ul><li><p>æ•°æ®æ¨¡å‹æ¯”è¾ƒç®€å•</p></li><li><p>éœ€è¦çµæ´»æ€§æ›´å¼ºçš„ITç³»ç»Ÿ</p></li><li><p>å¯¹æ•°æ®åº“æ€§èƒ½è¦æ±‚è¾ƒé«˜</p></li><li><p>ä¸éœ€è¦é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§ï¼ˆNosqlå¯¹äº‹åŠ¡çš„æ”¯æŒä¸å¤ªå¥½ï¼‰</p></li></ul><h1 id="5-ä»€ä¹ˆæ˜¯Redis"><a href="#5-ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="5. ä»€ä¹ˆæ˜¯Redis"></a>5. ä»€ä¹ˆæ˜¯Redis</h1><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623121234046.png" alt="image-20200623121234046"></p><blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker.</p></blockquote><p>Redis å¼€æº  éµå¾ª BSD  åŸºäºå†…å­˜æ•°æ®å­˜å‚¨è¢«ç”¨äºä½œä¸º<strong>æ•°æ®åº“ç¼“å­˜æ¶ˆæ¯ä¸­é—´ä»¶</strong></p><p>Redis åœ¨æ•°æ®å†…å­˜ä¸­ï¼ŒæŒä¹…åŒ–æœºåˆ¶ï¼Œå®šæœŸå†™å…¥ç£ç›˜ä¸­</p><ul><li>æ€»ç»“: Redisæ˜¯ä¸€ä¸ªå†…å­˜å‹çš„æ•°æ®åº“</li></ul><h1 id="6-Redisç‰¹ç‚¹"><a href="#6-Redisç‰¹ç‚¹" class="headerlink" title="6. Redisç‰¹ç‚¹"></a>6. Redisç‰¹ç‚¹</h1><ul><li><p> Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½key/valueå†…å­˜å‹æ•°æ®åº“</p></li><li><p>Redisæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ </p></li><li><p>Redisæ”¯æŒæŒä¹…åŒ– </p></li><li><p>Rediså•çº¿ç¨‹ï¼Œå•è¿›ç¨‹ï¼Œçº¿æ€§å®‰å…¨ï¼ŒRediså®ç°åˆ†å¸ƒå¼é”</p></li></ul><hr><h1 id="7-Rediså®‰è£…"><a href="#7-Rediså®‰è£…" class="headerlink" title="7. Rediså®‰è£…"></a>7. Rediså®‰è£…</h1><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 0.å‡†å¤‡ç¯å¢ƒ</span><span class="hljs-bullet">-</span> vmware15.x+<span class="hljs-bullet">-</span> centos7.x+<span class="hljs-section"># 1.ä¸‹è½½redisæºç åŒ…</span><span class="hljs-bullet">-</span> https://redis.io/</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623121621195.png" alt="image-20200623121621195"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 2.ä¸‹è½½å®Œæ•´æºç åŒ…</span><span class="hljs-bullet">-</span> redis-4.0.10.tar.gz</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623123918876.png" alt="image-20200623123918876"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.å°†ä¸‹è½½redisèµ„æ–™åŒ…ä¸Šä¼ åˆ°Linuxä¸­</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623124327319.png" alt="image-20200623124327319"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 4.è§£å‹ç¼©æ–‡ä»¶</span>[root@localhost ~]# tar -zxvf redis-4.0.10.tar.gz[root@localhost ~]# ll</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623124522026.png" alt="image-20200623124522026"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 5.å®‰è£…gcc  </span><span class="hljs-bullet">-</span> yum install -y gcc<span class="hljs-section"># 6.è¿›å…¥è§£å‹ç¼©ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="hljs-bullet">-</span> make MALLOC=libc<span class="hljs-section"># 7.ç¼–è¯‘å®Œæˆåæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="hljs-bullet">-</span> make install PREFIX=/usr/redis<span class="hljs-section"># 8.è¿›å…¥/usr/redisç›®å½•å¯åŠ¨redisæœåŠ¡ </span><span class="hljs-bullet">-</span> ./redis-server</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623125420505.png" alt="image-20200623125420505"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 9.RedisæœåŠ¡ç«¯å£é»˜è®¤æ˜¯ 6379</span><span class="hljs-section"># 10.è¿›å…¥binç›®å½•æ‰§è¡Œå®¢æˆ·ç«¯è¿æ¥æ“ä½œ</span><span class="hljs-bullet">-</span> ./redis-cli â€“p 6379</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623125716013.png" alt="image-20200623125716013"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 11.è¿æ¥æˆåŠŸå‡ºç°ä¸Šé¢ç•Œé¢è¿æ¥æˆåŠŸ</span><span class="hljs-bullet">-</span> é»˜è®¤åœ¨å®‰è£…redisåï¼Œå®‰è£…ç›®å½•æ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æ‹·è´åŸç ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶redis.confåˆ°usrä¸‹çš„redisç›®å½•ä¸‹<span class="hljs-section"># 12.åŠ è½½é…ç½®æ–‡ä»¶çš„å¯åŠ¨</span><span class="hljs-bullet">-</span> ./redis-server ../redis.conf</code></pre></div><h1 id="8-Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"><a href="#8-Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤" class="headerlink" title="8. Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"></a>8. Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤</h1><h2 id="8-1-æ•°æ®åº“æ“ä½œæŒ‡ä»¤"><a href="#8-1-æ•°æ®åº“æ“ä½œæŒ‡ä»¤" class="headerlink" title="8.1 æ•°æ®åº“æ“ä½œæŒ‡ä»¤"></a>8.1 æ•°æ®åº“æ“ä½œæŒ‡ä»¤</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.Redisä¸­åº“è¯´æ˜</span><span class="hljs-bullet">-</span> ä½¿ç”¨redisçš„é»˜è®¤é…ç½®å™¨åŠ¨redisæœåŠ¡å,é»˜è®¤ä¼šå­˜åœ¨16ä¸ªåº“,ç¼–å·ä»0-15ï¼Œé»˜è®¤0å·åº“<span class="hljs-bullet">-</span> å¯ä»¥ä½¿ç”¨select åº“çš„ç¼–å· æ¥é€‰æ‹©ä¸€ä¸ªredisçš„åº“<span class="hljs-section"># 2.Redisä¸­æ“ä½œåº“çš„æŒ‡ä»¤</span><span class="hljs-bullet">-</span> æ¸…ç©ºå½“å‰çš„åº“  FLUSHDB<span class="hljs-bullet">-</span> æ¸…ç©ºå…¨éƒ¨çš„åº“  FLUSHALL<span class="hljs-section"># 3.rediså®¢æˆ·ç«¯æ˜¾ç¤ºä¸­æ–‡</span><span class="hljs-bullet">-</span>./redis-cli  -p 7000 --raw</code></pre></div><h2 id="8-2-æ“ä½œkeyç›¸å…³æŒ‡ä»¤"><a href="#8-2-æ“ä½œkeyç›¸å…³æŒ‡ä»¤" class="headerlink" title="8.2 æ“ä½œkeyç›¸å…³æŒ‡ä»¤"></a>8.2 æ“ä½œkeyç›¸å…³æŒ‡ä»¤</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.DELæŒ‡ä»¤</span><span class="hljs-bullet">-</span> è¯­æ³• :  DEL key [key ...] <span class="hljs-bullet">-</span> ä½œç”¨ :  åˆ é™¤ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªkey ã€‚ä¸å­˜åœ¨çš„key ä¼šè¢«å¿½ç•¥ã€‚<span class="hljs-bullet">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0<span class="hljs-bullet">-</span> è¿”å›å€¼ï¼š è¢«åˆ é™¤key çš„æ•°é‡ã€‚ <span class="hljs-section"># 2.EXISTSæŒ‡ä»¤</span><span class="hljs-bullet">-</span> è¯­æ³•:  EXISTS key<span class="hljs-bullet">-</span> ä½œç”¨:  æ£€æŸ¥ç»™å®škey æ˜¯å¦å­˜åœ¨ã€‚<span class="hljs-bullet">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0<span class="hljs-bullet">-</span> è¿”å›å€¼ï¼š è‹¥key å­˜åœ¨ï¼Œè¿”å›1 ï¼Œå¦åˆ™è¿”å›0ã€‚<span class="hljs-section"># 3.EXPIRE</span><span class="hljs-bullet">-</span> è¯­æ³•:  EXPIRE key seconds<span class="hljs-bullet">-</span> ä½œç”¨:  ä¸ºç»™å®škey è®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼Œå½“key è¿‡æœŸæ—¶(ç”Ÿå­˜æ—¶é—´ä¸º0 )ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚<span class="hljs-bullet">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0<span class="hljs-bullet">-</span> æ—¶é—´å¤æ‚åº¦ï¼š O(1)<span class="hljs-bullet">-</span> è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸè¿”å›1 ã€‚<span class="hljs-section"># 4.KEYS</span><span class="hljs-bullet">-</span> è¯­æ³• :  KEYS pattern<span class="hljs-bullet">-</span> ä½œç”¨ :  æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼pattern çš„key ã€‚<span class="hljs-bullet">-</span> è¯­æ³•:<span class="hljs-code">KEYS * åŒ¹é…æ•°æ®åº“ä¸­æ‰€æœ‰key ã€‚</span><span class="hljs-code">KEYS h?llo åŒ¹é…hello ï¼Œhallo å’Œhxllo ç­‰ã€‚</span><span class="hljs-code">KEYS h*llo åŒ¹é…hllo å’Œheeeeello ç­‰ã€‚</span><span class="hljs-code">KEYS h[ae]llo åŒ¹é…hello å’Œhallo ï¼Œä½†ä¸åŒ¹é…hillo ã€‚ç‰¹æ®Šç¬¦å·ç”¨ &quot;\&quot; éš”å¼€</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š ç¬¦åˆç»™å®šæ¨¡å¼çš„key åˆ—è¡¨ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 5.MOVE</span><span class="hljs-code">- è¯­æ³• :  MOVE key db</span><span class="hljs-code">- ä½œç”¨ :  å°†å½“å‰æ•°æ®åº“çš„key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“db å½“ä¸­ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š ç§»åŠ¨æˆåŠŸè¿”å›1 ï¼Œå¤±è´¥åˆ™è¿”å›0 ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 6.PEXPIRE</span><span class="hljs-code">- è¯­æ³• :  PEXPIRE key milliseconds</span><span class="hljs-code">- ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤å’ŒEXPIRE å‘½ä»¤çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®key çš„ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸åƒEXPIRE å‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 2.6.0</span><span class="hljs-code">- æ—¶é—´å¤æ‚åº¦ï¼š O(1)</span><span class="hljs-code">- è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸï¼Œè¿”å›1  key ä¸å­˜åœ¨æˆ–è®¾ç½®å¤±è´¥ï¼Œè¿”å›0</span><span class="hljs-code"></span><span class="hljs-code"># 7.PEXPIREAT</span><span class="hljs-code">- è¯­æ³• :  PEXPIREAT key milliseconds-timestamp</span><span class="hljs-code">- ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤å’ŒEXPIREAT å‘½ä»¤ç±»ä¼¼ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®key çš„è¿‡æœŸunix æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯åƒEXPIREATé‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 2.6.0</span><span class="hljs-code">- è¿”å›å€¼ï¼šå¦‚æœç”Ÿå­˜æ—¶é—´è®¾ç½®æˆåŠŸï¼Œè¿”å›1 ã€‚å½“key ä¸å­˜åœ¨æˆ–æ²¡åŠæ³•è®¾ç½®ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›0 ã€‚(æŸ¥çœ‹EXPIRE å‘½ä»¤è·å–æ›´å¤šä¿¡æ¯)</span><span class="hljs-code"></span><span class="hljs-code"># 8.TTL</span><span class="hljs-code">- è¯­æ³• :   TTL key</span><span class="hljs-code">- ä½œç”¨ :   ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®škey çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(TTL, time to live)ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š</span><span class="hljs-code">å½“key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›-2 ã€‚</span><span class="hljs-code">å½“key å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›-1 ã€‚</span><span class="hljs-code">å¦åˆ™ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚</span><span class="hljs-code">- Note : åœ¨Redis 2.8 ä»¥å‰ï¼Œå½“key ä¸å­˜åœ¨ï¼Œæˆ–è€…key æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œå‘½ä»¤éƒ½è¿”å›-1 ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 9.PTTL</span><span class="hljs-code">- è¯­æ³• :  PTTL key</span><span class="hljs-code">- ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤ç±»ä¼¼äºTTL å‘½ä»¤ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸æ˜¯åƒTTL å‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 2.6.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š å½“key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›-2 ã€‚å½“key å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›-1 ã€‚</span><span class="hljs-code">- å¦åˆ™ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œè¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚</span><span class="hljs-code">- æ³¨æ„ : åœ¨Redis 2.8 ä»¥å‰ï¼Œå½“key ä¸å­˜åœ¨ï¼Œæˆ–è€…key æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œå‘½ä»¤éƒ½è¿”å›-1 ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 10.RANDOMKEY</span><span class="hljs-code">- è¯­æ³• :  RANDOMKEY</span><span class="hljs-code">- ä½œç”¨ :  ä»å½“å‰æ•°æ®åº“ä¸­éšæœºè¿”å›(ä¸åˆ é™¤) ä¸€ä¸ªkey ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼šå½“æ•°æ®åº“ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›ä¸€ä¸ªkey ã€‚å½“æ•°æ®åº“ä¸ºç©ºæ—¶ï¼Œè¿”å›nil ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 11.RENAME</span><span class="hljs-code">- è¯­æ³• :  RENAME key newkey</span><span class="hljs-code">- ä½œç”¨ :  å°†key æ”¹åä¸ºnewkey ã€‚å½“key å’Œnewkey ç›¸åŒï¼Œæˆ–è€…key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚å½“newkey å·²ç»å­˜åœ¨æ—¶ï¼ŒRENAME å‘½ä»¤å°†è¦†ç›–æ—§å€¼ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š æ”¹åæˆåŠŸæ—¶æç¤ºOK ï¼Œå¤±è´¥æ—¶å€™è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</span><span class="hljs-code"></span><span class="hljs-code"># 12.TYPE</span><span class="hljs-code">- è¯­æ³• :  TYPE key</span><span class="hljs-code">- ä½œç”¨ :  è¿”å›key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹ã€‚</span><span class="hljs-code">- å¯ç”¨ç‰ˆæœ¬ï¼š &gt;= 1.0.0</span><span class="hljs-code">- è¿”å›å€¼ï¼š</span><span class="hljs-code">none (key ä¸å­˜åœ¨)</span><span class="hljs-code">string (å­—ç¬¦ä¸²)</span><span class="hljs-code">list (åˆ—è¡¨)</span><span class="hljs-code">set (é›†åˆ)</span><span class="hljs-code">zset (æœ‰åºé›†)</span><span class="hljs-code">hash (å“ˆå¸Œè¡¨)</span></code></pre></div><h2 id="8-3-Stringç±»å‹"><a href="#8-3-Stringç±»å‹" class="headerlink" title="8.3 Stringç±»å‹"></a>8.3 Stringç±»å‹</h2><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹" class="headerlink" title="1. å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1. å†…å­˜å­˜å‚¨æ¨¡å‹</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623132104399.png" alt="image-20200623132104399"></p><h4 id="2-å¸¸ç”¨æ“ä½œå‘½ä»¤"><a href="#2-å¸¸ç”¨æ“ä½œå‘½ä»¤" class="headerlink" title="2. å¸¸ç”¨æ“ä½œå‘½ä»¤"></a>2. å¸¸ç”¨æ“ä½œå‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>set</td><td>è®¾ç½®ä¸€ä¸ªkey/value</td></tr><tr><td>get</td><td>æ ¹æ®keyè·å¾—å¯¹åº”çš„value</td></tr><tr><td>mset</td><td>ä¸€æ¬¡è®¾ç½®å¤šä¸ªkey value</td></tr><tr><td>mget</td><td>ä¸€æ¬¡è·å¾—å¤šä¸ªkeyçš„value</td></tr><tr><td>getset</td><td>è·å¾—åŸå§‹keyçš„å€¼ï¼ŒåŒæ—¶è®¾ç½®æ–°å€¼</td></tr><tr><td>strlen</td><td>è·å¾—å¯¹åº”keyå­˜å‚¨valueçš„é•¿åº¦</td></tr><tr><td>append</td><td>ä¸ºå¯¹åº”keyçš„valueè¿½åŠ å†…å®¹</td></tr><tr><td>getrange ç´¢å¼•0å¼€å§‹</td><td>æˆªå–valueçš„å†…å®¹</td></tr><tr><td>setex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰</td></tr><tr><td>psetex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td>setnx</td><td>å­˜åœ¨ä¸åšä»»ä½•æ“ä½œ,ä¸å­˜åœ¨æ·»åŠ </td></tr><tr><td>msetnxåŸå­æ“ä½œ(åªè¦æœ‰ä¸€ä¸ªå­˜åœ¨ä¸åšä»»ä½•æ“ä½œ)</td><td>å¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªkey,åªæœ‰æœ‰ä¸€ä¸ªå­˜åœ¨éƒ½ä¸ä¿å­˜</td></tr><tr><td>decr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„-1æ“ä½œ</td></tr><tr><td>decrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡Œå‡æ³•æ“ä½œ</td></tr><tr><td>Incr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„+1æ“ä½œ</td></tr><tr><td>incrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡ŒåŠ æ³•æ“ä½œ</td></tr><tr><td>Incrbyfloat</td><td>æ ¹æ®æä¾›çš„æ•°æ®åŠ å…¥æµ®ç‚¹æ•°</td></tr></tbody></table><h2 id="8-4-Listç±»å‹"><a href="#8-4-Listç±»å‹" class="headerlink" title="8.4 Listç±»å‹"></a>8.4 Listç±»å‹</h2><p>list åˆ—è¡¨ ç›¸å½“äºjavaä¸­list é›†åˆ  ç‰¹ç‚¹  å…ƒç´ æœ‰åº  ä¸” å¯ä»¥é‡å¤</p><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹-1"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹-1" class="headerlink" title="1.å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1.å†…å­˜å­˜å‚¨æ¨¡å‹</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623161114380.png" alt="image-20200623161114380"></p><h4 id="2-å¸¸ç”¨æ“ä½œæŒ‡ä»¤"><a href="#2-å¸¸ç”¨æ“ä½œæŒ‡ä»¤" class="headerlink" title="2.å¸¸ç”¨æ“ä½œæŒ‡ä»¤"></a>2.å¸¸ç”¨æ“ä½œæŒ‡ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lpush</td><td>å°†æŸä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨å¤´éƒ¨</td></tr><tr><td>lpushx</td><td>åŒlpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td></tr><tr><td>rpush</td><td>å°†æŸä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨æœ«å°¾</td></tr><tr><td>rpushx</td><td>åŒrpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td></tr><tr><td>lpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨å·¦è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>rpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨å³è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>lrange</td><td>è·å–æŸä¸€ä¸ªä¸‹æ ‡åŒºé—´å†…çš„å…ƒç´ </td></tr><tr><td>llen</td><td>è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°</td></tr><tr><td>lset</td><td>è®¾ç½®æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•çš„å€¼(ç´¢å¼•å¿…é¡»å­˜åœ¨)</td></tr><tr><td>lindex</td><td>è·å–æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ </td></tr><tr><td>lrem</td><td>åˆ é™¤é‡å¤å…ƒç´ </td></tr><tr><td>ltrim</td><td>ä¿ç•™åˆ—è¡¨ä¸­ç‰¹å®šåŒºé—´å†…çš„å…ƒç´ </td></tr><tr><td>linsert</td><td>åœ¨æŸä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œä¹‹åæ’å…¥æ–°å…ƒç´ </td></tr></tbody></table><h2 id="8-5-Setç±»å‹"><a href="#8-5-Setç±»å‹" class="headerlink" title="8.5 Setç±»å‹"></a>8.5 Setç±»å‹</h2><p>ç‰¹ç‚¹: Setç±»å‹ Seté›†åˆ å…ƒç´ æ— åº  ä¸å¯ä»¥é‡å¤</p><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹-2"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹-2" class="headerlink" title="1.å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1.å†…å­˜å­˜å‚¨æ¨¡å‹</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623193634316.png" alt="image-20200623193634316"></p><h4 id="2-å¸¸ç”¨å‘½ä»¤"><a href="#2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sadd</td><td>ä¸ºé›†åˆæ·»åŠ å…ƒç´ </td></tr><tr><td>smembers</td><td>æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´  æ— åº</td></tr><tr><td>scard</td><td>è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td>spop</td><td>éšæœºè¿”å›ä¸€ä¸ªå…ƒç´  å¹¶å°†å…ƒç´ åœ¨é›†åˆä¸­åˆ é™¤</td></tr><tr><td>smove</td><td>ä»ä¸€ä¸ªé›†åˆä¸­å‘å¦ä¸€ä¸ªé›†åˆç§»åŠ¨å…ƒç´   å¿…é¡»æ˜¯åŒä¸€ç§ç±»å‹</td></tr><tr><td>srem</td><td>ä»é›†åˆä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>sismember</td><td>åˆ¤æ–­ä¸€ä¸ªé›†åˆä¸­æ˜¯å¦å«æœ‰è¿™ä¸ªå…ƒç´ </td></tr><tr><td>srandmember</td><td>éšæœºè¿”å›å…ƒç´ </td></tr><tr><td>sdiff</td><td>å»æ‰ç¬¬ä¸€ä¸ªé›†åˆä¸­å…¶å®ƒé›†åˆå«æœ‰çš„ç›¸åŒå…ƒç´ </td></tr><tr><td>sinter</td><td>æ±‚äº¤é›†</td></tr><tr><td>sunion</td><td>æ±‚å’Œé›†</td></tr></tbody></table><h2 id="8-6-ZSetç±»å‹"><a href="#8-6-ZSetç±»å‹" class="headerlink" title="8.6 ZSetç±»å‹"></a>8.6 ZSetç±»å‹</h2><p>ç‰¹ç‚¹: å¯æ’åºçš„seté›†åˆ  æ’åº  ä¸å¯é‡å¤ </p><p>ZSET å®˜æ–¹  å¯æ’åºSET  sortSet   åˆ©ç”¨å¸¦çš„åˆ†æ•°</p><h4 id="1-å†…å­˜æ¨¡å‹"><a href="#1-å†…å­˜æ¨¡å‹" class="headerlink" title="1.å†…å­˜æ¨¡å‹"></a>1.å†…å­˜æ¨¡å‹</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623194903967.png" alt="image-20200623194903967"></p><h4 id="2-å¸¸ç”¨å‘½ä»¤-1"><a href="#2-å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>zadd</td><td>æ·»åŠ ä¸€ä¸ªæœ‰åºé›†åˆå…ƒç´ </td></tr><tr><td>zcard</td><td>è¿”å›é›†åˆçš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zrange å‡åº zrevrange é™åº</td><td>è¿”å›ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>zrangebyscore</td><td>æŒ‰ç…§åˆ†æ•°æŸ¥æ‰¾ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>zrank</td><td>è¿”å›æ’å</td></tr><tr><td>zrevrank</td><td>å€’åºæ’å</td></tr><tr><td>zscore</td><td>æ˜¾ç¤ºæŸä¸€ä¸ªå…ƒç´ çš„åˆ†æ•°</td></tr><tr><td>zrem</td><td>ç§»é™¤æŸä¸€ä¸ªå…ƒç´ </td></tr><tr><td>zincrby</td><td>ç»™æŸä¸ªç‰¹å®šå…ƒç´ åŠ åˆ†</td></tr></tbody></table><h2 id="8-7-hashç±»å‹"><a href="#8-7-hashç±»å‹" class="headerlink" title="8.7 hashç±»å‹"></a>8.7 hashç±»å‹</h2><p>ç‰¹ç‚¹: value æ˜¯ä¸€ä¸ªmapç»“æ„ å­˜åœ¨key value  key æ— åºçš„  </p><h4 id="1-å†…å­˜æ¨¡å‹-1"><a href="#1-å†…å­˜æ¨¡å‹-1" class="headerlink" title="1.å†…å­˜æ¨¡å‹"></a>1.å†…å­˜æ¨¡å‹</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623200348408.png" alt="image-20200623200348408"></p><h4 id="2-å¸¸ç”¨å‘½ä»¤-2"><a href="#2-å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>hset</td><td>è®¾ç½®ä¸€ä¸ªkey/valueå¯¹</td></tr><tr><td>hget</td><td>è·å¾—ä¸€ä¸ªkeyå¯¹åº”çš„value</td></tr><tr><td>hgetall</td><td>è·å¾—æ‰€æœ‰çš„key/valueå¯¹</td></tr><tr><td>hdel</td><td>åˆ é™¤æŸä¸€ä¸ªkey/valueå¯¹</td></tr><tr><td>hexists</td><td>åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨</td></tr><tr><td>hkeys</td><td>è·å¾—æ‰€æœ‰çš„key</td></tr><tr><td>hvals</td><td>è·å¾—æ‰€æœ‰çš„value</td></tr><tr><td>hmset</td><td>è®¾ç½®å¤šä¸ªkey/value</td></tr><tr><td>hmget</td><td>è·å¾—å¤šä¸ªkeyçš„value</td></tr><tr><td>hsetnx</td><td>è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„keyçš„å€¼</td></tr><tr><td>hincrby</td><td>ä¸ºvalueè¿›è¡ŒåŠ æ³•è¿ç®—</td></tr><tr><td>hincrbyfloat</td><td>ä¸ºvalueåŠ å…¥æµ®ç‚¹å€¼</td></tr></tbody></table><hr><h1 id="9-æŒä¹…åŒ–æœºåˆ¶"><a href="#9-æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="9. æŒä¹…åŒ–æœºåˆ¶"></a>9. æŒä¹…åŒ–æœºåˆ¶</h1><p>client  redis[å†…å­˜] â€”â€“&gt;  å†…å­˜æ•°æ®- æ•°æ®æŒä¹…åŒ–â€“&gt;ç£ç›˜</p><p>Rediså®˜æ–¹æä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹æ³•æ¥å°†æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜é‡Œé¢åˆ†åˆ«æ˜¯:</p><ul><li>å¿«ç…§(Snapshot)</li><li>AOF (Append Only File) åªè¿½åŠ æ—¥å¿—æ–‡ä»¶</li></ul><h2 id="9-1-å¿«ç…§-Snapshot"><a href="#9-1-å¿«ç…§-Snapshot" class="headerlink" title="9.1 å¿«ç…§(Snapshot)"></a>9.1 å¿«ç…§(Snapshot)</h2><h4 id="1-ç‰¹ç‚¹"><a href="#1-ç‰¹ç‚¹" class="headerlink" title="1. ç‰¹ç‚¹"></a>1. ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ç¡¬ç›˜ä¸­,å½“ç„¶è¿™ä¹Ÿæ˜¯<strong>redisçš„é»˜è®¤å¼€å¯æŒä¹…åŒ–æ–¹å¼</strong>,ä¿å­˜çš„æ–‡ä»¶æ˜¯ä»¥.rdbå½¢å¼ç»“å°¾çš„æ–‡ä»¶å› æ­¤è¿™ç§æ–¹å¼ä¹Ÿç§°ä¹‹ä¸ºRDBæ–¹å¼ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623204303074.png" alt="image-20200623204303074"></p><h4 id="2-å¿«ç…§ç”Ÿæˆæ–¹å¼"><a href="#2-å¿«ç…§ç”Ÿæˆæ–¹å¼" class="headerlink" title="2.å¿«ç…§ç”Ÿæˆæ–¹å¼"></a>2.å¿«ç…§ç”Ÿæˆæ–¹å¼</h4><ul><li>å®¢æˆ·ç«¯æ–¹å¼: BGSAVE å’Œ SAVEæŒ‡ä»¤</li><li>æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘</li></ul><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å®¢æˆ·ç«¯æ–¹å¼ä¹‹BGSAVE</span><span class="hljs-bullet">-</span> a.å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨BGSAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§,å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„BGSAVEå‘½ä»¤æ—¶,redisä¼šè°ƒç”¨forkÂ¹æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹,ç„¶åå­è¿›ç¨‹è´Ÿè´£å°†å¿«ç…§å†™å…¥ç£ç›˜ä¸­,è€Œçˆ¶è¿›ç¨‹åˆ™ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚<span class="hljs-code"></span><span class="hljs-code">`åè¯è§£é‡Š: forkå½“ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™,åº•å±‚çš„æ“ä½œç³»ç»Ÿä¼šåˆ›å»ºè¯¥è¿›ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬,åœ¨ç±»unixç³»ç»Ÿä¸­åˆ›å»ºå­è¿›ç¨‹çš„æ“ä½œä¼šè¿›è¡Œä¼˜åŒ–:åœ¨åˆšå¼€å§‹çš„æ—¶å€™,çˆ¶å­è¿›ç¨‹å…±äº«ç›¸åŒå†…å­˜,ç›´åˆ°çˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹å¯¹å†…å­˜è¿›è¡Œäº†å†™ä¹‹å,ä¸¤è€…åˆ†å¼€ï¼Œå¯¹è¢«å†™å…¥çš„å†…å­˜çš„å…±äº«æ‰ä¼šç»“æŸæœåŠ¡`</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623205132460.png" alt="image-20200623205132460"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 2.å®¢æˆ·ç«¯æ–¹å¼ä¹‹SAVE</span><span class="hljs-bullet">-</span> b.ï¬å®¢æˆ·ç«¯è¿˜å¯ä»¥ä½¿ç”¨SAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§,æ¥æ”¶åˆ°SAVEå‘½ä»¤çš„redisæœåŠ¡å™¨åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰å°†ä¸å†å“åº”ä»»ä½•å…¶ä»–çš„å‘½ä»¤</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623205444101.png" alt="image-20200623205444101"></p><ul><li><strong>æ³¨æ„: SAVEå‘½ä»¤å¹¶ä¸å¸¸ç”¨,ä½¿ç”¨SAVEå‘½ä»¤åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰,rediså¤„äºé˜»å¡çŠ¶æ€,æ— æ³•å¯¹å¤–æœåŠ¡</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.æœåŠ¡å™¨é…ç½®æ–¹å¼ä¹‹æ»¡è¶³é…ç½®è‡ªåŠ¨è§¦å‘</span><span class="hljs-bullet">-</span> ï¬å¦‚æœç”¨æˆ·åœ¨redis.confä¸­è®¾ç½®äº†saveé…ç½®é€‰é¡¹,redisä¼šåœ¨saveé€‰é¡¹æ¡ä»¶æ»¡è¶³ä¹‹åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤,å¦‚æœè®¾ç½®å¤šä¸ªsaveé…ç½®é€‰é¡¹,å½“ä»»æ„ä¸€ä¸ªsaveé…ç½®é€‰é¡¹æ¡ä»¶æ»¡è¶³,redisä¹Ÿä¼šè§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623210021012.png" alt="image-20200623210021012"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 4.æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤</span><span class="hljs-bullet">-</span> å½“redisé€šè¿‡shutdownæŒ‡ä»¤æ¥æ”¶åˆ°å…³é—­æœåŠ¡å™¨çš„è¯·æ±‚æ—¶,ä¼šæ‰§è¡Œä¸€ä¸ªsaveå‘½ä»¤,é˜»å¡æ‰€æœ‰çš„å®¢æˆ·ç«¯,ä¸å†æ‰§è¡Œå®¢æˆ·ç«¯æ‰§è¡Œå‘é€çš„ä»»ä½•å‘½ä»¤,å¹¶ä¸”åœ¨saveå‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åå…³é—­æœåŠ¡å™¨</code></pre></div><h4 id="3-é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®"><a href="#3-é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®" class="headerlink" title="3.é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®"></a>3.é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ä¿®æ”¹ç”Ÿæˆå¿«ç…§åç§°</span><span class="hljs-bullet">-</span> dbfilename dump.rdb<span class="hljs-section"># 2.ä¿®æ”¹ç”Ÿæˆä½ç½®</span><span class="hljs-bullet">-</span> dir ./</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623210352448.png" alt="image-20200623210352448"></p><hr><h2 id="9-2-AOF-åªè¿½åŠ æ—¥å¿—æ–‡ä»¶"><a href="#9-2-AOF-åªè¿½åŠ æ—¥å¿—æ–‡ä»¶" class="headerlink" title="9.2 AOF åªè¿½åŠ æ—¥å¿—æ–‡ä»¶"></a>9.2 AOF åªè¿½åŠ æ—¥å¿—æ–‡ä»¶</h2><h4 id="1-ç‰¹ç‚¹-1"><a href="#1-ç‰¹ç‚¹-1" class="headerlink" title="1.ç‰¹ç‚¹"></a>1.ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œçš„å†™å‘½ä»¤è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­,AOFæŒä¹…åŒ–ä¼šå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å†™åˆ°AOFçš„æ–‡ä»¶æœ«å°¾,ä»¥æ­¤æ¥è®°å½•æ•°æ®å‘ç”Ÿçš„å˜åŒ–,å› æ­¤åªè¦redis**ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€æ¬¡AOFæ–‡ä»¶æ‰€åŒ…å«çš„æ‰€æœ‰å†™å‘½ä»¤,**å°±å¯ä»¥æ¢å¤AOFæ–‡ä»¶çš„è®°å½•çš„æ•°æ®é›†.</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623211330798.png" alt="image-20200623211330798"></p><h4 id="2-å¼€å¯AOFæŒä¹…åŒ–"><a href="#2-å¼€å¯AOFæŒä¹…åŒ–" class="headerlink" title="2.å¼€å¯AOFæŒä¹…åŒ–"></a>2.å¼€å¯AOFæŒä¹…åŒ–</h4><p>åœ¨redisçš„é»˜è®¤é…ç½®ä¸­AOFæŒä¹…åŒ–æœºåˆ¶æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åœ¨é…ç½®ä¸­å¼€å¯</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å¼€å¯AOFæŒä¹…åŒ–</span><span class="hljs-bullet">-</span> a.ä¿®æ”¹ appendonly yes å¼€å¯æŒä¹…åŒ–<span class="hljs-bullet">-</span> b.ä¿®æ”¹ appendfilename &quot;appendonly.aof&quot; æŒ‡å®šç”Ÿæˆæ–‡ä»¶åç§°</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623211508987.png" alt="image-20200623211508987"></p><h4 id="3-æ—¥å¿—è¿½åŠ é¢‘ç‡"><a href="#3-æ—¥å¿—è¿½åŠ é¢‘ç‡" class="headerlink" title="3.æ—¥å¿—è¿½åŠ é¢‘ç‡"></a>3.æ—¥å¿—è¿½åŠ é¢‘ç‡</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.always ã€è°¨æ…ä½¿ç”¨ã€‘</span><span class="hljs-bullet">-</span> è¯´æ˜: æ¯ä¸ªrediså†™å‘½ä»¤éƒ½è¦åŒæ­¥å†™å…¥ç¡¬ç›˜,ä¸¥é‡é™ä½redisé€Ÿåº¦<span class="hljs-bullet">-</span> è§£é‡Š: å¦‚æœç”¨æˆ·ä½¿ç”¨äº†alwaysé€‰é¡¹,é‚£ä¹ˆæ¯ä¸ªrediså†™å‘½ä»¤éƒ½ä¼šè¢«å†™å…¥ç¡¬ç›˜,ä»è€Œå°†å‘ç”Ÿç³»ç»Ÿå´©æºƒæ—¶å‡ºç°çš„æ•°æ®ä¸¢å¤±å‡åˆ°æœ€å°‘;é—æ†¾çš„æ˜¯,å› ä¸ºè¿™ç§åŒæ­¥ç­–ç•¥éœ€è¦å¯¹ç¡¬ç›˜è¿›è¡Œå¤§é‡çš„å†™å…¥æ“ä½œ,æ‰€ä»¥rediså¤„ç†å‘½ä»¤çš„é€Ÿåº¦ä¼šå—åˆ°ç¡¬ç›˜æ€§èƒ½çš„é™åˆ¶;<span class="hljs-bullet">-</span> æ³¨æ„: è½¬ç›˜å¼ç¡¬ç›˜åœ¨è¿™ç§é¢‘ç‡ä¸‹200å·¦å³ä¸ªå‘½ä»¤/s ; å›ºæ€ç¡¬ç›˜(SSD) å‡ ç™¾ä¸‡ä¸ªå‘½ä»¤/s;<span class="hljs-bullet">-</span> è­¦å‘Š: ä½¿ç”¨SSDç”¨æˆ·è¯·è°¨æ…ä½¿ç”¨alwaysé€‰é¡¹,è¿™ç§æ¨¡å¼ä¸æ–­å†™å…¥å°‘é‡æ•°æ®çš„åšæ³•æœ‰å¯èƒ½ä¼šå¼•å‘ä¸¥é‡çš„å†™å…¥æ”¾å¤§é—®é¢˜,å¯¼è‡´å°†å›ºæ€ç¡¬ç›˜çš„å¯¿å‘½ä»åŸæ¥çš„å‡ å¹´é™ä½ä¸ºå‡ ä¸ªæœˆã€‚<span class="hljs-section"># 2.everysec ã€æ¨èã€‘</span><span class="hljs-bullet">-</span> è¯´æ˜: æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥æ˜¾å¼çš„å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜<span class="hljs-bullet">-</span> è§£é‡Šï¼š ä¸ºäº†å…¼é¡¾æ•°æ®å®‰å…¨å’Œå†™å…¥æ€§èƒ½,ç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨everysecé€‰é¡¹,è®©redisæ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥;redisæ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶æ—¶æ€§èƒ½å’Œä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–ç‰¹æ€§æ—¶çš„æ€§èƒ½ç›¸å·®æ— å‡ ,è€Œé€šè¿‡æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶,rediså¯ä»¥ä¿è¯,å³ä½¿ç³»ç»Ÿå´©æºƒ,ç”¨æˆ·æœ€å¤šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚<span class="hljs-section"># 3.noã€ä¸æ¨èã€‘</span><span class="hljs-bullet">-</span> è¯´æ˜: ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ <span class="hljs-bullet">-</span> è§£é‡Šï¼šæœ€åä½¿ç”¨noé€‰é¡¹,å°†å®Œå…¨æœ‰æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥AOFæ—¥å¿—æ–‡ä»¶,è¿™ä¸ªé€‰é¡¹ä¸ä¼šå¯¹redisæ€§èƒ½å¸¦æ¥å½±å“ä½†æ˜¯ç³»ç»Ÿå´©æºƒæ—¶,ä¼šä¸¢å¤±ä¸å®šæ•°é‡çš„æ•°æ®,å¦å¤–å¦‚æœç”¨æˆ·ç¡¬ç›˜å¤„ç†å†™å…¥æ“ä½œä¸å¤Ÿå¿«çš„è¯,å½“ç¼“å†²åŒºè¢«ç­‰å¾…å†™å…¥ç¡¬ç›˜æ•°æ®å¡«æ»¡æ—¶,redisä¼šå¤„äºé˜»å¡çŠ¶æ€,å¹¶å¯¼è‡´redisçš„å¤„ç†å‘½ä»¤è¯·æ±‚çš„é€Ÿåº¦å˜æ…¢ã€‚</code></pre></div><h4 id="4-ä¿®æ”¹åŒæ­¥é¢‘ç‡"><a href="#4-ä¿®æ”¹åŒæ­¥é¢‘ç‡" class="headerlink" title="4.ä¿®æ”¹åŒæ­¥é¢‘ç‡"></a>4.ä¿®æ”¹åŒæ­¥é¢‘ç‡</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ä¿®æ”¹æ—¥å¿—åŒæ­¥é¢‘ç‡</span><span class="hljs-bullet">-</span> ä¿®æ”¹appendfsync everysec|always|no æŒ‡å®š</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623211658910.png" alt="image-20200623211658910"></p><hr><h2 id="9-3-AOFæ–‡ä»¶çš„é‡å†™"><a href="#9-3-AOFæ–‡ä»¶çš„é‡å†™" class="headerlink" title="9.3 AOFæ–‡ä»¶çš„é‡å†™"></a>9.3 AOFæ–‡ä»¶çš„é‡å†™</h2><h4 id="1-AOFå¸¦æ¥çš„é—®é¢˜"><a href="#1-AOFå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="1. AOFå¸¦æ¥çš„é—®é¢˜"></a>1. AOFå¸¦æ¥çš„é—®é¢˜</h4><p>AOFçš„æ–¹å¼ä¹ŸåŒæ—¶å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨incr testå‘½ä»¤100æ¬¡ï¼Œæ–‡ä»¶ä¸­å¿…é¡»ä¿å­˜å…¨éƒ¨çš„100æ¡å‘½ä»¤ï¼Œå…¶å®æœ‰99æ¡éƒ½æ˜¯å¤šä½™çš„ã€‚å› ä¸ºè¦æ¢å¤æ•°æ®åº“çš„çŠ¶æ€å…¶å®æ–‡ä»¶ä¸­ä¿å­˜ä¸€æ¡set test 100å°±å¤Ÿäº†ã€‚ä¸ºäº†å‹ç¼©aofçš„æŒä¹…åŒ–æ–‡ä»¶Redisæä¾›äº†AOFé‡å†™(ReWriter)æœºåˆ¶ã€‚</p><h4 id="2-AOFé‡å†™"><a href="#2-AOFé‡å†™" class="headerlink" title="2. AOFé‡å†™"></a>2. AOFé‡å†™</h4><p>ç”¨æ¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°AOFæ–‡ä»¶çš„ä½“ç§¯</p><h4 id="3-è§¦å‘é‡å†™æ–¹å¼"><a href="#3-è§¦å‘é‡å†™æ–¹å¼" class="headerlink" title="3. è§¦å‘é‡å†™æ–¹å¼"></a>3. è§¦å‘é‡å†™æ–¹å¼</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å®¢æˆ·ç«¯æ–¹å¼è§¦å‘é‡å†™</span><span class="hljs-bullet">-</span> æ‰§è¡ŒBGREWRITEAOFå‘½ä»¤  ä¸ä¼šé˜»å¡redisçš„æœåŠ¡<span class="hljs-section"># 2.æœåŠ¡å™¨é…ç½®æ–¹å¼è‡ªåŠ¨è§¦å‘</span><span class="hljs-bullet">-</span> é…ç½®redis.confä¸­çš„auto-aof-rewrite-percentageé€‰é¡¹ å‚åŠ ä¸‹å›¾â†“â†“â†“<span class="hljs-bullet">-</span> å¦‚æœè®¾ç½®auto-aof-rewrite-percentageå€¼ä¸º100å’Œauto-aof-rewrite-min-size 64mb,å¹¶ä¸”å¯ç”¨çš„AOFæŒä¹…åŒ–æ—¶,é‚£ä¹ˆå½“AOFæ–‡ä»¶ä½“ç§¯å¤§äº64M,å¹¶ä¸”AOFæ–‡ä»¶çš„ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™ä¹‹åä½“ç§¯å¤§äº†è‡³å°‘ä¸€å€(100%)æ—¶,ä¼šè‡ªåŠ¨è§¦å‘,å¦‚æœé‡å†™è¿‡äºé¢‘ç¹,ç”¨æˆ·å¯ä»¥è€ƒè™‘å°†auto-aof-rewrite-percentageè®¾ç½®ä¸ºæ›´å¤§</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623212547775.png" alt="image-20200623212547775"></p><h4 id="4-é‡å†™åŸç†"><a href="#4-é‡å†™åŸç†" class="headerlink" title="4. é‡å†™åŸç†"></a>4. é‡å†™åŸç†</h4><p> <strong>æ³¨æ„ï¼šé‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶,æ›¿æ¢åŸæœ‰çš„æ–‡ä»¶è¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># é‡å†™æµç¨‹</span><span class="hljs-bullet">-</span> 1. redisè°ƒç”¨fork ï¼Œç°åœ¨æœ‰çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ å­è¿›ç¨‹æ ¹æ®å†…å­˜ä¸­çš„æ•°æ®åº“å¿«ç…§ï¼Œå¾€ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥é‡å»ºæ•°æ®åº“çŠ¶æ€çš„å‘½ä»¤<span class="hljs-bullet">-</span> 2. çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†clientè¯·æ±‚ï¼Œé™¤äº†æŠŠå†™å‘½ä»¤å†™å…¥åˆ°åŸæ¥çš„aofæ–‡ä»¶ä¸­ã€‚åŒæ—¶æŠŠæ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯å¦‚æœå­è¿›ç¨‹é‡å†™å¤±è´¥çš„è¯å¹¶ä¸ä¼šå‡ºé—®é¢˜ã€‚<span class="hljs-bullet">-</span> 3. å½“å­è¿›ç¨‹æŠŠå¿«ç…§å†…å®¹å†™å…¥å·²å‘½ä»¤æ–¹å¼å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­åï¼Œå­è¿›ç¨‹å‘ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ã€‚ç„¶åçˆ¶è¿›ç¨‹æŠŠç¼“å­˜çš„å†™å‘½ä»¤ä¹Ÿå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚<span class="hljs-bullet">-</span> 4. ç°åœ¨çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è€çš„aofæ–‡ä»¶ï¼Œå¹¶é‡å‘½åï¼Œåé¢æ”¶åˆ°çš„å†™å‘½ä»¤ä¹Ÿå¼€å§‹å¾€æ–°çš„aofæ–‡ä»¶ä¸­è¿½åŠ ã€‚</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623214843123.png" alt="image-20200623214843123"></p><hr><h2 id="9-4-æŒä¹…åŒ–æ€»ç»“"><a href="#9-4-æŒä¹…åŒ–æ€»ç»“" class="headerlink" title="9.4 æŒä¹…åŒ–æ€»ç»“"></a>9.4 æŒä¹…åŒ–æ€»ç»“</h2><p>ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆæ—¢å¯ä»¥åŒæ—¶ä½¿ç”¨(aof),åˆå¯ä»¥å•ç‹¬ä½¿ç”¨,åœ¨æŸç§æƒ…å†µä¸‹ä¹Ÿå¯ä»¥éƒ½ä¸ä½¿ç”¨,å…·ä½“ä½¿ç”¨é‚£ç§æŒä¹…åŒ–æ–¹æ¡ˆå–å†³äºç”¨æˆ·çš„æ•°æ®å’Œåº”ç”¨å†³å®šã€‚</p><p>æ— è®ºä½¿ç”¨AOFè¿˜æ˜¯å¿«ç…§æœºåˆ¶æŒä¹…åŒ–,å°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜éƒ½æ˜¯æœ‰å¿…è¦çš„,é™¤äº†æŒä¹…åŒ–å¤–,ç”¨æˆ·è¿˜åº”è¯¥å¯¹æŒä¹…åŒ–çš„æ–‡ä»¶è¿›è¡Œå¤‡ä»½(æœ€å¥½å¤‡ä»½åœ¨å¤šä¸ªä¸åŒåœ°æ–¹)ã€‚</p><hr><h1 id="10-javaæ“ä½œRedis"><a href="#10-javaæ“ä½œRedis" class="headerlink" title="10. javaæ“ä½œRedis"></a>10. javaæ“ä½œRedis</h1><h2 id="10-1-ç¯å¢ƒå‡†å¤‡"><a href="#10-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="10.1 ç¯å¢ƒå‡†å¤‡"></a>10.1 ç¯å¢ƒå‡†å¤‡</h2><h4 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼•å…¥jedisè¿æ¥ä¾èµ–--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="2-åˆ›å»ºjediså¯¹è±¡"><a href="#2-åˆ›å»ºjediså¯¹è±¡" class="headerlink" title="2.åˆ›å»ºjediså¯¹è±¡"></a>2.åˆ›å»ºjediså¯¹è±¡</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;    <span class="hljs-comment">//1.åˆ›å»ºjediså¯¹è±¡</span>    <span class="hljs-comment">//1.redisæœåŠ¡å¿…é¡»å…³é—­é˜²ç«å¢™  2.redisæœåŠ¡å¿…é¡»å¼€å¯è¿œç¨‹è¿æ¥</span>    Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;172.16.211.4&quot;</span>, <span class="hljs-number">6379</span>);    <span class="hljs-comment">//é€‰æ‹©æ“ä½œçš„åº“é»˜è®¤0å·åº“</span>    jedis.select(<span class="hljs-number">0</span>);    <span class="hljs-comment">//2.æ‰§è¡Œç›¸å…³æ“ä½œ</span>    Set&lt;String&gt; keys = jedis.keys(<span class="hljs-string">&quot;*&quot;</span>);    keys.forEach(key -&gt; System.out.println(<span class="hljs-string">&quot;key = &quot;</span> + key));    <span class="hljs-comment">//3.é‡Šæ”¾èµ„æº</span>    jedis.close();&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210512113801560.png" alt="image-20210512113801560"></p><h2 id="10-2-æ“ä½œkeyç›¸å…³API"><a href="#10-2-æ“ä½œkeyç›¸å…³API" class="headerlink" title="10.2 æ“ä½œkeyç›¸å…³API"></a>10.2 æ“ä½œkeyç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Jedis jedis;    <span class="hljs-meta">@Before</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;       <span class="hljs-keyword">this</span>.jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;172.16.211.4&quot;</span>, <span class="hljs-number">6379</span>);    &#125;    <span class="hljs-meta">@After</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">after</span><span class="hljs-params">()</span></span>&#123;        jedis.close();    &#125;    <span class="hljs-comment">//æµ‹è¯•keyç›¸å…³</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testKeys</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//åˆ é™¤ä¸€ä¸ªkey</span>        jedis.del(<span class="hljs-string">&quot;name&quot;</span>);        <span class="hljs-comment">//åˆ é™¤å¤šä¸ªkey</span>        jedis.del(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>);        <span class="hljs-comment">//åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨exits</span>        Boolean name = jedis.exists(<span class="hljs-string">&quot;name&quot;</span>);        System.out.println(name);        <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªkeyè¶…æ—¶æ—¶é—´ expire pexpire</span>        Long age = jedis.expire(<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-number">100</span>);        System.out.println(age);        <span class="hljs-comment">//è·å–ä¸€ä¸ªkeyè¶…æ—¶æ—¶é—´ ttl</span>        Long age1 = jedis.ttl(<span class="hljs-string">&quot;newage&quot;</span>);        System.out.println(age1);        <span class="hljs-comment">//éšæœºè·å–ä¸€ä¸ªkey</span>        String s = jedis.randomKey();        <span class="hljs-comment">//ä¿®æ”¹keyåç§°</span>        jedis.rename(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;newage&quot;</span>);        <span class="hljs-comment">//æŸ¥çœ‹å¯ä»¥å¯¹åº”å€¼çš„ç±»å‹</span>        String name1 = jedis.type(<span class="hljs-string">&quot;name&quot;</span>);        System.out.println(name1);        String maps = jedis.type(<span class="hljs-string">&quot;maps&quot;</span>);        System.out.println(maps);    &#125;</code></pre></div><h2 id="10-3æ“ä½œStringç›¸å…³API"><a href="#10-3æ“ä½œStringç›¸å…³API" class="headerlink" title="10.3æ“ä½œStringç›¸å…³API"></a>10.3æ“ä½œStringç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•Stringç›¸å…³</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testString</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//set</span>        jedis.set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;å°é™ˆ&quot;</span>);        <span class="hljs-comment">//get</span>        String s = jedis.get(<span class="hljs-string">&quot;name&quot;</span>);        System.out.println(s);        <span class="hljs-comment">//mset</span>        jedis.mset(<span class="hljs-string">&quot;content&quot;</span>,<span class="hljs-string">&quot;å¥½äºº&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>,<span class="hljs-string">&quot;æµ·æ·€åŒº&quot;</span>);        <span class="hljs-comment">//mget</span>        List&lt;String&gt; mget = jedis.mget(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;address&quot;</span>);        mget.forEach(v-&gt; System.out.println(<span class="hljs-string">&quot;v = &quot;</span> + v));        <span class="hljs-comment">//getset</span>        String set = jedis.getSet(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å°æ˜&quot;</span>);        System.out.println(set);        <span class="hljs-comment">//............</span>    &#125;</code></pre></div><h2 id="10-4æ“ä½œListç›¸å…³API"><a href="#10-4æ“ä½œListç›¸å…³API" class="headerlink" title="10.4æ“ä½œListç›¸å…³API"></a>10.4æ“ä½œListç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•Listç›¸å…³</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testList</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//lpush</span>        jedis.lpush(<span class="hljs-string">&quot;names1&quot;</span>,<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>,<span class="hljs-string">&quot;ç‹äº”&quot;</span>,<span class="hljs-string">&quot;èµµæŸ³&quot;</span>,<span class="hljs-string">&quot;win7&quot;</span>);        <span class="hljs-comment">//rpush</span>        jedis.rpush(<span class="hljs-string">&quot;names1&quot;</span>,<span class="hljs-string">&quot;xiaomingming&quot;</span>);        <span class="hljs-comment">//lrange</span>        List&lt;String&gt; names1 = jedis.lrange(<span class="hljs-string">&quot;names1&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);        names1.forEach(name-&gt; System.out.println(<span class="hljs-string">&quot;name = &quot;</span> + name));        <span class="hljs-comment">//lpop rpop</span>        String names11 = jedis.lpop(<span class="hljs-string">&quot;names1&quot;</span>);        System.out.println(names11);        <span class="hljs-comment">//llen</span>        jedis.linsert(<span class="hljs-string">&quot;lists&quot;</span>, BinaryClient.LIST_POSITION.BEFORE,<span class="hljs-string">&quot;xiaohei&quot;</span>,<span class="hljs-string">&quot;xiaobai&quot;</span>);      <span class="hljs-comment">//........</span>    &#125;</code></pre></div><h2 id="10-5æ“ä½œSetçš„ç›¸å…³API"><a href="#10-5æ“ä½œSetçš„ç›¸å…³API" class="headerlink" title="10.5æ“ä½œSetçš„ç›¸å…³API"></a>10.5æ“ä½œSetçš„ç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•SETç›¸å…³</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSet</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-comment">//sadd</span>  jedis.sadd(<span class="hljs-string">&quot;names&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);  <span class="hljs-comment">//smembers</span>  jedis.smembers(<span class="hljs-string">&quot;names&quot;</span>);  <span class="hljs-comment">//sismember</span>  jedis.sismember(<span class="hljs-string">&quot;names&quot;</span>,<span class="hljs-string">&quot;xiaochen&quot;</span>);  <span class="hljs-comment">//...</span>&#125;</code></pre></div><h2 id="10-6-æ“ä½œZSetç›¸å…³API"><a href="#10-6-æ“ä½œZSetç›¸å…³API" class="headerlink" title="10.6 æ“ä½œZSetç›¸å…³API"></a>10.6 æ“ä½œZSetç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•ZSETç›¸å…³</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testZset</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-comment">//zadd</span>  jedis.zadd(<span class="hljs-string">&quot;names&quot;</span>,<span class="hljs-number">10</span>,<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);  <span class="hljs-comment">//zrange</span>  jedis.zrange(<span class="hljs-string">&quot;names&quot;</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>);  <span class="hljs-comment">//zcard</span>  jedis.zcard(<span class="hljs-string">&quot;names&quot;</span>);  <span class="hljs-comment">//zrangeByScore</span>  jedis.zrangeByScore(<span class="hljs-string">&quot;names&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);  <span class="hljs-comment">//..</span>&#125;</code></pre></div><h2 id="10-7-æ“ä½œHashç›¸å…³API"><a href="#10-7-æ“ä½œHashç›¸å…³API" class="headerlink" title="10.7 æ“ä½œHashç›¸å…³API"></a>10.7 æ“ä½œHashç›¸å…³API</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•HASHç›¸å…³</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testHash</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-comment">//hset</span>  jedis.hset(<span class="hljs-string">&quot;maps&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>);  <span class="hljs-comment">//hget</span>  jedis.hget(<span class="hljs-string">&quot;maps&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>);  <span class="hljs-comment">//hgetall</span>  jedis.hgetAll(<span class="hljs-string">&quot;mps&quot;</span>);  <span class="hljs-comment">//hkeys</span>  jedis.hkeys(<span class="hljs-string">&quot;maps&quot;</span>);  <span class="hljs-comment">//hvals</span>  jedis.hvals(<span class="hljs-string">&quot;maps&quot;</span>);  <span class="hljs-comment">//....</span>&#125;</code></pre></div><h1 id="11-SpringBootæ•´åˆRedis"><a href="#11-SpringBootæ•´åˆRedis" class="headerlink" title="11.SpringBootæ•´åˆRedis"></a>11.SpringBootæ•´åˆRedis</h1><p>Spring Boot Data(æ•°æ®) Redis ä¸­æä¾›äº†<strong>RedisTemplateå’ŒStringRedisTemplate</strong>ï¼Œå…¶ä¸­StringRedisTemplateæ˜¯RedisTemplateçš„å­ç±»ï¼Œä¸¤ä¸ªæ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„ä¸»è¦ä½“ç°åœ¨æ“ä½œçš„æ•°æ®ç±»å‹ä¸åŒï¼Œ<strong>RedisTemplateä¸­çš„ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Objectï¼Œæ„å‘³ç€å­˜å‚¨çš„keyå’Œvalueéƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒStringRedisTemplateçš„ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Stringï¼Œæ„å‘³ç€StringRedisTemplateçš„keyå’Œvalueéƒ½åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚</strong></p><p><code>æ³¨æ„: ä½¿ç”¨RedisTemplateé»˜è®¤æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–åˆ°Redisä¸­,æ‰€ä»¥æ”¾å…¥çš„å¯¹è±¡å¿…é¡»å®ç°å¯¹è±¡åºåˆ—åŒ–æ¥å£</code></p><h2 id="11-1-ç¯å¢ƒå‡†å¤‡"><a href="#11-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="11.1 ç¯å¢ƒå‡†å¤‡"></a>11.1 ç¯å¢ƒå‡†å¤‡</h2><h4 id="1-å¼•å…¥ä¾èµ–-1"><a href="#1-å¼•å…¥ä¾èµ–-1" class="headerlink" title="1.å¼•å…¥ä¾èµ–"></a>1.å¼•å…¥ä¾èµ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="2-é…ç½®application-propertie"><a href="#2-é…ç½®application-propertie" class="headerlink" title="2.é…ç½®application.propertie"></a>2.é…ç½®application.propertie</h4><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">localhost</span><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span></code></pre></div><h2 id="11-2-StringRedisTemplateå’ŒRedisTemplate"><a href="#11-2-StringRedisTemplateå’ŒRedisTemplate" class="headerlink" title="11.2 StringRedisTemplateå’ŒRedisTemplate"></a>11.2 StringRedisTemplateå’ŒRedisTemplate</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;  <span class="hljs-comment">//å¯¹å­—ç¬¦ä¸²æ”¯æŒæ¯”è¾ƒå‹å¥½,ä¸èƒ½å­˜å‚¨å¯¹è±¡</span>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;  <span class="hljs-comment">//å­˜å‚¨å¯¹è±¡</span><span class="hljs-comment">//RedisTemplate</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRedisTemplate</span><span class="hljs-params">()</span></span>&#123;            <span class="hljs-comment">/**</span><span class="hljs-comment">      * redistemplateå¯¹è±¡ä¸­keyå’Œvalueçš„åºåˆ—åŒ–éƒ½æ˜¯JdkSerializationRedisSerializer</span><span class="hljs-comment">      */</span>        System.out.println(redisTemplate);        <span class="hljs-comment">//è®¾ç½®redistemplateå€¼ä½¿ç”¨å¯¹è±¡åºåˆ—åŒ–ç­–ç•¥</span>      <span class="hljs-comment">//æŒ‡å®šå€¼ä½¿ç”¨å¯¹è±¡åºåˆ—åŒ–---&gt;new StringRedisSerilalizer()æˆ–è€…å…¶ä»–</span>        redisTemplate.setValueSerializer(<span class="hljs-keyword">new</span> JdkSerializationRedisSerializer());        <span class="hljs-comment">//redisTemplate.opsForValue().set(&quot;user&quot;,new User(&quot;21&quot;,&quot;å°é»‘&quot;,23,new Date()));</span>        User user = (User) redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user&quot;</span>);        System.out.println(user);<span class="hljs-comment">//      Set keys = redisTemplate.keys(&quot;*&quot;);</span><span class="hljs-comment">//      keys.forEach(key -&gt; System.out.println(key));</span>        <span class="hljs-comment">/*Object name = redisTemplate.opsForValue().get(&quot;name&quot;);</span><span class="hljs-comment">        System.out.println(name);*/</span>        <span class="hljs-comment">//Object xiaohei = redisTemplate.opsForValue().get(&quot;xiaohei&quot;);</span>        <span class="hljs-comment">//System.out.println(xiaohei);</span>        <span class="hljs-comment">/*redisTemplate.opsForValue().set(&quot;name&quot;,&quot;xxxx&quot;);</span><span class="hljs-comment">        Object name = redisTemplate.opsForValue().get(&quot;name&quot;);</span><span class="hljs-comment">        System.out.println(name);*/</span>        <span class="hljs-comment">/*redisTemplate.opsForList().leftPushAll(&quot;lists&quot;,&quot;xxxx&quot;,&quot;1111&quot;);</span><span class="hljs-comment">        List lists = redisTemplate.opsForList().range(&quot;lists&quot;, 0, -1);</span><span class="hljs-comment">        lists.forEach(list-&gt; System.out.println(list));*/</span>    &#125;<span class="hljs-comment">//StringRedisTemplate</span>    <span class="hljs-comment">//hashç›¸å…³æ“ä½œ opsForHash</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testHash</span><span class="hljs-params">()</span></span>&#123;        stringRedisTemplate.opsForHash().put(<span class="hljs-string">&quot;maps&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;å°é»‘&quot;</span>);        Object o = stringRedisTemplate.opsForHash().get(<span class="hljs-string">&quot;maps&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>);        System.out.println(o);    &#125;    <span class="hljs-comment">//zsetç›¸å…³æ“ä½œ opsForZSet</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testZSet</span><span class="hljs-params">()</span></span>&#123;        stringRedisTemplate.opsForZSet().add(<span class="hljs-string">&quot;zsets&quot;</span>,<span class="hljs-string">&quot;å°é»‘&quot;</span>,<span class="hljs-number">10</span>);        Set&lt;String&gt; zsets = stringRedisTemplate.opsForZSet().range(<span class="hljs-string">&quot;zsets&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);        zsets.forEach(value-&gt; System.out.println(value));    &#125;    <span class="hljs-comment">//setç›¸å…³æ“ä½œ opsForSet</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSet</span><span class="hljs-params">()</span></span>&#123;        stringRedisTemplate.opsForSet().add(<span class="hljs-string">&quot;sets&quot;</span>,<span class="hljs-string">&quot;xiaosan&quot;</span>,<span class="hljs-string">&quot;xiaosi&quot;</span>,<span class="hljs-string">&quot;xiaowu&quot;</span>);        Set&lt;String&gt; sets = stringRedisTemplate.opsForSet().members(<span class="hljs-string">&quot;sets&quot;</span>);        sets.forEach(value-&gt; System.out.println(value));    &#125;    <span class="hljs-comment">//listç›¸å…³çš„æ“ä½œopsForList</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testList</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">// stringRedisTemplate.opsForList().leftPushAll(&quot;lists&quot;,&quot;å¼ ä¸‰&quot;,&quot;æå››&quot;,&quot;ç‹äº”&quot;);</span>        List&lt;String&gt; lists = stringRedisTemplate.opsForList().range(<span class="hljs-string">&quot;lists&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);        lists.forEach(key -&gt; System.out.println(key));    &#125;    <span class="hljs-comment">//Stringç›¸å…³çš„æ“ä½œ opsForValue</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testString</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//stringRedisTemplate.opsForValue().set(&quot;166&quot;,&quot;å¥½åŒå­¦&quot;);</span>        String s = stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;166&quot;</span>);        System.out.println(s);        Long size = stringRedisTemplate.opsForValue().size(<span class="hljs-string">&quot;166&quot;</span>);        System.out.println(size);    &#125;    <span class="hljs-comment">//keyç›¸å…³çš„æ“ä½œ</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;        Set&lt;String&gt; keys = stringRedisTemplate.keys(<span class="hljs-string">&quot;*&quot;</span>);<span class="hljs-comment">//æŸ¥çœ‹æ‰€æœ‰key</span>        Boolean name = stringRedisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<span class="hljs-comment">//åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span>        stringRedisTemplate.delete(<span class="hljs-string">&quot;age&quot;</span>);<span class="hljs-comment">//æ ¹æ®æŒ‡å®škeyåˆ é™¤</span>        stringRedisTemplate.rename(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<span class="hljs-comment">//ä¿®æ”¹keyçš„åç§°</span>        stringRedisTemplate.expire(<span class="hljs-string">&quot;key&quot;</span>,<span class="hljs-number">10</span>, TimeUnit.HOURS);      <span class="hljs-comment">//è®¾ç½®keyè¶…æ—¶æ—¶é—´ å‚æ•°1:è®¾ç½®keyå å‚æ•°2:æ—¶é—´ å‚æ•°3:æ—¶é—´çš„å•ä½</span>        stringRedisTemplate.move(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">//ç§»åŠ¨key</span>    &#125;</code></pre></div><h2 id="11-3-ç»‘å®šæ“ä½œ"><a href="#11-3-ç»‘å®šæ“ä½œ" class="headerlink" title="11.3 ç»‘å®šæ“ä½œ"></a><strong>11.3 ç»‘å®šæ“ä½œ</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//keyçš„ç»‘å®šæ“ä½œ å¦‚æœæ—¥åå¯¹æŸä¸€ä¸ªkeyçš„æ“ä½œåŠå…¶é¢‘ç¹,å¯ä»¥å°†è¿™ä¸ªkeyç»‘å®šåˆ°å¯¹åº”redistemplateä¸­,æ—¥ååŸºäºç»‘å®šæ“ä½œéƒ½æ˜¯æ“ä½œè¿™ä¸ªkey</span><span class="hljs-comment">//boundValueOps ç”¨æ¥å¯¹Stringå€¼ç»‘å®škey</span><span class="hljs-comment">//boundListOps ç”¨æ¥å¯¹Listå€¼ç»‘å®škey</span><span class="hljs-comment">//boundSetOps ç”¨æ¥å¯¹Setå€¼ç»‘å®škey</span><span class="hljs-comment">//boundZsetOps ç”¨æ¥å¯¹Zsetå€¼ç»‘å®škey</span><span class="hljs-comment">//boundHashOps ç”¨æ¥å¯¹Hashå€¼ç»‘å®škey</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testBoundKey</span><span class="hljs-params">()</span></span>&#123;    BoundValueOperations&lt;String, String&gt; nameValueOperations = stringRedisTemplate.boundValueOps(<span class="hljs-string">&quot;name&quot;</span>);  <span class="hljs-comment">//æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨å¯¹&quot;name&quot;æ“ä½œ</span>    nameValueOperations.set(<span class="hljs-string">&quot;1&quot;</span>);    nameValueOperations.set(<span class="hljs-string">&quot;2&quot;</span>);    String s = nameValueOperations.get();    System.out.println(s);&#125;</code></pre></div><h1 id="12-Redisåº”ç”¨åœºæ™¯"><a href="#12-Redisåº”ç”¨åœºæ™¯" class="headerlink" title="12. Redisåº”ç”¨åœºæ™¯"></a>12. Redisåº”ç”¨åœºæ™¯</h1><ul><li>åˆ©ç”¨Redisä¸­<strong>å­—ç¬¦ä¸²ç±»å‹</strong>å®Œæˆé¡¹ç›®ä¸­<strong>æ‰‹æœºéªŒè¯ç å­˜å‚¨çš„å®ç°</strong></li><li>åˆ©ç”¨Redisä¸­<strong>å­—ç¬¦ä¸²ç±»å‹</strong>å®Œæˆå…·æœ‰<strong>å¤±æ•ˆæ€§ä¸šåŠ¡åŠŸèƒ½</strong>å¦‚12306ã€æ·˜å®ï¼šè®¢å•è¿˜æœ‰20åˆ†é’Ÿ</li><li>åˆ©ç”¨Redisä¸­<strong>åˆ†å¸ƒå¼é›†ç¾¤</strong>ç³»ç»Ÿçš„<strong>Sessionå…±äº«</strong></li><li>åˆ©ç”¨Redisä¸­<strong>zsetç±»å‹</strong>ã€<strong>å¯æ’åºsetç±»å‹</strong>å®Œæˆ<strong>æ’è¡Œæ¦œ</strong>ç­‰åŠŸèƒ½çš„å®ç°ï¼Œ[å•†å“idï¼Œå•†å“é”€é‡]</li><li>åˆ©ç”¨Redisä¸­<strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>å®ç°æŸ¥è¯¢ç­‰åŠŸèƒ½</li><li>åˆ©ç”¨Redis<strong>å­˜å‚¨è®¤è¯ä¹‹åtokenä¿¡æ¯</strong>å®ç°å¾®ä¿¡å°ç¨‹åºã€å…¬ä¼—å·ä¸­ç™»å½•ååŸºäºç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†openid<strong>ç”Ÿæˆè®¤è¯åçš„ä»¤ç‰Œtoken</strong></li><li>åˆ©ç”¨Redis è§£å†³<strong>åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿä¸­åˆ†å¸ƒå¼é”</strong>é—®é¢˜</li></ul><h1 id="13-Redisåˆ†å¸ƒå¼ç¼“å­˜"><a href="#13-Redisåˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="13.Redisåˆ†å¸ƒå¼ç¼“å­˜"></a>13.Redisåˆ†å¸ƒå¼ç¼“å­˜</h1><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513210302795.png" alt="image-20210513210302795"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513210340915.png" alt="image-20210513210340915"></p><p>mybatisæ˜¯é‡Œé¢æœ‰ä¸ª<code>&lt;cache&gt;&lt;/cache&gt;</code>ä¾¿ç­¾ï¼Œå¯ä»¥å®ç°åˆ†å¸ƒå¼ç¼“å­˜ï¼Œåªè¦æŠŠé‡Œé¢çš„å®ç°æ›¿æ¢æˆredisçš„å®ç°ï¼Œå°±å¯ä»¥å®ç°åˆ†å¸ƒå¼ç¼“å­˜</p><p>æ³¨æ„ï¼Œå¢åˆ æ”¹éƒ½ä¼šæ¸…é™¤ç¼“å­˜</p><h2 id="13-1-è‡ªå®šä¹‰Redisç¼“å­˜"><a href="#13-1-è‡ªå®šä¹‰Redisç¼“å­˜" class="headerlink" title="13.1 è‡ªå®šä¹‰Redisç¼“å­˜"></a>13.1 è‡ªå®šä¹‰Redisç¼“å­˜</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//è‡ªå®šä¹‰Redisç¼“å­˜å®ç°</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Cache</span> </span>&#123;<span class="hljs-comment">//å½“å‰æ”¾å…¥ç¼“å­˜çš„mapperçš„namespace</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String id;<span class="hljs-comment">//å¿…é¡»å­˜åœ¨æ„é€ æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RedisCache</span><span class="hljs-params">(String id)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;id:=====================&gt; &quot;</span> + id);    <span class="hljs-keyword">this</span>.id = id;&#125;<span class="hljs-comment">//è¿”å›cacheå”¯ä¸€æ ‡è¯†</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id;&#125; <span class="hljs-comment">//ç”¨æ¥è·å–springbootåˆ›å»ºå¥½çš„å·¥å‚</span><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationContextUtils</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationContextAware</span> </span>&#123;    <span class="hljs-comment">//ä¿ç•™ä¸‹æ¥å·¥å‚</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ApplicationContext applicationContext;    <span class="hljs-comment">//å°†åˆ›å»ºå¥½å·¥å‚ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™è¿™ä¸ªç±»</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;        <span class="hljs-keyword">this</span>.applicationContext = applicationContext;    &#125;    <span class="hljs-comment">//æä¾›åœ¨å·¥å‚ä¸­è·å–å¯¹è±¡çš„æ–¹æ³• //RedisTemplate  redisTemplate</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">getBean</span><span class="hljs-params">(String beanName)</span></span>&#123;        <span class="hljs-keyword">return</span> applicationContext.getBean(beanName);    &#125;&#125;  <span class="hljs-comment">//ç¼“å­˜æ”¾å…¥å€¼  redis RedisTemplate   StringRedisTemplate</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putObject</span><span class="hljs-params">(Object key, Object value)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;key:&quot;</span> + key.toString());    System.out.println(<span class="hljs-string">&quot;value:&quot;</span> + value);    <span class="hljs-comment">//        //é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><span class="hljs-comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span><span class="hljs-comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><span class="hljs-comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span>    <span class="hljs-comment">//ä½¿ç”¨redishashç±»å‹ä½œä¸ºç¼“å­˜å­˜å‚¨æ¨¡å‹  key   hashkey  value</span>    getRedisTemplate().opsForHash().put(id.toString(),getKeyToMD5(key.toString()),value);        <span class="hljs-keyword">if</span>(id.equals(<span class="hljs-string">&quot;com.baizhi.dao.UserDAO&quot;</span>))&#123;        <span class="hljs-comment">//ç¼“å­˜è¶…æ—¶  client  ç”¨æˆ·   client  å‘˜å·¥</span>        getRedisTemplate().expire(id.toString(),<span class="hljs-number">1</span>, TimeUnit.HOURS);    &#125;        <span class="hljs-keyword">if</span>(id.equals(<span class="hljs-string">&quot;com.baizhi.dao.CityDAO&quot;</span>))&#123;        <span class="hljs-comment">//ç¼“å­˜è¶…æ—¶  client  ç”¨æˆ·   client  å‘˜å·¥</span>        getRedisTemplate().expire(id.toString(),<span class="hljs-number">30</span>, TimeUnit.MINUTES);    &#125;    <span class="hljs-comment">//.....æŒ‡å®šä¸åŒä¸šåŠ¡æ¨¡å—è®¾ç½®ä¸åŒç¼“å­˜è¶…æ—¶æ—¶é—´</span>    &#125;<span class="hljs-comment">//è·å–ä¸­è·å–æ•°æ®</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getObject</span><span class="hljs-params">(Object key)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;key:&quot;</span> + key.toString());    <span class="hljs-comment">//      é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><span class="hljs-comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span><span class="hljs-comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><span class="hljs-comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span>    <span class="hljs-comment">//æ ¹æ®key ä»redisçš„hashç±»å‹ä¸­è·å–æ•°æ®</span>    <span class="hljs-keyword">return</span> getRedisTemplate().opsForHash().get(id.toString(), getKeyToMD5(key.toString()));&#125;<span class="hljs-comment">//æ³¨æ„:è¿™ä¸ªæ–¹æ³•ä¸ºmybatisä¿ç•™æ–¹æ³• é»˜è®¤æ²¡æœ‰å®ç° åç»­ç‰ˆæœ¬å¯èƒ½ä¼šå®ç°</span><span class="hljs-comment">//ç¼“å­˜æ’é™¤ç­–ç•¥æ‰€ç”¨</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">removeObject</span><span class="hljs-params">(Object key)</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;æ ¹æ®æŒ‡å®škeyåˆ é™¤ç¼“å­˜&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;    System.out.println(<span class="hljs-string">&quot;æ¸…ç©ºç¼“å­˜~~~&quot;</span>);    <span class="hljs-comment">//æ¸…ç©ºnamespace</span>    getRedisTemplate().delete(id.toString());<span class="hljs-comment">//æ¸…ç©ºç¼“å­˜</span>&#125;<span class="hljs-comment">//ç”¨æ¥è®¡ç®—ç¼“å­˜æ•°é‡</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-comment">//è·å–hashä¸­key valueæ•°é‡</span>    <span class="hljs-keyword">return</span> getRedisTemplate().opsForHash().size(id.toString()).intValue();&#125;<span class="hljs-comment">//å°è£…redisTemplate</span><span class="hljs-function"><span class="hljs-keyword">private</span> RedisTemplate <span class="hljs-title">getRedisTemplate</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span>    RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);    redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> StringRedisSerializer());    redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> StringRedisSerializer());    <span class="hljs-keyword">return</span> redisTemplate;&#125;<span class="hljs-comment">//å°è£…ä¸€ä¸ªå¯¹keyè¿›è¡Œmd5å¤„ç†æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getKeyToMD5</span><span class="hljs-params">(String key)</span></span>&#123;    <span class="hljs-keyword">return</span> DigestUtils.md5DigestAsHex(key.getBytes());&#125;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/5.redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98(%E4%BA%8C).png" alt="5.redisåˆ†å¸ƒå¼ç¼“å­˜(äºŒ)"></p><p>ç¼“å­˜çš„Clearåªèƒ½æ¸…é™¤å•è¡¨çš„ç¼“å­˜ï¼Œå½“ä¸šåŠ¡ä¸­æœ‰å¤šè¡¨çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½æ¸…é™¤æ‰€æœ‰è¡¨çš„ç¼“å­˜</p><p>è§£å†³æ–¹æ³•ï¼šå…±äº«ç¼“å­˜ï¼Œä½¿ç”¨<code>&lt;cache-ref&gt;</code>æ ‡ç­¾</p><h2 id="13-2-ç¼“å­˜ä¼˜åŒ–"><a href="#13-2-ç¼“å­˜ä¼˜åŒ–" class="headerlink" title="13.2 ç¼“å­˜ä¼˜åŒ–"></a>13.2 ç¼“å­˜ä¼˜åŒ–</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/6.redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98(%E4%B8%89).png" alt="6.redisåˆ†å¸ƒå¼ç¼“å­˜(ä¸‰)"></p><p>Springä¸­åˆ©ç”¨<code>DigestUtils.md5DigestAsHex(key.getBytes())</code>è¿›è¡ŒMD5ç®—æ³•åŠ å¯†</p><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€<strong>è®¿é—®äº†ä¸å­˜åœ¨çš„æ•°æ®</strong>ï¼Œè·³è¿‡äº†åˆæ³•æ•°æ®çš„redisæ•°æ®ç¼“å­˜é˜¶æ®µï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚é€šå¸¸æ­¤ç±»æ•°æ®çš„å‡ºç°é‡æ˜¯ä¸€ä¸ªè¾ƒä½çš„å€¼ï¼Œå½“å‡ºç°æ­¤ç±»æƒ…å†µä»¥æ¯’æ”»æ¯’ï¼Œå¹¶åŠæ—¶æŠ¥è­¦ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸´æ—¶é¢„æ¡ˆé˜²èŒƒæ–¹é¢å¤šåšæ–‡ç« ã€‚æ— è®ºæ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•ï¼Œéƒ½æ˜¯å¯¹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›ï¼Œè­¦æŠ¥è§£é™¤åå°½å¿«ç§»é™¤ã€‚</p><p><strong>æ•°æ®åº“æœåŠ¡å™¨å´©æºƒ</strong></p><ul><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li><li>åº”ç”¨æœåŠ¡å™¨æµé‡éšæ—¶é—´å¢é‡è¾ƒå¤§</li><li>RedisæœåŠ¡å™¨å‘½ä¸­ç‡éšæ—¶é—´é€æ­¥é™ä½</li><li>Rediså†…å­˜å¹³ç¨³ï¼Œå†…å­˜æ— å‹åŠ›</li><li>RedisæœåŠ¡å™¨CPUå ç”¨æ¿€å¢</li><li>æ•°æ®åº“æœåŠ¡å™¨å‹åŠ›æ¿€å¢</li><li>æ•°æ®åº“å´©æºƒ</li></ul><p><strong>é—®é¢˜æ’æŸ¥</strong></p><ul><li>Redisä¸­å¤§é¢ç§¯å‡ºç°æœªå‘½ä¸­</li><li>å‡ºç°éæ­£å¸¸URLè®¿é—®</li></ul><p><strong>é—®é¢˜åˆ†æ</strong></p><ul><li>è·å–çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæ•°æ®åº“æŸ¥è¯¢æœªå¾—åˆ°å¯¹åº”æ•°æ®</li><li>Redisè·å–åˆ°nullæ•°æ®æœªè¿›è¡ŒæŒä¹…åŒ–ï¼Œç›´æ¥è¿”å›</li><li>ä¸‹æ¬¡æ­¤ç±»æ•°æ®åˆ°è¾¾é‡å¤ä¸Šè¿°è¿‡ç¨‹</li><li>å‡ºç°é»‘å®¢æ”»å‡»æœåŠ¡å™¨</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li>ç¼“å­˜null<br>å¯¹æŸ¥è¯¢ç»“æœä¸ºnullçš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆé•¿æœŸä½¿ç”¨ï¼Œå®šæœŸæ¸…ç†ï¼‰ï¼Œè®¾å®šçŸ­æ—¶é™ï¼Œä¾‹å¦‚30-60ç§’ï¼Œæœ€é«˜5åˆ†é’Ÿ</li><li>ç™½åå•ç­–ç•¥<br>æå‰é¢„çƒ­å„ç§åˆ†ç±»æ•°æ®idå¯¹åº”çš„bitmapsï¼Œidä½œä¸ºbitmapsçš„offsetï¼Œç›¸å½“äºè®¾ç½®äº†æ•°æ®ç™½åå•ã€‚å½“åŠ è½½æ­£å¸¸æ•°æ®æ—¶ï¼Œæ”¾è¡Œï¼ŒåŠ è½½å¼‚å¸¸æ•°æ®æ—¶ç›´æ¥æ‹¦æˆªï¼ˆæ•ˆç‡åä½ï¼‰ã€ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæœ‰å…³å¸ƒéš†è¿‡æ»¤å™¨çš„å‘½ä¸­é—®é¢˜å¯¹å½“å‰çŠ¶å†µå¯ä»¥å¿½ç•¥ï¼‰</li><li>å®æ–½ç›‘æ§<br>å®æ—¶ç›‘æ§rediså‘½ä¸­ç‡ï¼ˆä¸šåŠ¡æ­£å¸¸èŒƒå›´æ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ³¢åŠ¨å€¼ï¼‰ä¸nullæ•°æ®çš„å æ¯”<br>éæ´»åŠ¨æ—¶æ®µæ³¢åŠ¨ï¼šé€šå¸¸æ£€æµ‹3-5å€ï¼Œè¶…è¿‡5å€çº³å…¥é‡ç‚¹æ’æŸ¥å¯¹è±¡<br>æ´»åŠ¨æ—¶æ®µæ³¢åŠ¨ï¼šé€šå¸¸æ£€æµ‹10-50å€ï¼Œè¶…è¿‡50å€çº³å…¥é‡ç‚¹æ’æŸ¥å¯¹è±¡<br>æ ¹æ®å€æ•°ä¸åŒï¼Œå¯åŠ¨ä¸åŒçš„æ’æŸ¥æµç¨‹ã€‚ç„¶åä½¿ç”¨é»‘åå•è¿›è¡Œé˜²æ§ï¼ˆè¿è¥ï¼‰</li><li>keyåŠ å¯†<br>é—®é¢˜å‡ºç°åï¼Œä¸´æ—¶å¯åŠ¨é˜²ç¾ä¸šåŠ¡keyï¼Œå¯¹keyè¿›è¡Œä¸šåŠ¡å±‚ä¼ è¾“åŠ å¯†æœåŠ¡ï¼Œè®¾å®šæ ¡éªŒç¨‹åºï¼Œè¿‡æ¥çš„keyæ ¡éªŒ<br>ä¾‹å¦‚æ¯å¤©éšæœºåˆ†é…60ä¸ªåŠ å¯†ä¸²ï¼ŒæŒ‘é€‰2åˆ°3ä¸ªï¼Œæ··æ·†åˆ°é¡µé¢æ•°æ®idä¸­ï¼Œå‘ç°è®¿é—®keyä¸æ»¡è¶³è§„åˆ™ï¼Œé©³å›æ•°æ®è®¿é—®ã€‚</li></ul><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p>ç¼“å­˜å‡»ç©¿å°±æ˜¯<strong>å•ä¸ªé«˜çƒ­æ•°æ®è¿‡æœŸçš„ç¬é—´</strong>ï¼Œæ•°æ®è®¿é—®é‡è¾ƒå¤§ï¼Œæœªå‘½ä¸­redisåï¼Œå‘èµ·äº†å¤§é‡å¯¹åŒä¸€æ•°æ®çš„æ•°æ®åº“è®¿é—®ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸šåŠ¡æ•°æ®åˆ†æä¸é¢„é˜²æ–¹é¢è¿›è¡Œï¼Œé…åˆè¿è¡Œç›‘æ§æµ‹è¯•ä¸å³æ—¶è°ƒæ•´ç­–ç•¥ï¼Œæ¯•ç«Ÿå•ä¸ªkeyçš„è¿‡æœŸç›‘æ§éš¾åº¦è¾ƒé«˜ï¼Œé…åˆé›ªå´©å¤„ç†ç­–ç•¥å³å¯</p><p><strong>æ•°æ®åº“æœåŠ¡å™¨å´©æºƒ</strong></p><ul><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li><li>æ•°æ®åº“è¿æ¥é‡ç¬é—´æ¿€å¢</li><li>RedisæœåŠ¡å™¨æ— å¤§é‡keyè¿‡æœŸ</li><li>Rediså†…å­˜å¹³ç¨³ï¼Œæ— æ³¢åŠ¨</li><li>RedisæœåŠ¡å™¨CPUæ­£å¸¸</li><li>æ•°æ®åº“å´©æºƒ</li></ul><p><strong>é—®é¢˜æ’æŸ¥</strong></p><ul><li>Redisä¸­æŸä¸ªkeyè¿‡æœŸï¼Œè¯¥keyè®¿é—®é‡å·¨å¤§</li><li>å¤šä¸ªæ•°æ®è¯·æ±‚ä»æœåŠ¡å™¨ç›´æ¥å‹åˆ°Redisåï¼Œå‡æœªå‘½ä¸­</li><li>Redisåœ¨çŸ­æ—¶é—´å†…å‘èµ·äº†å¤§é‡å¯¹æ•°æ®åº“ä¸­åŒä¸€æ•°æ®çš„è®¿é—®</li></ul><p><strong>é—®é¢˜åˆ†æ</strong></p><ul><li>å•ä¸ªkeyé«˜çƒ­æ•°æ®</li><li>keyè¿‡æœŸ</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li>é¢„å…ˆè®¾å®š<br>ä»¥ç”µå•†ä¸ºä¾‹ï¼Œæ¯ä¸ªå•†å®¶æ ¹æ®åº—é“ºç­‰çº§ï¼ŒæŒ‡å®šè‹¥å¹²æ¬¾ä¸»æ‰“å•†å“ï¼Œåœ¨è´­ç‰©èŠ‚æœŸé—´ï¼ŒåŠ å¤§æ­¤ç±»ä¿¡æ¯keyçš„è¿‡æœŸæ—¶é•¿<br>æ³¨æ„ï¼šè´­ç‰©èŠ‚ä¸ä»…ä»…æŒ‡å½“å¤©ï¼Œä»¥åŠåç»­è‹¥å¹²å¤©ï¼Œè®¿é—®å³°å€¼å‘ˆç°é€æ¸é™ä½çš„è¶‹åŠ¿</li><li>ç°åœºè°ƒæ•´<br>ç›‘æ§è®¿é—®é‡ï¼Œå¯¹è‡ªç„¶æµé‡æ¿€å¢çš„æ•°æ®å»¶é•¿è¿‡æœŸæ—¶é—´æˆ–è®¾ç½®ä¸ºæ°¸ä¹…æ€§key</li><li>åå°åˆ·æ–°æ•°æ®<br>å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé«˜å³°æœŸæ¥ä¸´ä¹‹å‰ï¼Œåˆ·æ–°æ•°æ®æœ‰æ•ˆæœŸï¼Œç¡®ä¿ä¸ä¸¢å¤±</li><li>äºŒçº§ç¼“å­˜<br>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œä¿éšœä¸ä¼šè¢«åŒæ—¶æ·˜æ±°å°±è¡Œ</li><li>åŠ é”<br>åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¢«å‡»ç©¿ï¼Œä½†æ˜¯è¦æ³¨æ„ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œæ…é‡ï¼</li></ul><h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a><strong>ç¼“å­˜é›ªå´©</strong></h4><p>ç¼“å­˜é›ªå´©å°±æ˜¯<strong>ç¬é—´è¿‡æœŸäº†ä¸€å¤§ç»„æ•°æ®é‡</strong>ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚å¦‚èƒ½å¤Ÿæœ‰æ•ˆé¿å…è¿‡æœŸæ—¶é—´é›†ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³é›ªå´©ç°è±¡çš„å‡ºç°ï¼ˆçº¦40%ï¼‰ï¼Œé…åˆå…¶ä»–ç­–ç•¥ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ç›‘æ§æœåŠ¡å™¨çš„è¿è¡Œæ•°æ®ï¼Œæ ¹æ®è¿è¡Œè®°å½•åšå¿«é€Ÿè°ƒæ•´</p><p><strong>æ•°æ®åº“æœåŠ¡å™¨å´©æºƒ</strong></p><ul><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿½ç„¶æ•°æ®åº“è¿æ¥é‡æ¿€å¢</li><li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚</li><li>å¤§é‡408ï¼Œ500é”™è¯¯é¡µé¢å‡ºç°</li><li>å®¢æˆ·åå¤åˆ·æ–°é¡µé¢è·å–æ•°æ®</li><li>æ•°æ®åº“å´©æºƒ</li><li>åº”ç”¨æœåŠ¡å™¨å´©æºƒ</li><li>é‡å¯åº”ç”¨æœåŠ¡å™¨æ— æ•ˆ</li><li>RedisæœåŠ¡å™¨å´©æºƒ</li><li>Redisé›†ç¾¤å´©æºƒ</li><li>é‡å¯æ•°æ®åº“åå†æ¬¡è¢«ç¬é—´æµé‡æ”¾å€’</li></ul><p><strong>é—®é¢˜æ’æŸ¥</strong></p><ul><li>åœ¨ä¸€ä¸ªè¾ƒçŸ­çš„æ—¶é—´å†…ï¼Œç¼“å­˜ä¸­è¾ƒå¤šçš„keyé›†ä¸­è¿‡æœŸ</li><li>æ­¤å‘¨æœŸå†…è¯·æ±‚è®¿é—®è¿‡æœŸçš„æ•°æ®ï¼Œredisæœªå‘½ä¸­ï¼Œrediså‘æ•°æ®åº“è·å–æ•°æ®</li><li>æ•°æ®åº“åŒæ—¶æ¥æ”¶åˆ°å¤§é‡çš„è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†</li><li>Rediså¤§é‡è¯·æ±‚è¢«ç§¯å‹ï¼Œå¼€å§‹å‡ºç°è¶…æ—¶ç°è±¡</li><li>æ•°æ®åº“æµé‡æ¿€å¢ï¼Œæ•°æ®åº“å´©æºƒ</li><li>é‡å¯åä»ç„¶é¢å¯¹ç¼“å­˜ä¸­æ— æ•°æ®å¯ç”¨</li><li>RedisæœåŠ¡å™¨èµ„æºè¢«ä¸¥é‡å ç”¨ï¼ŒRedisæœåŠ¡å™¨å´©æºƒ</li><li>Redisé›†ç¾¤å‘ˆç°å´©å¡Œï¼Œé›†ç¾¤ç“¦è§£</li><li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¾—åˆ°æ•°æ®å“åº”è¯·æ±‚ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨æœåŠ¡å™¨å´©æºƒ</li><li>åº”ç”¨æœåŠ¡å™¨ï¼Œredisï¼Œæ•°æ®åº“å…¨éƒ¨é‡å¯ï¼Œæ•ˆæœä¸ç†æƒ³</li></ul><p><strong>é—®é¢˜åˆ†æ</strong></p><ul><li>çŸ­æ—¶é—´èŒƒå›´å†…</li><li>å¤§é‡keyé›†ä¸­è¿‡æœŸ</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰</strong></p><ul><li>æ›´å¤šçš„é¡µé¢é™æ€åŒ–å¤„ç†</li><li>æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„<br>Nginxç¼“å­˜+redisç¼“å­˜+ehcacheç¼“å­˜</li><li>æ£€æµ‹Mysqlä¸¥é‡è€—æ—¶ä¸šåŠ¡è¿›è¡Œä¼˜åŒ–<br>å¯¹æ•°æ®åº“çš„ç“¶é¢ˆæ’æŸ¥ï¼šä¾‹å¦‚è¶…æ—¶æŸ¥è¯¢ã€è€—æ—¶è¾ƒé«˜äº‹åŠ¡ç­‰</li><li>ç¾éš¾é¢„è­¦æœºåˆ¶<br>ç›‘æ§redisæœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡<br>CPUå ç”¨ã€CPUä½¿ç”¨ç‡<br>å†…å­˜å®¹é‡<br>æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´<br>çº¿ç¨‹æ•°</li><li>é™æµã€é™çº§<br>çŸ­æ—¶é—´èŒƒå›´å†…ç‰ºç‰²ä¸€äº›å®¢æˆ·ä½“éªŒï¼Œé™åˆ¶ä¸€éƒ¨åˆ†è¯·æ±‚è®¿é—®ï¼Œé™ä½åº”ç”¨æœåŠ¡å™¨å‹åŠ›ï¼Œå¾…ä¸šåŠ¡ä½é€Ÿè¿è½¬åå†é€æ­¥æ”¾å¼€è®¿é—®</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</strong></p><ul><li>LRUä¸LFUåˆ‡æ¢</li><li>æ•°æ®æœ‰æ•ˆæœŸç­–ç•¥è°ƒæ•´<br>æ ¹æ®ä¸šåŠ¡æ•°æ®æœ‰æ•ˆæœŸè¿›è¡Œåˆ†ç±»é”™å³°ï¼ŒAç±»90åˆ†é’Ÿï¼ŒBç±»80åˆ†é’Ÿï¼ŒCç±»70åˆ†é’Ÿ<br>è¿‡æœŸæ—¶é—´ä½¿ç”¨å›ºå®šæ—¶é—´+éšæœºå€¼çš„å½¢å¼ï¼Œç¨€é‡Šé›†ä¸­åˆ°æœŸçš„keyçš„æ•°é‡</li><li>è¶…çƒ­æ•°æ®ä½¿ç”¨æ°¸ä¹…key</li><li>å®šæœŸç»´æŠ¤ï¼ˆè‡ªåŠ¨+äººå·¥ï¼‰<br>å¯¹å³å°†è¿‡æœŸæ•°æ®åšè®¿é—®é‡åˆ†æï¼Œç¡®è®¤æ˜¯å¦å»¶æ—¶ï¼Œé…åˆè®¿é—®é‡ç»Ÿè®¡ï¼Œåšçƒ­ç‚¹æ•°æ®çš„å»¶æ—¶</li><li>åŠ é”ï¼Œæ…ç”¨ï¼</li></ul><h1 id="14-Redis-ä¸»ä»å¤åˆ¶"><a href="#14-Redis-ä¸»ä»å¤åˆ¶" class="headerlink" title="14. Redis ä¸»ä»å¤åˆ¶"></a>14. Redis ä¸»ä»å¤åˆ¶</h1><h2 id="14-1-ä¸»ä»å¤åˆ¶"><a href="#14-1-ä¸»ä»å¤åˆ¶" class="headerlink" title="14.1 ä¸»ä»å¤åˆ¶"></a>14.1 ä¸»ä»å¤åˆ¶</h2><p>ä¸»ä»å¤åˆ¶æ¶æ„ä»…ä»…ç”¨æ¥è§£å†³æ•°æ®çš„å†—ä½™å¤‡ä»½,ä»èŠ‚ç‚¹ä»…ä»…ç”¨æ¥åŒæ­¥æ•°æ®</p><p><strong>æ— æ³•è§£å†³: 1.masterèŠ‚ç‚¹å‡ºç°æ•…éšœçš„è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></p><h2 id="14-2-ä¸»ä»å¤åˆ¶æ¶æ„å›¾"><a href="#14-2-ä¸»ä»å¤åˆ¶æ¶æ„å›¾" class="headerlink" title="14.2 ä¸»ä»å¤åˆ¶æ¶æ„å›¾"></a>14.2 ä¸»ä»å¤åˆ¶æ¶æ„å›¾</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627201722700.png" alt="image-20200627201722700"></p><h2 id="14-3-æ­å»ºä¸»ä»å¤åˆ¶"><a href="#14-3-æ­å»ºä¸»ä»å¤åˆ¶" class="headerlink" title="14.3 æ­å»ºä¸»ä»å¤åˆ¶"></a>14.3 æ­å»ºä¸»ä»å¤åˆ¶</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å‡†å¤‡3å°æœºå™¨å¹¶ä¿®æ”¹é…ç½®</span><span class="hljs-bullet">-</span> master<span class="hljs-code">port 6379</span><span class="hljs-code">bind 0.0.0.0</span><span class="hljs-code"></span><span class="hljs-code">- slave1</span><span class="hljs-code">port 6380</span><span class="hljs-code">bind 0.0.0.0</span><span class="hljs-code">slaveof masterçš„ip masterçš„port</span><span class="hljs-code"></span><span class="hljs-code">- slave2</span><span class="hljs-code">port 6381</span><span class="hljs-code">bind 0.0.0.0</span><span class="hljs-code">slaveof masterçš„ip masterçš„port</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627202443388.png" alt="image-20200627202443388"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 2.å¯åŠ¨3å°æœºå™¨è¿›è¡Œæµ‹è¯•</span><span class="hljs-bullet">-</span> cd /usr/redis/bin<span class="hljs-bullet">-</span> ./redis-server /root/master/redis.conf<span class="hljs-bullet">-</span> ./redis-server /root/slave1/redis.conf<span class="hljs-bullet">-</span> ./redis-server /root/slave2/redis.conf</code></pre></div><hr><h1 id="15-Rediså“¨å…µæœºåˆ¶"><a href="#15-Rediså“¨å…µæœºåˆ¶" class="headerlink" title="15. Rediså“¨å…µæœºåˆ¶"></a>15. Rediså“¨å…µæœºåˆ¶</h1><h2 id="15-1-å“¨å…µSentinelæœºåˆ¶"><a href="#15-1-å“¨å…µSentinelæœºåˆ¶" class="headerlink" title="15.1 å“¨å…µSentinelæœºåˆ¶"></a>15.1 å“¨å…µSentinelæœºåˆ¶</h2><p>Sentinelï¼ˆå“¨å…µï¼‰æ˜¯Redis çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªSentinel å®ä¾‹ ç»„æˆçš„Sentinel ç³»ç»Ÿå¯ä»¥ç›‘è§†ä»»æ„å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æŸä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ç®€å•çš„è¯´å“¨å…µå°±æ˜¯å¸¦æœ‰<strong>è‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½çš„ä¸»ä»æ¶æ„</strong>ã€‚</p><p><strong>æ— æ³•è§£å†³: 1.å•èŠ‚ç‚¹å¹¶å‘å‹åŠ›é—®é¢˜   2.å•èŠ‚ç‚¹å†…å­˜å’Œç£ç›˜ç‰©ç†ä¸Šé™</strong></p><h2 id="15-2-å“¨å…µæ¶æ„åŸç†"><a href="#15-2-å“¨å…µæ¶æ„åŸç†" class="headerlink" title="15.2 å“¨å…µæ¶æ„åŸç†"></a>15.2 å“¨å…µæ¶æ„åŸç†</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627204422750.png" alt="image-20200627204422750"></p><h2 id="15-3-æ­å»ºå“¨å…µæ¶æ„"><a href="#15-3-æ­å»ºå“¨å…µæ¶æ„" class="headerlink" title="15.3 æ­å»ºå“¨å…µæ¶æ„"></a>15.3 æ­å»ºå“¨å…µæ¶æ„</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.åœ¨ä¸»èŠ‚ç‚¹ä¸Šåˆ›å»ºå“¨å…µé…ç½®</span><span class="hljs-bullet">-</span> åœ¨Masterå¯¹åº”redis.confåŒç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»å¯¹ä¸èƒ½é”™ï¼›<span class="hljs-section"># 2.é…ç½®å“¨å…µï¼Œåœ¨sentinel.confæ–‡ä»¶ä¸­å¡«å…¥å†…å®¹ï¼š</span><span class="hljs-bullet">-</span>Â sentinel monitor å“¨å…µæ¶æ„çš„å‘½åï¼ˆè‡ªå·±èµ·åå­—ï¼‰ ip port 1(å¦‚æœmasterä¸å¯è¾¾ï¼Œé‚£ä¹ˆéœ€è¦å¤šå°‘ä¸ªå“¨å…µéƒ½ä¸å¯è¾¾ï¼Œæ‰èƒ½åˆ¤å®šçœŸæ­£çš„ä¸å¯è¾¾ï¼Œè¿™ä¸ªåé¢çš„æ•°å­—1,æ˜¯æŒ‡å½“æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„sentinelæœåŠ¡æ£€æµ‹åˆ°masterå®•æœºï¼Œæ‰ä¼šå»æ‰§è¡Œä¸»ä»åˆ‡æ¢çš„åŠŸèƒ½)</code></pre></div><p>å¯åŠ¨çš„æ—¶å€™è¦åˆ°æºç ç›®å½•</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513224116080.png" alt="image-20210513224116080"></p><p>æ‰¾åˆ°<code>redis-sentinel</code>ï¼Œå¤åˆ¶åˆ°<code>/usr/redis/bin</code></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513224142401.png" alt="image-20210513224142401"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.å¯åŠ¨å“¨å…µæ¨¡å¼è¿›è¡Œæµ‹è¯•</span><span class="hljs-bullet">-</span>Â ./redis-sentinel Â /usr/redis/sentinel.conf<span class="hljs-bullet">-</span> æˆ–è€…./redis-sentinel ../sentinel.conf</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513225408094.png" alt="image-20210513225408094"></p><h2 id="15-4-é€šè¿‡springbootæ“ä½œå“¨å…µ"><a href="#15-4-é€šè¿‡springbootæ“ä½œå“¨å…µ" class="headerlink" title="15.4 é€šè¿‡springbootæ“ä½œå“¨å…µ"></a>15.4 é€šè¿‡springbootæ“ä½œå“¨å…µ</h2><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># redis sentinel é…ç½®</span><span class="hljs-comment"># masterä¹¦å†™æ˜¯ä½¿ç”¨å“¨å…µç›‘å¬çš„é‚£ä¸ªåç§°</span><span class="hljs-meta">spring.redis.sentinel.master</span>=<span class="hljs-string">mymaster</span><span class="hljs-comment"># è¿æ¥çš„ä¸å†æ˜¯ä¸€ä¸ªå…·ä½“redisä¸»æœº,ä¹¦å†™çš„æ˜¯å¤šä¸ªå“¨å…µèŠ‚ç‚¹</span><span class="hljs-meta">spring.redis.sentinel.nodes</span>=<span class="hljs-string">192.168.202.206:26379</span></code></pre></div><ul><li><strong>æ³¨æ„:å¦‚æœè¿æ¥è¿‡ç¨‹ä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯:RedisConnectionException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command â€˜CONFIG SET protected-mode noâ€™ from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2)</strong></li><li><strong>è§£å†³æ–¹æ¡ˆ:åœ¨å“¨å…µçš„é…ç½®æ–‡ä»¶<code>sentinel.conf</code>ä¸­åŠ å…¥bind 0.0.0.0 å¼€å¯è¿œç¨‹è¿æ¥æƒé™</strong></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200629154647970.png" alt="image-20200629154647970"></p><h1 id="16-Redisé›†ç¾¤"><a href="#16-Redisé›†ç¾¤" class="headerlink" title="16. Redisé›†ç¾¤"></a>16. Redisé›†ç¾¤</h1><h2 id="16-1-é›†ç¾¤"><a href="#16-1-é›†ç¾¤" class="headerlink" title="16.1 é›†ç¾¤"></a>16.1 é›†ç¾¤</h2><p>Redisåœ¨3.0åå¼€å§‹æ”¯æŒCluster(æ¨¡å¼)æ¨¡å¼,ç›®å‰redisçš„é›†ç¾¤æ”¯æŒèŠ‚ç‚¹çš„è‡ªåŠ¨å‘ç°,æ”¯æŒslave-masteré€‰ä¸¾å’Œå®¹é”™,æ”¯æŒåœ¨çº¿åˆ†ç‰‡(sharding shard )ç­‰ç‰¹æ€§ã€‚</p><h2 id="16-2-é›†ç¾¤æ¶æ„å›¾"><a href="#16-2-é›†ç¾¤æ¶æ„å›¾" class="headerlink" title="16.2 é›†ç¾¤æ¶æ„å›¾"></a>16.2 é›†ç¾¤æ¶æ„å›¾</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/wpsgRnQP8.jpg" alt="img"></p><h2 id="16-3-é›†ç¾¤ç»†èŠ‚"><a href="#16-3-é›†ç¾¤ç»†èŠ‚" class="headerlink" title="16.3 é›†ç¾¤ç»†èŠ‚"></a>16.3 é›†ç¾¤ç»†èŠ‚</h2><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.<span class="hljs-bullet">-</span> èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ. <span class="hljs-bullet">-</span> å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯<span class="hljs-bullet">-</span> redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node&lt;-&gt;slot&lt;-&gt;value<span class="hljs-bullet">-</span> resharedï¼Œæ·»åŠ æ–°çš„ç‰©ç†èŠ‚ç‚¹ï¼Œéœ€è¦é‡æ–°åˆ†é…ï¼Œä»æ—§çš„ç‰©ç†èŠ‚ç‚¹æ‹¿å‡ºslotç»™æ–°ç‰©ç†èŠ‚ç‚¹</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200629165226329.png" alt="image-20200629165226329"></p><h2 id="16-4-é›†ç¾¤æ­å»º"><a href="#16-4-é›†ç¾¤æ­å»º" class="headerlink" title="16.4 é›†ç¾¤æ­å»º"></a>16.4 é›†ç¾¤æ­å»º</h2><p>åˆ¤æ–­ä¸€ä¸ªæ˜¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ˜¯å¦å¯ç”¨,æ˜¯é›†ç¾¤ä¸­çš„æ‰€ç”¨ä¸»èŠ‚ç‚¹é€‰ä¸¾è¿‡ç¨‹,å¦‚æœåŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹è®¤ä¸ºå½“å‰èŠ‚ç‚¹æŒ‚æ‰,é‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±æ˜¯æŒ‚æ‰äº†,æ‰€ä»¥æ­å»ºredisé›†ç¾¤æ—¶å»ºè®®èŠ‚ç‚¹æ•°æœ€å¥½ä¸ºå¥‡æ•°ï¼Œ<strong>æ­å»ºé›†ç¾¤è‡³å°‘éœ€è¦ä¸‰ä¸ªä¸»èŠ‚ç‚¹,ä¸‰ä¸ªä»èŠ‚ç‚¹,è‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹</strong>ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å‡†å¤‡ç¯å¢ƒå®‰è£…rubyä»¥åŠredisé›†ç¾¤ä¾èµ–</span><span class="hljs-bullet">-</span> yum install -y ruby rubygems<span class="hljs-section"># redis.gemä¸èƒ½é€šè¿‡yumå®‰è£…ï¼Œä¸Šä¼ ååˆ°ç›®å½•ä¸‹é€šè¿‡å‘½ä»¤å®‰è£…</span><span class="hljs-bullet">-</span> gem install redis-xxx.gem</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627193219366.png" alt="image-20200627193219366"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627193348905.png" alt="image-20200627193348905"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210514121617248.png" alt="image-20210514121617248"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 2.åœ¨ä¸€å°æœºå™¨åˆ›å»º7ä¸ªç›®å½•</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627193849867.png" alt="image-20200627193849867"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.æ¯ä¸ªç›®å½•å¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶</span>[root@localhost ~]# cp redis-4.0.10/redis.conf 7000/[root@localhost ~]# cp redis-4.0.10/redis.conf 7001/[root@localhost ~]# cp redis-4.0.10/redis.conf 7002/[root@localhost ~]# cp redis-4.0.10/redis.conf 7003/[root@localhost ~]# cp redis-4.0.10/redis.conf 7004/[root@localhost ~]# cp redis-4.0.10/redis.conf 7005/[root@localhost ~]# cp redis-4.0.10/redis.conf 7006/</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627194103354.png" alt="image-20200627194103354"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 4.ä¿®æ”¹ä¸åŒç›®å½•é…ç½®æ–‡ä»¶</span><span class="hljs-bullet">-</span> port 6379 .....                 //ä¿®æ”¹ç«¯å£<span class="hljs-bullet">-</span> bind  0.0.0.0                    //å¼€å¯è¿œç¨‹è¿æ¥<span class="hljs-bullet">-</span> cluster-enabledÂ  yes          //å¼€å¯é›†ç¾¤æ¨¡å¼<span class="hljs-bullet">-</span> daemonize yes //å¼€å¯å®ˆæŠ¤çº¿ç¨‹å¯åŠ¨<span class="hljs-bullet">-</span> dbfilename dump-port.rdb.  //ä¿®æ”¹rdbå‘½å<span class="hljs-bullet">-</span> cluster-config-fileÂ  nodes-port.conf //é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶<span class="hljs-bullet">-</span> cluster-node-timeoutÂ  5000         //é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ—¶é—´<span class="hljs-bullet">-</span> appendonlyÂ  yes                  //å¿…é¡»å¼€å¯AOFæŒä¹…åŒ–<span class="hljs-section"># 5.æŒ‡å®šä¸åŒç›®å½•é…ç½®æ–‡ä»¶å¯åŠ¨ä¸ƒä¸ªèŠ‚ç‚¹</span><span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7000/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7001/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7002/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7003/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7004/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7005/redis.conf<span class="hljs-bullet">-</span> [root@localhost bin]# ./redis-server  /root/7006/redis.conf</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627194913866.png" alt="image-20200627194913866"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 6.æŸ¥çœ‹è¿›ç¨‹</span><span class="hljs-bullet">-</span> [root@localhost bin]# ps aux|grep redis</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627194954143.png" alt="image-20200627194954143"></p><h4 id="1-åˆ›å»ºé›†ç¾¤"><a href="#1-åˆ›å»ºé›†ç¾¤" class="headerlink" title="1.åˆ›å»ºé›†ç¾¤"></a>1.åˆ›å»ºé›†ç¾¤</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å¤åˆ¶é›†ç¾¤æ“ä½œè„šæœ¬åˆ°binç›®å½•ä¸­</span><span class="hljs-bullet">-</span> [root@localhost src]# cp redis-trib.rb /usr/redis/bin/<span class="hljs-section"># 2.åˆ›å»ºé›†ç¾¤</span><span class="hljs-bullet">-</span> ./redis-trib.rb create --replicas 1 <span class="hljs-code">`å‰ä¸‰ä¸ªä½œä¸ºç‰©ç†èŠ‚ç‚¹`</span>192.168.202.205:7000 192.168.202.205:7001 192.168.202.205:7002 192.168.202.205:7003 192.168.202.205:7004 192.168.202.205:7005</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627195601307.png" alt="image-20200627195601307"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.é›†ç¾¤åˆ›å»ºæˆåŠŸå‡ºç°å¦‚ä¸‹æç¤º</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200627195647767.png" alt="image-20200627195647767"></p><h4 id="2-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#2-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="2.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>2.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ check [åŸå§‹é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [æ— ]</span><span class="hljs-bullet">-</span> ./redis-trib.rb check 192.168.202.205:7000<span class="hljs-section"># 2.é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€è¯´æ˜</span><span class="hljs-bullet">-</span> ä¸»èŠ‚ç‚¹ <span class="hljs-code">ä¸»èŠ‚ç‚¹å­˜åœ¨hash slots,ä¸”ä¸»èŠ‚ç‚¹çš„hash slots æ²¡æœ‰äº¤å‰</span><span class="hljs-code">ä¸»èŠ‚ç‚¹ä¸èƒ½åˆ é™¤</span><span class="hljs-code">ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹</span><span class="hljs-code">ä¸»èŠ‚ç‚¹å®•æœºæ—¶å¤šä¸ªå‰¯æœ¬ä¹‹é—´è‡ªåŠ¨é€‰ä¸¾ä¸»èŠ‚ç‚¹</span><span class="hljs-code"></span><span class="hljs-code">- ä»èŠ‚ç‚¹</span><span class="hljs-code">ä»èŠ‚ç‚¹æ²¡æœ‰hash slots</span><span class="hljs-code">ä»èŠ‚ç‚¹å¯ä»¥åˆ é™¤</span><span class="hljs-code">ä»èŠ‚ç‚¹ä¸è´Ÿè´£æ•°æ®çš„å†™,åªè´Ÿè´£æ•°æ®çš„åŒæ­¥</span></code></pre></div><h4 id="3-æ·»åŠ ä¸»èŠ‚ç‚¹"><a href="#3-æ·»åŠ ä¸»èŠ‚ç‚¹" class="headerlink" title="3.æ·»åŠ ä¸»èŠ‚ç‚¹"></a>3.æ·»åŠ ä¸»èŠ‚ç‚¹</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æ·»åŠ ä¸»èŠ‚ç‚¹ add-node [æ–°åŠ å…¥èŠ‚ç‚¹] [åŸå§‹é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹]</span><span class="hljs-bullet">-</span> ./redis-trib.rb  add-node 192.168.1.158:7006  192.168.1.158:7005<span class="hljs-bullet">-</span> æ³¨æ„:<span class="hljs-code">1.è¯¥èŠ‚ç‚¹å¿…é¡»ä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨</span><span class="hljs-code">2.é»˜è®¤æƒ…å†µä¸‹è¯¥èŠ‚ç‚¹å°±æ˜¯ä»¥masterèŠ‚ç‚¹å½¢å¼æ·»åŠ </span></code></pre></div><h4 id="4-æ·»åŠ ä»èŠ‚ç‚¹"><a href="#4-æ·»åŠ ä»èŠ‚ç‚¹" class="headerlink" title="4.æ·»åŠ ä»èŠ‚ç‚¹"></a>4.æ·»åŠ ä»èŠ‚ç‚¹</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æ·»åŠ ä»èŠ‚ç‚¹ add-node --slave [æ–°åŠ å…¥èŠ‚ç‚¹] [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹]</span><span class="hljs-bullet">-</span> ./redis-trib.rb  add-node --slave 192.168.1.158:7006 192.168.1.158:7000<span class="hljs-bullet">-</span> æ³¨æ„:<span class="hljs-code">å½“æ·»åŠ å‰¯æœ¬èŠ‚ç‚¹æ—¶æ²¡æœ‰æŒ‡å®šä¸»èŠ‚ç‚¹,redisä¼šéšæœºç»™å‰¯æœ¬èŠ‚ç‚¹è¾ƒå°‘çš„ä¸»èŠ‚ç‚¹æ·»åŠ å½“å‰å‰¯æœ¬èŠ‚ç‚¹</span><span class="hljs-code"></span><span class="hljs-code"># 2.ä¸ºç¡®å®šçš„masterèŠ‚ç‚¹æ·»åŠ ä¸»èŠ‚ç‚¹ add-node --slave --master-id masterèŠ‚ç‚¹id [æ–°åŠ å…¥èŠ‚ç‚¹] [é›†ç¾¤ä»»æ„èŠ‚ç‚¹]</span><span class="hljs-code">- ./redis-trib.rb  add-node --slave --master-id 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 127.0.0.1:7006  127.0.0.1:7000</span></code></pre></div><h4 id="5-åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹"><a href="#5-åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹" class="headerlink" title="5.åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹"></a>5.åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.åˆ é™¤èŠ‚ç‚¹ del-node [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [åˆ é™¤èŠ‚ç‚¹id]</span><span class="hljs-bullet">-</span> ./redis-trib.rb  del-node 127.0.0.1:7002 0ca3f102ecf0c888fc7a7ce43a13e9be9f6d3dd1<span class="hljs-bullet">-</span> æ³¨æ„: 1.è¢«åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»æ˜¯ä»èŠ‚ç‚¹æˆ–æ²¡æœ‰è¢«åˆ†é…hash slotsçš„èŠ‚ç‚¹</code></pre></div><h4 id="6-é›†ç¾¤åœ¨çº¿åˆ†ç‰‡"><a href="#6-é›†ç¾¤åœ¨çº¿åˆ†ç‰‡" class="headerlink" title="6.é›†ç¾¤åœ¨çº¿åˆ†ç‰‡"></a>6.é›†ç¾¤åœ¨çº¿åˆ†ç‰‡</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.åœ¨çº¿åˆ†ç‰‡ reshard [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [æ— ]</span><span class="hljs-bullet">-</span> ./redis-trib.rb  reshard  192.168.1.158:7000</code></pre></div><h4 id="7-æ“ä½œé›†ç¾¤"><a href="#7-æ“ä½œé›†ç¾¤" class="headerlink" title="7.æ“ä½œé›†ç¾¤"></a>7.æ“ä½œé›†ç¾¤</h4><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ç»ˆç«¯æ“ä½œ</span><span class="hljs-bullet">-</span> ./redis-cli -p port -c <span class="hljs-code">`åŠ å…¥-cæ“ä½œé›†ç¾¤`</span><span class="hljs-section"># 2.Springbootæ“ä½œ</span><span class="hljs-bullet">-</span> spring.redis.cluster.nodes=192.168.1.158:7000,192.168.1.158:7001,192.168.1.158:7002...å†™ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œä¿è¯å®•æœºæ—¶è¿˜æœ‰å¤‡ç”¨</code></pre></div><h1 id="17-Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†"><a href="#17-Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†" class="headerlink" title="17.Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†"></a>17.Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†</h1><h2 id="17-1-ç®¡ç†æœºåˆ¶"><a href="#17-1-ç®¡ç†æœºåˆ¶" class="headerlink" title="17.1 ç®¡ç†æœºåˆ¶"></a>17.1 ç®¡ç†æœºåˆ¶</h2><p><strong>Memcached Session Manager</strong>ä¸<strong>Redis</strong>çš„Sessionç®¡ç†å¯¹æ¯”</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/7.Redis%E7%9A%84session%E7%AE%A1%E7%90%86%E5%92%8CMemcached%E7%9A%84session%E7%AE%A1%E7%90%86%E4%B8%8D%E5%90%8C.jpg" alt="7.Redisçš„sessionç®¡ç†å’ŒMemcachedçš„sessionç®¡ç†ä¸åŒ"></p><p><strong>redisçš„sessionç®¡ç†æ˜¯åˆ©ç”¨springæä¾›çš„sessionç®¡ç†è§£å†³æ–¹æ¡ˆ,å°†ä¸€ä¸ªåº”ç”¨sessionäº¤ç»™Rediså­˜å‚¨,æ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰sessionçš„è¯·æ±‚éƒ½ä¼šå»redisä¸­è·å–å¯¹åº”çš„sessionæ•°æ®</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200628201643358.png" alt="image-20200628201643358"></p><h2 id="17-2-å¼€å‘Sessionç®¡ç†"><a href="#17-2-å¼€å‘Sessionç®¡ç†" class="headerlink" title="17.2 å¼€å‘Sessionç®¡ç†"></a>17.2 å¼€å‘Sessionç®¡ç†</h2><h4 id="1-å¼•å…¥ä¾èµ–-2"><a href="#1-å¼•å…¥ä¾èµ–-2" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h4><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h4 id="2-å¼€å‘Sessionç®¡ç†é…ç½®ç±»"><a href="#2-å¼€å‘Sessionç®¡ç†é…ç½®ç±»" class="headerlink" title="2. å¼€å‘Sessionç®¡ç†é…ç½®ç±»"></a>2. å¼€å‘Sessionç®¡ç†é…ç½®ç±»</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableRedisHttpSession</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisSessionManager</span> </span>&#123;   &#125;</code></pre></div><h4 id="3-TestController"><a href="#3-TestController" class="headerlink" title="3. TestController"></a>3. TestController</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(&quot;test&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123;    <span class="hljs-comment">// redis  session   list    1</span>    <span class="hljs-comment">// jvm  list åœ°å€    list.add   list.size  2</span>    <span class="hljs-comment">//ä½¿ç”¨redis çš„sessionç®¡ç†  </span>  <span class="hljs-comment">//æ³¨æ„:å½“sessionä¸­æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶å¿…é¡»å°†sessionä¸­å˜åŒ–çš„æ•°æ®åŒæ­¥åˆ°redisä¸­</span>  <span class="hljs-comment">//addæ–¹æ³•æ˜¯åŠ å…¥jvmä¸­ï¼Œjvmå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯rediså¹¶æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åŒæ­¥</span>    <span class="hljs-meta">@RequestMapping(&quot;test&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;              List&lt;String&gt; list = (List&lt;String&gt;) request.getSession().getAttribute(<span class="hljs-string">&quot;list&quot;</span>);        <span class="hljs-keyword">if</span>(list==<span class="hljs-keyword">null</span>)&#123;            list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        &#125;        list.add(<span class="hljs-string">&quot;xxxx&quot;</span>);        <span class="hljs-comment">//æ¯æ¬¡sessionå˜åŒ–éƒ½è¦åŒæ­¥session</span>        request.getSession().setAttribute(<span class="hljs-string">&quot;list&quot;</span>,list);        response.getWriter().println(<span class="hljs-string">&quot;size: &quot;</span>+list.size());        response.getWriter().println(<span class="hljs-string">&quot;sessionid: &quot;</span>+request.getSession().getId());    &#125;      <span class="hljs-meta">@RequestMapping(&quot;logout&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">logout</span><span class="hljs-params">(HttpServletRequest request)</span></span>&#123;        <span class="hljs-comment">//é€€å‡ºç™»å½•</span>        request.getSession().invalidate();<span class="hljs-comment">//å¤±æ•ˆ</span>    &#125;</code></pre></div><h4 id="4-å…¥å£ç±»"><a href="#4-å…¥å£ç±»" class="headerlink" title="4. å…¥å£ç±»"></a>4. å…¥å£ç±»</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisSessionManagerApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBootServletInitializer</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(RedisSessionManagerApplication.class, args);    &#125;      <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> SpringApplicationBuilder <span class="hljs-title">configure</span><span class="hljs-params">(SpringApplicationBuilder builder)</span> </span>&#123;        <span class="hljs-keyword">return</span> builder.sources(RedisSessionManagerApplication.class);    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL</title>
    <link href="/2021/07/26/MySQL/"/>
    <url>/2021/07/26/MySQL/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><ul><li>DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€<br>select </li><li>DML(Data Manipulate Language):æ•°æ®æ“ä½œè¯­è¨€<br>insert ã€updateã€delete</li><li>DDLï¼ˆData Define Langugeï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€<br>createã€dropã€alter</li><li>TCLï¼ˆTransaction Control Languageï¼‰ï¼šäº‹åŠ¡æ§åˆ¶è¯­è¨€<br>commitã€rollback</li></ul><h1 id="ä¸€ã€åŸºæœ¬çŸ¥è¯†"><a href="#ä¸€ã€åŸºæœ¬çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºæœ¬çŸ¥è¯†"></a>ä¸€ã€åŸºæœ¬çŸ¥è¯†</h1><h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><h4 id="å¯¹åº“çš„æ“ä½œ"><a href="#å¯¹åº“çš„æ“ä½œ" class="headerlink" title="å¯¹åº“çš„æ“ä½œ"></a>å¯¹åº“çš„æ“ä½œ</h4><p><strong>åˆ›å»ºæ•°æ®åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> book;</code></pre></div><p><strong>ä¿®æ”¹æ•°æ®åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#ä¿®æ”¹å­—ç¬¦é›†<span class="hljs-keyword">ALTER</span> DATABASE books <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> gbk;</code></pre></div><p><strong>å±•ç¤ºæ•°æ®åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> DATABASES;</code></pre></div><p><strong>åˆ é™¤æŒ‡å®šæ•°æ®åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> database_xx;</code></pre></div><p><strong>ä½¿ç”¨æŒ‡å®šæ•°æ®åº“</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">USE database_xx;</code></pre></div><h4 id="å¯¹è¡¨çš„æ“ä½œ"><a href="#å¯¹è¡¨çš„æ“ä½œ" class="headerlink" title="å¯¹è¡¨çš„æ“ä½œ"></a>å¯¹è¡¨çš„æ“ä½œ</h4><p><strong>åˆ›å»ºè¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(    s_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">PRIMARY</span> KEY COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿå­¦å·&#x27;</span>,    s_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿå§“å ä¸èƒ½ä¸ºç©º&#x27;</span>,    s_sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿæ€§åˆ«&#x27;</span>,    s_birthday DATETIME COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿç”Ÿæ—¥&#x27;</span>,    s_class <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿæ‰€åœ¨çš„ç­çº§&#x27;</span>);</code></pre></div><p><strong>å±•ç¤ºè¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DESCRIBE</span> table_xx;<span class="hljs-keyword">DESC</span> table_xx;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200807154719.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200807154719.png" alt="img"></a></p><p><strong>ä¿®æ”¹è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span><span class="hljs-operator">|</span><span class="hljs-keyword">drop</span><span class="hljs-operator">|</span>modify<span class="hljs-operator">|</span>change <span class="hljs-keyword">column</span> åˆ—å ã€åˆ—ç±»å‹ çº¦æŸã€‘;#â‘ ä¿®æ”¹åˆ—å<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book CHANGE <span class="hljs-keyword">COLUMN</span> publishdate pubDate DATETIME;#â‘¡ä¿®æ”¹åˆ—çš„ç±»å‹æˆ–çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book MODIFY <span class="hljs-keyword">COLUMN</span> pubdate <span class="hljs-type">TIMESTAMP</span>;#â‘¢æ·»åŠ æ–°åˆ—<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> author <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> annual <span class="hljs-keyword">DOUBLE</span>; #â‘£åˆ é™¤åˆ—<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book_author <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span>  annual;#â‘¤ä¿®æ”¹è¡¨å<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> author RENAME <span class="hljs-keyword">TO</span> book_author;</code></pre></div><p><strong>åˆ é™¤è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> æ—§è¡¨å;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  è¡¨å();</code></pre></div><p><strong>å¤åˆ¶è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1.</span>ä»…ä»…å¤åˆ¶è¡¨çš„ç»“æ„<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">copy</span> <span class="hljs-keyword">LIKE</span> author;#<span class="hljs-number">2.</span>å¤åˆ¶è¡¨çš„ç»“æ„<span class="hljs-operator">+</span>æ•°æ®<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> copy2 <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> author;#åªå¤åˆ¶éƒ¨åˆ†æ•°æ®<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> copy3<span class="hljs-keyword">SELECT</span> id,au_name<span class="hljs-keyword">FROM</span> author <span class="hljs-keyword">WHERE</span> nation<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ä¸­å›½&#x27;</span>;#ä»…ä»…å¤åˆ¶æŸäº›å­—æ®µ<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> copy4 <span class="hljs-keyword">SELECT</span> id,au_name<span class="hljs-keyword">FROM</span> author<span class="hljs-keyword">WHERE</span> <span class="hljs-number">0</span>;</code></pre></div><p><strong>æŸ¥çœ‹ç‰ˆæœ¬</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> version();</code></pre></div><h2 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h2><h4 id="åŸºç¡€æŸ¥è¯¢"><a href="#åŸºç¡€æŸ¥è¯¢" class="headerlink" title="åŸºç¡€æŸ¥è¯¢"></a>åŸºç¡€æŸ¥è¯¢</h4><div class="hljs code-wrapper"><pre><code class="hljs sql">#ä»è¡¨ä¸­æŸ¥è¯¢æ‰€æœ‰<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name; #ä»è¡¨ä¸­æŒ‡å®šæŸ¥è¯¢<span class="hljs-keyword">SELECT</span> `last_name`, `first_name` <span class="hljs-keyword">FROM</span> table_name;#èµ·åˆ«å<span class="hljs-keyword">SELECT</span> last_name <span class="hljs-keyword">AS</span> &quot;åˆ«å1&quot;,       first_name <span class="hljs-keyword">AS</span> &quot;åˆ«å2&quot;<span class="hljs-keyword">FROM</span> employees;#æˆ–è€…ç”¨ç©ºæ ¼<span class="hljs-keyword">SELECT</span> last_name åˆ«å<span class="hljs-number">1</span>,       first_name åˆ«å<span class="hljs-number">2</span><span class="hljs-keyword">FROM</span> employees;#å»é‡<span class="hljs-keyword">DISTINCT</span>æŸ¥è¯¢<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id <span class="hljs-keyword">FROM</span> employees;#æ‹¼æ¥<span class="hljs-keyword">SELECT</span> CONCAT(first_name,last_name ) oo<span class="hljs-keyword">FROM</span> employees;#å¦‚æœä¸º<span class="hljs-keyword">NULL</span>ï¼Œè¿”å›<span class="hljs-number">0</span>æˆ–è€…æŒ‡å®šçš„æ•°å­—<span class="hljs-keyword">SELECT</span> IFNULL(last_name,<span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> xx <span class="hljs-keyword">FROM</span> employees;#å­—æ¯å­—ç¬¦ç»Ÿä¸€è½¬ä¸º<span class="hljs-number">0</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> <span class="hljs-operator">=</span> â€˜aâ€™; <span class="hljs-comment">---1</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> <span class="hljs-operator">=</span> â€˜abcâ€™; <span class="hljs-comment">---1</span>#æ•°å­—å­—ç¬¦ç»Ÿä¸€è½¬ä¸ºæ•°å­—<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> â€˜<span class="hljs-number">1</span>â€™; <span class="hljs-comment">---1</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-operator">=</span> â€˜<span class="hljs-number">2</span>â€™; <span class="hljs-comment">---1</span></code></pre></div><h4 id="è¿›é˜¶æŸ¥è¯¢"><a href="#è¿›é˜¶æŸ¥è¯¢" class="headerlink" title="è¿›é˜¶æŸ¥è¯¢"></a><strong>è¿›é˜¶æŸ¥è¯¢</strong></h4><blockquote><p>select<br>        è¦æŸ¥è¯¢çš„å­—æ®µ|è¡¨è¾¾å¼|å¸¸é‡å€¼|å‡½æ•°<br>from<br>        è¡¨<br>where<br>        æ¡ä»¶ ;</p></blockquote><p>åˆ†ç±»ï¼š</p><ul><li><p>æ¡ä»¶è¡¨è¾¾å¼</p><ul><li><code>&gt;</code>   <code> &lt;</code>   <code>=</code>    <code>&lt;=</code>   <code>&lt;&gt;æ˜¯ä¸ç­‰äº</code></li><li>å®‰å…¨ç­‰äº<code>&lt;=&gt;</code>æ—¢å¯ä»¥åˆ¤æ–­NULLï¼Œåˆå¯ä»¥åˆ¤æ–­æ™®é€šå€¼</li></ul></li><li><p>é€»è¾‘è¡¨è¾¾å¼<br>ç¤ºä¾‹ï¼š<code>salary&gt;10000 &amp;&amp; salary&lt;20000</code></p><p>  ANDï¼ˆ&amp;&amp;ï¼‰:ä¸¤ä¸ªæ¡ä»¶å¦‚æœåŒæ—¶æˆç«‹ï¼Œç»“æœä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse<br>  OR(||)ï¼šä¸¤ä¸ªæ¡ä»¶åªè¦æœ‰ä¸€ä¸ªæˆç«‹ï¼Œç»“æœä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse<br>  NOT(!)ï¼šå¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™notåä¸ºfalseï¼Œå¦åˆ™ä¸ºtrue<br>  IS NULLï¼šä¸èƒ½ç”¨ xx=NULL</p></li><li><p>æ¨¡ç³ŠæŸ¥è¯¢</p><ul><li>%ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œå¦‚åŒ…å«açš„ä¿¡æ¯ï¼š<code>last_name LIKE &#39;%a%&#39;</code></li><li>_ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œå¦‚ç¬¬ä¸‰ä¸ªeï¼Œç¬¬äº”ä¸ªä¸ºaï¼š <code>last_name LIKE &#39;___e_a%&#39;</code></li><li>åœ¨100-200ä¹‹é—´ï¼ŒåŒ…å«ï¼š<code>BETWEEN 100 AND 200 </code></li><li>åœ¨åŒ…å«æŸäº›æ¡ä»¶çš„ä¿¡æ¯ï¼š<code>last_name IN (&#39;Lucifer&#39; , &#39;Melrose&#39; , &#39;Xiaowei&#39;)</code>ç­‰ä»·äº<code>last_name = lucifer OR last_name = melrose OR ....</code></li></ul></li></ul><h4 id="æ’åºæŸ¥è¯¢"><a href="#æ’åºæŸ¥è¯¢" class="headerlink" title="æ’åºæŸ¥è¯¢"></a><strong>æ’åºæŸ¥è¯¢</strong></h4><blockquote><p>select<br>   è¦æŸ¥è¯¢çš„ä¸œè¥¿<br>from<br>   è¡¨<br>where<br>   æ¡ä»¶</p><p>order by æ’åºçš„å­—æ®µ|è¡¨è¾¾å¼|å‡½æ•°|åˆ«å ã€asc|descã€‘</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql">#é™åº<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;#å‡åº<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">ASC</span>;</code></pre></div><h4 id="å¸¸è§å‡½æ•°âœ¨"><a href="#å¸¸è§å‡½æ•°âœ¨" class="headerlink" title="å¸¸è§å‡½æ•°âœ¨"></a>å¸¸è§å‡½æ•°âœ¨</h4><blockquote><p>SELECT å‡½æ•°å(å®å‚åˆ—è¡¨) FROM è¡¨</p></blockquote><p><strong>å•è¡Œå‡½æ•°</strong></p><ol><li>å­—ç¬¦å‡½æ•°<ul><li>concatæ‹¼æ¥</li><li>substræˆªå–å­ä¸²(MySQLä¸­ç´¢å¼•ä»1å¼€å§‹)</li><li>upperè½¬æ¢æˆå¤§å†™</li><li>lowerè½¬æ¢æˆå°å†™</li><li>trimå»å‰åæŒ‡å®šçš„ç©ºæ ¼å’Œå­—ç¬¦</li><li>ltrimå»å·¦è¾¹ç©ºæ ¼</li><li>rtrimå»å³è¾¹ç©ºæ ¼</li><li>replaceæ›¿æ¢</li><li>lpadå·¦å¡«å……</li><li>rpadå³å¡«å……</li><li>instrè¿”å›å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•</li><li>length è·å–å­—èŠ‚ä¸ªæ•°</li></ul></li><li>æ•°å­¦å‡½æ•°<ul><li>round å››èˆäº”å…¥</li><li>rand éšæœºæ•°</li><li>floorå‘ä¸‹å–æ•´</li><li>ceilå‘ä¸Šå–æ•´</li><li>modå–ä½™</li><li>truncateæˆªæ–­</li></ul></li><li>æ—¥æœŸå‡½æ•°<ul><li>nowå½“å‰ç³»ç»Ÿæ—¥æœŸ+æ—¶é—´</li><li>curdateå½“å‰ç³»ç»Ÿæ—¥æœŸ</li><li>curtimeå½“å‰ç³»ç»Ÿæ—¶é—´</li><li>str_to_date å°†å­—ç¬¦è½¬æ¢æˆæ—¥æœŸ</li><li>date_formatå°†æ—¥æœŸè½¬æ¢æˆå­—ç¬¦</li><li>datediefä¸¤ä¸ªæ—¥æœŸç›¸éš”çš„å¤©æ•°</li></ul></li><li>æµç¨‹æ§åˆ¶å‡½æ•°<ul><li>if å¤„ç†åŒåˆ†æ”¯</li><li>caseè¯­å¥ å¤„ç†å¤šåˆ†æ”¯<ul><li>æƒ…å†µ1ï¼šå¤„ç†ç­‰å€¼åˆ¤æ–­</li><li>æƒ…å†µ2ï¼šå¤„ç†æ¡ä»¶åˆ¤æ–­</li></ul></li></ul></li><li>å…¶ä»–å‡½æ•°<ul><li>versionç‰ˆæœ¬</li><li>databaseå½“å‰åº“</li><li>userå½“å‰è¿æ¥ç”¨æˆ·</li></ul></li></ol><p><strong>åˆ†ç»„å‡½æ•°</strong></p><ul><li><p>sum æ±‚å’Œ</p></li><li><p>max æœ€å¤§å€¼</p></li><li><p>min æœ€å°å€¼</p></li><li><p>avg å¹³å‡å€¼</p></li><li><p>count è®¡æ•°</p><blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä»¥ä¸Šäº”ä¸ªåˆ†ç»„å‡½æ•°éƒ½å¿½ç•¥nullå€¼ï¼Œé™¤äº†count(<em>)</em></li><li><em>sumå’Œavgä¸€èˆ¬ç”¨äºå¤„ç†æ•°å€¼å‹</em></li><li><em>maxã€minã€countå¯ä»¥å¤„ç†ä»»ä½•æ•°æ®ç±»å‹</em></li><li><em>éƒ½å¯ä»¥æ­é…distinctä½¿ç”¨ï¼Œç”¨äºç»Ÿè®¡å»é‡åçš„ç»“æœ</em></li><li><em>countçš„å‚æ•°å¯ä»¥æ”¯æŒï¼šå­—æ®µã€</em>å¸¸é‡å€¼ï¼Œä¸€èˆ¬æ”¾1ï¼Œå»ºè®®ä½¿ç”¨ count(*)ï¼Œæ•ˆæœéƒ½ä¸€æ ·</li></ul></blockquote></li></ul><h4 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a><strong>åˆ†ç»„æŸ¥è¯¢</strong></h4><blockquote><p>select<br>        æŸ¥è¯¢çš„å­—æ®µï¼Œåˆ†ç»„å‡½æ•°<br>from<br>        è¡¨</p><p>where ç­›é€‰æ¡ä»¶</p><p>group by<br>        åˆ†ç»„çš„å­—æ®µ</p><p>order by å­å¥</p></blockquote><p>1ã€å¯ä»¥æŒ‰å•ä¸ªå­—æ®µåˆ†ç»„<br>2ã€å’Œåˆ†ç»„å‡½æ•°ä¸€åŒæŸ¥è¯¢çš„å­—æ®µæœ€å¥½æ˜¯åˆ†ç»„åçš„å­—æ®µ<br>3ã€åˆ†ç»„ç­›é€‰</p><blockquote><p>â€‹        é’ˆå¯¹çš„è¡¨    ä½ç½®            å…³é”®å­—<br>åˆ†ç»„å‰ç­›é€‰ï¼š    åŸå§‹è¡¨        group byçš„å‰é¢        where<br>åˆ†ç»„åç­›é€‰ï¼š    åˆ†ç»„åçš„ç»“æœé›†    group byçš„åé¢        having</p></blockquote><p>4ã€å¯ä»¥æŒ‰å¤šä¸ªå­—æ®µåˆ†ç»„ï¼Œå­—æ®µä¹‹é—´ç”¨é€—å·éš”å¼€<br>5ã€å¯ä»¥æ”¯æŒæ’åº<br>6ã€havingåå¯ä»¥æ”¯æŒåˆ«å</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æŸ¥è¯¢é‚®ç®±ä¸­åŒ…å«aå­—ç¬¦ï¼Œæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> email <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id#æŸ¥è¯¢é‚£ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>#é¦–å…ˆæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id;#ç„¶åæ ¹æ®ç»“æœç­›é€‰ï¼ŒæŸ¥è¯¢é‚£ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>;#æ¯ä¸ªå·¥ç§æœ‰å¥–é‡‘çš„å‘˜å·¥çš„æœ€é«˜å·¥èµ„<span class="hljs-operator">&gt;</span><span class="hljs-number">12000</span>çš„å·¥ç§ç¼–å·å’Œæœ€é«˜å·¥èµ„<span class="hljs-keyword">SELECT</span> job_id,<span class="hljs-built_in">MAX</span>(salary)<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> commission_pct <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MAX</span>(salary)<span class="hljs-operator">&gt;</span><span class="hljs-number">12000</span>;</code></pre></div><h4 id="å¤šè¡¨è¿æ¥æŸ¥è¯¢"><a href="#å¤šè¡¨è¿æ¥æŸ¥è¯¢" class="headerlink" title="å¤šè¡¨è¿æ¥æŸ¥è¯¢"></a>å¤šè¡¨è¿æ¥æŸ¥è¯¢</h4><p>ç¬›å¡å°”ä¹˜ç§¯ï¼šå¦‚æœè¿æ¥æ¡ä»¶çœç•¥æˆ–æ— æ•ˆåˆ™ä¼šå‡ºç°<br>è§£å†³åŠæ³•ï¼šæ·»åŠ ä¸Šè¿æ¥æ¡ä»¶</p><p><strong>ä¸€ã€ä¼ ç»Ÿæ¨¡å¼ä¸‹çš„è¿æ¥ ï¼šç­‰å€¼è¿æ¥â€”â€”éç­‰å€¼è¿æ¥</strong></p><ul><li>ç­‰å€¼è¿æ¥çš„ç»“æœ = å¤šä¸ªè¡¨çš„äº¤é›†</li><li>nè¡¨è¿æ¥ï¼Œè‡³å°‘éœ€è¦n-1ä¸ªè¿æ¥æ¡ä»¶</li><li>å¤šä¸ªè¡¨ä¸åˆ†ä¸»æ¬¡ï¼Œæ²¡æœ‰é¡ºåºè¦æ±‚</li><li>ä¸€èˆ¬ä¸ºè¡¨èµ·åˆ«åï¼Œæé«˜é˜…è¯»æ€§å’Œæ€§èƒ½</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1.</span>æ˜¾ç¤ºæ‰€æœ‰å‘˜å·¥çš„å§“åï¼Œéƒ¨é—¨å·å’Œéƒ¨é—¨åç§°ã€‚USE myemployees;<span class="hljs-keyword">SELECT</span> last_name,d.department_id,department_name<span class="hljs-keyword">FROM</span> employees e,departments d<span class="hljs-keyword">WHERE</span> e.`department_id` <span class="hljs-operator">=</span> d.`department_id`;#<span class="hljs-number">2.</span>æŸ¥è¯¢<span class="hljs-number">90</span>å·éƒ¨é—¨å‘˜å·¥çš„job_idå’Œ<span class="hljs-number">90</span>å·éƒ¨é—¨çš„location_id<span class="hljs-keyword">SELECT</span> job_id,location_id<span class="hljs-keyword">FROM</span> employees e,departments d<span class="hljs-keyword">WHERE</span> e.`department_id`<span class="hljs-operator">=</span>d.`department_id`<span class="hljs-keyword">AND</span> e.`department_id`<span class="hljs-operator">=</span><span class="hljs-number">90</span>;#<span class="hljs-number">3.</span>é€‰æ‹©æ‰€æœ‰æœ‰å¥–é‡‘çš„å‘˜å·¥çš„last_name , department_name , location_id , city<span class="hljs-keyword">SELECT</span> last_name , department_name , l.location_id , city<span class="hljs-keyword">FROM</span> employees e,departments d,locations l<span class="hljs-keyword">WHERE</span> e.department_id <span class="hljs-operator">=</span> d.department_id<span class="hljs-keyword">AND</span> d.location_id<span class="hljs-operator">=</span>l.location_id<span class="hljs-keyword">AND</span> e.commission_pct <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;#<span class="hljs-number">4.</span>é€‰æ‹©cityåœ¨Torontoå·¥ä½œçš„å‘˜å·¥çš„last_name , job_id , department_id , department_name <span class="hljs-keyword">SELECT</span> last_name , job_id , d.department_id , department_name <span class="hljs-keyword">FROM</span> employees e,departments d ,locations l<span class="hljs-keyword">WHERE</span> e.department_id <span class="hljs-operator">=</span> d.department_id<span class="hljs-keyword">AND</span> d.location_id<span class="hljs-operator">=</span>l.location_id<span class="hljs-keyword">AND</span> city <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Toronto&#x27;</span>;#<span class="hljs-number">5.</span>æŸ¥è¯¢æ¯ä¸ªå·¥ç§ã€æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨åã€å·¥ç§åå’Œæœ€ä½å·¥èµ„<span class="hljs-keyword">SELECT</span> department_name,job_title,<span class="hljs-built_in">MIN</span>(salary) æœ€ä½å·¥èµ„<span class="hljs-keyword">FROM</span> employees e,departments d,jobs j<span class="hljs-keyword">WHERE</span> e.`department_id`<span class="hljs-operator">=</span>d.`department_id`<span class="hljs-keyword">AND</span> e.`job_id`<span class="hljs-operator">=</span>j.`job_id`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_name,job_title;#<span class="hljs-number">6.</span>æŸ¥è¯¢æ¯ä¸ªå›½å®¶ä¸‹çš„éƒ¨é—¨ä¸ªæ•°å¤§äº<span class="hljs-number">2</span>çš„å›½å®¶ç¼–å·<span class="hljs-keyword">SELECT</span> country_id,<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) éƒ¨é—¨ä¸ªæ•°<span class="hljs-keyword">FROM</span> departments d,locations l<span class="hljs-keyword">WHERE</span> d.`location_id`<span class="hljs-operator">=</span>l.`location_id`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> country_id<span class="hljs-keyword">HAVING</span> éƒ¨é—¨ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>;#<span class="hljs-number">7</span>ã€é€‰æ‹©æŒ‡å®šå‘˜å·¥çš„å§“åï¼Œå‘˜å·¥å·ï¼Œä»¥åŠä»–çš„ç®¡ç†è€…çš„å§“åå’Œå‘˜å·¥å·ï¼Œç»“æœç±»ä¼¼äºä¸‹é¢çš„æ ¼å¼employeesEmp#managerMgr#kochhar<span class="hljs-number">101</span>king<span class="hljs-number">100</span><span class="hljs-keyword">SELECT</span> e.last_name employees,e.employee_id &quot;Emp#&quot;,m.last_name manager,m.employee_id &quot;Mgr#&quot;<span class="hljs-keyword">FROM</span> employees e,employees m<span class="hljs-keyword">WHERE</span> e.manager_id <span class="hljs-operator">=</span> m.employee_id<span class="hljs-keyword">AND</span> e.last_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;kochhar&#x27;</span>;</code></pre></div><p><strong>äºŒã€sql99è¯­æ³•ï¼šé€šè¿‡joinå…³é”®å­—å®ç°è¿æ¥</strong></p><ul><li>å†…è¿æ¥ï¼ˆinnerï¼‰<ul><li>ç­‰å€¼è¿æ¥</li><li>éç­‰å€¼è¿æ¥ </li><li>è‡ªè¿æ¥</li></ul></li><li>å¤–è¿æ¥<ul><li>å·¦å¤–è¿æ¥ï¼ˆleft ã€outerã€‘)</li><li>å³å¤–è¿æ¥ï¼ˆright ã€outerã€‘ï¼‰</li><li>å…¨å¤–è¿æ¥ï¼ˆfullã€outerã€‘ï¼‰</li></ul></li><li>äº¤å‰è¿æ¥ cross</li></ul><p><strong>è¯­æ³•</strong></p><blockquote><p>select å­—æ®µï¼Œâ€¦<br>from è¡¨1<br>ã€inner|left outer|right outer|crossã€‘join è¡¨2<br>ã€on  è¿æ¥æ¡ä»¶ã€‘<br>ã€inner|left outer|right outer|crossã€‘join è¡¨3<br>ã€on  è¿æ¥æ¡ä»¶ã€‘<br>ã€where ç­›é€‰æ¡ä»¶ã€‘<br>ã€group by åˆ†ç»„å­—æ®µã€‘<br>ã€having åˆ†ç»„åçš„ç­›é€‰æ¡ä»¶ã€‘<br>ã€order by æ’åºçš„å­—æ®µæˆ–è¡¨è¾¾å¼ã€‘</p></blockquote><p>å¥½å¤„ï¼šè¯­å¥ä¸Šï¼Œè¿æ¥æ¡ä»¶å’Œç­›é€‰æ¡ä»¶å®ç°äº†åˆ†ç¦»ï¼Œç®€æ´æ˜äº†</p><p><strong>æ²¡æœ‰åˆ›å»ºå¤–é”®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å†…å¤–æŸ¥è¯¢å°†ä¸¤ä¸ªè¡¨çš„å†…å®¹åˆå¹¶åœ¨ä¸€èµ·æŸ¥è¯¢</strong></p><blockquote><p><strong>å†…è¿æ¥</strong></p></blockquote><p><strong>å†…è”æŸ¥è¯¢ï¼šä¸¤å¼ è¡¨é€šè¿‡æŸä¸ªå­—æ®µåˆå¹¶èµ·æ¥ï¼ŒæŸ¥è¯¢å‡ºç›¸å…³æ•°æ®</strong></p><p><strong>ç­‰å€¼è¿æ¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1.</span>æŸ¥è¯¢å‘˜å·¥åã€éƒ¨é—¨å<span class="hljs-keyword">SELECT</span> last_name,department_name<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>  employees e<span class="hljs-keyword">ON</span> e.`department_id` <span class="hljs-operator">=</span> d.`department_id`;#æ¡ˆä¾‹<span class="hljs-number">2.</span>æŸ¥è¯¢åå­—ä¸­åŒ…å«eçš„å‘˜å·¥åå’Œå·¥ç§åï¼ˆæ·»åŠ ç­›é€‰ï¼‰<span class="hljs-keyword">SELECT</span> last_name,job_title<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> jobs j<span class="hljs-keyword">ON</span> e.`job_id`<span class="hljs-operator">=</span>  j.`job_id`<span class="hljs-keyword">WHERE</span> e.`last_name` <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%e%&#x27;</span>;#<span class="hljs-number">3.</span> æŸ¥è¯¢éƒ¨é—¨ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>çš„åŸå¸‚åå’Œéƒ¨é—¨ä¸ªæ•°ï¼Œï¼ˆæ·»åŠ åˆ†ç»„<span class="hljs-operator">+</span>ç­›é€‰ï¼‰#â‘ æŸ¥è¯¢æ¯ä¸ªåŸå¸‚çš„éƒ¨é—¨ä¸ªæ•°#â‘¡åœ¨â‘ ç»“æœä¸Šç­›é€‰æ»¡è¶³æ¡ä»¶çš„<span class="hljs-keyword">SELECT</span> city,<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) éƒ¨é—¨ä¸ªæ•°<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> locations l<span class="hljs-keyword">ON</span> d.`location_id`<span class="hljs-operator">=</span>l.`location_id`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> city<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>;#æ¡ˆä¾‹<span class="hljs-number">4.</span>æŸ¥è¯¢å“ªä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>çš„éƒ¨é—¨åå’Œå‘˜å·¥ä¸ªæ•°ï¼Œå¹¶æŒ‰ä¸ªæ•°é™åºï¼ˆæ·»åŠ æ’åºï¼‰#â‘ æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),department_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d<span class="hljs-keyword">ON</span> e.`department_id`<span class="hljs-operator">=</span>d.`department_id`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_name#â‘¡ åœ¨â‘ ç»“æœä¸Šç­›é€‰å‘˜å·¥ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>çš„è®°å½•ï¼Œå¹¶æ’åº<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) ä¸ªæ•°,department_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d<span class="hljs-keyword">ON</span> e.`department_id`<span class="hljs-operator">=</span>d.`department_id`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_name<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">DESC</span>;#<span class="hljs-number">5.</span>æŸ¥è¯¢å‘˜å·¥åã€éƒ¨é—¨åã€å·¥ç§åï¼Œå¹¶æŒ‰éƒ¨é—¨åé™åºï¼ˆæ·»åŠ ä¸‰è¡¨è¿æ¥ï¼‰<span class="hljs-keyword">SELECT</span> last_name,department_name,job_title<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> e.`department_id`<span class="hljs-operator">=</span>d.`department_id`<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> jobs j <span class="hljs-keyword">ON</span> e.`job_id` <span class="hljs-operator">=</span> j.`job_id`<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department_name <span class="hljs-keyword">DESC</span>;</code></pre></div><p><strong>éç­‰å€¼è¿æ¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æŸ¥è¯¢å‘˜å·¥çš„å·¥èµ„çº§åˆ«<span class="hljs-keyword">SELECT</span> salary,grade_level<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> job_grades g<span class="hljs-keyword">ON</span> e.`salary` <span class="hljs-keyword">BETWEEN</span> g.`lowest_sal` <span class="hljs-keyword">AND</span> g.`highest_sal`;  #æŸ¥è¯¢å·¥èµ„çº§åˆ«çš„ä¸ªæ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">20</span>çš„ä¸ªæ•°ï¼Œå¹¶ä¸”æŒ‰å·¥èµ„çº§åˆ«é™åº<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),grade_level<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> job_grades g<span class="hljs-keyword">ON</span> e.`salary` <span class="hljs-keyword">BETWEEN</span> g.`lowest_sal` <span class="hljs-keyword">AND</span> g.`highest_sal`<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> grade_level<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">20</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade_level <span class="hljs-keyword">DESC</span>;</code></pre></div><blockquote><p><strong>è‡ªè¿æ¥</strong></p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql">#æŸ¥è¯¢å‘˜å·¥åå’Œç›´æ¥ä¸Šçº§çš„åç§°ï¼Œä»è‡ªå·±çš„è¡¨ä¸­æŸ¥è¯¢ä¸¤æ¬¡#sql99<span class="hljs-keyword">SELECT</span> e.last_name,m.last_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> employees m <span class="hljs-keyword">ON</span> e.`manager_id`<span class="hljs-operator">=</span>m.`employee_id`;#sql92<span class="hljs-keyword">SELECT</span> e.last_name,m.last_name<span class="hljs-keyword">FROM</span> employees e,employees m <span class="hljs-keyword">WHERE</span> e.`manager_id`<span class="hljs-operator">=</span>m.`employee_id`;#æŸ¥è¯¢å‘˜å·¥çš„åå­—ã€ä¸Šçº§çš„åå­—<span class="hljs-keyword">SELECT</span> e.last_name,m.last_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> employees m<span class="hljs-keyword">ON</span> e.`manager_id`<span class="hljs-operator">=</span> m.`employee_id`;#æŸ¥è¯¢å§“åä¸­åŒ…å«å­—ç¬¦kçš„å‘˜å·¥çš„åå­—ã€ä¸Šçº§çš„åå­—<span class="hljs-keyword">SELECT</span> e.last_name,m.last_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> employees m<span class="hljs-keyword">ON</span> e.`manager_id`<span class="hljs-operator">=</span> m.`employee_id`<span class="hljs-keyword">WHERE</span> e.`last_name` <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%k%&#x27;</span>;</code></pre></div><blockquote><p><strong>å¤–è¿æ¥</strong></p></blockquote><p><strong>åº”ç”¨åœºæ™¯ï¼šç”¨äºæŸ¥è¯¢ä¸€ä¸ªè¡¨ä¸­æœ‰ï¼Œå¦ä¸€ä¸ªè¡¨æ²¡æœ‰çš„è®°å½•</strong></p><ul><li>ç‰¹ç‚¹ï¼š</li><li>å¤–è¿æ¥çš„æŸ¥è¯¢ç»“æœä¸ºä¸»è¡¨ä¸­çš„æ‰€æœ‰è®°å½•<ul><li>å¦‚æœä»è¡¨ä¸­æœ‰å’Œå®ƒåŒ¹é…çš„ï¼Œåˆ™æ˜¾ç¤ºåŒ¹é…çš„å€¼</li><li>å¦‚æœä»è¡¨ä¸­æ²¡æœ‰å’Œå®ƒåŒ¹é…çš„ï¼Œåˆ™æ˜¾ç¤ºnull</li><li><strong>å¤–è¿æ¥æŸ¥è¯¢ç»“æœ=å†…è¿æ¥ç»“æœ+ä¸»è¡¨ä¸­æœ‰è€Œä»è¡¨æ²¡æœ‰çš„è®°å½•</strong></li></ul></li><li>å·¦å¤–è¿æ¥ï¼Œleft joinå·¦è¾¹çš„æ˜¯ä¸»è¡¨</li><li>å³å¤–è¿æ¥ï¼Œright joinå³è¾¹çš„æ˜¯ä¸»è¡¨</li><li>å·¦å¤–å’Œå³å¤–äº¤æ¢ä¸¤ä¸ªè¡¨çš„é¡ºåºï¼Œå¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœ </li><li>å…¨å¤–è¿æ¥=å†…è¿æ¥çš„ç»“æœ+è¡¨1ä¸­æœ‰ä½†è¡¨2æ²¡æœ‰çš„+è¡¨2ä¸­æœ‰ä½†è¡¨1æ²¡æœ‰çš„</li></ul><p><strong>å·¦å¤–è¿æ¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...æˆ–<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...</code></pre></div><p>ä¸¾ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#å¼•å…¥ï¼šæŸ¥è¯¢ç”·æœ‹å‹ ä¸åœ¨ç”·ç¥è¡¨çš„çš„å¥³ç¥å<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> beauty;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> boys;#bo<span class="hljs-operator">=</span>boys b<span class="hljs-operator">=</span>beauty#å·¦å¤–è¿æ¥<span class="hljs-keyword">SELECT</span> b.name,bo.<span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> beauty b<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> boys bo<span class="hljs-keyword">ON</span> b.`boyfriend_id` <span class="hljs-operator">=</span> bo.`id`<span class="hljs-keyword">WHERE</span> bo.`id` <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šæŸ¥è¯¢å“ªä¸ªéƒ¨é—¨æ²¡æœ‰å‘˜å·¥#å·¦å¤–<span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,e.employee_id<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> employees e<span class="hljs-keyword">ON</span> d.`department_id` <span class="hljs-operator">=</span> e.`department_id`<span class="hljs-keyword">WHERE</span> e.`employee_id` <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><strong>å³å¤–è¿æ¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...æˆ–<span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...</code></pre></div><p>ä¸¾ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#å³å¤–<span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,e.employee_id<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> departments d<span class="hljs-keyword">ON</span> d.`department_id` <span class="hljs-operator">=</span> e.`department_id`<span class="hljs-keyword">WHERE</span> e.`employee_id` <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;](MySQL.assets<span class="hljs-operator">/</span><span class="hljs-number">20200810195526.</span>png)](https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>nyimapicture.oss<span class="hljs-operator">-</span>cn<span class="hljs-operator">-</span>beijing.aliyuncs.com<span class="hljs-operator">/</span>img<span class="hljs-operator">/</span><span class="hljs-number">20200810195526.</span>png)</code></pre></div><p><strong>PSï¼šå…¨å¤–è¿æ¥<code>FULL</code>æ˜¯ä¸¤è€…çš„å¹¶é›†ï¼Œå…¨å¤–è¿æ¥<code>CROSS</code>æ˜¯æ‰€æœ‰çš„æ’åˆ—ç»„åˆï¼Œæ˜¯ä¸€ä¸ªç¬›å¡å°”ä¹˜ç§¯</strong></p><p><strong>ä¸‰ç§è¿æ¥çš„å›¾è§£</strong></p><p><strong>å†…è¿æ¥</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810200025.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810200025.png" alt="img"></a></p><p><strong>å·¦è¿æ¥</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810200040.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810200040.png" alt="img"></a></p><p><strong>å³è¿æ¥</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810200104.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810200104.png" alt="img"></a></p><p><strong>é¢å¤–æƒ…å†µ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210428161509573.png" alt="image-20210428161509573"></p><h4 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h4><p>å«ä¹‰ï¼š</p><ul><li>ä¸€æ¡æŸ¥è¯¢è¯­å¥ä¸­åˆåµŒå¥—äº†å¦ä¸€æ¡å®Œæ•´çš„selectè¯­å¥ï¼Œå…¶ä¸­è¢«åµŒå¥—çš„selectè¯­å¥ï¼Œç§°ä¸ºå­æŸ¥è¯¢æˆ–å†…æŸ¥è¯¢</li><li>åœ¨å¤–é¢çš„æŸ¥è¯¢è¯­å¥ï¼Œç§°ä¸ºä¸»æŸ¥è¯¢æˆ–å¤–æŸ¥è¯¢</li></ul><p>ç‰¹ç‚¹ï¼š</p><ul><li>å­æŸ¥è¯¢éƒ½æ”¾åœ¨å°æ‹¬å·å†…</li><li>å­æŸ¥è¯¢å¯ä»¥æ”¾åœ¨fromåé¢ã€selectåé¢ã€whereåé¢ã€havingåé¢ï¼Œä½†ä¸€èˆ¬æ”¾åœ¨æ¡ä»¶çš„å³ä¾§</li><li>å­æŸ¥è¯¢ä¼˜å…ˆäºä¸»æŸ¥è¯¢æ‰§è¡Œï¼Œä¸»æŸ¥è¯¢ä½¿ç”¨äº†å­æŸ¥è¯¢çš„æ‰§è¡Œç»“æœ</li><li>å­æŸ¥è¯¢æ ¹æ®æŸ¥è¯¢ç»“æœçš„è¡Œæ•°ä¸åŒåˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š<ul><li>æ ‡é‡å­æŸ¥è¯¢<ul><li>ç»“æœé›†åªæœ‰ä¸€è¡Œ</li><li>ä¸€èˆ¬æ­é…å•è¡Œæ“ä½œç¬¦ä½¿ç”¨ï¼š&gt; &lt; = &lt;&gt; &gt;= &lt;= </li><li>éæ³•ä½¿ç”¨å­æŸ¥è¯¢çš„æƒ…å†µï¼š<div class="hljs code-wrapper"><pre><code>aã€å­æŸ¥è¯¢çš„ç»“æœä¸ºä¸€ç»„å€¼bã€å­æŸ¥è¯¢çš„ç»“æœä¸ºç©º</code></pre></div></li></ul></li><li>åˆ—å­æŸ¥è¯¢<ul><li>ç»“æœé›†æœ‰å¤šè¡Œ </li><li>ä¸€èˆ¬æ­é…å¤šè¡Œæ“ä½œç¬¦ä½¿ç”¨ï¼šanyã€allã€inã€not in </li><li>inï¼š å±äºå­æŸ¥è¯¢ç»“æœä¸­çš„ä»»æ„ä¸€ä¸ªå°±è¡Œ </li><li>anyï¼šå’Œå­æŸ¥è¯¢çš„æŸä¸€ä¸ªæ¯”è¾ƒï¼ˆå¯ä»£æ›¿ï¼‰</li><li>allï¼šå’Œå­æŸ¥è¯¢çš„æ‰€æœ‰æ¯”è¾ƒï¼ˆå¯ä»£æ›¿ï¼‰</li></ul></li></ul></li><li><strong>æŒ‰ç»“æœé›†çš„è¡Œåˆ—æ•°ä¸åŒï¼š</strong><ul><li>æ ‡é‡å­æŸ¥è¯¢ï¼ˆç»“æœé›†åªæœ‰ä¸€è¡Œä¸€åˆ—ï¼‰</li><li>åˆ—å­æŸ¥è¯¢ï¼ˆç»“æœé›†åªæœ‰ä¸€åˆ—å¤šè¡Œï¼‰</li><li>è¡Œå­æŸ¥è¯¢ï¼ˆç»“æœé›†æœ‰ä¸€è¡Œå¤šåˆ—ï¼‰</li><li>è¡¨å­æŸ¥è¯¢ï¼ˆç»“æœé›†ä¸€èˆ¬ä¸ºå¤šè¡Œå¤šåˆ—ï¼‰</li></ul></li></ul><blockquote><p>selectåé¢ï¼š<br>  ä»…ä»…æ”¯æŒæ ‡é‡å­æŸ¥è¯¢</p><p>fromåé¢ï¼š<br>  æ”¯æŒè¡¨å­æŸ¥è¯¢<br>whereæˆ–havingåé¢ï¼šâ˜…<br>  æ ‡é‡å­æŸ¥è¯¢ï¼ˆå•è¡Œï¼‰ âˆš<br>  åˆ—å­æŸ¥è¯¢  ï¼ˆå¤šè¡Œï¼‰ âˆš<br>   è¡Œå­æŸ¥è¯¢</p><p>existsåé¢ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰<br>  è¡¨å­æŸ¥è¯¢</p></blockquote><p><strong>æ ‡é‡å­æŸ¥è¯¢ä¸¾ä¾‹ï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šè°çš„å·¥èµ„æ¯” Abel é«˜?#â‘ æŸ¥è¯¢Abelçš„å·¥èµ„<span class="hljs-keyword">SELECT</span> salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Abel&#x27;</span>#â‘¡æŸ¥è¯¢å‘˜å·¥çš„ä¿¡æ¯ï¼Œæ»¡è¶³ salary<span class="hljs-operator">&gt;</span>â‘ ç»“æœ<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> salary<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Abel&#x27;</span>);#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šè¿”å›job_idä¸<span class="hljs-number">141</span>å·å‘˜å·¥ç›¸åŒï¼Œsalaryæ¯”<span class="hljs-number">143</span>å·å‘˜å·¥å¤šçš„å‘˜å·¥ å§“åï¼Œjob_id å’Œå·¥èµ„#â‘ æŸ¥è¯¢<span class="hljs-number">141</span>å·å‘˜å·¥çš„job_id<span class="hljs-keyword">SELECT</span> job_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">141</span>#â‘¡æŸ¥è¯¢<span class="hljs-number">143</span>å·å‘˜å·¥çš„salary<span class="hljs-keyword">SELECT</span> salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">143</span>#â‘¢æŸ¥è¯¢å‘˜å·¥çš„å§“åï¼Œjob_id å’Œå·¥èµ„ï¼Œè¦æ±‚job_id<span class="hljs-operator">=</span>â‘ å¹¶ä¸”salary<span class="hljs-operator">&gt;</span>â‘¡<span class="hljs-keyword">SELECT</span> last_name,job_id,salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> job_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">141</span>) <span class="hljs-keyword">AND</span> salary<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">143</span>);#æ¡ˆä¾‹<span class="hljs-number">3</span>ï¼šè¿”å›å…¬å¸å·¥èµ„æœ€å°‘çš„å‘˜å·¥çš„last_name,job_idå’Œsalary#â‘ æŸ¥è¯¢å…¬å¸çš„æœ€ä½å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<span class="hljs-keyword">FROM</span> employees#â‘¡æŸ¥è¯¢last_name,job_idå’Œsalaryï¼Œè¦æ±‚salary<span class="hljs-operator">=</span>â‘ <span class="hljs-keyword">SELECT</span> last_name,job_id,salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> salary<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<span class="hljs-keyword">FROM</span> employees);#æ¡ˆä¾‹<span class="hljs-number">4</span>ï¼šæŸ¥è¯¢æœ€ä½å·¥èµ„å¤§äº<span class="hljs-number">50</span>å·éƒ¨é—¨æœ€ä½å·¥èµ„çš„éƒ¨é—¨idå’Œå…¶æœ€ä½å·¥èµ„#â‘ æŸ¥è¯¢<span class="hljs-number">50</span>å·éƒ¨é—¨çš„æœ€ä½å·¥èµ„<span class="hljs-keyword">SELECT</span>  <span class="hljs-built_in">MIN</span>(salary)<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">50</span>#â‘¡æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„æœ€ä½å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id#â‘¢ åœ¨â‘¡åŸºç¡€ä¸Šç­›é€‰ï¼Œæ»¡è¶³<span class="hljs-built_in">min</span>(salary)<span class="hljs-operator">&gt;</span>â‘ <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MIN</span>(salary)<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span>  <span class="hljs-built_in">MIN</span>(salary)<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">50</span>);</code></pre></div><p><strong>åˆ—å­æŸ¥è¯¢ä¸¾ä¾‹ï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šè¿”å›location_idæ˜¯<span class="hljs-number">1400</span>æˆ–<span class="hljs-number">1700</span>çš„éƒ¨é—¨ä¸­çš„æ‰€æœ‰å‘˜å·¥å§“å#â‘ æŸ¥è¯¢location_idæ˜¯<span class="hljs-number">1400</span>æˆ–<span class="hljs-number">1700</span>çš„éƒ¨é—¨ç¼–å·<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id<span class="hljs-keyword">FROM</span> departments<span class="hljs-keyword">WHERE</span> location_id <span class="hljs-keyword">IN</span>(<span class="hljs-number">1400</span>,<span class="hljs-number">1700</span>)#â‘¡æŸ¥è¯¢å‘˜å·¥å§“åï¼Œè¦æ±‚éƒ¨é—¨å·æ˜¯â‘ åˆ—è¡¨ä¸­çš„æŸä¸€ä¸ª<span class="hljs-keyword">SELECT</span> last_name<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">IN</span>( #<span class="hljs-operator">&lt;&gt;</span><span class="hljs-keyword">ALL</span><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id<span class="hljs-keyword">FROM</span> departments<span class="hljs-keyword">WHERE</span> location_id <span class="hljs-keyword">IN</span>(<span class="hljs-number">1400</span>,<span class="hljs-number">1700</span>));#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šè¿”å›å…¶å®ƒå·¥ç§ä¸­æ¯”job_idä¸ºâ€˜IT_PROGâ€™å·¥ç§ä»»ä¸€å·¥èµ„ä½çš„å‘˜å·¥çš„å‘˜å·¥å·ã€å§“åã€job_id ä»¥åŠsalary#â‘ æŸ¥è¯¢job_idä¸ºâ€˜IT_PROGâ€™éƒ¨é—¨ä»»ä¸€å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;IT_PROG&#x27;</span>#â‘¡æŸ¥è¯¢å‘˜å·¥å·ã€å§“åã€job_id ä»¥åŠsalaryï¼Œsalary<span class="hljs-operator">&lt;</span>(â‘ )çš„ä»»æ„ä¸€ä¸ª<span class="hljs-keyword">SELECT</span> last_name,employee_id,job_id,salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> salary<span class="hljs-operator">&lt;</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary)<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;IT_PROG&#x27;</span>) <span class="hljs-keyword">AND</span> job_id<span class="hljs-operator">&lt;&gt;</span><span class="hljs-string">&#x27;IT_PROG&#x27;</span>;</code></pre></div><p><strong>è¡Œå­æŸ¥è¯¢è·ç¦»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥ç¼–å·æœ€å°å¹¶ä¸”å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> (employee_id,salary)<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(employee_id),<span class="hljs-built_in">MAX</span>(salary)<span class="hljs-keyword">FROM</span> employees);#ç­‰åŒäº#â‘ æŸ¥è¯¢æœ€å°çš„å‘˜å·¥ç¼–å·<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(employee_id)<span class="hljs-keyword">FROM</span> employees#â‘¡æŸ¥è¯¢æœ€é«˜å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary)<span class="hljs-keyword">FROM</span> employees#â‘¢æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(employee_id)<span class="hljs-keyword">FROM</span> employees)<span class="hljs-keyword">AND</span> salary<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary)<span class="hljs-keyword">FROM</span> employees);</code></pre></div><p><strong>selectåé¢çš„æ ‡é‡å­æŸ¥è¯¢</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">WHERE</span> e.department_id <span class="hljs-operator">=</span> d.`department_id` ) ä¸ªæ•° <span class="hljs-keyword">FROM</span> departments d;  #æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šæŸ¥è¯¢å‘˜å·¥å·<span class="hljs-operator">=</span><span class="hljs-number">102</span>çš„éƒ¨é—¨å<span class="hljs-keyword">SELECT</span> (<span class="hljs-keyword">SELECT</span> department_name<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> employees e<span class="hljs-keyword">ON</span> d.department_id<span class="hljs-operator">=</span>e.department_id<span class="hljs-keyword">WHERE</span> e.employee_id<span class="hljs-operator">=</span><span class="hljs-number">102</span>) éƒ¨é—¨å;</code></pre></div><p><strong>fromåé¢å°†å­æŸ¥è¯¢ç»“æœå……å½“ä¸€å¼ è¡¨ï¼Œè¦æ±‚å¿…é¡»èµ·åˆ«å</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„çš„å·¥èµ„ç­‰çº§#â‘ æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary),department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> job_grades;#â‘¡è¿æ¥â‘ çš„ç»“æœé›†å’Œjob_gradesè¡¨ï¼Œç­›é€‰æ¡ä»¶å¹³å‡å·¥èµ„ <span class="hljs-keyword">between</span> lowest_sal <span class="hljs-keyword">and</span> highest_sal<span class="hljs-keyword">SELECT</span>  ag_dep.<span class="hljs-operator">*</span>,g.`grade_level`<span class="hljs-keyword">FROM</span> (   <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) ag,department_id   <span class="hljs-keyword">FROM</span> employees   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id) ag_dep<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> job_grades g<span class="hljs-keyword">ON</span> ag_dep.ag <span class="hljs-keyword">BETWEEN</span> lowest_sal <span class="hljs-keyword">AND</span> highest_sal;</code></pre></div><p><strong>existsåé¢ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰</strong></p><p>exists(å®Œæ•´çš„æŸ¥è¯¢è¯­å¥)ï¼Œç»“æœï¼š<code>1æˆ–0</code></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šæŸ¥è¯¢æœ‰å‘˜å·¥çš„éƒ¨é—¨å#<span class="hljs-keyword">in</span><span class="hljs-keyword">SELECT</span> department_name<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">WHERE</span> d.`department_id` <span class="hljs-keyword">IN</span>(   <span class="hljs-keyword">SELECT</span> department_id   <span class="hljs-keyword">FROM</span> employees);#<span class="hljs-keyword">exists</span><span class="hljs-keyword">SELECT</span> department_name<span class="hljs-keyword">FROM</span> departments d<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(   <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>   <span class="hljs-keyword">FROM</span> employees e   <span class="hljs-keyword">WHERE</span> d.`department_id`<span class="hljs-operator">=</span>e.`department_id`);#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šæŸ¥è¯¢æ²¡æœ‰å¥³æœ‹å‹çš„ç”·ç¥ä¿¡æ¯#<span class="hljs-keyword">in</span><span class="hljs-keyword">SELECT</span> bo.<span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> boys bo<span class="hljs-keyword">WHERE</span> bo.id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> boyfriend_id<span class="hljs-keyword">FROM</span> beauty);#<span class="hljs-keyword">exists</span><span class="hljs-keyword">SELECT</span> bo.<span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> boys bo<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> boyfriend_id<span class="hljs-keyword">FROM</span> beauty b<span class="hljs-keyword">WHERE</span> bo.`id`<span class="hljs-operator">=</span>b.`boyfriend_id`);</code></pre></div><h4 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a><strong>åˆ†é¡µæŸ¥è¯¢</strong></h4><p>åº”ç”¨åœºæ™¯ï¼š</p><p>å®é™…çš„webé¡¹ç›®ä¸­éœ€è¦æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚æäº¤å¯¹åº”çš„åˆ†é¡µæŸ¥è¯¢çš„sqlè¯­å¥</p><p>è¯­æ³•ï¼š</p><blockquote><p>select å­—æ®µ|è¡¨è¾¾å¼,â€¦<br>from è¡¨<br>ã€where æ¡ä»¶ã€‘<br>ã€group by åˆ†ç»„å­—æ®µã€‘<br>ã€having æ¡ä»¶ã€‘<br>ã€order by æ’åºçš„å­—æ®µã€‘<br>limit ã€èµ·å§‹çš„æ¡ç›®ç´¢å¼•offsetã€‘æ¡ç›®æ•°size;</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li><strong>èµ·å§‹æ¡ç›®ç´¢å¼•ä»0å¼€å§‹</strong></li><li>limitå­å¥æ”¾åœ¨æŸ¥è¯¢è¯­å¥çš„æœ€å</li><li>å…¬å¼ï¼š<code>select * from  è¡¨ limit ï¼ˆpage-1ï¼‰*sizePerPage,sizePerPage</code><ul><li>å‡å¦‚:<br>æ¯é¡µæ˜¾ç¤ºæ¡ç›®æ•°sizePerPage<br>è¦æ˜¾ç¤ºçš„é¡µæ•° page</li></ul></li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šæŸ¥è¯¢å‰äº”æ¡å‘˜å·¥ä¿¡æ¯<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span>  employees LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">5</span>;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span>  employees LIMIT <span class="hljs-number">5</span>;#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šæŸ¥è¯¢ç¬¬<span class="hljs-number">11</span>æ¡â€”â€”ç¬¬<span class="hljs-number">25</span>æ¡<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employeesLIMIT <span class="hljs-number">10</span>,<span class="hljs-number">15</span>;#æ¡ˆä¾‹<span class="hljs-number">3</span>ï¼šæœ‰å¥–é‡‘çš„å‘˜å·¥ä¿¡æ¯ï¼Œå¹¶ä¸”å·¥èµ„è¾ƒé«˜çš„å‰<span class="hljs-number">10</span>åæ˜¾ç¤ºå‡ºæ¥<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> commission_pct <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>LIMIT <span class="hljs-number">10</span>;</code></pre></div><h4 id="è”åˆæŸ¥è¯¢"><a href="#è”åˆæŸ¥è¯¢" class="headerlink" title="è”åˆæŸ¥è¯¢"></a>è”åˆæŸ¥è¯¢</h4><p><strong>å¼•å…¥</strong><br>union è”åˆã€åˆå¹¶</p><p><strong>è¯­æ³•</strong></p><blockquote><p>select å­—æ®µ|å¸¸é‡|è¡¨è¾¾å¼|å‡½æ•° ã€from è¡¨ã€‘ ã€where æ¡ä»¶ã€‘ union ã€allã€‘<br>select å­—æ®µ|å¸¸é‡|è¡¨è¾¾å¼|å‡½æ•° ã€from è¡¨ã€‘ ã€where æ¡ä»¶ã€‘ union ã€allã€‘<br>select å­—æ®µ|å¸¸é‡|è¡¨è¾¾å¼|å‡½æ•° ã€from è¡¨ã€‘ ã€where æ¡ä»¶ã€‘ union  ã€allã€‘<br>â€¦..<br>select å­—æ®µ|å¸¸é‡|è¡¨è¾¾å¼|å‡½æ•° ã€from è¡¨ã€‘ ã€where æ¡ä»¶ã€‘</p></blockquote><p><strong>ç‰¹ç‚¹</strong></p><ul><li>å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„åˆ—æ•°å¿…é¡»æ˜¯ä¸€è‡´çš„</li><li>å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„åˆ—çš„ç±»å‹å‡ ä¹ç›¸åŒ</li><li>unionä»£è¡¨å»é‡ï¼Œunion allä»£è¡¨ä¸å»é‡</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql">#å¼•å…¥çš„æ¡ˆä¾‹ï¼šæŸ¥è¯¢éƒ¨é—¨ç¼–å·<span class="hljs-operator">&gt;</span><span class="hljs-number">90</span>æˆ–é‚®ç®±åŒ…å«açš„å‘˜å·¥ä¿¡æ¯<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> email <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span>   <span class="hljs-keyword">OR</span> department_id <span class="hljs-operator">&gt;</span> <span class="hljs-number">90</span>;;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> email <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span><span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">&gt;</span> <span class="hljs-number">90</span>;#æ¡ˆä¾‹ï¼šæŸ¥è¯¢ä¸­å›½ç”¨æˆ·ä¸­ç”·æ€§çš„ä¿¡æ¯ä»¥åŠå¤–å›½ç”¨æˆ·ä¸­å¹´ç”·æ€§çš„ç”¨æˆ·ä¿¡æ¯<span class="hljs-keyword">SELECT</span> id,cname <span class="hljs-keyword">FROM</span> t_ca <span class="hljs-keyword">WHERE</span> csex<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ç”·&#x27;</span><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span><span class="hljs-keyword">SELECT</span> t_id,tname <span class="hljs-keyword">FROM</span> t_ua <span class="hljs-keyword">WHERE</span> tGender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;male&#x27;</span>;</code></pre></div><h4 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h4><p>å»ºè¡¨è¯­å¥åŠæ’å…¥è¯­å¥</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(    s_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">PRIMARY</span> KEY COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿå­¦å·&#x27;</span>,    s_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿå§“å ä¸èƒ½ä¸ºç©º&#x27;</span>,    s_sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿæ€§åˆ«&#x27;</span>,    s_birthday DATETIME COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿç”Ÿæ—¥&#x27;</span>,    s_class <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT<span class="hljs-string">&#x27;å­¦ç”Ÿæ‰€åœ¨çš„ç­çº§&#x27;</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> teacher(    t_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">PRIMARY</span> KEY COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆç¼–å·&#x27;</span>,    t_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆå§“å&#x27;</span>,    t_sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆæ€§åˆ«&#x27;</span>,    t_birthday DATETIME COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆç”Ÿæ—¥&#x27;</span>,    t_rof <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆèŒç§°&#x27;</span>,    t_depart <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆæ‰€åœ¨çš„éƒ¨é—¨&#x27;</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> course(    c_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">PRIMARY</span> KEY COMMENT<span class="hljs-string">&#x27;è¯¾ç¨‹å·&#x27;</span>,    c_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;è¯¾ç¨‹åç§°&#x27;</span>,    t_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æ•™å¸ˆç¼–å· å¤–é”®å…³è”teacherè¡¨&#x27;</span>,    <span class="hljs-keyword">FOREIGN</span> KEY(t_no) <span class="hljs-keyword">references</span> teacher(t_no));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> score (    s_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;æˆç»©è¡¨çš„ç¼–å· ä¾èµ–å­¦ç”Ÿå­¦å·&#x27;</span>,        c_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;è¯¾ç¨‹å· ä¾èµ–äºè¯¾ç¨‹è¡¨ä¸­çš„c_id&#x27;</span>,    sc_degree <span class="hljs-type">decimal</span>,    <span class="hljs-keyword">foreign</span> key(s_no) <span class="hljs-keyword">references</span> student(s_no),    <span class="hljs-keyword">foreign</span> key(c_no) <span class="hljs-keyword">references</span> course(c_no),    <span class="hljs-keyword">PRIMARY</span> KEY(s_no,c_no)); <span class="hljs-comment">--å­¦ç”Ÿè¡¨æ•°æ®</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;101&#x27;</span>,<span class="hljs-string">&#x27;æ›¾å&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1977-09-01&#x27;</span>,<span class="hljs-string">&#x27;95033&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;102&#x27;</span>,<span class="hljs-string">&#x27;åŒ¡æ˜&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1975-10-02&#x27;</span>,<span class="hljs-string">&#x27;95031&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;103&#x27;</span>,<span class="hljs-string">&#x27;ç‹ä¸½&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1976-01-23&#x27;</span>,<span class="hljs-string">&#x27;95033&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;104&#x27;</span>,<span class="hljs-string">&#x27;æå†›&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1976-02-20&#x27;</span>,<span class="hljs-string">&#x27;95033&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;105&#x27;</span>,<span class="hljs-string">&#x27;ç‹èŠ³&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1975-02-10&#x27;</span>,<span class="hljs-string">&#x27;95031&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;106&#x27;</span>,<span class="hljs-string">&#x27;é™†å†›&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1974-06-03&#x27;</span>,<span class="hljs-string">&#x27;95031&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;107&#x27;</span>,<span class="hljs-string">&#x27;ç‹å°¼ç›&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1976-02-20&#x27;</span>,<span class="hljs-string">&#x27;95033&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;108&#x27;</span>,<span class="hljs-string">&#x27;å¼ å…¨è›‹&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1975-02-10&#x27;</span>,<span class="hljs-string">&#x27;95031&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;109&#x27;</span>,<span class="hljs-string">&#x27;èµµé“æŸ±&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1974-06-03&#x27;</span>,<span class="hljs-string">&#x27;95031&#x27;</span>);<span class="hljs-comment">--æ•™å¸ˆè¡¨æ•°æ®</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;804&#x27;</span>,<span class="hljs-string">&#x27;æè¯š&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1958-12-02&#x27;</span>,<span class="hljs-string">&#x27;å‰¯æ•™æˆ&#x27;</span>,<span class="hljs-string">&#x27;è®¡ç®—æœºç³»&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;856&#x27;</span>,<span class="hljs-string">&#x27;å¼ æ—­&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-string">&#x27;1969-03-12&#x27;</span>,<span class="hljs-string">&#x27;è®²å¸ˆ&#x27;</span>,<span class="hljs-string">&#x27;ç”µå­å·¥ç¨‹ç³»&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;825&#x27;</span>,<span class="hljs-string">&#x27;ç‹è&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1972-05-05&#x27;</span>,<span class="hljs-string">&#x27;åŠ©æ•™&#x27;</span>,<span class="hljs-string">&#x27;è®¡ç®—æœºç³»&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> teacher <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;831&#x27;</span>,<span class="hljs-string">&#x27;åˆ˜å†°&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1977-08-14&#x27;</span>,<span class="hljs-string">&#x27;åŠ©æ•™&#x27;</span>,<span class="hljs-string">&#x27;ç”µå­å·¥ç¨‹ç³»&#x27;</span>);<span class="hljs-comment">--æ·»åŠ è¯¾ç¨‹è¡¨</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> course <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;3-105&#x27;</span>,<span class="hljs-string">&#x27;è®¡ç®—æœºå¯¼è®º&#x27;</span>,<span class="hljs-string">&#x27;825&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> course <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;3-245&#x27;</span>,<span class="hljs-string">&#x27;æ“ä½œç³»ç»Ÿ&#x27;</span>,<span class="hljs-string">&#x27;804&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> course <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;6-166&#x27;</span>,<span class="hljs-string">&#x27;æ•°å­—ç”µè·¯&#x27;</span>,<span class="hljs-string">&#x27;856&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> course <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;9-888&#x27;</span>,<span class="hljs-string">&#x27;é«˜ç­‰æ•°å­¦&#x27;</span>,<span class="hljs-string">&#x27;831&#x27;</span>);<span class="hljs-comment">--æ·»åŠ æˆç»©è¡¨</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;103&#x27;</span>,<span class="hljs-string">&#x27;3-245&#x27;</span>,<span class="hljs-string">&#x27;86&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;105&#x27;</span>,<span class="hljs-string">&#x27;3-245&#x27;</span>,<span class="hljs-string">&#x27;75&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;109&#x27;</span>,<span class="hljs-string">&#x27;3-245&#x27;</span>,<span class="hljs-string">&#x27;68&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;103&#x27;</span>,<span class="hljs-string">&#x27;3-105&#x27;</span>,<span class="hljs-string">&#x27;92&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;105&#x27;</span>,<span class="hljs-string">&#x27;3-105&#x27;</span>,<span class="hljs-string">&#x27;88&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;109&#x27;</span>,<span class="hljs-string">&#x27;3-105&#x27;</span>,<span class="hljs-string">&#x27;76&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;103&#x27;</span>,<span class="hljs-string">&#x27;6-166&#x27;</span>,<span class="hljs-string">&#x27;85&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;105&#x27;</span>,<span class="hljs-string">&#x27;6-166&#x27;</span>,<span class="hljs-string">&#x27;79&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> score <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;109&#x27;</span>,<span class="hljs-string">&#x27;6-166&#x27;</span>,<span class="hljs-string">&#x27;81&#x27;</span>);</code></pre></div><ul><li>æŸ¥è¯¢studentè¡¨ä¸­æ‰€æœ‰è®°å½•çš„s_name,s_sexå’Œs_classåˆ—</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no,s_name,s_class <span class="hljs-keyword">FROM</span>  student;</code></pre></div><ul><li>æŸ¥è¯¢æ•™å¸ˆæ‰€æœ‰çš„å•ä½ä½†æ˜¯ä¸é‡å¤çš„t_departåˆ—</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(t_depart) <span class="hljs-keyword">FROM</span> teacher;</code></pre></div><ul><li>æŸ¥è¯¢scoreè¡¨ä¸­æˆç»©åœ¨60-80ä¹‹é—´æ‰€æœ‰çš„è®°å½•(sc_degree)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">60</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">80</span>;<span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;</code></pre></div><ul><li>æŸ¥è¯¢scoreè¡¨ä¸­æˆç»©ä¸º85, 86, æˆ–è€…88çš„è®°å½•(sc_degree)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-keyword">IN</span>(<span class="hljs-number">85</span>, <span class="hljs-number">86</span>, <span class="hljs-number">88</span>);</code></pre></div><ul><li>æŸ¥è¯¢studentè¡¨ä¸­â€™95031â€™ç­æˆ–è€…æ€§åˆ«ä¸ºâ€™å¥³â€™çš„åŒå­¦è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span> <span class="hljs-keyword">OR</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¥³&#x27;</span>;</code></pre></div><ul><li>ä»¥sc_degreeé™åºæŸ¥è¯¢scoreè¡¨ä¸­æ‰€æœ‰çš„è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;</code></pre></div><ul><li>æŸ¥è¯¢â€™95031â€™ç­çš„å­¦ç”Ÿäººæ•°</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>;</code></pre></div><ul><li>æŸ¥è¯¢scoreè¡¨ä¸­çš„æœ€é«˜åˆ†æ•°çš„å­¦ç”Ÿå·å’Œè¯¾ç¨‹å·</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, c_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(sc_degree) <span class="hljs-keyword">FROM</span> score);</code></pre></div><ul><li>æŸ¥è¯¢æ¯é—¨è¯¾çš„å¹³å‡æˆç»©</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no;</code></pre></div><ul><li>æŸ¥è¯¢scoreè¡¨ä¸­è‡³å°‘æœ‰2åå­¦ç”Ÿé€‰ä¿®çš„,å¹¶ä¸”ä»¥3å¼€å¤´çš„è¯¾ç¨‹çš„å¹³å‡åˆ†</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(c_no) <span class="hljs-operator">&gt;=</span><span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> c_no <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;3%&#x27;</span>;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰çš„å­¦ç”Ÿ s_name , c_no, sc_degreeåˆ—</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, c_no, sc_degree <span class="hljs-keyword">FROM</span> student, score <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„s_no, c_name, sc_degreeåˆ—</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, c_name, sc_degree <span class="hljs-keyword">FROM</span> student, score, course <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no <span class="hljs-keyword">AND</span> score.c_no <span class="hljs-operator">=</span> course.c_no;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰çš„å­¦ç”Ÿ s_name , c_name, sc_degreeåˆ—</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, c_name, sc_degree <span class="hljs-keyword">FROM</span> student, score, course <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no <span class="hljs-keyword">AND</span> score.c_no <span class="hljs-operator">=</span> course.c_no;</code></pre></div><ul><li>æŸ¥è¯¢ç­çº§æ˜¯â€™95031â€™ç­å­¦ç”Ÿæ¯é—¨è¯¾çš„å¹³å‡åˆ†</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> s_no <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>(c_no);<span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">ON</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no;<span class="hljs-comment">--æŸ¥è¯¢å†…å®¹åŒ…å«è¯¾ç¨‹åï¼ˆc_nameï¼‰</span><span class="hljs-keyword">SELECT</span> c.c_no, c.c_name, <span class="hljs-built_in">AVG</span>(sc.sc_degree) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c, score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> c.c_no <span class="hljs-keyword">AND</span> s.s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c.c_no;</code></pre></div><ul><li>æŸ¥è¯¢é€‰ä¿®â€3-105â€è¯¾ç¨‹çš„æˆç»©é«˜äºâ€™109â€™å·åŒå­¦â€™3-105â€™æˆç»© çš„æ‰€æœ‰åŒå­¦çš„è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">WHERE</span> sc.sc_degree <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;109&#x27;</span> <span class="hljs-keyword">AND</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span>) <span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> sc.s_no;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰ä¸å­¦å·ä¸º108.101çš„åŒå­¦åŒå¹´å‡ºç”Ÿçš„æ‰€æœ‰å­¦ç”Ÿçš„s_no,s_nameå’Œs_birthday</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(s_birthday) <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">YEAR</span>(s_birthday) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;101&#x27;</span>, <span class="hljs-string">&#x27;108&#x27;</span>));</code></pre></div><ul><li>æŸ¥è¯¢ å¼ æ—­ æ•™å¸ˆä»»è¯¾çš„å­¦ç”Ÿçš„æˆç»©</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, sc.sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> sc, student <span class="hljs-keyword">AS</span> s <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">WHERE</span> t_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ æ—­&#x27;</span>)) <span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> sc.s_no;</code></pre></div><ul><li>æŸ¥è¯¢95033ç­å’Œ95031ç­å…¨ä½“å­¦ç”Ÿçš„è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;95033&#x27;</span>, <span class="hljs-string">&#x27;95031&#x27;</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s_class;</code></pre></div><ul><li>æŸ¥è¯¢å­˜åœ¨85åˆ†ä»¥ä¸Šæˆç»©çš„c_nameå’Œå¯¹åº”çš„è€å¸ˆ</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t_name, c_name <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">AS</span> c, teacher <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-number">85</span>) <span class="hljs-keyword">AND</span> c.t_no <span class="hljs-operator">=</span> t.t_no;</code></pre></div><ul><li>æŸ¥å‡ºæ‰€æœ‰â€™è®¡ç®—æœºç³»â€™ æ•™å¸ˆæ‰€æ•™è¯¾ç¨‹çš„æ•™å¸ˆä¿¡æ¯ã€è¯¾ç¨‹ä¿¡æ¯åŠå­¦ç”Ÿä¿¡æ¯</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">AS</span> t, course <span class="hljs-keyword">AS</span> c, student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">AND</span> c.t_no <span class="hljs-operator">=</span> t.t_no <span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> c.c_no <span class="hljs-keyword">AND</span> t.t_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;è®¡ç®—æœºç³»&#x27;</span>);</code></pre></div><ul><li>æŸ¥è¯¢â€™è®¡ç®—æœºç³»â€™ä¸â€™ç”µå­å·¥ç¨‹ç³»â€™ ä¸åŒèŒç§°çš„æ•™å¸ˆçš„nameå’Œrof</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;è®¡ç®—æœºç³»&#x27;</span> <span class="hljs-keyword">AND</span> t_rof <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_rof <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç”µå­å·¥ç¨‹ç³»&#x27;</span>)<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç”µå­å·¥ç¨‹ç³»&#x27;</span> <span class="hljs-keyword">AND</span> t_rof <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_rof <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;è®¡ç®—æœºç³»&#x27;</span>);</code></pre></div><ul><li>æŸ¥è¯¢é€‰ä¿®ç¼–å·ä¸ºâ€3-105â€è¯¾ç¨‹ä¸”æˆç»©<strong>è‡³å°‘</strong>é«˜äºé€‰ä¿®ç¼–å·ä¸ºâ€™3-245â€™åŒå­¦çš„c_no,s_noå’Œsc_degree,å¹¶ä¸”æŒ‰ç…§sc_degreeä»é«˜åˆ°åœ°æ¬¡åºæ’åº</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ANY</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;</code></pre></div><ul><li>æŸ¥è¯¢é€‰ä¿®ç¼–å·ä¸ºâ€3-105â€ä¸”æˆç»©é«˜äºé€‰ä¿®ç¼–å·ä¸ºâ€3-245â€è¯¾ç¨‹çš„åŒå­¦c_no.s_noå’Œsc_degree</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>)<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;</code></pre></div><ul><li>æŸ¥å‡ºå­¦ç”Ÿçš„ä¿¡æ¯,è¯¾ç¨‹åç§°,åˆ†æ•°(s_name c_name,sc_degree)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, c.c_name, sc.sc_degree <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c, score <span class="hljs-keyword">AS</span> sc<span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no<span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> sc.c_no<span class="hljs-keyword">AND</span> sc.sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>)<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;</code></pre></div><p>æ€»ç»“:</p><ul><li><p>ANY å’Œ ALL</p><ul><li>ANY:è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå°±è¡Œäº†,å¦‚;æ•°ç»„Aä¸­çš„å€¼æ¯”æ•°ç»„Bä¸­ä»»ä½•ä¸€ä¸ªéƒ½è¦å¤§,é‚£ä¹ˆåªè¦Aå’ŒBä¸­æœ€å°çš„æ¯”è¾ƒå°±è¡Œäº†</li><li>ALL:è¡¨ç¤ºæ‰€æœ‰éƒ½è¦æ¯”è¾ƒ,å¦‚:æ•°ç»„Aä¸­çš„å€¼æ¯”æ•°ç»„Bä¸­æ‰€æœ‰çš„æ•°éƒ½è¦å¤§,é‚£ä¹ˆAè¦å’ŒBä¸­æœ€å¤§çš„å€¼æ¯”è¾ƒæ‰è¡Œ</li></ul></li><li><p>æŸ¥è¯¢æ‰€æœ‰æ•™å¸ˆå’ŒåŒå­¦çš„ name ,sex, birthday</p></li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, s_sex, s_birthday <span class="hljs-keyword">FROM</span> student<span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> t_name, t_sex, t_birthday <span class="hljs-keyword">FROM</span> teacher;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰â€™å¥³â€™æ•™å¸ˆå’Œâ€™å¥³â€™å­¦ç”Ÿçš„name,sex,birthday</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, s_sex, s_birthday <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¥³&#x27;</span><span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> t_name, t_sex, t_birthday <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¥³&#x27;</span>;</code></pre></div><ul><li>æŸ¥è¯¢æˆç»©æ¯”è¯¥è¯¾ç¨‹å¹³å‡æˆç»©ä½çš„åŒå­¦çš„æˆç»©è¡¨</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> a <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">WHERE</span> a.c_no <span class="hljs-operator">=</span> b.c_no);</code></pre></div><ul><li>æŸ¥è¯¢æˆç»©æ¯”è¯¥è¯¾ç¨‹å¹³å‡æˆç»©ä½çš„åŒå­¦çš„æˆç»©è¡¨ï¼Œå¹¶æ˜¾ç¤ºå‡ºå­¦ç”Ÿname,è¯¾ç¨‹nameä»¥åŠåˆ†æ•°</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name <span class="hljs-keyword">AS</span> å­¦ç”Ÿå§“å, c.c_name <span class="hljs-keyword">AS</span> è¯¾ç¨‹å, a.sc_degree <span class="hljs-keyword">AS</span> æˆç»©  <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> a, student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">WHERE</span> a.c_no <span class="hljs-operator">=</span> b.c_no)<span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> a.s_no<span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> a.c_no;</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰ä»»è¯¾æ•™å¸ˆçš„t_name å’Œ t_depart(è¦åœ¨åˆ†æ•°è¡¨ä¸­å¯ä»¥æŸ¥å¾—åˆ°)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> score));</code></pre></div><ul><li>æŸ¥å‡ºè‡³å°‘æœ‰2åç”·ç”Ÿçš„ç­å·</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_class <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç”·&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> s_class <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(s_no) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;</code></pre></div><ul><li>æŸ¥è¯¢student è¡¨ä¸­ ä¸å§“â€ç‹â€çš„åŒå­¦çš„è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;ç‹%&#x27;</span>;</code></pre></div><ul><li>æŸ¥è¯¢student ä¸­æ¯ä¸ªå­¦ç”Ÿçš„å§“åå’Œå¹´é¾„(å½“å‰æ—¶é—´ - å‡ºç”Ÿå¹´ä»½)</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">AS</span> å§“å, (<span class="hljs-keyword">YEAR</span>(NOW())<span class="hljs-operator">-</span><span class="hljs-keyword">YEAR</span>(s_birthday)) <span class="hljs-keyword">AS</span> å¹´é¾„ <span class="hljs-keyword">FROM</span> student;</code></pre></div><ul><li>æŸ¥è¯¢studentä¸­æœ€å¤§å’Œæœ€å°çš„ s_birthdayçš„å€¼</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(s_birthday), <span class="hljs-built_in">MIN</span>(s_birthday) <span class="hljs-keyword">FROM</span> student;</code></pre></div><ul><li>ä»¥ç­çº§å·å’Œå¹´é¾„ä»å¤§åˆ°å°çš„é¡ºåºæŸ¥è¯¢studentè¡¨ä¸­çš„å…¨éƒ¨è®°å½•</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s_class <span class="hljs-keyword">DESC</span>, (<span class="hljs-keyword">YEAR</span>(NOW()) <span class="hljs-operator">-</span> <span class="hljs-keyword">YEAR</span>(s_birthday)) <span class="hljs-keyword">DESC</span>;</code></pre></div><ul><li>æŸ¥è¯¢â€ç”·â€æ•™å¸ˆ åŠå…¶æ‰€ä¸Šçš„è¯¾</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t.t_name, c.c_name <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">AS</span> t, course <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">WHERE</span> t.t_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç”·&#x27;</span>  <span class="hljs-keyword">AND</span> t.t_no <span class="hljs-operator">=</span> c.t_no;</code></pre></div><ul><li>æŸ¥è¯¢æœ€é«˜åˆ†åŒå­¦çš„s_no c_no å’Œ sc_degree;</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> s_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree  <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(sc_degree) <span class="hljs-keyword">FROM</span> score));</code></pre></div><ul><li>æŸ¥è¯¢å’Œâ€æå†›â€åŒæ€§åˆ«çš„æ‰€æœ‰åŒå­¦çš„s_name</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span>  (<span class="hljs-keyword">SELECT</span> s_sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;æå†›&#x27;</span>);</code></pre></div><ul><li>æŸ¥è¯¢å’Œâ€æå†›â€åŒæ€§åˆ«å¹¶ä¸”åŒç­çš„æ‰€æœ‰åŒå­¦çš„s_name</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span>  (<span class="hljs-keyword">SELECT</span> s_sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;æå†›&#x27;</span>)<span class="hljs-keyword">AND</span> s_class <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> s_class <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;æå†›&#x27;</span>);</code></pre></div><ul><li>æŸ¥è¯¢æ‰€æœ‰é€‰ä¿®â€™è®¡ç®—æœºå¯¼è®ºâ€™è¯¾ç¨‹çš„â€™ç”·â€™åŒå­¦çš„æˆç»©è¡¨ï¼Œå¹¶æ˜¾ç¤ºå‡ºs_name,c_name</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, c.c_name, sc.sc_degree <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc, course <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> sc.c_no <span class="hljs-keyword">AND</span> c.c_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;è®¡ç®—æœºå¯¼è®º&#x27;</span><span class="hljs-keyword">AND</span> s.s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç”·&#x27;</span>;</code></pre></div><h2 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h2><h4 id="æ’å…¥æ“ä½œ"><a href="#æ’å…¥æ“ä½œ" class="headerlink" title="æ’å…¥æ“ä½œ"></a>æ’å…¥æ“ä½œ</h4><p><strong>æ–¹å¼ä¸€</strong></p><blockquote><p>INSERT INTO table<br>VALUES (â€˜â€™, â€˜â€™â€¦); </p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1.</span>æ’å…¥çš„å€¼çš„ç±»å‹è¦ä¸åˆ—çš„ç±»å‹ä¸€è‡´æˆ–å…¼å®¹<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">13</span>,<span class="hljs-string">&#x27;å”è‰ºæ˜•&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1990-4-23&#x27;</span>,<span class="hljs-string">&#x27;1898888888&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">2</span>);#<span class="hljs-number">2.</span>ä¸å¯ä»¥ä¸º<span class="hljs-keyword">null</span>çš„åˆ—å¿…é¡»æ’å…¥å€¼ã€‚å¯ä»¥ä¸º<span class="hljs-keyword">null</span>çš„åˆ—å¦‚ä½•æ’å…¥å€¼ï¼Ÿ#æ–¹å¼ä¸€ï¼š<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">13</span>,<span class="hljs-string">&#x27;å”è‰ºæ˜•&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1990-4-23&#x27;</span>,<span class="hljs-string">&#x27;1898888888&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">2</span>);#æ–¹å¼äºŒï¼š<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(id,NAME,sex,phone)<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;å¨œæ‰&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1388888888&#x27;</span>);#<span class="hljs-number">4.</span>åˆ—æ•°å’Œå€¼çš„ä¸ªæ•°å¿…é¡»ä¸€è‡´<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(NAME,sex,id,phone)<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å…³æ™“å½¤&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;110&#x27;</span>);#<span class="hljs-number">5.</span>å¯ä»¥çœç•¥åˆ—åï¼Œé»˜è®¤æ‰€æœ‰åˆ—ï¼Œè€Œä¸”åˆ—çš„é¡ºåºå’Œè¡¨ä¸­åˆ—çš„é¡ºåºä¸€è‡´<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">18</span>,<span class="hljs-string">&#x27;å¼ é£&#x27;</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;119&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>);</code></pre></div><p><strong>æ–¹å¼äºŒ</strong></p><blockquote><p>insert into è¡¨å<br>set åˆ—å=å€¼,åˆ—å=å€¼,â€¦</p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty<span class="hljs-keyword">SET</span> id<span class="hljs-operator">=</span><span class="hljs-number">19</span>,NAME<span class="hljs-operator">=</span><span class="hljs-string">&#x27;åˆ˜æ¶›&#x27;</span>,phone<span class="hljs-operator">=</span><span class="hljs-string">&#x27;999&#x27;</span>;</code></pre></div><p><strong>ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1</span>ã€æ–¹å¼ä¸€æ”¯æŒæ’å…¥å¤šè¡Œ,æ–¹å¼äºŒä¸æ”¯æŒ<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">23</span>,<span class="hljs-string">&#x27;å”è‰ºæ˜•1&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1990-4-23&#x27;</span>,<span class="hljs-string">&#x27;1898888888&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">2</span>),(<span class="hljs-number">24</span>,<span class="hljs-string">&#x27;å”è‰ºæ˜•2&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1990-4-23&#x27;</span>,<span class="hljs-string">&#x27;1898888888&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">2</span>),(<span class="hljs-number">25</span>,<span class="hljs-string">&#x27;å”è‰ºæ˜•3&#x27;</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>,<span class="hljs-string">&#x27;1990-4-23&#x27;</span>,<span class="hljs-string">&#x27;1898888888&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">2</span>);#<span class="hljs-number">2</span>ã€æ–¹å¼ä¸€æ”¯æŒå­æŸ¥è¯¢ï¼Œæ–¹å¼äºŒä¸æ”¯æŒ<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(id,NAME,phone)<span class="hljs-keyword">SELECT</span> <span class="hljs-number">26</span>,<span class="hljs-string">&#x27;å®‹èŒœ&#x27;</span>,<span class="hljs-string">&#x27;11809866&#x27;</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> beauty(id,NAME,phone)<span class="hljs-keyword">SELECT</span> id,boyname,<span class="hljs-string">&#x27;1234567&#x27;</span><span class="hljs-keyword">FROM</span> boys <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">&lt;</span><span class="hljs-number">3</span>;</code></pre></div><p><strong>ç»ƒä¹ </strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ–¹å¼ä¸€ï¼š<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> my_employees<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;patel&#x27;</span>,<span class="hljs-string">&#x27;Ralph&#x27;</span>,<span class="hljs-string">&#x27;Rpatel&#x27;</span>,<span class="hljs-number">895</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;Dancs&#x27;</span>,<span class="hljs-string">&#x27;Betty&#x27;</span>,<span class="hljs-string">&#x27;Bdancs&#x27;</span>,<span class="hljs-number">860</span>),(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;Biri&#x27;</span>,<span class="hljs-string">&#x27;Ben&#x27;</span>,<span class="hljs-string">&#x27;Bbiri&#x27;</span>,<span class="hljs-number">1100</span>),(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;Newman&#x27;</span>,<span class="hljs-string">&#x27;Chad&#x27;</span>,<span class="hljs-string">&#x27;Cnewman&#x27;</span>,<span class="hljs-number">750</span>),(<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;Ropeburn&#x27;</span>,<span class="hljs-string">&#x27;Audrey&#x27;</span>,<span class="hljs-string">&#x27;Aropebur&#x27;</span>,<span class="hljs-number">1550</span>);<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> my_employees;#æ–¹å¼äºŒï¼š<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> my_employees<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;patel&#x27;</span>,<span class="hljs-string">&#x27;Ralph&#x27;</span>,<span class="hljs-string">&#x27;Rpatel&#x27;</span>,<span class="hljs-number">895</span> <span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span>,<span class="hljs-string">&#x27;Dancs&#x27;</span>,<span class="hljs-string">&#x27;Betty&#x27;</span>,<span class="hljs-string">&#x27;Bdancs&#x27;</span>,<span class="hljs-number">860</span> <span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span>,<span class="hljs-string">&#x27;Biri&#x27;</span>,<span class="hljs-string">&#x27;Ben&#x27;</span>,<span class="hljs-string">&#x27;Bbiri&#x27;</span>,<span class="hljs-number">1100</span> <span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>,<span class="hljs-string">&#x27;Newman&#x27;</span>,<span class="hljs-string">&#x27;Chad&#x27;</span>,<span class="hljs-string">&#x27;Cnewman&#x27;</span>,<span class="hljs-number">750</span> <span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span>,<span class="hljs-string">&#x27;Ropeburn&#x27;</span>,<span class="hljs-string">&#x27;Audrey&#x27;</span>,<span class="hljs-string">&#x27;Aropebur&#x27;</span>,<span class="hljs-number">1550</span>;</code></pre></div><h4 id="åˆ é™¤æ“ä½œ"><a href="#åˆ é™¤æ“ä½œ" class="headerlink" title="åˆ é™¤æ“ä½œ"></a><strong>åˆ é™¤æ“ä½œ</strong></h4><p><strong>æ–¹å¼ä¸€ï¼šDELETE</strong></p><p><strong>å•è¡¨çš„åˆ é™¤â˜…</strong></p><blockquote><p>DELETE FROM table<br>WHERE cow = â€˜â€™; </p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šåˆ é™¤æ‰‹æœºå·ä»¥<span class="hljs-number">9</span>ç»“å°¾çš„å¥³ç¥ä¿¡æ¯<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> beauty <span class="hljs-keyword">WHERE</span> phone <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%9&#x27;</span>;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> beauty;</code></pre></div><p><strong>å¤šè¡¨çš„åˆ é™¤</strong></p><blockquote><p>#sql92è¯­æ³•ï¼š<br>delete è¡¨1çš„åˆ«å,è¡¨2çš„åˆ«å<br>from è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>where è¿æ¥æ¡ä»¶<br>and ç­›é€‰æ¡ä»¶;</p><p>#sql99è¯­æ³•ï¼š</p><p>delete è¡¨1çš„åˆ«å,è¡¨2çš„åˆ«å<br>from è¡¨1 åˆ«å<br>inner|left|right join è¡¨2 åˆ«å on è¿æ¥æ¡ä»¶<br>where ç­›é€‰æ¡ä»¶;</p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šåˆ é™¤å¼ æ— å¿Œçš„å¥³æœ‹å‹çš„ä¿¡æ¯<span class="hljs-keyword">DELETE</span> b<span class="hljs-keyword">FROM</span> beauty b<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> boys bo <span class="hljs-keyword">ON</span> b.`boyfriend_id` <span class="hljs-operator">=</span> bo.`id`<span class="hljs-keyword">WHERE</span> bo.`boyName`<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>;#æ¡ˆä¾‹ï¼šåˆ é™¤é»„æ™“æ˜çš„ä¿¡æ¯ä»¥åŠä»–å¥³æœ‹å‹çš„ä¿¡æ¯<span class="hljs-keyword">DELETE</span> b,bo<span class="hljs-keyword">FROM</span> beauty b<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> boys bo <span class="hljs-keyword">ON</span> b.`boyfriend_id`<span class="hljs-operator">=</span>bo.`id`<span class="hljs-keyword">WHERE</span> bo.`boyName`<span class="hljs-operator">=</span><span class="hljs-string">&#x27;é»„æ™“æ˜&#x27;</span>;</code></pre></div><p><strong>æ–¹å¼äºŒï¼štruncateè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šå°†é­…åŠ›å€¼<span class="hljs-operator">&gt;</span><span class="hljs-number">100</span>çš„ç”·ç¥ä¿¡æ¯åˆ é™¤<span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> boys ;</code></pre></div><p><strong>æ¯”è¾ƒ</strong></p><ul><li>delete å¯ä»¥åŠ where æ¡ä»¶ï¼Œtruncateä¸èƒ½åŠ </li><li>truncateåˆ é™¤ï¼Œæ•ˆç‡é«˜ä¸€ä¸¢ä¸¢</li><li>å‡å¦‚è¦åˆ é™¤çš„è¡¨ä¸­æœ‰è‡ªå¢é•¿åˆ—ï¼Œå¦‚æœç”¨deleteåˆ é™¤åï¼Œå†æ’å…¥æ•°æ®ï¼Œè‡ªå¢é•¿åˆ—çš„å€¼ä»æ–­ç‚¹å¼€å§‹ï¼Œè€Œtruncateåˆ é™¤åï¼Œå†æ’å…¥æ•°æ®ï¼Œè‡ªå¢é•¿åˆ—çš„å€¼ä»1å¼€å§‹ã€‚</li><li>truncateåˆ é™¤æ²¡æœ‰è¿”å›å€¼ï¼Œdeleteåˆ é™¤æœ‰è¿”å›å€¼</li><li>truncateåˆ é™¤ä¸èƒ½å›æ»šï¼Œdeleteåˆ é™¤å¯ä»¥å›æ»š.</li></ul><h4 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a><strong>ä¿®æ”¹æ•°æ®</strong></h4><p><strong>ä¿®æ”¹å•è¡¨çš„è®°å½•â˜…</strong></p><blockquote><p>update è¡¨å<br>set åˆ—=æ–°å€¼,åˆ—=æ–°å€¼,â€¦<br>where ç­›é€‰æ¡ä»¶;</p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šä¿®æ”¹beautyè¡¨ä¸­å§“å”çš„å¥³ç¥çš„ç”µè¯ä¸º<span class="hljs-number">13899888899</span>UPDATE beauty <span class="hljs-keyword">SET</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;13899888899&#x27;</span><span class="hljs-keyword">WHERE</span> NAME <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;å”%&#x27;</span>;#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šä¿®æ”¹boysè¡¨ä¸­idå¥½ä¸º<span class="hljs-number">2</span>çš„åç§°ä¸ºå¼ é£ï¼Œé­…åŠ›å€¼ <span class="hljs-number">10</span>UPDATE boys <span class="hljs-keyword">SET</span> boyname<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¼ é£&#x27;</span>,usercp<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">2</span>;</code></pre></div><p><strong>ä¿®æ”¹å¤šè¡¨çš„è®°å½•</strong></p><blockquote><p>#sql92è¯­æ³•ï¼š<br>update è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>set åˆ—=å€¼,â€¦<br>where è¿æ¥æ¡ä»¶<br>and ç­›é€‰æ¡ä»¶;</p><p>#sql99è¯­æ³•ï¼š<br>update è¡¨1 åˆ«å<br>inner|left|right join è¡¨2 åˆ«å<br>on è¿æ¥æ¡ä»¶<br>set åˆ—=å€¼,â€¦<br>where ç­›é€‰æ¡ä»¶;</p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ <span class="hljs-number">1</span>ï¼šä¿®æ”¹å¼ æ— å¿Œçš„å¥³æœ‹å‹çš„æ‰‹æœºå·ä¸º<span class="hljs-number">114</span>UPDATE boys bo<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> beauty b <span class="hljs-keyword">ON</span> bo.`id`<span class="hljs-operator">=</span>b.`boyfriend_id`<span class="hljs-keyword">SET</span> b.`phone`<span class="hljs-operator">=</span><span class="hljs-string">&#x27;119&#x27;</span>,bo.`userCP`<span class="hljs-operator">=</span><span class="hljs-number">1000</span><span class="hljs-keyword">WHERE</span> bo.`boyName`<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>;#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šä¿®æ”¹æ²¡æœ‰ç”·æœ‹å‹çš„å¥³ç¥çš„ç”·æœ‹å‹ç¼–å·éƒ½ä¸º<span class="hljs-number">2</span>å·UPDATE boys bo<span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> beauty b <span class="hljs-keyword">ON</span> bo.`id`<span class="hljs-operator">=</span>b.`boyfriend_id`<span class="hljs-keyword">SET</span> b.`boyfriend_id`<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-keyword">WHERE</span> bo.`id` <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> boys;</code></pre></div><h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><h4 id="ç³»ç»Ÿå˜é‡"><a href="#ç³»ç»Ÿå˜é‡" class="headerlink" title="ç³»ç»Ÿå˜é‡"></a>ç³»ç»Ÿå˜é‡</h4><blockquote><p>è¯´æ˜ï¼šå˜é‡ç”±ç³»ç»Ÿå®šä¹‰ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰ï¼Œå±äºæœåŠ¡å™¨å±‚é¢<br>æ³¨æ„ï¼šå…¨å±€å˜é‡éœ€è¦æ·»åŠ globalå…³é”®å­—ï¼Œä¼šè¯å˜é‡éœ€è¦æ·»åŠ sessionå…³é”®å­—ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šè¯çº§åˆ«<br>ä½¿ç”¨æ­¥éª¤ï¼š<br>1ã€æŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿå˜é‡<br>show global|ã€sessionã€‘variables;<br>2ã€æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡<br>show global|ã€sessionã€‘ variables like â€˜%char%â€™;<br>3ã€æŸ¥çœ‹æŒ‡å®šçš„ç³»ç»Ÿå˜é‡çš„å€¼<br>select @@global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å;<br>4ã€ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼<br>æ–¹å¼ä¸€ï¼š<br>set global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å=å€¼;<br>æ–¹å¼äºŒï¼š<br>set @@global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å=å€¼;</p></blockquote><p><strong>å…¨å±€å˜é‡</strong></p><p>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºæ‰€æœ‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆï¼Œä½†ä¸èƒ½è·¨é‡å¯</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#â‘ æŸ¥çœ‹æ‰€æœ‰å…¨å±€å˜é‡<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES;#â‘¡æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%char%&#x27;</span>;#â‘¢æŸ¥çœ‹æŒ‡å®šçš„ç³»ç»Ÿå˜é‡çš„å€¼<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.autocommit;#â‘£ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼<span class="hljs-keyword">SET</span> @<span class="hljs-variable">@global</span>.autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;</code></pre></div><p><strong>ä¼šè¯å˜é‡</strong></p><p>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºå½“å‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆ</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#â‘ æŸ¥çœ‹æ‰€æœ‰ä¼šè¯å˜é‡<span class="hljs-keyword">SHOW</span> SESSION VARIABLES;#â‘¡æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ä¼šè¯å˜é‡<span class="hljs-keyword">SHOW</span> SESSION VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%char%&#x27;</span>;#â‘¢æŸ¥çœ‹æŒ‡å®šçš„ä¼šè¯å˜é‡çš„å€¼<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@autocommit</span>;<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@session</span>.tx_isolation;#â‘£ä¸ºæŸä¸ªä¼šè¯å˜é‡èµ‹å€¼<span class="hljs-keyword">SET</span> @<span class="hljs-variable">@session</span>.tx_isolation<span class="hljs-operator">=</span><span class="hljs-string">&#x27;read-uncommitted&#x27;</span>;<span class="hljs-keyword">SET</span> SESSION tx_isolation<span class="hljs-operator">=</span><span class="hljs-string">&#x27;read-committed&#x27;</span>;</code></pre></div><h4 id="è‡ªå®šä¹‰å˜é‡"><a href="#è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è‡ªå®šä¹‰å˜é‡"></a>è‡ªå®šä¹‰å˜é‡</h4><blockquote><p>è¯´æ˜ï¼šå˜é‡ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæä¾›çš„<br>ä½¿ç”¨æ­¥éª¤ï¼š<br>1ã€å£°æ˜<br>2ã€èµ‹å€¼<br>3ã€ä½¿ç”¨ï¼ˆæŸ¥çœ‹ã€æ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰</p></blockquote><p><strong>ç”¨æˆ·å˜é‡</strong></p><p>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºå½“å‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆï¼Œä½œç”¨åŸŸåŒäºä¼šè¯å˜é‡</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#â‘ å£°æ˜å¹¶åˆå§‹åŒ–,<span class="hljs-operator">=</span>æˆ–:<span class="hljs-operator">=</span><span class="hljs-keyword">SET</span> @å˜é‡å<span class="hljs-operator">=</span>å€¼;<span class="hljs-keyword">SET</span> @å˜é‡å:<span class="hljs-operator">=</span>å€¼;<span class="hljs-keyword">SELECT</span> @å˜é‡å:<span class="hljs-operator">=</span>å€¼;#â‘¡èµ‹å€¼ï¼ˆæ›´æ–°å˜é‡çš„å€¼ï¼‰#æ–¹å¼ä¸€ï¼š   <span class="hljs-keyword">SET</span> @å˜é‡å<span class="hljs-operator">=</span>å€¼;   <span class="hljs-keyword">SET</span> @å˜é‡å:<span class="hljs-operator">=</span>å€¼;   <span class="hljs-keyword">SELECT</span> @å˜é‡å:<span class="hljs-operator">=</span>å€¼;#æ–¹å¼äºŒï¼š   <span class="hljs-keyword">SELECT</span> å­—æ®µ <span class="hljs-keyword">INTO</span> @å˜é‡å   <span class="hljs-keyword">FROM</span> è¡¨;#â‘¢ä½¿ç”¨ï¼ˆæŸ¥çœ‹å˜é‡çš„å€¼ï¼‰<span class="hljs-keyword">SELECT</span> @å˜é‡å;</code></pre></div><p><strong>å±€éƒ¨å˜é‡</strong></p><p>ä½œç”¨åŸŸï¼šä»…ä»…åœ¨å®šä¹‰å®ƒçš„begin endå—ä¸­æœ‰æ•ˆ<br>åº”ç”¨åœ¨ begin endä¸­çš„ç¬¬ä¸€å¥è¯</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#â‘ å£°æ˜<span class="hljs-keyword">DECLARE</span> å˜é‡å ç±»å‹;<span class="hljs-keyword">DECLARE</span> å˜é‡å ç±»å‹ ã€<span class="hljs-keyword">DEFAULT</span> å€¼ã€‘;#â‘¡èµ‹å€¼ï¼ˆæ›´æ–°å˜é‡çš„å€¼ï¼‰#æ–¹å¼ä¸€ï¼š   <span class="hljs-keyword">SET</span> å±€éƒ¨å˜é‡å<span class="hljs-operator">=</span>å€¼;   <span class="hljs-keyword">SET</span> å±€éƒ¨å˜é‡å:<span class="hljs-operator">=</span>å€¼;   <span class="hljs-keyword">SELECT</span> @å±€éƒ¨å˜é‡å:<span class="hljs-operator">=</span>å€¼;#æ–¹å¼äºŒï¼š   <span class="hljs-keyword">SELECT</span> å­—æ®µ <span class="hljs-keyword">INTO</span> å…·å¤‡å˜é‡å   <span class="hljs-keyword">FROM</span> è¡¨;   #â‘¢ä½¿ç”¨ï¼ˆæŸ¥çœ‹å˜é‡çš„å€¼ï¼‰<span class="hljs-keyword">SELECT</span> å±€éƒ¨å˜é‡å;</code></pre></div><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šå£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œæ±‚å’Œå¹¶æ‰“å°#ç”¨æˆ·å˜é‡<span class="hljs-keyword">SET</span> <span class="hljs-variable">@m</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">SET</span> <span class="hljs-variable">@n</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">SET</span> <span class="hljs-variable">@sum</span><span class="hljs-operator">=</span><span class="hljs-variable">@m</span><span class="hljs-operator">+</span><span class="hljs-variable">@n</span>;<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@sum</span>;#å±€éƒ¨å˜é‡<span class="hljs-keyword">DECLARE</span> m <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">DECLARE</span> n <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">DECLARE</span> SUM <span class="hljs-type">INT</span>;<span class="hljs-keyword">SET</span> SUM<span class="hljs-operator">=</span>m<span class="hljs-operator">+</span>n;<span class="hljs-keyword">SELECT</span> SUM;</code></pre></div><blockquote><div class="hljs code-wrapper"><pre><code class="hljs ada">       ä½œç”¨åŸŸ          å®šä¹‰ä½ç½®      è¯­æ³•ç”¨æˆ·å˜é‡   å½“å‰ä¼šè¯      ä¼šè¯çš„ä»»ä½•åœ°æ–¹       åŠ @ç¬¦å·ï¼Œä¸ç”¨æŒ‡å®šç±»å‹å±€éƒ¨å˜é‡   å®šä¹‰å®ƒçš„<span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">END</span>ä¸­     <span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">END</span>çš„ç¬¬ä¸€å¥è¯ ä¸€èˆ¬ä¸ç”¨åŠ @,éœ€è¦æŒ‡å®šç±»å‹</code></pre></div></blockquote><h2 id="å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h2><p>æé«˜ä»£ç çš„é‡ç”¨æ€§ï¼Œç®€åŒ–æ“ä½œ</p><h4 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h4><blockquote><p>å«ä¹‰ï¼šä¸€ç»„é¢„å…ˆç¼–è¯‘å¥½çš„SQLè¯­å¥çš„é›†åˆï¼Œç†è§£æˆæ‰¹å¤„ç†è¯­å¥<br>1ã€æé«˜ä»£ç çš„é‡ç”¨æ€§<br>2ã€ç®€åŒ–æ“ä½œ<br>3ã€å‡å°‘äº†ç¼–è¯‘æ¬¡æ•°å¹¶ä¸”å‡å°‘äº†å’Œæ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡</p></blockquote><p><strong>è¯­æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> å­˜å‚¨è¿‡ç¨‹å(å‚æ•°åˆ—è¡¨)<span class="hljs-keyword">BEGIN</span>   å­˜å‚¨è¿‡ç¨‹ä½“ï¼ˆä¸€ç»„åˆæ³•çš„<span class="hljs-keyword">SQL</span>è¯­å¥ï¼‰<span class="hljs-keyword">END</span></code></pre></div><p><strong>å‚æ•°åˆ—è¡¨åŒ…å«ä¸‰éƒ¨åˆ†</strong></p><ul><li>å‚æ•°æ¨¡å¼  </li><li>å‚æ•°å  </li><li>å‚æ•°ç±»å‹</li></ul><p>ä¾‹å¦‚ï¼š<code>in stuname varchar(20)</code></p><p><strong>å‚æ•°æ¨¡å¼ï¼š</strong></p><ul><li>inï¼šè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°éœ€è¦è°ƒç”¨æ–¹ä¼ å…¥å€¼</li><li>outï¼šè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼</li><li>inoutï¼šè¯¥å‚æ•°æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥åˆå¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°æ—¢éœ€è¦ä¼ å…¥å€¼ï¼Œåˆå¯ä»¥è¿”å›å€¼</li></ul><p><strong>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p><ul><li>å¦‚æœå­˜å‚¨è¿‡ç¨‹ä½“ä»…ä»…åªæœ‰ä¸€å¥è¯ï¼Œbegin endå¯ä»¥çœç•¥</li><li>å­˜å‚¨è¿‡ç¨‹ä½“ä¸­çš„æ¯æ¡sqlè¯­å¥çš„ç»“å°¾è¦æ±‚å¿…é¡»åŠ åˆ†å·</li><li>å­˜å‚¨è¿‡ç¨‹çš„ç»“å°¾å¯ä»¥ä½¿ç”¨ delimiter é‡æ–°è®¾ç½®<br>è¯­æ³•ï¼š<br>delimiter ç»“æŸæ ‡è®°<br>æ¡ˆä¾‹ï¼š<br>delimiter $</li></ul><h4 id="è°ƒç”¨è¿‡ç¨‹"><a href="#è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨è¿‡ç¨‹"></a>è°ƒç”¨è¿‡ç¨‹</h4><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CALL</span> å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨);</code></pre></div><p><strong>ç©ºå‚åˆ—è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæ’å…¥åˆ°adminè¡¨ä¸­äº”æ¡è®°å½•DELIMITER $<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp1()<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> admin(username,`password`)    <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;john1&#x27;</span>,<span class="hljs-string">&#x27;0000&#x27;</span>),(<span class="hljs-string">&#x27;lily&#x27;</span>,<span class="hljs-string">&#x27;0000&#x27;</span>),(<span class="hljs-string">&#x27;rose&#x27;</span>,<span class="hljs-string">&#x27;0000&#x27;</span>),(<span class="hljs-string">&#x27;jack&#x27;</span>,<span class="hljs-string">&#x27;0000&#x27;</span>),(<span class="hljs-string">&#x27;tom&#x27;</span>,<span class="hljs-string">&#x27;0000&#x27;</span>);<span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> myp1()$</code></pre></div><p><strong>åˆ›å»ºå¸¦inæ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹å®ç° æ ¹æ®å¥³ç¥åï¼ŒæŸ¥è¯¢å¯¹åº”çš„ç”·ç¥ä¿¡æ¯DELIMITER $<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp2(<span class="hljs-keyword">IN</span> beautyName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>))<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">SELECT</span> bo.<span class="hljs-operator">*</span>   <span class="hljs-keyword">FROM</span> boys bo   <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> beauty b <span class="hljs-keyword">ON</span> bo.id <span class="hljs-operator">=</span> b.boyfriend_id   <span class="hljs-keyword">WHERE</span> b.name<span class="hljs-operator">=</span>beautyName;   <span class="hljs-keyword">END</span> $#è°ƒç”¨<span class="hljs-keyword">CALL</span> myp2(<span class="hljs-string">&#x27;æŸ³å²©&#x27;</span>)$#æ¡ˆä¾‹<span class="hljs-number">2</span> ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹å®ç°ï¼Œç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸ<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp4(<span class="hljs-keyword">IN</span> username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<span class="hljs-keyword">IN</span> PASSWORD <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>))<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> <span class="hljs-keyword">result</span> <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;#å£°æ˜å¹¶åˆå§‹åŒ–<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">result</span>#èµ‹å€¼<span class="hljs-keyword">FROM</span> admin<span class="hljs-keyword">WHERE</span> admin.username <span class="hljs-operator">=</span> username<span class="hljs-keyword">AND</span> admin.password <span class="hljs-operator">=</span> PASSWORD;<span class="hljs-keyword">SELECT</span> IF(<span class="hljs-keyword">result</span><span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>,<span class="hljs-string">&#x27;æˆåŠŸ&#x27;</span>,<span class="hljs-string">&#x27;å¤±è´¥&#x27;</span>);#ä½¿ç”¨<span class="hljs-keyword">END</span> $#è°ƒç”¨<span class="hljs-keyword">CALL</span> myp3(<span class="hljs-string">&#x27;å¼ é£&#x27;</span>,<span class="hljs-string">&#x27;8888&#x27;</span>)$</code></pre></div><p><strong>åˆ›å»ºoutæ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šæ ¹æ®è¾“å…¥çš„å¥³ç¥åï¼Œè¿”å›å¯¹åº”çš„ç”·ç¥å<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp6(<span class="hljs-keyword">IN</span> beautyName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<span class="hljs-keyword">OUT</span> boyName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>))<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">SELECT</span> bo.boyname <span class="hljs-keyword">INTO</span> boyname   <span class="hljs-keyword">FROM</span> boys bo   <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span>   beauty b <span class="hljs-keyword">ON</span> b.boyfriend_id <span class="hljs-operator">=</span> bo.id   <span class="hljs-keyword">WHERE</span> b.name<span class="hljs-operator">=</span>beautyName ;   <span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> myp6(<span class="hljs-string">&#x27;Luci&#x27;</span>,<span class="hljs-variable">@bname</span>)$<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@bname</span>$#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šæ ¹æ®è¾“å…¥çš„å¥³ç¥åï¼Œè¿”å›å¯¹åº”çš„ç”·ç¥åå’Œé­…åŠ›å€¼<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp7(<span class="hljs-keyword">IN</span> beautyName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<span class="hljs-keyword">OUT</span> boyName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<span class="hljs-keyword">OUT</span> usercp <span class="hljs-type">INT</span>) <span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">SELECT</span> boys.boyname ,boys.usercp <span class="hljs-keyword">INTO</span> boyname,usercp<span class="hljs-keyword">FROM</span> boys <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span>beauty b <span class="hljs-keyword">ON</span> b.boyfriend_id <span class="hljs-operator">=</span> boys.id<span class="hljs-keyword">WHERE</span> b.name<span class="hljs-operator">=</span>beautyName ;<span class="hljs-keyword">END</span> $#è°ƒç”¨<span class="hljs-keyword">CALL</span> myp7(<span class="hljs-string">&#x27;å°æ˜­&#x27;</span>,<span class="hljs-variable">@name</span>,<span class="hljs-variable">@cp</span>)$<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@name</span>,<span class="hljs-variable">@cp</span>$</code></pre></div><p><strong>åˆ›å»ºå¸¦inoutæ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šä¼ å…¥aå’Œbä¸¤ä¸ªå€¼ï¼Œæœ€ç»ˆaå’Œbéƒ½ç¿»å€å¹¶è¿”å›<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> myp8(<span class="hljs-keyword">INOUT</span> a <span class="hljs-type">INT</span> ,<span class="hljs-keyword">INOUT</span> b <span class="hljs-type">INT</span>)<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">SET</span> a<span class="hljs-operator">=</span>a<span class="hljs-operator">*</span><span class="hljs-number">2</span>;   <span class="hljs-keyword">SET</span> b<span class="hljs-operator">=</span>b<span class="hljs-operator">*</span><span class="hljs-number">2</span>;<span class="hljs-keyword">END</span> $#è°ƒç”¨<span class="hljs-keyword">SET</span> <span class="hljs-variable">@m</span><span class="hljs-operator">=</span><span class="hljs-number">10</span>$<span class="hljs-keyword">SET</span> <span class="hljs-variable">@n</span><span class="hljs-operator">=</span><span class="hljs-number">20</span>$<span class="hljs-keyword">CALL</span> myp8(<span class="hljs-variable">@m</span>,<span class="hljs-variable">@n</span>)$<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@m</span>,<span class="hljs-variable">@n</span>$</code></pre></div><p><strong>åˆ é™¤å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> p1;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> p2,p3;#ä¸æ”¯æŒåˆ é™¤å¤šä¸ª</code></pre></div><p><strong>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span>  myp2;</code></pre></div><h4 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h4><blockquote><p>å«ä¹‰ï¼šä¸€ç»„é¢„å…ˆç¼–è¯‘å¥½çš„SQLè¯­å¥çš„é›†åˆï¼Œç†è§£æˆæ‰¹å¤„ç†è¯­å¥<br>1ã€æé«˜ä»£ç çš„é‡ç”¨æ€§<br>2ã€ç®€åŒ–æ“ä½œ<br>3ã€å‡å°‘äº†ç¼–è¯‘æ¬¡æ•°å¹¶ä¸”å‡å°‘äº†å’Œæ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡</p></blockquote><p><strong>åŒºåˆ«</strong></p><p>å­˜å‚¨è¿‡ç¨‹ï¼šå¯ä»¥æœ‰0ä¸ªè¿”å›ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªè¿”å›ï¼Œé€‚åˆåšæ‰¹é‡æ’å…¥ã€æ‰¹é‡æ›´æ–°<br>å‡½æ•°ï¼šæœ‰ä¸”ä»…æœ‰1 ä¸ªè¿”å›ï¼Œé€‚åˆåšå¤„ç†æ•°æ®åè¿”å›ä¸€ä¸ªç»“æœ</p><p><strong>è¯­æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> å‡½æ•°å(å‚æ•°åˆ—è¡¨) <span class="hljs-keyword">RETURNS</span> è¿”å›ç±»å‹<span class="hljs-keyword">BEGIN</span>   å‡½æ•°ä½“<span class="hljs-keyword">END</span></code></pre></div><p><strong>æ³¨æ„</strong></p><blockquote><p>1.å‚æ•°åˆ—è¡¨ åŒ…å«ä¸¤éƒ¨åˆ†ï¼š å‚æ•°å å‚æ•°ç±»å‹</p><p>2.å‡½æ•°ä½“ï¼šè‚¯å®šä¼šæœ‰returnè¯­å¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠ¥é”™ å¦‚æœreturnè¯­å¥æ²¡æœ‰æ”¾åœ¨å‡½æ•°ä½“çš„æœ€åä¹Ÿä¸æŠ¥é”™ï¼Œä½†ä¸å»ºè®®</p><p>3.å‡½æ•°ä½“ä¸­ä»…æœ‰ä¸€å¥è¯ï¼Œåˆ™å¯ä»¥çœç•¥begin end 4.ä½¿ç”¨ delimiterè¯­å¥è®¾ç½®ç»“æŸæ ‡è®°</p></blockquote><h4 id="è°ƒç”¨å‡½æ•°"><a href="#è°ƒç”¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å‡½æ•°"></a>è°ƒç”¨å‡½æ•°</h4><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å‡½æ•°å(å‚æ•°åˆ—è¡¨)</code></pre></div><p><strong>æ— å‚æœ‰è¿”å›</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šè¿”å›å…¬å¸çš„å‘˜å·¥ä¸ªæ•°<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> myf1() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span><span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> c <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;#å®šä¹‰å±€éƒ¨å˜é‡   <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> c#èµ‹å€¼   <span class="hljs-keyword">FROM</span> employees;   <span class="hljs-keyword">RETURN</span> c;   <span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> myf1()$</code></pre></div><p><strong>æœ‰å‚æœ‰è¿”å›</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šæ ¹æ®å‘˜å·¥åï¼Œè¿”å›å®ƒçš„å·¥èµ„<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> myf2(empName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)) <span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">DOUBLE</span><span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">SET</span> <span class="hljs-variable">@sal</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>;#å®šä¹‰ç”¨æˆ·å˜é‡    <span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@sal</span>   #èµ‹å€¼   <span class="hljs-keyword">FROM</span> employees   <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> empName;      <span class="hljs-keyword">RETURN</span> <span class="hljs-variable">@sal</span>;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> myf2(<span class="hljs-string">&#x27;k_ing&#x27;</span>) $#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šæ ¹æ®éƒ¨é—¨åï¼Œè¿”å›è¯¥éƒ¨é—¨çš„å¹³å‡å·¥èµ„<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> myf3(deptName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)) <span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">DOUBLE</span><span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> sal <span class="hljs-keyword">DOUBLE</span> ;   <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">INTO</span> sal   <span class="hljs-keyword">FROM</span> employees e   <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id   <span class="hljs-keyword">WHERE</span> d.department_name<span class="hljs-operator">=</span>deptName;   <span class="hljs-keyword">RETURN</span> sal;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> myf3(<span class="hljs-string">&#x27;IT&#x27;</span>)$</code></pre></div><p><strong>æŸ¥çœ‹å‡½æ•°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> myf3;</code></pre></div><p><strong>åˆ é™¤å‡½æ•°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FUNCTION</span> myf3;</code></pre></div><p><strong>æ¡ˆä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#ä¸€ã€åˆ›å»ºå‡½æ•°ï¼Œå®ç°ä¼ å…¥ä¸¤ä¸ª<span class="hljs-type">float</span>ï¼Œè¿”å›äºŒè€…ä¹‹å’Œ<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test_fun1(num1 <span class="hljs-type">FLOAT</span>,num2 <span class="hljs-type">FLOAT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">FLOAT</span><span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> SUM <span class="hljs-type">FLOAT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;   <span class="hljs-keyword">SET</span> SUM<span class="hljs-operator">=</span>num1<span class="hljs-operator">+</span>num2;   <span class="hljs-keyword">RETURN</span> SUM;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> test_fun1(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)$</code></pre></div><h2 id="æµç¨‹æ§åˆ¶ç»“æ„"><a href="#æµç¨‹æ§åˆ¶ç»“æ„" class="headerlink" title="æµç¨‹æ§åˆ¶ç»“æ„"></a>æµç¨‹æ§åˆ¶ç»“æ„</h2><h4 id="ifå‡½æ•°"><a href="#ifå‡½æ•°" class="headerlink" title="ifå‡½æ•°"></a>ifå‡½æ•°</h4><blockquote><p>è¯­æ³•ï¼šif(æ¡ä»¶,å€¼1ï¼Œå€¼2)<br>åŠŸèƒ½ï¼šå®ç°åŒåˆ†æ”¯<br>åº”ç”¨åœ¨begin endä¸­æˆ–å¤–é¢</p></blockquote><h4 id="caseå‡½æ•°"><a href="#caseå‡½æ•°" class="headerlink" title="caseå‡½æ•°"></a>caseå‡½æ•°</h4><blockquote><p>æƒ…å†µ1ï¼šç±»ä¼¼äºswitch<br>case å˜é‡æˆ–è¡¨è¾¾å¼<br>when åˆ¤æ–­çš„å€¼1 then è¿”å›çš„å€¼1æˆ–è¯­å¥;<br>when åˆ¤æ–­çš„å€¼2 then è¿”å›çš„å€¼2æˆ–è¯­å¥;<br>â€¦<br>else è¿”å›çš„å€¼næˆ–è¯­å¥;<br>end </p><p>æƒ…å†µ2ï¼š<br>case<br>when åˆ¤æ–­çš„å€¼1 then è¿”å›çš„å€¼1æˆ–è¯­å¥;<br>when åˆ¤æ–­çš„å€¼2 then è¿”å›çš„å€¼2æˆ–è¯­å¥;<br>â€¦<br>else è¿”å›çš„å€¼næˆ–è¯­å¥;<br>end </p><p>åº”ç”¨åœ¨begin end ä¸­æˆ–å¤–é¢</p><p>ps:å¦‚æœæ˜¯è¯­å¥ï¼Œåªèƒ½æ”¾åœ¨begin endä¸­</p></blockquote><h4 id="ifç»“æ„"><a href="#ifç»“æ„" class="headerlink" title="ifç»“æ„"></a>ifç»“æ„</h4><blockquote><p>if æ¡ä»¶1 then è¯­å¥1;<br>elseif æ¡ä»¶2 then è¯­å¥2;<br>â€¦.<br>else è¯­å¥n;<br>end if;<br>åŠŸèƒ½ï¼šç±»ä¼¼äºå¤šé‡if</p><p>åªèƒ½åº”ç”¨åœ¨begin end ä¸­</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹<span class="hljs-number">1</span>ï¼šåˆ›å»ºå‡½æ•°ï¼Œå®ç°ä¼ å…¥æˆç»©ï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">90</span>,è¿”å›Aï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">80</span>,è¿”å›Bï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>,è¿”å›Cï¼Œå¦åˆ™è¿”å›D<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test_if(score <span class="hljs-type">FLOAT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">CHAR</span><span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> ch <span class="hljs-type">CHAR</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;A&#x27;</span>;   IF score<span class="hljs-operator">&gt;</span><span class="hljs-number">90</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;A&#x27;</span>;   ELSEIF score<span class="hljs-operator">&gt;</span><span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;B&#x27;</span>;   ELSEIF score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;C&#x27;</span>;   <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;D&#x27;</span>;   <span class="hljs-keyword">END</span> IF;   <span class="hljs-keyword">RETURN</span> ch;      <span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> test_if(<span class="hljs-number">87</span>)$#æ¡ˆä¾‹<span class="hljs-number">2</span>ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼Œå¦‚æœå·¥èµ„<span class="hljs-operator">&lt;</span><span class="hljs-number">2000</span>,åˆ™åˆ é™¤ï¼Œå¦‚æœ<span class="hljs-number">5000</span><span class="hljs-operator">&gt;</span>å·¥èµ„<span class="hljs-operator">&gt;</span><span class="hljs-number">2000</span>,åˆ™æ¶¨å·¥èµ„<span class="hljs-number">1000</span>ï¼Œå¦åˆ™æ¶¨å·¥èµ„<span class="hljs-number">500</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test_if_pro(<span class="hljs-keyword">IN</span> sal <span class="hljs-keyword">DOUBLE</span>)<span class="hljs-keyword">BEGIN</span>   IF sal<span class="hljs-operator">&lt;</span><span class="hljs-number">2000</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> employees.salary<span class="hljs-operator">=</span>sal;   ELSEIF sal<span class="hljs-operator">&gt;=</span><span class="hljs-number">2000</span> <span class="hljs-keyword">AND</span> sal<span class="hljs-operator">&lt;</span><span class="hljs-number">5000</span> <span class="hljs-keyword">THEN</span> UPDATE employees <span class="hljs-keyword">SET</span> salary<span class="hljs-operator">=</span>salary<span class="hljs-operator">+</span><span class="hljs-number">1000</span> <span class="hljs-keyword">WHERE</span> employees.`salary`<span class="hljs-operator">=</span>sal;   <span class="hljs-keyword">ELSE</span> UPDATE employees <span class="hljs-keyword">SET</span> salary<span class="hljs-operator">=</span>salary<span class="hljs-operator">+</span><span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> employees.`salary`<span class="hljs-operator">=</span>sal;   <span class="hljs-keyword">END</span> IF;   <span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> test_if_pro(<span class="hljs-number">2100</span>)$#æ¡ˆä¾‹<span class="hljs-number">3</span>ï¼šåˆ›å»ºå‡½æ•°ï¼Œå®ç°ä¼ å…¥æˆç»©ï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">90</span>,è¿”å›Aï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">80</span>,è¿”å›Bï¼Œå¦‚æœæˆç»©<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>,è¿”å›Cï¼Œå¦åˆ™è¿”å›D<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test_case(score <span class="hljs-type">FLOAT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">CHAR</span><span class="hljs-keyword">BEGIN</span>    <span class="hljs-keyword">DECLARE</span> ch <span class="hljs-type">CHAR</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;A&#x27;</span>;      <span class="hljs-keyword">CASE</span>    <span class="hljs-keyword">WHEN</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">90</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;A&#x27;</span>;   <span class="hljs-keyword">WHEN</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;B&#x27;</span>;   <span class="hljs-keyword">WHEN</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;C&#x27;</span>;   <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">SET</span> ch<span class="hljs-operator">=</span><span class="hljs-string">&#x27;D&#x27;</span>;   <span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;      <span class="hljs-keyword">RETURN</span> ch;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">SELECT</span> test_case(<span class="hljs-number">56</span>)$</code></pre></div><h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><blockquote><p>ã€æ ‡ç­¾:ã€‘while å¾ªç¯æ¡ä»¶ do<br>   å¾ªç¯ä½“;<br>end whileã€ æ ‡ç­¾ã€‘;</p><p>è”æƒ³ï¼š</p><p>while(å¾ªç¯æ¡ä»¶){</p><p>   å¾ªç¯ä½“;<br>}</p></blockquote><h4 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h4><blockquote><p>ã€æ ‡ç­¾:ã€‘loop<br>   å¾ªç¯ä½“;<br>end loop ã€æ ‡ç­¾ã€‘;</p><p>å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿç®€å•çš„æ­»å¾ªç¯</p></blockquote><h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><blockquote><p>ã€æ ‡ç­¾ï¼šã€‘repeat<br>   å¾ªç¯ä½“;<br>until ç»“æŸå¾ªç¯çš„æ¡ä»¶<br>end repeat ã€æ ‡ç­¾ã€‘;</p></blockquote><p><strong>æ²¡æœ‰æ·»åŠ å¾ªç¯æ§åˆ¶è¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> pro_while1$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> pro_while1(<span class="hljs-keyword">IN</span> insertCount <span class="hljs-type">INT</span>)<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>;   WHILE i<span class="hljs-operator">&lt;=</span>insertCount DO      <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> admin(username,`password`) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;Rose&#x27;</span>,i),<span class="hljs-string">&#x27;666&#x27;</span>);      <span class="hljs-keyword">SET</span> i<span class="hljs-operator">=</span>i<span class="hljs-operator">+</span><span class="hljs-number">1</span>;   <span class="hljs-keyword">END</span> WHILE;   <span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> pro_while1(<span class="hljs-number">100</span>)$</code></pre></div><p>iterateç±»ä¼¼äº continueï¼Œç»§ç»­ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡<br>leave ç±»ä¼¼äº  breakï¼Œè·³å‡ºï¼Œç»“æŸå½“å‰æ‰€åœ¨çš„å¾ªç¯</p><p><strong>æ·»åŠ leaveè¯­å¥</strong>ï¼ˆæ­¤æ—¶å¿…é¡»åŠ åç§°ï¼‰</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•ï¼Œå¦‚æœæ¬¡æ•°<span class="hljs-operator">&gt;</span><span class="hljs-number">20</span>åˆ™åœæ­¢<span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> admin$<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> test_while1$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test_while1(<span class="hljs-keyword">IN</span> insertCount <span class="hljs-type">INT</span>)<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>;   a:WHILE i<span class="hljs-operator">&lt;=</span>insertCount DO      <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> admin(username,`password`) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;xiaohua&#x27;</span>,i),<span class="hljs-string">&#x27;0000&#x27;</span>);      IF i<span class="hljs-operator">&gt;=</span><span class="hljs-number">20</span> <span class="hljs-keyword">THEN</span> LEAVE a;      <span class="hljs-keyword">END</span> IF;      <span class="hljs-keyword">SET</span> i<span class="hljs-operator">=</span>i<span class="hljs-operator">+</span><span class="hljs-number">1</span>;   <span class="hljs-keyword">END</span> WHILE a;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> test_while1(<span class="hljs-number">100</span>)$</code></pre></div><p><strong>æ·»åŠ iterateè¯­å¥</strong>ï¼ˆæ­¤æ—¶å¿…é¡»åŠ åç§°ï¼‰</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•ï¼Œåªæ’å…¥å¶æ•°æ¬¡<span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> admin$<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> test_while1$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test_while1(<span class="hljs-keyword">IN</span> insertCount <span class="hljs-type">INT</span>)<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;   a:WHILE i<span class="hljs-operator">&lt;=</span>insertCount DO      <span class="hljs-keyword">SET</span> i<span class="hljs-operator">=</span>i<span class="hljs-operator">+</span><span class="hljs-number">1</span>;      IF <span class="hljs-built_in">MOD</span>(i,<span class="hljs-number">2</span>)<span class="hljs-operator">!=</span><span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> ITERATE a;      <span class="hljs-keyword">END</span> IF;            <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> admin(username,`password`) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;xiaohua&#x27;</span>,i),<span class="hljs-string">&#x27;0000&#x27;</span>);         <span class="hljs-keyword">END</span> WHILE a;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> test_while1(<span class="hljs-number">100</span>)$</code></pre></div><p><strong>æ¡ˆä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">/*å·²çŸ¥è¡¨stringcontent</span><span class="hljs-comment">å…¶ä¸­å­—æ®µï¼š</span><span class="hljs-comment">id è‡ªå¢é•¿</span><span class="hljs-comment">content varchar(20)</span><span class="hljs-comment"></span><span class="hljs-comment">å‘è¯¥è¡¨æ’å…¥æŒ‡å®šä¸ªæ•°çš„ï¼Œéšæœºçš„å­—ç¬¦ä¸²</span><span class="hljs-comment">*/</span><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> stringcontent;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> stringcontent(   id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,   content <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)   );DELIMITER $<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> test_randstr_insert(<span class="hljs-keyword">IN</span> insertCount <span class="hljs-type">INT</span>)<span class="hljs-keyword">BEGIN</span>   <span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>;   <span class="hljs-keyword">DECLARE</span> str <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">26</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>;   <span class="hljs-keyword">DECLARE</span> startIndex <span class="hljs-type">INT</span>;#ä»£è¡¨åˆå§‹ç´¢å¼•   <span class="hljs-keyword">DECLARE</span> len <span class="hljs-type">INT</span>;#ä»£è¡¨æˆªå–çš„å­—ç¬¦é•¿åº¦   WHILE i<span class="hljs-operator">&lt;=</span>insertcount DO      <span class="hljs-keyword">SET</span> startIndex<span class="hljs-operator">=</span><span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span><span class="hljs-number">26</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>);#ä»£è¡¨åˆå§‹ç´¢å¼•ï¼ŒéšæœºèŒƒå›´<span class="hljs-number">1</span><span class="hljs-number">-26</span>      <span class="hljs-keyword">SET</span> len<span class="hljs-operator">=</span><span class="hljs-built_in">FLOOR</span>(RAND()<span class="hljs-operator">*</span>(<span class="hljs-number">20</span><span class="hljs-operator">-</span>startIndex<span class="hljs-operator">+</span><span class="hljs-number">1</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>);#ä»£è¡¨æˆªå–é•¿åº¦ï¼ŒéšæœºèŒƒå›´<span class="hljs-number">1</span><span class="hljs-operator">-</span>ï¼ˆ<span class="hljs-number">20</span><span class="hljs-operator">-</span>startIndex<span class="hljs-operator">+</span><span class="hljs-number">1</span>ï¼‰,content<span class="hljs-number">-20</span>      <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> stringcontent(content) <span class="hljs-keyword">VALUES</span>(SUBSTR(str,startIndex,len));      <span class="hljs-keyword">SET</span> i<span class="hljs-operator">=</span>i<span class="hljs-operator">+</span><span class="hljs-number">1</span>;   <span class="hljs-keyword">END</span> WHILE;<span class="hljs-keyword">END</span> $<span class="hljs-keyword">CALL</span> test_randstr_insert(<span class="hljs-number">10</span>)$</code></pre></div><h1 id="äºŒã€çº¦æŸ"><a href="#äºŒã€çº¦æŸ" class="headerlink" title="äºŒã€çº¦æŸ"></a>äºŒã€çº¦æŸ</h1><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><blockquote><ul><li>æ•°å€¼å‹ï¼š<br>   æ•´å‹<br>   å°æ•°ï¼š<div class="hljs code-wrapper"><pre><code>  å®šç‚¹æ•°  æµ®ç‚¹æ•°</code></pre></div></li><li>å­—ç¬¦å‹ï¼š<br>   è¾ƒçŸ­çš„æ–‡æœ¬ï¼šcharã€varchar<br>   è¾ƒé•¿çš„æ–‡æœ¬ï¼štextã€blobï¼ˆè¾ƒé•¿çš„äºŒè¿›åˆ¶æ•°æ®ï¼‰</li><li>æ—¥æœŸå‹ï¼š</li></ul></blockquote><h4 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h4><p><strong>åˆ†ç±»</strong></p><blockquote><p>tinyintã€smallintã€mediumintã€int/integerã€bigint<br>1               2                3                  4                 8         (å­—èŠ‚)</p></blockquote><p><strong>ç‰¹ç‚¹</strong></p><p>â‘  å¦‚æœä¸è®¾ç½®æ— ç¬¦å·è¿˜æ˜¯æœ‰ç¬¦å·ï¼Œé»˜è®¤æ˜¯æœ‰ç¬¦å·ï¼Œå¦‚æœæƒ³è®¾ç½®æ— ç¬¦å·ï¼Œéœ€è¦æ·»åŠ <code>unsigned</code>å…³é”®å­—<br>â‘¡ å¦‚æœæ’å…¥çš„æ•°å€¼è¶…å‡ºäº†æ•´å‹çš„èŒƒå›´,ä¼šæŠ¥out of rangeå¼‚å¸¸ï¼Œå¹¶ä¸”æ’å…¥ä¸´ç•Œå€¼<br>â‘¢ å¦‚æœä¸è®¾ç½®é•¿åº¦ï¼Œä¼šæœ‰é»˜è®¤çš„é•¿åº¦<br>é•¿åº¦ä»£è¡¨äº†æ˜¾ç¤ºçš„æœ€å¤§å®½åº¦ï¼Œå¦‚æœä¸å¤Ÿä¼šç”¨0åœ¨å·¦è¾¹å¡«å……ï¼Œä½†å¿…é¡»æ­é…<code>zerofill</code>ä½¿ç”¨ï¼</p><p><strong>å¦‚ä½•è®¾ç½®æ— ç¬¦å·å’Œæœ‰ç¬¦å·</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> tab_int;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tab_int(   t1 <span class="hljs-type">INT</span>(<span class="hljs-number">7</span>) unsigned,   t2 <span class="hljs-type">INT</span>(<span class="hljs-number">7</span>) ZEROFILL );<span class="hljs-keyword">DESC</span> tab_int;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tab_int <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">-123456</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tab_int <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">-123456</span>,<span class="hljs-number">-123456</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tab_int <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2147483648</span>,<span class="hljs-number">4294967296</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tab_int <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">123</span>,<span class="hljs-number">123</span>);<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tab_int;</code></pre></div><h4 id="å°æ•°"><a href="#å°æ•°" class="headerlink" title="å°æ•°"></a>å°æ•°</h4><p><strong>åˆ†ç±»</strong></p><blockquote><ul><li>æµ®ç‚¹å‹<br>float(M,D)<br>double(M,D)</li><li>å®šç‚¹å‹<br>dec(Mï¼ŒD)<br>decimal(M,D)</li></ul></blockquote><p><strong>ç‰¹ç‚¹</strong></p><ul><li>Mï¼šæ•´æ•°éƒ¨ä½+å°æ•°éƒ¨ä½ï¼ŒDï¼šå°æ•°éƒ¨ä½<ul><li>å¦‚æœè¶…è¿‡èŒƒå›´ï¼Œåˆ™æ’å…¥ä¸´ç•Œå€¼</li></ul></li><li>Må’ŒDéƒ½å¯ä»¥çœç•¥<ul><li>å¦‚æœæ˜¯decimalï¼Œåˆ™Mé»˜è®¤ä¸º10ï¼ŒDé»˜è®¤ä¸º0</li><li>å¦‚æœæ˜¯floatå’Œdoubleï¼Œåˆ™ä¼šæ ¹æ®æ’å…¥çš„æ•°å€¼çš„ç²¾åº¦æ¥å†³å®šç²¾åº¦</li></ul></li><li>å®šç‚¹å‹çš„ç²¾ç¡®åº¦è¾ƒé«˜ï¼Œå¦‚æœè¦æ±‚æ’å…¥æ•°å€¼çš„ç²¾åº¦è¾ƒé«˜å¦‚è´§å¸è¿ç®—ç­‰åˆ™è€ƒè™‘ä½¿ç”¨</li></ul><p><strong>åŸåˆ™</strong></p><p>æ‰€é€‰æ‹©çš„ç±»å‹è¶Šç®€å•è¶Šå¥½ï¼Œèƒ½ä¿å­˜æ•°å€¼çš„ç±»å‹è¶Šå°è¶Šå¥½</p><h4 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h4><p><strong>åˆ†ç±»</strong></p><blockquote><ul><li>è¾ƒçŸ­çš„æ–‡æœ¬ï¼š<ul><li>char</li><li>varchar</li></ul></li><li>å…¶ä»–ï¼š<ul><li>binaryå’Œvarbinaryç”¨äºä¿å­˜è¾ƒçŸ­çš„äºŒè¿›åˆ¶</li><li>enumç”¨äºä¿å­˜æšä¸¾</li><li>setç”¨äºä¿å­˜é›†åˆ</li></ul></li><li>è¾ƒé•¿çš„æ–‡æœ¬ï¼š<ul><li>text</li><li>blob(è¾ƒå¤§çš„äºŒè¿›åˆ¶)</li></ul></li></ul></blockquote><p><strong>ç‰¹ç‚¹</strong></p><blockquote><p>å†™æ³•                                            Mçš„æ„æ€                                       ç‰¹ç‚¹                   ç©ºé—´çš„è€—è´¹              æ•ˆç‡<br>char   char(M)               æœ€å¤§çš„å­—ç¬¦æ•°ï¼Œå¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸º1       å›ºå®šé•¿åº¦çš„å­—ç¬¦       æ¯”è¾ƒè€—è´¹               é«˜</p><p>varchar varchar(M)         æœ€å¤§çš„å­—ç¬¦æ•°ï¼Œä¸å¯ä»¥çœç•¥                  å¯å˜é•¿åº¦çš„å­—ç¬¦       æ¯”è¾ƒèŠ‚çœ               ä½</p></blockquote><h4 id="æ—¥æœŸå‹"><a href="#æ—¥æœŸå‹" class="headerlink" title="æ—¥æœŸå‹"></a>æ—¥æœŸå‹</h4><p><strong>åˆ†ç±»</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;time_zone&#x27;</span>;<span class="hljs-keyword">SET</span> time_zone<span class="hljs-operator">=</span><span class="hljs-string">&#x27;+9:00&#x27;</span>;</code></pre></div><blockquote><ul><li>dateåªä¿å­˜æ—¥æœŸ</li><li>time åªä¿å­˜æ—¶é—´</li><li>yearåªä¿å­˜å¹´</li><li>datetimeä¿å­˜æ—¥æœŸ+æ—¶é—´</li><li>timestampä¿å­˜æ—¥æœŸ+æ—¶é—´ ï¼ˆç”¨å¾—å¤šï¼‰</li></ul></blockquote><p><strong>ç‰¹ç‚¹</strong></p><blockquote><div class="hljs code-wrapper"><pre><code>                         å­—èŠ‚                èŒƒå›´                            æ—¶åŒºç­‰çš„å½±å“</code></pre></div><p>datetime                  8          1000â€”â€”9999                          ä¸å— </p><p>timestamp              4               1970-2038                              å—</p></blockquote><p><strong>æ›´æ”¹æ—¶åŒº</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;time_zone&#x27;</span>;<span class="hljs-keyword">SET</span> time_zone<span class="hljs-operator">=</span><span class="hljs-string">&#x27;+9:00&#x27;</span>;</code></pre></div><h2 id="ä¸»é”®çº¦æŸ"><a href="#ä¸»é”®çº¦æŸ" class="headerlink" title="ä¸»é”®çº¦æŸ"></a>ä¸»é”®çº¦æŸ</h2><blockquote><p>PRIMARY KEY:ä¸»é”®ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å…·æœ‰å”¯ä¸€æ€§ï¼Œå¹¶ä¸”éç©º<br>æ¯”å¦‚å­¦å·ã€å‘˜å·¥ç¼–å·ç­‰<br>èƒ½å¤Ÿå”¯ä¸€ç¡®å®šè¡¨ä¸­çš„ä¸€æ¡è®°å½•ã€‚æˆ‘ä»¬é€šè¿‡ç»™æŸä¸ªå­—æ®µæ·»åŠ è¯¥çº¦æŸï¼Œå°±å¯ä»¥ä½¿å¾—è¯¥å­—æ®µä¸é‡å¤ä¸”ä¸ä¸ºç©ºã€‚</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> (id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));</code></pre></div><p><strong>è”åˆä¸»é”®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user2 (id <span class="hljs-type">INT</span>,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),    <span class="hljs-keyword">PRIMARY</span> KEY(id, name));</code></pre></div><p>æ­¤å¤„å­—æ®µidå’Œnameä¸€åŒä½œä¸ºä¸»é”®ï¼Œè”åˆä¸»é”®è¦æ±‚æ¯ä¸ªå­—æ®µ<strong>åŠ èµ·æ¥ä¸åŒå³å¯</strong>ï¼ˆæ— éœ€æ¯ä¸ªå­—æ®µéƒ½ä¸åŒï¼‰</p><p><strong>å»ºè¡¨åæ·»åŠ ä¸»é”®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY (id);</code></pre></div><p>æˆ–è€…é€šè¿‡<strong>ä¿®æ”¹å­—æ®µ</strong>çš„æ–¹å¼æ¥æ·»åŠ ä¸»é”®</p><div class="hljs code-wrapper"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 MODIFY id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY;</code></pre></div><p><strong>å»ºè¡¨ååˆ é™¤ä¸»é”®</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 <span class="hljs-keyword">DROP</span>  <span class="hljs-keyword">PRIMARY</span> KEY (id);</code></pre></div><h2 id="è‡ªå¢çº¦æŸ"><a href="#è‡ªå¢çº¦æŸ" class="headerlink" title="è‡ªå¢çº¦æŸ"></a>è‡ªå¢çº¦æŸ</h2><blockquote><p>1ã€æ ‡è¯†åˆ—å¿…é¡»å’Œä¸»é”®æ­é…å—ï¼Ÿä¸ä¸€å®šï¼Œä½†è¦æ±‚æ˜¯ä¸€ä¸ªkey<br>2ã€ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å‡ ä¸ªæ ‡è¯†åˆ—ï¼Ÿè‡³å¤šä¸€ä¸ªï¼<br>3ã€æ ‡è¯†åˆ—çš„ç±»å‹åªèƒ½æ˜¯æ•°å€¼å‹<br>4ã€æ ‡è¯†åˆ—å¯ä»¥é€šè¿‡ SET auto_increment_increment=3;è®¾ç½®æ­¥é•¿<br>å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ’å…¥å€¼ï¼Œè®¾ç½®èµ·å§‹å€¼</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user3 (id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREAMENT,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> user3 (name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ’å…¥æˆåŠŸï¼Œè‡ªåŠ¨ç”Ÿæˆäº†id #è®¾ç½®è‡ªå¢<span class="hljs-keyword">SET</span> auto_increment_increment<span class="hljs-operator">=</span><span class="hljs-number">3</span>;</code></pre></div><p>è‡ªå¢çº¦æŸä¸€èˆ¬<strong>ä¸ä¸»é”®æ­é…ä½¿ç”¨</strong></p><h2 id="å”¯ä¸€çº¦æŸ"><a href="#å”¯ä¸€çº¦æŸ" class="headerlink" title="å”¯ä¸€çº¦æŸ"></a>å”¯ä¸€çº¦æŸ</h2><blockquote><p>UNIQUE:å”¯ä¸€ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å…·æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥ä¸ºç©º<br>æ¯”å¦‚åº§ä½å·<br>çº¦æŸä¿®é¥°çš„å­—æ®µä¸å¯ä»¥é‡å¤</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREAMENT <span class="hljs-keyword">UNIQUE</span>,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));</code></pre></div><p>æˆ–è€…</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREAMENT,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<span class="hljs-keyword">UNIQUE</span>(id, name));</code></pre></div><h2 id="éç©ºçº¦æŸ"><a href="#éç©ºçº¦æŸ" class="headerlink" title="éç©ºçº¦æŸ"></a>éç©ºçº¦æŸ</h2><blockquote><p>NOT NULLï¼šéç©ºï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼ä¸èƒ½ä¸ºç©º<br>æ¯”å¦‚å§“åã€å­¦å·ç­‰</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),);</code></pre></div><h2 id="é»˜è®¤çº¦æŸ"><a href="#é»˜è®¤çº¦æŸ" class="headerlink" title="é»˜è®¤çº¦æŸ"></a>é»˜è®¤çº¦æŸ</h2><blockquote><p>DEFAULT:é»˜è®¤ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µæœ‰é»˜è®¤å€¼<br>æ¯”å¦‚æ€§åˆ«</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (id <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),);</code></pre></div><p>å¦‚æœæˆ‘ä»¬æ’å…¥å­—æ®µæ—¶æ²¡æœ‰ä¼ å€¼ï¼Œå°±ä¼š<strong>ä½¿ç”¨é»˜è®¤å€¼</strong></p><h2 id="å¤–é”®çº¦æŸ"><a href="#å¤–é”®çº¦æŸ" class="headerlink" title="å¤–é”®çº¦æŸ"></a>å¤–é”®çº¦æŸ</h2><blockquote><p>FOREIGN KEY:å¤–é”®ï¼Œç”¨äºé™åˆ¶ä¸¤ä¸ªè¡¨çš„å…³ç³»ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å¿…é¡»æ¥è‡ªäºä¸»è¡¨çš„å…³è”åˆ—çš„å€¼<br>åœ¨ä»è¡¨æ·»åŠ å¤–é”®çº¦æŸï¼Œç”¨äºå¼•ç”¨ä¸»è¡¨ä¸­æŸåˆ—çš„å€¼<br>æ¯”å¦‚å­¦ç”Ÿè¡¨çš„ä¸“ä¸šç¼–å·ï¼Œå‘˜å·¥è¡¨çš„éƒ¨é—¨ç¼–å·ï¼Œå‘˜å·¥è¡¨çš„å·¥ç§ç¼–å·</p></blockquote><p>ä¸»è¡¨</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> master(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));</code></pre></div><p>ä»è¡¨</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> pet(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),master_id <span class="hljs-type">int</span>,<span class="hljs-keyword">FOREIGN</span> KEY(master_id) <span class="hljs-keyword">REFERENCES</span> master(id));</code></pre></div><ul><li>ä¸»è¡¨ä¸­æ²¡æœ‰çš„æ•°æ®ï¼Œåœ¨å‰¯è¡¨ä¸­æ˜¯ä¸å¯ä»¥ä½¿ç”¨çš„</li><li>ä¸»è¡¨ä¸­çš„æ•°æ®è¢«å‰¯æ ‡å¼•ç”¨æ—¶ï¼Œæ˜¯ä¸å¯ä»¥åˆ é™¤çš„</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(   å­—æ®µå å­—æ®µç±»å‹ åˆ—çº§çº¦æŸ,   å­—æ®µå å­—æ®µç±»å‹,   è¡¨çº§çº¦æŸ)</code></pre></div><p>çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š</p><ul><li>åˆ—çº§çº¦æŸï¼š<ul><li>å…­å¤§çº¦æŸè¯­æ³•ä¸Šéƒ½æ”¯æŒï¼Œä½†å¤–é”®çº¦æŸæ²¡æœ‰æ•ˆæœ</li></ul></li><li>è¡¨çº§çº¦æŸï¼š<ul><li>é™¤äº†éç©ºã€é»˜è®¤ï¼Œå…¶ä»–çš„éƒ½æ”¯æŒ</li></ul></li></ul><p><strong>åˆ—çº§çº¦æŸ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> stuinfo(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,#ä¸»é”®stuName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,#éç©ºgender <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">CHECK</span>(gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ç”·&#x27;</span> <span class="hljs-keyword">OR</span> gender <span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¥³&#x27;</span>),#æ£€æŸ¥,mysqlä¸­ä¸æ”¯æŒseat <span class="hljs-type">INT</span> <span class="hljs-keyword">UNIQUE</span>,#å”¯ä¸€age <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span>  <span class="hljs-number">18</span>,#é»˜è®¤çº¦æŸmajorId <span class="hljs-type">INT</span> <span class="hljs-keyword">REFERENCES</span> major(id)#å¤–é”®);#æŸ¥çœ‹stuinfoä¸­çš„æ‰€æœ‰ç´¢å¼•ï¼ŒåŒ…æ‹¬ä¸»é”®ã€å¤–é”®ã€å”¯ä¸€<span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> stuinfo;</code></pre></div><p><strong>è¡¨çº§çº¦æŸ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> stuinfo(   id <span class="hljs-type">INT</span>,   stuname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),   gender <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>),   seat <span class="hljs-type">INT</span>,   age <span class="hljs-type">INT</span>,   majorid <span class="hljs-type">INT</span>,     #ã€<span class="hljs-keyword">constraint</span> çº¦æŸåã€‘ çº¦æŸç±»å‹(å­—æ®µå) .   <span class="hljs-keyword">CONSTRAINT</span> pk <span class="hljs-keyword">PRIMARY</span> KEY(id),#ä¸»é”®   <span class="hljs-keyword">CONSTRAINT</span> uq <span class="hljs-keyword">UNIQUE</span>(seat),#å”¯ä¸€é”®   <span class="hljs-keyword">CONSTRAINT</span> ck <span class="hljs-keyword">CHECK</span>(gender <span class="hljs-operator">=</span><span class="hljs-string">&#x27;ç”·&#x27;</span> <span class="hljs-keyword">OR</span> gender  <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¥³&#x27;</span>),#æ£€æŸ¥,mysqlä¸­ä¸æ”¯æŒ   <span class="hljs-keyword">CONSTRAINT</span> fk_stuinfo_major <span class="hljs-keyword">FOREIGN</span> KEY(majorid) <span class="hljs-keyword">REFERENCES</span> major(id)#å¤–é”®</code></pre></div><blockquote><p>   ä½ç½®                        æ”¯æŒçš„çº¦æŸç±»å‹                                      æ˜¯å¦å¯ä»¥èµ·çº¦æŸå</p><p>åˆ—çº§çº¦æŸï¼š  åˆ—çš„åé¢   è¯­æ³•éƒ½æ”¯æŒï¼Œä½†å¤–é”®æ²¡æœ‰æ•ˆæœ                  ä¸å¯ä»¥<br>è¡¨çº§çº¦æŸï¼š  æ‰€æœ‰åˆ—çš„ä¸‹é¢ é»˜è®¤å’Œéç©ºä¸æ”¯æŒï¼Œå…¶ä»–æ”¯æŒ              å¯ä»¥ï¼ˆä¸»é”®æ²¡æœ‰æ•ˆæœï¼‰</p></blockquote><p><strong>ä¸»é”®å’Œå”¯ä¸€çš„å¤§å¯¹æ¯”</strong></p><blockquote><p>ä¿è¯å”¯ä¸€æ€§  æ˜¯å¦å…è®¸ä¸ºç©º    ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ª   æ˜¯å¦å…è®¸ç»„åˆ(æœ‰ä¸€ä¸ªæ»¡è¶³å°±æˆç«‹)</p><p>ä¸»é”® âˆš                  Ã—                     è‡³å¤šæœ‰1ä¸ª                   âˆšï¼Œä½†ä¸æ¨è<br>å”¯ä¸€ âˆš                  âˆš                     å¯ä»¥æœ‰å¤šä¸ª                  âˆšï¼Œä½†ä¸æ¨è</p></blockquote><p><strong>å¤–é”®</strong></p><p>1ã€è¦æ±‚åœ¨ä»è¡¨è®¾ç½®å¤–é”®å…³ç³»<br>2ã€ä»è¡¨çš„å¤–é”®åˆ—çš„ç±»å‹å’Œä¸»è¡¨çš„å…³è”åˆ—çš„ç±»å‹è¦æ±‚ä¸€è‡´æˆ–å…¼å®¹ï¼Œåç§°æ— è¦æ±‚<br>3ã€ä¸»è¡¨çš„å…³è”åˆ—å¿…é¡»æ˜¯ä¸€ä¸ªkeyï¼ˆä¸€èˆ¬æ˜¯ä¸»é”®æˆ–å”¯ä¸€ï¼‰<br>4ã€æ’å…¥æ•°æ®æ—¶ï¼Œå…ˆæ’å…¥ä¸»è¡¨ï¼Œå†æ’å…¥ä»è¡¨</p><p><strong>åˆ é™¤æ•°æ®æ—¶ï¼Œå…ˆåˆ é™¤ä»è¡¨ï¼Œå†åˆ é™¤ä¸»è¡¨</strong></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•åˆ é™¤ä¸»è¡¨ä¸­çš„è®°å½•</p><p><strong>çº§è”åˆ é™¤</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stu <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_stu_major <span class="hljs-keyword">FOREIGN</span> KEY (majorid) <span class="hljs-keyword">REFERENCES</span> major(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;</code></pre></div><p><strong>çº§è”ç½®ç©º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stu <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_stu_major <span class="hljs-keyword">FOREIGN</span> KEY (majorid) <span class="hljs-keyword">REFERENCES</span> major(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><h2 id="ä¿®æ”¹è¡¨çš„çº¦æŸ"><a href="#ä¿®æ”¹è¡¨çš„çº¦æŸ" class="headerlink" title="ä¿®æ”¹è¡¨çš„çº¦æŸ"></a>ä¿®æ”¹è¡¨çš„çº¦æŸ</h2><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ·»åŠ åˆ—çº§çº¦æŸ<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å modify <span class="hljs-keyword">column</span> å­—æ®µå å­—æ®µç±»å‹ æ–°çº¦æŸ;#æ·»åŠ è¡¨çº§çº¦æŸ<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> ã€<span class="hljs-keyword">constraint</span> çº¦æŸåã€‘ çº¦æŸç±»å‹(å­—æ®µå) ã€å¤–é”®çš„å¼•ç”¨ã€‘;</code></pre></div><p><strong>ä¸¾ä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1.</span>æ·»åŠ éç©ºçº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> stuname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;#<span class="hljs-number">2.</span>æ·»åŠ é»˜è®¤çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> age <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">18</span>;#<span class="hljs-number">3.</span>æ·»åŠ ä¸»é”®#â‘ åˆ—çº§çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY;#â‘¡è¡¨çº§çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY(id);#<span class="hljs-number">4.</span>æ·»åŠ å”¯ä¸€#â‘ åˆ—çº§çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> seat <span class="hljs-type">INT</span> <span class="hljs-keyword">UNIQUE</span>;#â‘¡è¡¨çº§çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span>(seat);#<span class="hljs-number">5.</span>æ·»åŠ å¤–é”®<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_stuinfo_major <span class="hljs-keyword">FOREIGN</span> KEY(majorid) <span class="hljs-keyword">REFERENCES</span> major(id); #<span class="hljs-number">1.</span>åˆ é™¤éç©ºçº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> stuname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NULL</span>;#<span class="hljs-number">2.</span>åˆ é™¤é»˜è®¤çº¦æŸ<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo MODIFY <span class="hljs-keyword">COLUMN</span> age <span class="hljs-type">INT</span> ;#<span class="hljs-number">3.</span>åˆ é™¤ä¸»é”®<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY</span> KEY;#<span class="hljs-number">4.</span>åˆ é™¤å”¯ä¸€<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">DROP</span> INDEX seat;#<span class="hljs-number">5.</span>åˆ é™¤å¤–é”®<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> stuinfo <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> KEY fk_stuinfo_major;</code></pre></div><h1 id="ä¸‰ã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"><a href="#ä¸‰ã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼" class="headerlink" title="ä¸‰ã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"></a>ä¸‰ã€æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼</h1><h2 id="ç¬¬ä¸€èŒƒå¼"><a href="#ç¬¬ä¸€èŒƒå¼" class="headerlink" title="ç¬¬ä¸€èŒƒå¼"></a>ç¬¬ä¸€èŒƒå¼</h2><p><strong>å­—æ®µè¿˜å¯ä»¥æ‹†åˆ†çš„ï¼Œå°±ä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼</strong></p><p>æ¯”å¦‚åœ°å€å¦‚æœå†™ä¸º</p><div class="hljs code-wrapper"><pre><code class="hljs plain">åœ°å€ï¼šå››å·çœæˆéƒ½å¸‚é«˜æ–°åŒºå¤©åºœä¸€è¡—</code></pre></div><p>å°±æ˜¯å¯ä»¥è¢«æ‹†åˆ†çš„</p><p>å¦‚æœå­—æ®µå†™ä¸º</p><div class="hljs code-wrapper"><pre><code class="hljs plain">çœä»½ï¼šå››å·çœåŸå¸‚ï¼šæˆéƒ½å¸‚åŒºåŸŸï¼šé«˜æ–°åŒºè¡—åï¼šå¤©åºœä¸€è¡—</code></pre></div><p>å°±æ˜¯ä¸å¯æ‹†åˆ†çš„</p><p>å»ºè¡¨å¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCRAEMENT,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),province <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),city <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),area <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),street: <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));</code></pre></div><p>å°±æ˜¯<strong>ç¬¦åˆç¬¬ä¸€èŒƒå¼</strong>çš„ï¼Œä½†<strong>å¹¶ä¸æ˜¯æ‹†åˆ†çš„è¶Šè¯¦ç»†è¶Šå¥½</strong></p><h2 id="ç¬¬äºŒèŒƒå¼"><a href="#ç¬¬äºŒèŒƒå¼" class="headerlink" title="ç¬¬äºŒèŒƒå¼"></a>ç¬¬äºŒèŒƒå¼</h2><ul><li>æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„æ¡ä»¶ä¸‹ï¼Œç¬¬äºŒèŒƒå¼è¦æ±‚ï¼š<strong>é™¤ä¸»é”®å¤–çš„æ¯ä¸€åˆ—ï¼Œéƒ½å¿…é¡»å®Œå…¨ä¾èµ–äºä¸»é”®</strong></li><li>å¦‚æœå‡ºç°ä¸å®Œå…¨ä¾èµ–ï¼Œåˆ™åªå¯èƒ½å‘ç”Ÿåœ¨<strong>è”åˆä¸»é”®</strong>çš„æƒ…å†µä¸‹</li></ul><p><strong>ä¸æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„ä¾‹å­</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(product_id <span class="hljs-type">INT</span>,customer_id <span class="hljs-type">INT</span>,product_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),    <span class="hljs-keyword">PRIMARY</span> KEY(product_id, customer_id));</code></pre></div><p>æ­¤å¤„product_nameåªä¾èµ–äºproduct_idï¼Œcustomer_nameåªä¾èµ–äºcustomer_idï¼Œæ˜¯å®Œå…¨ä¾èµ–</p><p><strong>æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„ä¾‹å­</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,product_id <span class="hljs-type">INT</span>,customer_id <span class="hljs-type">INT</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> product(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>));</code></pre></div><h2 id="ç¬¬ä¸‰èŒƒå¼"><a href="#ç¬¬ä¸‰èŒƒå¼" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼"></a>ç¬¬ä¸‰èŒƒå¼</h2><ul><li>æ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œé™¤ä¸»é”®å¤–çš„å…¶ä»–åˆ—ä¹‹é—´ä¸èƒ½æœ‰ä¼ é€’ä¾èµ–å…³ç³»</li></ul><p><strong>ä¸æ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„ä¾‹å­</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,product_id <span class="hljs-type">INT</span>,customer_id <span class="hljs-type">INT</span>,customer_phone <span class="hljs-type">INT</span>);</code></pre></div><p>æ­¤å¤„customer_phoneåˆä¾èµ–äºcustomer_idï¼Œå­˜åœ¨ä¼ é€’ä¾èµ–å…³ç³»ï¼Œä¸æ»¡è¶³ç¬¬ä¸‰èŒƒå¼</p><p><strong>æ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„ä¾‹å­</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,product_id <span class="hljs-type">INT</span>,customer_id <span class="hljs-type">INT</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer(id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),    phone <span class="hljs-type">INT</span>);</code></pre></div><h1 id="å››ã€è§†å›¾"><a href="#å››ã€è§†å›¾" class="headerlink" title="å››ã€è§†å›¾"></a>å››ã€è§†å›¾</h1><p>æ˜¯ä¸€ç§è™šæ‹Ÿè¡¨ï¼Œå’Œæ™®é€šè¡¨ä¸€æ ·ä½¿ç”¨<br>mysql5.1ç‰ˆæœ¬å‡ºç°çš„æ–°ç‰¹æ€§ï¼Œæ˜¯é€šè¿‡è¡¨åŠ¨æ€ç”Ÿæˆçš„æ•°æ®</p><blockquote><p>â€‹                åˆ›å»ºè¯­æ³•çš„å…³é”®å­—            æ˜¯å¦å®é™…å ç”¨ç‰©ç†ç©ºé—´                                         ä½¿ç”¨</p><p>è§†å›¾          create view                           åªæ˜¯ä¿å­˜äº†sqlé€»è¾‘                         å¢åˆ æ”¹æŸ¥ï¼Œåªæ˜¯ä¸€èˆ¬ä¸èƒ½å¢åˆ æ”¹</p><p>è¡¨               create table                              ä¿å­˜äº†æ•°æ®                                                     å¢åˆ æ”¹æŸ¥</p></blockquote><h3 id="åˆ›å»ºè§†å›¾"><a href="#åˆ›å»ºè§†å›¾" class="headerlink" title="åˆ›å»ºè§†å›¾"></a>åˆ›å»ºè§†å›¾</h3><p>åˆ©ç”¨<code>CREATE VIEW xx AS</code>å°è£…</p><div class="hljs code-wrapper"><pre><code class="hljs sql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢å§“å¼ çš„å­¦ç”Ÿåå’Œä¸“ä¸šå<span class="hljs-keyword">SELECT</span> stuname,majorname<span class="hljs-keyword">FROM</span> stuinfo s<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> major m <span class="hljs-keyword">ON</span> s.`majorid`<span class="hljs-operator">=</span> m.`id`<span class="hljs-keyword">WHERE</span> s.`stuname` <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;å¼ %&#x27;</span>;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v1<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> stuname,majorname<span class="hljs-keyword">FROM</span> stuinfo s<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> major m <span class="hljs-keyword">ON</span> s.`majorid`<span class="hljs-operator">=</span> m.`id`;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v1 <span class="hljs-keyword">WHERE</span> stuname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;å¼ %&#x27;</span>;#<span class="hljs-number">2.</span>æŸ¥è¯¢å„éƒ¨é—¨çš„å¹³å‡å·¥èµ„çº§åˆ«#â‘ åˆ›å»ºè§†å›¾æŸ¥çœ‹æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> myv2<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) ag,department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id;#â‘¡ä½¿ç”¨<span class="hljs-keyword">SELECT</span> myv2.`ag`,g.grade_level<span class="hljs-keyword">FROM</span> myv2<span class="hljs-keyword">JOIN</span> job_grades g<span class="hljs-keyword">ON</span> myv2.`ag` <span class="hljs-keyword">BETWEEN</span> g.`lowest_sal` <span class="hljs-keyword">AND</span> g.`highest_sal`;</code></pre></div><h3 id="ä¿®æ”¹è§†å›¾"><a href="#ä¿®æ”¹è§†å›¾" class="headerlink" title="ä¿®æ”¹è§†å›¾"></a>ä¿®æ”¹è§†å›¾</h3><blockquote><p>create or replace view  è§†å›¾å<br>as</p><p>æŸ¥è¯¢è¯­å¥;</p><p>æˆ–è€…</p><p>alter view è§†å›¾å<br>as<br>æŸ¥è¯¢è¯­å¥;</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-number">1</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv3<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary),job_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id;#<span class="hljs-number">2</span><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">VIEW</span> myv3<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees;</code></pre></div><h3 id="åˆ é™¤è§†å›¾"><a href="#åˆ é™¤è§†å›¾" class="headerlink" title="åˆ é™¤è§†å›¾"></a>åˆ é™¤è§†å›¾</h3><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> emp_v1,emp_v2,myv3;</code></pre></div><h3 id="æŸ¥çœ‹è§†å›¾"><a href="#æŸ¥çœ‹è§†å›¾" class="headerlink" title="æŸ¥çœ‹è§†å›¾"></a>æŸ¥çœ‹è§†å›¾</h3><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DESC</span> myv3;<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> myv3;</code></pre></div><h3 id="æ›´æ–°è§†å›¾"><a href="#æ›´æ–°è§†å›¾" class="headerlink" title="æ›´æ–°è§†å›¾"></a>æ›´æ–°è§†å›¾</h3><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv1<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> last_name,email<span class="hljs-keyword">FROM</span> employees;#<span class="hljs-number">1.</span>æ’å…¥<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myv1 <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å¼ é£&#x27;</span>,<span class="hljs-string">&#x27;zf@qq.com&#x27;</span>);#<span class="hljs-number">2.</span>ä¿®æ”¹UPDATE myv1 <span class="hljs-keyword">SET</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span> <span class="hljs-keyword">WHERE</span> last_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¼ é£&#x27;</span>;#<span class="hljs-number">3.</span>åˆ é™¤<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> myv1 <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>;</code></pre></div><p><strong>å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹çš„è§†å›¾ä¸å…è®¸æ›´æ–°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#â‘ åŒ…å«ä»¥ä¸‹å…³é”®å­—çš„<span class="hljs-keyword">sql</span>è¯­å¥ï¼šåˆ†ç»„å‡½æ•°ã€<span class="hljs-keyword">distinct</span>ã€<span class="hljs-keyword">group</span>  <span class="hljs-keyword">by</span>ã€<span class="hljs-keyword">having</span>ã€<span class="hljs-keyword">union</span>æˆ–è€…<span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv1<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) m,department_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id;#æ›´æ–°å¤±è´¥UPDATE myv1 <span class="hljs-keyword">SET</span> m<span class="hljs-operator">=</span><span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> department_id<span class="hljs-operator">=</span><span class="hljs-number">10</span>;#â‘¡å¸¸é‡è§†å›¾<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv2<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;john&#x27;</span> NAME;#æ›´æ–°å¤±è´¥UPDATE myv2 <span class="hljs-keyword">SET</span> NAME<span class="hljs-operator">=</span><span class="hljs-string">&#x27;lucy&#x27;</span>;#â‘¢<span class="hljs-keyword">Select</span>ä¸­åŒ…å«å­æŸ¥è¯¢<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv3<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> department_id,(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">FROM</span> employees) æœ€é«˜å·¥èµ„<span class="hljs-keyword">FROM</span> departments;#æ›´æ–°å¤±è´¥UPDATE myv3 <span class="hljs-keyword">SET</span> æœ€é«˜å·¥èµ„<span class="hljs-operator">=</span><span class="hljs-number">100000</span>;#â‘£<span class="hljs-keyword">join</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv4<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> last_name,department_name<span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">JOIN</span> departments d<span class="hljs-keyword">ON</span> e.department_id  <span class="hljs-operator">=</span> d.department_id;#æ›´æ–°æˆåŠŸï¼Œæ’å…¥å¤±è´¥UPDATE myv4 <span class="hljs-keyword">SET</span> last_name  <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ é£&#x27;</span> <span class="hljs-keyword">WHERE</span> last_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Whalen&#x27;</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myv4 <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;é™ˆçœŸ&#x27;</span>,<span class="hljs-string">&#x27;xxxx&#x27;</span>);#â‘¤<span class="hljs-keyword">from</span>ä¸€ä¸ªä¸èƒ½æ›´æ–°çš„è§†å›¾<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv5<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> myv3;#æ›´æ–°å¤±è´¥UPDATE myv5 <span class="hljs-keyword">SET</span> æœ€é«˜å·¥èµ„<span class="hljs-operator">=</span><span class="hljs-number">10000</span> <span class="hljs-keyword">WHERE</span> department_id<span class="hljs-operator">=</span><span class="hljs-number">60</span>;#â‘¥<span class="hljs-keyword">where</span>å­å¥çš„å­æŸ¥è¯¢å¼•ç”¨äº†<span class="hljs-keyword">from</span>å­å¥ä¸­çš„è¡¨<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> myv6<span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> last_name,email,salary<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span>  manager_id<span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> manager_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>);#æ›´æ–°å¤±è´¥UPDATE myv6 <span class="hljs-keyword">SET</span> salary<span class="hljs-operator">=</span><span class="hljs-number">10000</span> <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;k_ing&#x27;</span>;</code></pre></div><h1 id="äº”ã€äº‹åŠ¡"><a href="#äº”ã€äº‹åŠ¡" class="headerlink" title="äº”ã€äº‹åŠ¡"></a>äº”ã€äº‹åŠ¡</h1><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªæœ€å°çš„ä¸å¯åˆ†å‰²çš„å•å…ƒï¼Œäº‹åŠ¡èƒ½å¤Ÿä¿è¯ä¸€ä¸ªä¸šåŠ¡çš„å®Œæ•´æ€§</p><p>å¤šæ¡sqlè¯­å¥<strong>è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</strong>ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°äº‹åŠ¡ï¼Œå³TCL</p><h2 id="è‡ªåŠ¨æäº¤ã€æ‰‹åŠ¨æäº¤å’Œå›æ»š"><a href="#è‡ªåŠ¨æäº¤ã€æ‰‹åŠ¨æäº¤å’Œå›æ»š" class="headerlink" title="è‡ªåŠ¨æäº¤ã€æ‰‹åŠ¨æäº¤å’Œå›æ»š"></a>è‡ªåŠ¨æäº¤ã€æ‰‹åŠ¨æäº¤å’Œå›æ»š</h2><p>é€šè¿‡<code>ROLLBACK; </code>æŒ‡ä»¤å¯ä»¥å›æ»šï¼Œä½†éœ€è¦<strong>å…³é—­è‡ªåŠ¨æäº¤</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">#å…³é—­ä¸€æ¬¡ï¼Œä¹Ÿç­‰äºå¼€å¯äº‹åŠ¡<span class="hljs-keyword">SET</span> autocommit <span class="hljs-operator">=</span> <span class="hljs-number">0</span>#æŸ¥çœ‹è‡ªåŠ¨æäº¤çŠ¶æ€<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@autocommit</span>;</code></pre></div><p>ä½†å¦‚æœåœ¨è¿›è¡Œæ“ä½œä¹‹åï¼Œæ‰§è¡Œ<code>COMMIT; </code>åˆ™æ— æ³•å†è¿›è¡Œå›æ»šï¼ˆæŒä¹…åŒ–ï¼‰</p><p><strong>åŒæ—¶deleteå¯ä»¥å›æ»šï¼Œè€Œtruncateä¸èƒ½å›æ»š</strong></p><p><strong>SAVEPOINTè®¾ç½®ä¿å­˜ç‚¹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<span class="hljs-keyword">START</span> TRANSACTION;<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">25</span>;<span class="hljs-keyword">SAVEPOINT</span> a;#è®¾ç½®ä¿å­˜ç‚¹<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">28</span>;<span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> a;#å›æ»šåˆ°ä¿å­˜ç‚¹</code></pre></div><h2 id="æ‰‹åŠ¨å¼€å¯äº‹åŠ¡"><a href="#æ‰‹åŠ¨å¼€å¯äº‹åŠ¡" class="headerlink" title="æ‰‹åŠ¨å¼€å¯äº‹åŠ¡"></a>æ‰‹åŠ¨å¼€å¯äº‹åŠ¡</h2><p>é€šè¿‡</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;æˆ–è€…<span class="hljs-keyword">START</span> TRANSACTION;</code></pre></div><p>å¯ä»¥æ‰‹åŠ¨å¼€å¯äº‹åŠ¡</p><p><strong>æ’å…¥æ•°æ®å‰</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810204606.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810204606.png" alt="img"></a></p><p><strong>æ’å…¥æ•°æ®å</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;è€å…­&#x27;</span>, <span class="hljs-number">7</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;è€ä¸ƒ&#x27;</span>, <span class="hljs-number">9</span>);æˆ–è€…<span class="hljs-keyword">START</span> TRANSACTION;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;è€å…­&#x27;</span>, <span class="hljs-number">7</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> person <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;è€ä¸ƒ&#x27;</span>, <span class="hljs-number">9</span>);</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810204849.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810204849.png" alt="img"></a></p><p><strong>å›æ»šå</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200810204930.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200810204930.png" alt="img"></a></p><p>å³</p><blockquote><p>æ­¥éª¤1ï¼šå¼€å¯äº‹åŠ¡<br>set autocommit=0;<br>start transaction;å¯é€‰çš„<br>æ­¥éª¤2ï¼šç¼–å†™äº‹åŠ¡ä¸­çš„sqlè¯­å¥(select insert update delete)<br>è¯­å¥1;<br>è¯­å¥2;<br>â€¦</p><p>æ­¥éª¤3ï¼šç»“æŸäº‹åŠ¡<br>commit;æäº¤äº‹åŠ¡<br>rollback;å›æ»šäº‹åŠ¡</p></blockquote><h2 id="å››å¤§ç‰¹å¾-ACID"><a href="#å››å¤§ç‰¹å¾-ACID" class="headerlink" title="å››å¤§ç‰¹å¾ ACID"></a>å››å¤§ç‰¹å¾ ACID</h2><ul><li>åŸå­æ€§ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„å•ä½ï¼Œ<strong>ä¸å¯å†åˆ†</strong>ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</li><li>ä¸€è‡´æ€§ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¼šä½¿æ•°æ®ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´çŠ¶æ€</li><li>éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸å—å…¶ä»–äº‹åŠ¡çš„å¹²æ‰°</li><li>æŒä¹…æ€§ï¼šäº‹ç‰©<strong>ä¸€æ—¦ç»“æŸ</strong>ï¼ˆcommitï¼‰ï¼Œå°±<strong>ä¸å¯è¿”å›</strong>ï¼ˆrollbackï¼‰</li></ul><p><strong>éš”ç¦»æ€§</strong></p><ul><li>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«<ul><li>è¯»æœªæäº¤ read uncommitted</li><li>è¯»å·²æäº¤ read committed</li><li>å¯ä»¥é‡å¤è¯» repeatable read</li><li>ä¸²è¡ŒåŒ– serializable</li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200811132934.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200811132934.png" alt="img"></a></p><ul><li>äº‹åŠ¡çš„å¹¶å‘é—®é¢˜<ul><li>è„è¯»ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œç„¶å<strong>Bå›æ»šæ“ä½œ</strong>ï¼Œé‚£ä¹ˆ<strong>Aè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®</strong></li><li>ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†<strong>æ›´æ–°å¹¶æäº¤</strong>ï¼Œ<strong>å¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœä¸ä¸€è‡´</strong></li><li>å¹»è¯»ï¼šç³»ç»Ÿç®¡ç†å‘˜Aå°†æ•°æ®åº“ä¸­æ‰€æœ‰å­¦ç”Ÿçš„æˆç»©ä»å…·ä½“åˆ†æ•°æ”¹ä¸ºABCDEç­‰çº§ï¼Œä½†æ˜¯ç³»ç»Ÿç®¡ç†å‘˜Bå°±åœ¨è¿™ä¸ªæ—¶å€™æ’å…¥äº†ä¸€æ¡å…·ä½“åˆ†æ•°çš„è®°å½•ï¼Œå½“ç³»ç»Ÿç®¡ç†å‘˜Aæ”¹ç»“æŸåå‘ç°è¿˜æœ‰ä¸€æ¡è®°å½•æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œè¿™å°±å«å¹»è¯»</li></ul></li></ul><p><strong>æ€»ç»“</strong>ï¼šä¸å¯é‡å¤è¯»çš„å’Œå¹»è¯»å¾ˆå®¹æ˜“æ··æ·†ï¼Œ<strong>ä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤</strong></p><p> è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜åªéœ€é”ä½æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè§£å†³å¹»è¯»éœ€è¦é”è¡¨</p><ul><li>æŸ¥çœ‹æ•°æ®åº“çš„éš”ç¦»çº§åˆ«</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql">ç‰ˆæœ¬ <span class="hljs-number">5.</span>x<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.tx_isolation;ç‰ˆæœ¬ <span class="hljs-number">8.0</span><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.transaction_isolation;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200811132716.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200811132716.png" alt="img"></a></p><ul><li>ä¿®æ”¹æ•°æ®åº“çš„éš”ç¦»çº§åˆ«</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> transaction isolation level read committed;</code></pre></div><h1 id="å…­ã€MySQLé€»è¾‘æ¶æ„"><a href="#å…­ã€MySQLé€»è¾‘æ¶æ„" class="headerlink" title="å…­ã€MySQLé€»è¾‘æ¶æ„"></a>å…­ã€MySQLé€»è¾‘æ¶æ„</h1><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200813170808.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200813170808.png" alt="img"></a></p><h2 id="è¿æ¥å±‚"><a href="#è¿æ¥å±‚" class="headerlink" title="è¿æ¥å±‚"></a>è¿æ¥å±‚</h2><p>æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æœç«¯å’Œè¿æ¥æœåŠ¡ï¼ŒåŒ…æ‹¬socketé€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æœç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äºtcp/ipçš„é€šä¿¡ï¼Œä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯åŠç›¸å…³å®‰å…¨çš„æ–¹æ¡ˆï¼Œåœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æœç«¯æä¾›çº¿ç¨‹ï¼ŒåŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨çš„è¿æ¥ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™</p><h2 id="æœåŠ¡å±‚"><a href="#æœåŠ¡å±‚" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h2><p>ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æä»¥åŠä¼˜åŒ–éƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚è¿‡ç¨‹ã€å‡½æ•°ç­‰ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šæŸ¥è¯¢çš„é¡ºåºæ˜¯å¦åˆ©ç”¨ç´¢å¼•ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œ</p><table><thead><tr><th>Management Serveices &amp; Utilities</th><th>ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·</th></tr></thead><tbody><tr><td>SQL Interface</td><td>SQL æ¥å£ã€‚æ¥å—ç”¨æˆ·çš„ SQL å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚ select from å°±æ˜¯è°ƒç”¨ SQL Interface</td></tr><tr><td>Parser</td><td>è§£æå™¨ã€‚ SQL å‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æ</td></tr><tr><td>Optimizer</td><td>æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚ SQL è¯­å¥åœ¨æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚æœ‰ where æ¡ä»¶æ—¶ï¼Œä¼˜åŒ–å™¨æ¥å†³å®šå…ˆæŠ•å½±è¿˜æ˜¯å…ˆè¿‡æ»¤ã€‚</td></tr><tr><td>Cache å’Œ Buffer</td><td>æŸ¥è¯¢ç¼“å­˜ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkey ç¼“å­˜ï¼Œ æƒé™ç¼“å­˜ç­‰</td></tr></tbody></table><h2 id="å¼•æ“å±‚"><a href="#å¼•æ“å±‚" class="headerlink" title="å¼•æ“å±‚"></a>å¼•æ“å±‚</h2><p>å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰åŠŸèƒ½ä¸åŒ</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>MylSAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>ä¸»å¤–é”®</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>è¡Œè¡¨é”</td><td>[è¡¨é”](# è¡¨é”)ï¼ˆä¸é€‚åˆé«˜å¹¶å‘ï¼‰</td><td>[è¡Œé”](# è¡Œé”)ï¼ˆé€‚åˆé«˜å¹¶å‘æ“ä½œï¼‰</td></tr><tr><td>ç¼“å­˜</td><td>åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®</td><td>ä¸ä»…ç¼“å­˜ç´¢å¼•ï¼Œè¿˜ç¼“å­˜çœŸå®æ•°æ®ã€‚å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜</td></tr><tr><td>è¡¨ç©ºé—´</td><td>å°</td><td>å¤§</td></tr><tr><td>å…³æ³¨ç‚¹</td><td>æ€§èƒ½</td><td>äº‹åŠ¡</td></tr><tr><td>é»˜è®¤å®‰è£…</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table><h2 id="å­˜å‚¨å±‚"><a href="#å­˜å‚¨å±‚" class="headerlink" title="å­˜å‚¨å±‚"></a>å­˜å‚¨å±‚</h2><p>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨è¿è¡Œäºè£¸è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’</p><h1 id="ä¸ƒã€æ€§èƒ½ä¸JOIN"><a href="#ä¸ƒã€æ€§èƒ½ä¸JOIN" class="headerlink" title="ä¸ƒã€æ€§èƒ½ä¸JOIN"></a>ä¸ƒã€æ€§èƒ½ä¸JOIN</h1><h2 id="æ€§èƒ½ä¸‹é™åŸå› "><a href="#æ€§èƒ½ä¸‹é™åŸå› " class="headerlink" title="æ€§èƒ½ä¸‹é™åŸå› "></a>æ€§èƒ½ä¸‹é™åŸå› </h2><p><strong>ç´¢å¼•å¤±æ•ˆ</strong></p><p><strong>å•å€¼ç´¢å¼•</strong></p><p>åˆ›å»ºè¯­å¥</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_è¡¨å_å­—æ®µå <span class="hljs-keyword">ON</span> è¡¨å(å­—æ®µå);</code></pre></div><p><strong>å¤åˆç´¢å¼•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_è¡¨å_å­—æ®µå<span class="hljs-number">1</span>å­—æ®µå<span class="hljs-number">2.</span>.. <span class="hljs-keyword">ON</span> è¡¨å(å­—æ®µå<span class="hljs-number">1</span>, å­—æ®µå<span class="hljs-number">2</span> ...);</code></pre></div><p><strong>å…³è”å¤ªå¤šJOIN</strong></p><p>å†…è¿æ¥ã€å¤–è¿æ¥çš„è¡¨ä¸è¦è¿‡å¤š</p><p><strong>æœåŠ¡å™¨è°ƒä¼˜åŠå‚æ•°è®¾ç½®</strong></p><h2 id="SQLæ‰§è¡ŒåŠ è½½é¡ºåº"><a href="#SQLæ‰§è¡ŒåŠ è½½é¡ºåº" class="headerlink" title="SQLæ‰§è¡ŒåŠ è½½é¡ºåº"></a>SQLæ‰§è¡ŒåŠ è½½é¡ºåº</h2><p><strong>æ‰‹å†™é¡ºåº</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814112248.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814112248.png" alt="img"></a></p><p>éšç€ Mysql ç‰ˆæœ¬çš„æ›´æ–°æ¢ä»£ï¼Œå…¶ä¼˜åŒ–å™¨ä¹Ÿåœ¨ä¸æ–­çš„å‡çº§ï¼Œä¼˜åŒ–å™¨ä¼šåˆ†æä¸åŒæ‰§è¡Œé¡ºåºäº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ä¸åŒè€Œ<strong>åŠ¨æ€è°ƒæ•´æ‰§è¡Œé¡ºåº</strong></p><p>ä¸‹é¢æ˜¯ç»å¸¸å‡ºç°çš„æŸ¥è¯¢é¡ºåºï¼š</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814112330.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814112330.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814112343.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814112343.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814191644.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814191644.png" alt="img"></a></p><h2 id="7ç§JOIN"><a href="#7ç§JOIN" class="headerlink" title="7ç§JOIN"></a>7ç§JOIN</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814150926.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814150926.png" alt="img"></a></p><p><strong>å»ºè¡¨è¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_dept` (`id` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,   `deptName` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   `address` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>INNODB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_emp` (`id` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,   `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   `age` <span class="hljs-type">INT</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   `deptId` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   `empno` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,   <span class="hljs-keyword">PRIMARY</span> KEY (`id`), KEY `idx_dept_id` (`deptId`)#<span class="hljs-keyword">CONSTRAINT</span> `fk_dept_id` <span class="hljs-keyword">FOREIGN</span> KEY (`deptId`) <span class="hljs-keyword">REFERENCES</span> `t_dept` (`id`)) ENGINE<span class="hljs-operator">=</span>INNODB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;åå±±&#x27;</span>,<span class="hljs-string">&#x27;åå±±&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;ä¸å¸®&#x27;</span>,<span class="hljs-string">&#x27;æ´›é˜³&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å³¨çœ‰&#x27;</span>,<span class="hljs-string">&#x27;å³¨çœ‰å±±&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;æ­¦å½“&#x27;</span>,<span class="hljs-string">&#x27;æ­¦å½“å±±&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;æ˜æ•™&#x27;</span>,<span class="hljs-string">&#x27;å…‰æ˜é¡¶&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_dept(deptName,address) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å°‘æ—&#x27;</span>,<span class="hljs-string">&#x27;å°‘æ—å¯º&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>,<span class="hljs-number">90</span>,<span class="hljs-number">1</span>,<span class="hljs-number">100001</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å²³ä¸ç¾¤&#x27;</span>,<span class="hljs-number">50</span>,<span class="hljs-number">1</span>,<span class="hljs-number">100002</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;ä»¤ç‹å†²&#x27;</span>,<span class="hljs-number">24</span>,<span class="hljs-number">1</span>,<span class="hljs-number">100003</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;æ´ªä¸ƒå…¬&#x27;</span>,<span class="hljs-number">70</span>,<span class="hljs-number">2</span>,<span class="hljs-number">100004</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;ä¹”å³°&#x27;</span>,<span class="hljs-number">35</span>,<span class="hljs-number">2</span>,<span class="hljs-number">100005</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;ç­ç»å¸ˆå¤ª&#x27;</span>,<span class="hljs-number">70</span>,<span class="hljs-number">3</span>,<span class="hljs-number">100006</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å‘¨èŠ·è‹¥&#x27;</span>,<span class="hljs-number">20</span>,<span class="hljs-number">3</span>,<span class="hljs-number">100007</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å¼ ä¸‰ä¸°&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">4</span>,<span class="hljs-number">100008</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>,<span class="hljs-number">25</span>,<span class="hljs-number">5</span>,<span class="hljs-number">100009</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_emp(NAME,age,deptId,empno) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;éŸ¦å°å®&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-number">100010</span>);</code></pre></div><p><strong>JOINæŸ¥è¯¢</strong></p><ul><li>ç¬›å¡å°”ç§¯</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_dept, t_emp;</code></pre></div><p>t_deptå…±20æ¡è®°å½•ï¼Œt_empå…±6æ¡è®°å½•ã€‚ä¸¤è¡¨å…±åŒæŸ¥è¯¢åå…±120æ¡è®°å½•</p><ul><li>å†…è¿æ¥</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span>  a.deptId <span class="hljs-operator">=</span> b.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814153140.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814153140.png" alt="img"></a></p><ul><li>å·¦å¤–è¿æ¥</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span>  a.deptId <span class="hljs-operator">=</span> b.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814153254.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814153254.png" alt="img"></a></p><ul><li>å³å¤–è¿æ¥</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span>  a.deptId <span class="hljs-operator">=</span> b.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814153413.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814153413.png" alt="img"></a></p><ul><li>å·¦å¤–è¿æ¥<strong>å–å·¦è¡¨çš„ç‹¬æœ‰éƒ¨åˆ†</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span>  a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> a.deptId <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814153909.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814153909.png" alt="img"></a></p><ul><li>å³å¤–è¿æ¥<strong>å–å³è¡¨çš„ç‹¬æœ‰éƒ¨åˆ†</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> a.deptId <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814153844.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814153844.png" alt="img"></a></p><p><strong>æ³¨æ„</strong>ï¼šåˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºNULLæ—¶ï¼Œ<strong>ä¸èƒ½ä½¿ç”¨â€™=â€™</strong></p><p>å› ä¸º<code>= NULL</code> çš„ç»“æœä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯<strong>ç»“æœæ°¸è¿œä¸ºfalse</strong>ã€‚æ‰€ä»¥å¿…é¡»ä½¿ç”¨<code>IS NULL </code>æ¥è¿›è¡Œåˆ¤ç©º</p><ul><li>å…¨å¤–è¿æ¥</li></ul><p>MySQLä¸æ”¯æŒå…¨å¤–è¿æ¥ï¼Œè¦æŸ¥è¯¢ä¸¤ä¸ªè¡¨çš„å…¨é›†ï¼Œéœ€è¦åˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢ç»“æœï¼Œæ‰€ä»¥è¦ä½¿ç”¨ <strong>UNION</strong> å…³é”®å­—</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id<span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814154554.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814154554.png" alt="img"></a></p><ul><li>æŸ¥è¯¢ä¸¤è¡¨ç‹¬æœ‰å†…å®¹</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> b.id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span><span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> a.deptId <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814155138.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814155138.png" alt="img"></a></p><h1 id="å…«ã€ç´¢å¼•ä¼˜åŒ–"><a href="#å…«ã€ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="å…«ã€ç´¢å¼•ä¼˜åŒ–"></a>å…«ã€ç´¢å¼•ä¼˜åŒ–</h1><h2 id="ä»€ä¹ˆæ˜¯ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•</h2><ul><li><p>MySQL å®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼š<strong>ç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„</strong>ã€‚å¯ä»¥å¾—åˆ°ç´¢å¼•çš„æœ¬è´¨ï¼š <strong>ç´¢å¼•æ˜¯æ•°æ®ç»“æ„</strong>ã€‚</p><p>å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š<strong>æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</strong></p></li><li><p>åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ä¸‹å›¾å°±æ˜¯ä¸€ç§å¯èƒ½çš„ç´¢å¼•æ–¹å¼ç¤ºä¾‹ï¼š</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200814173647.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200814173647.png" alt="img"></a></p><ul><li>å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ã€‚ä¸ºäº†åŠ å¿« Col2 çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨ äºŒå‰æŸ¥æ‰¾åœ¨ä¸€å®šçš„å¤æ‚åº¦å†…è·å–åˆ°ç›¸åº”æ•°æ®ï¼Œä»è€Œå¿«é€Ÿçš„æ£€ç´¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½• </li><li>ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Š</li></ul><h2 id="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"></a>ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹</strong></p><ul><li><strong>æé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡</strong>ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</li><li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œ<strong>é™ä½æ•°æ®æ’åºçš„æˆæœ¬</strong>ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´<strong>ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦</strong>ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯</li><li>å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œæ‰€ä»¥<strong>ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„</strong></li></ul><h2 id="ç´¢å¼•çš„åˆ†ç±»"><a href="#ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="ç´¢å¼•çš„åˆ†ç±»"></a>ç´¢å¼•çš„åˆ†ç±»</h2><p><strong>åŸºæœ¬è¯­æ³•</strong></p><ul><li><p>åˆ›å»º</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span>] INDEX [indexName] <span class="hljs-keyword">ON</span> table_name(<span class="hljs-keyword">column</span>);</code></pre></div></li><li><p>åˆ é™¤</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> INDEX [indexName] <span class="hljs-keyword">ON</span> table_name;</code></pre></div></li><li><p>æŸ¥çœ‹</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name;</code></pre></div></li></ul><p><strong>åˆ†ç±»</strong></p><ul><li><p>å•å€¼ç´¢å¼•</p><ul><li><p>å®šä¹‰ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p></li><li><p>è¯­æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å’Œè¡¨ä¸€èµ·åˆ›å»º</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer (id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED AUTO_INCREMENT,customer_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>), <span class="hljs-keyword">PRIMARY</span> KEY(id), KEY (customer_name) <span class="hljs-comment">--å•å€¼ç´¢å¼•</span>);<span class="hljs-comment">--å•ç‹¬åˆ›å»ºå•å€¼ç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_customer_name <span class="hljs-keyword">ON</span> customer(customer_name);</code></pre></div></li></ul></li><li><p>å”¯ä¸€ç´¢å¼•</p><ul><li><p>å®šä¹‰ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼</p></li><li><p>è¯­æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å’Œè¡¨ä¸€èµ·åˆ›å»º</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer (id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED AUTO_INCREMENT,customer_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>), <span class="hljs-keyword">PRIMARY</span> KEY(id), KEY (customer_name), <span class="hljs-comment">--å•å€¼ç´¢å¼•</span><span class="hljs-keyword">UNIQUE</span> (customer_no) <span class="hljs-comment">--å”¯ä¸€ç´¢å¼•</span>);<span class="hljs-comment">--å•ç‹¬åˆ›å»ºå”¯ä¸€ç´¢å¼•</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_customer_no <span class="hljs-keyword">ON</span> customer(customer_no);</code></pre></div></li></ul></li><li><p>ä¸»é”®ç´¢å¼•</p><ul><li><p>å®šä¹‰ï¼šè®¾å®šä¸ºä¸»é”®åæ•°æ®åº“ä¼š<strong>è‡ªåŠ¨å»ºç«‹ç´¢å¼•</strong>ï¼Œinnodbä¸ºèšç°‡ç´¢å¼•</p></li><li><p>è¯­æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å’Œè¡¨ä¸€èµ·åˆ›å»º</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer (id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED AUTO_INCREMENT,customer_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>), <span class="hljs-keyword">PRIMARY</span> KEY(id) <span class="hljs-comment">--ä¸»é”®ç´¢å¼•</span>);<span class="hljs-comment">--å•ç‹¬åˆ›å»ºä¸»é”®ç´¢å¼•</span><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> customer <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY customer(customer_no);<span class="hljs-comment">--åˆ é™¤ä¸»é”®ç´¢å¼•</span><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> customer <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY</span> KEY;<span class="hljs-comment">--ä¿®æ”¹å»ºä¸»é”®ç´¢å¼•</span>å¿…é¡»å…ˆåˆ é™¤æ‰(<span class="hljs-keyword">drop</span>)åŸç´¢å¼•ï¼Œå†æ–°å»º(<span class="hljs-keyword">add</span>)ç´¢å¼•</code></pre></div></li></ul></li><li><p>å¤åˆç´¢å¼•</p><ul><li><p>å®šä¹‰ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—</p></li><li><p>è¯­æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å’Œè¡¨ä¸€èµ·åˆ›å»º</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customer (id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED AUTO_INCREMENT,customer_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>), <span class="hljs-keyword">PRIMARY</span> KEY(id), KEY (customer_name), <span class="hljs-comment">--å•å€¼ç´¢å¼•</span><span class="hljs-keyword">UNIQUE</span> (customer_no), <span class="hljs-comment">--å”¯ä¸€ç´¢å¼•</span>KEY (customer_no,customer_name) <span class="hljs-comment">--å¤åˆç´¢å¼•</span>);<span class="hljs-comment">--å•ç‹¬åˆ›å»ºå¤åˆç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_no_name <span class="hljs-keyword">ON</span> customer(customer_no,customer_name);</code></pre></div></li></ul></li></ul><h2 id="MySQLçš„ç´¢å¼•"><a href="#MySQLçš„ç´¢å¼•" class="headerlink" title="MySQLçš„ç´¢å¼•"></a>MySQLçš„ç´¢å¼•</h2><p><strong>Bæ ‘</strong></p><ul><li>Bæ ‘çš„é˜¶ï¼šèŠ‚ç‚¹çš„<strong>æœ€å¤šå­èŠ‚ç‚¹ä¸ªæ•°</strong>ã€‚æ¯”å¦‚ 2-3æ ‘çš„é˜¶æ˜¯3ï¼Œ2-3-4æ ‘çš„é˜¶æ˜¯4</li><li>Bæ ‘çš„æœç´¢ï¼Œä»æ ¹ç»“ç‚¹å¼€å§‹ï¼Œå¯¹ç»“ç‚¹å†…çš„å…³é”®å­—ï¼ˆæœ‰åºï¼‰åºåˆ—è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­åˆ™ç»“æŸï¼Œå¦åˆ™è¿›å…¥æŸ¥è¯¢å…³é”®å­—æ‰€å±èŒƒå›´çš„å„¿å­ç»“ç‚¹ï¼›é‡å¤ï¼Œç›´åˆ°æ‰€å¯¹åº”çš„å„¿å­æŒ‡é’ˆä¸ºç©ºï¼Œæˆ–å·²ç»æ˜¯å¶å­ç»“ç‚¹</li><li>å…³é”®å­—é›†åˆåˆ†å¸ƒåœ¨æ•´é¢—æ ‘ä¸­, å³å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®</li><li>æœç´¢<strong>æœ‰å¯èƒ½åœ¨éå¶å­ç»“ç‚¹ç»“æŸ</strong></li><li>å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾</li></ul><p><strong>B+æ ‘</strong></p><ul><li>B+æ ‘æ˜¯Bæ ‘çš„å˜ä½“ï¼Œä¹Ÿæ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘</li><li>B+æ ‘çš„æœç´¢ä¸ Bæ ‘ä¹ŸåŸºæœ¬ç›¸åŒï¼ŒåŒºåˆ«æ˜¯ B+æ ‘åªæœ‰è¾¾åˆ°å¶å­ç»“ç‚¹æ‰å‘½ä¸­ï¼ˆBæ ‘å¯ä»¥åœ¨éå¶å­ç»“ç‚¹å‘½ä¸­ï¼‰ï¼Œå…¶æ€§èƒ½ä¹Ÿç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾</li><li><strong>æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­ç»“ç‚¹çš„é“¾è¡¨ä¸­</strong>ï¼ˆå³æ•°æ®åªèƒ½åœ¨å¶å­èŠ‚ç‚¹ã€ä¹Ÿå«<strong>ç¨ å¯†ç´¢å¼•</strong>ã€‘ï¼‰ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—(æ•°æ®)æ°å¥½æ˜¯æœ‰åºçš„</li><li><strong>ä¸å¯èƒ½åœ¨éå¶å­ç»“ç‚¹å‘½ä¸­</strong></li><li><strong>éå¶å­ç»“ç‚¹</strong>ç›¸å½“äºæ˜¯å¶å­ç»“ç‚¹çš„<strong>ç´¢å¼•</strong>ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ï¼Œ<strong>å¶å­ç»“ç‚¹</strong>ç›¸å½“äºæ˜¯å­˜å‚¨ï¼ˆå…³é”®å­—ï¼‰<strong>æ•°æ®</strong>çš„æ•°æ®å±‚</li><li>æ›´é€‚åˆæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿ</li><li>Bæ ‘å’Œ B+æ ‘å„æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä¸èƒ½è¯´ B+æ ‘å®Œå…¨æ¯” Bæ ‘å¥½ï¼Œåä¹‹äº¦ç„¶</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815153029.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815153029.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815153043.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815153043.png" alt="img"></a></p><p><strong>åŒºåˆ«</strong></p><ul><li>Bæ ‘çš„<strong>å…³é”®å­—å’Œè®°å½•æ˜¯æ”¾åœ¨ä¸€èµ·çš„</strong>ï¼Œå¶å­èŠ‚ç‚¹å¯ä»¥çœ‹ä½œå¤–éƒ¨èŠ‚ç‚¹ï¼Œä¸åŒ…å«ä»»ä½•ä¿¡æ¯ï¼›B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸­åªæœ‰å…³é”®å­—å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•ï¼Œ<strong>è®°å½•åªæ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­</strong></li><li>åœ¨Bæ ‘ä¸­ï¼Œè¶Šé è¿‘æ ¹èŠ‚ç‚¹çš„è®°å½•æŸ¥æ‰¾æ—¶é—´è¶Šå¿«ï¼Œåªè¦æ‰¾åˆ°å…³é”®å­—å³å¯ç¡®å®šè®°å½•çš„å­˜åœ¨ï¼›è€Œ B+æ ‘ä¸­æ¯ä¸ªè®°å½•çš„æŸ¥æ‰¾æ—¶é—´åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦ä»æ ¹èŠ‚ç‚¹èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”åœ¨å¶å­èŠ‚ç‚¹ä¸­è¿˜è¦å†æ¯”è¾ƒå…³é”®å­—ã€‚ä»è¿™ä¸ªè§’åº¦çœ‹Bæ ‘çš„æ€§èƒ½å¥½åƒè¦æ¯” B+æ ‘å¥½ï¼Œè€Œåœ¨å®é™…åº”ç”¨ä¸­å´æ˜¯ B+æ ‘çš„æ€§èƒ½è¦å¥½äº›ã€‚å› ä¸º B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„æ•°æ®ï¼Œ è¿™æ ·æ¯ä¸ªèŠ‚ç‚¹å¯å®¹çº³çš„å…ƒç´ ä¸ªæ•°æ¯”Bæ ‘å¤šï¼Œæ ‘é«˜æ¯”Bæ ‘å°ï¼Œè¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯å‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°ã€‚å°½ç®¡ B+æ ‘æ‰¾åˆ° ä¸€ä¸ªè®°å½•æ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°è¦æ¯” Bæ ‘å¤šï¼Œä½†æ˜¯ä¸€æ¬¡ç£ç›˜è®¿é—®çš„æ—¶é—´ç›¸å½“äºæˆç™¾ä¸Šåƒæ¬¡å†…å­˜æ¯”è¾ƒçš„æ—¶é—´ï¼Œå› æ­¤å®é™…ä¸­ B+æ ‘çš„æ€§èƒ½å¯èƒ½è¿˜ä¼šå¥½äº›ï¼Œè€Œä¸” B+æ ‘çš„å¶å­èŠ‚ç‚¹ä½¿ç”¨æŒ‡é’ˆè¿æ¥åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿é¡ºåºéå†ï¼ˆä¾‹å¦‚æŸ¥çœ‹ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸€ä¸ªè¡¨ä¸­çš„æ‰€æœ‰è®°å½•ç­‰ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ B+æ ‘çš„ç¼˜æ•…</li></ul><p><strong>ä¸ºä»€ä¹ˆè¯´ B+æ ‘æ¯” B-æ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ</strong></p><ul><li>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½<ul><li>B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹ B æ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´ IO è¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†</li></ul></li><li>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š<ul><li>ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“</li></ul></li></ul><h2 id="MySQLä¸­çš„B-æ ‘"><a href="#MySQLä¸­çš„B-æ ‘" class="headerlink" title="MySQLä¸­çš„B+æ ‘"></a>MySQLä¸­çš„B+æ ‘</h2><p><strong>ä¸šçš„æ¦‚å¿µ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510203700441.png" alt="image-20210510203700441"></p><p><strong>ä¸»é”®ç´¢å¼•</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822173605.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822173605.png" alt="img"></a></p><p>MySQLåœ¨åˆ›å»ºè¡¨æ—¶ï¼Œä¼šæ ¹æ®ä¸»é”®æ¥åˆ›å»ºä¸»é”®ç´¢å¼•ï¼ˆå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œä¼šç”¨ä¸€ä¸ªéšè—å€¼æ¥ä½œä¸ºä¸»é”®ï¼‰ã€‚ä¸»é”®ç´¢å¼•æ‰€æ„å»ºçš„B+æ ‘ï¼Œè¡¨ä¸­æ‰€æœ‰çš„è®°å½•éƒ½å­˜æ”¾åœ¨äº†æ ‘çš„æœ€åä¸€å±‚ã€‚<strong>ä¸”ä¸ä¸€èˆ¬çš„B+æ ‘ä¸åŒçš„æ˜¯ï¼šå¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆæ˜¯åŒå‘çš„</strong></p><p><strong>å¤åˆç´¢å¼•</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822185520.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822185520.png" alt="img"></a></p><p>åˆ›å»ºå¤åˆç´¢å¼•æ—¶ï¼Œä¼šå°†ä½œä¸º<strong>å¤åˆç´¢å¼•å­—æ®µçš„å€¼</strong>è¿›è¡Œæ’åºå¹¶æ”¾åœ¨B+æ ‘çš„æœ€åä¸€å±‚ä¸­ï¼ŒåŒæ—¶è¿˜ä¼šå°†å…¶<strong>å¯¹åº”çš„ä¸»é”®å€¼</strong>æ”¾åœ¨å…¶åã€‚å¦‚ï¼š</p><table><thead><tr><th>aï¼ˆä¸»é”®ï¼‰</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><td>2</td><td>1</td><td>1</td><td>1</td><td>a</td></tr></tbody></table><p>å…¶ä¸­å­—æ®µaä¸ºä¸»é”®ï¼Œå­—æ®µbcdå…±åŒä½œä¸ºå¤åˆç´¢å¼•ï¼Œæ­¤æ—¶å­˜æ”¾åœ¨æœ€åä¸€å±‚çš„æ•°æ®å°±æ˜¯ï¼š111ï¼ˆå¤åˆç´¢å¼•ï¼‰ 2ï¼ˆä¸»é”®ç´¢å¼•ï¼‰</p><p>æ ¹æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥çœ‹å‡ºå¤åˆç´¢å¼•å…·æœ‰ä»¥ä¸‹ä½¿ç”¨æ–¹æ³•</p><ul><li><p>æœ€ä½³å·¦å‰ç¼€ï¼šä½¿ç”¨å¤åˆç´¢å¼•çš„é¡ºåºå¿…é¡»å’Œåˆ›å»ºçš„<strong>é¡ºåºä¸€è‡´</strong></p></li><li><p>è¦†ç›–ç´¢å¼•çš„åŒæ—¶ï¼Œå¯ä»¥å¸¦ä¸Šä¸»é”®å­—æ®µï¼Œå¦‚</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> a, b, c, d <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p>å› ä¸º<strong>ä¸»é”®å­—æ®µå’Œå¤åˆç´¢å¼•ä¸€èµ·å­˜æ”¾åœ¨äº†å¤åˆç´¢å¼•è¯´äº§ç”Ÿçš„B+æ ‘çš„æœ€åä¸€å±‚</strong>ã€‚å¦‚æœéœ€è¦aå­—æ®µï¼Œæ— éœ€è¿›è¡Œå…¨è¡¨æ‰«æ</p></li><li><p>å¦‚æœè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼Œå¯èƒ½ä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œè¿™å–å†³äºå¤„åœ¨èŒƒå›´å†…è®°å½•çš„å¤šå°‘</p><ul><li><p><strong>è®°å½•å¤š</strong>ï¼Œä»å¤åˆç´¢å¼•æ˜ å°„åˆ°ä¸»é”®ç´¢å¼•çš„æ¬¡æ•°è¿‡å¤šï¼Œæˆæœ¬è¿‡é«˜ï¼Œ<strong>ä¼šç›´æ¥è¿›è¡Œå…¨è¡¨æ‰«æ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822175336.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822175336.png" alt="img"></a></p></li><li><p><strong>è®°å½•å°‘</strong>ï¼Œå…ˆ<strong>ä½¿ç”¨å¤åˆç´¢å¼•</strong>ï¼Œç„¶å<strong>æ˜ å°„åˆ°å…¨è¡¨</strong>ä¸­çš„å¯¹åº”è®°å½•ä¸Š</p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">80</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822175403.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822175403.png" alt="img"></a></p></li><li><p>ä½†æ˜¯ä½¿ç”¨<strong>è¦†ç›–ç´¢å¼•</strong>ï¼Œæ— è®ºè®°å½•å¤šå°‘ï¼Œéƒ½ä¼šç”¨åˆ°ç´¢å¼•</p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> age, name <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822175611.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822175611.png" alt="img"></a></p></li><li><p>ä¸å¸¦WHEREä¹Ÿå¯ä»¥é€šè¿‡å¤åˆç´¢å¼•æŸ¥æ‰¾åˆ°ä¸»é”®+å¤åˆç´¢å¼•çš„è®°å½•</p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, age, name, deptId <span class="hljs-keyword">FROM</span> t_emp ;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822175746.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822175746.png" alt="img"></a></p></li></ul></li></ul><h2 id="ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯"><a href="#ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯"></a>ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯</h2><p><strong>é€‚åˆç´¢å¼•çš„åœºæ™¯</strong></p><ul><li>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</li><li>é¢‘ç¹ä½œä¸º<strong>æŸ¥è¯¢æ¡ä»¶</strong>çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼• </li><li>æŸ¥è¯¢ä¸­ä¸å…¶å®ƒè¡¨å…³è”çš„å­—æ®µï¼Œ<strong>å¤–é”®å…³ç³»</strong>å»ºç«‹ç´¢å¼• </li><li>å•é”®/ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Œ<strong>ç»„åˆç´¢å¼•æ€§ä»·æ¯”æ›´é«˜</strong></li><li>æŸ¥è¯¢ä¸­<strong>æ’åºçš„å­—æ®µ</strong>ï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦ </li><li>æŸ¥è¯¢ä¸­<strong>ç»Ÿè®¡</strong>æˆ–è€…<strong>åˆ†ç»„</strong>å­—æ®µ</li></ul><p><strong>ä¸é€‚åˆç´¢å¼•çš„åœºæ™¯</strong></p><ul><li>è¡¨<strong>è®°å½•å¤ªå°‘</strong>ï¼ˆæœ‰æ— ç´¢å¼•å·®åˆ«ä¸å¤§ï¼‰</li><li>ç»å¸¸<strong>å¢åˆ æ”¹</strong>çš„è¡¨æˆ–è€…å­—æ®µ</li><li>Where æ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•</li><li><strong>è¿‡æ»¤æ€§ä¸å¥½</strong>çš„ä¸é€‚åˆå»ºç´¢å¼•ï¼ˆé‡å¤æ€§è¾ƒé«˜ï¼Œæ¯”å¦‚å›½ç±ã€æ€§åˆ«ä¹‹ç±»çš„å­—æ®µï¼‰</li></ul><h1 id="ä¹ã€Explain-æ€§èƒ½åˆ†æ"><a href="#ä¹ã€Explain-æ€§èƒ½åˆ†æ" class="headerlink" title="ä¹ã€Explain æ€§èƒ½åˆ†æ"></a>ä¹ã€Explain æ€§èƒ½åˆ†æ</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>ä½¿ç”¨ <strong>EXPLAIN</strong> å…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“ MySQL æ˜¯å¦‚ä½•å¤„ç†ä½ çš„ SQL è¯­å¥çš„ã€‚<strong>åˆ†æ</strong>ä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„<strong>æ€§èƒ½ç“¶é¢ˆ</strong></p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--EXPLAIN + SQLè¯­å¥ï¼Œå¦‚ï¼š</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person;</code></pre></div><p><strong>Explain æ‰§è¡Œåè¿”å›çš„ä¿¡æ¯ï¼š</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815171636.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815171636.png" alt="img"></a></p><h2 id="è¡¨å¤´å­—æ®µä»‹ç»"><a href="#è¡¨å¤´å­—æ®µä»‹ç»" class="headerlink" title="è¡¨å¤´å­—æ®µä»‹ç»"></a>è¡¨å¤´å­—æ®µä»‹ç»</h2><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t1(id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) AUTO_INCREMENT,content <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NULL</span> , <span class="hljs-keyword">PRIMARY</span> KEY (id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t2(id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) AUTO_INCREMENT,content <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NULL</span> , <span class="hljs-keyword">PRIMARY</span> KEY (id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t3(id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) AUTO_INCREMENT,content <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NULL</span> , <span class="hljs-keyword">PRIMARY</span> KEY (id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t4(id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) AUTO_INCREMENT,content <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NULL</span> , <span class="hljs-keyword">PRIMARY</span> KEY (id));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t1(content) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;t1_&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span><span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span><span class="hljs-number">1000</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t2(content) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;t2_&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span><span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span><span class="hljs-number">1000</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t3(content) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;t3_&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span><span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span><span class="hljs-number">1000</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t4(content) <span class="hljs-keyword">VALUES</span>(CONCAT(<span class="hljs-string">&#x27;t4_&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span><span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span><span class="hljs-number">1000</span>)));</code></pre></div><h3 id="idï¼šè¡¨çš„è¯»å–é¡ºåº"><a href="#idï¼šè¡¨çš„è¯»å–é¡ºåº" class="headerlink" title="idï¼šè¡¨çš„è¯»å–é¡ºåº"></a><strong>idï¼šè¡¨çš„è¯»å–é¡ºåº</strong></h3><p>idæ˜¯selectæŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåº</p><ul><li><p><strong>idç›¸åŒ</strong>ï¼šæ‰§è¡Œé¡ºåºä¸º <strong>ä»ä¸Šè‡³ä¸‹æ‰§è¡Œ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1, t2, t3 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> t2.id <span class="hljs-keyword">AND</span> t2.id <span class="hljs-operator">=</span> t3.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815173157.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815173157.png" alt="img"></a></p><p>æŸ¥è¯¢æ—¶ï¼Œè¡¨çš„åŠ è½½<strong>é¡ºåºä¸ºt1, t2, t3</strong></p></li><li><p><strong>idä¸åŒ</strong>ï¼šæ‰§è¡Œé¡ºåºä¸º <strong>idå¤§çš„å…ˆæ‰§è¡Œ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> t2.id <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t2.id <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.id <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t3.id <span class="hljs-keyword">FROM</span> t3));</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815174216.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815174216.png" alt="img"></a></p><p>æŸ¥è¯¢æ—¶ï¼Œè¡¨çš„åŠ è½½<strong>é¡ºåºä¸ºt3, t1, t2</strong></p></li><li><p><strong>idç›¸åŒåˆä¸åŒ</strong>ï¼š æ‰§è¡Œé¡ºåºä¸º </p><ul><li>idä¸åŒæ—¶ï¼Œå€¼è¾ƒå¤§çš„å…ˆæ‰§è¡Œ</li><li>idç›¸åŒæ—¶ï¼Œä»ä¸Šè‡³ä¸‹æ‰§è¡Œ</li></ul><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> t2.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (    <span class="hljs-keyword">SELECT</span> t3.id    <span class="hljs-keyword">FROM</span> t3    <span class="hljs-keyword">WHERE</span> t3.content <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span>) s1, t2<span class="hljs-keyword">WHERE</span> s1.id <span class="hljs-operator">=</span> t2.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200815174740.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200815174740.png" alt="img"></a></p><p>æŸ¥è¯¢æ—¶ï¼Œè¡¨çš„<strong>åŠ è½½é¡ºåºä¸ºt3, t2, è™šè¡¨dervied2</strong></p><ul><li>å…¶ä¸­dervied<strong>2</strong> çš„ 2ï¼Œä¸º id = 2</li></ul></li></ul><h3 id="select-typeï¼šæŸ¥è¯¢æ“ä½œç±»å‹"><a href="#select-typeï¼šæŸ¥è¯¢æ“ä½œç±»å‹" class="headerlink" title="select_typeï¼šæŸ¥è¯¢æ“ä½œç±»å‹"></a><strong>select_typeï¼šæŸ¥è¯¢æ“ä½œç±»å‹</strong></h3><p>select_typeä»£è¡¨<strong>æŸ¥è¯¢çš„ç±»å‹</strong>ï¼Œä¸»è¦æ˜¯ç”¨äºåŒºåˆ«<strong>æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰</strong>çš„å¤æ‚æŸ¥è¯¢</p><table><thead><tr><th>select_type å±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>SIMPLE</td><td>ç®€å•çš„ select æŸ¥è¯¢,æŸ¥è¯¢ä¸­<strong>ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… UNION</strong></td></tr><tr><td>PRIMARY</td><td>æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œ<strong>æœ€å¤–å±‚</strong>æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸º Primary</td></tr><tr><td>DERIVED</td><td>åœ¨ FROM åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º DERIVED(è¡ç”Ÿ) MySQL ä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢, æŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œ</td></tr><tr><td>SUBQUERY</td><td>åœ¨SELECTæˆ–WHEREåˆ—è¡¨ä¸­åŒ…å«äº†<strong>å­æŸ¥è¯¢</strong></td></tr><tr><td>DEPEDENT SUBQUERY</td><td>åœ¨SELECTæˆ–WHEREåˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢,<strong>å­æŸ¥è¯¢åŸºäºå¤–å±‚</strong></td></tr><tr><td>UNCACHEABLE SUBQUERY</td><td><strong>æ— æ³•ä½¿ç”¨ç¼“å­˜</strong>çš„å­æŸ¥è¯¢</td></tr><tr><td>UNION</td><td>è‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸ºUNIONï¼› è‹¥UNIONåŒ…å«åœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­,å¤–å±‚SELECTå°†è¢«æ ‡è®°ä¸ºï¼šDERIVED</td></tr><tr><td>UNION RESULT</td><td>ä»UNIONè¡¨<strong>è·å–ç»“æœ</strong>çš„SELECT</td></tr></tbody></table><ul><li><p>SUBQUERY å’Œ DEPEDENT SUBQUERY</p></li><li><p>éƒ½æ˜¯ WHERE åé¢çš„æ¡ä»¶ï¼ŒSUBQUERY æ˜¯å•ä¸ªå€¼ï¼ˆ=ï¼‰ï¼ŒDEPEDENT SUBQUERY æ˜¯ä¸€ç»„å€¼ï¼ˆINï¼‰</p></li><li><p>UNCACHEABLE SUBQUERY</p></li><li><p>å½“ä½¿ç”¨äº†**@@æ¥å¼•ç”¨ç³»ç»Ÿå˜é‡**çš„æ—¶å€™ï¼Œä¸ä¼šä½¿ç”¨ç¼“å­˜</p></li><li><p>UNION å’Œ UNION RESULT </p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>  t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> b.id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span><span class="hljs-keyword">UNION</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp a <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span>  t_dept b <span class="hljs-keyword">ON</span> a.deptId <span class="hljs-operator">=</span> b.id <span class="hljs-keyword">WHERE</span> a.deptId <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816135453.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816135453.png" alt="img"></a></p></li></ul><h3 id="tableï¼šè¡¨çš„æ¥æº"><a href="#tableï¼šè¡¨çš„æ¥æº" class="headerlink" title="tableï¼šè¡¨çš„æ¥æº"></a><strong>tableï¼šè¡¨çš„æ¥æº</strong></h3><p>tableè¡¨ç¤ºè¿™ä¸ªæ•°æ®æ˜¯åŸºäºå“ªå¼ è¡¨çš„</p><h3 id="typeï¼šè®¿é—®ç±»å‹"><a href="#typeï¼šè®¿é—®ç±»å‹" class="headerlink" title="typeï¼šè®¿é—®ç±»å‹"></a><strong>typeï¼šè®¿é—®ç±»å‹</strong></h3><p>type æ˜¯æŸ¥è¯¢çš„è®¿é—®ç±»å‹ã€‚<strong>æ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡</strong>ï¼Œç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs css">system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; all--å¸¸è§çš„é¡ºåºä¸ºsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</code></pre></div><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢<strong>è‡³å°‘è¾¾åˆ° range çº§åˆ«</strong>ï¼Œæœ€å¥½èƒ½è¾¾åˆ° ref</p><table><thead><tr><th>ç±»å‹å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>SYSTEM</td><td>è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯ const ç±»å‹çš„ç‰¹åˆ—ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªä¹Ÿ<strong>å¯ä»¥å¿½ç•¥ä¸è®¡</strong></td></tr><tr><td>CONST</td><td>è¡¨ç¤º<strong>é€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†</strong>,const ç”¨äºæ¯”è¾ƒ primary key æˆ–è€… unique ç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äº where åˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡</td></tr><tr><td>EQ_REF</td><td>å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œ<strong>è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…</strong>ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æ</td></tr><tr><td>REF</td><td>éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œ ç„¶è€Œï¼Œå®ƒ<strong>å¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œ</strong>ï¼Œæ‰€ä»¥ä»–åº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“</td></tr><tr><td>RANGE</td><td>åªæ£€ç´¢ç»™å®š<strong>èŒƒå›´</strong>çš„è¡Œ,ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚key åˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„ where è¯­å¥ä¸­å‡ºç° äº† betweenã€&lt;ã€&gt;ã€in ç­‰çš„æŸ¥è¯¢è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œ ç»“æŸè¯­å¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•</td></tr><tr><td>INDEX</td><td>å‡ºç°indexæ˜¯sqlä½¿ç”¨äº†ç´¢å¼•ä½†æ˜¯æ²¡ç”¨é€šè¿‡ç´¢å¼•è¿›è¡Œè¿‡æ»¤ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•æˆ–è€…æ˜¯åˆ©ç”¨ç´¢å¼•è¿›è¡Œäº†æ’åºåˆ†ç»„</td></tr><tr><td>ALL</td><td>Full Table Scanï¼Œå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</td></tr></tbody></table><ul><li><p>REF</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…¶ä¸­deptIdä¸ºç´¢å¼•ï¼Œä¸”ç”¨åˆ°äº†&#x27; = &#x27;</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816165420.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816165420.png" alt="img"></a></p></li><li><p>RANGE</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…¶ä¸­deptIdä¸ºç´¢å¼•ï¼Œç”¨åˆ°äº† BETWEEN...AND... , IN , &gt; , &lt; ç­‰èŒƒå›´æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> deptId <span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816213631.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816213631.png" alt="img"></a></p></li><li><p>INDEX</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…¶ä¸­deptIdä¸ºç´¢å¼•ï¼ŒæŸ¥æ‰¾äº†æ•´å¼ è¡¨æ—¶ï¼Œç”¨åˆ°äº†ç´¢å¼•</span>EXPLAIN <span class="hljs-keyword">SELECT</span> deptId <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816165651.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816165651.png" alt="img"></a></p></li><li><p>ALL</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…¶ä¸­nameä¸ºéç´¢å¼•</span>EXPLAIN <span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816165722.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816165722.png" alt="img"></a></p></li></ul><h3 id="possible-keyï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•"><a href="#possible-keyï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•" class="headerlink" title="possible_keyï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•"></a><strong>possible_keyï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</strong></h3><p>æ˜¾ç¤º<strong>å¯èƒ½</strong>åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†<strong>ä¸ä¸€ å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨</strong></p><h3 id="keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•"><a href="#keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•"></a><strong>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</strong></h3><p><strong>å®é™…ä½¿ç”¨çš„ç´¢å¼•</strong>ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816172950.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816172950.png" alt="img"></a></p><p>MySQLæ¨æµ‹å¯èƒ½ç”¨åˆ°ä¸»é”®ç´¢å¼•å’Œidx_dept_idç´¢å¼•ï¼Œå®é™…ä¸Šç”¨åˆ°çš„æ˜¯ä¸»é”®ç´¢å¼•</p><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a><strong>è¦†ç›–ç´¢å¼•</strong></h4><p>å½“æŸ¥æ‰¾çš„å­—æ®µä¸å»ºç«‹çš„ç´¢å¼•çš„åŒ¹é…ï¼ˆæŸ¥è¯¢çš„å­—æ®µéƒ½æ˜¯ç´¢å¼•ï¼Œä½†ä¸éœ€è¦å…¨æ˜¯ç´¢å¼•ï¼‰æ—¶ï¼Œä¼šå‘ç”Ÿè¦†ç›–ç´¢å¼•ã€‚MySQLæ¨æµ‹ä½¿ç”¨çš„ç´¢å¼•ä¸ºNULLï¼Œè€Œå®é™…ä¸Šä¼šä½¿ç”¨ç´¢å¼•</p><p>æœ‰ä»¥ä¸‹ä¸¤ç§è§£é‡Š</p><ul><li>selectçš„æ•°æ®åˆ—<strong>åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—</strong>ï¼Œä¸å¿…ä»æ•°æ®è¡¨ä¸­è¯»å–ï¼Œæ¢å¥è¯è¯´<strong>æŸ¥è¯¢åˆ—è¦è¢«æ‰€ä½¿ç”¨çš„ç´¢å¼•è¦†ç›–</strong></li><li>ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå½“èƒ½é€šè¿‡æ£€ç´¢ç´¢å¼•å°±å¯ä»¥è¯»å–æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦å†åˆ°æ•°æ®è¡¨ä¸­è¯»å–è¡Œäº†ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«äº†ï¼ˆæˆ–è¦†ç›–äº†ï¼‰æ»¡è¶³æŸ¥è¯¢è¯­å¥ä¸­å­—æ®µä¸æ¡ä»¶çš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•</li></ul><p>æ³¨æ„ï¼šè¦ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œåˆ™<strong>åªå–å‡ºéœ€è¦çš„åˆ—</strong>ï¼ˆè¢«ä»¤ä¸ºç´¢å¼•ï¼‰ï¼Œ<strong>ä¸è¦</strong>ä½¿ç”¨ SELECT *</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…¶ä¸­idå’ŒdeptIdéƒ½ä¸ºç´¢å¼•</span>EXPLAIN <span class="hljs-keyword">SELECT</span> id, deptId <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816173253.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816173253.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816173228.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816173228.png" alt="img"></a></p><h3 id="key-lenï¼šç´¢å¼•ä½¿ç”¨å­—èŠ‚æ•°"><a href="#key-lenï¼šç´¢å¼•ä½¿ç”¨å­—èŠ‚æ•°" class="headerlink" title="key_lenï¼šç´¢å¼•ä½¿ç”¨å­—èŠ‚æ•°"></a><strong>key_lenï¼šç´¢å¼•ä½¿ç”¨å­—èŠ‚æ•°</strong></h3><p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚ key_len å­—æ®µèƒ½å¤Ÿå¸®ä½ æ£€æŸ¥æ˜¯å¦å……åˆ†çš„åˆ©ç”¨ä¸Šäº†ç´¢å¼•</p><p><strong>ken_len è¶Šé•¿ï¼Œè¯´æ˜ç´¢å¼•ä½¿ç”¨çš„è¶Šå……åˆ†</strong></p><h3 id="refï¼šæ˜¾ç¤ºè¢«ä½¿ç”¨çš„ç´¢å¼•çš„å…·ä½“ä¿¡æ¯"><a href="#refï¼šæ˜¾ç¤ºè¢«ä½¿ç”¨çš„ç´¢å¼•çš„å…·ä½“ä¿¡æ¯" class="headerlink" title="refï¼šæ˜¾ç¤ºè¢«ä½¿ç”¨çš„ç´¢å¼•çš„å…·ä½“ä¿¡æ¯"></a><strong>refï¼šæ˜¾ç¤ºè¢«ä½¿ç”¨çš„ç´¢å¼•çš„å…·ä½“ä¿¡æ¯</strong></h3><p>refæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_dept, t_emp <span class="hljs-keyword">WHERE</span> t_emp.deptId <span class="hljs-operator">=</span> t_dept.id;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816194305.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816194305.png" alt="img"></a></p><p>refä¸­å¦‚æœæœ‰constå°±ä»£è¡¨åœ¨whereæ¡ä»¶ä¸­åŠ ä¸Šäº†<code>t_emp.xx = &#39;xxx&#39;</code>åŒ¹é…äº†å¸¸é‡</p><h3 id="rowsï¼šè¢«æŸ¥è¯¢çš„è¡Œæ•°"><a href="#rowsï¼šè¢«æŸ¥è¯¢çš„è¡Œæ•°" class="headerlink" title="rowsï¼šè¢«æŸ¥è¯¢çš„è¡Œæ•°"></a><strong>rowsï¼šè¢«æŸ¥è¯¢çš„è¡Œæ•°</strong></h3><p>rows åˆ—æ˜¾ç¤º MySQL è®¤ä¸ºå®ƒæ‰§è¡ŒæŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ã€‚<strong>è¶Šå°‘è¶Šå¥½ï¼</strong></p><p><strong>éªŒè¯</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…ˆåˆ é™¤ç´¢å¼•</span><span class="hljs-keyword">DROP</span> INDEX idx_dept_id <span class="hljs-keyword">ON</span> t_emp;<span class="hljs-comment">--æŸ¥æ‰¾</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_dept, t_emp <span class="hljs-keyword">WHERE</span> t_emp.deptId <span class="hljs-operator">=</span> t_dept.id;<span class="hljs-comment">--å†åˆ›å»ºç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_dept_id <span class="hljs-keyword">ON</span> t_emp(deptId);<span class="hljs-comment">--æŸ¥æ‰¾</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_dept, t_emp <span class="hljs-keyword">WHERE</span> t_emp.deptId <span class="hljs-operator">=</span> t_dept.id;</code></pre></div><p><strong>ç»“æœå¦‚ä¸‹</strong></p><ul><li><p>æœªä½¿ç”¨ç´¢å¼•æ—¶ï¼Œä¸€å…±éœ€è¦æŸ¥è¯¢26è¡Œ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816195241.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816195241.png" alt="img"></a></p></li><li><p>ä½¿ç”¨ç´¢å¼•åï¼Œä¸€å…±éœ€è¦æŸ¥è¯¢6è¡Œ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816195401.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816195401.png" alt="img"></a></p></li></ul><h3 id="Extraï¼šé¢å¤–é‡è¦ä¿¡æ¯"><a href="#Extraï¼šé¢å¤–é‡è¦ä¿¡æ¯" class="headerlink" title="Extraï¼šé¢å¤–é‡è¦ä¿¡æ¯"></a><strong>Extraï¼šé¢å¤–é‡è¦ä¿¡æ¯</strong></h3><p>å…¶ä»–çš„é¢å¤–<strong>é‡è¦</strong>çš„ä¿¡æ¯</p><h4 id="Using-filesort"><a href="#Using-filesort" class="headerlink" title="Using filesort"></a><strong>Using filesort</strong></h4><ul><li>ä½¿ç”¨å¤–éƒ¨ç´¢å¼•æ’åºï¼ˆæœªä½¿ç”¨ç”¨æˆ·åˆ›å»ºçš„ç´¢å¼•ï¼‰</li><li>è¯´æ˜ mysql ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQL ä¸­æ— æ³•åˆ©ç”¨ç´¢å¼• å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€</li><li>å‡ºç° Using filesort <strong>è¯´æ˜SQLè¯­å¥è®¾è®¡çš„ä¸å¥½</strong>ï¼Œ<strong>æ²¡æœ‰æŒ‰ç…§åˆ›å»ºçš„ç´¢å¼•è¿›è¡Œæ’åº</strong>ï¼Œæˆ–è€…<strong>æœªæŒ‰ç…§ç´¢å¼•æŒ‡å®šçš„é¡ºåºè¿›è¡Œæ’åº</strong></li></ul><p><strong>æ¼”ç¤º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--åˆ›å»ºç¬¦åˆç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_emp_empno_age <span class="hljs-keyword">ON</span> t_emp(empno, age);<span class="hljs-comment">--è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé€šè¿‡ age å­—æ®µè¿›è¡Œæ’åºï¼ˆæœªæŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºæŸ¥è¯¢ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age;<span class="hljs-comment">--è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé€šè¿‡ empno æˆ–è€… empno + age å­—æ®µè¿›è¡Œæ’åºï¼ˆæŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºæŸ¥è¯¢ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> empno;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> empno, age;</code></pre></div><p><strong>ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816205145.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816205145.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816205226.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816205226.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816205112.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816205112.png" alt="img"></a></p><h4 id="Using-temporary"><a href="#Using-temporary" class="headerlink" title="Using temporary"></a><strong>Using temporary</strong></h4><ul><li>ä½¿äº†ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœ,MySQL åœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚<strong>å¸¸è§äºæ’åº order by å’Œåˆ†ç»„æŸ¥è¯¢ group by</strong></li><li>å‡ºç° Using temporary <strong>è¯´æ˜SQLè¯­å¥è®¾è®¡çš„éå¸¸ä¸å¥½</strong>ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰æŒ‰ç…§é¡ºåºä½¿ç”¨å¤åˆç´¢å¼•</li></ul><p><strong>æ¼”ç¤º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œ é€šè¿‡ age å­—æ®µè¿›è¡Œåˆ†ç»„ï¼ˆæœªæŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºæŸ¥è¯¢ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> age;<span class="hljs-comment">----è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé€šè¿‡ empno æˆ–è€… empno + age å­—æ®µè¿›è¡Œåˆ†ç»„ï¼ˆæŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºæŸ¥è¯¢ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empno;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">&gt;</span><span class="hljs-number">100002</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empno, age;</code></pre></div><p><strong>ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816210843.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816210843.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816210908.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816210908.png" alt="img"></a></p><p><strong>é‡è¦ç»“è®º</strong></p><p>å¦‚æœåˆ›å»ºäº†<strong>å¤åˆç´¢å¼•</strong>ï¼Œä¸€å®šè¦<strong>æŒ‰ç…§å¤åˆç´¢å¼•çš„é¡ºåºæ¥ä½¿ç”¨</strong>ï¼Œå¦åˆ™ä¼šä½¿å¾—æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚</p><p>filesortåªèƒ½åº”ç”¨åœ¨å•ä¸ªè¡¨ä¸Šï¼Œå¦‚æœæœ‰å¤šä¸ªè¡¨çš„æ•°æ®éœ€è¦æ’åºï¼Œé‚£ä¹ˆMySQLä¼šå…ˆä½¿ç”¨using temporaryä¿å­˜ä¸´æ—¶æ•°æ®ï¼Œç„¶åå†åœ¨ä¸´æ—¶è¡¨ä¸Šä½¿ç”¨filesortè¿›è¡Œæ’åºï¼Œæœ€åè¾“å‡ºç»“æœã€‚</p><h4 id="Using-index"><a href="#Using-index" class="headerlink" title="Using index"></a><strong>Using index</strong></h4><ul><li>Using index ä»£è¡¨è¡¨ç¤ºç›¸åº”çš„ select æ“ä½œä¸­ä½¿ç”¨äº†<strong>è¦†ç›–ç´¢å¼•</strong>(Covering Index)ï¼Œè¯¦è§[keyï¼šå®é™…ç”¨åˆ°çš„ç´¢å¼•â€”â€”è¦†ç›–ç´¢å¼•](# è¦†ç›–ç´¢å¼•)ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œ<strong>æ•ˆç‡ä¸é”™</strong>ï¼ </li><li>å¦‚æœåŒæ—¶å‡ºç° using whereï¼Œè¡¨æ˜<strong>ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾</strong></li><li>å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç° using whereï¼Œè¡¨æ˜<strong>ç´¢å¼•åªæ˜¯ç”¨æ¥è¯»å–æ•°æ®</strong>è€Œéåˆ©ç”¨ç´¢å¼•æ‰§è¡ŒæŸ¥æ‰¾ã€‚</li></ul><p><strong>æ¼”ç¤º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢ age å­—æ®µï¼Œä½¿ç”¨äº†WHERE</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span><span class="hljs-number">100000</span>;<span class="hljs-comment">--æŸ¥è¯¢ empno å’Œ age å­—æ®µï¼Œæœªä½¿ç”¨WHERE</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno, age <span class="hljs-keyword">FROM</span> t_emp;<span class="hljs-comment">--æŸ¥è¯¢ empno å’Œ name å­—æ®µ ï¼ˆnameå­—æ®µä¸æ˜¯ç´¢å¼•ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno, name <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><strong>ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816212055.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816212055.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816212129.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816212129.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200816212243.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200816212243.png" alt="img"></a></p><h4 id="Using-where"><a href="#Using-where" class="headerlink" title="Using where"></a>Using where</h4><ul><li>è¡¨æ˜ä½¿ç”¨äº† where è¿‡æ»¤</li></ul><h4 id="Using-join-buffer"><a href="#Using-join-buffer" class="headerlink" title="Using join buffer"></a>Using join buffer</h4><ul><li>ä½¿ç”¨äº†è¿æ¥ç¼“å­˜</li></ul><h4 id="impossible-where"><a href="#impossible-where" class="headerlink" title="impossible where"></a>impossible where</h4><ul><li>where å­å¥çš„å€¼æ€»æ˜¯ falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„</li></ul><h4 id="select-tables-optimized-away"><a href="#select-tables-optimized-away" class="headerlink" title="select tables optimized away"></a>select tables optimized away</h4><ul><li>åœ¨æ²¡æœ‰ GROUP BY å­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ– MIN/MAX æ“ä½œæˆ–è€…å¯¹äº MyISAM å­˜å‚¨å¼•æ“ä¼˜åŒ– COUNT(*)æ“ ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–</li></ul><h1 id="åã€å•è¡¨æŸ¥è¯¢ä¼˜åŒ–"><a href="#åã€å•è¡¨æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="åã€å•è¡¨æŸ¥è¯¢ä¼˜åŒ–"></a>åã€å•è¡¨æŸ¥è¯¢ä¼˜åŒ–</h1><h2 id="å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"><a href="#å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±" class="headerlink" title="å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"></a>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å»ºç«‹ç¬¦åˆç´¢å¼•ï¼ˆage, deptId, nameï¼‰</span><span class="hljs-keyword">CREATE</span> INDEX idx_emp_ade <span class="hljs-keyword">ON</span> t_emp(age, deptId, NAME);<span class="hljs-comment">--æŸ¥æ‰¾</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;<span class="hljs-comment">--å’Œä¸Šä¸€æ¡SQLè¯­å¥ä¸­WHEREåå­—æ®µçš„é¡ºåºä¸åŒï¼Œä½†æ˜¯ä¸å½±å“æŸ¥è¯¢ç»“æœ</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span> <span class="hljs-keyword">AND</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164200.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164200.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164226.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164226.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164241.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164241.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164506.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164506.png" alt="img"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å¤åˆç´¢å¼•éƒ½è¢«ç”¨åˆ°äº†ï¼Œå¹¶ä¸”SQLä¸­æŸ¥è¯¢å­—æ®µçš„é¡ºåºï¼Œè·Ÿä½¿ç”¨ç´¢å¼•ä¸­å­—æ®µçš„é¡ºåºï¼Œæ²¡æœ‰å…³ç³»</strong>ã€‚ä¼˜åŒ–å™¨ä¼šåœ¨ä¸å½±å“ SQL æ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œè‡ªåŠ¨åœ°ä¼˜åŒ–</p><p><strong>ç»“è®ºï¼šå…¨èŒåŒ¹é…æˆ‘æœ€çˆ±æŒ‡çš„æ˜¯ï¼ŒæŸ¥è¯¢çš„å­—æ®µæŒ‰ç…§é¡ºåºåœ¨ç´¢å¼•ä¸­éƒ½å¯ä»¥åŒ¹é…åˆ°</strong></p><h2 id="æœ€ä½³å·¦å‰ç¼€æ³•åˆ™"><a href="#æœ€ä½³å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="æœ€ä½³å·¦å‰ç¼€æ³•åˆ™"></a><strong>æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</strong></h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…ˆåˆ é™¤ä¹‹å‰åˆ›å»ºçš„å•å€¼ç´¢å¼•</span><span class="hljs-keyword">DROP</span> INDEX idx_dept_id <span class="hljs-keyword">ON</span> t_emp; <span class="hljs-comment">--æŸ¥è¯¢ï¼ŒæœªæŒ‰ç…§æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;<span class="hljs-comment">--æŸ¥è¯¢ï¼Œéƒ¨åˆ†æŒ‰ç…§æœ€ä½³å·¦å‰ç¼€æ³•åˆ™ï¼ˆageå­—æ®µå’Œå¤åˆç´¢å¼•åŒ¹é…ï¼Œä½†nameæ²¡æœ‰ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span>  age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;<span class="hljs-comment">--æŸ¥è¯¢ï¼Œå®Œå…¨æŒ‰ç…§æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164932.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164932.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164948.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164948.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817165100.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817165100.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164226.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164226.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817164506.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817164506.png" alt="img"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢<strong>å­—æ®µä¸ç´¢å¼•å­—æ®µé¡ºåºçš„ä¸åŒä¼šå¯¼è‡´ï¼Œç´¢å¼•æ— æ³•å……åˆ†ä½¿ç”¨ï¼Œç”šè‡³ç´¢å¼•å¤±æ•ˆ</strong></p><p><strong>åŸå› </strong>ï¼šä½¿ç”¨å¤åˆç´¢å¼•ï¼Œéœ€è¦<strong>éµå¾ªæœ€ä½³å·¦å‰ç¼€æ³•åˆ™</strong>ï¼Œå³å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„<strong>æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</strong>ï¼Œä¿—ç§°ä¸­é—´å…„å¼Ÿä¸èƒ½æ–­</p><p><strong>ç»“è®ºï¼šè¿‡æ»¤æ¡ä»¶è¦ä½¿ç”¨ç´¢å¼•å¿…é¡»æŒ‰ç…§ç´¢å¼•å»ºç«‹æ—¶çš„é¡ºåºï¼Œä¾æ¬¡æ»¡è¶³ï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œç´¢å¼•åé¢çš„å­—æ®µéƒ½æ— æ³•è¢«ä½¿ç”¨</strong></p><h2 id="ç´¢å¼•åˆ—ä¸Šä¸è®¡ç®—"><a href="#ç´¢å¼•åˆ—ä¸Šä¸è®¡ç®—" class="headerlink" title="ç´¢å¼•åˆ—ä¸Šä¸è®¡ç®—"></a><strong>ç´¢å¼•åˆ—ä¸Šä¸è®¡ç®—</strong></h2><p>ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ã€å‡½æ•°ã€(è‡ªåŠ¨ or æ‰‹åŠ¨)ç±»å‹è½¬æ¢ï¼‰ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æ</strong></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--ç›´æ¥æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;<span class="hljs-comment">--ä½¿ç”¨MySQLå‡½æ•°æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">LEFT</span>(age,<span class="hljs-number">2</span>) <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817170139.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817170139.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817170522.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817170522.png" alt="img"></a></p><p>å¯ä»¥çœ‹å‡ºï¼Œå½“ageå­—æ®µä½¿ç”¨äº†leftå‡½æ•°ä»¥åï¼Œ<strong>å¯¼è‡´ç´¢å¼•å®Œå…¨å¤±æ•ˆ</strong></p><p><strong>ç»“è®ºï¼šç­‰å·å·¦è¾¹æ— è®¡ç®—</strong></p><h2 id="èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ"><a href="#èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ" class="headerlink" title="èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ"></a>èŒƒå›´ä¹‹åå…¨å¤±æ•ˆ</h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--èŒƒå›´æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;<span class="hljs-comment">--æœªä½¿ç”¨èŒƒå›´æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span> <span class="hljs-keyword">AND</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817171833.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817171833.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817172159.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817172159.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817171903.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817171903.png" alt="img"></a></p><p>å¯ä»¥çœ‹å‡ºï¼Œå½“å¯¹ageå­—æ®µä½¿ç”¨èŒƒå›´æŸ¥è¯¢åï¼Œä½¿å¾—èŒƒå›´åé¢çš„ç´¢å¼•å¤±æ•ˆäº†</p><p><strong>å»ºè®®ï¼š</strong>å°†å¯èƒ½åšèŒƒå›´æŸ¥è¯¢çš„å­—æ®µçš„ç´¢å¼•é¡ºåº<strong>æ”¾åœ¨æœ€å</strong></p><p><strong>ç»“è®ºï¼šä½¿ç”¨èŒƒå›´æŸ¥è¯¢åï¼Œå¦‚æœèŒƒå›´å†…çš„è®°å½•è¿‡å¤šï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>ï¼Œå› ä¸ºä»è‡ªå®šä¹‰ç´¢å¼•æ˜ å°„åˆ°ä¸»é”®ç´¢å¼•éœ€è¦è€—è´¹å¤ªå¤šçš„æ—¶é—´ï¼Œåè€Œä¸å¦‚å…¨è¡¨æ‰«ææ¥å¾—å¿«</p><h2 id="è¦†ç›–ç´¢å¼•å¤šä½¿ç”¨"><a href="#è¦†ç›–ç´¢å¼•å¤šä½¿ç”¨" class="headerlink" title="è¦†ç›–ç´¢å¼•å¤šä½¿ç”¨"></a>è¦†ç›–ç´¢å¼•å¤šä½¿ç”¨</h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢æ‰€æœ‰å­—æ®µ</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<span class="hljs-comment">--æŸ¥è¯¢ç´¢å¼•å­—æ®µ</span>EXPLAIN <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t_dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817173338.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817173338.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817173314.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817173314.png" alt="img"></a></p><p><strong>ç»“è®ºï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆUsing indexï¼‰ä¼šæé«˜æ£€ç´¢æ•ˆç‡</strong></p><h2 id="ä½¿ç”¨ä¸ç­‰ä¼šå¤±æ•ˆ"><a href="#ä½¿ç”¨ä¸ç­‰ä¼šå¤±æ•ˆ" class="headerlink" title="ä½¿ç”¨ä¸ç­‰ä¼šå¤±æ•ˆ"></a>ä½¿ç”¨ä¸ç­‰ä¼šå¤±æ•ˆ</h2><p>åœ¨ä½¿ç”¨<strong>ä¸ç­‰äº(!= æˆ–è€…&lt;&gt;)æ—¶</strong>ï¼Œæœ‰æ—¶ä¼šæ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--SQLè¯­å¥ä¸­æœ‰ä¸ç­‰äº</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">!=</span> <span class="hljs-number">90</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">90</span>;<span class="hljs-comment">--SQLè¯­å¥ä¸­æ²¡æœ‰ä¸ç­‰äº</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817180448.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817180448.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817180505.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817180505.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817180521.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817180521.png" alt="img"></a></p><p><strong>ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨ä¸ç­‰äº</strong></p><h2 id="ä½¿ç”¨NULLå€¼è¦å°å¿ƒ"><a href="#ä½¿ç”¨NULLå€¼è¦å°å¿ƒ" class="headerlink" title="ä½¿ç”¨NULLå€¼è¦å°å¿ƒ"></a>ä½¿ç”¨NULLå€¼è¦å°å¿ƒ</h2><p>åœ¨ä½¿ç”¨</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>æˆ–è€…<span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span></code></pre></div><p>æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p><p>ä½†æ˜¯å¦‚æœ<strong>å…è®¸å­—æ®µä¸ºç©º</strong>ï¼Œåˆ™</p><ul><li>IS NULL ä¸ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li><li>IS NOT NULL ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817181044.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817181044.png" alt="img"></a></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817181116.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817181116.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817181137.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817181137.png" alt="img"></a></p><h2 id="æ¨¡ç³ŠæŸ¥è¯¢åŠ å³è¾¹"><a href="#æ¨¡ç³ŠæŸ¥è¯¢åŠ å³è¾¹" class="headerlink" title="æ¨¡ç³ŠæŸ¥è¯¢åŠ å³è¾¹"></a>æ¨¡ç³ŠæŸ¥è¯¢åŠ å³è¾¹</h2><p>è¦ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼Œ<strong>ç™¾åˆ†å·æœ€å¥½åŠ åœ¨å³è¾¹ï¼Œè€Œä¸”è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯å•å€¼ç´¢å¼•</strong></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--åˆ›å»ºå•å€¼ç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_emp_name <span class="hljs-keyword">ON</span> t_emp(NAME);<span class="hljs-comment">--è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%é£&#x27;</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;é£%&#x27;</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%é£%&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183416.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183416.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183401.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183401.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183416.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183416.png" alt="img"></a></p><p>å¯ä»¥çœ‹å‡ºï¼Œå¯¹ç´¢å¼•ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼Œ<strong>åªæœ‰å½“ç™¾åˆ†å·åœ¨å³è¾¹ï¼Œç´¢å¼•ä¸ºå•å€¼ç´¢å¼•ä¸”æ¨¡ç³ŠæŸ¥è¯¢è¯­å¥åœ¨æœ€å³è¾¹æ—¶ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆ</strong></p><p>å…¶ä»–æƒ…å†µå‡å¤±æ•ˆäº†</p><p><strong>ä½†æ˜¯</strong>æœ‰æ—¶å¿…é¡»ä½¿ç”¨å…¶ä»–ç±»å‹çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨<strong>è¦†ç›–ç´¢å¼•</strong>æ¥è§£å†³ç´¢å¼•å¤±æ•ˆçš„é—®é¢˜</p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%é£&#x27;</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;é£%&#x27;</span>;EXPLAIN <span class="hljs-keyword">SELECT</span> NAME <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%é£%&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183741.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183741.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183801.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183801.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817183741.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817183741.png" alt="img"></a></p><p><strong>ç»“è®ºï¼šå¯¹ç´¢å¼•è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼Œæœ€å¥½åœ¨å³è¾¹åŠ ç™¾åˆ†å·ã€‚å¿…é¡»åœ¨å·¦è¾¹æˆ–å·¦å³åŠ ç™¾åˆ†å·æ—¶ï¼Œéœ€è¦ç”¨åˆ°è¦†ç›–ç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡</strong></p><h2 id="å­—ç¬¦ä¸²åŠ å•å¼•å·"><a href="#å­—ç¬¦ä¸²åŠ å•å¼•å·" class="headerlink" title="å­—ç¬¦ä¸²åŠ å•å¼•å·"></a>å­—ç¬¦ä¸²åŠ å•å¼•å·</h2><p>å½“å­—æ®µä¸ºå­—ç¬¦ä¸²æ—¶ï¼ŒæŸ¥è¯¢æ—¶å¿…é¡»å¸¦ä¸Šå•å¼•å·ã€‚å¦åˆ™<strong>ä¼šå‘ç”Ÿè‡ªåŠ¨çš„ç±»å‹è½¬æ¢</strong>ï¼Œä»è€Œå‘ç”Ÿå…¨è¡¨æ‰«æ</p><p><strong>ç”¨äºæŸ¥è¯¢çš„è¡¨</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817203952.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817203952.png" alt="img"></a></p><p><strong>å…¶ä¸­card_idå­—æ®µä¸ºvarcharç±»å‹ï¼Œä¸”è®¾ç½®äº†å•å€¼ç´¢å¼•</strong></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--ä½¿ç”¨äº†å•å¼•å·</span>EXPLAIN <span class="hljs-keyword">SELECT</span> card_id <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> card_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span>;<span class="hljs-comment">--æœªä½¿ç”¨å•å¼•å·ï¼Œå‘ç”Ÿè‡ªåŠ¨ç±»å‹è½¬æ¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> card_id <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">WHERE</span> card_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817204047.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817204047.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817204027.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817204027.png" alt="img"></a></p><h2 id="å°½é‡ä¸ç”¨oræŸ¥è¯¢"><a href="#å°½é‡ä¸ç”¨oræŸ¥è¯¢" class="headerlink" title="å°½é‡ä¸ç”¨oræŸ¥è¯¢"></a><strong>å°½é‡ä¸ç”¨oræŸ¥è¯¢</strong></h2><p>å¦‚æœä½¿ç”¨orï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚æ‰€ä»¥è¦å‡å°‘orçš„ä½¿ç”¨ï¼Œå¯ä»¥<strong>ä½¿ç”¨ union all æˆ–è€… union æ¥æ›¿ä»£ï¼š</strong></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--ä½¿ç”¨orè¿›è¡ŒæŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">OR</span> NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£æ¸…æ‰¬&#x27;</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200817204307.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200817204307.png" alt="img"></a></p><h2 id="å£è¯€"><a href="#å£è¯€" class="headerlink" title="å£è¯€"></a>å£è¯€</h2><p>å…¨èŒåŒ¹é…æˆ‘æœ€çˆ±ï¼Œæœ€å·¦å‰ç¼€è¦éµå®ˆ</p><p>å¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­</p><p>ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ï¼ŒèŒƒå›´ä¹‹åå…¨å¤±æ•ˆ</p><p>LIKE ç™¾åˆ†å†™æœ€å³ï¼Œè¦†ç›–ç´¢å¼•ä¸å†™</p><p>ä¸ç­‰ç©ºå€¼è¿˜æœ‰ ORï¼Œç´¢å¼•å½±å“è¦æ³¨æ„</p><p>VARCHAR å¼•å·ä¸å¯ä¸¢ï¼ŒSQL ä¼˜åŒ–æœ‰è¯€çª</p><h1 id="åä¸€ã€å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#åä¸€ã€å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="åä¸€ã€å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>åä¸€ã€å…³è”æŸ¥è¯¢ä¼˜åŒ–</h1><p><strong>å»ºè¡¨è¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> `class` (`id` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT, `card` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">PRIMARY</span> KEY (`id`));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> `book` (`bookid` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT, `card` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">PRIMARY</span> KEY (`bookid`));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> class(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> book(card) <span class="hljs-keyword">VALUES</span>(<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span> <span class="hljs-operator">+</span> (RAND() <span class="hljs-operator">*</span> <span class="hljs-number">20</span>)));</code></pre></div><h2 id="LEFT-JOINä¼˜åŒ–"><a href="#LEFT-JOINä¼˜åŒ–" class="headerlink" title="LEFT JOINä¼˜åŒ–"></a>LEFT JOINä¼˜åŒ–</h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æœªå»ºç«‹ç´¢å¼•æ—¶çš„å·¦å¤–è¿æ¥æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;<span class="hljs-comment">--å·¦è¡¨ï¼ˆclassï¼‰å»ºç«‹ç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_class_card <span class="hljs-keyword">ON</span> class(card);<span class="hljs-comment">--å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;<span class="hljs-comment">--å»æ‰å·¦è¡¨ç´¢å¼•</span><span class="hljs-keyword">DROP</span> INDEX idx_class_card <span class="hljs-keyword">ON</span> class;<span class="hljs-comment">--å³è¡¨å»ºç«‹ç´¢å¼•</span><span class="hljs-keyword">CREATE</span> INDEX idx_book_card <span class="hljs-keyword">ON</span> book(card);<span class="hljs-comment">--å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818170458.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818170458.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818170402.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818170402.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818170547.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818170547.png" alt="img"></a></p><p><strong>ç»“è®º</strong></p><ul><li>åœ¨ä¼˜åŒ–å…³è”æŸ¥è¯¢æ—¶ï¼Œåªæœ‰åœ¨<strong>è¢«é©±åŠ¨è¡¨ä¸Šå»ºç«‹ç´¢å¼•æ‰æœ‰æ•ˆ</strong></li><li>left join æ—¶ï¼Œå·¦ä¾§çš„ä¸ºé©±åŠ¨è¡¨ï¼Œ<strong>å³ä¾§ä¸ºè¢«é©±åŠ¨è¡¨</strong></li></ul><h2 id="INNER-JOINä¼˜åŒ–"><a href="#INNER-JOINä¼˜åŒ–" class="headerlink" title="INNER JOINä¼˜åŒ–"></a>INNER JOINä¼˜åŒ–</h2><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢æ“ä½œï¼Œç›®å‰ç´¢å¼•åœ¨bookè¡¨çš„cardä¸Šï¼Œclassè¡¨å’Œbookè¡¨çš„ä½ç½®ä¸ä¼šæ”¹å˜æŸ¥è¯¢ç»“æœ</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> book <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> class <span class="hljs-keyword">ON</span> book.card <span class="hljs-operator">=</span> class.card;<span class="hljs-comment">--åˆ é™¤bookè¡¨ä¸­çš„å‡ æ¡è®°å½•</span><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> book <span class="hljs-keyword">WHERE</span> bookid<span class="hljs-operator">&lt;</span><span class="hljs-number">10</span>;<span class="hljs-comment">--å†æ¬¡æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;<span class="hljs-comment">--åˆ é™¤bookè¡¨cardå­—æ®µç´¢å¼•ï¼Œç»™classè¡¨çš„cardå­—æ®µæ·»åŠ ç´¢å¼•</span><span class="hljs-keyword">DROP</span> INDEX idx_book_card <span class="hljs-keyword">ON</span> book;<span class="hljs-keyword">CREATE</span> INDEX idx_class_card <span class="hljs-keyword">ON</span> class(card);<span class="hljs-comment">--å†æ¬¡æŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> class <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> book <span class="hljs-keyword">ON</span> class.card <span class="hljs-operator">=</span> book.card;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818171341.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818171341.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818171538.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818171538.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200818171625.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200818171625.png" alt="img"></a></p><p><strong>ç»“è®º</strong>ï¼šinner join æ—¶ï¼Œ<strong>mysql ä¼šæŠŠå°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨</strong>ï¼ˆå°è¡¨é©±åŠ¨å¤§è¡¨ï¼‰</p><p><strong>æ‰€ä»¥æœ€å¥½æŠŠç´¢å¼•å»ºç«‹åœ¨å¤§è¡¨ï¼ˆæ•°æ®è¾ƒå¤šçš„è¡¨ï¼‰ä¸Š</strong></p><h2 id="RIGHT-JOINä¼˜åŒ–"><a href="#RIGHT-JOINä¼˜åŒ–" class="headerlink" title="RIGHT JOINä¼˜åŒ–"></a>RIGHT JOINä¼˜åŒ–</h2><p>ä¼˜åŒ–ç±»å‹å’ŒLEFT JOINç±»ä¼¼ï¼Œåªä¸è¿‡<strong>è¢«é©±åŠ¨è¡¨å˜æˆäº†å·¦è¡¨</strong></p><h2 id="INä¸EXISTS"><a href="#INä¸EXISTS" class="headerlink" title="INä¸EXISTS"></a>INä¸EXISTS</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510115846960.png" alt="image-20210510115846960"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510120010710.png" alt="image-20210510120010710"></p><h1 id="åäºŒã€æ’åºåˆ†ç»„ä¼˜åŒ–"><a href="#åäºŒã€æ’åºåˆ†ç»„ä¼˜åŒ–" class="headerlink" title="åäºŒã€æ’åºåˆ†ç»„ä¼˜åŒ–"></a>åäºŒã€æ’åºåˆ†ç»„ä¼˜åŒ–</h1><p>åœ¨æŸ¥è¯¢ä¸­éš¾å…ä¼šå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºæ“ä½œã€‚è¿›è¡Œæ’åºæ“ä½œæ—¶è¦<strong>é¿å…å‡ºç° Using filesort</strong>ï¼Œåº”ä½¿ç”¨ç´¢å¼•ç»™æ’åºå¸¦æ¥çš„æ–¹ä¾¿</p><p><strong>ç´¢å¼•ä¿¡æ¯</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819160428.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819160428.png" alt="img"></a></p><h2 id="ORDER-BY-ä¼˜åŒ–"><a href="#ORDER-BY-ä¼˜åŒ–" class="headerlink" title="ORDER BY ä¼˜åŒ–"></a>ORDER BY ä¼˜åŒ–</h2><p>ä»¥ä¸‹æŸ¥è¯¢éƒ½æ˜¯åœ¨<strong>ç´¢å¼•è¦†ç›–</strong>çš„æ¡ä»¶ä¸‹è¿›è¡Œçš„</p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--ä¸æ»¡è¶³ç´¢å¼•è¦†ç›–æ—¶è¿›è¡Œæ’åºæŸ¥è¯¢</span>EXPLAIN <span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age, deptId;<span class="hljs-comment">--æŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åº</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age;EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age, deptId;EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age, deptId, name;<span class="hljs-comment">--ä¸æŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºï¼ˆæ—  age å­—æ®µï¼‰ï¼Œå‘ç”ŸUsing filesort</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptId, name;<span class="hljs-comment">--ä¸æŒ‰ç…§å¤åˆç´¢å¼•é¡ºåºè¿›è¡Œæ’åºï¼ˆç´¢å¼•é¡ºåºæ‰“ä¹±ï¼‰ï¼Œå‘ç”ŸUsing filesort</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptId, name, age;<span class="hljs-comment">--æ’åºæ—¶éƒ¨åˆ†(age)å‡åºï¼Œéƒ¨åˆ†(deptId)é™åºï¼Œå‘ç”ŸUsing filesort</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">ASC</span>, deptId <span class="hljs-keyword">DESC</span>;<span class="hljs-comment">--æ’åºæ—¶éƒ½ä¸ºé™åº</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">DESC</span>, deptId <span class="hljs-keyword">DESC</span>;<span class="hljs-comment">--æ’åºæ—¶ï¼Œåœ¨å‰é¢çš„å­—æ®µä¸ºå¸¸é‡æ—¶ï¼ˆéèŒƒå›´ï¼‰</span>EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptId, name;EXPLAIN <span class="hljs-keyword">SELECT</span> age, deptId <span class="hljs-keyword">FROM</span> t_emp  <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span> <span class="hljs-keyword">AND</span> deptId<span class="hljs-operator">&gt;</span><span class="hljs-number">10000</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptId, name;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162506.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162506.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162240.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162240.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162240.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162240.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162240.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162240.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162314.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162314.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200907210532.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200907210532.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162429.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162429.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819162901.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819162901.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819164020.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819164020.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819164317.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819164317.png" alt="img"></a></p><p><strong>ç»“è®º</strong>ï¼š</p><p>è¦æƒ³åœ¨æ’åºæ—¶ä½¿ç”¨ç´¢å¼•ï¼Œé¿å… Using filesortï¼Œé¦–å…ˆéœ€è¦å‘ç”Ÿ<strong>ç´¢å¼•è¦†ç›–</strong>ï¼Œå…¶æ¬¡</p><ul><li>ORDER BY åé¢å­—æ®µçš„é¡ºåºè¦å’Œå¤åˆç´¢å¼•çš„<strong>é¡ºåºå®Œå…¨ä¸€è‡´</strong></li><li>ORDER BY åé¢çš„ç´¢å¼•å¿…é¡»æŒ‰ç…§é¡ºåºå‡ºç°ï¼Œ<strong>æ’åœ¨åé¢çš„å¯ä»¥ä¸å‡ºç°</strong></li><li>è¦è¿›è¡Œå‡åºæˆ–è€…é™åºæ—¶ï¼Œ<strong>å­—æ®µçš„æ’åºé¡ºåºå¿…é¡»ä¸€è‡´</strong>ã€‚ä¸èƒ½ä¸€éƒ¨åˆ†å‡åºï¼Œä¸€éƒ¨åˆ†é™åºï¼Œå¯ä»¥éƒ½å‡åºæˆ–è€…éƒ½é™åº</li><li>å¦‚æœå¤åˆç´¢å¼•å‰é¢çš„<strong>å­—æ®µä½œä¸ºå¸¸é‡</strong>å‡ºç°åœ¨è¿‡æ»¤æ¡ä»¶ä¸­ï¼Œ<strong>æ’åºå­—æ®µå¯ä»¥ä¸ºç´§è·Ÿå…¶åçš„å­—æ®µ</strong></li></ul><h2 id="MySQLçš„æ’åºç®—æ³•"><a href="#MySQLçš„æ’åºç®—æ³•" class="headerlink" title="MySQLçš„æ’åºç®—æ³•"></a>MySQLçš„æ’åºç®—æ³•</h2><p>å½“å‘ç”Ÿ Using filesort æ—¶ï¼ŒMySQLä¼šæ ¹æ®è‡ªå·±çš„ç®—æ³•å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº</p><ul><li>åŒè·¯æ’åº<ul><li>MySQL 4.1 ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº,å­—é¢æ„æ€å°±æ˜¯<strong>ä¸¤æ¬¡æ‰«æç£ç›˜</strong>ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ï¼Œè¯»å–è¡ŒæŒ‡é’ˆå’Œ order by åˆ—ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º</li><li>ä»ç£ç›˜å–æ’åºå­—æ®µï¼Œåœ¨ buffer è¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜å–å…¶ä»–å­—æ®µ</li><li>ç®€å•æ¥è¯´ï¼Œ<strong>å–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œäº†ä¸¤æ¬¡æ‰«æ</strong>ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒI\O æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨ mysql4.1 ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åº</li></ul></li><li>å•è·¯æ’åº<ul><li>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—ï¼ŒæŒ‰ç…§ order by åˆ—<strong>åœ¨ buffer å¯¹å®ƒä»¬è¿›è¡Œæ’åº</strong>ï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œ å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœº IO å˜æˆäº†é¡ºåº IO,ä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œ å› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†</li><li><strong>å­˜åœ¨çš„é—®é¢˜</strong>ï¼šåœ¨ sort_buffer ä¸­ï¼Œæ–¹æ³• B æ¯”æ–¹æ³• A è¦å¤šå ç”¨å¾ˆå¤šç©ºé—´ï¼Œå› ä¸ºæ–¹æ³• B æ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡º, æ‰€ä»¥æœ‰å¯èƒ½<strong>å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº† sort_buffer çš„å®¹é‡</strong>ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å– sort_buffer å®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»º tmp æ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å–å– sort_buffer å®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡ I/Oã€‚ä¹Ÿå°±æ˜¯<strong>æœ¬æ¥æƒ³çœä¸€æ¬¡ I/O æ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„ I/O æ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±</strong></li></ul></li><li>ä¼˜åŒ–Using filesort<ul><li>å¢å¤§ sort_butter_size å‚æ•°çš„è®¾ç½®<ul><li>ä¸ç®¡ç”¨å“ªç§ç®—æ³•ï¼Œæé«˜è¿™ä¸ªå‚æ•°éƒ½ä¼šæé«˜æ•ˆç‡ï¼Œå½“ç„¶ï¼Œè¦æ ¹æ®ç³»ç»Ÿçš„èƒ½åŠ›å»æé«˜ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹<strong>æ¯ä¸ªè¿›ç¨‹çš„ 1M-8M ä¹‹é—´è°ƒæ•´</strong></li></ul></li><li>å¢å¤§ max_length_for_sort_data å‚æ•°çš„è®¾ç½®<ul><li>mysql ä½¿ç”¨å•è·¯æ’åºçš„å‰ææ˜¯<strong>æ’åºçš„å­—æ®µå¤§å°è¦å°äº max_length_for_sort_data</strong></li><li>æé«˜è¿™ä¸ªå‚æ•°ï¼Œä¼šå¢åŠ ç”¨æ”¹è¿›ç®—æ³•çš„æ¦‚ç‡ã€‚ä½†æ˜¯å¦‚æœè®¾çš„å¤ªé«˜ï¼Œæ•°æ®æ€»å®¹é‡è¶…å‡º sort_buffer_size çš„æ¦‚ç‡å°±å¢å¤§ï¼Œ æ˜æ˜¾ç—‡çŠ¶æ˜¯é«˜çš„ç£ç›˜ I/O æ´»åŠ¨å’Œä½çš„å¤„ç†å™¨ä½¿ç”¨ç‡ã€‚ï¼ˆ1024-8192 ä¹‹é—´è°ƒæ•´ï¼‰</li></ul></li><li>å‡å°‘ select åé¢çš„æŸ¥è¯¢çš„å­—æ®µ<ul><li>æŸ¥è¯¢çš„å­—æ®µå‡å°‘äº†ï¼Œç¼“å†²é‡Œå°±èƒ½å®¹çº³æ›´å¤šçš„å†…å®¹äº†ï¼Œ<strong>é—´æ¥å¢å¤§äº†sort_buffer_size</strong></li></ul></li></ul></li></ul><p><strong>æ€»ç»“</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200819164341.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200819164341.png" alt="img"></a></p><h2 id="GROUP-BY-ä¼˜åŒ–"><a href="#GROUP-BY-ä¼˜åŒ–" class="headerlink" title="GROUP BY ä¼˜åŒ–"></a>GROUP BY ä¼˜åŒ–</h2><p>ä¼˜åŒ–æ–¹å¼å’Œ ORDER BY ç±»ä¼¼ï¼Œå‚è€ƒORDER BY çš„ä¼˜åŒ–æ–¹å¼å³å¯</p><h1 id="åä¸‰ã€æˆªå–æŸ¥è¯¢åˆ†æ"><a href="#åä¸‰ã€æˆªå–æŸ¥è¯¢åˆ†æ" class="headerlink" title="åä¸‰ã€æˆªå–æŸ¥è¯¢åˆ†æ"></a>åä¸‰ã€æˆªå–æŸ¥è¯¢åˆ†æ</h1><h2 id="æ…¢æ—¥å¿—æŸ¥è¯¢"><a href="#æ…¢æ—¥å¿—æŸ¥è¯¢" class="headerlink" title="æ…¢æ—¥å¿—æŸ¥è¯¢"></a>æ…¢æ—¥å¿—æŸ¥è¯¢</h2><p><strong>æ¦‚å¿µ</strong></p><ul><li>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œ<strong>å®ƒç”¨æ¥è®°å½•åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥</strong>ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡<strong>long_query_time</strong>å€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­</li><li>å…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„é»˜è®¤å€¼ä¸º 10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šçš„è¯­å¥</li><li>ç”±ä»–æ¥æŸ¥çœ‹å“ªäº›SQLè¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ï¼Œæ¯”å¦‚ä¸€æ¡sqlæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½ æ”¶é›†è¶…è¿‡5ç§’çš„sqlï¼Œç»“åˆä¹‹å‰explainè¿›è¡Œå…¨é¢åˆ†æ</li></ul><p><strong>ä½¿ç”¨</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL æ•°æ®åº“æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æˆ‘ä»¬<strong>æ‰‹åŠ¨</strong>æ¥è®¾ç½®è¿™ä¸ªå‚æ•°</p><p>å¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œ<strong>ä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°</strong>ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶</p><table><thead><tr><th>SQL è¯­å¥</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>SHOW VARIABLES LIKE â€˜%slow_query_log%â€™</td><td>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯</td><td>é»˜è®¤æƒ…å†µä¸‹ slow_query_log çš„å€¼ä¸º OFF</td></tr><tr><td>set global slow_query_log=1</td><td>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</td><td></td></tr><tr><td>SHOW VARIABLES LIKE â€˜long_query_time%â€™</td><td>æŸ¥çœ‹æ…¢æŸ¥è¯¢è®¾å®šé˜ˆå€¼</td><td>å•ä½ï¼šç§’</td></tr><tr><td>set long_query_time=1</td><td>è®¾å®šæ…¢æŸ¥è¯¢é˜ˆå€¼</td><td>å•ä½ï¼šç§’</td></tr></tbody></table><p>è¿è¡ŒæŸ¥è¯¢æ—¶é—´é•¿çš„ sqlï¼Œ<strong>å¯ä»¥æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—æŸ¥çœ‹</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510150321742.png" alt="image-20210510150321742"></p><h2 id="æ‰¹é‡æ•°æ®è„šæœ¬"><a href="#æ‰¹é‡æ•°æ®è„šæœ¬" class="headerlink" title="æ‰¹é‡æ•°æ®è„šæœ¬"></a>æ‰¹é‡æ•°æ®è„šæœ¬</h2><p><strong>å»ºè¡¨è¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--dept éƒ¨é—¨è¡¨</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `dept` (`id` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT, `deptName` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, `address` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, ceo <span class="hljs-type">INT</span> <span class="hljs-keyword">NULL</span> , <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>INNODB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<span class="hljs-comment">--emp å‘˜å·¥è¡¨</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `emp` (`id` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT, `empno` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> , `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, `age` <span class="hljs-type">INT</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, `deptId` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">PRIMARY</span> KEY (`id`)#<span class="hljs-keyword">CONSTRAINT</span> `fk_dept_id` <span class="hljs-keyword">FOREIGN</span> KEY (`deptId`) <span class="hljs-keyword">REFERENCES</span> `t_dept` (`id`)) ENGINE<span class="hljs-operator">=</span>INNODB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;</code></pre></div><p><strong>è®¾ç½®å‚æ•°</strong></p><p>åœ¨æ‰§è¡Œåˆ›å»ºå‡½æ•°ä¹‹å‰ï¼Œé¦–å…ˆè¯·ä¿è¯ log_bin_trust_function_creators å‚æ•°ä¸º 1ï¼Œå³ on å¼€å¯çŠ¶æ€ã€‚ å¦åˆ™ä¼šæŠ¥é”™</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢</span><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;log_bin_trust_function_creators&#x27;</span>;<span class="hljs-comment">--è®¾ç½®</span><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> log_bin_trust_function_creators<span class="hljs-operator">=</span><span class="hljs-number">1</span>;</code></pre></div><h2 id="ç¼–å†™éšæœºå‡½æ•°"><a href="#ç¼–å†™éšæœºå‡½æ•°" class="headerlink" title="ç¼–å†™éšæœºå‡½æ•°"></a>ç¼–å†™éšæœºå‡½æ•°</h2><p><strong>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--DELIMITER æ˜¯ç”¨äºæ”¹å˜ç»“æŸçš„æ ‡å¿—çš„ï¼Œä¸€èˆ¬ä»¥åˆ†å·ç»“å°¾ï¼Œä½†è¿™é‡Œæ”¹ä¸ºäº†ä»¥ $$ ç»“å°¾</span>DELIMITER $$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> rand_string(n <span class="hljs-type">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>)<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> chars_str <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;<span class="hljs-keyword">DECLARE</span> return_str <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;WHILE i <span class="hljs-operator">&lt;</span> n DO<span class="hljs-keyword">SET</span> return_str <span class="hljs-operator">=</span>CONCAT(return_str,<span class="hljs-built_in">SUBSTRING</span>(chars_str,<span class="hljs-built_in">FLOOR</span>(<span class="hljs-number">1</span><span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span><span class="hljs-number">52</span>),<span class="hljs-number">1</span>));<span class="hljs-keyword">SET</span> i <span class="hljs-operator">=</span> i <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">END</span> WHILE;<span class="hljs-keyword">RETURN</span> return_str;<span class="hljs-keyword">END</span> $$</code></pre></div><p>å¦‚æœè¦<strong>åˆ é™¤å‡½æ•°</strong>ï¼Œåˆ™æ‰§è¡Œï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FUNCTION</span> rand_string;</code></pre></div><p><strong>éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">DELIMITER $$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> rand_num (from_num <span class="hljs-type">INT</span> ,to_num <span class="hljs-type">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>)<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<span class="hljs-keyword">SET</span> i <span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(from_num <span class="hljs-operator">+</span>RAND()<span class="hljs-operator">*</span>(to_num <span class="hljs-operator">-</span>from_num<span class="hljs-operator">+</span><span class="hljs-number">1</span>)) ;<span class="hljs-keyword">RETURN</span> i;<span class="hljs-keyword">END</span>$$</code></pre></div><p>å¦‚æœè¦<strong>åˆ é™¤å‡½æ•°</strong>ï¼Œåˆ™æ‰§è¡Œï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">function</span> rand_num;</code></pre></div><h2 id="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h2><p><strong>åˆ›å»ºå¾€ emp è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">DELIMITER $$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> insert_emp( <span class="hljs-keyword">START</span> <span class="hljs-type">INT</span> , max_num <span class="hljs-type">INT</span> )<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;#<span class="hljs-keyword">set</span> autocommit <span class="hljs-operator">=</span><span class="hljs-number">0</span> æŠŠ autocommit è®¾ç½®æˆ <span class="hljs-number">0</span><span class="hljs-keyword">SET</span> autocommit <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;REPEAT<span class="hljs-keyword">SET</span> i <span class="hljs-operator">=</span> i <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (empno, NAME ,age ,deptid ) <span class="hljs-keyword">VALUES</span> ((<span class="hljs-keyword">START</span><span class="hljs-operator">+</span>i) ,rand_string(<span class="hljs-number">6</span>) , rand_num(<span class="hljs-number">30</span>,<span class="hljs-number">50</span>),rand_num(<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>));UNTIL i <span class="hljs-operator">=</span> max_num<span class="hljs-keyword">END</span> REPEAT;<span class="hljs-keyword">COMMIT</span>;<span class="hljs-keyword">END</span>$$<span class="hljs-comment">--åˆ é™¤</span><span class="hljs-comment">-- DELIMITER ;</span><span class="hljs-comment">-- drop PROCEDURE insert_emp; </span></code></pre></div><p><strong>åˆ›å»ºå¾€ dept è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€ dept è¡¨æ·»åŠ éšæœºæ•°æ®</span>DELIMITER $$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> `insert_dept`( max_num <span class="hljs-type">INT</span> )<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<span class="hljs-keyword">SET</span> autocommit <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;REPEAT<span class="hljs-keyword">SET</span> i <span class="hljs-operator">=</span> i <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> dept ( deptname,address,ceo ) <span class="hljs-keyword">VALUES</span> (rand_string(<span class="hljs-number">8</span>),rand_string(<span class="hljs-number">10</span>),rand_num(<span class="hljs-number">1</span>,<span class="hljs-number">500000</span>));UNTIL i <span class="hljs-operator">=</span> max_num<span class="hljs-keyword">END</span> REPEAT;<span class="hljs-keyword">COMMIT</span>;<span class="hljs-keyword">END</span>$$<span class="hljs-comment">--åˆ é™¤</span><span class="hljs-comment">-- DELIMITER ;</span><span class="hljs-comment">-- drop PROCEDURE insert_dept; </span></code></pre></div><h2 id="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h2><p><strong>æ·»åŠ æ•°æ®åˆ°éƒ¨é—¨è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€ dept è¡¨æ·»åŠ  1 ä¸‡æ¡æ•°æ®</span>DELIMITER ;<span class="hljs-keyword">CALL</span> insert_dept(<span class="hljs-number">10000</span>);</code></pre></div><p><strong>æ·»åŠ æ•°æ®åˆ°å‘˜å·¥è¡¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€ emp è¡¨æ·»åŠ  50 ä¸‡æ¡æ•°æ®</span>DELIMITER ;<span class="hljs-keyword">CALL</span> insert_emp(<span class="hljs-number">100000</span>,<span class="hljs-number">500000</span>);</code></pre></div><h2 id="æ‰¹é‡åˆ é™¤æŸä¸ªè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•"><a href="#æ‰¹é‡åˆ é™¤æŸä¸ªè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•" class="headerlink" title="æ‰¹é‡åˆ é™¤æŸä¸ªè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•"></a>æ‰¹é‡åˆ é™¤æŸä¸ªè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•</h2><p><strong>åˆ é™¤ç´¢å¼•çš„å­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql">DELIMITER $$<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> `proc_drop_index`(dbname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),tablename <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>))<span class="hljs-keyword">BEGIN</span><span class="hljs-keyword">DECLARE</span> done <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<span class="hljs-keyword">DECLARE</span> ct <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<span class="hljs-keyword">DECLARE</span> _index <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">DECLARE</span> _cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> index_name <span class="hljs-keyword">FROM</span> information_schema.STATISTICS <span class="hljs-keyword">WHERE</span>table_schema<span class="hljs-operator">=</span>dbname <span class="hljs-keyword">AND</span> table_name<span class="hljs-operator">=</span>tablename <span class="hljs-keyword">AND</span> seq_in_index<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">&lt;&gt;</span><span class="hljs-string">&#x27;PRIMARY&#x27;</span> ;<span class="hljs-keyword">DECLARE</span> CONTINUE HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NOT</span> FOUND <span class="hljs-keyword">set</span> done<span class="hljs-operator">=</span><span class="hljs-number">2</span> ;<span class="hljs-keyword">OPEN</span> _cur;<span class="hljs-keyword">FETCH</span> _cur <span class="hljs-keyword">INTO</span> _index;WHILE _index<span class="hljs-operator">&lt;&gt;</span><span class="hljs-string">&#x27;&#x27;</span> DO<span class="hljs-keyword">SET</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">=</span> CONCAT(&quot;drop index &quot;,_index,&quot; on &quot;,tablename );<span class="hljs-keyword">PREPARE</span> sql_str <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@str</span> ;<span class="hljs-keyword">EXECUTE</span> sql_str;<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> sql_str;<span class="hljs-keyword">SET</span> _index<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">FETCH</span> _cur <span class="hljs-keyword">INTO</span> _index;<span class="hljs-keyword">END</span> WHILE;<span class="hljs-keyword">CLOSE</span> _cur;<span class="hljs-keyword">END</span>$$</code></pre></div><p><strong>æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CALL</span> proc_drop_index(&quot;dbname&quot;,&quot;tablename&quot;);</code></pre></div><h1 id="åå››ã€Profilesåˆ†æ"><a href="#åå››ã€Profilesåˆ†æ" class="headerlink" title="åå››ã€Profilesåˆ†æ"></a>åå››ã€Profilesåˆ†æ</h1><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;profiling&#x27;</span>;</code></pre></div><p>å¼€å¯</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> profiling <span class="hljs-operator">=</span> <span class="hljs-keyword">ON</span> ;</code></pre></div><p>æŸ¥çœ‹ç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> PROFILES ;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510153815959.png" alt="image-20210510153815959"></p><p>æŸ¥çœ‹å…·ä½“è¯­å¥çš„åˆ†æ</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> PROFILE cpu,block io <span class="hljs-keyword">FOR</span> QUERY id;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510153834309.png" alt="image-20210510153834309"></p><p>å‡ºç°ä»¥ä¸‹ç»“æœå±é™©</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510153359372.png" alt="image-20210510153359372"></p><h1 id="åäº”ã€MySQLé”æœºåˆ¶"><a href="#åäº”ã€MySQLé”æœºåˆ¶" class="headerlink" title="åäº”ã€MySQLé”æœºåˆ¶"></a>åäº”ã€MySQLé”æœºåˆ¶</h1><h2 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h2><p><strong>[MylSAM](# å¼•æ“å±‚ )å¼•æ“ä½¿ç”¨è¡¨é”ï¼Œå¹¶ä¸”ä¸æ”¯æŒäº‹åŠ¡</strong></p><p><strong>SQLè¯­å¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å±•ç¤ºè¡¨æ˜¯å¦åŠ é”</span><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">OPEN</span> TABLES;<span class="hljs-comment">--åŠ é” read (è¯»é”) write (å†™é”)</span>LOCK <span class="hljs-keyword">TABLE</span> table1 read(write), table2 read(write)...<span class="hljs-comment">--å…¨éƒ¨è§£é”</span>UNLOCK TABLES;</code></pre></div><h2 id="è¯»é”"><a href="#è¯»é”" class="headerlink" title="è¯»é”"></a>è¯»é”</h2><ul><li>ä¸»æœºAç»™è¡¨åŠ ä¸Š<strong>è¡¨é”ï¼ˆè¯»é”ï¼‰</strong>ä»¥å<ul><li>ä¸»æœºAå’Œå…¶ä»–ä¸»æœºéƒ½å¯ä»¥è¯»å–<strong>è¯¥è¡¨</strong>çš„ä¿¡æ¯</li><li><strong>ä¸»æœºAä¸èƒ½è¯»å–åº“ä¸­å…¶ä»–è¡¨çš„ä¿¡æ¯</strong>ï¼Œä½†å…¶ä»–ä¸»æœºå¯ä»¥è¯»å–åº“ä¸­æ‰€æœ‰è¡¨çš„ä¿¡æ¯</li><li>å¦‚æœè¦ä¿®æ”¹è¢«é”è¡¨çš„ä¿¡æ¯<ul><li>ä¸»æœºAå¦‚æœå¯¹è¡¨è¿›è¡Œä¿®æ”¹ï¼Œ<strong>ä¼šä¿®æ”¹å¤±è´¥</strong></li><li>å…¶ä»–ä¸»æœºå¯¹è¡¨è¿›è¡Œä¿®æ”¹ï¼Œ<strong>ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾</strong></li></ul></li></ul></li></ul><p><strong>æ¼”ç¤º</strong></p><ul><li><p>ç»™deptè¡¨åŠ é”å¹¶æŸ¥è¯¢çŠ¶æ€</p><div class="hljs code-wrapper"><pre><code class="hljs sql">LOCK <span class="hljs-keyword">TABLE</span> dept READ;<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">OPEN</span> TABLES;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820151441.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820151441.png" alt="img"></a></p></li></ul><p><strong>è¯»å–</strong></p><ul><li><p>ä¸¤ä¸ªå®¢æˆ·ç«¯åˆ†åˆ«è¯»å–deptè¡¨çš„ä¿¡æ¯ï¼Œéƒ½èƒ½è¯»å‡ºæ¥</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div></li><li><p>å®¢æˆ·ç«¯Aï¼ˆåŠ é”ç«¯ï¼‰A<strong>è¯»å–å…¶ä»–è¡¨</strong>ä¿¡æ¯ï¼Œ<strong>è¯»å–å¤±è´¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820152614.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820152614.png" alt="img"></a></p></li><li><p>å…¶ä»–å®¢æˆ·ç«¯è¯»å–åº¦å…¶ä»–è¡¨ä¿¡æ¯ï¼Œè¯»å–æˆåŠŸ</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820152714.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820152714.png" alt="img"></a></p></li></ul><p><strong>ä¿®æ”¹</strong></p><ul><li><p>å®¢æˆ·ç«¯Aå¯¹è¡¨ä¸­å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œ<strong>ä¿®æ”¹å¤±è´¥</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820151654.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820151654.png" alt="img"></a></p></li><li><p>å®¢æˆ·ç«¯Bå¯¹è¡¨ä¸­å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820151737.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820151737.png" alt="img"></a></p><ul><li><p>ä»å®¢æˆ·ç«¯Aè§£é”åï¼Œå®¢æˆ·ç«¯Bä¿®æ”¹æˆåŠŸ</p><div class="hljs code-wrapper"><pre><code class="hljs sql">UNLOCK TABLES;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820151818.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820151818.png" alt="img"></a></p></li></ul><h2 id="å†™é”"><a href="#å†™é”" class="headerlink" title="å†™é”"></a>å†™é”</h2><p>ä¸»æœºAç»™è¡¨åŠ ä¸Š<strong>è¡¨é”ï¼ˆå†™é”ï¼‰</strong>ä»¥å</p><ul><li>ä¸»æœºAå¯ä»¥è¯»å–è¯¥è¡¨ä¿¡æ¯ï¼Œä½†<strong>å…¶ä»–ä¸»æœºè¯»å–æ—¶ï¼Œä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾</strong></li><li><strong>ä¸»æœºAä¸èƒ½è¯»å–åº“ä¸­å…¶ä»–è¡¨çš„ä¿¡æ¯</strong>ï¼Œä½†å…¶ä»–ä¸»æœºå¯ä»¥è¯»å–åº“ä¸­<strong>é™¤è¯¥è¡¨ä»¥å¤–æ‰€æœ‰è¡¨</strong>çš„ä¿¡æ¯</li><li>å¦‚æœè¦ä¿®æ”¹è¢«é”è¡¨çš„ä¿¡æ¯<ul><li>ä¸»æœºAå¦‚æœå¯¹è¡¨è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹æˆåŠŸ</li><li>å…¶ä»–ä¸»æœºå¯¹è¡¨è¿›è¡Œä¿®æ”¹ï¼Œ<strong>ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾</strong></li></ul></li></ul><p><strong>æ¼”ç¤º</strong></p><ul><li><p>ç»™deptè¡¨åŠ ä¸Šå†™é”å¹¶æŸ¥çœ‹</p><div class="hljs code-wrapper"><pre><code class="hljs sql">LOCK <span class="hljs-keyword">TABLE</span> dept WRITE;<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">OPEN</span> TABLES;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153259.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153259.png" alt="img"></a></p></li></ul><p><strong>è¯»å–</strong></p><ul><li><p>å®¢æˆ·ç«¯AæŸ¥è¯¢è¯¥è¡¨å†…å®¹ï¼ŒæŸ¥è¯¢æˆåŠŸï¼›è¯»å–å…¶ä»–è¡¨ï¼Œè¯»å–å¤±è´¥</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> dept;<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153403.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153403.png" alt="img"></a></p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153437.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153437.png" alt="img"></a></p><ul><li><p>å…¶ä»–è¡¨è¯»å–è¯¥è¡¨ä¿¡æ¯ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> dept;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153517.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153517.png" alt="img"></a></p></li><li><p>é‡Šæ”¾åï¼Œè¯»å–æˆåŠŸ</p><div class="hljs code-wrapper"><pre><code class="hljs sql">UNLOCK TABLES;</code></pre></div></li></ul><p><strong>ä¿®æ”¹</strong></p><ul><li><p>å®¢æˆ·ç«¯Aä¿®æ”¹<strong>è¯¥è¡¨</strong>å†…å®¹ï¼Œä¿®æ”¹æˆåŠŸ</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> dept <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153637.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153637.png" alt="img"></a></p></li><li><p>å®¢æˆ·ç«¯Aä¿®æ”¹<strong>å…¶ä»–è¡¨</strong>å†…å®¹ï¼Œä¿®æ”¹å¤±è´¥</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820153710.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820153710.png" alt="img"></a></p></li><li><p>å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹<strong>è¯¥è¡¨</strong>å†…å®¹ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;</code></pre></div></li></ul><p><strong>æ€»ç»“</strong></p><p><strong>è¯»é”ä¸ä¼šé˜»å¡è¯»ï¼Œåªä¼šé˜»å¡å†™ã€‚ä½†æ˜¯å†™é”ä¼šé˜»å¡è¯»å’Œå†™ã€‚</strong></p><h2 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h2><p><strong>InnoDBä½¿ç”¨è¡Œé”ï¼Œå¹¶ä¸”æ”¯æŒäº‹åŠ¡</strong>ï¼Œäº‹åŠ¡ç›¸å…³å¯å‚è€ƒ <a href="#%E4%BA%94%E3%80%81%E4%BA%8B%E5%8A%A1"><strong>MySQLåŸºç¡€äº‹åŠ¡</strong></a></p><p><strong>ç‰¹ç‚¹</strong></p><p>å¦‚æœä¸¤ä¸ªå®¢æˆ·ç«¯<strong>å¯¹åŒä¸€æ¡è®°å½•è¿›è¡Œä¿®æ”¹</strong></p><ul><li>å®¢æˆ·ç«¯Aä¿®æ”¹åï¼Œæœªæäº¤ï¼ˆæœªcommitï¼‰ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯Bä¿®æ”¹ï¼Œåˆ™ä¼šé˜»å¡</li><li>å®¢æˆ·ç«¯Aä¿®æ”¹åï¼Œæäº¤åï¼Œå®¢æˆ·ç«¯Bå†ä¿®æ”¹ï¼Œåˆ™ä¸ä¼šé˜»å¡</li></ul><p>å¦‚æœä¸¤ä¸ªå®¢æˆ·ç«¯åˆ†åˆ«<strong>å¯¹ä¸åŒçš„è®°å½•è¿›è¡Œä¿®æ”¹</strong>ï¼Œåˆ™ä¸ä¼šè¢«é˜»å¡</p><p><strong>ä¿®æ”¹åŒä¸€æ¡è®°å½•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å…³é—­è‡ªåŠ¨æäº¤</span><span class="hljs-keyword">SET</span> autocommit <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Aã€BæŸ¥è¯¢id=2çš„è®°å½•</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Aè¿›è¡Œä¿®æ”¹æ“ä½œï¼ˆå°†å¹´é¾„æ”¹ä¸ºäº†80ï¼‰ï¼Œä½†æœªæäº¤</span>UPDATE t_emp <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">80</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Aè¿›è¡ŒæŸ¥è¯¢</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bè¿›è¡ŒæŸ¥è¯¢</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bè¿›è¡Œä¿®æ”¹ï¼ˆå®¢æˆ·ç«¯Aæœªæäº¤ï¼‰</span>UPDATE t_emp <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Aæäº¤</span><span class="hljs-keyword">COMMIT</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bæäº¤</span><span class="hljs-keyword">COMMIT</span>;</code></pre></div><p><strong>å¯¹åº”ç»“æœ</strong></p><p>å®¢æˆ·ç«¯AæŸ¥è¯¢ç»“æœ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820163718.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820163718.png" alt="img"></a></p><p>å®¢æˆ·ç«¯BæŸ¥è¯¢ç»“æœ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820163718.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820163718.png" alt="img"></a></p><p>å®¢æˆ·ç«¯Aä¿®æ”¹åAæŸ¥è¯¢</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820163847.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820163847.png" alt="img"></a></p><p>å®¢æˆ·ç«¯Aä¿®æ”¹åBæŸ¥è¯¢</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820163718.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820163718.png" alt="img"></a></p><p>å®¢æˆ·ç«¯Aä¿®æ”¹ï¼Œæœªæäº¤ï¼Œæ­¤æ—¶Bè¿›è¡Œä¿®æ”¹ï¼Œ<strong>è¢«é˜»å¡</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820163957.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820163957.png" alt="img"></a></p><p>å®¢æˆ·ç«¯Aæäº¤åï¼ŒBä¿®æ”¹æˆåŠŸ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820164036.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820164036.png" alt="img"></a></p><p><strong>ä¿®æ”¹ä¸åŒè®°å½•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--å®¢æˆ·ç«¯Aå¯¹id=2çš„å¹´é¾„è¿›è¡Œä¿®æ”¹</span>UPDATE t_emp <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">90</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bå¯¹id=3çš„å¹´é¾„è¿›è¡Œä¿®æ”¹</span>UPDATE t_emp <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Aï¼ŒBåˆ†åˆ«æäº¤</span><span class="hljs-keyword">COMMIT</span>;<span class="hljs-keyword">COMMIT</span>;</code></pre></div><p>å› ä¸ºInnoDBä½¿ç”¨è¡Œé”ï¼Œå¯¹äºä¸åŒè¡Œçš„æ“ä½œï¼Œä¸ä¼šå‡ºç°é˜»å¡ç°è±¡</p><p><strong>ç´¢å¼•å¤±æ•ˆ</strong></p><p>ç´¢å¼•å¤±æ•ˆï¼Œ<strong>è¡Œé”å˜è¡¨é”</strong></p><p>å½“<strong>ç´¢å¼•å¤±æ•ˆ</strong>åï¼Œå³ä½¿å¤šä¸ªå®¢æˆ·ç«¯æ“ä½œçš„ä¸æ˜¯åŒä¸€æ¡è®°å½•ï¼Œ<strong>å¦‚æœæœªæäº¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯ä¹Ÿä¼šè¿›å…¥é˜»å¡çŠ¶æ€</strong></p><p>æ‰€ä»¥è¦<strong>é¿å…ç´¢å¼•å¤±æ•ˆ</strong></p><h2 id="é—´éš™é”å±å®³"><a href="#é—´éš™é”å±å®³" class="headerlink" title="é—´éš™é”å±å®³"></a>é—´éš™é”å±å®³</h2><p><strong>æ¦‚å¿µ</strong></p><p>å½“æˆ‘ä»¬ç”¨<strong>èŒƒå›´æ¡ä»¶</strong>è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”</p><p>å¯¹äºé”®å€¼<strong>åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•</strong>ï¼Œå«åš<strong>â€œé—´éš™(GAP)<strong>â€ ï¼Œ</strong>InnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”</strong>ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”(Next-Keyé”)ã€‚</p><p><strong>å±å®³</strong></p><p>å› ä¸ºQueryæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡è¿‡èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œä»–ä¼šé”å®šæ•´ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ï¼Œå³ä½¿è¿™ä¸ªé”®å€¼å¹¶ä¸å­˜åœ¨ã€‚<br>é—´éš™é”æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å½“é”å®šä¸€ä¸ªèŒƒå›´é”®å€¼ä¹‹åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œè€Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³</p><p><strong>æ¼”ç¤º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢è¡¨è®°å½•ï¼Œæ­¤å¤„æ²¡æœ‰id=2çš„è®°å½•</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp;<span class="hljs-comment">--å®¢æˆ·ç«¯Aè¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯èŒƒå›´å†…æ²¡æœ‰id=2çš„è®°å½•</span>UPDATE t_emp <span class="hljs-keyword">SET</span> deptId <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">&gt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">6</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bè¿›è¡Œæ’å…¥æ•°æ®ï¼Œæ’å…¥ä¸€æ¡id=2çš„è®°å½•</span><span class="hljs-keyword">INSERT</span> t_emp <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;å²³ä¸ç¾¤&#x27;</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100002</span>); <span class="hljs-comment">--å®¢æˆ·ç«¯Aæäº¤</span><span class="hljs-keyword">COMMIT</span>;<span class="hljs-comment">--å®¢æˆ·ç«¯Bæäº¤</span><span class="hljs-keyword">COMMIT</span>;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820170126.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820170126.png" alt="img"></a></p><p><strong>å®¢æˆ·ç«¯Bè¿›å…¥é˜»å¡çŠ¶æ€</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820170617.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820170617.png" alt="img"></a></p><p>æäº¤åï¼Œæ’å…¥æˆåŠŸ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200820170654.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200820170654.png" alt="img"></a></p><p><strong>ç»“è®º</strong>ï¼šå¯ä»¥çœ‹åˆ°è¡¨ä¸­æœ¬æ¥<strong>æ²¡æœ‰id=2çš„è®°å½•</strong>ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯Aè¿›è¡Œ<strong>èŒƒå›´ä¿®æ”¹</strong>æ—¶ï¼Œå®¢æˆ·ç«¯Bå¯¹<strong>åœ¨èŒƒå›´å†…ä½†ä¸å­˜åœ¨çš„æ•°æ®è¿›è¡Œæ’å…¥æ—¶ï¼Œå®¢æˆ·ç«¯Bè¿›å…¥äº†é˜»å¡çŠ¶æ€</strong></p><p><strong>æŸ¥çœ‹è¡Œé”çš„äº‰å¤ºæƒ…å†µ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;innodb_row_lock%&#x27;</span>;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210510163712985.png" alt="image-20210510163712985"></p><ul><li>1è¡¨ç¤ºæ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡</li><li>2è¡¨ç¤ºç­‰å¾…æ€»æ—¶é•¿</li><li>3è¡¨ç¤ºç­‰å¾…å¹³å‡æ—¶é•¿</li><li>5è¡¨ç¤ºç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°</li></ul><h2 id="é”ä½æŒ‡å®šçš„ä¸€è¡Œ"><a href="#é”ä½æŒ‡å®šçš„ä¸€è¡Œ" class="headerlink" title="é”ä½æŒ‡å®šçš„ä¸€è¡Œ"></a><strong>é”ä½æŒ‡å®šçš„ä¸€è¡Œ</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;<span class="hljs-comment">--é”ä½æŒ‡å®šçš„ä¸€è¡Œï¼Œå¦‚æœè¿›è¡Œæ›´æ–°æ“ä½œå°±æ˜¯ ... FOR UPDATEï¼Œåˆ é™¤æ“ä½œå°±æ˜¯ ... FOR DELETE ä»¥æ­¤ç±»æ¨</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_emp <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> UPDATE;<span class="hljs-comment">--è¿›è¡Œä¿®æ”¹æ“ä½œ</span>UPDATE t_emp <span class="hljs-keyword">SET</span> NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é£è½¦è½¦&#x27;</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<span class="hljs-comment">--æäº¤</span><span class="hljs-keyword">COMMIT</span>;</code></pre></div><p>å¦‚æœå½“æŸä¸€è¡Œè¢«é”ä½åï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯¹æ”¹è¡Œè¿›è¡Œæ“ä½œï¼Œä¼šè¢«<strong>é˜»å¡</strong></p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Innodbå­˜å‚¨å¼•æ“ç”±äºå®ç°äº†<strong>è¡Œçº§é”å®š</strong>ï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨çº§é”å®šä¼šè¦æ›´é«˜ä¸€äº›ï¼Œ ä½†æ˜¯åœ¨æ•´ä½“<strong>å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äºMyISAMçš„è¡¨çº§é”å®šçš„</strong>ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnodbçš„æ•´ä½“æ€§èƒ½å’ŒMyISAMç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿äº†ã€‚<br>ä½†æ˜¯ï¼ŒInnodbçš„è¡Œçº§é”å®šåŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬<strong>ä½¿ç”¨ä¸å½“çš„æ—¶å€™</strong>ï¼Œå¯èƒ½ä¼šè®©Innodbçš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯”MylSAMé«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚</p><h1 id="åå…­ã€å¤åˆ¶"><a href="#åå…­ã€å¤åˆ¶" class="headerlink" title="åå…­ã€å¤åˆ¶"></a>åå…­ã€å¤åˆ¶</h1><h2 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/12.mysql%E4%B8%AD%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%9E%B6%E6%9E%84.jpg" alt="12.mysqlä¸­ä¸»ä»å¤åˆ¶æ¶æ„"></p><p>ä¸»è¦æ¶‰åŠä¸‰ä¸ªçº¿ç¨‹ï¼šbinlog çº¿ç¨‹ã€I/O çº¿ç¨‹å’Œ SQL çº¿ç¨‹ã€‚</p><ul><li><strong>binlog çº¿ç¨‹</strong> ï¼šè´Ÿè´£å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ›´æ”¹<strong>å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—</strong>ï¼ˆBinary logï¼‰ä¸­ã€‚</li><li><strong>I/O çº¿ç¨‹</strong> ï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Šè¯»å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¹¶<strong>å†™å…¥ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—</strong>ï¼ˆRelay logï¼‰ã€‚</li><li><strong>SQL çº¿ç¨‹</strong> ï¼šè´Ÿè´£<strong>è¯»å–ä¸­ç»§æ—¥å¿—</strong>ï¼Œè§£æå‡ºä¸»æœåŠ¡å™¨å·²ç»æ‰§è¡Œçš„æ•°æ®æ›´æ”¹å¹¶åœ¨ä»æœåŠ¡å™¨ä¸­é‡æ”¾ï¼ˆReplayï¼‰ã€‚</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822133613.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822133613.png" alt="img"></a></p><p><strong>åœ¨Linuxä¸‹å®æ–½</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 0.æ¶æ„è§„åˆ’</span><span class="hljs-code">192.168.202.201    master  ä¸»èŠ‚ç‚¹</span><span class="hljs-code">192.168.202.202    slave   ä»èŠ‚ç‚¹</span><span class="hljs-code"></span><span class="hljs-code"># 1.ä¿®æ”¹mysqlçš„é…ç½®æ–‡ä»¶</span><span class="hljs-code">  vim /etc/my.cnf</span><span class="hljs-code"></span><span class="hljs-code"># 2.åˆ†åˆ«åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®</span><span class="hljs-code">mysql(master):</span><span class="hljs-code">server-id=1</span><span class="hljs-code">log-bin=mysql-bin</span><span class="hljs-code">log-slave-updates</span><span class="hljs-code">slave-skip-errors=all</span><span class="hljs-code"></span><span class="hljs-code">msyql(slave):</span><span class="hljs-code">server-id=2</span><span class="hljs-code">log-bin=mysql-bin</span><span class="hljs-code">log-slave-updates</span><span class="hljs-code">slave-skip-errors=all</span><span class="hljs-code"></span><span class="hljs-code">æ³¨æ„:ä¸¤ä¸ªæœºå™¨çš„server-idä¸èƒ½ä¸€è‡´</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191013201349444.png" alt="image-20191013201349444"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.é‡å¯mysqlæœåŠ¡</span><span class="hljs-code">systemctl restart mysqld</span><span class="hljs-code"></span><span class="hljs-code"># 4.ç™»å½•mysqlæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ£€æµ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</span><span class="hljs-code">SHOW VARIABLES like &#x27;server_id&#x27;;</span></code></pre></div><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191013201523812.png" alt="image-20191013201523812"  /><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 5.ç™»å½•masterèŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="hljs-code">show master status;</span><span class="hljs-code">ä»å›¾ä¸­å¯ä»¥å‘ç°ä»120è¡ŒååŒæ­¥</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191013203543728.png" alt="image-20191013203543728"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 6.ç™»å½•slaveèŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</span><span class="hljs-code">change master to </span><span class="hljs-code">master_host=&#x27;192.168.202.201&#x27;,</span><span class="hljs-code">master_user=&#x27;root&#x27;,</span><span class="hljs-code">master_password=&#x27;root&#x27;,</span><span class="hljs-code">master_log_file=&#x27;mysql-bin.000001&#x27;,</span><span class="hljs-code">master_log_pos=120;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 7.å¼€å¯slaveèŠ‚ç‚¹</span><span class="hljs-code">start slave; </span><span class="hljs-code">stop  slave;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191013204413766.png" alt="image-20191013204413766"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 8.æŸ¥çœ‹ä»èŠ‚ç‚¹çŠ¶æ€</span><span class="hljs-code">show slave status\G;</span><span class="hljs-code"></span><span class="hljs-code">************************** 1. row ***************************</span><span class="hljs-code">               Slave_IO_State: Waiting for master to send event</span><span class="hljs-code">                  Master_Host: 10.15.0.9</span><span class="hljs-code">                  Master_User: root</span><span class="hljs-code">                  Master_Port: 3306</span><span class="hljs-code">                Connect_Retry: 60</span><span class="hljs-code">              Master_Log_File: mysql-bin.000001</span><span class="hljs-code">          Read_Master_Log_Pos: 120</span><span class="hljs-code">               Relay_Log_File: mysqld-relay-bin.000002</span><span class="hljs-code">                Relay_Log_Pos: 283</span><span class="hljs-code">        Relay_Master_Log_File: mysql-bin.000001</span><span class="hljs-code">             Slave_IO_Running: Yes</span><span class="hljs-code">            Slave_SQL_Running: Yes</span><span class="hljs-code">   </span><span class="hljs-code">    æ³¨æ„:</span><span class="hljs-code">    1.å‡ºç° Slave_IO_Running: Yes`å’Œ Slave_SQL_Running: Yes è¯´æ˜æˆåŠŸ</span><span class="hljs-code">    2.å¦‚æœåœ¨æ­å»ºè¿‡ç¨‹å‡ºç°é”™è¯¯,å¯ä»¥æŸ¥çœ‹æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–‡ä»¶ cat /var/log/mysqld.log</span><span class="hljs-code"># 9.é€šè¿‡å®¢æˆ·ç«¯å·¥å…·è¿›è¡Œæµ‹è¯•</span><span class="hljs-code">è‡ªè¡Œé€‰æ‹©å®¢æˆ·ç«¯ï¼Œåœ¨masterèŠ‚ç‚¹æ–°å»ºï¼Œå¯ä»¥å‘ç°slaveèŠ‚ç‚¹ä¹Ÿä¼šåŒæ­¥</span><span class="hljs-code"># 10.å…³é—­ä¸»ä»å¤åˆ¶(åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ)</span><span class="hljs-code">stop slave;</span></code></pre></div><ul><li>æ³¨æ„:å¦‚æœå‡ºç°<code>Slave I/O: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work. Error_code: 1593</code>é”™è¯¯</li><li>å…³é—­<code>systemctl stop mysqld</code>åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤<code>rm -rf /var/lib/mysql/auto.cnf</code>åˆ é™¤è¿™ä¸ªæ–‡ä»¶,ä¹‹æ‰€ä»¥å‡ºç°ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºæˆ‘çš„ä»åº“ä¸»æœºæ˜¯å…‹éš†çš„ä¸»åº“æ‰€åœ¨çš„ä¸»æœºï¼Œæ‰€ä»¥<code>auto.cnf</code>æ–‡ä»¶ä¸­ä¿å­˜çš„UUIDä¼šå‡ºç°é‡å¤.</li></ul><h2 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h2><p><strong>ä¸»æœåŠ¡å™¨å¤„ç†å†™æ“ä½œ</strong>ä»¥åŠå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„è¯»æ“ä½œï¼Œè€Œ<strong>ä»æœåŠ¡å™¨å¤„ç†è¯»æ“ä½œ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/13.mysql%E4%B8%AD%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84-0377396.jpg" alt="13.mysqlä¸­è¯»å†™åˆ†ç¦»æ¶æ„"></p><p>è¯»å†™åˆ†ç¦»èƒ½æé«˜æ€§èƒ½çš„åŸå› åœ¨äºï¼š</p><ul><li>ä¸»ä»æœåŠ¡å™¨è´Ÿè´£å„è‡ªçš„è¯»å’Œå†™ï¼Œæå¤§ç¨‹åº¦<strong>ç¼“è§£äº†é”çš„äº‰ç”¨</strong></li><li><strong>ä»æœåŠ¡å™¨</strong>å¯ä»¥ä½¿ç”¨ <a href="#%E5%BC%95%E6%93%8E%E5%B1%82">MyISAM</a>ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ä»¥åŠèŠ‚çº¦ç³»ç»Ÿå¼€é”€</li><li>å¢åŠ å†—ä½™ï¼Œæé«˜å¯ç”¨æ€§</li></ul><p>è¯»å†™åˆ†ç¦»å¸¸ç”¨ä»£ç†æ–¹å¼æ¥å®ç°ï¼Œä»£ç†æœåŠ¡å™¨æ¥æ”¶åº”ç”¨å±‚ä¼ æ¥çš„è¯»å†™è¯·æ±‚ï¼Œç„¶åå†³å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200822133739.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/20200822133739.png" alt="img"></a></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¼€å‘ç½‘ç»œç›¸å…³çŸ¥è¯†</title>
    <link href="/2021/07/25/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/"/>
    <url>/2021/07/25/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="Webç›¸å…³"><a href="#Webç›¸å…³" class="headerlink" title="Webç›¸å…³"></a>Webç›¸å…³</h1><blockquote><p>æœ¬æ–‡æ•´åˆäº†Javaå·¥ç¨‹å¸ˆæ‰€éœ€è¦ç”¨åˆ°çš„Webå¼€å‘ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ï¼Œä¾›å‚è€ƒ</p></blockquote><h1 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1ã€macåœ°å€ã€ipåœ°å€"><a href="#1ã€macåœ°å€ã€ipåœ°å€" class="headerlink" title="1ã€macåœ°å€ã€ipåœ°å€"></a>1ã€macåœ°å€ã€ipåœ°å€</h2><p>ç»ˆç«¯è¾“å…¥<code>ifconfig en0</code>å¯ä»¥æŸ¥çœ‹</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqbxj10qtj30yq07kwh0.jpg" alt="image-20210420171424350"></p><p>å…¶ä¸­etheræŒ‡çš„å°±æ˜¯macåœ°å€ã€inet åœ°å€å°±æ˜¯ipã€‚</p><p>macåœ°å€ä¹Ÿå«ç‰©ç†åœ°å€å’Œå±€åŸŸç½‘åœ°å€ï¼Œä¸»è¦ç”¨äºç¡®è®¤ç½‘ä¸Šè®¾å¤‡çš„åœ°å€ï¼Œç±»ä¼¼äºèº«ä»½è¯å·ï¼Œå…·æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸€ä¸ªç½‘å¡åˆ¶ä½œå®Œæˆä¹‹åå°±å¸¦æœ‰ä¸€ä¸ªmacåœ°å€ï¼Œæ°¸è¿œéƒ½ä¸ä¼šæ”¹å˜ã€‚ </p><p>ipåœ°å€ï¼Œç±»ä¼¼äºä½ çš„ç°ä½å€ï¼Œæ˜¯æ ‡è®°ä½ åœ¨ç½‘ç»œä¸­çš„å…·ä½“ä½ç½®ï¼Œä¸€ä¸ªç½‘å¡çš„ipåœ°å€æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚</p><h2 id="2ã€è®¡ç®—æœºä¹‹é—´æ˜¯æ€ä¹ˆè¿æ¥çš„"><a href="#2ã€è®¡ç®—æœºä¹‹é—´æ˜¯æ€ä¹ˆè¿æ¥çš„" class="headerlink" title="2ã€è®¡ç®—æœºä¹‹é—´æ˜¯æ€ä¹ˆè¿æ¥çš„"></a>2ã€è®¡ç®—æœºä¹‹é—´æ˜¯æ€ä¹ˆè¿æ¥çš„</h2><h4 id="2-1-åŒç»çº¿"><a href="#2-1-åŒç»çº¿" class="headerlink" title="2.1 åŒç»çº¿"></a>2.1 åŒç»çº¿</h4><p>å¦‚æœåªæ˜¯ä¸¤å°è®¡ç®—æœºï¼Œæˆ‘èƒ½å°±å¯ä»¥ä½¿ç”¨åŒç»çº¿ï¼ˆç½‘çº¿ï¼‰è¿è½½ä¸€èµ·ï¼Œå°±èƒ½äº’ç›¸å‘é€æ¶ˆæ¯ï¼Œç»„æˆä¸€ä¸ªå°ç½‘ç»œã€‚</p><h4 id="2-2-é›†çº¿å™¨"><a href="#2-2-é›†çº¿å™¨" class="headerlink" title="2.2 é›†çº¿å™¨"></a>2.2 é›†çº¿å™¨</h4><p>å¦‚æœæœ‰å¤šå°è®¡ç®—æœºï¼Œå¯ä»¥ä½¿ç”¨hubï¼Œå«åšé›†çº¿å™¨ï¼Œä¸€ä¸ªç”µè„‘å‘é€ä¿¡æ¯åˆ°é›†çº¿å™¨ï¼Œé›†çº¿å™¨è´Ÿè´£å¹¿æ’­åˆ°å…¶ä»–çš„è®¡ç®—æœºã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqbz4v0z8j30ii09m756.jpg" alt="image-20210420171958113"></p><h4 id="2-3-äº¤æ¢æœº"><a href="#2-3-äº¤æ¢æœº" class="headerlink" title="2.3 äº¤æ¢æœº"></a>2.3 äº¤æ¢æœº</h4><p>ç”±äºé›†çº¿å™¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å‘é€ä¿¡æ¯åˆ°ç‰¹å®šçš„è®¡ç®—æœºè€Œä¸æ˜¯å¹¿æ’­ï¼Œæ‰€ä»¥ä¸€ä¸ªæ–°çš„è®¾å¤‡å°±å‡ºç°äº†å«åšäº¤æ¢æœºï¼ˆswitchï¼‰ã€‚</p><p>äº¤æ¢æœºå¯ä»¥è®°å½•æ¯ä¸€ä¸ªè®¾å¤‡çš„å¼Ÿå­å’Œæ¥å£çš„å¯¹åº”å…³ç³»ã€‚</p><p>æ€è€ƒé—®é¢˜ï¼Œäº¤æ¢æœºè¦å°†å†…å®¹å‘é€ç»™æŒ‡å®šçš„è®¡ç®—æœºï¼Œé‚£ä¹ˆå†…éƒ¨ä¸€å®šç»´æŠ¤äº†ä¸€å¼ è¡¨ï¼Œè®°å½•äº†å“ªä¸ªç”µè„‘é“¾æ¥äº†æˆ‘çš„å“ªä¸ªå£ã€‚<strong>äº¤æ¢æœºåªèƒ½è¯†åˆ«MACåœ°å€ã€‚MACåœ°å€æ˜¯ç‰©ç†åœ°å€ï¼Œipåœ°å€äº¤æ¢æœºå¹¶ä¸æ„Ÿå…´è¶£</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqbzu54a6j30w80a2n09.jpg" alt="image-20210420172038615"></p><p>æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š</p><p>äº¤æ¢æœºå•Šæ˜¯æ€ä¹ˆçŸ¥é“è¿™ä¸ªè¡¨çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqc0drv32j310o0hs0z9.jpg" alt="image-20210420172110207"></p><p>æ‰¾ä¸åˆ°å°±å…¨å‘˜å¹¿æ’­ï¼Œäº¤æ¢æœºæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å¯ä»¥è¿›è¡Œæ¡¥æ¥ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqc102pvlj30zy0fkdj6.jpg" alt="image-20210420172144325"></p><h4 id="2-4-è·¯ç”±å™¨"><a href="#2-4-è·¯ç”±å™¨" class="headerlink" title="2.4 è·¯ç”±å™¨"></a>2.4 è·¯ç”±å™¨</h4><p>æ€è€ƒï¼šä½¿ç”¨äº¤æ¢æœºå¯ä»¥å»ºç«‹ä¸€ä¸ªè¶…å¤§å‹çš„ç½‘ç»œå—ï¼Ÿ</p><p>ä¸€èˆ¬çš„äº¤æ¢æœºçš„åœ°å€è¡¨ä¹Ÿå°±èƒ½å­˜ä¸ªå‡ åƒä¸ªåœ°å€ï¼Œå½“ç½‘ç»œå†…çš„è®¾å¤‡å¤šèµ·æ¥ä»¥åï¼Œåªè¦äº¤æ¢æœºæ‰¾ä¸åˆ°å¯¹åº”è®¾å¤‡å°±ä¼šå¹¿æ’­ï¼Œåœ°å€è¡¨å¦‚æœæ»¡äº†ï¼Œæ–°åœ°å€è¿˜ä¼šè¦†ç›–å°±åœ°å€å°±ä¼šå¯¼è‡´é‡æ–°å¯»æ‰¾æ•ˆç‡æ¯”è¾ƒä½ã€‚æ‰€ä»¥æœ‰å¼•å…¥äº†ä¸€ä¸ªè®¾å¤‡å«è·¯ç”±å™¨ï¼Œè°ä¹Ÿå¬è¿‡çš„ä¸€ä¸ªè®¾å¤‡ï¼Œä¸€èˆ¬å®¶é‡Œéƒ½æœ‰ã€‚</p><p>æ³¨æ„ï¼šè·¯ç”±å™¨ä¸æ˜¯çŒ«ï¼ŒçŒ«æ˜¯è°ƒåˆ¶è§£è°ƒå™¨ï¼Œè°ƒåˆ¶è§£è°ƒå™¨çš„ä½œç”¨æ˜¯å°†è¿›æ¥çš„å…‰ä¿¡å·è½¬åŒ–ä¸ºç”µä¿¡å·</p><p><strong>äºæ˜¯æå‡ºäº†ä»¥ä¸‹çš„è®¾è®¡</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc1wbgstj30zs0eoq7l.jpg" alt="image-20210420172236973"></p><p>è¿™é‡Œå°±æœ‰äº†ç½‘ç»œçš„æ¦‚å¿µäº†ã€‚ä»¥ä¸Šçš„å‡ ç§ï¼Œå“ªæ€•æ˜¯äº¤æ¢æœºçš„æ¡¥æ¥ä¹Ÿæ²¡æœ‰è®¾è®¡ipåœ°å€è¿™ä¸ªæ¦‚å¿µï¼Œéƒ½æ˜¯åŸºäºmacåœ°å€è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¿™é‡Œæœ‰äº†ç½‘ç»œè¿™ä¸ªæŠ½è±¡æ¦‚å¿µä¹‹åipåœ°å€å°±åº”ç”¨è€Œç”Ÿäº†ï¼ŒIPåœ°å€åªè¦æ˜¯ç”¨æ¥è¡¨ç¤ºè®¡ç®—æœºçš„ç½‘ç»œä½ç½®ï¼Œä»–å¤„äºå“ªä¸€ä¸ªç½‘ç»œã€‚IPåœ°å€å’Œå­ç½‘æ©ç å…±åŒå¸®åŠ©æˆ‘ä»¬å®šä½ä¸€ä¸ªè®¡ç®—æœºåœ¨ç½‘ç»œä¸­çš„ä½ç½®ã€‚</p><p>ipåœ°å€å’Œå­ç½‘æ©ç å…¶å®æ˜¯ä¸ª32ä½çš„äºŒè¿›åˆ¶æ•°å­—</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc2h9o9kj310m0b6tcy.jpg" alt="image-20210420172310601"></p><p>æ­¤æ—¶å‘é€ä¿¡æ¯å°±ä¼šå†åŒ…ä¸€ä¸ªæ¶ˆæ¯çš„å¤´éƒ¨</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc2usjtbj311604emym.jpg" alt="image-20210420172332366"></p><p>å®¶ç”¨çš„è·¯ç”±å™¨ï¼Œæœ‰ä¸ªwanå£ï¼Œæœ‰å¥½å‡ ä¸ªlanå£ï¼Œwanå£ç”¨æ¥æ¥æ¥äº’è”ç½‘ç«¯ï¼Œlanç”¨æ¥è¿æ¥å®¶åº­è®¾å¤‡ï¼Œè¿™è¿ä¸ªå£éƒ½æœ‰ä¸€ä¸ªç½‘å¡ï¼Œä¸€ä¸ªç½‘å¡å±äºäº’è”ç½‘ç½‘ç»œï¼Œipå¯èƒ½æ˜¯10.25.23.65ï¼Œå¦ä¸€ä¸ªå±äºå†…éƒ¨ç½‘ç»œæ¯”å¦‚192.168.0.1ã€‚å†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨äº’è”ç½‘çš„æ•°æ®è½¬å‘ç”±è·¯ç”±å™¨å†…éƒ¨å®ç°ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc3hbvt0j310e0ds40v.jpg" alt="image-20210420172408830"></p><p>è·¯ç”±å™¨å†…æœ‰è·¯ç”±è¡¨ã€‚ </p><p>ç½‘ç»œå†…ä¼ è¾“ï¼Œæœ‰äº†ç½‘å…³çš„æ¦‚å¿µäº†ã€‚ ipä¸èƒ½ç›´æ¥è¿›è¡Œä¼ è¾“ï¼Œåº”ä¸ºç½‘ç»œå†…çš„äº¤æ¢æœºä¸æ”¯æŒipåœ°å€ï¼Œæ‰€ä»¥é€šä¿¡è¦è½¬åŒ–ä¸ºmacåœ°å€ï¼Œæ ¹æ®ipæŸ¥æ‰¾mac åœ°å€ã€‚ </p><p>éå¸¸é‡è¦çš„arpåè®®ï¼Œè¦è¿›è¡Œå¹¿æ’­ï¼Œé—®ä¸€é—®å“ªä¸ªmacåœ°å€çš„ipæ˜¯192.168.0.5ï¼Œä»–æ”¶åˆ°å°±ä¼šå›åº”</p><p>æ¥ä¸€ä¸ªæ —å­ï¼Œ192.168.100.100 å‘é€ä¿¡æ¯åˆ° 192.168.200.101</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc44vadvj310e0f0adl.jpg" alt="image-20210420172446386"></p><p>ç¬¬ä¸€æ­¥ï¼š 192.168.100.100 -&gt; 192.168.200.101</p><p><strong>åˆ©ç”¨åœ°å€è§£æåè®®ï¼ˆARPï¼‰åè®®å¯¹åº”IPåœ°å€åˆ°MACåœ°å€ï¼Œå› ä¸ºäº¤æ¢æœºåªè®¤è¯†MACåœ°å€ï¼ŒåŒæ—¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­MACåœ°å€ä¼šä¸€ç›´å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤´éƒ¨ä¼šå˜</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421153534811.png" alt="image-20210421153534811"></p><p>æ·»åŠ ä¸€æ¡è·¯ç”±</p><div class="hljs code-wrapper"><pre><code class="hljs shell">route add -host 192.168.110.202 gw 192.168.120.202 route del -host 192.168.110.202 gw 192.168.120.202</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs shell">tcpdump -i eth1 host 192.168.1.123 -w /tmp/xxx.cap</code></pre></div><p>ICMPï¼ˆInternetControlMessageProtocolï¼‰Internetæ§åˆ¶æŠ¥æ–‡åè®®ã€‚å®ƒæ˜¯TCP/IPåè®®ç°‡çš„ä¸€ä¸ªå­åè®®ï¼Œç”¨äºåœ¨IPä¸»æœºã€è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯ã€‚æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ç½‘ç»œé€šä¸é€šã€ä¸»æœºæ˜¯å¦å¯è¾¾ã€è·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯ã€‚è¿™äº›æ§åˆ¶æ¶ˆæ¯è™½ç„¶å¹¶ä¸ä¼ è¾“ç”¨æˆ·æ•°æ®ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ•°æ®çš„ä¼ é€’èµ·ç€é‡è¦çš„ä½œç”¨ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421104754669.png" alt="image-20210421104754669"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421105345780.png" alt="image-20210421105345780"></p><h4 id="2-5-NATåè®®"><a href="#2-5-NATåè®®" class="headerlink" title="2.5 NATåè®®"></a>2.5 NATåè®®</h4><p>æ¯å°è®¾å¤‡éƒ½åˆ†é…ä¸€ä¸ªipå½“ç„¶èƒ½å¤Ÿå®ç°ç½‘ç»œçš„å»ºç«‹ï¼Œä½†æ˜¯äº‹å®ä¸Šæˆ‘ä»¬åªæœ‰æ•°é‡æœ‰é™çš„IPåœ°å€ï¼Œèƒ½ç»™æˆ‘ä»¬ç”¨çš„å¤§æ¦‚åªæœ‰40äº¿å·¦å³ï¼Œäºæ˜¯ä¸€èˆ¬çš„åšæ³•æ˜¯å®¶é‡Œåªæœ‰ä¸€ä¸ªipåœ°å€ï¼Œæ‰€æœ‰çš„è®¾å¤‡é€šè¿‡è·¯ç”±å™¨è¿æ¥ã€‚è¿æ¥åœ¨å†…ç½‘ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä½ çš„æ‰‹æœºçš„åœ°å€æ˜¯192.168.0.10ï¼Œåˆ«äººå®¶çš„ä¹Ÿå¯èƒ½æ˜¯ä¸€æ ·çš„ç™¾åº¦æ€ä¹ˆåŒºåˆ†å‘€ï¼Ÿ</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc6j041yj30ym0i8q6i.jpg" alt="image-20210420172704178"></p><p>è¿™ä¸ªå«NATåè®® NATï¼ˆNetwork Address Translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼‰ã€‚</p><p>ç°åœ¨å®¶é‡Œçš„è·¯ç”±å™¨éƒ½æ˜¯å¸¦æœ‰äº¤æ¢åŠŸèƒ½çš„ï¼Œèƒ½ä½¿ç”¨çš„IPåœ°å€ 25.68äº¿ å…±æœ‰40å¤šäº¿</p><h2 id="3ã€ipåœ°å€çš„åˆ†ç±»"><a href="#3ã€ipåœ°å€çš„åˆ†ç±»" class="headerlink" title="3ã€ipåœ°å€çš„åˆ†ç±»"></a>3ã€ipåœ°å€çš„åˆ†ç±»</h2><p>1ã€Aç±»IPåœ°å€ </p><p>ä¸€ä¸ªAç±»IPåœ°å€ç”±1å­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ3å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ0â€ï¼Œ åœ°å€èŒƒå›´ä» 1.0.0.0 åˆ°126.0.0.0ã€‚å¯ç”¨çš„Aç±»ç½‘ç»œæœ‰126ä¸ªï¼Œæ¯ä¸ªç½‘ç»œèƒ½å®¹çº³1äº¿å¤šä¸ªä¸»æœºã€‚</p><p>2ã€Bç±»IPåœ°å€ </p><p>ä¸€ä¸ªBç±»IPåœ°å€ç”±2ä¸ªå­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ2ä¸ªå­—èŠ‚çš„ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ10â€ï¼Œåœ°å€èŒƒ å›´ä»128.0.0.0åˆ°191.255.255.255ã€‚å¯ç”¨çš„Bç±»ç½‘ç»œæœ‰16382ä¸ªï¼Œæ¯ä¸ªç½‘ç»œèƒ½å®¹çº³6ä¸‡å¤šä¸ªä¸»æœº ã€‚</p><p>3ã€Cç±»IPåœ°å€ </p><p>ä¸€ä¸ªCç±»IPåœ°å€ç”±3å­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ1å­—èŠ‚çš„ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ110â€ã€‚èŒƒå›´ä» 192.0.0.0åˆ°223.255.255.255ã€‚Cç±»ç½‘ç»œå¯è¾¾209ä¸‡ä½™ä¸ªï¼Œæ¯ä¸ªç½‘ç»œèƒ½å®¹çº³254ä¸ªä¸»æœºã€‚</p><p>4ã€Dç±»åœ°å€ </p><p>ç”¨äºå¤šç‚¹å¹¿æ’­ï¼ˆMulticastï¼‰ã€‚ Dç±»IPåœ°å€ç¬¬ä¸€ä¸ªå­—èŠ‚ä»¥â€œ1110â€å¼€å§‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸“é—¨ä¿ç•™çš„åœ°å€ã€‚å®ƒå¹¶ä¸æŒ‡å‘ç‰¹å®šçš„ç½‘ç»œï¼Œç›®å‰è¿™ä¸€ç±»åœ°å€è¢«ç”¨åœ¨å¤šç‚¹å¹¿æ’­ï¼ˆMulticastï¼‰ä¸­ã€‚å¤šç‚¹å¹¿æ’­åœ°å€ç”¨æ¥ä¸€æ¬¡å¯»å€ä¸€ç»„è®¡ç®— æœºï¼Œå®ƒæ ‡è¯†å…±äº«åŒä¸€åè®®çš„ä¸€ç»„è®¡ç®—æœºã€‚224.0.0.0åˆ°239.255.255.255ç”¨äºå¤šç‚¹å¹¿æ’­ ã€‚</p><p>5ã€Eç±»IPåœ°å€ </p><p>ä»¥â€œ11110â€å¼€å§‹ï¼Œä¸ºå°†æ¥ä½¿ç”¨ä¿ç•™ã€‚240.0.0.0åˆ°255.255.255.254ï¼Œ255.255.255.255ç”¨äºå¹¿æ’­åœ°å€ï¼Œå…¨é›¶ ï¼ˆâ€œ0ï¼0ï¼0ï¼0â€ï¼‰åœ°å€å¯¹åº”äºå½“å‰ä¸»æœºã€‚å…¨â€œ1â€çš„IPåœ°å€ï¼ˆâ€œ255ï¼255ï¼255ï¼255â€ï¼‰æ˜¯å½“å‰å­ç½‘çš„å¹¿æ’­ åœ°å€ã€‚</p><p><strong>IPç§æœ‰åœ°å€ï¼š</strong></p><p>åœ¨IPåœ°å€3ç§ä¸»è¦ç±»å‹é‡Œï¼Œå„ä¿ç•™äº†3ä¸ªåŒºåŸŸä½œä¸ºç§æœ‰åœ°å€ï¼Œå…¶åœ°å€èŒƒå›´å¦‚ä¸‹ï¼š</p><p>Aç±»åœ°å€ï¼š10.0.0.0ï½10.255.255.255 </p><p>Bç±»åœ°å€ï¼š172.16.0.0ï½172.31.255.255 </p><p><strong>Cç±»åœ°å€</strong>ï¼š192.168.0.0ï½192.168.255.255 </p><p>Aç±»åœ°å€çš„ç¬¬ä¸€ç»„æ•°å­—ä¸º1ï½126ã€‚æ³¨æ„ï¼Œæ•°å­—0å’Œ127ä¸ä½œä¸ºAç±»åœ°å€ï¼Œæ•°å­—127ä¿ç•™ç»™å†…éƒ¨å›é€å‡½æ•°ï¼Œè€Œæ•°å­—0åˆ™è¡¨ç¤ºè¯¥åœ°å€æ˜¯æœ¬åœ°å®¿ä¸»æœºï¼Œä¸èƒ½ä¼ é€ã€‚</p><p>Bç±»åœ°å€çš„ç¬¬ä¸€ç»„æ•°å­—ä¸º128ï½191ã€‚</p><p>Cç±»åœ°å€çš„ç¬¬ä¸€ç»„æ•°å­—ä¸º192ï½223ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc8i8b99j30s60rsgt7.jpg" alt="image-20210420172857859"></p><h2 id="4ã€åŸŸåDNS"><a href="#4ã€åŸŸåDNS" class="headerlink" title="4ã€åŸŸåDNS"></a>4ã€åŸŸåDNS</h2><p>ä½ çœŸçš„èƒ½è®°ä½æ¯ä¸ªç½‘ç«™çš„ipåœ°å€å—ï¼Ÿ é‚£æˆ‘ä»¬è¾“å…¥çš„<a href="http://www.github.comæ˜¯ä»€ä¹ˆæ˜¯åŸŸå,æˆ‘ä»¬å¯ä»¥å»é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡æä¾›å•†è´­ä¹°åŸŸå./">www.github.comæ˜¯ä»€ä¹ˆæ˜¯åŸŸåï¼Œæˆ‘ä»¬å¯ä»¥å»é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡æä¾›å•†è´­ä¹°åŸŸåã€‚</a></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqc9n9n09j30wg0cqafi.jpg" alt="image-20210420173003852"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqca0gsvij30x40magna.jpg" alt="image-20210420173025265"></p><p>åŸŸåæ˜¯éœ€è¦è§£æçš„ï¼ŒæŒ‡å‘ä¸€ä¸ªipåœ°å€</p><p>ä¸ºäº†è®©ä½ å®¹æ˜“è®°å¿†å¼•å…¥äº†åŸŸåçš„æ¦‚å¿µï¼Œä½ ä¸éœ€è¦è®°å¿†ï¼Œæœ‰äººå¸®æ‚¨è®°å½•</p><p><strong>DNSè§£æ</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpqcb18w1ij30yy0fg78b.jpg" alt="image-20210420173112302"></p><h4 id="4-1ã€å›½å†…çš„dns"><a href="#4-1ã€å›½å†…çš„dns" class="headerlink" title="4.1ã€å›½å†…çš„dns"></a>4.1ã€å›½å†…çš„dns</h4><p><strong>ç¬¬ä¸€å 114DNSï¼š</strong>â˜…â˜…â˜…â˜…â˜… </p><p>114DNSå¼€å¯DNSé«˜å¯é æœåŠ¡æ—¶ä»£çš„å¤§å¹•ã€‚114DNSå¼€å§‹åŒæ—¶ä¸ºå…¬ä¼—æä¾›é«˜é€Ÿã€ç¨³å®šã€å¯ä¿¡çš„DNSé€’å½’è§£ææœåŠ¡ï¼›ä¸ºç½‘ç«™æä¾›å¼ºå¤§æŠ—æ”»å‡»èƒ½åŠ›çš„æƒå¨æ™ºèƒ½DNSè§£ææœåŠ¡ï¼›ä¸ºISPæä¾›å¯é çš„DNSç¾å¤‡åŠå¤–åŒ…æœåŠ¡ï¼Œä½œä¸ºå›½å†…ç”¨æˆ·é‡æœ€å¤§çš„è€ç‰ŒDNSï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œå„åœ°åŒºè®¾æœ‰èŠ‚ç‚¹ï¼Œè´Ÿè½½å„è¿è¥å•†ç”¨æˆ·ï¼ŒDNSé˜²åŠ«æŒèƒ½åŠ›ï¼Œè‡ªç„¶ä¹Ÿæ˜¯ååˆ—å‰èŒ…ã€‚ </p><p>DNS æœåŠ¡å™¨ IP åœ°å€ï¼š</p><p>é¦–é€‰ï¼š114.114.114.114</p><p>å¤‡é€‰ï¼š114.114.114.115 </p><p>2017å…¬å…±DNSæœåŠ¡å™¨åœ°å€è¯„ä¼°â€”DNSæ¨è </p><p><strong>ç¬¬äºŒå DNSPod DNSï¼š</strong>â˜…â˜…â˜…â˜…â˜…</p><p>DNSPodåˆ›å§‹äº2006å¹´3æœˆï¼Œæ˜¯ä¸­å›½æœ€å¤§çš„ç¬¬ä¸‰æ–¹åŸŸåæœåŠ¡å•†ï¼Œå…¨çƒæ’åç¬¬å››ä½ã€‚DNSPodæ˜¯å›½å†…æœ€æ—©æ ä¾›å…è´¹æ™ºèƒ½DNSäº§å“çš„ç½‘ç«™,è‡´åŠ›äºä¸ºå„ç±»ç½‘ç«™æä¾›é«˜è´¨é‡çš„ç”µä¿¡ã€ç½‘é€šã€æ•™è‚²ç½‘åŒçº¿æˆ–è€…ä¸‰çº¿æ™ºèƒ½DNS å…è´¹è§£æï¼Œä½œä¸º114DNSç«äº‰å¯¹æ‰‹ä¹‹ä¸€ï¼Œæ— è®ºæ˜¯è®¿é—®é€Ÿåº¦ï¼Œè¿˜æ˜¯å„åœ°åŒºèŠ‚ç‚¹è¦†ç›–ç‡ä»¥åŠé˜²åŠ«æŒèƒ½åŠ›éƒ½æ˜¯ é¡¶çº§çš„ã€‚ </p><p>DNS æœåŠ¡å™¨ IP åœ°å€ï¼š </p><p>é¦–é€‰ï¼š119.29.29.29 </p><p>å¤‡é€‰ï¼š182.254.116.116 </p><p>2017å…¬å…±DNSæœåŠ¡å™¨åœ°å€è¯„ä¼°â€”DNSæ¨è </p><p><strong>ç¬¬ä¸‰å é˜¿é‡Œ DNSï¼š</strong>â˜…â˜…â˜…â˜…â˜… </p><p>é˜¿é‡Œå…¬å…±DNSæ˜¯é˜¿é‡Œå·´å·´é›†å›¢æ¨å‡ºçš„DNSé€’å½’è§£æç³»ç»Ÿï¼Œä½œä¸ºå›½å†…æœ€å¤§çš„äº’è”ç½‘åŸºç¡€æœåŠ¡æä¾›å•†ï¼Œé˜¿é‡Œ å·´å·´åœ¨ç»§æ‰¿å¤šå¹´ä¼˜ç§€æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æä¾›æ€§èƒ½ä¼˜å¼‚çš„å…¬å…±DNSæœåŠ¡ï¼Œä¸ºå¹¿å¤§äº’è”ç½‘ç”¨æˆ·æä¾›æœ€å¯é  çš„é¢å‘äº’è”ç½‘ç”¨æˆ·æä¾›â€œå¿«é€Ÿâ€ã€â€œç¨³å®šâ€ã€â€œæ™ºèƒ½â€çš„å…è´¹DNSé€’å½’è§£ææœåŠ¡ã€‚ </p><p>DNS æœåŠ¡å™¨ IP åœ°å€ï¼š</p><p>é¦–é€‰ï¼š223.5.5.5 </p><p>å¤‡é€‰ï¼š223.6.6.6 </p><p>2017å…¬å…±DNSæœåŠ¡å™¨åœ°å€è¯„ä¼°â€”DNSæ¨è</p><h4 id="4-2ã€åŸŸåçš„åˆ†ç±»"><a href="#4-2ã€åŸŸåçš„åˆ†ç±»" class="headerlink" title="4.2ã€åŸŸåçš„åˆ†ç±»"></a>4.2ã€åŸŸåçš„åˆ†ç±»</h4><p><strong>è¯­ç§åˆ†ç±»</strong></p><p>è‹±æ–‡åŸŸåã€ä¸­æ–‡åŸŸåã€æ—¥æ–‡åŸŸåã€éŸ©æ–‡åŸŸåç­‰ç­‰ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¸¸è§çš„å°±æ˜¯è‹±æ–‡åŸŸåã€‚</p><p>è‹±æ–‡åŸŸåï¼šbaidu.com</p><p>ä¸­æ–‡åŸŸåï¼šç™¾åº¦.com ã€ç™¾åº¦.ä¸­å›½ã€baidu.ä¸­å›½</p><p>å…¶å®ƒè¯­è¨€åŸŸååŒä¸Šã€‚</p><p><strong>åœ°åŒºåˆ†ç±»</strong></p><p>ä¸­å›½ã€ç¾å›½ã€è‹±å›½ã€æ—¥æœ¬ç­‰ç­‰ã€‚</p><p>åœ¨å›½å†…æˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯.cnåŸŸåï¼Œ.cnæ˜¯ä¸­å›½å¤§é™†çš„å›½å®¶ä¸€çº§åŸŸåã€‚å¦å¤–è¿˜ æœ‰.com.cnã€.net.cnã€.org.cnç­‰ç­‰ã€‚</p><p>å›½å†…ä¸åŒçœå¸‚ä¹Ÿæœ‰è‡ªå·±çš„é¡¶çº§åŸŸåï¼Œä¾‹å¦‚å†…è’™å¤çš„é¡¶çº§åŸŸåå°±æ˜¯ï¼š.nm.cnã€‚</p><p>ç¾å›½å›½å®¶é¡¶çº§åŸŸåæ˜¯.us ã€æ—¥æœ¬çš„æ˜¯.jpã€é¦™æ¸¯çš„æ˜¯.hkã€‚</p><p><strong>æœºæ„åˆ†ç±»</strong></p><p>.com å•†ä¸šæ€§çš„æœºæ„æˆ–å…¬å¸ </p><p>.org éç›ˆåˆ©çš„ç»„ç»‡ã€å›¢ä½“ apache.org </p><p>.gov æ”¿åºœéƒ¨é—¨ <a href="http://www.shanxi.gov.cn/">http://www.shanxi.gov.cn/</a> </p><p>.net ä»äº‹Internetç›¸å…³çš„çš„æœºæ„æˆ–å…¬å¸ </p><p>åŸŸåè™½ç„¶æœ‰å¾ˆå¤šåˆ†ç±»ï¼Œä½†æ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è¿‡å¤šçš„éµå¾ªè¿™ä¸ªåŸåˆ™ã€‚æ¯”å¦‚.comçš„ä¹Ÿæœ‰ å¾ˆå¤šä½œä¸ºä¸ªäººç½‘ç«™ã€.netå¾ˆå¤šä¹Ÿç”¨æ¥åšäº†å…¬å¸ç½‘ç«™ã€‚</p><h4 id="4-3ã€å±‚çº§åˆ†ç±»"><a href="#4-3ã€å±‚çº§åˆ†ç±»" class="headerlink" title="4.3ã€å±‚çº§åˆ†ç±»"></a>4.3ã€å±‚çº§åˆ†ç±»</h4><p><strong>é¡¶çº§åŸŸåï¼ˆä¸€çº§åŸŸåï¼‰</strong></p><p> baidu.com baidu.cn</p><p><strong>äºŒçº§åŸŸå</strong></p><p><a href="http://www.baidu.com/">www.baidu.com</a>  jingyan.baidu.com</p><p><strong>ä¸‰çº§åŸŸå</strong></p><p>wangshangyingxiao.club.1688.com    hhz.bbs.53hui.com</p><h1 id="äºŒã€ç½‘ç»œä¸ƒå±‚åè®®"><a href="#äºŒã€ç½‘ç»œä¸ƒå±‚åè®®" class="headerlink" title="äºŒã€ç½‘ç»œä¸ƒå±‚åè®®"></a>äºŒã€ç½‘ç»œä¸ƒå±‚åè®®</h1><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqcgu0vbmj310i0jmwif.jpg" alt="image-20210420173658725"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqch8ru04j311e0fsgqx.jpg" alt="image-20210420173722089"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqchtkslkj31100haamx.jpg" alt="image-20210420173742375"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210609162902357.png" alt="image-20210609162902357"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210609163017056.png" alt="image-20210609163017056"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210609163330263.png" alt="image-20210609163330263"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611114939511.png" alt="image-20210611114939511"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611115531956.png" alt="image-20210611115531956"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611115715297.png" alt="image-20210611115715297"></p><h2 id="1ã€Socket"><a href="#1ã€Socket" class="headerlink" title="1ã€Socket"></a>1ã€Socket</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210610185953431.png" alt="image-20210610185953431"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210610191338814.png" alt="image-20210610191338814"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210610191651004.png" alt="image-20210610191651004"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611102845612.png" alt="image-20210611102845612"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611111622941.png" alt="image-20210611111622941"></p><h2 id="2ã€C-S-amp-B-S"><a href="#2ã€C-S-amp-B-S" class="headerlink" title="2ã€C/S &amp; B/S"></a>2ã€C/S &amp; B/S</h2><ul><li>CSå’ŒBSå«ä¹‰ï¼š <strong>CSå³Client/Server(å®¢æˆ·æœº/æœåŠ¡å™¨)ç»“æ„</strong>ã€‚C/Sç»“æ„åœ¨æŠ€æœ¯ä¸Šå¾ˆæˆç†Ÿï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯<code>äº¤äº’æ€§å¼ºã€å…·æœ‰å®‰å…¨çš„å­˜å–æ¨¡å¼ã€ç½‘ç»œé€šä¿¡é‡ä½ã€å“åº”é€Ÿåº¦å¿«ã€åˆ©äºå¤„ç†å¤§é‡æ•°æ®</code>ã€‚ä½†æ˜¯è¯¥ç»“æ„çš„ç¨‹åºæ˜¯<code>é’ˆå¯¹æ€§å¼€å‘ï¼Œå˜æ›´ä¸å¤Ÿçµæ´»ï¼Œç»´æŠ¤å’Œç®¡ç†çš„éš¾åº¦è¾ƒå¤§</code>ã€‚é€šå¸¸åªå±€é™äºå°å‹å±€åŸŸç½‘ï¼Œä¸åˆ©äºæ‰©å±•ã€‚å¹¶ä¸”ï¼Œç”±äºè¯¥ç»“æ„çš„æ¯å°å®¢æˆ·æœºéƒ½éœ€è¦å®‰è£…ç›¸åº”çš„å®¢æˆ·ç«¯ç¨‹åºï¼Œåˆ†å¸ƒåŠŸèƒ½å¼±ä¸”å…¼å®¹æ€§å·®ï¼Œä¸èƒ½å®ç°å¿«é€Ÿéƒ¨ç½²å®‰è£…å’Œé…ç½®ï¼Œå› æ­¤ç¼ºå°‘é€šç”¨æ€§ï¼Œå…·æœ‰è¾ƒå¤§çš„å±€é™æ€§ã€‚è¦æ±‚å…·æœ‰ä¸€å®šä¸“ä¸šæ°´å‡†çš„æŠ€æœ¯äººå‘˜å»å®Œæˆã€‚  <strong>BSå³Browser/Server(æµè§ˆå™¨/æœåŠ¡å™¨)ç»“æ„</strong>ï¼Œå°±æ˜¯åªå®‰è£…ç»´æŠ¤ä¸€ä¸ªæœåŠ¡å™¨(Server)ï¼Œè€Œå®¢æˆ·ç«¯é‡‡ç”¨æµè§ˆå™¨(Browse)è¿è¡Œè½¯ä»¶ã€‚B/Sç»“æ„åº”ç”¨ç¨‹åºç›¸å¯¹äºä¼ ç»Ÿçš„C/Sç»“æ„åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„è¿›æ­¥ã€‚B/Sç»“æ„çš„ä¸»è¦ç‰¹ç‚¹æ˜¯<code>åˆ†å¸ƒæ€§å¼ºã€ç»´æŠ¤æ–¹ä¾¿ã€å¼€å‘ç®€å•ä¸”å…±äº«æ€§å¼ºã€æ€»ä½“æ‹¥æœ‰æˆæœ¬ä½</code>ã€‚ä½†<a href="https://cloud.tencent.com/solution/data_protection?from=10680">æ•°æ®å®‰å…¨</a>æ€§é—®é¢˜ã€å¯¹æœåŠ¡å™¨è¦æ±‚è¿‡é«˜ã€æ•°æ®ä¼ è¾“é€Ÿåº¦æ…¢ã€è½¯ä»¶çš„ä¸ªæ€§åŒ–ç‰¹ç‚¹æ˜æ˜¾é™ä½ï¼Œè¿™äº›ç¼ºç‚¹æ˜¯æœ‰ç›®å…±ç¹çš„ï¼Œéš¾ä»¥å®ç°ä¼ ç»Ÿæ¨¡å¼ä¸‹çš„ç‰¹æ®ŠåŠŸèƒ½è¦æ±‚ã€‚ä¾‹å¦‚ï¼šé€šè¿‡æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„æ•°æ®è¾“å…¥æˆ–è¿›è¡ŒæŠ¥è¡¨çš„åº”ç­”ã€ä¸“ç”¨æ€§æ‰“å°è¾“å‡ºéƒ½æ¯”è¾ƒå›°éš¾å’Œä¸ä¾¿ã€‚æ­¤å¤–ï¼Œå®ç°å¤æ‚çš„åº”ç”¨æ„é€ æœ‰è¾ƒå¤§çš„å›°éš¾ã€‚</li><li>åŒºåˆ«ï¼š <ul><li>1ã€å¼€å‘ç»´æŠ¤æˆæœ¬ <strong>cså¼€å‘ç»´æŠ¤æˆæœ¬é«˜äºbs</strong>ã€‚å› ä¸ºé‡‡ç”¨csç»“æ„æ—¶ï¼Œå¯¹äºä¸åŒçš„å®¢æˆ·ç«¯è¦å¼€å‘ä¸åŒçš„ç¨‹åºï¼Œè€Œä¸”è½¯ä»¶å®‰è£…è°ƒè¯•å’Œå‡çº§éƒ½éœ€è¦åœ¨æ‰€æœ‰å®¢æˆ·æœºä¸Šè¿›è¡Œã€‚ bsåªéœ€è¦å°†æœåŠ¡å™¨ä¸Šçš„è½¯ä»¶ç‰ˆæœ¬å‡çº§ï¼Œç„¶åä»æ–°ç™»å½•å°±å¯ä»¥äº†ã€‚</li><li>2ã€å®¢æˆ·ç«¯è´Ÿè½½ <strong>cså®¢æˆ·ç«¯è´Ÿè½½å¤§</strong>ã€‚cså®¢æˆ·ç«¯ä¸ä»…è´Ÿè´£å’Œç”¨æˆ·çš„äº¤äº’ï¼Œæ”¶é›†ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸”è¿˜éœ€è¦é€šè¿‡ç½‘ç»œå‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚ bsæŠŠäº‹åŠ¡å¤„ç†é€»è¾‘éƒ¨åˆ†äº¤ç»™äº†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åªæ˜¯è´Ÿè´£æ˜¾ç¤ºã€‚</li><li>3ã€å®‰å…¨æ€§ <strong>cså®‰å…¨æ€§é«˜</strong>ã€‚csé€‚ç”¨äºä¸“äººä½¿ç”¨çš„ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ä¸¥æ ¼çš„ç®¡ç†æ´¾å‘è½¯ä»¶ã€‚ bsä½¿ç”¨äººæ•°å¤šï¼Œä¸å›ºå®šï¼Œå®‰å…¨æ€§ä½ã€‚</li><li>4ã€ä½œç”¨èŒƒå›´ Client/Serveræ˜¯å»ºç«‹åœ¨<strong>å±€åŸŸç½‘</strong>çš„åŸºç¡€ä¸Šçš„ã€‚Browser/Serveræ˜¯å»ºç«‹åœ¨<strong>å¹¿åŸŸç½‘</strong>çš„åŸºç¡€ä¸Šçš„ã€‚</li></ul></li></ul><h2 id="3ã€å¯é æ•°æ®ä¼ è¾“çš„åŸç†"><a href="#3ã€å¯é æ•°æ®ä¼ è¾“çš„åŸç†" class="headerlink" title="3ã€å¯é æ•°æ®ä¼ è¾“çš„åŸç†"></a>3ã€å¯é æ•°æ®ä¼ è¾“çš„åŸç†</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611154205977.png" alt="image-20210611154205977"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210611154251038.png" alt="image-20210611154251038"></p><p><strong>rdtå…·æœ‰ä¸åŒçš„æƒ…å†µï¼Œè§PDFç¬¬ä¸‰ç« ç¬¬ä¸ƒé¡µ</strong></p><h1 id="ä¸‰ã€TCP-UDP-HTTPåè®®"><a href="#ä¸‰ã€TCP-UDP-HTTPåè®®" class="headerlink" title="ä¸‰ã€TCP/UDP/HTTPåè®®"></a>ä¸‰ã€TCP/UDP/HTTPåè®®</h1><h2 id="1ã€tcpåè®®"><a href="#1ã€tcpåè®®" class="headerlink" title="1ã€tcpåè®®"></a>1ã€tcpåè®®</h2><p>ä¼ è¾“ä¾é ä»€ä¹ˆè¿›è¡Œæ§åˆ¶</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqcikuhu8j30ym0jwq64.jpg" alt="image-20210420173839440"></p><blockquote><p>æºç«¯å£å’Œç›®çš„ç«¯å£å­—æ®µ</p></blockquote><ul><li>TCPæºç«¯å£ï¼ˆSource Portï¼‰ï¼šæºè®¡ç®—æœºä¸Šçš„åº”ç”¨ç¨‹åºçš„ç«¯å£å·ï¼Œå  16 ä½ã€‚ </li><li>TCPç›®çš„ç«¯å£ï¼ˆDestination Portï¼‰ï¼šç›®æ ‡è®¡ç®—æœºçš„åº”ç”¨ç¨‹åºç«¯å£å·ï¼Œå  16 ä½ã€‚</li></ul><blockquote><p>åºåˆ—å·å­—æ®µ</p></blockquote><p>CPåºåˆ—å·ï¼ˆSequenceNumberï¼‰ï¼šå 32ä½ã€‚å®ƒè¡¨ç¤ºæœ¬æŠ¥æ–‡æ®µæ‰€å‘é€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚åœ¨TCPè¿æ¥ä¸­ï¼Œæ‰€ä¼ é€çš„å­—èŠ‚æµçš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ä¼šæŒ‰é¡ºåºç¼–å·ã€‚å½“SYNæ ‡è®°ä¸ä¸º1æ—¶ï¼Œè¿™æ˜¯å½“å‰æ•°æ®åˆ†æ®µç¬¬ä¸€ä¸ªå­—æ¯çš„åºåˆ—å·ï¼›å¦‚æœSYNçš„å€¼æ˜¯1æ—¶ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼å°±æ˜¯åˆå§‹åºåˆ—å€¼ï¼ˆISNï¼‰ï¼Œç”¨äºå¯¹åºåˆ—å·è¿›è¡ŒåŒæ­¥ã€‚è¿™æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·æ¯”è¿™ä¸ªå­—æ®µçš„å€¼å¤§1ï¼Œä¹Ÿå°±æ˜¯ISNåŠ 1ã€‚</p><blockquote><p>ç¡®è®¤å·å­—æ®µ</p></blockquote><p>TCP ç¡®è®¤å·ï¼ˆAcknowledgment Numberï¼ŒACK Numberï¼‰ï¼šå  32 ä½ã€‚å®ƒè¡¨ç¤ºæ¥æ”¶æ–¹æœŸæœ›æ”¶åˆ°å‘é€æ–¹ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ•°æ®çš„ç¼–å·ã€‚å…¶å€¼æ˜¯æ¥æ”¶è®¡ç®—æœºå³å°†æ¥æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ª æ¥æ”¶åˆ°çš„å­—èŠ‚çš„åºåˆ—å·åŠ 1ã€‚</p><blockquote><p>æ•°æ®åç§»å­—æ®µ</p></blockquote><p>TCP é¦–éƒ¨é•¿åº¦ï¼ˆHeader Lengthï¼‰ï¼šæ•°æ®åç§»æ˜¯æŒ‡æ•°æ®æ®µä¸­çš„â€œæ•°æ®â€éƒ¨åˆ†èµ·å§‹å¤„è·ç¦» TCP æ•°æ®æ®µèµ·å§‹å¤„ çš„å­—èŠ‚åç§»é‡ï¼Œå  4 ä½ã€‚å…¶å®è¿™é‡Œçš„â€œæ•°æ®åç§»â€ä¹Ÿæ˜¯åœ¨ç¡®å®š TCP æ•°æ®æ®µå¤´éƒ¨åˆ†çš„é•¿åº¦ï¼Œå‘Šè¯‰æ¥æ”¶ç«¯çš„åº” ç”¨ç¨‹åºï¼Œæ•°æ®ä»ä½•å¤„å¼€å§‹ã€‚</p><blockquote><p>ä¿ç•™å­—æ®µ</p></blockquote><p>ä¿ç•™ï¼ˆReservedï¼‰ï¼šå  4 ä½ã€‚ä¸º TCP å°†æ¥çš„å‘å±•é¢„ç•™ç©ºé—´ï¼Œç›®å‰å¿…é¡»å…¨éƒ¨ä¸º 0ã€‚</p><blockquote><p>æ ‡å¿—ä½å­—æ®µ</p></blockquote><ul><li>CWRï¼ˆCongestionWindowReduceï¼‰ï¼šæ‹¥å¡çª—å£å‡å°‘æ ‡å¿—ï¼Œç”¨æ¥è¡¨æ˜å®ƒæ¥æ”¶åˆ°äº†è®¾ç½®ECEæ ‡å¿—çš„TCPåŒ…ã€‚å¹¶ä¸”ï¼Œå‘é€æ–¹æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œé€šè¿‡å‡å°å‘é€çª—å£çš„å¤§å°æ¥é™ä½å‘é€é€Ÿç‡ã€‚</li><li>ECEï¼ˆECNEchoï¼‰ï¼šç”¨æ¥åœ¨TCPä¸‰æ¬¡æ¡æ‰‹æ—¶è¡¨æ˜ä¸€ä¸ªTCPç«¯æ˜¯å…·å¤‡ECNåŠŸèƒ½çš„ã€‚åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå®ƒä¹Ÿç”¨æ¥è¡¨æ˜æ¥æ”¶åˆ°çš„TCPåŒ…çš„IPå¤´éƒ¨çš„ECNè¢«è®¾ç½®ä¸º11ï¼Œå³ç½‘ç»œçº¿è·¯æ‹¥å µã€‚</li><li>URGï¼ˆUrgentï¼‰ï¼šè¡¨ç¤ºæœ¬æŠ¥æ–‡æ®µä¸­å‘é€çš„æ•°æ®æ˜¯å¦åŒ…å«ç´§æ€¥æ•°æ®ã€‚URG=1 æ—¶è¡¨ç¤ºæœ‰ç´§æ€¥æ•°æ®ã€‚å½“ URG=1 æ—¶ï¼Œåé¢çš„ç´§æ€¥æŒ‡é’ˆå­—æ®µæ‰æœ‰æ•ˆã€‚ </li><li>ACKï¼šè¡¨ç¤ºå‰é¢çš„ç¡®è®¤å·å­—æ®µæ˜¯å¦æœ‰æ•ˆã€‚ACK=1 æ—¶è¡¨ç¤ºæœ‰æ•ˆã€‚åªæœ‰å½“ ACK=1 æ—¶ï¼Œå‰é¢çš„ç¡®è®¤å·å­— æ®µæ‰æœ‰æ•ˆã€‚TCP è§„å®šï¼Œè¿æ¥å»ºç«‹åï¼ŒACK å¿…é¡»ä¸º 1ã€‚ </li><li>PSHï¼ˆPushï¼‰ï¼šå‘Šè¯‰å¯¹æ–¹æ”¶åˆ°è¯¥æŠ¥æ–‡æ®µåæ˜¯å¦ç«‹å³æŠŠæ•°æ®æ¨é€ç»™ä¸Šå±‚ã€‚å¦‚æœå€¼ä¸º 1ï¼Œè¡¨ç¤ºåº”å½“ç«‹å³ æŠŠæ•°æ®æäº¤ç»™ä¸Šå±‚ï¼Œè€Œä¸æ˜¯ç¼“å­˜èµ·æ¥ã€‚ </li><li>RSTï¼šè¡¨ç¤ºæ˜¯å¦é‡ç½®è¿æ¥ã€‚å¦‚æœRST=1ï¼Œè¯´æ˜TCPè¿æ¥å‡ºç°äº†ä¸¥é‡é”™è¯¯ï¼ˆå¦‚ä¸»æœºå´©æºƒï¼‰ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œç„¶åå†é‡æ–°å»ºç«‹è¿æ¥ã€‚</li><li>SYNï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨ï¼Œç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=1ï¼ŒACK=0 æ—¶ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¯·æ±‚å»ºç«‹è¿æ¥çš„ æŠ¥æ–‡æ®µï¼›å½“ SYN=1ï¼ŒACK=1 æ—¶ï¼Œè¡¨ç¤ºå¯¹æ–¹åŒæ„å»ºç«‹è¿æ¥ã€‚SYN=1 æ—¶ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚å»ºç«‹è¿æ¥ æˆ–åŒæ„å»ºç«‹è¿æ¥çš„æŠ¥æ–‡ã€‚åªæœ‰åœ¨å‰ä¸¤æ¬¡æ¡æ‰‹ä¸­ SYN æ‰ä¸º 1ã€‚ </li><li>FINï¼šæ ‡è®°æ•°æ®æ˜¯å¦å‘é€å®Œæ¯•ã€‚å¦‚æœ FIN=1ï¼Œè¡¨ç¤ºæ•°æ®å·²ç»å‘é€å®Œæˆï¼Œå¯ä»¥é‡Šæ”¾è¿æ¥ã€‚</li></ul><blockquote><p>çª—å£å¤§å°å­—æ®µ</p></blockquote><p>çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰ï¼šå  16 ä½ã€‚å®ƒè¡¨ç¤ºä» Ack Number å¼€å§‹è¿˜å¯ä»¥æ¥æ”¶å¤šå°‘å­—èŠ‚çš„æ•°æ®é‡ï¼Œä¹Ÿ è¡¨ç¤ºå½“å‰æ¥æ”¶ç«¯çš„æ¥æ”¶çª—å£è¿˜æœ‰å¤šå°‘å‰©ä½™ç©ºé—´ã€‚è¯¥å­—æ®µå¯ä»¥ç”¨äº TCP çš„æµé‡æ§åˆ¶ã€‚</p><blockquote><p>TCP æ ¡éªŒå’Œå­—æ®µ</p></blockquote><p>æ ¡éªŒä½ï¼ˆTCPChecksumï¼‰ï¼šå 16ä½ã€‚å®ƒç”¨äºç¡®è®¤ä¼ è¾“çš„æ•°æ®æ˜¯å¦æœ‰æŸåã€‚å‘é€ç«¯åŸºäºæ•°æ®å†…å®¹æ ¡éªŒç”Ÿæˆä¸€ä¸ªæ•°å€¼ï¼Œæ¥æ”¶ç«¯æ ¹æ®æ¥æ”¶çš„æ•°æ®æ ¡éªŒç”Ÿæˆä¸€ä¸ªå€¼ã€‚ä¸¤ä¸ªå€¼å¿…é¡»ç›¸åŒï¼Œæ‰èƒ½è¯æ˜æ•°æ®æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœä¸¤ä¸ªå€¼ä¸åŒï¼Œåˆ™ä¸¢æ‰è¿™ä¸ªæ•°æ®åŒ…ã€‚Checksumæ˜¯æ ¹æ®ä¼ªå¤´+TCPå¤´+TCPæ•°æ®ä¸‰éƒ¨åˆ†è¿›è¡Œè®¡ç®—çš„ã€‚</p><blockquote><p>ç´§æ€¥æŒ‡é’ˆå­—æ®µ</p></blockquote><p>ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ï¼šä»…å½“å‰é¢çš„ URG æ§åˆ¶ä½ä¸º 1 æ—¶æ‰æœ‰æ„ä¹‰ã€‚å®ƒæŒ‡å‡ºæœ¬æ•°æ®æ®µä¸­ä¸ºç´§æ€¥æ•°æ® çš„å­—èŠ‚æ•°ï¼Œå  16 ä½ã€‚å½“æ‰€æœ‰ç´§æ€¥æ•°æ®å¤„ç†å®Œåï¼ŒTCP å°±ä¼šå‘Šè¯‰åº”ç”¨ç¨‹åºæ¢å¤åˆ°æ­£å¸¸æ“ä½œã€‚å³ä½¿å½“å‰çª— å£å¤§å°ä¸º 0ï¼Œä¹Ÿæ˜¯å¯ä»¥å‘é€ç´§æ€¥æ•°æ®çš„ï¼Œå› ä¸ºç´§æ€¥æ•°æ®æ— é¡»ç¼“å­˜ã€‚</p><blockquote><p>å¯é€‰é¡¹å­—æ®µ</p></blockquote><p>é€‰é¡¹ï¼ˆOptionï¼‰ï¼šé•¿åº¦ä¸å®šï¼Œä½†é•¿åº¦å¿…é¡»æ˜¯ 32bits çš„æ•´æ•°å€ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210615205125038.png" alt="image-20210615205125038"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210616101803429.png" alt="image-20210616101803429"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210616103716046.png" alt="image-20210616103716046"></p><h2 id="2ã€æ¡æ‰‹"><a href="#2ã€æ¡æ‰‹" class="headerlink" title="2ã€æ¡æ‰‹"></a>2ã€æ¡æ‰‹</h2><p>SYNâ€“æ ‡å¿—ä½</p><p>Seqâ€“éšæœºåºåˆ—å·</p><p>ACKâ€“åº”ç­”æŠ¥æ–‡</p><p>ackâ€“ç¡®è®¤åºåˆ—å·ï¼ˆack=x+1ï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqcmapkprj30pm0lk0w1.jpg" alt="image-20210420174213945"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqcmotnfjj31fy03w40t.jpg" alt="image-20210420174236651"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpqcn921bej31by0hutgs.jpg" alt="image-20210420174308237"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210615212011080.png" alt="image-20210615212011080"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210615212132528.png" alt="image-20210615212132528"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210615213000278.png" alt="image-20210615213000278"></p><p><strong>å…·ä½“çš„è§PDFç¬¬ä¸‰ç« 26é¡µ</strong></p><p>åœ¨æ•°æ®å‘é€çš„è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨æ»‘åŠ¨çª—å£è¿›è¡Œæ•°æ®çš„å‘é€</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210422104504154.png" alt="image-20210422104504154"></p><h2 id="3ã€udpåè®®"><a href="#3ã€udpåè®®" class="headerlink" title="3ã€udpåè®®"></a>3ã€udpåè®®</h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4r871ksj319y0u0qen.jpg" alt="image-20210421095544693"></p><p>è®²è§£ä¸€ä¸‹ï¼š </p><p>*UDPå¤´éƒ¨å¾ˆç®€å•ï¼ŒåŒ…æ‹¬æºç«¯å£ï¼Œç›®çš„ç«¯å£ï¼ŒUDPæ€»é•¿åº¦ï¼Œæ ¡éªŒå’Œï¼Œå„å 16ä½/2å­—èŠ‚ï¼Œå…±8å­—èŠ‚ã€‚ </p><p>*æºç«¯å£ï¼šé•¿åº¦16ä½ï¼ŒæŒ‡å®šå‘é€æ–¹æ‰€ä½¿ç”¨çš„ç«¯å£å·ï¼Œè‹¥ä¸éœ€è¦å¯¹æ–¹å›å‘æ¶ˆæ¯ï¼Œåˆ™å¯å…¨ç½®ä¸º0ã€‚ </p><p>*ç›®çš„ç«¯å£ï¼šé•¿åº¦16ä½ï¼ŒæŒ‡å®šæ¥æ”¶æ–¹æ‰€ä½¿ç”¨çš„ç«¯å£å·ã€‚ </p><p>*UDPæ€»é•¿åº¦ï¼šé•¿åº¦16ä½ï¼ŒæŒ‡å®šäº†UDPæ•°æ®æŠ¥çš„æ€»é•¿åº¦ã€‚ </p><p>*æ ¡éªŒå’Œï¼šé•¿åº¦16ä½ï¼Œç”¨äºUDPçš„å·®é”™æ£€æµ‹ï¼Œé˜²æ­¢UDPæŠ¥æ–‡å‡ºé”™ï¼ŒåŒæ—¶ä¼ªé¦–éƒ¨å‚ä¸è®¡ç®—ï¼Œé¿å…UDPç”¨æˆ· æ•°æ®æŠ¥ä¼ é€åˆ°é”™è¯¯çš„ç›®çš„åœ°ã€‚UDPçš„é¦–éƒ¨ï¼Œæ•°æ®éƒ¨åˆ†ï¼Œä¼ªé¦–éƒ¨éƒ½ä¼šå‚ä¸æ£€éªŒå’Œçš„è®¡ç®—ï¼Œå„å­—æ®µæ˜¯æŒ‰ç…§16 æ¯”ç‰¹ä¸ºå•ä½è¿›è¡Œè®¡ç®—çš„ï¼Œå› æ­¤æ•°æ®éƒ¨åˆ†æ˜¯è¦ä¿è¯æ˜¯16æ¯”ç‰¹çš„å€æ•°ï¼Œä¸å¤Ÿç”¨0å¡«å……ã€‚</p><blockquote><p>tcpä¸udpçš„åŒºåˆ«</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210422105701215.png" alt="image-20210422105701215"></p><h2 id="4ã€httpåè®®"><a href="#4ã€httpåè®®" class="headerlink" title="4ã€httpåè®®"></a>4ã€httpåè®®</h2><h3 id="1ã€HTTPåè®®ç®€ä»‹"><a href="#1ã€HTTPåè®®ç®€ä»‹" class="headerlink" title="1ã€HTTPåè®®ç®€ä»‹"></a>1ã€HTTPåè®®ç®€ä»‹</h3><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆè‹±æ–‡ï¼šHyperText Transfer Protocolï¼Œç¼©å†™ï¼šHTTPï¼‰æ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼ã€åä½œå¼å’Œ è¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„<strong>åº”ç”¨å±‚åè®®</strong>ã€‚HTTPæ˜¯ä¸‡ç»´ç½‘çš„æ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚</p><p>HTTPçš„å‘å±•æ˜¯ç”±è’‚å§†Â·ä¼¯çº³æ–¯-æäº1989å¹´åœ¨æ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼ˆCERNï¼‰æ‰€å‘èµ·ã€‚HTTPçš„æ ‡å‡†åˆ¶å®šç”±ä¸‡ ç»´ç½‘åä¼šï¼ˆWorld Wide Web Consortiumï¼ŒW3Cï¼‰å’Œäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆInternet Engineering Task Forceï¼ŒIETFï¼‰è¿›è¡Œåè°ƒï¼Œæœ€ç»ˆå‘å¸ƒäº†ä¸€ç³»åˆ—çš„RFCï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯1999å¹´6æœˆå…¬å¸ƒçš„ RFC 2616ï¼Œå®š ä¹‰äº†HTTPåè®®ä¸­ç°ä»Šå¹¿æ³›ä½¿ç”¨çš„ä¸€ä¸ªç‰ˆæœ¬â€”â€”HTTP 1.1ã€‚</p><p>2014å¹´12æœˆï¼Œäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰çš„Hypertext Transfer Protocol Bisï¼ˆhttpbisï¼‰å·¥ä½œå°ç»„å°† HTTP/2æ ‡å‡†æè®®é€’äº¤è‡³IESGè¿›è¡Œè®¨è®ºï¼Œäº2015å¹´2æœˆ17æ—¥è¢«æ‰¹å‡†ã€‚ HTTP/2æ ‡å‡†äº2015å¹´5æœˆä»¥RFC 7540æ­£å¼å‘è¡¨ï¼Œå–ä»£HTTP 1.1æˆä¸ºHTTPçš„å®ç°æ ‡å‡†ã€‚</p><h3 id="2ã€HTTPåè®®æ¦‚è¿°"><a href="#2ã€HTTPåè®®æ¦‚è¿°" class="headerlink" title="2ã€HTTPåè®®æ¦‚è¿°"></a>2ã€HTTPåè®®æ¦‚è¿°</h3><p>HTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»ˆç«¯ï¼ˆç”¨æˆ·ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆç½‘ç«™ï¼‰è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚</p><p>é€šè¿‡ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨æˆ–è€…å…¶å®ƒçš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º 80ï¼‰ã€‚</p><p>æˆ‘ä»¬ç§°è¿™ä¸ªå®¢æˆ·ç«¯ä¸ºç”¨æˆ·ä»£ç†ç¨‹åºï¼ˆuser agentï¼‰ã€‚</p><p>åº”ç­”çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨ç€ä¸€äº›èµ„æºï¼Œæ¯”å¦‚HTMLæ–‡ä»¶å’Œå›¾åƒã€‚æˆ‘ä»¬ç§°è¿™ä¸ªåº”ç­”æœåŠ¡å™¨ä¸ºæºæœåŠ¡å™¨ï¼ˆorigin serverï¼‰ã€‚</p><p>é€šå¸¸ï¼Œç”±HTTPå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œåˆ›<strong>å»ºä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤æ˜¯80ç«¯å£,httpsæ˜¯443ï¼‰çš„è¿æ¥</strong>ã€‚HTTPæœåŠ¡å™¨åˆ™<strong>åœ¨é‚£ä¸ªç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚</strong>ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯”å¦‚â€HTTP/1.1 200 OKâ€ï¼Œä»¥åŠè¿”å›çš„å†…å®¹ï¼Œå¦‚è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯æ¶ˆæ¯ã€æˆ–è€…å…¶å®ƒä¿¡æ¯ã€‚</p><h3 id="3ã€HTTPå·¥ä½œåŸç†"><a href="#3ã€HTTPå·¥ä½œåŸç†" class="headerlink" title="3ã€HTTPå·¥ä½œåŸç†"></a>3ã€HTTPå·¥ä½œåŸç†</h3><p>HTTPåè®®å®šä¹‰Webå®¢æˆ·ç«¯å¦‚ä½•ä»WebæœåŠ¡å™¨è¯·æ±‚Webé¡µé¢ï¼Œä»¥åŠæœåŠ¡å™¨å¦‚ä½•æŠŠWebé¡µé¢ä¼ é€ç»™å®¢æˆ· ç«¯ã€‚HTTPåè®®é‡‡ç”¨äº†<strong>è¯·æ±‚/å“åº”æ¨¡å‹</strong>ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡åŒ…å«è¯·æ±‚çš„æ–¹æ³•ã€ URLã€åè®®ç‰ˆæœ¬ã€è¯·æ±‚å¤´éƒ¨å’Œè¯·æ±‚æ•°æ®ã€‚æœåŠ¡å™¨ä»¥ä¸€ä¸ªçŠ¶æ€è¡Œä½œä¸ºå“åº”ï¼Œå“åº”çš„å†…å®¹åŒ…æ‹¬åè®®çš„ç‰ˆæœ¬ã€ æˆåŠŸæˆ–è€…é”™è¯¯ä»£ç ã€æœåŠ¡å™¨ä¿¡æ¯ã€å“åº”å¤´éƒ¨å’Œå“åº”æ•°æ®ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210610193946860.png" alt="image-20210610193946860"></p><p>åœ¨ç«¯å£å·ä¸º80çš„æœ¬åœ°å»ºç«‹ä¸€ä¸ªå®ˆæŠ¤socketï¼Œå½“ä»»æ„ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™ï¼Œå†å»ºç«‹ä¸€ä¸ªsocketï¼Œä½†å®ˆæŠ¤socketä¸€ç›´å­˜åœ¨ã€‚</p><p><strong>ä»¥ä¸‹æ˜¯ HTTP è¯·æ±‚/å“åº”çš„æ­¥éª¤ï¼š</strong></p><ol><li><p>1.å®¢æˆ·ç«¯è¿æ¥åˆ°WebæœåŠ¡å™¨æµè§ˆå™¨å‘DNSæœåŠ¡å™¨è¯·æ±‚è§£æè¯¥URLä¸­çš„åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€ï¼Œä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œé€šå¸¸æ˜¯æµè§ˆå™¨ï¼Œä¸WebæœåŠ¡å™¨çš„HTTPç«¯å£ï¼ˆé»˜è®¤ä¸º80ï¼‰å»ºç«‹ä¸€ä¸ªTCPå¥—æ¥å­—è¿æ¥ã€‚ä¾‹å¦‚ï¼Œ <a href="http://www.luffycity.com/">http://www.luffycity.com</a></p></li><li><p>å‘é€HTTPè¯·æ±‚ é€šè¿‡TCPå¥—æ¥å­—ï¼Œå®¢æˆ·ç«¯å‘WebæœåŠ¡å™¨å‘é€ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡ï¼Œä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ç”±<strong>è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®</strong>4éƒ¨åˆ†ç»„æˆã€‚</p></li><li><p>æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶è¿”å›HTTPå“åº” WebæœåŠ¡å™¨<strong>è§£æè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æº</strong>ã€‚æœåŠ¡å™¨å°†èµ„æºå¤æœ¬å†™åˆ°TCPå¥—æ¥å­—ï¼Œç”±å®¢æˆ·ç«¯è¯»å–ã€‚ä¸€ä¸ªå“ åº”ç”±<strong>çŠ¶æ€è¡Œã€å“åº”å¤´éƒ¨ã€ç©ºè¡Œå’Œå“åº”æ•°æ®</strong>4éƒ¨åˆ†ç»„æˆã€‚</p></li><li><p>é‡Šæ”¾è¿æ¥TCPè¿æ¥ è‹¥connection æ¨¡å¼ä¸ºcloseï¼Œåˆ™æœåŠ¡å™¨ä¸»åŠ¨å…³é—­TCPè¿æ¥ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­è¿æ¥ï¼Œé‡Šæ”¾TCPè¿æ¥;è‹¥ connection æ¨¡å¼ä¸ºkeepaliveï¼Œåˆ™è¯¥è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´å†…å¯ä»¥ç»§ç»­æ¥æ”¶è¯·æ±‚;</p></li><li><p>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æHTMLå†…å®¹</p><p>å®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè§£æçŠ¶æ€è¡Œï¼ŒæŸ¥çœ‹è¡¨æ˜è¯·æ±‚æ˜¯å¦æˆåŠŸçš„çŠ¶æ€ä»£ç ã€‚ç„¶åè§£ææ¯ä¸€ä¸ªå“åº”å¤´ï¼Œå“åº” å¤´å‘ŠçŸ¥ä»¥ä¸‹ä¸ºè‹¥å¹²å­—èŠ‚çš„HTMLæ–‡æ¡£å’Œæ–‡æ¡£çš„å­—ç¬¦é›†ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è¯»å–å“åº”æ•°æ®HTMLï¼Œæ ¹æ® HTMLçš„è¯­æ³•å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶åœ¨æµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºã€‚</p></li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4uenbidj31b60f4133.jpg" alt="image-20210421095847308"></p><p><strong>httpåè®®æ˜¯åŸºäºTCP/IPåè®®ä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®</strong></p><p> <strong>åŸºäº è¯·æ±‚-å“åº” çš„æ¨¡å¼</strong> </p><p>HTTPåè®®è§„å®š,è¯·æ±‚ä»å®¢æˆ·ç«¯å‘å‡º,æœ€åæœåŠ¡å™¨ç«¯å“åº”è¯¥è¯·æ±‚å¹¶ è¿”å›ã€‚æ¢å¥è¯è¯´,è‚¯å®šæ˜¯å…ˆä»å®¢æˆ·ç«¯å¼€ å§‹å»ºç«‹é€šä¿¡çš„,æœåŠ¡å™¨ç«¯åœ¨æ²¡æœ‰ æ¥æ”¶åˆ°è¯·æ±‚ä¹‹å‰ä¸ä¼šå‘é€å“åº”ï¼Œ<strong>æœåŠ¡ç«¯ä¸èƒ½ä¸»åŠ¨è¯´è¯</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4v1bp61j31em0i8gxu.jpg" alt="image-20210421095923805"></p><p><strong>æ— çŠ¶æ€</strong> </p><p>HTTPæ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€,å³æ— çŠ¶æ€(stateless)åè®®ã€‚HTTPåè®® è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€ è¿›è¡Œä¿å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨HTTPè¿™ä¸ª çº§åˆ«,åè®®å¯¹äº<strong>å‘é€è¿‡çš„è¯·æ±‚æˆ–å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4vk81ccj31b80mugz6.jpg" alt="image-20210421095953726"></p><p>ä½¿ç”¨HTTPåè®®,æ¯å½“æœ‰æ–°çš„è¯·æ±‚å‘é€æ—¶,å°±ä¼šæœ‰å¯¹åº”çš„æ–°å“åº”äº§ç”Ÿã€‚åè®®æœ¬èº«å¹¶ä¸ä¿ç•™ä¹‹å‰ä¸€åˆ‡çš„è¯·æ±‚æˆ–å“åº”æŠ¥æ–‡çš„ä¿¡æ¯ã€‚è¿™æ˜¯ä¸ºäº†æ›´å¿«åœ°å¤„ç†å¤§é‡äº‹åŠ¡,ç¡®ä¿åè®®çš„å¯ä¼¸ç¼©æ€§,è€Œç‰¹æ„æŠŠHTTPåè®®è®¾è®¡æˆå¦‚æ­¤ç®€å•çš„ã€‚å¯æ˜¯,éšç€Webçš„ä¸æ–­å‘å±•,å› æ— çŠ¶æ€è€Œå¯¼è‡´ä¸šåŠ¡å¤„ç†å˜å¾—æ£˜æ‰‹çš„æƒ…å†µå¢å¤šäº†ã€‚æ¯”å¦‚,ç”¨æˆ·ç™»å½•åˆ°ä¸€å®¶è´­ç‰©ç½‘ç«™,å³ä½¿ä»–è·³è½¬åˆ°è¯¥ç«™çš„å…¶ä»–é¡µé¢å,ä¹Ÿéœ€è¦èƒ½ç»§ç»­ä¿æŒç™»å½•çŠ¶æ€ã€‚é’ˆå¯¹è¿™ä¸ªå®ä¾‹,ç½‘ç«™ä¸ºäº†èƒ½å¤ŸæŒæ¡æ˜¯è°é€å‡ºçš„è¯·æ±‚,éœ€è¦ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ã€‚HTTP/1.1è™½ç„¶æ˜¯æ— çŠ¶æ€åè®®,ä½†ä¸ºäº†å®ç°æœŸæœ›çš„ä¿æŒçŠ¶æ€åŠŸèƒ½,äºæ˜¯<strong>å¼•å…¥äº†CookieæŠ€æœ¯ã€‚æœ‰äº†Cookieå†ç”¨HTTPåè®®é€šä¿¡,å°±å¯ä»¥ç®¡ç†çŠ¶æ€äº†</strong>ã€‚</p><p><strong>æ— è¿æ¥</strong></p><p>æ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ï¼Œå¹¶ä¸”å¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ï¼Œä¸èƒ½å’Œæ¯ä¸ªç”¨æˆ·å»ºç«‹é•¿ä¹…çš„è¿æ¥ï¼Œè¯·æ±‚ä¸€æ¬¡ç›¸åº”ä¸€æ¬¡ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å°±ä¸­æ–­äº†ã€‚ä½†æ˜¯æ— è¿æ¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œæ—©æœŸçš„httpåè®®æ˜¯ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªå“åº”ä¹‹åï¼Œç›´æ¥å°±æ–­å¼€äº†ï¼Œä½†æ˜¯<strong>ç°åœ¨çš„httpåè®®1.1ç‰ˆæœ¬ä¸æ˜¯ç›´æ¥å°±æ–­å¼€äº†ï¼Œè€Œæ˜¯ç­‰å‡ ç§’é’Ÿï¼Œè¿™å‡ ç§’é’Ÿæ˜¯ç­‰ä»€ä¹ˆå‘¢ï¼Œç­‰ç€ç”¨æˆ·æœ‰åç»­çš„æ“ä½œï¼Œå¦‚æœç”¨æˆ·åœ¨è¿™å‡ ç§’é’Ÿä¹‹å†…æœ‰æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯é€šè¿‡ä¹‹å‰çš„è¿æ¥é€šé“æ¥æ”¶å‘æ¶ˆæ¯ï¼Œå¦‚æœè¿‡äº†è¿™å‡ ç§’é’Ÿç”¨æˆ·æ²¡æœ‰å‘é€æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šæ–­å¼€è¿æ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œå‡å°‘çŸ­æ—¶é—´å†…å»ºç«‹è¿æ¥çš„æ¬¡æ•°ï¼Œå› ä¸ºå»ºç«‹è¿æ¥ä¹Ÿæ˜¯è€—æ—¶çš„ï¼Œé»˜è®¤çš„å¥½åƒæ˜¯3ç§’ä¸­ç°åœ¨</strong>ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶é—´æ˜¯å¯ä»¥é€šè¿‡å’±ä»¬åç«¯çš„ä»£ç æ¥è°ƒæ•´çš„ï¼Œè‡ªå·±ç½‘ç«™æ ¹æ®è‡ªå·±ç½‘ç«™ç”¨æˆ·çš„è¡Œä¸ºæ¥åˆ†æç»Ÿè®¡å‡ºä¸€ä¸ªæœ€ä¼˜çš„ç­‰å¾…æ—¶é—´</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210610194254771.png" alt="image-20210610194254771"></p><blockquote><p>æ¥ä¸ªæ€»ç»“ http æ˜¯ä¸€ç§åŸºäºè¯·æ±‚å’Œå“åº”çš„æ— çŠ¶æ€ã€æ— è¿æ¥çš„åè®®</p></blockquote><p><strong>ç®€å•çš„HTTPé€šä¿¡ä»£ç ï¼ˆåŸºäºTCPï¼‰</strong></p><p>å®¢æˆ·ç«¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        Socket socket = <span class="hljs-keyword">new</span> Socket();        socket.connect(<span class="hljs-keyword">new</span> InetSocketAddress(InetAddress.getByName(<span class="hljs-string">&quot;127.0.0.1&quot;</span>),<span class="hljs-number">4000</span>));        Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);        String msg = scanner.next();        OutputStream outputStream = socket.getOutputStream();        outputStream.write(msg.getBytes());        outputStream.flush();        outputStream.close();        socket.close();    &#125;&#125;</code></pre></div><p>æœåŠ¡å™¨</p><p>å¤šçº¿ç¨‹å¹¶å‘æ¨¡å¼é‡‡ç”¨ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹çš„æ–¹å¼ï¼Œä¼˜ç‚¹æ˜¯ç¡®å®ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†æœåŠ¡å™¨çš„ååé‡ï¼Œå› ä¸ºä¹‹å‰çš„è¯·æ±‚åœ¨<code>read</code>è¯»é˜»å¡åä¸ä¼šå½±å“åˆ°åç»­çš„è¯·æ±‚ï¼Œç”±äºå®ƒä»¬åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œè€Œä¸”ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¯¹åº”ä¸€ä¸ªå¥—æ¥å­—<code>socket</code>ï¼Œæ¯ä¸€ä¸ªå¥—æ¥å­—<code>socket</code>éƒ½æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹ä¸­åªèƒ½å¤„ç†ä¸€ä¸ªå¥—æ¥å­—ã€‚å°±ç®—<code>accept</code>å¤šä¸ª<code>socket</code>ï¼Œå¦‚æœå‰ä¸€ä¸ª<code>socket</code>è¢«é˜»å¡å…¶åçš„<code>socket</code>æ˜¯æ— æ³•è¢«æ‰§è¡Œåˆ°çš„</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//åˆ›å»ºæœåŠ¡å™¨</span>        ServerSocket server = <span class="hljs-keyword">new</span> ServerSocket();        <span class="hljs-comment">//ç»‘å®šç«¯å£</span>        server.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">4000</span>));        System.out.println(<span class="hljs-string">&quot;æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç›‘å¬4000ç«¯å£&quot;</span>);        <span class="hljs-comment">//è¿›è¡Œç›‘å¬</span>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;            Socket accept = server.accept();          <span class="hljs-comment">//åˆ©ç”¨å¤šçº¿ç¨‹é€šä¿¡</span>            <span class="hljs-keyword">new</span> MsgHandler(accept).start();        &#125;    &#125;&#125;<span class="hljs-comment">//å¤šçº¿ç¨‹å¤„ç†ï¼Œå¦‚æœæ˜¯å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œç«¯å£å·ä¸ä¸€æ ·ï¼ŒIPç›¸åŒ</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MsgHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span></span>&#123;    Socket accept = <span class="hljs-keyword">null</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MsgHandler</span><span class="hljs-params">(Socket accept)</span> </span>&#123;        <span class="hljs-keyword">this</span>.accept = accept;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;        InputStream inputStream = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ‹¿åˆ°æ•°æ®è¿›è¡Œè¯»å–</span>            inputStream = accept.getInputStream();            <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];            <span class="hljs-keyword">int</span> len;            <span class="hljs-keyword">while</span> ((len = inputStream.read(buf)) != -<span class="hljs-number">1</span>) &#123;                System.out.println(<span class="hljs-keyword">new</span> String(buf, <span class="hljs-number">0</span>, len));            &#125;        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;<span class="hljs-keyword">finally</span>&#123;            <span class="hljs-keyword">if</span>(inputStream != <span class="hljs-keyword">null</span>)&#123;                <span class="hljs-keyword">try</span> &#123;                    inputStream.close();                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                    e.printStackTrace();                &#125;            &#125;        &#125;    &#125;&#125;</code></pre></div><h3 id="4ã€HTTPè¯·æ±‚æ ¼å¼-è¯·æ±‚åè®®"><a href="#4ã€HTTPè¯·æ±‚æ ¼å¼-è¯·æ±‚åè®®" class="headerlink" title="4ã€HTTPè¯·æ±‚æ ¼å¼(è¯·æ±‚åè®®)"></a>4ã€HTTPè¯·æ±‚æ ¼å¼(è¯·æ±‚åè®®)</h3><p>å…¶å®å°±æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4x9w0jyj315y0jejww.jpg" alt="image-20210421100133351"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4xhmgr9j31ga0skthf.jpg" alt="image-20210421100146022"></p><p>è¯·æ±‚å¤´é‡Œé¢çš„å†…å®¹ä¸¾ä¸ªä¾‹å­ï¼šè¿™ä¸ªlengthè¡¨ç¤ºè¯·æ±‚ä½“é‡Œé¢çš„æ•°æ®é•¿åº¦ï¼Œå…¶ä»–çš„è¯·æ±‚å¤´é‡Œé¢çš„è¿™äº›é”®å€¼å¯¹ï¼Œé™†ç»­æˆ‘ä»¬ä¼šè®²çš„ï¼Œå¤§æ¦‚çŸ¥é“ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªuser-agentï¼Œç®—æ˜¯éœ€è¦ä½ è®°ä½çš„å§ï¼Œå°±æ˜¯å‘Šè¯‰ä½ çš„æœåŠ¡ç«¯ï¼Œæˆ‘æ˜¯ç”¨ä»€ä¹ˆç»™ä½ å‘é€çš„è¯·æ±‚ï¼Œæ˜¯ä¸ªå•¥å®¢æˆ·ç«¯ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4y12qdmj30qm0feq5q.jpg" alt="image-20210421100214644"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4y7jdv4j31iu0ji48d.jpg" alt="image-20210421100226816"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4yfz6suj31ki0tik7p.jpg" alt="image-20210421100240863"></p><p>çœ‹ä¸€ä¸ªçˆ¬è™«çš„ä¾‹å­ï¼Œçˆ¬äº¬ä¸œçš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯çˆ¬æŠ½å±‰çš„æ—¶å€™å¿…é¡»å¸¦ç€user-agentï¼Œå› ä¸º æŠ½å±‰å¯¹user-agentåšäº†åˆ¤æ–­ï¼Œæ¥åˆ¤æ–­ä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚ï¼Œç®—æ˜¯åæ‰’æœºåˆ¶çš„ä¸€ç§</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr4ywttdaj31hq0kwk2f.jpg" alt="image-20210421100307753"></p><p>æ‰“å¼€æˆ‘ä»¬ä¿å­˜çš„demo.htmlæ–‡ä»¶ï¼Œç„¶åé€šè¿‡æµè§ˆå™¨æ‰“å¼€çœ‹çœ‹å°±èƒ½çœ‹åˆ°é¡µé¢æ•ˆæœã€‚</p><p>å†™ä¸Šé¢è¿™äº›å†…å®¹çš„æ„æ€æ˜¯è®©ä½ çŸ¥é“æœ‰è¿™ä¹ˆä¸ªè¯·æ±‚å¤´çš„å­˜åœ¨ï¼Œæœ‰äº›æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¯·æ±‚å¤´æˆ‘ä»¬ è¿˜å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œå°±åœ¨requestsæ¨¡å—é‡Œé¢é‚£ä¸ªheaders={}ï¼Œè¿™ä¸ªå­—å…¸é‡Œé¢åŠ å°±è¡Œ</p><h3 id="5ã€HTTPè¯·æ±‚æ–¹æ³•"><a href="#5ã€HTTPè¯·æ±‚æ–¹æ³•" class="headerlink" title="5ã€HTTPè¯·æ±‚æ–¹æ³•"></a>5ã€HTTPè¯·æ±‚æ–¹æ³•</h3><p>HTTP/1.1åè®®ä¸­å…±å®šä¹‰äº†å…«ç§æ–¹æ³•ï¼ˆä¹Ÿå«â€œåŠ¨ä½œâ€ï¼‰æ¥ä»¥ä¸åŒæ–¹å¼æ“ä½œæŒ‡å®šçš„èµ„æºï¼š</p><ul><li>GET</li></ul><p>å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ã€‚ä½¿ç”¨GETæ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ï¼Œè€Œä¸åº”å½“è¢«ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ï¼Œå¸¸ç”¨è¯­æŸ¥è¯¢æ•°æ®çš„è¯·æ±‚ã€‚</p><ul><li>POST</li></ul><p>å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æœ¬æ–‡ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–äºŒè€…çš†æœ‰ã€‚å¸¸ç”¨äºå¯¹æ•°æ®çš„å¢åˆ æ”¹æ“ä½œã€‚</p><blockquote><p>è¯·æ±‚æ–¹å¼: getä¸postè¯·æ±‚ï¼ˆé€šè¿‡formè¡¨å•æˆ‘ä»¬è‡ªå·±å†™å†™çœ‹ï¼‰</p></blockquote><ul><li>GETæäº¤çš„æ•°æ®ä¼šæ”¾åœ¨URLä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚è¡Œé‡Œé¢ï¼Œä»¥?åˆ†å‰²URLå’Œä¼ è¾“æ•°æ®ï¼Œå‚æ•°ä¹‹é—´ä»¥&amp;ç›¸è¿ï¼Œå¦‚EditBook?name=test1&amp;id=123456.ï¼ˆè¯·æ±‚å¤´é‡Œé¢é‚£ä¸ªcontent-typeåšçš„è¿™ç§å‚æ•°å½¢å¼ï¼Œåé¢è®²ï¼‰POSTæ–¹æ³•æ˜¯æŠŠæäº¤çš„æ•°æ®æ”¾åœ¨HTTPåŒ…çš„è¯·æ±‚ä½“ä¸­</li><li>GETæäº¤çš„æ•°æ®å¤§å°æœ‰é™åˆ¶ï¼ˆå› ä¸ºæµè§ˆå™¨å¯¹URLçš„é•¿åº¦æœ‰é™åˆ¶ï¼‰ï¼Œè€ŒPOSTæ–¹æ³•æäº¤çš„æ•°æ®æ²¡æœ‰é™åˆ¶</li><li>GETä¸POSTè¯·æ±‚åœ¨æœåŠ¡ç«¯è·å–è¯·æ±‚æ•°æ®æ–¹å¼ä¸åŒï¼Œå°±æ˜¯æˆ‘ä»¬è‡ªå·±åœ¨æœåŠ¡ç«¯å–è¯·æ±‚æ•°æ®çš„æ—¶å€™çš„æ–¹å¼ä¸åŒäº†</li></ul><h3 id="6ã€URL"><a href="#6ã€URL" class="headerlink" title="6ã€URL"></a>6ã€URL</h3><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦å°†ä»å› ç‰¹ç½‘è·å–ä¿¡æ¯çš„äº”ä¸ªåŸºæœ¬å…ƒç´ åŒ…æ‹¬åœ¨ä¸€ä¸ªç®€å•çš„åœ°å€ä¸­ï¼š</p><ul><li>ä¼ é€åè®®</li><li>å±‚çº§URLæ ‡è®°ç¬¦å·(ä¸º[//],å›ºå®šä¸å˜) </li><li>è®¿é—®èµ„æºéœ€è¦çš„å‡­è¯ä¿¡æ¯ï¼ˆå¯çœç•¥ï¼‰ </li><li>æœåŠ¡å™¨ï¼ˆé€šå¸¸ä¸ºåŸŸåï¼Œæœ‰æ—¶ä¸ºIPåœ°å€ï¼‰ </li><li>ç«¯å£å·ï¼ˆä»¥æ•°å­—æ–¹å¼è¡¨ç¤ºï¼Œè‹¥ä¸ºHTTPçš„é»˜è®¤å€¼â€œ:80â€å¯çœç•¥ï¼‰ </li><li>è·¯å¾„ï¼ˆä»¥â€œ/â€å­—ç¬¦åŒºåˆ«è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªç›®å½•åç§°ï¼‰ </li><li>æŸ¥è¯¢ï¼ˆGETæ¨¡å¼çš„çª—ä½“å‚æ•°ï¼Œä»¥â€œ?â€å­—ç¬¦ä¸ºèµ·ç‚¹ï¼Œæ¯ä¸ªå‚æ•°ä»¥â€œ&amp;â€éš”å¼€ï¼Œå†ä»¥â€œ=â€åˆ†å¼€å‚æ•°åç§°ä¸æ•° æ®ï¼Œé€šå¸¸ä»¥UTF8çš„URLç¼–ç ï¼Œé¿å¼€å­—ç¬¦å†²çªçš„é—®é¢˜ï¼‰ </li><li>ç‰‡æ®µï¼Œä»¥â€œ#â€å­—ç¬¦ä¸ºèµ·ç‚¹</li></ul><div class="hljs code-wrapper"><pre><code class="hljs markdown">ä»¥http://www.xinzhi.com:80/news/index.html?id=250&amp;page=1 ä¸ºä¾‹, å…¶ä¸­ï¼šhttpï¼Œæ˜¯åè®®ï¼› www.xinzhi.comï¼Œæ˜¯æœåŠ¡å™¨ï¼› 80ï¼Œæ˜¯æœåŠ¡å™¨ä¸Šçš„é»˜è®¤ç½‘ç»œç«¯å£å·ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºï¼› /news/index.htmlï¼Œæ˜¯è·¯å¾„ï¼ˆURIï¼šç›´æ¥å®šä½åˆ°å¯¹åº”çš„èµ„æºï¼‰ï¼› ?id=250&amp;page=1ï¼Œæ˜¯æŸ¥è¯¢æ¡ä»¶ã€‚ å¤§å¤šæ•°ç½‘é¡µæµè§ˆå™¨ä¸è¦æ±‚ç”¨æˆ·è¾“å…¥ç½‘é¡µä¸­â€œ[http://â€çš„éƒ¨åˆ†ï¼Œå› ä¸ºç»å¤§å¤šæ•°ç½‘é¡µå†…å®¹æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶ã€‚ â€œ80â€æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶çš„å¸¸ç”¨é»˜è®¤ç«¯å£å·ï¼Œå› æ­¤ä¸€èˆ¬ä¹Ÿä¸å¿…å†™æ˜ã€‚ä¸€èˆ¬æ¥è¯´ç”¨æˆ·åªè¦é”®å…¥ç»Ÿä¸€èµ„æºå®šä½ç¬¦çš„ä¸€éƒ¨åˆ†</code></pre></div><p>Javaä¸­çš„ä¸‰æ¿æ–§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<span class="hljs-keyword">int</span> len;<span class="hljs-keyword">while</span> ((len = inputStream.read(buf)) != -<span class="hljs-number">1</span>) &#123;  System.out.println(<span class="hljs-keyword">new</span> String(buf, <span class="hljs-number">0</span>, len));&#125;</code></pre></div><h3 id="7ã€è¯·æ±‚ä¸­å¸¸è§çš„ContentType"><a href="#7ã€è¯·æ±‚ä¸­å¸¸è§çš„ContentType" class="headerlink" title="7ã€è¯·æ±‚ä¸­å¸¸è§çš„ContentType"></a>7ã€è¯·æ±‚ä¸­å¸¸è§çš„ContentType</h3><p>å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘ç»™ä½ å‘äº†ä¸ªå‚æ•°ï¼Œå‚æ•°æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä½ åº”è¯¥æ€ä¹ˆæ¥å—ï¼Œæ€ä¹ˆè§£æ</p><blockquote><p>application/x-www-form-urlencoded </p></blockquote><p>è¿™åº”è¯¥æ˜¯æœ€å¸¸è§çš„POSTæäº¤æ•°æ®çš„æ–¹å¼äº†ã€‚æµè§ˆå™¨çš„åŸç”Ÿformè¡¨å•ï¼Œå¦‚æœä¸è®¾ç½®enctypeå±æ€§ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šä»¥application/x-www-form-urlencodedæ–¹å¼æäº¤æ•°æ®ã€‚è¯·æ±‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼ˆæ— å…³çš„è¯·æ±‚å¤´åœ¨æœ¬æ–‡ä¸­éƒ½çœç•¥æ‰äº†ï¼‰</p><p>æ ¼å¼ ï¼š name=â€™lisiâ€™&amp;age=13</p><blockquote><p>application/json </p></blockquote><p>application/json è¿™ä¸ª Content-Type ä½œä¸ºå“åº”å¤´å¤§å®¶è‚¯å®šä¸é™Œç”Ÿã€‚å®é™…ä¸Šï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººæŠŠå®ƒä½œä¸ºè¯·æ±‚å¤´ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ¶ˆæ¯ä¸»ä½“æ˜¯åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ã€‚ç”±äº JSON è§„èŒƒçš„æµè¡Œï¼Œé™¤äº†ä½ç‰ˆæœ¬ IE ä¹‹å¤–çš„å„å¤§æµè§ˆå™¨éƒ½åŸç”Ÿæ”¯æŒ JSON.stringifyï¼ŒæœåŠ¡ç«¯è¯­è¨€ä¹Ÿéƒ½æœ‰å¤„ç† JSON çš„å‡½æ•°ï¼Œä½¿ç”¨ JSON ä¸ä¼šé‡ä¸Šä»€ä¹ˆéº»çƒ¦ã€‚</p><p>æ ¼å¼ï¼š {â€œnameâ€:â€lisiâ€,â€ageâ€:13} </p><blockquote><p>multipart/form-data </p></blockquote><p>è¿™åˆæ˜¯ä¸€ä¸ªå¸¸è§çš„ POST æ•°æ®æäº¤çš„æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¿…é¡»è®© form çš„ enctyped ç­‰äºè¿™ ä¸ªå€¼ã€‚ç›´æ¥æ¥çœ‹ä¸€ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼š</p><h3 id="8ã€HTTPå“åº”æ ¼å¼ï¼ˆå“åº”åè®®ï¼‰"><a href="#8ã€HTTPå“åº”æ ¼å¼ï¼ˆå“åº”åè®®ï¼‰" class="headerlink" title="8ã€HTTPå“åº”æ ¼å¼ï¼ˆå“åº”åè®®ï¼‰"></a>8ã€HTTPå“åº”æ ¼å¼ï¼ˆå“åº”åè®®ï¼‰</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr548wtogj315y0h87c0.jpg" alt="image-20210421100814365"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr54gqhucj31aw0u0k1u.jpg" alt="image-20210421100827723"></p><h3 id="9ã€HTTPçŠ¶æ€ç "><a href="#9ã€HTTPçŠ¶æ€ç " class="headerlink" title="9ã€HTTPçŠ¶æ€ç "></a>9ã€HTTPçŠ¶æ€ç </h3><p>æ‰€æœ‰HTTPå“åº”çš„ç¬¬ä¸€è¡Œéƒ½æ˜¯çŠ¶æ€è¡Œï¼Œä¾æ¬¡æ˜¯å½“å‰HTTPç‰ˆæœ¬å·ï¼Œ3ä½æ•°å­—ç»„æˆçš„çŠ¶æ€ä»£ç ï¼Œä»¥åŠæè¿°çŠ¶æ€ çš„çŸ­è¯­ï¼Œå½¼æ­¤ç”±ç©ºæ ¼åˆ†éš”ã€‚</p><p>çŠ¶æ€ä»£ç çš„ç¬¬ä¸€ä¸ªæ•°å­—ä»£è¡¨å½“å‰å“åº”çš„ç±»å‹ï¼š</p><ul><li>1xxæ¶ˆæ¯â€”â€”è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç»§ç»­å¤„ç† </li><li>2xxæˆåŠŸâ€”â€”è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å— </li><li>3xxé‡å®šå‘â€”â€”éœ€è¦åç»­æ“ä½œæ‰èƒ½å®Œæˆè¿™ä¸€è¯·æ±‚ </li><li>4xxè¯·æ±‚é”™è¯¯â€”â€”è¯·æ±‚å«æœ‰è¯æ³•é”™è¯¯æˆ–è€…æ— æ³•è¢«æ‰§è¡Œï¼Œå®¢æˆ·ç«¯ </li><li>5xxæœåŠ¡å™¨é”™è¯¯â€”â€”æœåŠ¡å™¨åœ¨å¤„ç†æŸä¸ªæ­£ç¡®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼Œ500</li></ul><p>è™½ç„¶ RFC 2616 ä¸­å·²ç»æ¨èäº†æè¿°çŠ¶æ€çš„çŸ­è¯­ï¼Œä¾‹å¦‚â€200 OKâ€ï¼Œâ€404 Not Foundâ€ï¼Œä½†æ˜¯WEBå¼€å‘è€…ä» ç„¶èƒ½å¤Ÿè‡ªè¡Œå†³å®šé‡‡ç”¨ä½•ç§çŸ­è¯­ï¼Œç”¨ä»¥æ˜¾ç¤ºæœ¬åœ°åŒ–çš„çŠ¶æ€æè¿°æˆ–è€…è‡ªå®šä¹‰ä¿¡æ¯</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr55eremqj31fu0han86.jpg" alt="image-20210421100922367"></p><p><strong>çŠ¶æ€ç ï¼ˆStatus Codesï¼‰</strong></p><table><thead><tr><th>2xxï¼šæˆåŠŸ</th><th>3xxï¼šé‡å®šå‘</th><th>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯</th><th>5xxï¼šæœåŠ¡å™¨é”™è¯¯</th></tr></thead><tbody><tr><td>200 æˆåŠŸ</td><td>301 æ°¸ä¹…é‡å®šå‘</td><td>400 é”™è¯¯è¯·æ±‚</td><td>500 æœåŠ¡å™¨é”™è¯¯</td></tr><tr><td>201 åˆ›å»º</td><td>304 èµ„æºæœªä¿®æ”¹</td><td>401 æœªæˆæƒ</td><td>501 å°šæœªå®æ–½</td></tr><tr><td></td><td></td><td>410 å·²åˆ é™¤</td><td>502 ç½‘å…³é”™è¯¯</td></tr><tr><td></td><td></td><td>403 ç¦æ­¢è®¿é—®</td><td>503 æœåŠ¡ä¸å¯ç”¨</td></tr><tr><td></td><td></td><td>404 æœªæ‰¾åˆ°</td><td>504 ç½‘å…³è¶…æ—¶</td></tr><tr><td></td><td></td><td>405 è¯·æ±‚æ–¹æ³•ä¸å¯¹</td><td>505 HTTPç‰ˆæœ¬ä¸æ”¯æŒ</td></tr></tbody></table><h3 id="10ã€å“åº”ä¸­å¸¸è§çš„contentType"><a href="#10ã€å“åº”ä¸­å¸¸è§çš„contentType" class="headerlink" title="10ã€å“åº”ä¸­å¸¸è§çš„contentType"></a>10ã€å“åº”ä¸­å¸¸è§çš„contentType</h3><p><code>text/html </code></p><p>å‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘ç»™ä½ è¿”å›çš„æ˜¯htmlï¼Œè¯·æ¸²æŸ“</p><p><code>application/json</code></p><p>å‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘ç»™ä½ è¿”å›çš„æ˜¯jsonæ•°æ® ï¼Œä¸€èˆ¬ä¼šè®©jså»å¤„ç†</p><p><strong>å¸¸è§çš„contenttypeå¯¹ç…§è¡¨</strong></p><p><a href="https://tool.oschina.net/commons/">https://tool.oschina.net/commons/</a></p><h3 id="11ã€ä¸€äº›å¸¸è§çš„å“åº”å¤´"><a href="#11ã€ä¸€äº›å¸¸è§çš„å“åº”å¤´" class="headerlink" title="11ã€ä¸€äº›å¸¸è§çš„å“åº”å¤´"></a>11ã€ä¸€äº›å¸¸è§çš„å“åº”å¤´</h3><p>å¸¸è§çš„è¯·æ±‚å¤´å¯¹ç…§è¡¨</p><p><a href="http://tools.jb51.net/table/http_header">http://tools.jb51.net/table/http_header</a></p><div class="hljs code-wrapper"><pre><code class="hljs css">Server: Apache-Coyote/<span class="hljs-number">1.1</span>ï¼šæœåŠ¡å™¨çš„ç‰ˆæœ¬ä¿¡æ¯ï¼› Content-Type: text/html;charset=UTF-8ï¼šå“åº”ä½“ä½¿ç”¨çš„ç¼–ç ä¸ºUTF-8ï¼› <span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">724</span>ï¼šå“åº”ä½“ä¸º<span class="hljs-number">724</span>å­—èŠ‚ï¼› Set-Cookie: JSESSIONID=C97E2B4C55553EAB46079A4F263435A4; Path=/helloï¼šå“åº”ç»™å®¢æˆ·ç«¯çš„Cookieï¼› Date: Wed, 25 Sep 2012 04:15:03 GMTï¼šå“åº”çš„æ—¶é—´ï¼Œè¿™å¯èƒ½ä¼šæœ‰8å°æ—¶çš„æ—¶åŒºå·®ï¼›Last-Modifiedï¼šæœ€åçš„ä¿®æ”¹æ—¶é—´ï¼› If-Modified-Sinceï¼šæŠŠä¸Šæ¬¡è¯·æ±‚çš„index<span class="hljs-selector-class">.html</span>çš„æœ€åä¿®æ”¹æ—¶é—´è¿˜ç»™æœåŠ¡å™¨ï¼›//å‘Šè¯‰æµè§ˆå™¨ä¸è¦ç¼“å­˜ï¼š Expires: -<span class="hljs-number">1</span>ï¼› Cache-Control: no-cacheï¼› Pragma: no-cacheï¼› **è‡ªåŠ¨åˆ·æ–°**å“åº”å¤´ï¼Œæµè§ˆå™¨ä¼šåœ¨<span class="hljs-number">3</span>ç§’ä¹‹åè¯·æ±‚http://www.itcast.cnï¼š Refresh: 3;url=http://www.itcast.cn</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr5bf2wnrj31160u048m.jpg" alt="image-20210421101507448"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpr5bqh57jj30yw0jcdii.jpg" alt="image-20210421101526912"></p><h1 id="å››ã€Tomcat"><a href="#å››ã€Tomcat" class="headerlink" title="å››ã€Tomcat"></a>å››ã€Tomcat</h1><p>Web åº”â½¤æœåŠ¡å™¨ï¼šTomcatã€Jboosã€Weblogicã€Jetty</p><h2 id="tomcatç›®å½•"><a href="#tomcatç›®å½•" class="headerlink" title="tomcatç›®å½•"></a><strong>tomcatç›®å½•</strong></h2><ul><li>binï¼šå­˜æ”¾å„ä¸ªå¹³å°ä¸‹å¯åŠ¨å’Œåœâ½Œ Tomcat æœåŠ¡çš„è„šæœ¬â½‚ä»¶</li><li>confï¼šå­˜æ”¾å„ç§ Tomcat æœåŠ¡å™¨çš„é…ç½®â½‚ä»¶</li><li>libï¼šå­˜æ”¾TomcatæœåŠ¡å™¨æ‰€éœ€è¦çš„ jar</li><li>logsï¼šå­˜æ”¾TomcaræœåŠ¡è¿â¾çš„â½‡å¿— </li><li>tempï¼šTomcat è¿â¾æ—¶çš„ä¸´æ—¶â½‚ä»¶</li><li>webappsï¼šä¸“é—¨ç”¨æ¥å­˜æ”¾éƒ¨ç½²çš„Webå·¥ç¨‹</li><li>workï¼šæ˜¯ Tomcat å·¥ä½œæ—¶çš„ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾ Tomcatè¿è¡Œæ—¶jspç¿»è¯‘ä¸ºServletçš„æºç ï¼Œå’ŒSessioné’åŒ–çš„ç›®å½•</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421100828862-9181885.png" alt="image-20210421100828862"></p><h2 id="Httpå·¥ä½œåŸç†"><a href="#Httpå·¥ä½œåŸç†" class="headerlink" title="Httpå·¥ä½œåŸç†"></a><strong>Httpå·¥ä½œåŸç†</strong></h2><p>HTTPåè®®æ˜¯æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ é€åè®®ã€‚ä½œä¸ºåº”ç”¨å±‚åè®®ï¼ŒHTTPæ˜¯åŸºäºTCP/IPåè®®æ¥ä¼ é€’æ•° æ®çš„ï¼ˆHTMLæ–‡ä»¶ã€å›¾ç‰‡ã€æŸ¥è¯¢ç»“æœç­‰ï¼‰ï¼ŒHTTPåè®®ä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆPacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯ å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423205515478.png" alt="image-20210423205515478"></p><p><strong>HttpæœåŠ¡å™¨è¯·æ±‚å¤„ç†</strong></p><p>æµè§ˆå™¨å‘ç»™æœåŠ¡ç«¯çš„æ˜¯ä¸€ä¸ªHTTPæ ¼å¼çš„è¯·æ±‚ï¼ŒHTTPæœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œéœ€è¦è°ƒç”¨æœåŠ¡ç«¯ç¨‹åºæ¥å¤„ ç†ï¼Œæ‰€è°“çš„æœåŠ¡ç«¯ç¨‹åºå°±æ˜¯ä½ å†™çš„Javaç±»ï¼Œä¸€èˆ¬æ¥è¯´ä¸åŒçš„è¯·æ±‚éœ€è¦ç”±ä¸åŒçš„Javaç±»æ¥å¤„ç†ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423205608522.png" alt="image-20210423205608522"></p><ul><li>å›¾1 ï¼Œ è¡¨ç¤ºHTTPæœåŠ¡å™¨ç›´æ¥è°ƒç”¨å…·ä½“ä¸šåŠ¡ç±»ï¼Œå®ƒä»¬æ˜¯ç´§è€¦åˆçš„</li><li>å›¾2ï¼ŒHTTPæœåŠ¡å™¨ä¸ç›´æ¥è°ƒç”¨ä¸šåŠ¡ç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚äº¤ç»™å®¹å™¨æ¥å¤„ç†ï¼Œå®¹å™¨é€šè¿‡Servletæ¥å£è°ƒç”¨ä¸šåŠ¡ ç±»ã€‚å› æ­¤Servletæ¥å£å’ŒServletå®¹å™¨çš„å‡ºç°ï¼Œè¾¾åˆ°äº†HTTPæœåŠ¡å™¨ä¸ä¸šåŠ¡ç±»è§£è€¦çš„ç›®çš„ã€‚è€ŒServletæ¥å£å’Œ Servletå®¹å™¨è¿™ä¸€æ•´å¥—è§„èŒƒå«ä½œServletè§„èŒƒã€‚TomcatæŒ‰ç…§Servletè§„èŒƒçš„è¦æ±‚å®ç°äº†Servletå®¹å™¨ï¼ŒåŒæ—¶å®ƒ ä»¬ä¹Ÿå…·æœ‰HTTPæœåŠ¡å™¨çš„åŠŸèƒ½ã€‚ä½œä¸ºJavaç¨‹åºå‘˜ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°æ–°çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªServletï¼Œå¹¶æŠŠå®ƒæ³¨å†Œåˆ°Tomcatï¼ˆServletå®¹å™¨ï¼‰ä¸­ï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±ç”±Tomcatå¸®æˆ‘ä»¬å¤„ç†äº†</li></ul><h2 id="Servletå®¹å™¨å·¥ä½œæµç¨‹"><a href="#Servletå®¹å™¨å·¥ä½œæµç¨‹" class="headerlink" title="Servletå®¹å™¨å·¥ä½œæµç¨‹"></a><strong>Servletå®¹å™¨å·¥ä½œæµç¨‹</strong></h2><p>ä¸ºäº†è§£è€¦ï¼ŒHTTPæœåŠ¡å™¨ä¸ç›´æ¥è°ƒç”¨Servletï¼Œè€Œæ˜¯æŠŠè¯·æ±‚äº¤ç»™Servletå®¹å™¨æ¥å¤„ç†</p><p>å½“å®¢æˆ·è¯·æ±‚æŸä¸ªèµ„æºæ—¶ï¼ŒHTTPæœåŠ¡å™¨ä¼šç”¨ä¸€ä¸ªServletRequestå¯¹è±¡æŠŠå®¢æˆ·çš„è¯·æ±‚ä¿¡æ¯å°è£…èµ·æ¥ï¼Œç„¶å è°ƒç”¨Servletå®¹å™¨çš„serviceæ–¹æ³•ï¼ŒServletå®¹å™¨æ‹¿åˆ°è¯·æ±‚åï¼Œæ ¹æ®è¯·æ±‚çš„URLå’ŒServletçš„æ˜ å°„å…³ç³»ï¼Œæ‰¾åˆ° ç›¸åº”çš„Servletï¼Œå¦‚æœServletè¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œå°±ç”¨åå°„æœºåˆ¶åˆ›å»ºè¿™ä¸ªServletï¼Œå¹¶è°ƒç”¨Servletçš„initæ–¹æ³•æ¥ å®Œæˆåˆå§‹åŒ–ï¼Œæ¥ç€è°ƒç”¨Servletçš„serviceæ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼ŒæŠŠServletResponseå¯¹è±¡è¿”å›ç»™HTTPæœåŠ¡ å™¨ï¼ŒHTTPæœåŠ¡å™¨ä¼šæŠŠå“åº”å‘é€ç»™å®¢æˆ·ç«¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423205747804.png" alt="image-20210423205747804"></p><h2 id="Tomcatæ•´ä½“æ¶æ„"><a href="#Tomcatæ•´ä½“æ¶æ„" class="headerlink" title="Tomcatæ•´ä½“æ¶æ„"></a>Tomcatæ•´ä½“æ¶æ„</h2><p>æˆ‘ä»¬çŸ¥é“å¦‚æœè¦è®¾è®¡ä¸€ä¸ªç³»ç»Ÿï¼Œé¦–å…ˆæ˜¯è¦äº†è§£éœ€æ±‚ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†Tomcatè¦å®ç°ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š</p><p>1ï¼‰ å¤„ç†Socketè¿æ¥ï¼Œè´Ÿè´£ç½‘ç»œå­—èŠ‚æµä¸Requestå’ŒResponseå¯¹è±¡çš„è½¬åŒ–ã€‚ </p><p>2ï¼‰ åŠ è½½å’Œç®¡ç†Servletï¼Œä»¥åŠå…·ä½“å¤„ç†Requestè¯·æ±‚ã€‚</p><p>å› æ­¤Tomcatè®¾è®¡äº†ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶è¿æ¥å™¨ï¼ˆConnectorï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰æ¥åˆ†åˆ«åšè¿™ä¸¤ä»¶äº‹æƒ…ã€‚è¿æ¥å™¨è´Ÿè´£å¯¹å¤–äº¤æµï¼Œå®¹å™¨è´Ÿè´£å†…éƒ¨å¤„ç†</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423205846503.png" alt="image-20210423205846503"></p><h2 id="Tomcat-æœåŠ¡å™¨é…ç½®"><a href="#Tomcat-æœåŠ¡å™¨é…ç½®" class="headerlink" title="Tomcat æœåŠ¡å™¨é…ç½®"></a>Tomcat æœåŠ¡å™¨é…ç½®</h2><p>Tomcat æœåŠ¡å™¨çš„é…ç½®ä¸»è¦é›†ä¸­äº tomcat/conf ä¸‹çš„ catalina.policyã€catalina.propertiesã€ context.xmlã€server.xmlã€tomcat-users.xmlã€web.xml æ–‡ä»¶</p><p><strong>server.xml</strong></p><p>server.xml æ˜¯tomcat æœåŠ¡å™¨çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†Tomcatçš„ Servlet å®¹å™¨ï¼ˆCatalinaï¼‰çš„æ‰€æœ‰é… ç½®ã€‚ç”±äºé…ç½®çš„å±æ€§ç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸»è¦è®²è§£å…¶ä¸­çš„ä¸€éƒ¨åˆ†é‡è¦é…ç½®ã€‚</p><blockquote><p>Server</p></blockquote><p>Serveræ˜¯server.xmlçš„æ ¹å…ƒç´ ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªServerå®ä¾‹ï¼Œé»˜è®¤ä½¿ç”¨çš„å®ç°ç±»æ˜¯ org.apache.catalina.core.StandardServer</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8005&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span>... <span class="hljs-tag">&lt;/<span class="hljs-name">Server</span>&gt;</span></code></pre></div><p>port : Tomcat ç›‘å¬çš„å…³é—­æœåŠ¡å™¨çš„ç«¯å£ </p><p>shutdownï¼š å…³é—­æœåŠ¡å™¨çš„æŒ‡ä»¤å­—ç¬¦ä¸²</p><blockquote><p>Connector</p></blockquote><p>Connector ç”¨äºåˆ›å»ºé“¾æ¥å™¨å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œserver.xml é…ç½®äº†ä¸¤ä¸ªé“¾æ¥å™¨ï¼Œä¸€ä¸ªæ”¯æŒHTTPåè®®ï¼Œ ä¸€ä¸ªæ”¯æŒAJPåè®®ã€‚å› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ–°å¢é“¾æ¥å™¨é…ç½®ï¼Œåªæ˜¯æ ¹æ®éœ€è¦å¯¹å·²æœ‰é“¾æ¥å™¨è¿› è¡Œä¼˜åŒ–ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8080&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span> <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span></span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span></code></pre></div><p>å±æ€§è¯´æ˜ï¼š</p><p>1ï¼‰portï¼šç«¯å£å·ï¼ŒConnectorç”¨äºåˆ›å»ºæœåŠ¡ç«¯Socketå¹¶è¿›è¡Œç›‘å¬ï¼Œä»¥ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚é“¾æ¥ã€‚å¦‚æœè¯¥å±æ€§è®¾ç½®ä¸º0ï¼ŒTomcatå°†ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç«¯å£å·ç»™å½“å‰Connectorä½¿ç”¨</p><p>2ï¼‰ protocol ï¼š å½“å‰Connector æ”¯æŒçš„è®¿é—®åè®®ã€‚ é»˜è®¤ä¸º HTTP/1.1 ã€‚</p><p> 3ï¼‰ connectionTimeOut : Connector æ¥æ”¶é“¾æ¥åçš„ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œ å•ä½ä¸ºæ¯«ç§’ã€‚ -1 è¡¨ç¤ºä¸è¶…æ—¶</p><p> 4ï¼‰ URIEncoding : ç”¨äºæŒ‡å®šç¼–ç URIçš„å­—ç¬¦ç¼–ç ï¼Œ Tomcat8.xç‰ˆæœ¬é»˜è®¤çš„ç¼–ç ä¸º UTF-8 ã€‚ </p><p>å®Œæ•´çš„é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8080&quot;</span></span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span> <span class="hljs-attr">executor</span>=<span class="hljs-string">&quot;tomcatThreadPool&quot;</span> <span class="hljs-attr">maxThreads</span>=<span class="hljs-string">&quot;1000&quot;</span></span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">minSpareThreads</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">acceptCount</span>=<span class="hljs-string">&quot;1000&quot;</span></span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">maxConnections</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span> <span class="hljs-attr">compression</span>=<span class="hljs-string">&quot;on&quot;</span> <span class="hljs-attr">compressionMinSize</span>=<span class="hljs-string">&quot;2048&quot;</span> <span class="hljs-attr">disableUploadTimeout</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span></span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">URIEncoding</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span></code></pre></div><h2 id="Tomcaté…ç½®è´Ÿè½½å‡è¡¡"><a href="#Tomcaté…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="Tomcaté…ç½®è´Ÿè½½å‡è¡¡"></a>Tomcaté…ç½®è´Ÿè½½å‡è¡¡</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/16.%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4.jpg" alt="16.è´Ÿè½½å‡è¡¡é›†ç¾¤"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 0.å‡†å¤‡å¤šä¸ªtomcat</span><span class="hljs-code"> tar -zxvf apache-tomcat-8.5.46.tar.gz #è§£å‹ç¼©ä¸€ä¸ªæ–°çš„tomcatå®‰è£…åŒ…</span><span class="hljs-code"> mv apache-tomcat-8.5.46 tomcat1  #å°†åç§°æ”¹ä¸ºtomcat1</span><span class="hljs-code"> cp -r tomcat1/ tomcat2 #å¤åˆ¶ä¸€ä»½</span><span class="hljs-code"> cp -r tomcat1/ tomcat3                #å¤åˆ¶ä¸€ä»½</span><span class="hljs-code"></span><span class="hljs-code"># 1.æ­¤æ—¶å½“å‰ç›®å½•ä¸­æœ‰ä¸‰ä¸ªæœåŠ¡å™¨,å¦‚ä¸‹:</span><span class="hljs-code">[root@localhost ~]# ls -l</span><span class="hljs-code">æ€»ç”¨é‡ 12248</span><span class="hljs-code">-rwxrwxrwx. 1 root root  11623939 10æœˆ 13 12:25 apache-tomcat-8.5.46.tar.gz</span><span class="hljs-code">drwxr-xr-x. 9 root root       220 10æœˆ 14 21:28 tomcat1</span><span class="hljs-code">drwxr-xr-x. 9 root root       220 10æœˆ 14 21:38 tomcat2</span><span class="hljs-code">drwxr-xr-x. 9 root root       220 10æœˆ 14 21:38 tomcat3</span></code></pre></div><p><strong>é…ç½®ä¸‰ä¸ªtomcatçš„ç«¯å£å·</strong></p><p>åˆ†åˆ«ä¿®æ”¹ç«¯å£ï¼Œhttpåè®®ç«¯å£ï¼ŒAJPåè®®ç«¯å£</p><div class="hljs code-wrapper"><pre><code class="hljs xml"># 2.ä¿®æ”¹tomcat1ç«¯å£å·:(ä¼ªåˆ†å¸ƒå¼)vim tomcat1/conf/server.xml,å‘½ä»¤ä¿®æ”¹å¦‚ä¸‹å†…å®¹:a.<span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8001&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span>   ---å…³é—­ç«¯å£b.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8888&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span> <span class="hljs-attr">---http</span>åè®®ç«¯å£</span><span class="hljs-tag">               <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span>c.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;10010&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;AJP/1.3&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span> ---AJPåè®®ç«¯å£</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"># 3.ä¿®æ”¹tomcat2ç«¯å£å·:(ä¼ªåˆ†å¸ƒå¼)vim tomcat2/conf/server.xml,å‘½ä»¤ä¿®æ”¹å¦‚ä¸‹å†…å®¹:  a.<span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8002&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span>b.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8889&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span>   c.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;10011&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;AJP/1.3&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"># 4.ä¿®æ”¹tomcat3ç«¯å£å·:(ä¼ªåˆ†å¸ƒå¼)vim tomcat2/conf/server.xml,å‘½ä»¤ä¿®æ”¹å¦‚ä¸‹å†…å®¹:  a.<span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8003&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span>b.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8890&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span>   c.<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;10012&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;AJP/1.3&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 5.å°†å¤šä¸ªtomcatå¯åŠ¨:</span><span class="hljs-code">tomcat1/bin/startup.sh </span><span class="hljs-code">tomcat2/bin/startup.sh </span><span class="hljs-code">tomcat3/bin/startup.sh</span><span class="hljs-code">    </span><span class="hljs-code"># 6.æŸ¥çœ‹tomcatæ˜¯å¦å¯åŠ¨æˆåŠŸ</span><span class="hljs-code">ps -aux|grep tomcat</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191014215035543.png" alt="image-20191014215035543"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 7.åœ¨windowsä¸­åˆ†åˆ«è®¿é—®tomcat,éƒ½çœ‹åˆ°ä¸»é¡µä»£è¡¨å¯åŠ¨æˆåŠŸ:</span><span class="hljs-code"></span><span class="hljs-code">http://10.15.0.8:8888/</span><span class="hljs-code">http://10.15.0.8:8889/</span><span class="hljs-code">http://10.15.0.8:8890/</span><span class="hljs-code"></span><span class="hljs-code">æ³¨æ„:è¿™æ­¥ä¸€å®šè¦å…³é—­ç½‘è·¯é˜²ç«å¢™</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 8.å°†å¤šä¸ªtomcaté…ç½®åˆ°nginxçš„é…ç½®æ–‡ä»¶ä¸­:</span><span class="hljs-code">vim /conf/nginx.conf</span><span class="hljs-code"></span><span class="hljs-code">## åœ¨serveræ ‡ç­¾ä¸ŠåŠ å…¥å¦‚ä¸‹é…ç½®:</span><span class="hljs-code">    upstream tomcat-servers &#123;</span><span class="hljs-code">      server 10.15.0.8:8888;</span><span class="hljs-code">      server 10.15.0.8:8889;</span><span class="hljs-code">      server 10.15.0.8:8890;</span><span class="hljs-code">    &#125;</span><span class="hljs-code">## å°†é…ç½®æ–‡ä»¶ä¸­ location /æ›¿æ¢ä¸ºå¦‚ä¸‹é…ç½®:</span><span class="hljs-code">location / &#123;</span><span class="hljs-code"> proxy_pass http://tomcat-servers;</span><span class="hljs-code"> proxy_redirect    off;</span><span class="hljs-code"> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><span class="hljs-code"> proxy_set_header X-Real-IP $remote_addr;</span><span class="hljs-code"> proxy_set_header Host $http_host;</span><span class="hljs-code"> proxy_next_upstream http_502 http_504 error timeout invalid_header;</span><span class="hljs-code">   &#125;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191014215825240.png" alt="image-20191014215825240"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 9.è¿›å…¥nginxå®‰è£…ç›®å½•sbinç›®å½•åŠ è½½é…ç½®æ–‡ä»¶çš„å½¢å¼å¯åŠ¨nginx</span><span class="hljs-code">./nginx -c /usr/nginx/conf/nginx.conf</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 10.è®¿é—®nginx,çœ‹åˆ°å…¶ä¸­ä¸€ä¸ªtomcatç”»é¢:</span><span class="hljs-code">http://10.15.0.8/ </span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191014220145379.png" alt="image-20191014220145379"></p><p><strong>Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥</strong></p><blockquote><p>é»˜è®¤ç­–ç•¥ï¼šæ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># ä»¥ä¸‹é…ç½®éƒ½åœ¨vim /conf/nginx.confä¸­</span><span class="hljs-section"># weight æƒé‡</span><span class="hljs-code">è¯´æ˜: weightå‚æ•°ç”¨äºæŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightçš„é»˜è®¤å€¼ä¸º1,ï¼›weightçš„æ•°å€¼ä¸è®¿é—®æ¯”ç‡æˆæ­£æ¯” </span><span class="hljs-code">    upstream tomcat-servers &#123;</span><span class="hljs-code">        server localhost:8888   weight=2;  </span><span class="hljs-code">        server localhost:8889;  </span><span class="hljs-code">        server localhost:8890   backup;  </span><span class="hljs-code">    &#125;</span><span class="hljs-code">æ³¨æ„ï¼š1.æƒé‡è¶Šé«˜åˆ†é…åˆ°éœ€è¦å¤„ç†çš„è¯·æ±‚è¶Šå¤šã€‚2.æ­¤ç­–ç•¥å¯ä»¥ä¸least_connå’Œip_hashç»“åˆä½¿ç”¨ä¸»è¦ç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡</span><span class="hljs-code"></span><span class="hljs-code"># ip_hash </span><span class="hljs-code">ã€€è¯´æ˜:æŒ‡å®šè´Ÿè½½å‡è¡¡å™¨æŒ‰ç…§åŸºäºå®¢æˆ·ç«¯IPçš„åˆ†é…æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†ç›¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ç›´å‘é€åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¿è¯sessionä¼šè¯ã€‚è¿™æ ·æ¯ä¸ªè®¿å®¢éƒ½å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸èƒ½è·¨æœåŠ¡å™¨çš„é—®é¢˜ã€‚</span><span class="hljs-code">ã€€upstream tomcat-servers &#123;</span><span class="hljs-code">        ip_hash;    #ä¿è¯æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨</span><span class="hljs-code">        ......</span><span class="hljs-code">    &#125;</span><span class="hljs-code"># least_conn</span><span class="hljs-code">è¯´æ˜: æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast_connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</span><span class="hljs-code">upstream tomcat-servers&#123;</span><span class="hljs-code">        least_conn;    #æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨</span><span class="hljs-code">    &#125;</span></code></pre></div><h2 id="Sessionå…±äº«"><a href="#Sessionå…±äº«" class="headerlink" title="Sessionå…±äº«"></a><strong>Sessionå…±äº«</strong></h2><p><strong>Memcached Session Manager</strong></p><blockquote><p>Memcached Session ManageråŸºäºmemcacheç¼“å­˜çš„sessionå…±äº«.å³ä½¿ç”¨cacheDBå­˜å–sessionä¿¡æ¯ï¼Œåº”ç”¨æœåŠ¡å™¨æ¥å—æ–°è¯·æ±‚å°†sessionä¿¡æ¯ä¿å­˜åœ¨cache DBä¸­ï¼Œå½“åº”ç”¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œè°ƒåº¦å™¨ä¼šéå†å¯»æ‰¾å¯ç”¨èŠ‚ç‚¹ï¼Œåˆ†å‘è¯·æ±‚ï¼Œå½“åº”ç”¨æœåŠ¡å™¨å‘ç°sessionä¸åœ¨æœ¬æœºå†…å­˜æ—¶ï¼Œåˆ™å»cacheDBä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™å¤åˆ¶åˆ°æœ¬æœºï¼Œè¿™æ ·å®ç°sessionå…±äº«å’Œé«˜å¯ç”¨ã€‚</p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å®‰è£…memcached</span>yum install -y memcached<span class="hljs-section"># 2.å¯åŠ¨memcachedï¼ˆport:11211ï¼‰</span>memcached -p 11211 -vvv -u root<span class="hljs-section"># 3.tomcatå®‰è£…çš„libç›®å½•ä¸­æ”¾å…¥ä¸memcacheæ•´åˆjaråŒ…</span><span class="hljs-code">cp *.jar tomcat1/lib</span><span class="hljs-code">cp *.jar tomcat2/lib</span><span class="hljs-code">cp *.jar tomcat3/lib</span><span class="hljs-code"></span><span class="hljs-code"># 4.é…ç½®tomcatç›®å½•ä¸­confç›®å½•ä¸­context.xml(æ‰€æœ‰tomcatå‡éœ€è¦é…ç½®)</span><span class="hljs-code">&lt;Context&gt;</span><span class="hljs-code"> &lt;Manager className=&quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&quot;</span><span class="hljs-code">        memcachedNodes=&quot;n1:10.15.0.8:11211,n2:....&quot; --å¯¹åº”name:msmçš„ip:portï¼Œå¯ä»¥åŠ å¤šå°åšåˆ†å¸ƒå¼</span><span class="hljs-code">        sticky=&quot;false&quot;  </span><span class="hljs-code">    sessionBackupAsync=&quot;false&quot;  </span><span class="hljs-code">        requestUriIgnorePattern=&quot;.*\.(ico|png|gif|jpg|css|js)$&quot;        transcoderFactoryClass=&quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&quot;</span><span class="hljs-code">        /&gt;</span><span class="hljs-code">&lt;/Context&gt;</span><span class="hljs-code"></span><span class="hljs-code"># 5.ç„¶åå¯åŠ¨tomcatå’Œnginxå¹¶æ”¾å…¥æµ‹è¯•é¡¹ç›®è¿›è¡Œæµ‹è¯•</span></code></pre></div><p><strong>Redis</strong></p><blockquote><p>åŒæ ·åˆ©ç”¨tomcatä¸nginxæ­å»ºï¼Œä½†æ˜¯åˆ©ç”¨Redisé›†ç¾¤è¿›è¡Œç®¡ç†ï¼Œredisçš„sessionç®¡ç†æ˜¯åˆ©ç”¨springæä¾›çš„sessionç®¡ç†è§£å†³æ–¹æ¡ˆ,å°†ä¸€ä¸ªåº”ç”¨sessionäº¤ç»™Rediså­˜å‚¨,æ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰sessionçš„è¯·æ±‚éƒ½ä¼šå»redisä¸­è·å–å¯¹åº”çš„sessionæ•°æ®</p></blockquote><h1 id="äº”ã€Nginx"><a href="#äº”ã€Nginx" class="headerlink" title="äº”ã€Nginx"></a>äº”ã€Nginx</h1><p><code>Nginx</code> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ <code>HTTP</code> å’Œåå‘ä»£ç† <code>web</code> æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† <code>IMAP/POP3/SMTP</code> æœåŠ¡ã€‚</p><p><code>Nginx</code> æ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„ <code>Rambler.ru</code> ç«™ç‚¹å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬ <code>0.1.0</code> å‘å¸ƒäº <code>2004</code>å¹´ <code>10</code> æœˆ <code>4</code> æ—¥ã€‚</p><p><code>Nginx</code> ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºã€‚</p><p>äº‹å®ä¸Š <code>nginx</code> çš„å¹¶å‘èƒ½åŠ›ç¡®å®åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥äº† <code>Nginx</code> ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ¶æ„å¯èƒ½æ˜¯è¿™æ ·ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/15-1.png" alt="img"></p><p>åœ¨è¿™æ ·çš„æ¶æ„ä¸­ ï¼Œ <code>Nginx</code> æ‰€ä»£è¡¨çš„è§’è‰²å«åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æˆ–è€…åå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ‰€æœ‰è¯·æ±‚é¦–å…ˆåˆ°è¾¾ <code>Nginx</code> ä¸Šï¼Œå†ç”± <code>Nginx</code> æ ¹æ®æå‰é…ç½®å¥½çš„è½¬å‘è§„åˆ™ï¼Œå°†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚è½¬å‘åˆ°æŸä¸€ä¸ª <code>Tomcat</code> ä¸Šå»ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>è´Ÿè½½å‡è¡¡æœåŠ¡å™¨</li></ul><p>å°±æ˜¯è¿›è¡Œè¯·æ±‚è½¬å‘ï¼Œé™ä½æŸä¸€ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚è´Ÿè½½å‡è¡¡ç­–ç•¥å¾ˆå¤šï¼Œä¹Ÿæœ‰å¾ˆå¤šå±‚ï¼Œå¯¹äºä¸€äº›å¤§å‹ç½‘ç«™åŸºæœ¬ä¸Šä» <code>DNS</code>å°±å¼€å§‹è´Ÿè½½å‡è¡¡ï¼Œè´Ÿè½½å‡è¡¡æœ‰ç¡¬ä»¶å’Œè½¯ä»¶ä¹‹åˆ†ï¼Œå„è‡ªä»£è¡¨åˆ†åˆ«æ˜¯ <code>F5</code> å’Œ <code>Nginx</code> ï¼ˆç›®å‰ <code>Nginx</code> å·²ç»è¢« <code>F5</code> æ”¶è´­ï¼‰ï¼Œæ—©äº›å¹´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Apache</code> æ¥åšè´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯æ•ˆç‡ä¸å¦‚ <code>Nginx</code> ï¼Œæ‰€ä»¥ç°åœ¨ä¸»æµæ–¹æ¡ˆæ˜¯ <code>Nginx</code> ã€‚</p><ul><li>åå‘ä»£ç†æœåŠ¡å™¨ï¼š</li></ul><p>å¦ä¸€ä¸ªæ¦‚å¿µæ˜¯åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¾—å…ˆè¯´æ­£å‘ä»£ç†ï¼Œçœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/15-2.png" alt="img"></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒGoogle å¹¶ä¸çŸ¥é“çœŸæ­£è®¿é—®å®ƒçš„å®¢æˆ·ç«¯æ˜¯è°ï¼Œå®ƒåªçŸ¥é“è¿™ä¸ªä¸­é—´æœåŠ¡å™¨åœ¨è®¿é—®å®ƒã€‚å› æ­¤ï¼Œè¿™é‡Œçš„ä»£ç†ï¼Œå®é™…ä¸Šæ˜¯ä¸­é—´æœåŠ¡å™¨ä»£ç†äº†å®¢æˆ·ç«¯ï¼Œè¿™ç§ä»£ç†å«åšæ­£å‘ä»£ç†ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯åå‘ä»£ç†å‘¢ï¼Ÿçœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/15-3.png" alt="img"></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ10086 è¿™ä¸ªå·ç ç›¸å½“äºæ˜¯ä¸€ä¸ªä»£ç†ï¼ŒçœŸæ­£æä¾›æœåŠ¡çš„ï¼Œæ˜¯è¯åŠ¡å‘˜ï¼Œä½†æ˜¯å¯¹äºå®¢æˆ·æ¥è¯´ï¼Œä»–ä¸å…³å¿ƒåˆ°åº•æ˜¯å“ªä¸€ä¸ªè¯åŠ¡å‘˜æä¾›çš„æœåŠ¡ï¼Œä»–åªéœ€è¦è®°å¾— 10086 è¿™ä¸ªå·ç å°±è¡Œäº†ã€‚</p><p>æ‰€æœ‰çš„è¯·æ±‚æ‰“åˆ° 10086 ä¸Šï¼Œå†ç”± 10086 å°†è¯·æ±‚è½¬å‘ç»™æŸä¸€ä¸ªè¯åŠ¡å‘˜å»å¤„ç†ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œï¼Œ10086 å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªä»£ç†ï¼Œåªä¸è¿‡å®ƒä»£ç†çš„æ˜¯è¯åŠ¡å‘˜è€Œä¸æ˜¯å®¢æˆ·ç«¯ï¼Œè¿™ç§ä»£ç†ç§°ä¹‹ä¸ºåå‘ä»£ç†ã€‚</p><h2 id="Nginx-çš„ä¼˜åŠ¿"><a href="#Nginx-çš„ä¼˜åŠ¿" class="headerlink" title="Nginx çš„ä¼˜åŠ¿"></a>Nginx çš„ä¼˜åŠ¿</h2><p>åœ¨ Java å¼€å‘ä¸­ï¼ŒNginx æœ‰ç€éå¸¸å¹¿æ³›çš„ä½¿ç”¨ï¼Œéšä¾¿ä¸¾å‡ ç‚¹ï¼š</p><ul><li>ä½¿ç”¨ Nginx åšé™æ€èµ„æºæœåŠ¡å™¨ï¼šJava ä¸­çš„èµ„æºå¯ä»¥åˆ†ä¸ºåŠ¨æ€å’Œé™æ€ï¼ŒåŠ¨æ€éœ€è¦ç»è¿‡ Tomcat è§£æä¹‹åï¼Œæ‰èƒ½è¿”å›ç»™æµè§ˆå™¨ï¼Œä¾‹å¦‚ JSP é¡µé¢ã€Freemarker é¡µé¢ã€æ§åˆ¶å™¨è¿”å›çš„ JSON æ•°æ®ç­‰ï¼Œéƒ½ç®—ä½œåŠ¨æ€èµ„æºï¼ŒåŠ¨æ€èµ„æºç»è¿‡äº† Tomcat å¤„ç†ï¼Œé€Ÿåº¦å¿…ç„¶é™ä½ã€‚å¯¹äºé™æ€èµ„æºï¼Œä¾‹å¦‚å›¾ç‰‡ã€HTMLã€JSã€CSS ç­‰èµ„æºï¼Œè¿™ç§èµ„æºå¯ä»¥ä¸å¿…ç»è¿‡ Tomcat è§£æï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼Œä¹‹é—´å°†èµ„æºè¿”å›ç»™å®¢æˆ·ç«¯å°±è¡Œäº†ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Nginx æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œå°†é™æ€èµ„æºç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>ä½¿ç”¨ Nginx åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Dubbo è¿˜æ˜¯ Spirng Cloud ï¼Œé™¤äº†ä½¿ç”¨å„è‡ªè‡ªå¸¦çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¹‹å¤–ï¼Œä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨ Nginx åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</li><li>æ”¯æŒé«˜å¹¶å‘ã€å†…å­˜æ¶ˆè€—å°‘ã€æˆæœ¬ä½å»‰ã€é…ç½®ç®€å•ã€è¿è¡Œç¨³å®šç­‰ã€‚</li></ul><h1 id="å…­ã€Servlet"><a href="#å…­ã€Servlet" class="headerlink" title="å…­ã€Servlet"></a>å…­ã€Servlet</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a><strong>ç®€ä»‹</strong></h2><ul><li>Servlet æ˜¯ JavaEE è§„èŒƒä¹‹ä¸€ã€‚è§„èŒƒå°±æ˜¯æ¥å£</li><li>Servlet å°± JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€ã€‚ä¸‰å¤§ç»„ä»¶åˆ†åˆ«æ˜¯ï¼šServlet ç¨‹åºã€Filter è¿‡æ»¤å™¨ã€Listener ç›‘å¬å™¨</li><li>Servlet æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ª java å°ç¨‹åºï¼Œå®ƒå¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå¹¶å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯</li></ul><p><strong>åŠŸèƒ½</strong></p><ul><li>æ¥å—è¯·æ±‚</li><li>å¤„ç†è¯·æ±‚</li><li>å®Œæˆç›¸åº”</li></ul><h2 id="ServletåŠ è½½æ—¶æœº"><a href="#ServletåŠ è½½æ—¶æœº" class="headerlink" title="ServletåŠ è½½æ—¶æœº"></a>ServletåŠ è½½æ—¶æœº</h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Webå®¢æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚è®¿é—®æŸä¸ªServletæ—¶ï¼ŒWebå®¹å™¨ä¼šåˆ›å»ºè¿™ä¸ªServletçš„å®ä¾‹ã€‚</p><p>å½“è®¾ç½®äº†web.xmlä¸­çš„å­å…ƒç´ åï¼ŒServletå®¹å™¨åœ¨å¯åŠ¨Webåº”ç”¨æ—¶ï¼Œå°†æŒ‰ç…§æŒ‡å®šé¡ºåºåˆ›å»ºå¹¶åˆå§‹åŒ–è¿™ä¸ª Servletã€‚è®¾ç½®çš„æ•°å€¼å¤§äº0å³å¯ã€‚ä¾‹å¦‚ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.langsin.servlet.HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span></code></pre></div><h2 id="Servletçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Servletçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Servletçš„ç”Ÿå‘½å‘¨æœŸ"></a>Servletçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>å…ˆçœ‹ä¸Servletç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„ä¸‰ä¸ªæ–¹æ³•ï¼šinit(), service(), destroy(). Servletç”Ÿå‘½å‘¨æœŸå¯è¢«å®šä¹‰ä¸ºä»åˆ›å»º ç›´åˆ°æ¯ç­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«å¯¹åº”çš„Servletè¿‡ç¨‹ï¼š</p><ul><li>æ‰§è¡Œ Servlet æ„é€ å™¨æ–¹æ³•</li><li>æ‰§è¡Œ init åˆå§‹åŒ–æ–¹æ³•<ul><li>ç¬¬ä¸€ã€äºŒæ­¥ï¼Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™åˆ›å»º Servlet ç¨‹åºä¼šè°ƒç”¨</li></ul></li><li>æ‰§è¡Œ service æ–¹æ³•<ul><li>ç¬¬ä¸‰æ­¥ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šè°ƒç”¨</li></ul></li><li>æ‰§è¡Œ destroy é”€æ¯æ–¹æ³•<ul><li>ç¬¬å››æ­¥ï¼Œåœ¨ web å·¥ç¨‹åœæ­¢çš„æ—¶å€™è°ƒç”¨</li></ul></li></ul><h2 id="æ‰‹åŠ¨å®ç°-Servlet-ç¨‹åº"><a href="#æ‰‹åŠ¨å®ç°-Servlet-ç¨‹åº" class="headerlink" title="æ‰‹åŠ¨å®ç° Servlet ç¨‹åº"></a>æ‰‹åŠ¨å®ç° Servlet ç¨‹åº</h2><ul><li>ç¼–å†™ä¸€ä¸ªç±»å»å®ç° Servlet æ¥å£</li><li>å®ç° service æ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶å“åº”æ•°æ®</li><li>åˆ° web.xml ä¸­å»é…ç½® servlet ç¨‹åºçš„è®¿é—®åœ°å€<ul><li>æµè§ˆå™¨ä¸èƒ½ç›´æ¥è®¿é—® Servlet â½‚ä»¶ï¼Œåªèƒ½é€šè¿‡æ˜ å°„çš„â½…å¼æ¥é—´æ¥è®¿é—® Servletï¼Œæ˜ å°„éœ€è¦å¼€å‘è€…â¼¿åŠ¨é…ç½®ï¼Œæœ‰ä¸¤ç§é…ç½®â½…å¼</li></ul></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServlet</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Servlet</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * service æ–¹æ³•æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†è¯·æ±‚å’Œå“åº”çš„</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> servletRequest</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> servletResponse</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="hljs-keyword">throws</span></span><span class="hljs-function">        ServletException, IOException </span>&#123;        System.out.println(<span class="hljs-string">&quot;Hello Servlet è¢«è®¿é—®äº†&quot;</span>);        &#125;&#125;</code></pre></div><p><strong>åŸºäº XML â½‚ä»¶çš„é…ç½®â½…å¼:</strong></p><p><code>Web.xml</code></p><div class="hljs code-wrapper"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>    <span class="hljs-comment">&lt;!--å…¨ç±»å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.southwind.servlet.HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-comment">&lt;!--  mappingæ ‡ç­¾ç»™servletç¨‹åºé…ç½®è®¿é—®åœ°å€--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><span class="hljs-comment">&lt;!--    å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘å½“å‰é…ç½®çš„åœ°å€ç»™é‚£ä¸ªservletç¨‹åºä½¿ç”¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><span class="hljs-comment">&lt;!--    è®¿é—®åœ°å€--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/demo2<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></code></pre></div><p><strong>åŸºäºæ³¨è§£çš„â½…å¼</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/demo2&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServlet</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Servlet</span> </span>&#123; &#125;</code></pre></div><p><strong>url åœ°å€åˆ° Servlet ç¨‹åºçš„è®¿é—®</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423170521391.png" alt="image-20210423170521391"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210423170614051.png" alt="image-20210423170614051"></p><p><strong>é€šè¿‡ç»§æ‰¿ HttpServlet å®ç° Servlet ç¨‹åº</strong></p><p>ä¸€èˆ¬åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨ç»§æ‰¿ HttpServlet ç±»çš„æ–¹å¼å»å®ç° Servlet ç¨‹åºã€‚ </p><ul><li>ç¼–å†™ä¸€ä¸ªç±»å»ç»§æ‰¿ HttpServlet ç±» </li><li>æ ¹æ®ä¸šåŠ¡éœ€è¦é‡å†™ doGet æˆ– doPost æ–¹æ³• </li><li>åˆ° web.xml ä¸­çš„é…ç½® Servlet ç¨‹åºçš„è®¿é—®åœ°å€</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServlet2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * doGetï¼ˆï¼‰åœ¨ get è¯·æ±‚çš„æ—¶å€™è°ƒç”¨</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;    System.out.println(<span class="hljs-string">&quot;HelloServlet2 çš„ doGet æ–¹æ³•&quot;</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * doPostï¼ˆï¼‰åœ¨ post è¯·æ±‚çš„æ—¶å€™è°ƒç”¨</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;    System.out.println(<span class="hljs-string">&quot;HelloServlet2 çš„ doPost æ–¹æ³•&quot;</span>);    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloServlet2<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atguigu.servlet.HelloServlet2<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloServlet2<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello2<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></code></pre></div><p><strong>Servlet ç±»çš„ç»§æ‰¿ä½“ç³»</strong></p><p><code>Servlet ---&gt; GenericServlet ---ã€‰HttpServlet</code></p><p>HTTP è¯·æ±‚æœ‰å¾ˆå¤šç§ç±»å‹ï¼Œå¸¸â½¤çš„æœ‰å››ç§ï¼š </p><ul><li><p>GET è¯»å– </p></li><li><p>POST ä¿å­˜ </p></li><li><p>PUT ä¿®æ”¹</p></li><li><p>DELETE åˆ é™¤</p></li></ul><p>GenericServlet å®ç° Servlet æ¥â¼ï¼ŒåŒæ—¶ä¸ºå®ƒçš„â¼¦ç±»å±è”½äº†ä¸å¸¸â½¤çš„â½…æ³•ï¼Œâ¼¦ç±»åªéœ€è¦é‡å†™ serviceâ½…æ³•å³å¯ã€‚</p><p>HttpServlet ç»§æ‰¿ GenericServletï¼Œæ ¹æ®è¯·æ±‚ç±»å‹è¿›â¾åˆ†å‘å¤„ç†ï¼ŒGET è¿›â¼Š doGET â½…æ³•ï¼ŒPOST è¿›â¼Š doPOST â½…æ³•ã€‚ å¼€å‘è€…â¾ƒå®šä¹‰çš„ Servlet ç±»åªéœ€è¦ç»§æ‰¿ HttpServlet å³å¯ï¼Œé‡æ–° doGET å’Œ doPOSTã€‚</p><h2 id="ServletConfig"><a href="#ServletConfig" class="headerlink" title="ServletConfig"></a>ServletConfig</h2><ul><li>ServletConfigç±»ä»ç±»åä¸Šæ¥çœ‹ï¼Œå°±çŸ¥é“æ˜¯Servletç¨‹åºçš„é…ç½®ä¿¡æ¯ç±»</li><li>Servlet ç¨‹åºå’Œ ServletConfig å¯¹è±¡éƒ½æ˜¯ç”±Tomcatè´Ÿè´£åˆ›å»ºï¼Œæˆ‘ä»¬è´Ÿè´£ä½¿ç”¨</li><li>Servlet ç¨‹åºé»˜è®¤æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™åˆ›å»ºï¼ŒServletConfigæ˜¯æ¯ä¸ªServlet ç¨‹åºåˆ›å»ºæ—¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletConfigå¯¹è±¡</li></ul><p><strong>ServletConfig ç±»çš„ä¸‰å¤§ä½œç”¨</strong></p><p>1ã€å¯ä»¥è·å– Servlet ç¨‹åºçš„åˆ«å servlet-name çš„å€¼<br>2ã€è·å–Servlet åˆå§‹åŒ–å‚æ•° init-param<br>3ã€è·å– ServletContext å¯¹è±¡</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- servlet æ ‡ç­¾ç»™ Tomcat é…ç½® Servlet ç¨‹åº --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-comment">&lt;!--servlet-name æ ‡ç­¾ Servlet ç¨‹åºèµ·ä¸€ä¸ªåˆ«åï¼ˆä¸€èˆ¬æ˜¯ç±»åï¼‰ --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><span class="hljs-comment">&lt;!--servlet-class æ˜¯ Servlet ç¨‹åºçš„å…¨ç±»å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.atguigu.servlet.HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>    <span class="hljs-comment">&lt;!--init-param æ˜¯åˆå§‹åŒ–å‚æ•°--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-comment">&lt;!--æ˜¯å‚æ•°å--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>username<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-comment">&lt;!--æ˜¯å‚æ•°å€¼--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-comment">&lt;!--init-param æ˜¯åˆå§‹åŒ–å‚æ•°--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-comment">&lt;!--æ˜¯å‚æ•°å--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>url<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-comment">&lt;!--æ˜¯å‚æ•°å€¼--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>jdbc:mysql://localhost:3306/test<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>    <span class="hljs-comment">&lt;!--servlet-mapping æ ‡ç­¾ç»™ servlet ç¨‹åºé…ç½®è®¿é—®åœ°å€--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>        <span class="hljs-comment">&lt;!--servlet-name æ ‡ç­¾çš„ä½œç”¨æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘å½“å‰é…ç½®çš„åœ°å€ç»™å“ªä¸ª Servlet ç¨‹åºä½¿ç”¨--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-comment">&lt;!--</span><span class="hljs-comment">        url-pattern æ ‡ç­¾é…ç½®è®¿é—®åœ°å€ &lt;br/&gt;</span><span class="hljs-comment">        / æ–œæ åœ¨æœåŠ¡å™¨è§£æçš„æ—¶å€™ï¼Œè¡¨ç¤ºåœ°å€ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„ &lt;br/&gt;</span><span class="hljs-comment">        /hello è¡¨ç¤ºåœ°å€ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/hello &lt;br/&gt;</span><span class="hljs-comment">        --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/hello<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span></code></pre></div><p><strong>ServletConfig å„ä¸ªæ–¹æ³•</strong></p><p><code>getServletName()</code> è¿”å› Servletçš„åˆ«å<br><code>getInitParameter(String key)</code> è·å–initå‚æ•°çš„å€¼ï¼ˆweb.xmlï¼‰<br><code>getInitParameterNames()</code> è¿”å›æ‰€æœ‰çš„ initParamterçš„nameå€¼ï¼Œâ¼€èˆ¬â½¤ä½œéå†åˆå§‹åŒ–å‚æ•°<br><code>getServletContext()</code> è¿”å› ServletContext å¯¹è±¡ï¼Œå®ƒæ˜¯ Servlet çš„ä¸Šä¸‹â½‚ï¼Œæ•´ä¸ª Servlet çš„ç®¡ç†è€…</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig servletConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;    System.out.println(<span class="hljs-string">&quot;2 init åˆå§‹åŒ–æ–¹æ³•&quot;</span>);    <span class="hljs-comment">// 1ã€å¯ä»¥è·å– Servlet ç¨‹åºçš„åˆ«å servlet-name çš„å€¼</span>    System.out.println(<span class="hljs-string">&quot;HelloServlet ç¨‹åºçš„åˆ«åæ˜¯:&quot;</span> + servletConfig.getServletName());    <span class="hljs-comment">// 2ã€è·å–åˆå§‹åŒ–å‚æ•° init-param</span>    System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–å‚æ•° username çš„å€¼æ˜¯;&quot;</span> + servletConfig.getInitParameter(<span class="hljs-string">&quot;username&quot;</span>));    System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–å‚æ•° url çš„å€¼æ˜¯;&quot;</span> + servletConfig.getInitParameter(<span class="hljs-string">&quot;url&quot;</span>));    <span class="hljs-comment">// 3ã€è·å– ServletContext å¯¹è±¡</span>    System.out.println(servletConfig.getServletContext());&#125;</code></pre></div><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><p><strong>ä»€ä¹ˆæ˜¯ ServletContext?</strong></p><p>1ã€ServletContext æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¡¨ç¤º Servlet ä¸Šä¸‹æ–‡å¯¹è±¡<br>2ã€ä¸€ä¸ª web å·¥ç¨‹ï¼Œåªæœ‰ä¸€ä¸ª ServletContext å¯¹è±¡å®ä¾‹<br>3ã€ServletContext å¯¹è±¡æ˜¯ä¸€ä¸ªåŸŸå¯¹è±¡<br>4ã€ServletContext æ˜¯åœ¨ web å·¥ç¨‹éƒ¨ç½²å¯åŠ¨çš„æ—¶å€™åˆ›å»ºï¼Œ<strong>åœ¨ web å·¥ç¨‹åœæ­¢çš„æ—¶å€™é”€æ¯</strong></p><p><strong>ä»€ä¹ˆæ˜¯åŸŸå¯¹è±¡?</strong><br>åŸŸå¯¹è±¡ï¼Œæ˜¯å¯ä»¥åƒMapä¸€æ ·å­˜å–æ•°æ®çš„å¯¹è±¡ï¼Œå«åŸŸå¯¹è±¡</p><p>è¿™é‡Œçš„åŸŸæŒ‡çš„æ˜¯å­˜å–æ•°æ®çš„æ“ä½œèŒƒå›´ï¼Œæ•´ä¸ª webå·¥ç¨‹</p><div class="hljs code-wrapper"><pre><code class="hljs css"> å­˜æ•°æ®   å–æ•°æ®       åˆ é™¤æ•°æ®Map  put()   get()  remove()åŸŸå¯¹è±¡ setAttribute() getAttribute() removeAttribute();</code></pre></div><p><strong>ServletContextå¯¹è±¡çš„ä½œç”¨</strong></p><p>1ã€è·å– web.xml ä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•° context-param<br>2ã€è·å–å½“å‰çš„å·¥ç¨‹è·¯å¾„ï¼Œæ ¼å¼: /å·¥ç¨‹è·¯å¾„<br>3ã€è·å–å·¥ç¨‹éƒ¨ç½²ååœ¨æœåŠ¡å™¨ç¡¬ç›˜ä¸Šçš„ç»å¯¹è·¯å¾„<br>4ã€åƒ Map ä¸€æ ·å­˜å–æ•°æ®</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span></span><span class="hljs-function">ServletException, IOException </span>&#123;    <span class="hljs-comment">// 1ã€è·å– web.xml ä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•° context-param</span>    ServletContext context = getServletConfig().getServletContext();    String username = context.getInitParameter(<span class="hljs-string">&quot;username&quot;</span>);    System.out.println(<span class="hljs-string">&quot;context-param å‚æ•° username çš„å€¼æ˜¯:&quot;</span> + username);    System.out.println(<span class="hljs-string">&quot;context-param å‚æ•° password çš„å€¼æ˜¯:&quot;</span> +    context.getInitParameter(<span class="hljs-string">&quot;password&quot;</span>));    <span class="hljs-comment">// 2ã€è·å–å½“å‰çš„å·¥ç¨‹è·¯å¾„ï¼Œæ ¼å¼: /å·¥ç¨‹è·¯å¾„</span>  System.out.println( <span class="hljs-string">&quot;å½“å‰å·¥ç¨‹è·¯å¾„:&quot;</span> + context.getContextPath() );    <span class="hljs-comment">// 3ã€è·å–å·¥ç¨‹éƒ¨ç½²ååœ¨æœåŠ¡å™¨ç¡¬ç›˜ä¸Šçš„ç»å¯¹è·¯å¾„</span>    <span class="hljs-comment">/**</span><span class="hljs-comment">    * / æ–œæ è¢«æœåŠ¡å™¨è§£æåœ°å€ä¸º:http://ip:port/å·¥ç¨‹å/ æ˜ å°„åˆ° IDEA ä»£ç çš„ web ç›®å½•&lt;br/&gt;</span><span class="hljs-comment">    */</span>    System.out.println(<span class="hljs-string">&quot;å·¥ç¨‹éƒ¨ç½²çš„è·¯å¾„æ˜¯:&quot;</span> + context.getRealPath(<span class="hljs-string">&quot;/&quot;</span>));    System.out.println(<span class="hljs-string">&quot;å·¥ç¨‹ä¸‹ css ç›®å½•çš„ç»å¯¹è·¯å¾„æ˜¯:&quot;</span> + context.getRealPath(<span class="hljs-string">&quot;/css&quot;</span>));    System.out.println(<span class="hljs-string">&quot;å·¥ç¨‹ä¸‹ imgs ç›®å½• 1.jpg çš„ç»å¯¹è·¯å¾„æ˜¯:&quot;</span> + context.getRealPath(<span class="hljs-string">&quot;/imgs/1.jpg&quot;</span>));&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml">!--context-param æ˜¯ä¸Šä¸‹æ–‡å‚æ•°(å®ƒå±äºæ•´ä¸ª web å·¥ç¨‹)--&gt;<span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>username<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>context<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><span class="hljs-comment">&lt;!--context-param æ˜¯ä¸Šä¸‹æ–‡å‚æ•°(å®ƒå±äºæ•´ä¸ª web å·¥ç¨‹)--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span></code></pre></div><p>ServletContext åƒ Map ä¸€æ ·å­˜å–æ•°æ®ï¼š</p><p>ContextServlet1 ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextServlet1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span></span><span class="hljs-function">        ServletException, IOException </span>&#123;        <span class="hljs-comment">// è·å– ServletContext å¯¹è±¡</span>        ServletContext context = getServletContext();        System.out.println(context);        System.out.println(<span class="hljs-string">&quot;ä¿å­˜ä¹‹å‰: Context1 è·å– key1 çš„å€¼æ˜¯:&quot;</span>+ context.getAttribute(<span class="hljs-string">&quot;key1&quot;</span>));        context.setAttribute(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);        System.out.println(<span class="hljs-string">&quot;Context1 ä¸­è·å–åŸŸæ•°æ® key1 çš„å€¼æ˜¯:&quot;</span>+ context.getAttribute(<span class="hljs-string">&quot;key1&quot;</span>));    &#125;&#125;</code></pre></div><p>ContextServlet2 ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">IOException </span>&#123;    ServletContext context = getServletContext();System.out.println(context);    System.out.println(<span class="hljs-string">&quot;Context2 ä¸­è·å–åŸŸæ•°æ® key1 çš„å€¼æ˜¯:&quot;</span>+ context.getAttribute(<span class="hljs-string">&quot;key1&quot;</span>));&#125;</code></pre></div><p><strong>ServletConfig å’Œ ServletContext çš„åŒºåˆ«ï¼š</strong></p><p>ServletConfig ä½œâ½¤äºæŸä¸ª Servlet å®ä¾‹ï¼Œæ¯ä¸ª Servlet éƒ½æœ‰å¯¹åº”çš„ ServletConfigï¼ŒServletContext ä½œâ½¤äºæ•´ä¸ª Web åº”â½¤ï¼Œâ¼€ä¸ª Web åº”â½¤å¯¹åº”â¼€ä¸ª ServletContextï¼Œå¤šä¸ª Servlet å®ä¾‹å¯¹åº”â¼€ä¸ªServletContext</p><p><strong>â¼€ä¸ªæ˜¯å±€éƒ¨å¯¹è±¡ï¼Œâ¼€ä¸ªæ˜¯å…¨å±€å¯¹è±¡</strong></p><h2 id="HTTP-åè®®å›é¡¾"><a href="#HTTP-åè®®å›é¡¾" class="headerlink" title="HTTP åè®®å›é¡¾"></a><strong>HTTP åè®®å›é¡¾</strong></h2><p><a href="#3%E3%80%81http%E5%8D%8F%E8%AE%AE">ä»€ä¹ˆæ˜¯ HTTP åè®®</a></p><ul><li>åè®®æ˜¯æŒ‡åŒæ–¹ï¼Œæˆ–å¤šæ–¹ï¼Œç›¸äº’çº¦å®šå¥½ï¼Œå¤§å®¶éƒ½éœ€è¦éµå®ˆçš„è§„åˆ™ï¼Œå«åè®®</li><li>æ‰€è°“ HTTP åè®®ï¼Œå°±æ˜¯æŒ‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡æ—¶ï¼Œå‘é€çš„æ•°æ®ï¼Œéœ€è¦éµå®ˆçš„è§„åˆ™ï¼Œå« HTTP åè®®</li><li>HTTP åè®®ä¸­çš„æ•°æ®åˆå«æŠ¥æ–‡</li></ul><p><strong>è¯·æ±‚çš„ HTTP åè®®æ ¼å¼</strong></p><ul><li>å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€æ•°æ®å«è¯·æ±‚ </li><li>æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯å›ä¼ æ•°æ®å«å“åº”</li><li>è¯·æ±‚åˆåˆ†ä¸º GET è¯·æ±‚ï¼Œå’Œ POST è¯·æ±‚ä¸¤ç§</li></ul><p><strong>GET è¯·æ±‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">1</span>ã€è¯·æ±‚è¡Œ    (<span class="hljs-number">1</span>) è¯·æ±‚çš„æ–¹å¼ <span class="hljs-selector-tag">GET</span>    (<span class="hljs-number">2</span>) è¯·æ±‚çš„èµ„æºè·¯å¾„<span class="hljs-selector-attr">[+?+è¯·æ±‚å‚æ•°]</span>    (<span class="hljs-number">3</span>) è¯·æ±‚çš„åè®®çš„ç‰ˆæœ¬å· <span class="hljs-selector-tag">HTTP</span>/<span class="hljs-selector-tag">1</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-tag">2</span>ã€è¯·æ±‚å¤´<span class="hljs-selector-tag">key</span> : <span class="hljs-selector-tag">value</span> ç»„æˆä¸åŒçš„é”®å€¼å¯¹ï¼Œè¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421104718675-9168959.png" alt="image-20210421104718675"></p><p> <strong>POST è¯·æ±‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">1</span>ã€è¯·æ±‚è¡Œ    (<span class="hljs-number">1</span>) è¯·æ±‚çš„æ–¹å¼ <span class="hljs-selector-tag">POST</span>     (<span class="hljs-number">2</span>) è¯·æ±‚çš„èµ„æºè·¯å¾„<span class="hljs-selector-attr">[+?+è¯·æ±‚å‚æ•°]</span>     (<span class="hljs-number">3</span>) è¯·æ±‚çš„åè®®çš„ç‰ˆæœ¬å· <span class="hljs-selector-tag">HTTP</span>/<span class="hljs-selector-tag">1</span><span class="hljs-selector-class">.1</span> <span class="hljs-selector-tag">2</span>ã€è¯·æ±‚å¤´ <span class="hljs-selector-tag">key</span> : <span class="hljs-selector-tag">value</span> ä¸åŒçš„è¯·æ±‚å¤´ï¼Œæœ‰ä¸åŒçš„å«ä¹‰ ç©ºè¡Œ<span class="hljs-selector-tag">3</span>ã€è¯·æ±‚ä½“å°±æ˜¯å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421104938669-9168959.png" alt="image-20210421104938669"></p><p> <strong>å¸¸ç”¨è¯·æ±‚å¤´çš„è¯´æ˜</strong></p><p><code>Accept</code> è¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„æ•°æ®ç±»å‹<br><code>Accpet-Languege</code> è¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„è¯­è¨€ç±»å‹<br><code>User-Agent</code> è¡¨ç¤ºå®¢æˆ·ç«¯æµè§ˆå™¨çš„ä¿¡æ¯<br><code>Host</code> è¡¨ç¤ºè¯·æ±‚æ—¶çš„æœåŠ¡å™¨ ip å’Œç«¯å£å·</p><p><strong>åŒºåˆ†GETå’ŒPOSTè¯·æ±‚</strong></p><p><strong>GET</strong></p><ul><li>fromæ ‡ç­¾ method=get</li><li>aæ ‡ç­¾</li><li>linkæ ‡ç­¾å¼•å…¥css</li><li>Scriptæ ‡ç­¾å¼•å…¥jsæ–‡ä»¶</li><li>imgæ ‡ç­¾å¼•å…¥å›¾ç‰‡</li><li>iframeå¼•å…¥htmlé¡µé¢</li><li>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€åç¿˜å›è½¦</li></ul><p><strong>POST</strong></p><ul><li>fromæ ‡ç­¾ method=post</li></ul><p><strong>å“åº”çš„ HTTP åè®®æ ¼å¼</strong></p><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-number">1</span>ã€å“åº”è¡Œ    (<span class="hljs-number">1</span>) å“åº”çš„åè®®å’Œç‰ˆæœ¬å·    (<span class="hljs-number">2</span>) å“åº”çŠ¶æ€ç     (<span class="hljs-number">3</span>) å“åº”çŠ¶æ€æè¿°ç¬¦<span class="hljs-number">2</span>ã€å“åº”å¤´  key : value ä¸åŒçš„å“åº”å¤´ï¼Œæœ‰å…¶ä¸åŒå«ä¹‰ç©ºè¡Œ<span class="hljs-number">3</span>ã€å“åº”ä½“å°±æ˜¯å›ä¼ ç»™å®¢æˆ·ç«¯çš„æ•°æ®</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421105124947-9168959.png" alt="image-20210421105124947"></p><p><strong>å¸¸ç”¨çš„å“åº”ç è¯´æ˜</strong></p><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-symbol">200 </span>è¡¨ç¤ºè¯·æ±‚æˆåŠŸ<span class="hljs-symbol">302 </span>è¡¨ç¤ºè¯·æ±‚é‡å®šå‘<span class="hljs-symbol">404 </span>è¡¨ç¤ºè¯·æ±‚æœåŠ¡å™¨å·²ç»æ”¶åˆ°äº†ï¼Œä½†æ˜¯ä½ è¦çš„æ•°æ®ä¸å­˜åœ¨ï¼ˆè¯·æ±‚åœ°å€é”™è¯¯ï¼‰<span class="hljs-symbol">500 </span>è¡¨ç¤ºæœåŠ¡å™¨å·²ç»æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆä»£ç é”™è¯¯ï¼‰</code></pre></div><p><strong>MIME ç±»å‹è¯´æ˜</strong></p><ul><li>MIME æ˜¯ HTTP åè®®ä¸­æ•°æ®ç±»å‹</li><li>MIME çš„è‹±æ–‡å…¨ç§°æ˜¯â€Multipurpose Internet Mail Extensionsâ€ å¤šåŠŸèƒ½ Internet é‚®ä»¶æ‰©å……æœåŠ¡ã€‚MIME ç±»å‹çš„æ ¼å¼æ˜¯â€œå¤§ç±»å‹/å°ç±»å‹â€ï¼Œå¹¶ä¸æŸä¸€ç§æ–‡ä»¶çš„æ‰©å±•åç›¸å¯¹åº”</li></ul><p>å¸¸è§çš„ MIME ç±»å‹</p><table><thead><tr><th align="center">æ–‡ä»¶</th><th align="center">MIME ç±»å‹</th></tr></thead><tbody><tr><td align="center">è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬</td><td align="center">text/html</td></tr><tr><td align="center">æ™®é€šæ–‡æœ¬</td><td align="center">text/plain</td></tr><tr><td align="center">TAR æ–‡ä»¶</td><td align="center">application/x-tar</td></tr><tr><td align="center">GIF å›¾å½¢</td><td align="center">image/gif</td></tr></tbody></table><h2 id="HttpServletRequest"><a href="#HttpServletRequest" class="headerlink" title="HttpServletRequest"></a><strong>HttpServletRequest</strong></h2><p><strong>HttpServletRequest ç±»çš„ä½œç”¨</strong></p><ul><li>æ¯æ¬¡åªè¦æœ‰è¯·æ±‚è¿›å…¥ Tomcat æœåŠ¡å™¨ï¼ŒTomcat æœåŠ¡å™¨å°±ä¼šæŠŠè¯·æ±‚è¿‡æ¥çš„ HTTP åè®®ä¿¡æ¯è§£æå¥½å°è£…åˆ° Request å¯¹è±¡ä¸­</li><li>ç„¶åä¼ é€’åˆ° service æ–¹æ³•ï¼ˆdoGet å’Œ doPostï¼‰ä¸­ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ HttpServletRequest å¯¹è±¡ï¼Œè·å–åˆ°æ‰€æœ‰è¯·æ±‚çš„ä¿¡æ¯</li></ul><p><strong>HttpServletRequest ç±»çš„å¸¸ç”¨æ–¹æ³•</strong></p><p> <code>getRequestURI()</code> è·å–è¯·æ±‚çš„èµ„æºè·¯å¾„<br> <code>getRequestURL() </code>è·å–è¯·æ±‚çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆç»å¯¹è·¯å¾„ï¼‰<br> <code>getRemoteHost() </code>è·å–å®¢æˆ·ç«¯çš„ipåœ°å€<br> <code>getHeader()</code> è·å–è¯·æ±‚å¤´<br> <code>getParameter()</code>è·å–è¯·æ±‚çš„å‚æ•°<br> <code>getParameterValues()</code>è·å–è¯·æ±‚çš„å‚æ•°ï¼ˆå¤šä¸ªå€¼çš„æ—¶å€™ä½¿ç”¨ï¼‰<br> <code> setAttribute(key, value)</code> è®¾ç½®åŸŸæ•°æ®<br> <code>getAttribute(key)</code>è·å–åŸŸæ•°æ®<br> <code> getRequestDispatcher()</code> è·å–è¯·æ±‚è½¬å‘å¯¹<br> <code>getMethod()</code> è·å–è¯·æ±‚çš„æ–¹å¼GETæˆ–POST</p><p>å¸¸ç”¨ API ç¤ºä¾‹ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestAPIServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">    IOException </span>&#123;        <span class="hljs-comment">// i.getRequestURI() è·å–è¯·æ±‚çš„èµ„æºè·¯å¾„</span>        System.out.println(<span class="hljs-string">&quot;URI =&gt; &quot;</span> + req.getRequestURI());        <span class="hljs-comment">// ii.getRequestURL() è·å–è¯·æ±‚çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆç»å¯¹è·¯å¾„ï¼‰</span>        System.out.println(<span class="hljs-string">&quot;URL =&gt; &quot;</span> + req.getRequestURL());      <span class="hljs-comment">// iii.getRemoteHost() è·å–å®¢æˆ·ç«¯çš„ ip åœ°å€</span>        <span class="hljs-comment">/**</span><span class="hljs-comment">        * åœ¨ IDEA ä¸­ï¼Œä½¿ç”¨ localhost è®¿é—®æ—¶ï¼Œå¾—åˆ°çš„å®¢æˆ·ç«¯ ip åœ°å€æ˜¯ ===&gt;&gt;&gt; 127.0.0.1&lt;br/&gt;</span><span class="hljs-comment">        * åœ¨ IDEA ä¸­ï¼Œä½¿ç”¨ 127.0.0.1 è®¿é—®æ—¶ï¼Œå¾—åˆ°çš„å®¢æˆ·ç«¯ ip åœ°å€æ˜¯ ===&gt;&gt;&gt; 127.0.0.1&lt;br/&gt;</span><span class="hljs-comment">        * åœ¨ IDEA ä¸­ï¼Œä½¿ç”¨ çœŸå® ip è®¿é—®æ—¶ï¼Œå¾—åˆ°çš„å®¢æˆ·ç«¯ ip åœ°å€æ˜¯ ===&gt;&gt;&gt; çœŸå®çš„å®¢æˆ·ç«¯ ip åœ°å€&lt;br/&gt;</span><span class="hljs-comment">        */</span>        System.out.println(<span class="hljs-string">&quot;å®¢æˆ·ç«¯ ip åœ°å€ =&gt; &quot;</span> + req.getRemoteHost());        <span class="hljs-comment">// iv.getHeader() è·å–è¯·æ±‚å¤´</span>        System.out.println(<span class="hljs-string">&quot;è¯·æ±‚å¤´ User-Agent ==&gt;&gt; &quot;</span> + req.getHeader(<span class="hljs-string">&quot;User-Agent&quot;</span>));        <span class="hljs-comment">// vii.getMethod() è·å–è¯·æ±‚çš„æ–¹å¼ GET æˆ– POST</span>        System.out.println( <span class="hljs-string">&quot;è¯·æ±‚çš„æ–¹å¼ ==&gt;&gt; &quot;</span> + req.getMethod() );    &#125;&#125;</code></pre></div><p><strong>å¦‚ä½•è·å–è¯·æ±‚å‚æ•°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:8080/07_servlet/parameterServlet&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span>&gt;</span>        ç”¨æˆ·åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>        å¯†ç ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>        å…´è¶£çˆ±å¥½ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;cpp&quot;</span>&gt;</span>C++        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;java&quot;</span>&gt;</span>Java        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;js&quot;</span>&gt;</span>JavaScript<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre></div><p>Java ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParameterServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">    IOException </span>&#123;      <span class="hljs-comment">//è®¾ç½®ç¼–ç </span>     req.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);        <span class="hljs-comment">// è·å–è¯·æ±‚å‚æ•°</span>        String username = req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);        String password = req.getParameter(<span class="hljs-string">&quot;password&quot;</span>);        String[] hobby = req.getParameterValues(<span class="hljs-string">&quot;hobby&quot;</span>);        System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åï¼š&quot;</span> + username);        System.out.println(<span class="hljs-string">&quot;å¯†ç ï¼š&quot;</span> + password);        System.out.println(<span class="hljs-string">&quot;å…´è¶£çˆ±å¥½ï¼š&quot;</span> + Arrays.asList(hobby));    &#125;&#125;</code></pre></div><p><strong>è¯·æ±‚è½¬å‘</strong></p><p>ä»€ä¹ˆæ˜¯è¯·æ±‚çš„è½¬å‘? </p><blockquote><p>è¯·æ±‚è½¬å‘æ˜¯æŒ‡ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä»ä¸€æ¬¡èµ„æºè·³è½¬åˆ°å¦ä¸€ä¸ªèµ„æºçš„æ“ä½œå«è¯·æ±‚è½¬å‘ã€‚</p></blockquote><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421111014356-9168959.png" alt="image-20210421111014356"></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Servlet1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">    IOException </span>&#123;        <span class="hljs-comment">// è·å–è¯·æ±‚çš„å‚æ•°ï¼ˆåŠäº‹çš„ææ–™ï¼‰æŸ¥çœ‹</span>        String username = req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);        System.out.println(<span class="hljs-string">&quot;åœ¨ Servlet1ï¼ˆæŸœå° 1ï¼‰ä¸­æŸ¥çœ‹å‚æ•°ï¼ˆææ–™ï¼‰ï¼š&quot;</span> + username);        <span class="hljs-comment">// ç»™ææ–™ ç›–ä¸€ä¸ªç« ï¼Œå¹¶ä¼ é€’åˆ° Servlet2ï¼ˆæŸœå° 2ï¼‰å»æŸ¥çœ‹</span>        req.setAttribute(<span class="hljs-string">&quot;key1&quot;</span>,<span class="hljs-string">&quot;æŸœå° 1 çš„ç« &quot;</span>);        <span class="hljs-comment">// é—®è·¯ï¼šServlet2ï¼ˆæŸœå° 2ï¼‰æ€ä¹ˆèµ°</span>        <span class="hljs-comment">/**</span><span class="hljs-comment">        * è¯·æ±‚è½¬å‘å¿…é¡»è¦ä»¥æ–œæ æ‰“å¤´ï¼Œ/ æ–œæ è¡¨ç¤ºåœ°å€ä¸ºï¼šhttp://ip:port/å·¥ç¨‹å/ , æ˜ å°„åˆ° IDEA ä»£ç çš„ web ç›®å½•</span><span class="hljs-comment">        &lt;br/&gt;</span><span class="hljs-comment">        *</span><span class="hljs-comment">        */</span>        RequestDispatcher requestDispatcher = req.getRequestDispatcher(<span class="hljs-string">&quot;/servlet2&quot;</span>);        <span class="hljs-comment">// èµ°å‘ Sevlet2ï¼ˆæŸœå° 2ï¼‰</span>        requestDispatcher.forward(req,resp);    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Servlet2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">    IOException </span>&#123;        <span class="hljs-comment">// è·å–è¯·æ±‚çš„å‚æ•°ï¼ˆåŠäº‹çš„ææ–™ï¼‰æŸ¥çœ‹</span>        String username = req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);        System.out.println(<span class="hljs-string">&quot;åœ¨ Servlet2ï¼ˆæŸœå° 2ï¼‰ä¸­æŸ¥çœ‹å‚æ•°ï¼ˆææ–™ï¼‰ï¼š&quot;</span> + username);        <span class="hljs-comment">// æŸ¥çœ‹æŸœå°1æ˜¯å¦æœ‰ç›–ç« </span>        Object key1 = req.getAttribute(<span class="hljs-string">&quot;key1&quot;</span>);        System.out.println(<span class="hljs-string">&quot;æŸœå° 1 æ˜¯å¦æœ‰ç« ï¼š&quot;</span> + key1);        <span class="hljs-comment">// å¤„ç†è‡ªå·±çš„ä¸šåŠ¡</span>        System.out.println(<span class="hljs-string">&quot;Servlet2 å¤„ç†è‡ªå·±çš„ä¸šåŠ¡ &quot;</span>);&#125;&#125;</code></pre></div><p><strong>baseæ ‡ç­¾</strong></p><p>æ¯”å¦‚è¿™é‡Œè®¾ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://localhost:8080/07_servlet/a/b/c.html&quot;</span>&gt;</span>æˆ–è€…<span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://localhost:8080/07_servlet/a/b/&quot;</span>&gt;</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424201046209.png" alt="image-20210424201046209"></p><p><strong>Web ä¸­çš„ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„</strong></p><p>åœ¨ javaWeb ä¸­ï¼Œ è·¯å¾„åˆ†ä¸ºç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ä¸¤ç§ï¼š</p><ul><li>ç›¸å¯¹è·¯å¾„æ˜¯ï¼š</li></ul><div class="hljs code-wrapper"><pre><code class="hljs asciidoc"><span class="hljs-bullet">.          </span>è¡¨ç¤ºå½“å‰ç›®å½•<span class="hljs-bullet">..         </span>è¡¨ç¤ºä¸Šä¸€çº§ç›®å½•èµ„æºå     è¡¨ç¤ºå½“å‰ç›®å½•/èµ„æºå</code></pre></div><p>ç»å¯¹è·¯å¾„ï¼š <code>http://ip:port/å·¥ç¨‹è·¯å¾„/èµ„æºè·¯å¾„</code> </p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œ è·¯å¾„éƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œ è€Œä¸ç®€å•çš„ä½¿ç”¨ç›¸å¯¹è·¯å¾„,å…·ä½“è€Œè¨€, ç»å¯¹è·¯å¾„çš„è¡¨ç¤ºæ–¹å¼æœ‰:</p><ul><li>ç»å¯¹è·¯å¾„</li><li>base+ç›¸å¯¹</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// i.getRequestURI() è·å–è¯·æ±‚çš„èµ„æºè·¯å¾„</span>System.out.println(<span class="hljs-string">&quot;URI =&gt; &quot;</span> + req.getRequestURI());<span class="hljs-comment">// ii.getRequestURL() è·å–è¯·æ±‚çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆç»å¯¹è·¯å¾„ï¼‰</span>System.out.println(<span class="hljs-string">&quot;URL =&gt; &quot;</span> + req.getRequestURL());<span class="hljs-comment">//åŠ¨æ€è·å–å½“å‰é¡¹ç›®çš„è·¯å¾„(ç£ç›˜ä¸Šçš„çœŸå®è·¯å¾„)</span>ServletContext context=getServletContext();response.sendRedirect(context.getContextPath()+<span class="hljs-string">&quot;/pages/a.html&quot;</span>)</code></pre></div><p><strong>web ä¸­ / æ–œæ çš„ä¸åŒæ„ä¹‰</strong></p><p>åœ¨ web ä¸­ / æ–œæ  æ˜¯ä¸€ç§ç»å¯¹è·¯å¾„</p><p>/ æ–œæ  å¦‚æœè¢«æµè§ˆå™¨è§£æï¼Œå¾—åˆ°çš„åœ°å€æ˜¯ï¼š<a href="http://ip:port/">http://ip:port/</a></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>æ–œæ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre></div><p>/ æ–œæ  å¦‚æœè¢«æœåŠ¡å™¨è§£æï¼Œå¾—åˆ°çš„åœ°å€æ˜¯ï¼š<a href="http://ip:port/å·¥ç¨‹è·¯å¾„">http://ip:port/å·¥ç¨‹è·¯å¾„</a></p><ul><li><url-pattern>/servlet1</url-pattern></li><li>servletContext.getRealPath(â€œ/â€);</li><li>request.getRequestDispatcher(â€œ/â€);</li></ul><p><strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼š</p><p>response.sendRediect(â€œ/â€); æŠŠæ–œæ å‘é€ç»™æµè§ˆå™¨è§£æã€‚å¾—åˆ° <a href="http://ip:port/">http://ip:port/</a></p><p><strong>ä¸­æ–‡ä¹±ç é—®é¢˜</strong></p><p><strong>getè¯·æ±‚ï¼š</strong></p><p>ä½¿ç”¨Servletå¤„ç†getè¯·æ±‚æ—¶ï¼Œå¦‚æœgetè¯·æ±‚çš„å‚æ•°ä¸­æœ‰ä¸­æ–‡ï¼Œç›´æ¥æ¥æ”¶ä¼šæ˜¯ä¹±ç ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„è¯­å¥æ¥å¤„ç†ä¹±ç :</p><div class="hljs code-wrapper"><pre><code class="hljs java">String name = request.getParameter(<span class="hljs-string">&quot;name&quot;</span>);System.out.prinlnt(name); <span class="hljs-comment">// ä¹±ç </span><span class="hljs-comment">// å¤„ç†ä¹±ç </span>name = <span class="hljs-keyword">new</span> String(name.getBytes(<span class="hljs-string">&quot;ISO8859-1&quot;</span>),<span class="hljs-string">&quot;UTF-8&quot;</span>);System.out.println(name);<span class="hljs-comment">// ä¹±ç é—®é¢˜è§£å†³</span></code></pre></div><p>æ¯æ¬¡ä¸­æ–‡éƒ½è¦å¤„ç†ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç å¤„ç†ä¹±ç é—®é¢˜:</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getParameter</span><span class="hljs-params">(String name)</span> </span>&#123;    String value = <span class="hljs-keyword">super</span>.getParameter(name);    <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>)        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    String method = request.getMethod();    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;get&quot;</span>.equalsIgnoreCase(method)) &#123;        <span class="hljs-keyword">try</span> &#123;            value = <span class="hljs-keyword">new</span> String(value.getBytes(<span class="hljs-string">&quot;ISO8859-1&quot;</span>),<span class="hljs-string">&quot;UTF-8&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (UnsupportedEncodingException e) &#123;            e.printStackTrace();        &#125;    &#125;    <span class="hljs-keyword">return</span> value;&#125;</code></pre></div><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å°†ISO8859-1è½¬ä¸ºUTF-8ï¼Ÿä¸ºä»€ä¹ˆæ¥æ”¶åˆ°çš„å‚æ•°æ˜¯ISO8859-1è¿™ç§ç¼–ç æ–¹å¼çš„ï¼Ÿ<br>å…¶å®å¾ˆç®€å•ï¼Œåªæ˜¯ä¸ªé…ç½®é—®é¢˜ï¼š<br>åœ¨tomcatå®‰è£…ç›®å½•ä¸‹çš„conf/server.xmlä¸­ï¼Œæœ‰å¦‚ä¸‹çš„é…ç½®ï¼š</p><p>URIEncodingè¯¥é…ç½®å†³å®šäº†ä½¿ç”¨getè¯·æ±‚é€šè¿‡æµè§ˆå™¨åœ°å€æ è®¿é—®tomcatæ—¶çš„ç¼–ç æ–¹å¼ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä½¿ISO8859-1:</p><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">URIEncoding:This specifies <span class="hljs-keyword">the</span> <span class="hljs-keyword">character</span> encoding used <span class="hljs-built_in">to</span> decode <span class="hljs-keyword">the</span> URI <span class="hljs-keyword">bytes</span>, <span class="hljs-keyword">after</span> %xx decoding <span class="hljs-keyword">the</span> <span class="hljs-built_in">URL</span>. If <span class="hljs-keyword">not</span> specified, ISO-``<span class="hljs-number">8859</span>``-``<span class="hljs-number">1</span>` `will be used.</code></pre></div><p>å¯ä»¥è¿™æ ·é…ç½®ï¼Œåˆ™ä¸Šè¿°ä»£ç ä¸­ï¼Œå°±ä¸éœ€è¦å†ä»ISO8859-1è½¬ä¸ºUTF-8äº†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">URIEncoding</span>=<span class="hljs-string">&quot;UTF-8&quot;</span></code></pre></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»tomcat8.0å¼€å§‹ï¼ŒURIEncodingé»˜è®¤å€¼ä¸å†æ˜¯ISO8859-1ï¼Œè€Œå˜æˆäº†UTF-8 ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€ï¼Œä»tomcat8.0å¼€å§‹ï¼Œgetè¯·æ±‚ä¸­çš„ä¸­æ–‡å‚æ•°ï¼Œä¸éœ€è¦ç‰¹æ®Šå¤„ç†äº†</p><p><strong>postè¯·æ±‚ï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">IOException </span>&#123;    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚ä½“çš„å­—ç¬¦é›†ä¸º UTF-8ï¼Œä»è€Œè§£å†³ post è¯·æ±‚çš„ä¸­æ–‡ä¹±ç é—®é¢˜</span>    req.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);    System.out.println(<span class="hljs-string">&quot;-------------doPost------------&quot;</span>);    <span class="hljs-comment">// è·å–è¯·æ±‚å‚æ•°</span>    String username = req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);    String password = req.getParameter(<span class="hljs-string">&quot;password&quot;</span>);    String[] hobby = req.getParameterValues(<span class="hljs-string">&quot;hobby&quot;</span>);    System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åï¼š&quot;</span> + username);    System.out.println(<span class="hljs-string">&quot;å¯†ç ï¼š&quot;</span> + password);    System.out.println(<span class="hljs-string">&quot;å…´è¶£çˆ±å¥½ï¼š&quot;</span> + Arrays.asList(hobby));&#125;</code></pre></div><h2 id="HttpServletResponse"><a href="#HttpServletResponse" class="headerlink" title="HttpServletResponse"></a>HttpServletResponse</h2><p><strong>HttpServletResponse ç±»çš„ä½œç”¨</strong> </p><ul><li>HttpServletResponse ç±»å’Œ HttpServletRequest ç±»ä¸€æ ·ã€‚æ¯æ¬¡è¯·æ±‚è¿›æ¥ï¼ŒTomcat æœåŠ¡å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Response å¯¹è±¡ä¼ é€’ç»™ Servlet ç¨‹åºå»ä½¿ç”¨ã€‚HttpServletRequest è¡¨ç¤ºè¯·æ±‚è¿‡æ¥çš„ä¿¡æ¯ï¼ŒHttpServletResponse è¡¨ç¤ºæ‰€æœ‰å“åº”çš„ä¿¡æ¯</li><li>æˆ‘ä»¬å¦‚æœéœ€è¦è®¾ç½®è¿”å›ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œéƒ½å¯ä»¥é€šè¿‡ HttpServletResponse å¯¹è±¡æ¥è¿›è¡Œè®¾ç½®</li></ul><p><strong>ä¸¤ä¸ªè¾“å‡ºæµçš„è¯´æ˜</strong></p><ul><li><p>å­—èŠ‚æµ getOutputStream(); å¸¸ç”¨äºä¸‹è½½ï¼ˆä¼ é€’äºŒè¿›åˆ¶æ•°æ®ï¼‰ </p></li><li><p>å­—ç¬¦æµ getWriter(); å¸¸ç”¨äºå›ä¼ å­—ç¬¦ä¸²ï¼ˆå¸¸ç”¨ï¼‰</p></li><li><p>ä¸¤ä¸ªæµåŒæ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ªï¼Œä½¿ç”¨äº†å­—èŠ‚æµï¼Œå°±ä¸èƒ½å†ä½¿ç”¨å­—ç¬¦æµï¼Œåä¹‹äº¦ç„¶ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™</p></li></ul><p><strong>å“åº”çš„ä¹±ç è§£å†³</strong></p><p>è§£å†³å“åº”ä¸­æ–‡ä¹±ç æ–¹æ¡ˆä¸€ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// è®¾ç½®æœåŠ¡å™¨å­—ç¬¦é›†ä¸º UTF-8</span>resp.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<span class="hljs-comment">// é€šè¿‡å“åº”å¤´ï¼Œè®¾ç½®æµè§ˆå™¨ä¹Ÿä½¿ç”¨ UTF-8 å­—ç¬¦é›†</span>resp.setHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/html; charset=UTF-8);</span></code></pre></div><p>è§£å†³å“åº”ä¸­æ–‡ä¹±ç æ–¹æ¡ˆäºŒï¼ˆæ¨èï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å®ƒä¼šåŒæ—¶è®¾ç½®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨ UTF-8 å­—ç¬¦é›†ï¼Œè¿˜è®¾ç½®äº†å“åº”å¤´</span><span class="hljs-comment">// æ­¤æ–¹æ³•ä¸€å®šè¦åœ¨è·å–æµå¯¹è±¡ä¹‹å‰è°ƒç”¨æ‰æœ‰æ•ˆ</span>resp.setContentType(<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>);</code></pre></div><p><strong>è¯·æ±‚é‡å®šå‘</strong></p><p>è¯·æ±‚é‡å®šå‘ï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯è¯´ã€‚æˆ‘ç»™ä½ ä¸€äº›åœ°å€ã€‚ä½ å»æ–°åœ°å€è®¿é—®ã€‚å«è¯·æ±‚ é‡å®šå‘ï¼ˆå› ä¸ºä¹‹å‰çš„åœ°å€å¯èƒ½å·²ç»è¢«åºŸå¼ƒï¼‰ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210421113301751-9168959.png" alt="image-20210421113301751"></p><p>è¯·æ±‚é‡å®šå‘çš„ç¬¬ä¸€ç§æ–¹æ¡ˆï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// è®¾ç½®å“åº”çŠ¶æ€ç  302 ï¼Œè¡¨ç¤ºé‡å®šå‘ï¼Œï¼ˆå·²æ¬è¿ï¼‰</span>resp.setStatus(<span class="hljs-number">302</span>);<span class="hljs-comment">// è®¾ç½®å“åº”å¤´ï¼Œè¯´æ˜ æ–°çš„åœ°å€åœ¨å“ªé‡Œ</span>resp.setHeader(<span class="hljs-string">&quot;Location&quot;</span>, <span class="hljs-string">&quot;http://localhost:8080&quot;</span>);</code></pre></div><p>è¯·æ±‚é‡å®šå‘çš„ç¬¬äºŒç§æ–¹æ¡ˆï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">resp.sendRedirect(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>);</code></pre></div><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</h2><p>æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ˜¯éå¸¸å¸¸è§çš„åŠŸèƒ½ã€‚å¾ˆå¤šçš„ç³»ç»Ÿä¸­ï¼Œæˆ–è€…è½¯ä»¶ä¸­éƒ½ç»å¸¸ä½¿ç”¨æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ã€‚ æ¯”å¦‚ï¼šQQ å¤´åƒï¼Œå°±ä½¿ç”¨äº†ä¸Šä¼ ã€‚ é‚®ç®±ä¸­ä¹Ÿæœ‰é™„ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½åŠŸèƒ½ã€‚ OA ç³»ç»Ÿä¸­å®¡æ‰¹æœ‰é™„ä»¶ææ–™çš„ä¸Šä¼ </p><p><strong>æ–‡ä»¶çš„ä¸Šä¼ ä»‹ç»</strong></p><p>1ã€è¦æœ‰ä¸€ä¸ª form æ ‡ç­¾ï¼Œ<code>method=post </code>è¯·æ±‚ </p><p>2ã€form æ ‡ç­¾çš„ encType å±æ€§å€¼å¿…é¡»ä¸º<code>multipart/form-data</code>å€¼ </p><p>3ã€åœ¨ form æ ‡ç­¾ä¸­ä½¿ç”¨<code>input type=file</code>æ·»åŠ ä¸Šä¼ çš„æ–‡ä»¶ </p><p>4ã€ç¼–å†™æœåŠ¡å™¨ä»£ç ï¼ˆServlet ç¨‹åºï¼‰æ¥æ”¶ï¼Œå¤„ç†ä¸Šä¼ çš„æ•°æ®</p><p><code>encType=multipart/form-data</code>è¡¨ç¤ºæäº¤çš„æ•°æ®ï¼Œä»¥å¤šæ®µï¼ˆæ¯ä¸€ä¸ªè¡¨å•é¡¹ä¸€ä¸ªæ•°æ®æ®µï¼‰çš„å½¢å¼è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åä»¥äºŒè¿›åˆ¶æµçš„å½¢å¼å‘é€ç»™æœåŠ¡å™¨</p><p><strong>HTTP åè®®çš„è¯´æ˜</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424203534339.png" alt="image-20210424203534339"></p><p><strong>commons-fileupload.jarå¸¸ç”¨API</strong></p><p><code>commons-fileupload.jar</code> éœ€è¦ä¾èµ– <code>commons-io.jar</code> è¿™ä¸ªåŒ…ï¼Œæ‰€ä»¥ä¸¤ä¸ªåŒ…æˆ‘ä»¬éƒ½è¦å¼•å…¥</p><p>ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯éœ€è¦å¯¼å…¥ä¸¤ä¸ª jar åŒ…ï¼š</p><ul><li><p>commons-fileupload-1.2.1.jar</p></li><li><p>commons-io-1.4.jar</p></li></ul><p><code>commons-fileupload.jar</code> å’Œ <code>commons-io.jar</code> åŒ…ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ç±»æœ‰å“ªäº›ï¼Ÿ</p><ul><li><code>ServletFileUpload</code> ç±»ï¼Œç”¨äºè§£æä¸Šä¼ çš„æ•°æ®</li><li><code>FileItem</code>ç±»ï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªè¡¨å•é¡¹</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//åˆ¤æ–­å½“å‰ä¸Šä¼ çš„æ•°æ®æ ¼å¼æ˜¯å¦æ˜¯å¤šæ®µçš„æ ¼å¼</span><span class="hljs-keyword">boolean</span> ServletFileUpload.isMultipartContent(HttpServletRequest request);<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;FileItem&gt; <span class="hljs-title">parseRequest</span><span class="hljs-params">(HttpServletRequest request)</span><span class="hljs-comment">//è§£æä¸Šä¼ çš„æ•°æ®</span></span><span class="hljs-function"><span class="hljs-comment">//åˆ¤æ–­å½“å‰è¿™ä¸ªè¡¨å•é¡¹ï¼Œæ˜¯å¦æ˜¯æ™®é€šçš„è¡¨å•é¡¹ã€‚è¿˜æ˜¯ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><span class="hljs-function"><span class="hljs-comment">//true è¡¨ç¤ºæ™®é€šç±»å‹çš„è¡¨å•é¡¹ false è¡¨ç¤ºä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><span class="hljs-function"><span class="hljs-keyword">boolean</span> FileItem.<span class="hljs-title">isFormField</span><span class="hljs-params">()</span></span><span class="hljs-function">String FileItem.<span class="hljs-title">getFieldName</span><span class="hljs-params">()</span><span class="hljs-comment">//è·å–è¡¨å•é¡¹çš„ name å±æ€§å€¼</span></span><span class="hljs-function">String FileItem.<span class="hljs-title">getString</span><span class="hljs-params">()</span> <span class="hljs-comment">//è·å–å½“å‰è¡¨å•é¡¹çš„å€¼ã€‚</span></span><span class="hljs-function">String FileItem.<span class="hljs-title">getName</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//è·å–ä¸Šä¼ çš„æ–‡ä»¶å</span><span class="hljs-keyword">void</span> FileItem.write( file ); <span class="hljs-comment">//å°†ä¸Šä¼ çš„æ–‡ä»¶å†™åˆ°å‚æ•° file æ‰€æŒ‡å‘ç¡¬ç›˜ä½ç½®</span></code></pre></div><p><strong>fileupload ç±»åº“çš„ä½¿ç”¨</strong></p><p>ä¸Šä¼ æ–‡ä»¶çš„è¡¨å•</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://192.168.31.74:8080/09_EL_JSTL/uploadServlet&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>ç”¨æˆ·åï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>å¤´åƒï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;photo&quot;</span> &gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>è§£æä¸Šä¼ çš„æ•°æ®çš„ä»£ç </p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424204308913.png" alt="image-20210424204308913"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424204320995.png" alt="image-20210424204320995"></p><p><strong>æ–‡ä»¶ä¸‹è½½</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424210255797.png" alt="image-20210424210255797"></p><p>ä¸‹è½½çš„å¸¸ç”¨ API è¯´æ˜</p><ul><li>response.getOutputStream(); </li><li>servletContext.getResourceAsStream(); </li><li>servletContext.getMimeType(); </li><li>response.setContentType();</li></ul><p><code>response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment; fileName=1.jpg&quot;);</code></p><p>è¿™ä¸ªå“åº”å¤´å‘Šè¯‰æµè§ˆå™¨ã€‚è¿™æ˜¯éœ€è¦ä¸‹è½½çš„ã€‚è€Œattachmentè¡¨ç¤ºé™„ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¸‹è½½çš„ä¸€ä¸ªæ–‡ä»¶ã€‚fileName=åé¢ï¼Œè¡¨ç¤ºä¸‹è½½çš„æ–‡ä»¶åã€‚</p><p>å®Œæˆä¸Šé¢çš„ä¸¤ä¸ªæ­¥éª¤ï¼Œä¸‹è½½æ–‡ä»¶æ˜¯æ²¡é—®é¢˜äº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦ä¸‹è½½çš„æ–‡ä»¶æ˜¯ä¸­æ–‡åçš„è¯ã€‚ä½ ä¼šå‘ç°ï¼Œä¸‹è½½æ— æ³•æ­£ç¡®æ˜¾ç¤ºå‡ºæ­£ç¡®çš„ä¸­æ–‡åã€‚</p><p>åŸå› æ˜¯åœ¨å“åº”å¤´ä¸­ï¼Œä¸èƒ½åŒ…å«æœ‰ä¸­æ–‡å­—ç¬¦ï¼Œåªèƒ½åŒ…å« ASCII ç </p><p><strong>ä¸­æ–‡åä¹±ç é—®é¢˜è§£å†³æ–¹æ¡ˆ</strong></p><p>URLEncoder è§£å†³ IE å’Œè°·æ­Œæµè§ˆå™¨çš„é™„ä»¶ä¸­æ–‡åé—®é¢˜</p><p>å¦‚æœå®¢æˆ·ç«¯æµè§ˆå™¨æ˜¯ IE æµè§ˆå™¨ æˆ–è€… æ˜¯è°·æ­Œæµè§ˆå™¨ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ URLEncoder ç±»å…ˆå¯¹ä¸­æ–‡åè¿›è¡Œ UTF-8 çš„ç¼–ç  æ“ä½œã€‚ å› ä¸º IE æµè§ˆå™¨å’Œè°·æ­Œæµè§ˆå™¨æ”¶åˆ°å«æœ‰ç¼–ç åçš„å­—ç¬¦ä¸²åä¼šä»¥ UTF-8 å­—ç¬¦é›†è¿›è¡Œè§£ç æ˜¾ç¤ºã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// æŠŠä¸­æ–‡åè¿›è¡Œ UTF-8 ç¼–ç æ“ä½œã€‚</span>String str = <span class="hljs-string">&quot;attachment; fileName=&quot;</span> + URLEncoder.encode(<span class="hljs-string">&quot;ä¸­æ–‡.jpg&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<span class="hljs-comment">// ç„¶åæŠŠç¼–ç åçš„å­—ç¬¦ä¸²è®¾ç½®åˆ°å“åº”å¤´ä¸­ </span>response.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, str);</code></pre></div><p>å¦‚æœæ˜¯FireFoxï¼Œéœ€è¦Base64ç¼–ç </p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210424211335676.png" alt="image-20210424211335676"></p><h1 id="ä¸ƒã€Cookie-amp-Session"><a href="#ä¸ƒã€Cookie-amp-Session" class="headerlink" title="ä¸ƒã€Cookie&amp;Session"></a>ä¸ƒã€Cookie&amp;Session</h1><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>httpæ˜¯æ— çŠ¶æ€çš„ï¼Œä»–ä¸ä¿å­˜çŠ¶æ€ï¼Œæ„æ€å°±æ˜¯ä¸€ä¸ªæµè§ˆå™¨å‘çš„è¯·æ±‚ï¼Œéšåå°±æ–­å¼€äº†ï¼Œä¸‹ä¸€æ¬¡å‘é€è¯·æ±‚å°±å’Œ ä¸Šä¸€æ¬¡æ— å…³äº†ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·è´­ä¹°ä¸€ä¸ªå•†å“ï¼Œç¬¬ä¸€æ¬¡éœ€è¦ç™»å½•ï¼Œå¦‚æœå†ä¹°ä¸€ä¸ªæ—¶å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¦‚æœä¸çŸ¥é“æ˜¯è°å‘çš„ï¼Œé‚£ä¹ˆä»–å°±å¾—å†ç™»å½•ä¸€æ¬¡ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œäºæ˜¯å°±æå‡ºäº†cookieå’Œsessionçš„æ¦‚å¿µã€‚</p><p>cookieæ˜¯è®°å½•åœ¨æµè§ˆå™¨ç«¯çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œsessionæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä»–ä»¬ä¸¤äº’ç›¸é…åˆè®©æœåŠ¡å™¨æœ‰äº†èƒ½è¯†åˆ«å®¢æˆ·ç«¯ä¸€äº›çŠ¶æ€çš„èƒ½åŠ›ï¼Œæ„æ€å°±æ˜¯æœåŠ¡å°±å°±èƒ½çŸ¥é“è¿™ä¸ªå®¢æˆ·ç«¯æœ‰æ²¡æœ‰ç™»å½•ç­‰ã€‚cookieå°±ç›¸å½“äºé€šè¡Œè¯ï¼Œsessionå°±æ˜¯é—¨æˆ¿ï¼Œè¿›å»æ—¶éœ€è¦ä»é—¨æˆ¿è¯†åˆ«ä¸€ä¸ªèº«ä»½ã€‚</p><p><strong>åˆ›å»ºæ—¶æœº</strong></p><ol><li><p>å½“æµè§ˆå™¨å‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºä»–åˆ›å»ºä¸€ä¸ªsessionï¼ŒåŒæ—¶ç›¸åº”ä¼šåŠ ä¸€ä¸ªå¤´ï¼ˆSetCookie: jsessionid=ewrwerwer123ï¼‰</p></li><li><p>æµè§ˆå™¨å¾—åˆ°ç›¸åº”å°±ä¼šåœ¨åœ¨è‡ªå·±è¿™ä¿å­˜ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥åè®¿é—®è¿™ä¸ªç½‘ç«™çš„æ—¶å€™å°±ä¼šä¸€ç›´å¸¦ç€ã€‚</p></li><li><p>å½“ä¸‹ä¸€ä¸ªè¯·æ±‚å‘èµ·æ—¶ï¼Œä¼šå¸¦ç€è¿™ä¸ªcookieçš„ä¿¡æ¯ï¼ŒæœåŠ¡å™¨é€šè¿‡æŸ¥è¯¢idæ‰¾çš„sessionï¼Œé€šè¿‡sessionå†…ä¿å­˜çš„ä¿¡æ¯ï¼Œå°±èƒ½è·å¾—è¿™ä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚</p></li></ol><p><strong>ä»€ä¹ˆæ˜¯ Cookie?</strong> </p><ul><li>Cookie ç¿»è¯‘è¿‡æ¥æ˜¯é¥¼å¹²çš„æ„æ€</li><li>Cookie æ˜¯æœåŠ¡å™¨é€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜é”®å€¼å¯¹çš„ä¸€ç§æŠ€æœ¯ </li><li>å®¢æˆ·ç«¯æœ‰äº† Cookie åï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘é€ç»™æœåŠ¡å™¨</li><li>æ¯ä¸ª Cookie çš„å¤§å°ä¸èƒ½è¶…è¿‡ 4kb</li></ul><p><strong>å¦‚ä½•åˆ›å»º Cookie</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210419220806656-9168959.png" alt="image-20210419220806656"></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createCookie</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,</span><span class="hljs-function">IOException </span>&#123;<span class="hljs-comment">//1 åˆ›å»º Cookie å¯¹è±¡</span>Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;key4&quot;</span>, <span class="hljs-string">&quot;value4&quot;</span>);<span class="hljs-comment">//2 é€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜ Cookie</span>resp.addCookie(cookie);<span class="hljs-comment">//1 åˆ›å»º Cookie å¯¹è±¡</span>Cookie cookie1 = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;key5&quot;</span>, <span class="hljs-string">&quot;value5&quot;</span>);<span class="hljs-comment">//2 é€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜ Cookie</span>resp.addCookie(cookie1);resp.getWriter().write(<span class="hljs-string">&quot;Cookie åˆ›å»ºæˆåŠŸ&quot;</span>);&#125;</code></pre></div><p><strong>æœåŠ¡å™¨å¦‚ä½•è·å– Cookie</strong></p><p>æœåŠ¡å™¨è·å–å®¢æˆ·ç«¯çš„ Cookie åªéœ€è¦ä¸€è¡Œä»£ç ï¼šreq.getCookies():Cookie[]</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210419221025141-9168959.png" alt="image-20210419221025141"></p><p>Cookie çš„å·¥å…·ç±»ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CookieUtils</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æŸ¥æ‰¾æŒ‡å®šåç§°çš„Cookieå¯¹è±¡</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cookies</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Cookie <span class="hljs-title">findCookie</span><span class="hljs-params">(String name , Cookie[] cookies)</span></span>&#123;        <span class="hljs-keyword">if</span> (name == <span class="hljs-keyword">null</span> || cookies == <span class="hljs-keyword">null</span> || cookies.length == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        <span class="hljs-keyword">for</span> (Cookie cookie : cookies) &#123;            <span class="hljs-keyword">if</span> (name.equals(cookie.getName())) &#123;                <span class="hljs-keyword">return</span> cookie;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></div><p>Servlet ç¨‹åºä¸­çš„ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getCookie</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        Cookie[] cookies = req.getCookies();        <span class="hljs-keyword">for</span> (Cookie cookie : cookies) &#123;            <span class="hljs-comment">// getNameæ–¹æ³•è¿”å›Cookieçš„keyï¼ˆåï¼‰</span>            <span class="hljs-comment">// getValueæ–¹æ³•è¿”å›Cookieçš„valueå€¼</span>            resp.getWriter().write(<span class="hljs-string">&quot;Cookie[&quot;</span> + cookie.getName() + <span class="hljs-string">&quot;=&quot;</span> + cookie.getValue() + <span class="hljs-string">&quot;] &lt;br/&gt;&quot;</span>);        &#125;        Cookie iWantCookie = CookieUtils.findCookie(<span class="hljs-string">&quot;key1&quot;</span>, cookies);<span class="hljs-comment">//        for (Cookie cookie : cookies) &#123;</span><span class="hljs-comment">//            if (&quot;key2&quot;.equals(cookie.getName())) &#123;</span><span class="hljs-comment">//                iWantCookie = cookie;</span><span class="hljs-comment">//                break;</span><span class="hljs-comment">//            &#125;</span><span class="hljs-comment">//        &#125;</span>        <span class="hljs-comment">// å¦‚æœä¸ç­‰äºnullï¼Œè¯´æ˜èµ‹è¿‡å€¼ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°äº†éœ€è¦çš„Cookie</span>        <span class="hljs-keyword">if</span> (iWantCookie != <span class="hljs-keyword">null</span>) &#123;            resp.getWriter().write(<span class="hljs-string">&quot;æ‰¾åˆ°äº†éœ€è¦çš„Cookie&quot;</span>);        &#125;    &#125;</code></pre></div><p><strong>Cookie å€¼çš„ä¿®æ”¹</strong></p><p>æ–¹æ¡ˆä¸€ï¼š </p><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-number">1</span>ã€å…ˆåˆ›å»ºä¸€ä¸ªè¦ä¿®æ”¹çš„åŒåï¼ˆæŒ‡çš„å°±æ˜¯ <span class="hljs-keyword">key</span>ï¼‰çš„ Cookie å¯¹è±¡ <span class="hljs-number">2</span>ã€åœ¨æ„é€ å™¨ï¼ŒåŒæ—¶èµ‹äºæ–°çš„ Cookie å€¼ã€‚ <span class="hljs-number">3</span>ã€è°ƒç”¨ response.addCookie( Cookie )</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java">Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;key1&quot;</span>,<span class="hljs-string">&quot;newValue1&quot;</span>);resp.addCookie(cookie);</code></pre></div><p>æ–¹æ¡ˆäºŒï¼š </p><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">1</span>ã€å…ˆæŸ¥æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„ <span class="hljs-selector-tag">Cookie</span> å¯¹è±¡ <span class="hljs-selector-tag">2</span>ã€è°ƒç”¨ <span class="hljs-selector-tag">setValue</span>()æ–¹æ³•èµ‹äºæ–°çš„ <span class="hljs-selector-tag">Cookie</span> å€¼ã€‚ <span class="hljs-selector-tag">3</span>ã€è°ƒç”¨ <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.addCookie</span>()é€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜ä¿®æ”¹</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java">Cookie cookie = CookieUtils.findCookie(<span class="hljs-string">&quot;key2&quot;</span>, req.getCookies());       <span class="hljs-keyword">if</span> (cookie != <span class="hljs-keyword">null</span>) &#123;           cookie.setValue(<span class="hljs-string">&quot;newValue2&quot;</span>);           resp.addCookie(cookie);       &#125;</code></pre></div><p> <strong>Cookie ç”Ÿå‘½æ§åˆ¶</strong></p><p>Cookie çš„ç”Ÿå‘½æ§åˆ¶æŒ‡çš„æ˜¯å¦‚ä½•ç®¡ç† Cookie ä»€ä¹ˆæ—¶å€™è¢«é”€æ¯ï¼ˆåˆ é™¤ï¼‰ </p><p><code>setMaxAge() </code></p><ul><li>æ­£æ•°ï¼Œè¡¨ç¤ºåœ¨æŒ‡å®šçš„ç§’æ•°åè¿‡æœŸ </li><li>è´Ÿæ•°ï¼Œè¡¨ç¤ºæµè§ˆå™¨ä¸€å…³ï¼ŒCookie å°±ä¼šè¢«åˆ é™¤ï¼ˆé»˜è®¤å€¼æ˜¯-1ï¼‰</li><li>é›¶ï¼Œè¡¨ç¤ºé©¬ä¸Šåˆ é™¤ Cookie</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">    * è®¾ç½®å­˜æ´»1ä¸ªå°æ—¶çš„Cooie</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">life3600</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;       Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;life3600&quot;</span>, <span class="hljs-string">&quot;life3600&quot;</span>);       cookie.setMaxAge(<span class="hljs-number">60</span> * <span class="hljs-number">60</span>); <span class="hljs-comment">// è®¾ç½®Cookieä¸€å°æ—¶ä¹‹åè¢«åˆ é™¤ã€‚æ— æ•ˆ</span>       resp.addCookie(cookie);       resp.getWriter().write(<span class="hljs-string">&quot;å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå­˜æ´»ä¸€å°æ—¶çš„Cookie&quot;</span>);   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * é©¬ä¸Šåˆ é™¤ä¸€ä¸ªCookie</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteNow</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;       <span class="hljs-comment">// å…ˆæ‰¾åˆ°ä½ è¦åˆ é™¤çš„Cookieå¯¹è±¡</span>       Cookie cookie = CookieUtils.findCookie(<span class="hljs-string">&quot;key4&quot;</span>, req.getCookies());       <span class="hljs-keyword">if</span> (cookie != <span class="hljs-keyword">null</span>) &#123;           <span class="hljs-comment">// è°ƒç”¨setMaxAge(0);</span>           cookie.setMaxAge(<span class="hljs-number">0</span>); <span class="hljs-comment">// è¡¨ç¤ºé©¬ä¸Šåˆ é™¤ï¼Œéƒ½ä¸éœ€è¦ç­‰å¾…æµè§ˆå™¨å…³é—­</span>           <span class="hljs-comment">// è°ƒç”¨response.addCookie(cookie);</span>           resp.addCookie(cookie);           resp.getWriter().write(<span class="hljs-string">&quot;key4çš„Cookieå·²ç»è¢«åˆ é™¤&quot;</span>);       &#125;   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * é»˜è®¤çš„ä¼šè¯çº§åˆ«çš„Cookie</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">defaultLife</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;       Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;defalutLife&quot;</span>,<span class="hljs-string">&quot;defaultLife&quot;</span>);       cookie.setMaxAge(-<span class="hljs-number">1</span>);<span class="hljs-comment">//è®¾ç½®å­˜æ´»æ—¶é—´</span>       resp.addCookie(cookie);   &#125;</code></pre></div><p><strong>Cookie æœ‰æ•ˆè·¯å¾„ Path çš„è®¾ç½®</strong></p><p>Cookie çš„ path å±æ€§å¯ä»¥æœ‰æ•ˆçš„è¿‡æ»¤å“ªäº› Cookie å¯ä»¥å‘é€ç»™æœåŠ¡å™¨ã€‚å“ªäº›ä¸å‘ã€‚ </p><p>path å±æ€§æ˜¯é€šè¿‡è¯·æ±‚çš„åœ°å€æ¥è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs routeros">CookieA <span class="hljs-attribute">path</span>=/å·¥ç¨‹è·¯å¾„ CookieB <span class="hljs-attribute">path</span>=/å·¥ç¨‹è·¯å¾„/abc</code></pre></div><p>è¯·æ±‚åœ°å€å¦‚ä¸‹ï¼š <a href="http://ip:port/å·¥ç¨‹è·¯å¾„/a.html">http://ip:port/å·¥ç¨‹è·¯å¾„/a.html</a> </p><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">CookieA</span> å‘é€ CookieB ä¸å‘é€</code></pre></div><p> <a href="http://ip:port/å·¥ç¨‹è·¯å¾„/abc/a.html">http://ip:port/å·¥ç¨‹è·¯å¾„/abc/a.html</a> </p><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">CookieA</span> å‘é€ CookieB å‘é€</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java">Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;path1&quot;</span>, <span class="hljs-string">&quot;path1&quot;</span>);    <span class="hljs-comment">// getContextPath() ===&gt;&gt;&gt;&gt;  å¾—åˆ°å·¥ç¨‹è·¯å¾„</span>    cookie.setPath( req.getContextPath() + <span class="hljs-string">&quot;/abc&quot;</span> ); <span class="hljs-comment">// ===&gt;&gt;&gt;&gt;  /å·¥ç¨‹è·¯å¾„/abc</span>    resp.addCookie(cookie);    resp.getWriter().write(<span class="hljs-string">&quot;åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰Pathè·¯å¾„çš„Cookie&quot;</span>);</code></pre></div><p> <strong>Cookie ç»ƒä¹ â€”å…è¾“å…¥ç”¨æˆ·åç™»å½•</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210419222822461-9168959.png" alt="image-20210419222822461"></p><p>login.jsp é¡µé¢</p><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;http://localhost:8080/13_cookie_session/loginServlet&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;ç”¨æˆ·åï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;username&quot;</span> value=<span class="hljs-string">&quot;$&#123;cookie.username.value&#125;&quot;</span>&gt; &lt;br&gt;å¯†ç ï¼š&lt;input type=<span class="hljs-string">&quot;password&quot;</span> name=<span class="hljs-string">&quot;password&quot;</span>&gt; &lt;br&gt;&lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ç™»å½•&quot;</span>&gt;&lt;/form&gt;</code></pre></div><p>LoginServlet </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;String username = req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);String password = req.getParameter(<span class="hljs-string">&quot;password&quot;</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;wzg168&quot;</span>.equals(username) &amp;&amp; <span class="hljs-string">&quot;123456&quot;</span>.equals(password)) &#123;<span class="hljs-comment">//ç™»å½• æˆåŠŸ</span>Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;username&quot;</span>, username);cookie.setMaxAge(<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>);<span class="hljs-comment">//å½“å‰ Cookie ä¸€å‘¨å†…æœ‰æ•ˆ</span>resp.addCookie(cookie);System.out.println(<span class="hljs-string">&quot;ç™»å½• æˆåŠŸ&quot;</span>);&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// ç™»å½• å¤±è´¥</span>System.out.println(<span class="hljs-string">&quot;ç™»å½• å¤±è´¥&quot;</span>);&#125;&#125;</code></pre></div><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p> <strong>ä»€ä¹ˆæ˜¯ Session ä¼šè¯?</strong></p><p>1ã€Session å°±ä¸€ä¸ªæ¥å£ï¼ˆHttpSessionï¼‰ã€‚ </p><p>2ã€Session å°±æ˜¯ä¼šè¯ã€‚å®ƒæ˜¯ç”¨æ¥ç»´æŠ¤ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å…³è”çš„ä¸€ç§æŠ€æœ¯ã€‚ </p><p>3ã€æ¯ä¸ªå®¢æˆ·ç«¯éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª Session ä¼šè¯ã€‚ </p><p>4ã€Session ä¼šè¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨æ¥ä¿å­˜ç”¨æˆ·ç™»å½•ä¹‹åçš„ä¿¡æ¯ã€‚</p><p> <strong>å¦‚ä½•åˆ›å»º Session å’Œè·å–(id å·,æ˜¯å¦ä¸ºæ–°)</strong></p><p>å¦‚ä½•åˆ›å»ºå’Œè·å– Sessionã€‚å®ƒä»¬çš„ API æ˜¯ä¸€æ ·çš„ã€‚ request.getSession() </p><ul><li><p>ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ï¼šåˆ›å»º Session ä¼šè¯ </p></li><li><p>ä¹‹åè°ƒç”¨éƒ½æ˜¯ï¼šè·å–å‰é¢åˆ›å»ºå¥½çš„ Session ä¼šè¯å¯¹è±¡ </p></li></ul><p>isNew(); åˆ¤æ–­åˆ°åº•æ˜¯ä¸æ˜¯åˆšåˆ›å»ºå‡ºæ¥çš„ï¼ˆæ–°çš„ï¼‰ </p><div class="hljs code-wrapper"><pre><code class="hljs actionscript"><span class="hljs-literal">true</span> è¡¨ç¤ºåˆšåˆ›å»º <span class="hljs-literal">false</span> è¡¨ç¤ºè·å–ä¹‹å‰åˆ›å»º</code></pre></div><p>æ¯ä¸ªä¼šè¯éƒ½æœ‰ä¸€ä¸ªèº«ä»½è¯å·ã€‚ä¹Ÿå°±æ˜¯ ID å€¼ã€‚è€Œä¸”è¿™ä¸ª ID æ˜¯å”¯ä¸€çš„ã€‚ </p><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getId</span><span class="hljs-params">()</span></span> å¾—åˆ° Session çš„ä¼šè¯ id å€¼ã€‚</code></pre></div><p><strong>Session åŸŸæ•°æ®çš„å­˜å–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">* å¾€ Session ä¸­ä¿å­˜æ•°æ®</span><span class="hljs-comment">* <span class="hljs-doctag">@param</span> req* <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">*/</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAttribute</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;req.getSession().setAttribute(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);resp.getWriter().write(<span class="hljs-string">&quot;å·²ç»å¾€ Session ä¸­ä¿å­˜äº†æ•°æ®&quot;</span>);&#125;<span class="hljs-comment">/**</span><span class="hljs-comment">* è·å– Session åŸŸä¸­çš„æ•°æ®</span><span class="hljs-comment">* <span class="hljs-doctag">@param</span> req</span><span class="hljs-comment">* <span class="hljs-doctag">@param</span> resp</span><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">*/</span><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAttribute</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;Object attribute = req.getSession().getAttribute(<span class="hljs-string">&quot;key1&quot;</span>);resp.getWriter().write(<span class="hljs-string">&quot;ä» Session ä¸­è·å–å‡º key1 çš„æ•°æ®æ˜¯ï¼š&quot;</span> + attribute);&#125;</code></pre></div><p> <strong>Session ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></p><p><code> public void setMaxInactiveInterval(int interval)</code> è®¾ç½® Session çš„è¶…æ—¶æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œè¶…è¿‡æŒ‡å®šçš„æ—¶é•¿ï¼ŒSession å°±ä¼šè¢«é”€æ¯ã€‚ </p><div class="hljs code-wrapper"><pre><code class="hljs pgsql">å€¼ä¸ºæ­£æ•°çš„æ—¶å€™ï¼Œè®¾å®š <span class="hljs-keyword">Session</span> çš„è¶…æ—¶æ—¶é•¿ã€‚ è´Ÿæ•°è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ï¼ˆæå°‘ä½¿ç”¨ï¼‰</code></pre></div><p><code>public int getMaxInactiveInterval()</code> è·å– Session çš„è¶…æ—¶æ—¶é—´ </p><p><code>public void invalidate()</code>  è®©å½“å‰ Session ä¼šè¯é©¬ä¸Šè¶…æ—¶æ— æ•ˆ</p><p>Session é»˜è®¤çš„è¶…æ—¶æ—¶é—´é•¿ä¸º 30 åˆ†é’Ÿ</p><p>å› ä¸ºåœ¨ Tomcat æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ web.xmlä¸­é»˜è®¤æœ‰ä»¥ä¸‹çš„é…ç½®ï¼Œå®ƒå°±è¡¨ç¤ºé…ç½®äº†å½“å‰ Tomcat æœåŠ¡å™¨ä¸‹æ‰€æœ‰çš„ Session è¶…æ—¶é…ç½®é»˜è®¤æ—¶é•¿ä¸ºï¼š30 åˆ†é’Ÿã€‚  </p><p>å¦‚æœè¯´ã€‚ä½ å¸Œæœ›ä½ çš„ web å·¥ç¨‹ï¼Œé»˜è®¤çš„ Session çš„è¶…æ—¶æ—¶é•¿ä¸ºå…¶ä»–æ—¶é•¿ã€‚ä½ å¯ä»¥åœ¨ä½ è‡ªå·±çš„ web.xml é…ç½®æ–‡ä»¶ä¸­åš ä»¥ä¸Šç›¸åŒçš„é…ç½®ã€‚å°±å¯ä»¥ä¿®æ”¹ä½ çš„ web å·¥ç¨‹æ‰€æœ‰ Seession çš„é»˜è®¤è¶…æ—¶æ—¶é•¿ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è¡¨ç¤ºå½“å‰ web å·¥ç¨‹ã€‚åˆ›å»ºå‡ºæ¥ çš„æ‰€æœ‰ Session é»˜è®¤æ˜¯ 20 åˆ†é’Ÿ è¶…æ—¶æ—¶é•¿--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">session-config</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">session-timeout</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">session-timeout</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">session-config</span>&gt;</span></code></pre></div><p>Session è¶…æ—¶çš„æ¦‚å¿µä»‹ç»ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210420170135655-9168959.png" alt="image-20210420170135655"></p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">life3</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;<span class="hljs-comment">// å…ˆè·å– Session å¯¹è±¡</span>HttpSession session = req.getSession();<span class="hljs-comment">// è®¾ç½®å½“å‰ Session3 ç§’åè¶…æ—¶</span>session.setMaxInactiveInterval(<span class="hljs-number">3</span>);resp.getWriter().write(<span class="hljs-string">&quot;å½“å‰ Session å·²ç»è®¾ç½®ä¸º 3 ç§’åè¶…æ—¶&quot;</span>);&#125;</code></pre></div><p>Session é©¬ä¸Šè¶…æ—¶ç¤ºä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteNow</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;<span class="hljs-comment">// å…ˆè·å– Session å¯¹è±¡</span>HttpSession session = req.getSession();<span class="hljs-comment">// è®© Session ä¼šè¯é©¬ä¸Šè¶…æ—¶</span>session.invalidate();resp.getWriter().write(<span class="hljs-string">&quot;Session å·²ç»è®¾ç½®ä¸ºè¶…æ—¶ï¼ˆæ— æ•ˆï¼‰&quot;</span>);&#125;</code></pre></div><p> <strong>æµè§ˆå™¨å’Œ Session ä¹‹é—´å…³è”çš„æŠ€æœ¯å†…å¹•</strong></p><p>Session æŠ€æœ¯ï¼Œåº•å±‚å…¶å®æ˜¯åŸºäº Cookie æŠ€æœ¯æ¥å®ç°çš„ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210420170339207-9168959.png" alt="image-20210420170339207"></p><h1 id="å…«ã€Filter"><a href="#å…«ã€Filter" class="headerlink" title="å…«ã€Filter"></a>å…«ã€Filter</h1><h2 id="ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨"><a href="#ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨"></a>ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨</h2><p>1ã€Filter è¿‡æ»¤å™¨å®ƒæ˜¯ JavaWeb çš„ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€ã€‚ä¸‰å¤§ç»„ä»¶åˆ†åˆ«æ˜¯ï¼šServlet ç¨‹åºã€Listener ç›‘å¬å™¨ã€Filter è¿‡æ»¤å™¨</p><p>2ã€Filter è¿‡æ»¤å™¨å®ƒæ˜¯ JavaEE çš„è§„èŒƒã€‚ä¹Ÿå°±æ˜¯æ¥å£ </p><p>3ã€Filter è¿‡æ»¤å™¨å®ƒçš„ä½œç”¨æ˜¯ï¼šæ‹¦æˆªè¯·æ±‚ï¼Œè¿‡æ»¤å“åº”ã€‚</p><p><strong>æ‹¦æˆªè¯·æ±‚å¸¸è§çš„åº”ç”¨åœºæ™¯æœ‰ï¼š</strong></p><p>1ã€æƒé™æ£€æŸ¥ </p><p>2ã€æ—¥è®°æ“ä½œ </p><p>3ã€äº‹åŠ¡ç®¡ç†</p><p><strong>Filter çš„åˆä½“éªŒ</strong></p><p>è¦æ±‚ï¼šåœ¨ä½ çš„ web å·¥ç¨‹ä¸‹ï¼Œæœ‰ä¸€ä¸ª admin ç›®å½•ã€‚è¿™ä¸ª admin ç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºï¼ˆhtml é¡µé¢ã€jpg å›¾ç‰‡ã€jsp æ–‡ä»¶ã€ç­‰ç­‰ï¼‰éƒ½å¿… é¡»æ˜¯ç”¨æˆ·ç™»å½•ä¹‹åæ‰å…è®¸è®¿é—®ã€‚ </p><p>æ€è€ƒï¼šæ ¹æ®ä¹‹å‰æˆ‘ä»¬å­¦è¿‡å†…å®¹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·ç™»å½•ä¹‹åéƒ½ä¼šæŠŠç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ä¿å­˜åˆ°SessionåŸŸä¸­ã€‚æ‰€ä»¥è¦æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¯ä»¥åˆ¤æ–­Sessionä¸­å¦åŒ…å«æœ‰ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯</p><div class="hljs code-wrapper"><pre><code class="hljs java">Object user = session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<span class="hljs-comment">// å¦‚æœç­‰äº nullï¼Œè¯´æ˜è¿˜æ²¡æœ‰ç™»å½•</span><span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) &#123;request.getRequestDispatcher(<span class="hljs-string">&quot;/login.jsp&quot;</span>).forward(request,response);<span class="hljs-keyword">return</span>;&#125;</code></pre></div><h2 id="Filter-çš„å·¥ä½œæµç¨‹å›¾"><a href="#Filter-çš„å·¥ä½œæµç¨‹å›¾" class="headerlink" title="Filter çš„å·¥ä½œæµç¨‹å›¾"></a>Filter çš„å·¥ä½œæµç¨‹å›¾</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210420171201652-9168959.png" alt="image-20210420171201652"></p><p>Filter ä»£ç :</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * doFilter æ–¹æ³•ï¼Œä¸“é—¨ç”¨äºæ‹¦æˆªè¯·æ±‚ã€‚å¯ä»¥åšæƒé™æ£€æŸ¥</span><span class="hljs-comment">    */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChainfilterChain)</span> <span class="hljs-keyword">throws</span> IOException,ServletException </span>&#123;   HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;    HttpSession session = httpServletRequest.getSession();    Object user = session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);    <span class="hljs-comment">// å¦‚æœç­‰äº nullï¼Œè¯´æ˜è¿˜æ²¡æœ‰ç™»å½•</span>    <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) &#123;    servletRequest.getRequestDispatcher(<span class="hljs-string">&quot;/login.jsp&quot;</span>).forward(servletRequest,servletResponse);    <span class="hljs-keyword">return</span>;    &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">// è®©ç¨‹åºç»§ç»­å¾€ä¸‹è®¿é—®ç”¨æˆ·çš„ç›®æ ‡èµ„æº</span>    filterChain.doFilter(servletRequest,servletResponse);    &#125;    &#125;&#125;</code></pre></div><p>web.xml ä¸­çš„é…ç½®ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--filter æ ‡ç­¾ç”¨äºé…ç½®ä¸€ä¸ª Filter è¿‡æ»¤å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>    <span class="hljs-comment">&lt;!--ç»™ filter èµ·ä¸€ä¸ªåˆ«å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>AdminFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>    <span class="hljs-comment">&lt;!--é…ç½® filter çš„å…¨ç±»å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.atguigu.filter.AdminFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><span class="hljs-comment">&lt;!--filter-mapping é…ç½® Filter è¿‡æ»¤å™¨çš„æ‹¦æˆªè·¯å¾„--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>    <span class="hljs-comment">&lt;!--filter-name è¡¨ç¤ºå½“å‰çš„æ‹¦æˆªè·¯å¾„ç»™å“ªä¸ª filter ä½¿ç”¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>AdminFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>    <span class="hljs-comment">&lt;!--url-pattern é…ç½®æ‹¦æˆªè·¯å¾„</span><span class="hljs-comment">    / è¡¨ç¤ºè¯·æ±‚åœ°å€ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/ æ˜ å°„åˆ° IDEA çš„ web ç›®å½•</span><span class="hljs-comment">    /admin/* è¡¨ç¤ºè¯·æ±‚åœ°å€ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/admin/*</span><span class="hljs-comment">    --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/admin/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span></code></pre></div><p>Filter è¿‡æ»¤å™¨çš„ä½¿ç”¨æ­¥éª¤ï¼š </p><p>1ã€ç¼–å†™ä¸€ä¸ªç±»å»å®ç° Filter æ¥å£ </p><p>2ã€å®ç°è¿‡æ»¤æ–¹æ³• doFilter() </p><p>3ã€åˆ° web.xml ä¸­å»é…ç½® Filter çš„æ‹¦æˆªè·¯å¾„</p><h2 id="Filter-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Filter-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Filter çš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>Filter çš„ç”Ÿå‘½å‘¨æœŸ</strong></h2><p>Filter çš„ç”Ÿå‘½å‘¨æœŸåŒ…å«å‡ ä¸ªæ–¹æ³• </p><ul><li><p>æ„é€ å™¨æ–¹æ³• </p></li><li><p>init åˆå§‹åŒ–æ–¹æ³• </p><ul><li>ç¬¬ 1ï¼Œ2 æ­¥ï¼Œåœ¨ web å·¥ç¨‹å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œï¼ˆFilter å·²ç»åˆ›å»ºï¼‰</li></ul></li><li><p>doFilter è¿‡æ»¤æ–¹æ³• </p><ul><li>ç¬¬ 3 æ­¥ï¼Œæ¯æ¬¡æ‹¦æˆªåˆ°è¯·æ±‚ï¼Œå°±ä¼šæ‰§è¡Œ</li></ul></li><li><p>destroy é”€æ¯ </p><ul><li>ç¬¬ 4 æ­¥ï¼Œåœæ­¢ web å·¥ç¨‹çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œï¼ˆåœæ­¢ web å·¥ç¨‹ï¼Œä¹Ÿä¼šé”€æ¯ Filter è¿‡æ»¤å™¨ï¼‰</li></ul></li></ul><h2 id="FilterConfig-ç±»"><a href="#FilterConfig-ç±»" class="headerlink" title="FilterConfig ç±»"></a><strong>FilterConfig ç±»</strong></h2><p>FilterConfig ç±»è§åçŸ¥ä¹‰ï¼Œå®ƒæ˜¯ Filter è¿‡æ»¤å™¨çš„é…ç½®æ–‡ä»¶ç±»ã€‚ </p><p>Tomcat æ¯æ¬¡åˆ›å»º Filter çš„æ—¶å€™ï¼Œä¹Ÿä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ª FilterConfig ç±»ï¼Œè¿™é‡ŒåŒ…å«äº† Filter é…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ã€‚ </p><p>FilterConfig ç±»çš„ä½œç”¨æ˜¯è·å– filter è¿‡æ»¤å™¨çš„é…ç½®å†…å®¹ </p><ul><li>è·å– Filter çš„åç§° filter-name çš„å†…å®¹</li><li>è·å–åœ¨ Filter ä¸­é…ç½®çš„ init-param åˆå§‹åŒ–å‚æ•° </li><li>è·å– ServletContext å¯¹è±¡</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;    System.out.println(<span class="hljs-string">&quot;2.Filter çš„ init(FilterConfig filterConfig)åˆå§‹åŒ–&quot;</span>);    <span class="hljs-comment">// 1ã€è·å– Filter çš„åç§° filter-name çš„å†…å®¹</span>    System.out.println(<span class="hljs-string">&quot;filter-name çš„å€¼æ˜¯ï¼š&quot;</span> + filterConfig.getFilterName());    <span class="hljs-comment">// 2ã€è·å–åœ¨ web.xml ä¸­é…ç½®çš„ init-param åˆå§‹åŒ–å‚æ•°</span>    System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–å‚æ•° username çš„å€¼æ˜¯ï¼š&quot;</span> + filterConfig.getInitParameter(<span class="hljs-string">&quot;username&quot;</span>));    System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–å‚æ•° url çš„å€¼æ˜¯ï¼š&quot;</span> + filterConfig.getInitParameter(<span class="hljs-string">&quot;url&quot;</span>));    <span class="hljs-comment">// 3ã€è·å– ServletContext å¯¹è±¡</span>    System.out.println(filterConfig.getServletContext());&#125;</code></pre></div><p>web.xml é…ç½®</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--filter æ ‡ç­¾ç”¨äºé…ç½®ä¸€ä¸ª Filter è¿‡æ»¤å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>    <span class="hljs-comment">&lt;!--ç»™ filter èµ·ä¸€ä¸ªåˆ«å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>AdminFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>    <span class="hljs-comment">&lt;!--é…ç½® filter çš„å…¨ç±»å--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.atguigu.filter.AdminFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>username<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>url<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>jdbc:mysql://localhost3306/test<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span></code></pre></div><h2 id="FilterChain-è¿‡æ»¤å™¨é“¾"><a href="#FilterChain-è¿‡æ»¤å™¨é“¾" class="headerlink" title="FilterChain è¿‡æ»¤å™¨é“¾"></a><strong>FilterChain è¿‡æ»¤å™¨é“¾</strong></h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210420172137716-9168959.png" alt="image-20210420172137716"></p><h2 id="Filter-çš„æ‹¦æˆªè·¯å¾„"><a href="#Filter-çš„æ‹¦æˆªè·¯å¾„" class="headerlink" title="Filter çš„æ‹¦æˆªè·¯å¾„"></a><strong>Filter çš„æ‹¦æˆªè·¯å¾„</strong></h2><p>ç²¾ç¡®åŒ¹é…</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/target.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>ä»¥ä¸Šé…ç½®çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€å¿…é¡»ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/target.jsp</code></pre></div><p>ç›®å½•åŒ¹é…</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/admin/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>ä»¥ä¸Šé…ç½®çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€å¿…é¡»ä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/admin/*</code></pre></div><p>åç¼€ååŒ¹é…</p><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.html<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>ä»¥ä¸Šé…ç½®çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€å¿…é¡»ä»¥.html ç»“å°¾æ‰ä¼šæ‹¦æˆªåˆ°<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.do<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>ä»¥ä¸Šé…ç½®çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€å¿…é¡»ä»¥.do ç»“å°¾æ‰ä¼šæ‹¦æˆªåˆ°<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.action<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>ä»¥ä¸Šé…ç½®çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€å¿…é¡»ä»¥.action ç»“å°¾æ‰ä¼šæ‹¦æˆªåˆ°</code></pre></div><h2 id="ä½¿ç”¨-Filterå’ŒThreadLocalç»„åˆç®¡ç†äº‹åŠ¡"><a href="#ä½¿ç”¨-Filterå’ŒThreadLocalç»„åˆç®¡ç†äº‹åŠ¡" class="headerlink" title="ä½¿ç”¨ Filterå’ŒThreadLocalç»„åˆç®¡ç†äº‹åŠ¡"></a><strong>ä½¿ç”¨ Filterå’ŒThreadLocalç»„åˆç®¡ç†äº‹åŠ¡</strong></h2><p>ä½¿ç”¨ ThreadLocal æ¥ç¡®ä¿æ‰€æœ‰ dao æ“ä½œéƒ½åœ¨åŒä¸€ä¸ª Connection è¿æ¥å¯¹è±¡ä¸­å®Œæˆ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425220820180.png" alt="image-20210425220820180"></p><p><strong>JdbcUtils å·¥å…·ç±»çš„ä¿®æ”¹</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221034230.png" alt="image-20210425221034230"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221121726.png" alt="image-20210425221121726"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221143361.png" alt="image-20210425221143361"></p><p><strong>ä¿®æ”¹ BaseDao</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221206385.png" alt="image-20210425221206385"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221232144.png" alt="image-20210425221232144"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221250908.png" alt="image-20210425221250908"></p><p><strong>ä½¿ç”¨ Filter è¿‡æ»¤å™¨ç»Ÿä¸€ç»™æ‰€æœ‰çš„ Service æ–¹æ³•éƒ½åŠ ä¸Š try-catchã€‚æ¥è¿›è¡Œå®ç°çš„ç®¡ç†</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221339475.png" alt="image-20210425221339475"></p><p><strong>Filter ç±»ä»£ç </strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221416401.png" alt="image-20210425221416401"></p><p><strong>åœ¨ web.xml ä¸­çš„é…ç½®</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221444049.png" alt="image-20210425221444049"></p><p><strong>è®°å¾—æŠŠ BaseServlet ä¸­çš„å¼‚å¸¸å¾€å¤–æŠ›ç»™ Filter è¿‡æ»¤å™¨</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221511723.png" alt="image-20210425221511723"></p><p><strong>å°†æ‰€æœ‰å¼‚å¸¸éƒ½ç»Ÿä¸€äº¤ç»™ Tomcatï¼Œè®© Tomcat å±•ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯é¡µé¢</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221540610.png" alt="image-20210425221540610"></p><h1 id="ä¹ã€Listener"><a href="#ä¹ã€Listener" class="headerlink" title="ä¹ã€Listener"></a>ä¹ã€Listener</h1><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ç›‘å¬å™¨ç”¨äºç›‘å¬Webåº”ç”¨ä¸­æŸäº›å¯¹è±¡çš„åˆ›å»ºã€é”€æ¯ã€å¢åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ç­‰åŠ¨ä½œçš„å‘ç”Ÿï¼Œç„¶åä½œå‡ºç›¸åº”çš„å“åº”å¤„ç†ã€‚å½“ç›‘å¬èŒƒå›´çš„å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚å¸¸ç”¨äºç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°ã€ç³»ç»ŸåŠ è½½æ—¶è¿›è¡Œä¿¡æ¯åˆå§‹åŒ–ã€ç»Ÿè®¡ç½‘ç«™çš„è®¿é—®é‡ç­‰ç­‰ã€‚</p><p>å®ç°ç›‘å¬ï¼š</p><ol><li>åˆ›å»ºç±»å®ç°ç›‘å¬å™¨æ¥å£</li><li><code>web.xml</code>æ–‡ä»¶ä¸­é…ç½®(æ³¨å†Œï¼‰ç›‘å¬å™¨<code>&lt;listener&gt; &lt;listener-class&gt;url&lt;/listener-class&gt;&lt;/listener&gt;</code> ï¼Œ<code>Servlet3.0</code>åå¯ä»¥é€šè¿‡æ³¨è§£@WebListener æ³¨å†Œç›‘å¬å™¨</li></ol><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210425221742885.png" alt="image-20210425221742885"></p><p>web.xml çš„åŠ è½½é¡ºåºæ˜¯ï¼šcontext- param -&gt; listener -&gt; filter -&gt; servlet</p><h2 id="Listenerç›‘å¬ä¸‰ä¸ªåŸŸå¯¹è±¡åˆ›å»ºä¸é”€æ¯"><a href="#Listenerç›‘å¬ä¸‰ä¸ªåŸŸå¯¹è±¡åˆ›å»ºä¸é”€æ¯" class="headerlink" title="Listenerç›‘å¬ä¸‰ä¸ªåŸŸå¯¹è±¡åˆ›å»ºä¸é”€æ¯"></a>Listenerç›‘å¬ä¸‰ä¸ªåŸŸå¯¹è±¡åˆ›å»ºä¸é”€æ¯</h2><p>ç›‘å¬<code>ServletContext</code>åŸŸå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯ï¼šå®ç°<code>ServletContextListener</code>æ¥å£ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebListener</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServletContextListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span></span>&#123;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–&quot;</span>);&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextDestroyed</span><span class="hljs-params">(ServletContextEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;é”€æ¯äº†&quot;</span>);&#125;&#125;</code></pre></div><p>ç›‘å¬<code>ServletRequest</code>åŸŸå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯ï¼šå®ç°<code>ServletRequestListener</code>æ¥å£ã€‚</p><p><code>ServletRequest</code>åŸŸå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">åˆ›å»ºï¼šè®¿é—®æœåŠ¡å™¨ä»»ä½•èµ„æºéƒ½ä¼šå‘é€è¯·æ±‚<span class="hljs-params">(ServletRequest)</span>å‡ºç°,è®¿é—®<span class="hljs-string">.html</span>å’Œ<span class="hljs-string">.jsp</span>å’Œ<span class="hljs-string">.servlet</span>éƒ½ä¼šåˆ›å»ºè¯·æ±‚é”€æ¯ï¼šæœåŠ¡å™¨å·²ç»å¯¹è¯¥æ¬¡è¯·æ±‚åšå‡ºäº†å“åº”</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebListener</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServletRequestListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletRequestListener</span></span>&#123;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;ServletRequesté”€æ¯äº†&quot;</span>);&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestInitialized</span><span class="hljs-params">(ServletRequestEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;ServletRequeståˆ›å»ºäº†&quot;</span>);&#125;&#125;</code></pre></div><p>ç›‘å¬<code>HttpSession</code>åŸŸå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯ï¼šå®ç°<code>HttpSessionListener</code>æ¥å£ï¼š<br><code>HttpSession</code>åŸŸå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs less">åˆ›å»ºï¼šåªè¦è°ƒç”¨äº†<span class="hljs-selector-tag">getSession</span>()æ–¹æ³•å°±ä¼šåˆ›å»ºï¼Œä¸€æ¬¡ä¼šè¯åªä¼šåˆ›å»ºä¸€æ¬¡é”€æ¯ï¼š<span class="hljs-selector-tag">1</span>.è¶…æ—¶(é»˜è®¤ä¸º<span class="hljs-number">30</span>åˆ†é’Ÿ)<span class="hljs-selector-tag">2</span>.éæ­£å¸¸å…³é—­ï¼Œé”€æ¯<span class="hljs-selector-tag">3</span>.æ­£å¸¸å…³é—­æœåŠ¡å™¨(åºåˆ—åŒ–)</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@WebListener</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHttpSessionListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpSessionListener</span></span>&#123;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionCreated</span><span class="hljs-params">(HttpSessionEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;HttpSessionåˆ›å»ºäº†&quot;</span>);&#125;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sessionDestroyed</span><span class="hljs-params">(HttpSessionEvent arg0)</span> </span>&#123;System.out.println(<span class="hljs-string">&quot;HTTPSessioné”€æ¯äº†&quot;</span>);&#125;&#125;</code></pre></div><h1 id="åã€JSON"><a href="#åã€JSON" class="headerlink" title="åã€JSON"></a>åã€JSON</h1><h2 id="ä»€ä¹ˆæ˜¯-JSON"><a href="#ä»€ä¹ˆæ˜¯-JSON" class="headerlink" title="ä»€ä¹ˆæ˜¯ JSON?"></a>ä»€ä¹ˆæ˜¯ JSON?</h2><p> JSON (JavaScript Object Notation) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚JSON é‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œè€Œä¸”å¾ˆå¤šè¯­è¨€éƒ½æä¾›äº†å¯¹ json çš„æ”¯æŒï¼ˆåŒ…æ‹¬ C, C++, C#, Java, JavaScript, Perl, Python ç­‰ï¼‰ã€‚ è¿™æ ·å°±ä½¿å¾— JSON æˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚</p><p> json æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ </p><ul><li><p>è½»é‡çº§æŒ‡çš„æ˜¯è·Ÿ xml åšæ¯”è¾ƒ</p></li><li><p>æ•°æ®äº¤æ¢æŒ‡çš„æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¸šåŠ¡æ•°æ®çš„ä¼ é€’æ ¼å¼</p></li></ul><h2 id="JSON-åœ¨-JavaScript-ä¸­çš„ä½¿ç”¨"><a href="#JSON-åœ¨-JavaScript-ä¸­çš„ä½¿ç”¨" class="headerlink" title="JSON åœ¨ JavaScript ä¸­çš„ä½¿ç”¨"></a>JSON åœ¨ JavaScript ä¸­çš„ä½¿ç”¨</h2><p><strong>json çš„å®šä¹‰</strong></p><p>json æ˜¯ç”±é”®å€¼å¯¹ç»„æˆï¼Œå¹¶ä¸”ç”±èŠ±æ‹¬å·ï¼ˆå¤§æ‹¬å·ï¼‰åŒ…å›´ã€‚æ¯ä¸ªé”®ç”±å¼•å·å¼•èµ·æ¥ï¼Œé”®å’Œå€¼ä¹‹é—´ä½¿ç”¨å†’å·è¿›è¡Œåˆ†éš”ï¼Œ å¤šç»„é”®å€¼å¯¹ä¹‹é—´è¿›è¡Œé€—å·è¿›è¡Œåˆ†éš”ã€‚</p><p>json å®šä¹‰ç¤ºä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> jsonObj = &#123;    <span class="hljs-string">&quot;key1&quot;</span>:<span class="hljs-number">12</span>,    <span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;abc&quot;</span>,    <span class="hljs-string">&quot;key3&quot;</span>:<span class="hljs-literal">true</span>,    <span class="hljs-string">&quot;key4&quot;</span>:[<span class="hljs-number">11</span>,<span class="hljs-string">&quot;arr&quot;</span>,<span class="hljs-literal">false</span>],    <span class="hljs-string">&quot;key5&quot;</span>:&#123;        <span class="hljs-string">&quot;key5_1&quot;</span> : <span class="hljs-number">551</span>,        <span class="hljs-string">&quot;key5_2&quot;</span> : <span class="hljs-string">&quot;key5_2_value&quot;</span>&#125;,    <span class="hljs-string">&quot;key6&quot;</span>:[&#123;        <span class="hljs-string">&quot;key6_1_1&quot;</span>:<span class="hljs-number">6611</span>,        <span class="hljs-string">&quot;key6_1_2&quot;</span>:<span class="hljs-string">&quot;key6_1_2_value&quot;</span>&#125;,&#123;        <span class="hljs-string">&quot;key6_2_1&quot;</span>:<span class="hljs-number">6621</span>,        <span class="hljs-string">&quot;key6_2_2&quot;</span>:<span class="hljs-string">&quot;key6_2_2_value&quot;</span>    &#125;]&#125;;</code></pre></div><p><strong>jsonçš„è®¿é—®</strong></p><p>json æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ </p><p>json ä¸­çš„ key æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ˜¯å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚ </p><p>json ä¸­çš„ key è®¿é—®å°±è·Ÿè®¿é—®å¯¹è±¡çš„å±æ€§ä¸€æ ·ï¼š json å¯¹è±¡.key </p><p>jsonè®¿é—®ç¤ºä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs javascript">alert(<span class="hljs-keyword">typeof</span>(jsonObj));<span class="hljs-comment">// object json å°±æ˜¯ä¸€ä¸ªå¯¹è±¡</span>alert(jsonObj.key1); <span class="hljs-comment">//12</span>alert(jsonObj.key2); <span class="hljs-comment">// abc</span>alert(jsonObj.key3); <span class="hljs-comment">// true</span>alert(jsonObj.key4);<span class="hljs-comment">// å¾—åˆ°æ•°ç»„[11,&quot;arr&quot;,false]</span><span class="hljs-comment">// json ä¸­ æ•°ç»„å€¼çš„éå†</span><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; jsonObj.key4.length; i++) &#123;alert(jsonObj.key4[i]);&#125;alert(jsonObj.key5.key5_1);<span class="hljs-comment">//551</span>alert(jsonObj.key5.key5_2);<span class="hljs-comment">//key5_2_value</span>alert( jsonObj.key6 );<span class="hljs-comment">// å¾—åˆ° json æ•°ç»„</span><span class="hljs-comment">// å–å‡ºæ¥æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ json å¯¹è±¡</span><span class="hljs-keyword">var</span> jsonItem = jsonObj.key6[<span class="hljs-number">0</span>];<span class="hljs-comment">// alert( jsonItem.key6_1_1 ); //6611</span>alert( jsonItem.key6_1_2 ); <span class="hljs-comment">//key6_1_2_value</span></code></pre></div><h2 id="json-çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•"><a href="#json-çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•" class="headerlink" title="json çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•"></a><strong>json çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•</strong></h2><ul><li><p>JSON.stringify() æŠŠ json å¯¹è±¡è½¬æ¢æˆä¸º json å­—ç¬¦ä¸²</p></li><li><p>JSON.parse() æŠŠ json å­—ç¬¦ä¸²è½¬æ¢æˆä¸º json å¯¹è±¡</p></li></ul><p><strong>json çš„å­˜åœ¨æœ‰ä¸¤ç§å½¢å¼ã€‚</strong></p><ul><li><p> ä¸€ç§æ˜¯ï¼šå¯¹è±¡çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬å«å®ƒ json å¯¹è±¡ã€‚ </p></li><li><p>ä¸€ç§æ˜¯ï¼šå­—ç¬¦ä¸²çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬å«å®ƒ json å­—ç¬¦ä¸²ã€‚</p></li><li><p> ä¸€èˆ¬æˆ‘ä»¬è¦æ“ä½œ json ä¸­çš„æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ json å¯¹è±¡çš„æ ¼å¼ã€‚</p></li><li><p>ä¸€èˆ¬æˆ‘ä»¬è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢çš„æ—¶å€™ï¼Œä½¿ç”¨ json å­—ç¬¦ä¸²ã€‚</p></li></ul><h2 id="JSON-åœ¨-java-ä¸­çš„ä½¿ç”¨"><a href="#JSON-åœ¨-java-ä¸­çš„ä½¿ç”¨" class="headerlink" title="JSON åœ¨ java ä¸­çš„ä½¿ç”¨"></a><strong>JSON åœ¨ java ä¸­çš„ä½¿ç”¨</strong></h2><p>jackson fastjson Gson </p><p><strong>JSONä»‹ç»</strong></p><p><strong>Javaâ€“&gt;json</strong></p><p>å°†ä¸€ä¸ªç±»ä»¥jsonå­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å°†ä¸€ä¸ªç±»ä»¥jsonå­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡º</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;      <span class="hljs-comment">//ä½¿ç”¨Jacksonçš„ObjectMapper</span>        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();        User user = <span class="hljs-keyword">new</span> User();        user.setMoney(<span class="hljs-number">1000</span>);        user.setUsername(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);        user.setPassword(<span class="hljs-string">&quot;123&quot;</span>);        <span class="hljs-keyword">try</span> &#123;            System.out.println(mapper.writeValueAsString(user));        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;</code></pre></div><p>ä»¥jsonå­—ç¬¦ä¸²è¾“å‡ºä¸€ä¸ªListé›†åˆï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();    List&lt;User&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;User&gt;();    User u = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-number">1000</span>);    list.add(u);    u = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;æå››&quot;</span>, <span class="hljs-string">&quot;456&quot;</span>, <span class="hljs-number">2000</span>);    list.add(u);    u = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;ç‹äº”&quot;</span>, <span class="hljs-string">&quot;789&quot;</span>, <span class="hljs-number">3000</span>);    list.add(u);    u = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;èµµå…­&quot;</span>, <span class="hljs-string">&quot;555&quot;</span>, <span class="hljs-number">4000</span>);    list.add(u);    <span class="hljs-keyword">try</span> &#123;        System.out.println(mapper.writeValueAsString(list));    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;        <span class="hljs-comment">// TODO Auto-generated catch block</span>        e.printStackTrace();    &#125;&#125;</code></pre></div><p>å°†ä¸€ä¸ªMapä»¥jsonå­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span></span>&#123;    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();    Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;();    map.put(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);    map.put(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);    <span class="hljs-keyword">try</span> &#123;        System.out.println(mapper.writeValueAsString(map));    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><p><strong>Jsonâ€“&gt;java</strong></p><p>jsonå­—ç¬¦ä¸²è½¬ä¸ºjavaBean</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test5</span><span class="hljs-params">()</span></span>&#123;    String str = <span class="hljs-string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;ä¸‰å›½æ¼”ä¹‰\&quot;,\&quot;price\&quot;:20,\&quot;author\&quot;:\&quot;ç½—è´¯ä¸­\&quot;,\&quot;detail\&quot;:&#123;\&quot;pressTime\&quot;:\&quot;2001-01-01\&quot;,\&quot;storyTime\&quot;:\&quot;196-05-06\&quot;&#125;,\&quot;attribute\&quot;:&#123;\&quot;category\&quot;:\&quot;å°è¯´\&quot;,\&quot;edition\&quot;:\&quot;9\&quot;&#125;&#125;&quot;</span>;    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();    <span class="hljs-keyword">try</span> &#123;        Book book = mapper.readValue(str, Book.class);        System.out.println(book.getAuthor()+<span class="hljs-string">&quot;,&quot;</span>+book.getAttribute().getCategory());    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><p>jsonå­—ç¬¦ä¸²è½¬ä¸ºList</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//json--&gt;List</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test6</span><span class="hljs-params">()</span></span>&#123;        String str = <span class="hljs-string">&quot;[&#123;\&quot;username\&quot;:\&quot;å¼ ä¸‰\&quot;,\&quot;password\&quot;:\&quot;123\&quot;,\&quot;money\&quot;:1000&#125;,&#123;\&quot;username\&quot;:\&quot;æå››\&quot;,\&quot;password\&quot;:\&quot;456\&quot;,\&quot;money\&quot;:2000&#125;,&#123;\&quot;username\&quot;:\&quot;ç‹äº”\&quot;,\&quot;password\&quot;:\&quot;789\&quot;,\&quot;money\&quot;:3000&#125;,&#123;\&quot;username\&quot;:\&quot;èµµå…­\&quot;,\&quot;password\&quot;:\&quot;555\&quot;,\&quot;money\&quot;:4000&#125;]&quot;</span>;        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();        <span class="hljs-keyword">try</span> &#123;            List&lt;User&gt; us = mapper.readValue(str, <span class="hljs-keyword">new</span> TypeReference&lt;ArrayList&lt;User&gt;&gt;() &#123;&#125;);            <span class="hljs-keyword">for</span> (User user : us) &#123;                System.out.println(user.getUsername()+<span class="hljs-string">&quot;,&quot;</span>+user.getMoney());            &#125;        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;</code></pre></div><p>jsonå­—ç¬¦ä¸²è½¬ä¸ºMapï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//json--&gt;map</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test7</span><span class="hljs-params">()</span></span>&#123;    String str = <span class="hljs-string">&quot;&#123;\&quot;password\&quot;:\&quot;888888\&quot;,\&quot;username\&quot;:\&quot;æå››\&quot;&#125;&quot;</span>;    ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();    <span class="hljs-keyword">try</span> &#123;        Map&lt;String, String&gt; map = mapper.readValue(str, <span class="hljs-keyword">new</span> TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;&#125;);        <span class="hljs-keyword">for</span> (String key : map.keySet()) &#123;            System.out.println(key+<span class="hljs-string">&quot;,&quot;</span>+map.get(key));        &#125;    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><h1 id="åä¸€ã€Ajax"><a href="#åä¸€ã€Ajax" class="headerlink" title="åä¸€ã€Ajax"></a>åä¸€ã€Ajax</h1><h2 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>AJAXå³â€œAsynchronous Javascript And XMLâ€(å¼‚æ­¥JavaScriptå’ŒXML)ï¼Œæ˜¯æŒ‡ä¸€ç§åˆ›å»ºäº¤äº’å¼ç½‘é¡µåº”ç”¨çš„ç½‘é¡µå¼€å‘æŠ€æœ¯</p><ul><li><strong>ajax æ˜¯ä¸€ç§æµè§ˆå™¨é€šè¿‡ js å¼‚æ­¥å‘èµ·è¯·æ±‚ï¼Œå±€éƒ¨æ›´æ–°é¡µé¢çš„æŠ€æœ¯</strong></li><li>ajax è¯·æ±‚çš„å±€éƒ¨æ›´æ–°ï¼Œæµè§ˆå™¨åœ°å€æ ä¸ä¼šå‘ç”Ÿå˜åŒ– å±€éƒ¨æ›´æ–°ä¸ä¼šèˆå¼ƒåŸæ¥é¡µé¢çš„å†…å®¹</li></ul><p><strong>ä¼ ç»Ÿè¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚</strong></p><ul><li>åŸºäºè¶…çº§é“¾æ¥ åœ°å€æ  formè¡¨å• åœ°å€æ  location.href å‘èµ·çš„è¯·æ±‚å…¨éƒ¨æ˜¯ä¼ ç»Ÿè¯·æ±‚<br>  ç‰¹ç‚¹: è¯·æ±‚ä¹‹å,åˆ·æ–°æ•´å¼ é¡µé¢<br>  ç¼ºç‚¹: ç”±äºåˆ·æ–°äº†æ•´å¼ é¡µé¢,ç”¨æˆ·æ“ä½œè¢«ä¸­æ–­,é€ æˆå¤§é‡ç½‘ç»œæµé‡çš„æå¤§æµªè´¹ã€‚</li><li>åŸºäºajaxå‘èµ·çš„è¯·æ±‚éƒ½æ˜¯å¼‚æ­¥è¯·æ±‚<br>  ç‰¹ç‚¹: å¤šä¸ªè¯·æ±‚å¹¶è¡Œå‘ç”Ÿ,è¯·æ±‚ä¹‹é—´äº’ä¸å½±å“,è¯·æ±‚ä¹‹åé¡µé¢ä¸åŠ¨,åˆ·æ–°é¡µé¢çš„å±€éƒ¨</li></ul><p><strong>ä¼ ç»Ÿç½‘ç«™ä¸­å­˜åœ¨çš„é—®é¢˜</strong></p><ul><li>ç½‘é€Ÿæ…¢çš„æƒ…å†µä¸‹ï¼Œé¡µé¢åŠ è½½æ—¶é—´é•¿ï¼Œç”¨æˆ·åªèƒ½ç­‰å¾…</li><li>è¡¨å•æäº¤åï¼Œå¦‚æœä¸€é¡¹å†…å®¹ä¸åˆæ ¼ï¼Œéœ€è¦é‡æ–°å¡«å†™æ‰€æœ‰è¡¨å•å†…å®¹</li><li>é¡µé¢è·³è½¬ï¼Œé‡æ–°åŠ è½½é¡µé¢ï¼Œé€ æˆèµ„æºæµªè´¹ï¼Œå¢åŠ ç”¨æˆ·ç­‰å¾…æ—¶é—´</li></ul><p><strong>Ajax çš„åº”ç”¨åœºæ™¯</strong></p><ul><li>é¡µé¢ä¸Šæ‹‰åŠ è½½æ›´å¤šæ•°æ®</li><li>åˆ—è¡¨æ•°æ®æ— åˆ·æ–°åˆ†é¡µ</li><li>è¡¨å•é¡¹ç¦»å¼€ç„¦ç‚¹æ•°æ®éªŒè¯</li><li>æœç´¢æ¡†æç¤ºæ–‡å­—ä¸‹æ‹‰åˆ—è¡¨</li></ul><p><strong>Ajax è¿è¡ŒåŸç†</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210426102426443.png" alt="image-20210426102426443"></p><p><strong>æ ¸å¿ƒå¯¹è±¡</strong></p><p><code>XMLHttpRequest </code>å¯¹è±¡æ˜¯ä¸€ä¸ªjavascriptå¯¹è±¡ï¼Œå­˜åœ¨ç€æµè§ˆå™¨å·®å¼‚ã€‚ç®€ç§°xhrå¯¹è±¡</p><h2 id="Ajaxå…¥é—¨"><a href="#Ajaxå…¥é—¨" class="headerlink" title="Ajaxå…¥é—¨"></a><strong>Ajaxå…¥é—¨</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"><span class="hljs-comment">// 1.åˆ›å»ºajaxå¯¹è±¡</span></span><span class="javascript"><span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();</span><span class="javascript"><span class="hljs-comment">// 2.å‘Šè¯‰Ajaxå¯¹è±¡è¦å‘å“ªå‘é€è¯·æ±‚ï¼Œä»¥ä»€ä¹ˆæ–¹å¼å‘é€è¯·æ±‚</span></span><span class="javascript"><span class="hljs-comment">// 1)è¯·æ±‚æ–¹å¼ 2)è¯·æ±‚åœ°å€</span></span><span class="javascript">xhr.open(<span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;http://localhost:3000/first&#x27;</span>);</span><span class="javascript"><span class="hljs-comment">// 3.å‘é€è¯·æ±‚</span></span>xhr.send();<span class="javascript"><span class="hljs-comment">// 4.è·å–æœåŠ¡å™¨ç«¯å“åº”åˆ°å®¢æˆ·ç«¯çš„æ•°æ®</span></span><span class="javascript">xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;</span><span class="javascript"><span class="hljs-built_in">console</span>.log(xhr.responseText)</span>&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="Ajax-çŠ¶æ€ç "><a href="#Ajax-çŠ¶æ€ç " class="headerlink" title="Ajax çŠ¶æ€ç "></a><strong>Ajax çŠ¶æ€ç </strong></h2><p>åœ¨åˆ›å»ºajaxå¯¹è±¡ï¼Œé…ç½®ajaxå¯¹è±¡ï¼Œå‘é€è¯·æ±‚ï¼Œä»¥åŠæ¥æ”¶å®ŒæœåŠ¡å™¨ç«¯å“åº”æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ­¥éª¤éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ•°å€¼ï¼Œè¿™ä¸ªæ•°å€¼å°±æ˜¯ajaxçŠ¶æ€ç ã€‚</p><blockquote><p>0ï¼šè¯·æ±‚æœªåˆå§‹åŒ–(è¿˜æ²¡æœ‰è°ƒç”¨open())<br>1ï¼šè¯·æ±‚å·²ç»å»ºç«‹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å‘é€(è¿˜æ²¡æœ‰è°ƒç”¨send())<br>2ï¼šè¯·æ±‚å·²ç»å‘é€<br>3ï¼šè¯·æ±‚æ­£åœ¨å¤„ç†ä¸­ï¼Œé€šå¸¸å“åº”ä¸­å·²ç»æœ‰éƒ¨åˆ†æ•°æ®å¯ä»¥ç”¨äº†<br>4ï¼šå“åº”å·²ç»å®Œæˆï¼Œå¯ä»¥è·å–å¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å“åº”äº†<br>xhr.readyState // è·å–AjaxçŠ¶æ€ç </p></blockquote><h2 id="onreadystatechange-äº‹ä»¶"><a href="#onreadystatechange-äº‹ä»¶" class="headerlink" title="onreadystatechange äº‹ä»¶"></a><strong>onreadystatechange äº‹ä»¶</strong></h2><p>å½“ Ajax çŠ¶æ€ç å‘ç”Ÿå˜åŒ–æ—¶å°†è‡ªåŠ¨è§¦å‘è¯¥äº‹ä»¶ã€‚<br>åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¯ä»¥è·å– Ajax çŠ¶æ€ç å¹¶å¯¹å…¶è¿›è¡Œåˆ¤æ–­ï¼Œå½“çŠ¶æ€ç ä¸º 4 æ—¶å°±å¯ä»¥é€šè¿‡ xhr.responseText è·å–æœåŠ¡å™¨ç«¯çš„å“åº”æ•°æ®äº†ã€‚</p><p>ä¸æ¨è,å› ä¸ºè¿™ç§æ–¹å¼ä¼šç”±äºçŠ¶æ€ç çš„å˜åŒ–è¢«è§¦å‘å¤šæ¬¡,æ•ˆç‡ä½.æ¨èä½¿ç”¨onloadè¿™ç§æ–¹å¼.å”¯ä¸€ä¸è¶³å°±æ˜¯ä¸å…¼å®¹ä½ç‰ˆæœ¬IEæµè§ˆå™¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210426104807866.png" alt="image-20210426104807866"></p><h2 id="åŸç”Ÿ-ajax-è¯·æ±‚çš„ç¤ºä¾‹"><a href="#åŸç”Ÿ-ajax-è¯·æ±‚çš„ç¤ºä¾‹" class="headerlink" title="åŸç”Ÿ ajax è¯·æ±‚çš„ç¤ºä¾‹"></a><strong>åŸç”Ÿ ajax è¯·æ±‚çš„ç¤ºä¾‹</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs jsp">&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;&lt;html&gt;&lt;head&gt;    &lt;meta http-equiv=<span class="hljs-string">&quot;pragma&quot;</span> content=<span class="hljs-string">&quot;no-cache&quot;</span> /&gt;    &lt;meta http-equiv=<span class="hljs-string">&quot;cache-control&quot;</span> content=<span class="hljs-string">&quot;no-cache&quot;</span> /&gt;    &lt;meta http-equiv=<span class="hljs-string">&quot;Expires&quot;</span> content=<span class="hljs-string">&quot;0&quot;</span> /&gt;    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;    &lt;title&gt;Insert title here&lt;/title&gt;    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<span class="hljs-comment">// åœ¨è¿™é‡Œä½¿ç”¨ javaScript è¯­è¨€å‘èµ· Ajax è¯·æ±‚ï¼Œè®¿é—®æœåŠ¡å™¨ AjaxServlet ä¸­ javaScriptAjax</span><span class="hljs-function">function <span class="hljs-title">ajaxRequest</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-comment">// 1ã€æˆ‘ä»¬é¦–å…ˆè¦åˆ›å»º XMLHttpRequest</span>            <span class="hljs-keyword">var</span> xmlhttprequest = <span class="hljs-keyword">new</span> XMLHttpRequest();            <span class="hljs-comment">// 2ã€è°ƒç”¨ open æ–¹æ³•è®¾ç½®è¯·æ±‚å‚æ•°</span>      xmlhttprequest.open(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet?action=javaScriptAjax&quot;</span>,<span class="hljs-keyword">true</span>)            <span class="hljs-comment">// 4ã€åœ¨ send æ–¹æ³•å‰ç»‘å®š onreadystatechange äº‹ä»¶ï¼Œå¤„ç†è¯·æ±‚å®Œæˆåçš„æ“ä½œã€‚</span>            xmlhttprequest.onreadystatechange = function()&#123;                <span class="hljs-keyword">if</span> (xmlhttprequest.readyState == <span class="hljs-number">4</span> &amp;&amp; xmlhttprequest.status == <span class="hljs-number">200</span>) &#123;                    <span class="hljs-keyword">var</span> jsonObj = JSON.parse(xmlhttprequest.responseText);                    <span class="hljs-comment">// æŠŠå“åº”çš„æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</span>                    document.getElementById(<span class="hljs-string">&quot;div01&quot;</span>).innerHTML = <span class="hljs-string">&quot;ç¼–å·ï¼š&quot;</span> + jsonObj.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> +jsonObj.name;                &#125;            &#125;            <span class="hljs-comment">// 3ã€è°ƒç”¨ send æ–¹æ³•å‘é€è¯·æ±‚</span>            xmlhttprequest.send();&#125;    &lt;/script&gt;   &lt;/head&gt;    &lt;body&gt;    &lt;button onclick=&quot;ajaxRequest()&quot;&gt;ajax request&lt;/button&gt;    &lt;div id=<span class="hljs-string">&quot;div01&quot;</span>&gt;    &lt;/div&gt;    &lt;/body&gt;   &lt;/html&gt;</code></pre></div><h2 id="å‘é€GETæ–¹å¼è¯·æ±‚"><a href="#å‘é€GETæ–¹å¼è¯·æ±‚" class="headerlink" title="å‘é€GETæ–¹å¼è¯·æ±‚"></a><strong>å‘é€GETæ–¹å¼è¯·æ±‚</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//1. åˆ›å»ºxhrå¯¹è±¡</span><span class="hljs-keyword">var</span> xhr ; <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.XMLHttpRequest)&#123;xhr = <span class="hljs-keyword">new</span> XMLHttpRequest(); &#125;<span class="hljs-keyword">else</span>&#123;xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;Microsoft.XMLHTTP&quot;</span>); &#125;<span class="hljs-comment">//2.å‘é€è¯·æ±‚,å¹¶ä¼ é€’å‚æ•°</span>xhr.open(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;/ajax_day2/test?name=zhangsan&quot;</span>);xhr.send();<span class="hljs-comment">//3.å¤„ç†å“åº”</span>xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;   <span class="hljs-keyword">if</span>(xhr.readyState==<span class="hljs-number">4</span> &amp;&amp; xhr.status==<span class="hljs-number">200</span>)&#123;     <span class="hljs-built_in">console</span>.log(xhr.responseText); &#125;&#125;</code></pre></div><h2 id="å‘é€POSTæ–¹å¼è¯·æ±‚"><a href="#å‘é€POSTæ–¹å¼è¯·æ±‚" class="headerlink" title="å‘é€POSTæ–¹å¼è¯·æ±‚"></a><strong>å‘é€POSTæ–¹å¼è¯·æ±‚</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">//1. åˆ›å»ºxhrå¯¹è±¡</span><span class="hljs-keyword">var</span> xhr; <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.XMLHttpRequest)&#123;xhr = <span class="hljs-keyword">new</span> XMLHttpRequest(); &#125;<span class="hljs-keyword">else</span>&#123;xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;Microsoft.XMLHTTP&quot;</span>); &#125;<span class="hljs-comment">//2.å‘é€è¯·æ±‚,å¹¶ä¼ é€’å‚æ•°</span>xhr.open(<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;/ajax_day2/test&quot;</span>);xhr.setRequestHeader(<span class="hljs-string">&quot;content-type&quot;</span>, <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>); xhr.send(<span class="hljs-string">&quot;name=zhangsan&quot;</span>);<span class="hljs-comment">//3.å¤„ç†å“åº”</span>xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span>(xhr.readyState==<span class="hljs-number">4</span> &amp;&amp; xhr.status==<span class="hljs-number">200</span>)&#123; <span class="hljs-built_in">console</span>.log(xhr.reponseText);&#125; &#125;</code></pre></div><h2 id="Ajaxçš„æ•°æ®äº¤æ¢æœºåˆ¶"><a href="#Ajaxçš„æ•°æ®äº¤æ¢æœºåˆ¶" class="headerlink" title="Ajaxçš„æ•°æ®äº¤æ¢æœºåˆ¶"></a><strong>Ajaxçš„æ•°æ®äº¤æ¢æœºåˆ¶</strong></h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210426110333170.png" alt="image-20210426110333170"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210426110704108.png" alt="image-20210426110704108"></p><h2 id="Ajaxå‡½æ•°å°è£…"><a href="#Ajaxå‡½æ•°å°è£…" class="headerlink" title="Ajaxå‡½æ•°å°è£…"></a><strong>Ajaxå‡½æ•°å°è£…</strong></h2><p>é—®é¢˜ï¼šå‘é€ä¸€æ¬¡è¯·æ±‚ä»£ç è¿‡å¤šï¼Œå‘é€å¤šæ¬¡è¯·æ±‚ä»£ç å†—ä½™ä¸”é‡å¤<br>è§£å†³æ–¹æ¡ˆï¼šå°†è¯·æ±‚ä»£ç å°è£…åˆ°å‡½æ•°ä¸­ï¼Œå‘è¯·æ±‚æ—¶è°ƒç”¨å‡½æ•°å³å¯</p><p>åˆ©ç”¨å›è°ƒå‡½æ•°</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210426112409636.png" alt="image-20210426112409636"></p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ajax</span> (<span class="hljs-params">options</span>) </span>&#123;</span><span class="javascript"><span class="hljs-comment">// å­˜å‚¨çš„æ˜¯é»˜è®¤å€¼</span></span><span class="javascript"><span class="hljs-keyword">var</span> defaults = &#123;</span><span class="javascript">type: <span class="hljs-string">&#x27;get&#x27;</span>,</span><span class="javascript">url: <span class="hljs-string">&#x27;&#x27;</span>,</span>data: &#123;&#125;,header: &#123;<span class="javascript"><span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span></span>&#125;,<span class="javascript">success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;&#125;,</span><span class="javascript">error: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;&#125;</span>&#125;;<span class="javascript"><span class="hljs-comment">// ä½¿ç”¨optionså¯¹è±¡ä¸­çš„å±æ€§è¦†ç›–defaultså¯¹è±¡ä¸­çš„å±æ€§</span></span><span class="javascript"><span class="hljs-built_in">Object</span>.assign(defaults, options); <span class="hljs-comment">//optionsä¼šè¦†ç›–defaultsåŸæœ‰çš„å±æ€§</span></span><span class="javascript"><span class="hljs-comment">// åˆ›å»ºajaxå¯¹è±¡</span></span><span class="javascript"><span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();</span><span class="javascript"><span class="hljs-comment">// æ‹¼æ¥è¯·æ±‚å‚æ•°çš„å˜é‡</span></span><span class="javascript"><span class="hljs-keyword">var</span> params = <span class="hljs-string">&#x27;&#x27;</span>;</span><span class="javascript"><span class="hljs-comment">// å¾ªç¯ç”¨æˆ·ä¼ é€’è¿›æ¥çš„å¯¹è±¡æ ¼å¼å‚æ•°</span></span><span class="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> defaults.data) &#123;</span><span class="javascript"><span class="hljs-comment">// å°†å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼</span></span><span class="javascript">params += attr + <span class="hljs-string">&#x27;=&#x27;</span> + defaults.data[attr] + <span class="hljs-string">&#x27;&amp;&#x27;</span>;</span>&#125;<span class="javascript"><span class="hljs-comment">// å°†å‚æ•°æœ€åé¢çš„&amp;æˆªå–æ‰ </span></span><span class="javascript"><span class="hljs-comment">// å°†æˆªå–çš„ç»“æœé‡æ–°èµ‹å€¼ç»™paramså˜é‡</span></span>params = params.substr(0, params.length - 1);<span class="javascript"><span class="hljs-comment">// åˆ¤æ–­è¯·æ±‚æ–¹å¼</span></span><span class="javascript"><span class="hljs-keyword">if</span> (defaults.type == <span class="hljs-string">&#x27;get&#x27;</span>) &#123;</span><span class="javascript">defaults.url = defaults.url + <span class="hljs-string">&#x27;?&#x27;</span> + params;</span>&#125;/*&#123;<span class="javascript">name: <span class="hljs-string">&#x27;zhangsan&#x27;</span>,</span>age: 20&#125;name=zhangsan&amp;age=20 */<span class="javascript"><span class="hljs-comment">// é…ç½®ajaxå¯¹è±¡</span></span>xhr.open(defaults.type, defaults.url);<span class="javascript"><span class="hljs-comment">// å¦‚æœè¯·æ±‚æ–¹å¼ä¸ºpost</span></span><span class="javascript"><span class="hljs-keyword">if</span> (defaults.type == <span class="hljs-string">&#x27;post&#x27;</span>) &#123;</span><span class="javascript"><span class="hljs-comment">// ç”¨æˆ·å¸Œæœ›çš„å‘æœåŠ¡å™¨ç«¯``ä¼ é€’çš„è¯·æ±‚å‚æ•°çš„ç±»å‹</span></span><span class="javascript"><span class="hljs-keyword">var</span> contentType = defaults.header[<span class="hljs-string">&#x27;Content-Type&#x27;</span>]</span><span class="javascript"><span class="hljs-comment">// è®¾ç½®è¯·æ±‚å‚æ•°æ ¼å¼çš„ç±»å‹</span></span><span class="javascript">xhr.setRequestHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, contentType);</span><span class="javascript"><span class="hljs-comment">// åˆ¤æ–­ç”¨æˆ·å¸Œæœ›çš„è¯·æ±‚å‚æ•°æ ¼å¼çš„ç±»å‹</span></span><span class="javascript"><span class="hljs-comment">// å¦‚æœç±»å‹ä¸ºjson</span></span><span class="javascript"><span class="hljs-keyword">if</span> (contentType == <span class="hljs-string">&#x27;application/json&#x27;</span>) &#123;</span><span class="javascript"><span class="hljs-comment">// å‘æœåŠ¡å™¨ç«¯ä¼ é€’jsonæ•°æ®æ ¼å¼çš„å‚æ•°</span></span><span class="javascript">xhr.send(<span class="hljs-built_in">JSON</span>.stringify(defaults.data))</span><span class="javascript">&#125;<span class="hljs-keyword">else</span> &#123;</span><span class="javascript"><span class="hljs-comment">// å‘æœåŠ¡å™¨ç«¯ä¼ é€’æ™®é€šç±»å‹çš„è¯·æ±‚å‚æ•°</span></span>xhr.send(params);&#125;<span class="javascript">&#125;<span class="hljs-keyword">else</span> &#123;</span><span class="javascript"><span class="hljs-comment">// å‘é€è¯·æ±‚</span></span>xhr.send();&#125;<span class="javascript"><span class="hljs-comment">// ç›‘å¬xhrå¯¹è±¡ä¸‹é¢çš„onloadäº‹ä»¶</span></span><span class="javascript"><span class="hljs-comment">// å½“xhrå¯¹è±¡æ¥æ”¶å®Œå“åº”æ•°æ®åè§¦å‘</span></span><span class="javascript">xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript"><span class="hljs-comment">// xhr.getResponseHeader()</span></span><span class="javascript"><span class="hljs-comment">// è·å–å“åº”å¤´ä¸­çš„æ•°æ®</span></span><span class="javascript"><span class="hljs-keyword">var</span> contentType = xhr.getResponseHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>);</span><span class="javascript"><span class="hljs-comment">// æœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®</span></span><span class="javascript"><span class="hljs-keyword">var</span> responseText = xhr.responseText;</span><span class="javascript"><span class="hljs-comment">// å¦‚æœå“åº”ç±»å‹ä¸­åŒ…å«applicaition/json</span></span><span class="javascript"><span class="hljs-keyword">if</span> (contentType.includes(<span class="hljs-string">&#x27;application/json&#x27;</span>)) &#123;</span><span class="javascript"><span class="hljs-comment">// å°†jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºjsonå¯¹è±¡</span></span><span class="javascript">responseText = <span class="hljs-built_in">JSON</span>.parse(responseText)</span>&#125;<span class="javascript"><span class="hljs-comment">// å½“httpçŠ¶æ€ç ç­‰äº200çš„æ—¶å€™</span></span>if (xhr.status == 200) &#123;<span class="javascript"><span class="hljs-comment">// è¯·æ±‚æˆåŠŸ è°ƒç”¨å¤„ç†æˆåŠŸæƒ…å†µçš„å‡½æ•°</span></span>defaults.success(responseText, xhr);<span class="javascript">&#125;<span class="hljs-keyword">else</span> &#123;</span><span class="javascript"><span class="hljs-comment">// è¯·æ±‚å¤±è´¥ è°ƒç”¨å¤„ç†å¤±è´¥æƒ…å†µçš„å‡½æ•°</span></span>defaults.error(responseText, xhr);&#125;&#125;&#125;        ajax(&#123;<span class="javascript">      type: <span class="hljs-string">&#x27;post&#x27;</span>,</span><span class="javascript">      url: <span class="hljs-string">&#x27;http://localhost:3000/responseData&#x27;</span>,</span><span class="javascript">      sucess:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;</span><span class="javascript">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;this is success&#x27;</span>);</span><span class="javascript">        <span class="hljs-built_in">console</span>.log(data);</span>      &#125;    &#125;)    /*è¯·æ±‚å‚æ•°è¦è€ƒè™‘çš„é—®é¢˜1.è¯·æ±‚å‚æ•°ä½ç½®çš„é—®é¢˜å°†è¯·æ±‚å‚æ•°ä¼ é€’åˆ°ajaxå‡½æ•°å†…éƒ¨, åœ¨å‡½æ•°å†…éƒ¨æ ¹æ®è¯·æ±‚æ–¹å¼çš„ä¸åŒå°†è¯·æ±‚å‚æ•°æ”¾ç½®åœ¨ä¸åŒçš„ä½ç½®get æ”¾åœ¨è¯·æ±‚åœ°å€çš„åé¢post æ”¾åœ¨sendæ–¹æ³•ä¸­2.è¯·æ±‚å‚æ•°æ ¼å¼çš„é—®é¢˜application/x-www-form-urlencodedå‚æ•°åç§°=å‚æ•°å€¼&amp;å‚æ•°åç§°=å‚æ•°å€¼name=zhangsan&amp;age=20application/json<span class="javascript">&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;zhangsan&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>&#125;</span>1.ä¼ é€’å¯¹è±¡æ•°æ®ç±»å‹å¯¹äºå‡½æ•°çš„è°ƒç”¨è€…æ›´åŠ å‹å¥½2.åœ¨å‡½æ•°å†…éƒ¨å¯¹è±¡æ•°æ®ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹æ›´åŠ æ–¹ä¾¿*/<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="jQuery-ä¸­çš„-AJAX-è¯·æ±‚"><a href="#jQuery-ä¸­çš„-AJAX-è¯·æ±‚" class="headerlink" title="jQuery ä¸­çš„ AJAX è¯·æ±‚"></a><strong>jQuery ä¸­çš„ AJAX è¯·æ±‚</strong></h2><p><strong>ajax æ–¹æ³•</strong></p><ul><li>url è¡¨ç¤ºè¯·æ±‚çš„åœ°å€</li><li>type è¡¨ç¤ºè¯·æ±‚çš„ç±»å‹ GET æˆ– POST è¯·æ±‚</li><li>data è¡¨ç¤ºå‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®<ul><li>æ ¼å¼æœ‰ä¸¤ç§ï¼š<div class="hljs code-wrapper"><pre><code>        ä¸€ï¼šname=value&amp;name=value          äºŒï¼š&#123;key:value&#125;</code></pre></div></li></ul></li></ul><p>success è¯·æ±‚æˆåŠŸï¼Œå“åº”çš„å›è°ƒå‡½æ•°</p><p><strong>dataType å“åº”çš„æ•°æ®ç±»å‹</strong></p><ul><li>text è¡¨ç¤ºçº¯æ–‡æœ¬</li><li>xml è¡¨ç¤º xml æ•°æ®</li><li>json è¡¨ç¤º json å¯¹è±¡</li></ul><div class="hljs code-wrapper"><pre><code class="hljs javascript">$(<span class="hljs-string">&quot;#ajaxBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;$.ajax(&#123;url:<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet&quot;</span>,<span class="hljs-comment">// data:&quot;action=jQueryAjax&quot;,</span>data:&#123;<span class="hljs-attr">action</span>:<span class="hljs-string">&quot;jQueryAjax&quot;</span>&#125;,type:<span class="hljs-string">&quot;GET&quot;</span>,success:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<span class="hljs-comment">// alert(&quot;æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ˜¯ï¼š&quot; + data);</span><span class="hljs-comment">// var jsonObj = JSON.parse(data);</span>$(<span class="hljs-string">&quot;#msg&quot;</span>).html(<span class="hljs-string">&quot;ç¼–å·ï¼š&quot;</span> + data.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> + data.name);&#125;,dataType : <span class="hljs-string">&quot;json&quot;</span>&#125;);&#125;);</code></pre></div><p><code>$.get æ–¹æ³•</code>å’Œ<code>$.post æ–¹æ³•</code></p><ul><li>url è¯·æ±‚çš„ url åœ°å€</li><li>data å‘é€çš„æ•°æ®</li><li>callback æˆåŠŸçš„å›è°ƒå‡½æ•°</li><li>type è¿”å›çš„æ•°æ®ç±»å‹</li></ul><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// ajax--get è¯·æ±‚</span>$(<span class="hljs-string">&quot;#getBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;$.get(<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet&quot;</span>,<span class="hljs-string">&quot;action=jQueryGet&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;$(<span class="hljs-string">&quot;#msg&quot;</span>).html(<span class="hljs-string">&quot; get ç¼–å·ï¼š&quot;</span> + data.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> + data.name);&#125;,<span class="hljs-string">&quot;json&quot;</span>);&#125;);<span class="hljs-comment">// ajax--post è¯·æ±‚</span>$(<span class="hljs-string">&quot;#postBtn&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;$.post(<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet&quot;</span>,<span class="hljs-string">&quot;action=jQueryPost&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>)</span><span class="hljs-function"></span>&#123;$(<span class="hljs-string">&quot;#msg&quot;</span>).html(<span class="hljs-string">&quot; post ç¼–å·ï¼š&quot;</span> + data.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> + data.name);&#125;,<span class="hljs-string">&quot;json&quot;</span>);&#125;);</code></pre></div><p><code>$.getJSON</code> æ–¹æ³•</p><ul><li>url è¯·æ±‚çš„ url åœ°å€</li><li>data å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®</li><li>callback æˆåŠŸçš„å›è°ƒå‡½æ•°</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// ajax--getJson è¯·æ±‚</span>$(<span class="hljs-string">&quot;#getJSONBtn&quot;</span>).click(function()&#123;$.getJSON(<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet&quot;</span>,<span class="hljs-string">&quot;action=jQueryGetJSON&quot;</span>,function(data) &#123;$(<span class="hljs-string">&quot;#msg&quot;</span>).html(<span class="hljs-string">&quot; getJSON ç¼–å·ï¼š&quot;</span> + data.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> + data.name);&#125;);&#125;);</code></pre></div><p>è¡¨å•åºåˆ—åŒ– serialize() serialize()å¯ä»¥æŠŠè¡¨å•ä¸­æ‰€æœ‰è¡¨å•é¡¹çš„å†…å®¹éƒ½è·å–åˆ°ï¼Œå¹¶ä»¥ name=value&amp;name=value çš„å½¢å¼è¿›è¡Œæ‹¼æ¥ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// ajax è¯·æ±‚</span>$(<span class="hljs-string">&quot;#submit&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">// æŠŠå‚æ•°åºåˆ—åŒ–</span>$.getJSON(<span class="hljs-string">&quot;http://localhost:8080/16_json_ajax_i18n/ajaxServlet&quot;</span>,<span class="hljs-string">&quot;action=jQuerySerialize&amp;&quot;</span> +$(<span class="hljs-string">&quot;#form01&quot;</span>).serialize(),<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;$(<span class="hljs-string">&quot;#msg&quot;</span>).html(<span class="hljs-string">&quot; Serialize ç¼–å·ï¼š&quot;</span> + data.id + <span class="hljs-string">&quot; , å§“åï¼š&quot;</span> + data.name);&#125;);&#125;);</code></pre></div><h1 id="åäºŒã€Axios"><a href="#åäºŒã€Axios" class="headerlink" title="åäºŒã€Axios"></a>åäºŒã€Axios</h1><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># axiosçš„å¼•è¨€</span><span class="hljs-code">Axios æ˜¯ä¸€ä¸ª  å¼‚æ­¥è¯·æ±‚ æŠ€æœ¯</span><span class="hljs-code"></span><span class="hljs-code"># å¼‚æ­¥è¯·æ±‚</span><span class="hljs-code">åŸºäºXMLHttpRequestå¯¹è±¡å‘èµ·çš„è¯·æ±‚éƒ½æ˜¯å¼‚æ­¥è¯·æ±‚</span><span class="hljs-code"></span><span class="hljs-code"># å¼‚æ­¥è¯·æ±‚ç‰¹ç‚¹</span><span class="hljs-code">è¯·æ±‚ä¹‹åé¡µé¢ä¸åŠ¨,å“åº”å›æ¥æ›´æ–°çš„æ˜¯é¡µé¢çš„å±€éƒ¨,å¤šä¸ªè¯·æ±‚ä¹‹é—´äº’ä¸å½±å“,å¹¶è¡Œæ‰§è¡Œ</span><span class="hljs-code">ajaxç¡®å®ç”¨æ¥å‘é€å¼‚æ­¥è¯·æ±‚,ajaxè¿‡æ°”  </span><span class="hljs-code">ç³»ç»Ÿæ¶æ„ å‰åç«¯åˆ†ç¦»æ¶æ„ç³»ç»Ÿ ---- å¼‚æ­¥è¯·æ±‚æŠ€æœ¯-----&gt; Vue å…¨å®¶æ¡¶ç³»åˆ— å‰ç«¯æŠ€æœ¯ç«¯  Vue  æ·˜æ±°äº†jQuery </span></code></pre></div><h2 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><h2 id="GETæ–¹å¼è¯·æ±‚"><a href="#GETæ–¹å¼è¯·æ±‚" class="headerlink" title="GETæ–¹å¼è¯·æ±‚"></a>GETæ–¹å¼è¯·æ±‚</h2><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--å¼•å…¥axiosçš„ç›¸å…³ä¾èµ–--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">      <span class="hljs-comment">//getæ–¹å¼è¯·æ±‚</span></span><span class="javascript">      axios.get(<span class="hljs-string">&#x27;http://localhost:8888/axios/findAll?username=zhangsan&amp;password=123&#x27;</span>)<span class="hljs-comment">//å‘é€è¯·æ±‚çš„url</span></span><span class="javascript">          .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;</span><span class="javascript">              <span class="hljs-built_in">console</span>.log(response.data);</span><span class="javascript">          &#125;)<span class="hljs-comment">//å“åº”å›æ¥è§¦å‘çš„å›è°ƒå‡½æ•°</span></span><span class="javascript">          .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>&#123; <span class="hljs-comment">//å½“è¯·æ±‚å‡ºç°é”™è¯¯æ—¶å›è°ƒå‡½æ•°</span></span><span class="javascript">              <span class="hljs-built_in">console</span>.log(err);</span>          &#125;);  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><h2 id="POSTæ–¹å¼çš„è¯·æ±‚"><a href="#POSTæ–¹å¼çš„è¯·æ±‚" class="headerlink" title="POSTæ–¹å¼çš„è¯·æ±‚"></a>POSTæ–¹å¼çš„è¯·æ±‚</h2><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--å¼•å…¥axiosçš„ç›¸å…³ä¾èµ–--&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">       <span class="hljs-comment">//postè¯·æ±‚</span></span><span class="javascript">       axios.post(<span class="hljs-string">&#x27;http://localhost:8888/axios/save&#x27;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">23</span>&#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span><span class="javascript">           <span class="hljs-built_in">console</span>.log(response.data);</span><span class="javascript">       &#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;</span><span class="javascript">           <span class="hljs-built_in">console</span>.log(err);</span>       &#125;);   <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p><strong>æ€»ç»“</strong></p><ol><li>axiosåœ¨å‘é€postæ–¹å¼çš„è¯·æ±‚æ—¶ä¼ é€’çš„å‚æ•°å¦‚æœä¸ºå¯¹è±¡ç±»å‹,axiosä¼šè‡ªåŠ¨å°†å¯¹è±¡è½¬ä¸ºjsonæ ¼å¼çš„å­—ç¬¦ä¸²ä½¿ç”¨ application/jsonçš„è¯·æ±‚å¤´å‘åç«¯æœåŠ¡æ¥å£ä¼ é€’å‚æ•°</li><li>axiosçš„postè¯·æ±‚ä¼ é€’å‚æ•°çš„ä¸¤ç§æ–¹å¼:</li><li>ç¬¬ä¸€ç§ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œå‚æ•°ä¼ é€’: â€œname=zhangsan&amp;age=23â€ è¿™ç§å½¢å¼</li><li>ç¬¬äºŒç§æ–¹å¼åç«¯æ¥å£ç›´æ¥ä½¿ç”¨<code>@RequestBody</code>æ³¨è§£å½¢å¼æ¥æ”¶å‚æ•°: </li><li>å‘é€getè·Ÿpostæ—¶ï¼Œå‘é€å‚æ•°åç§°è¦è·Ÿæ¥å—å‚æ•°åç§°ä¿æŒä¸€è‡´ï¼ˆå¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œåˆ™è·Ÿå¯¹è±¡å±æ€§çš„åç§°ä¿æŒä¸€è‡´ï¼‰</li></ol><h2 id="Axiosçš„å¹¶å‘è¯·æ±‚"><a href="#Axiosçš„å¹¶å‘è¯·æ±‚" class="headerlink" title="Axiosçš„å¹¶å‘è¯·æ±‚"></a>Axiosçš„å¹¶å‘è¯·æ±‚</h2><p>åœ¨åŒä¸€æ—¶é—´å‘é€å¤šä¸ªä¸åŒçš„è¯·æ±‚åˆ°åç«¯æœåŠ¡,æœ€ååŒä¸€å¤„ç†ä¸åŒæœåŠ¡çš„å“åº”ç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--å¼•å…¥axiosçš„ç›¸å…³ä¾èµ–--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-comment">//å¹¶å‘è¯·æ±‚: åœ¨åŒä¸€æ—¶é—´å‘é€å¤šä¸ªä¸åŒçš„è¯·æ±‚åˆ°åç«¯æœåŠ¡,æœ€ååŒä¸€å¤„ç†ä¸åŒæœåŠ¡çš„å“åº”ç»“æœ</span></span><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findAll</span>(<span class="hljs-params"></span>)</span>&#123;</span><span class="javascript">        <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">&quot;http://localhost:8888/axios/findAll?username=xiaochen&amp;password=123&quot;</span>);</span>    &#125;<span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>)</span>&#123;</span><span class="javascript">        <span class="hljs-keyword">return</span> axios.post(<span class="hljs-string">&#x27;h tp://localhost:8888/axios/save&#x27;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;xiaosun&quot;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">23</span>&#125;)</span>    &#125;<span class="javascript">    <span class="hljs-comment">//å¹¶è¡Œå‘é€</span></span>    axios.all([findAll(),save()]).then(<span class="javascript">        axios.spread(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result1,result2</span>)</span>&#123;</span><span class="javascript">            <span class="hljs-built_in">console</span>.log(result1.data);</span><span class="javascript">            <span class="hljs-built_in">console</span>.log(result2.data);</span><span class="javascript">        &#125;)<span class="hljs-comment">//ç”¨æ¥ç»Ÿä¸€å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚çš„æ‰§è¡Œç»“æœ</span></span><span class="javascript">    );<span class="hljs-comment">//allç”¨æ¥å¤„ç†å¹¶å‘è¯·æ±‚</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p><strong>æ€»ç»“</strong></p><ol><li>é’ˆå¯¹äºå¹¶å‘è¯·æ±‚éœ€è¦ç”¨åˆ°<code>axios.all()</code>å‡½æ•°æ¥å®Œæˆå¹¶å‘è¯·æ±‚çš„å¤„ç†</li><li>é’ˆå¯¹äºå¹¶å‘è¯·æ±‚çš„ç»“æœæ±‡æ€»éœ€è¦ä½¿ç”¨<code>axios.spread()</code>å‡½æ•°æ¥ç»Ÿä¸€æ±‡æ€»è¯·æ±‚ç»“æœ</li></ol><h2 id="Axiosçš„é«˜çº§ä½¿ç”¨é…ç½®å¯¹è±¡"><a href="#Axiosçš„é«˜çº§ä½¿ç”¨é…ç½®å¯¹è±¡" class="headerlink" title="Axiosçš„é«˜çº§ä½¿ç”¨é…ç½®å¯¹è±¡"></a>Axiosçš„é«˜çº§ä½¿ç”¨é…ç½®å¯¹è±¡</h2><p><strong>é…ç½®å¯¹è±¡</strong></p><div class="hljs code-wrapper"><pre><code class="hljs javascript">&#123;  <span class="hljs-comment">// `url` æ˜¯ç”¨äºè¯·æ±‚çš„æœåŠ¡å™¨ URL</span>  url: <span class="hljs-string">&#x27;/user&#x27;</span>,  <span class="hljs-comment">// `method` æ˜¯åˆ›å»ºè¯·æ±‚æ—¶ä½¿ç”¨çš„æ–¹æ³•</span>  method: <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-comment">// é»˜è®¤æ˜¯ get</span>  <span class="hljs-comment">// `baseURL` å°†è‡ªåŠ¨åŠ åœ¨ `url` å‰é¢ï¼Œé™¤é `url` æ˜¯ä¸€ä¸ªç»å¯¹ URLã€‚</span>  <span class="hljs-comment">// å®ƒå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ª `baseURL` ä¾¿äºä¸º axios å®ä¾‹çš„æ–¹æ³•ä¼ é€’ç›¸å¯¹ URL</span>  baseURL: <span class="hljs-string">&#x27;htt ps://some-domain.com/api/&#x27;</span>,  <span class="hljs-comment">// `transformRequest` å…è®¸åœ¨å‘æœåŠ¡å™¨å‘é€å‰ï¼Œä¿®æ”¹è¯·æ±‚æ•°æ®</span>  <span class="hljs-comment">// åªèƒ½ç”¨åœ¨ &#x27;PUT&#x27;, &#x27;POST&#x27; å’Œ &#x27;PATCH&#x27; è¿™å‡ ä¸ªè¯·æ±‚æ–¹æ³•</span>  <span class="hljs-comment">// åé¢æ•°ç»„ä¸­çš„å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ– ArrayBufferï¼Œæˆ– Stream</span>  transformRequest: [<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;    <span class="hljs-comment">// å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†</span>    <span class="hljs-keyword">return</span> data;  &#125;],  <span class="hljs-comment">// `transformResponse` åœ¨ä¼ é€’ç»™ then/catch å‰ï¼Œå…è®¸ä¿®æ”¹å“åº”æ•°æ®</span>  transformResponse: [<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;    <span class="hljs-comment">// å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†</span>    <span class="hljs-keyword">return</span> data;  &#125;],  <span class="hljs-comment">// `headers` æ˜¯å³å°†è¢«å‘é€çš„è‡ªå®šä¹‰è¯·æ±‚å¤´</span>  headers: &#123;<span class="hljs-string">&#x27;X-Requested-With&#x27;</span>: <span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>&#125;,  <span class="hljs-comment">// `params` æ˜¯å³å°†ä¸è¯·æ±‚ä¸€èµ·å‘é€çš„ URL å‚æ•°</span>  <span class="hljs-comment">// å¿…é¡»æ˜¯ä¸€ä¸ªæ— æ ¼å¼å¯¹è±¡(plain object)æˆ– URLSearchParams å¯¹è±¡</span>  params: &#123;    ID: <span class="hljs-number">12345</span>  &#125;,  <span class="hljs-comment">// `paramsSerializer` æ˜¯ä¸€ä¸ªè´Ÿè´£ `params` åºåˆ—åŒ–çš„å‡½æ•°</span>  <span class="hljs-comment">// (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)</span>  paramsSerializer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) </span>&#123;    <span class="hljs-keyword">return</span> Qs.stringify(params, &#123;<span class="hljs-attr">arrayFormat</span>: <span class="hljs-string">&#x27;brackets&#x27;</span>&#125;)  &#125;,  <span class="hljs-comment">// `data` æ˜¯ä½œä¸ºè¯·æ±‚ä¸»ä½“è¢«å‘é€çš„æ•°æ®</span>  <span class="hljs-comment">// åªé€‚ç”¨äºè¿™äº›è¯·æ±‚æ–¹æ³• &#x27;PUT&#x27;, &#x27;POST&#x27;, å’Œ &#x27;PATCH&#x27;</span>  <span class="hljs-comment">// åœ¨æ²¡æœ‰è®¾ç½® `transformRequest` æ—¶ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š</span>  <span class="hljs-comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span>  <span class="hljs-comment">// - æµè§ˆå™¨ä¸“å±ï¼šFormData, File, Blob</span>  <span class="hljs-comment">// - Node ä¸“å±ï¼š Stream</span>  data: &#123;    firstName: <span class="hljs-string">&#x27;Fred&#x27;</span>  &#125;,  <span class="hljs-comment">// `timeout` æŒ‡å®šè¯·æ±‚è¶…æ—¶çš„æ¯«ç§’æ•°(0 è¡¨ç¤ºæ— è¶…æ—¶æ—¶é—´)</span>  <span class="hljs-comment">// å¦‚æœè¯·æ±‚è¯è´¹äº†è¶…è¿‡ `timeout` çš„æ—¶é—´ï¼Œè¯·æ±‚å°†è¢«ä¸­æ–­</span>  timeout: <span class="hljs-number">1000</span>,  <span class="hljs-comment">// `withCredentials` è¡¨ç¤ºè·¨åŸŸè¯·æ±‚æ—¶æ˜¯å¦éœ€è¦ä½¿ç”¨å‡­è¯</span>  withCredentials: <span class="hljs-literal">false</span>, <span class="hljs-comment">// é»˜è®¤çš„</span>  <span class="hljs-comment">// `adapter` å…è®¸è‡ªå®šä¹‰å¤„ç†è¯·æ±‚ï¼Œä»¥ä½¿æµ‹è¯•æ›´è½»æ¾</span>  <span class="hljs-comment">// è¿”å›ä¸€ä¸ª promise å¹¶åº”ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„å“åº” (æŸ¥é˜… [response docs](#response-api)).</span>  adapter: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) </span>&#123;    <span class="hljs-comment">/* ... */</span>  &#125;,  <span class="hljs-comment">// `auth` è¡¨ç¤ºåº”è¯¥ä½¿ç”¨ HTTP åŸºç¡€éªŒè¯ï¼Œå¹¶æä¾›å‡­æ®</span>  <span class="hljs-comment">// è¿™å°†è®¾ç½®ä¸€ä¸ª `Authorization` å¤´ï¼Œè¦†å†™æ‰ç°æœ‰çš„ä»»æ„ä½¿ç”¨ `headers` è®¾ç½®çš„è‡ªå®šä¹‰ `Authorization`å¤´</span>  auth: &#123;    username: <span class="hljs-string">&#x27;janedoe&#x27;</span>,    password: <span class="hljs-string">&#x27;s00pers3cret&#x27;</span>  &#125;,  <span class="hljs-comment">// `responseType` è¡¨ç¤ºæœåŠ¡å™¨å“åº”çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯ &#x27;arraybuffer&#x27;, &#x27;blob&#x27;, &#x27;document&#x27;, &#x27;json&#x27;, &#x27;text&#x27;, &#x27;stream&#x27;</span>  responseType: <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-comment">// é»˜è®¤çš„</span>  <span class="hljs-comment">// `xsrfCookieName` æ˜¯ç”¨ä½œ xsrf token çš„å€¼çš„cookieçš„åç§°</span>  xsrfCookieName: <span class="hljs-string">&#x27;XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// default</span>  <span class="hljs-comment">// `xsrfHeaderName` æ˜¯æ‰¿è½½ xsrf token çš„å€¼çš„ HTTP å¤´çš„åç§°</span>  xsrfHeaderName: <span class="hljs-string">&#x27;X-XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// é»˜è®¤çš„</span>  <span class="hljs-comment">// `onUploadProgress` å…è®¸ä¸ºä¸Šä¼ å¤„ç†è¿›åº¦äº‹ä»¶</span>  onUploadProgress: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">progressEvent</span>) </span>&#123;    <span class="hljs-comment">// å¯¹åŸç”Ÿè¿›åº¦äº‹ä»¶çš„å¤„ç†</span>  &#125;,  <span class="hljs-comment">// `onDownloadProgress` å…è®¸ä¸ºä¸‹è½½å¤„ç†è¿›åº¦äº‹ä»¶</span>  onDownloadProgress: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">progressEvent</span>) </span>&#123;    <span class="hljs-comment">// å¯¹åŸç”Ÿè¿›åº¦äº‹ä»¶çš„å¤„ç†</span>  &#125;,  <span class="hljs-comment">// `maxContentLength` å®šä¹‰å…è®¸çš„å“åº”å†…å®¹çš„æœ€å¤§å°ºå¯¸</span>  maxContentLength: <span class="hljs-number">2000</span>,  <span class="hljs-comment">// `validateStatus` å®šä¹‰å¯¹äºç»™å®šçš„HTTP å“åº”çŠ¶æ€ç æ˜¯ resolve æˆ– reject  promise ã€‚å¦‚æœ `validateStatus` è¿”å› `true` (æˆ–è€…è®¾ç½®ä¸º `null` æˆ– `undefined`)ï¼Œpromise å°†è¢« resolve; å¦åˆ™ï¼Œpromise å°†è¢« rejecte</span>  validateStatus: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) </span>&#123;    <span class="hljs-keyword">return</span> status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span>; <span class="hljs-comment">// é»˜è®¤çš„</span>  &#125;,  <span class="hljs-comment">// `maxRedirects` å®šä¹‰åœ¨ node.js ä¸­ follow çš„æœ€å¤§é‡å®šå‘æ•°ç›®</span>  <span class="hljs-comment">// å¦‚æœè®¾ç½®ä¸º0ï¼Œå°†ä¸ä¼š follow ä»»ä½•é‡å®šå‘</span>  maxRedirects: <span class="hljs-number">5</span>, <span class="hljs-comment">// é»˜è®¤çš„</span>  <span class="hljs-comment">// `httpAgent` å’Œ `httpsAgent` åˆ†åˆ«åœ¨ node.js ä¸­ç”¨äºå®šä¹‰åœ¨æ‰§è¡Œ http å’Œ https æ—¶ä½¿ç”¨çš„è‡ªå®šä¹‰ä»£ç†ã€‚å…è®¸åƒè¿™æ ·é…ç½®é€‰é¡¹ï¼š</span>  <span class="hljs-comment">// `keepAlive` é»˜è®¤æ²¡æœ‰å¯ç”¨</span>  httpAgent: <span class="hljs-keyword">new</span> http.Agent(&#123; <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> &#125;),  httpsAgent: <span class="hljs-keyword">new</span> https.Agent(&#123; <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> &#125;),  <span class="hljs-comment">// &#x27;proxy&#x27; å®šä¹‰ä»£ç†æœåŠ¡å™¨çš„ä¸»æœºåç§°å’Œç«¯å£</span>  <span class="hljs-comment">// `auth` è¡¨ç¤º HTTP åŸºç¡€éªŒè¯åº”å½“ç”¨äºè¿æ¥ä»£ç†ï¼Œå¹¶æä¾›å‡­æ®</span>  <span class="hljs-comment">// è¿™å°†ä¼šè®¾ç½®ä¸€ä¸ª `Proxy-Authorization` å¤´ï¼Œè¦†å†™æ‰å·²æœ‰çš„é€šè¿‡ä½¿ç”¨ `header` è®¾ç½®çš„è‡ªå®šä¹‰ `Proxy-Authorization` å¤´ã€‚</span>  proxy: &#123;    host: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,    port: <span class="hljs-number">9000</span>,    auth: : &#123;      username: <span class="hljs-string">&#x27;mikeymike&#x27;</span>,      password: <span class="hljs-string">&#x27;rapunz3l&#x27;</span>    &#125;  &#125;,  <span class="hljs-comment">// `cancelToken` æŒ‡å®šç”¨äºå–æ¶ˆè¯·æ±‚çš„ cancel token</span>  <span class="hljs-comment">// ï¼ˆæŸ¥çœ‹åé¢çš„ Cancellation è¿™èŠ‚äº†è§£æ›´å¤šï¼‰</span>  cancelToken: <span class="hljs-keyword">new</span> CancelToken(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cancel</span>) </span>&#123;  &#125;)&#125;</code></pre></div><p><strong>ä½¿ç”¨é…ç½®å¯¹è±¡å½¢å¼å‘é€è¯·æ±‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs javascript"> <span class="hljs-keyword">var</span> instance = axios.create(&#123;   method:<span class="hljs-string">&quot;GET&quot;</span>,   baseURL:<span class="hljs-string">&quot;http://localhost:8888&quot;</span>,   data:&#123;  <span class="hljs-comment">//ä½œä¸ºè¯·æ±‚ä½“å‘é€çš„æ•°æ®,åªé€‚ç”¨äºè¿™äº›è¯·æ±‚æ–¹æ³• &#x27;PUT&#x27;, &#x27;POST&#x27;, å’Œ &#x27;PATCH&#x27;</span>   &#125; &#125;);instance.get(<span class="hljs-string">&quot;/axios/findAll?username=zhangsan&quot;</span>);</code></pre></div><p><strong>Axiosçš„Restfulé£æ ¼çš„API</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># Axiosçš„APIæ€»ç»“</span>  axios.request(config)  axios.get(url[, config])  axios.delete(url[, config])  axios.head(url[, config])  axios.post(url[, data[, config]])  axios.put(url[, data[, config]])  axios.patch(url[, data[, config]])<span class="hljs-section"># NOTE:</span><span class="hljs-code">åœ¨ä½¿ç”¨åˆ«åæ–¹æ³•æ—¶ï¼Œ urlã€methodã€data è¿™äº›å±æ€§éƒ½ä¸å¿…åœ¨é…ç½®ä¸­æŒ‡å®šã€‚</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¼€å‘æ‰€éœ€çš„Linuxç¯å¢ƒé…ç½®</title>
    <link href="/2021/07/16/Linux/"/>
    <url>/2021/07/16/Linux/</url>
    
    <content type="html"><![CDATA[<h1 id="Linuxç¯å¢ƒé…ç½®"><a href="#Linuxç¯å¢ƒé…ç½®" class="headerlink" title="Linuxç¯å¢ƒé…ç½®"></a>Linuxç¯å¢ƒé…ç½®</h1><blockquote><p>æœ¬æ–‡ä¸»è¦è®²è§£åœ¨Linuxç¯å¢ƒä¸‹çš„Javaå¼€å‘ç¯å¢ƒæ­å»ºï¼ŒåŒ…å«å„ç§å¸¸ç”¨è½¯ä»¶çš„å®‰è£…æ­¥éª¤ä»¥åŠåŸºç¡€çš„LinuxçŸ¥è¯†</p></blockquote><h1 id="å®‰è£…Centos"><a href="#å®‰è£…Centos" class="headerlink" title="å®‰è£…Centos"></a>å®‰è£…Centos</h1><p>å› ä¸ºå¼€å‘ä¸­åªéœ€ç”¨å¾—åˆ°å‘½ä»¤è¡Œæ“ä½œï¼Œæ‰€ä»¥åªéœ€è¦å®‰è£…Minimalç‰ˆæœ¬</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506161400598.png" alt="image-20210506161400598"></p><p>è¿›è¡Œé…ç½®</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506162907224.png" alt="image-20210506162907224"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506163217156.png" alt="image-20210506163217156"></p><p>å®‰è£…å®Œæˆåé‡å¯å³å¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506164209130.png" alt="image-20210506164209130"></p><p>é‡å¯åæ¥åˆ°ç™»å½•ç•Œé¢ï¼Œè¾“å…¥è´¦å·å¯†ç å³å¯ç™»å½•</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506164333914.png" alt="image-20210506164333914"></p><h1 id="LinuxåŸºç¡€çŸ¥è¯†"><a href="#LinuxåŸºç¡€çŸ¥è¯†" class="headerlink" title="LinuxåŸºç¡€çŸ¥è¯†"></a>LinuxåŸºç¡€çŸ¥è¯†</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506164621687.png" alt="image-20210506164621687"></p><ul><li>bin  (binaries)å­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶                                                                                                    [é‡ç‚¹]</li><li>sbin  (super user binaries)å­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªæœ‰rootæ‰èƒ½è®¿é—®</li><li>etc (etcetera)å­˜æ”¾ç³»ç»Ÿé…ç½®æ–‡ä»¶                                                                                                                [é‡ç‚¹]</li><li>usr  (unix shared resources)ç”¨äºå­˜æ”¾å…±äº«çš„ç³»ç»Ÿèµ„æº                                                                  [é‡ç‚¹]</li><li>home å­˜æ”¾ç”¨æˆ·æ–‡ä»¶çš„æ ¹ç›®å½•                                                                                                                    [é‡ç‚¹]</li><li>root  è¶…çº§ç”¨æˆ·ç›®å½•                                                                                                                                         [é‡ç‚¹]</li><li>dev (devices)ç”¨äºå­˜æ”¾è®¾å¤‡æ–‡ä»¶</li><li>lib  (library)å­˜æ”¾è·Ÿæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„å…±äº«åº“åŠå†…æ ¸æ¨¡å—</li><li>mnt  (mount)ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ç‚¹</li><li>boot å­˜æ”¾ç”¨äºç³»ç»Ÿå¼•å¯¼æ—¶ä½¿ç”¨çš„å„ç§æ–‡ä»¶</li><li>tmp  (temporary)ç”¨äºå­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶                                                                                             [é‡ç‚¹]</li><li>var  (variable)ç”¨äºå­˜æ”¾è¿è¡Œæ—¶éœ€è¦æ”¹å˜æ•°æ®çš„æ–‡ä»¶</li></ul><h2 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h2><blockquote><p>æ³¨æ„:åœ¨linuxä¸­å‘½ä»¤ä¸¥æ ¼åŒºåˆ†å¤§å°å†™</p></blockquote><h3 id="æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨-list"><a href="#æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨-list" class="headerlink" title="æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨    (list)"></a>æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨    (list)</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">ls å¸¸ç”¨å‚æ•°:</span>  -l (long) é•¿æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•ä¿¡æ¯-a (all) æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•(åŒ…å«éšè—æ–‡ä»¶å’Œç›®å½•)-R         é€’å½’æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶æ¸…å•ï¼Œå³ä¼šæ˜¾ç¤ºæŒ‡å®šç›®å½•åˆ†æ”¯å†…å„å­ç›®å½•ä¸­çš„æ–‡ä»¶æ¸…å•ã€‚</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/3.ls%20-l%E9%95%BF%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E.png" alt="3.ls -lé•¿æ ¼å¼è¯´æ˜"></p><h3 id="æ“ä½œæ–‡ä»¶å‘½ä»¤-é‡ç‚¹"><a href="#æ“ä½œæ–‡ä»¶å‘½ä»¤-é‡ç‚¹" class="headerlink" title="æ“ä½œæ–‡ä»¶å‘½ä»¤[é‡ç‚¹]"></a>æ“ä½œæ–‡ä»¶å‘½ä»¤[é‡ç‚¹]</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 0.cd ç”¨æ¥åˆ‡æ¢ç›®å½•</span><span class="hljs-meta">#</span><span class="bash"> 1.pwd æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•ï¼ˆ<span class="hljs-built_in">print</span> working directoryï¼‰</span><span class="hljs-meta">#</span><span class="bash"> 2.touch åˆ›å»ºç©ºæ–‡ä»¶</span> <span class="hljs-meta">#</span><span class="bash"> 3.mkdir åˆ›å»ºç›®å½•ï¼ˆmake directoriyï¼‰</span>-p çˆ¶ç›®å½•ä¸å­˜åœ¨æƒ…å†µä¸‹å…ˆç”Ÿæˆçˆ¶ç›®å½• ï¼ˆparentsï¼‰            <span class="hljs-meta">#</span><span class="bash"> 4.cp å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼ˆcopyï¼‰</span>      cp  æ–‡ä»¶å    ç›®å½•   å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¸­      cp  -r ç›®å½•å    ç›®å½•   å¤åˆ¶æŒ‡å®šç›®å½•åˆ°æŒ‡å®šç›®å½•ä¸­-r é€’å½’å¤„ç†ï¼Œå°†æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ä¸å­ç›®å½•ä¸€å¹¶æ‹·è´ï¼ˆrecursiveï¼‰     <span class="hljs-meta">#</span><span class="bash"> 5.mv ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€æ–‡ä»¶æˆ–ç›®å½•æ”¹åï¼ˆmoveï¼‰</span>mv æ–‡ä»¶å    æ–°æ–‡ä»¶å      æ–‡ä»¶æ”¹åmv æ–‡ä»¶å    ç›®å½•å     æ–‡ä»¶ç§»åŠ¨mv ç›®å½•å    ä¸å­˜åœ¨ç›®å½•å  ç›®å½•æ”¹å         mv ç›®å½•å  å·²å­˜åœ¨ç›®å½•å  ç›®å½•ç§»åŠ¨<span class="hljs-meta">#</span><span class="bash"> 6.rm åˆ é™¤æ–‡ä»¶ï¼ˆremoveï¼‰</span>-r åŒæ—¶åˆ é™¤è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆrecursiveï¼‰-f å¼ºåˆ¶åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼ˆforceï¼‰<span class="hljs-meta">#</span><span class="bash"> 7.rmdir åˆ é™¤ç©ºç›®å½•ï¼ˆremove directoriyï¼‰</span><span class="hljs-meta">#</span><span class="bash"> 8.cat æ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶å†…å®¹ ï¼ˆcatenateï¼‰ ç”¨æ¥å±•ç¤ºå°‘é‡å†…å®¹</span><span class="hljs-meta">#</span><span class="bash"> 9.moreã€less åˆ†é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶å†…å®¹   é€€å‡ºç”¨qé€€å‡º</span><span class="hljs-meta">#</span><span class="bash"> 10.headã€tailæŸ¥çœ‹æ–‡æœ¬ä¸­å¼€å¤´æˆ–ç»“å°¾éƒ¨åˆ†çš„å†…å®¹</span>head  -n  5  a.log æŸ¥çœ‹a.logæ–‡ä»¶çš„å‰5è¡Œ<span class="hljs-meta">#</span><span class="bash"> 11.tail  -f  b.log å¾ªç¯è¯»å–ï¼ˆfellowï¼‰</span><span class="hljs-meta">#</span><span class="bash"> 12.echo è¾“å‡ºå‘½ä»¤</span>echo   I love babyè¯´æ˜:ç”¨æ¥å‘å±å¹•è¾“å‡ºä¸€å¥è¯echo I Love baby  &gt;&gt;  aa.txtè¯´æ˜:å°†è¿™æ®µå†…å®¹è¾“å…¥åˆ°æ–‡ä»¶ä¸­<span class="hljs-meta">#</span><span class="bash"> 13.æŸ¥çœ‹æ–‡ä»¶</span>find -name xxxwhereis xxæ˜¾ç¤ºxxçš„ä½ç½®which xxæ˜¾ç¤ºxxçš„å®Œæ•´è·¯å¾„</code></pre></div><h3 id="æŸ¥çœ‹ç›¸å…³å‘½ä»¤"><a href="#æŸ¥çœ‹ç›¸å…³å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹ç›¸å…³å‘½ä»¤"></a>æŸ¥çœ‹ç›¸å…³å‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1.ip addr æŸ¥çœ‹IPåœ°å€</span>ip a  ç®€åŒ–å†™æ³•<span class="hljs-meta">#</span><span class="bash"> 2.ping æµ‹è¯•ç½‘ç»œè¿é€šæ€§</span>ping 192.168.0.1<span class="hljs-meta">#</span><span class="bash"> 3.æŸ¥çœ‹Linuxä¸­ç½‘ç»œç³»ç»ŸçŠ¶æ€ä¿¡æ¯</span>netstat<span class="hljs-meta">#</span><span class="bash"> 4.æ˜¾ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</span>free<span class="hljs-meta">#</span><span class="bash"> 5.æ˜¾ç¤ºç£ç›˜çš„ç›¸å…³ä¿¡æ¯</span>df<span class="hljs-meta">#</span><span class="bash"> 6.</span></code></pre></div><h3 id="tarå‘½ä»¤"><a href="#tarå‘½ä»¤" class="headerlink" title="tarå‘½ä»¤"></a>tarå‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"> -c å»ºç«‹ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤ï¼ˆcreateï¼‰-x è§£å¼€ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤ï¼ˆextractï¼‰-z æ˜¯å¦éœ€è¦ç”¨ gzip å‹ç¼©  -v å‹ç¼©çš„è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ–‡ä»¶ï¼ˆverboseï¼‰-f ä½¿ç”¨æ¡£åï¼Œåœ¨ f ä¹‹åè¦ç«‹å³æ¥æ¡£åï¼ˆfileï¼‰`é€šå¸¸ç»„åˆä½¿ç”¨:`tar -cvf aaa.tar file1.txt file2.txt å°†file1å’Œ2æ‰“åŒ…æˆaaa.tartar -zcvf aaa.tar.gz file1.txt file2.txt å°†file1å’Œ2æ‰“åŒ…æˆaaa.tarå¹¶å‹ç¼©tar -zxvf aaa.tar.gz file1.txt file2.txt å°†aaa.tar.gzè§£å‹</code></pre></div><h3 id="systemctl-æœåŠ¡å‘½ä»¤"><a href="#systemctl-æœåŠ¡å‘½ä»¤" class="headerlink" title="systemctl æœåŠ¡å‘½ä»¤"></a>systemctl æœåŠ¡å‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"> systemctl status|start|stop|restart æœåŠ¡å  mysqld firewalld(é˜²ç«å¢™) network(ç½‘ç»œ)systemctl status æœåŠ¡å          è¯´æ˜:æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„è¿è¡ŒçŠ¶æ€systemctl start æœåŠ¡å è¯´æ˜:å¯åŠ¨æŸä¸ªæœåŠ¡systemctl restart æœåŠ¡å è¯´æ˜:é‡å¯æŸä¸ªæœåŠ¡systemctl stop æœåŠ¡å è¯´æ˜:åœæ­¢æŸä¸ªæœåŠ¡</code></pre></div><h3 id="è¿›ç¨‹ç›¸å…³å‘½ä»¤"><a href="#è¿›ç¨‹ç›¸å…³å‘½ä»¤" class="headerlink" title="è¿›ç¨‹ç›¸å…³å‘½ä»¤"></a>è¿›ç¨‹ç›¸å…³å‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1.ps è¯¢åœ¨å½“å‰æ§åˆ¶å°ä¸Šè¿è¡Œçš„è¿›ç¨‹</span>ps  -aux   è¯´æ˜:æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰è¿è¡Œçš„è¿›ç¨‹ï¼ŒåŒ…æ‹¬åå°è¿›ç¨‹ï¼Œå…¶ä¸­å‚æ•°aæ˜¯æ‰€æœ‰è¿›ç¨‹ï¼Œå‚æ•°xåŒ…æ‹¬ä¸å ç”¨æ§åˆ¶å°çš„è¿›ç¨‹ï¼Œå‚æ•°uæ˜¾ç¤ºç”¨æˆ·ã€‚ps  -ef è¯´æ˜:æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰è¿è¡Œçš„è¿›ç¨‹ï¼ŒåŒ…æ‹¬åå°è¿›ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ˜¾ç¤ºå‡ºæ¯ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·ã€‚    ps -aux|grep è¿›ç¨‹/æœåŠ¡å/å…³é”®å­—/tomcat  [é‡ç‚¹]    <span class="hljs-meta">#</span><span class="bash"> 2.topå‘½ä»¤  åŠ¨æ€æ˜¾ç¤ºç³»ç»Ÿè¿›ç¨‹</span><span class="hljs-meta">#</span><span class="bash"> 3.kill æ€æ­»è¿›ç¨‹</span>kill  3029 è¯´æ˜ï¼šä¸Šè¿°å‘½ä»¤ä¸­3029æ˜¯è¿›ç¨‹å·ï¼›ä¸€èˆ¬åœ¨æ‰§è¡Œkillå‘½ä»¤ä¹‹å‰ï¼Œå…ˆç”¨psæˆ–pstreeæ¥æŸ¥è¯¢ä¸€ä¸‹å°†è¦è¢«æ€æ‰çš„è¿›ç¨‹çš„è¿›ç¨‹å·ã€‚ kill  -9  3029 è¯´æ˜:å¼ºåˆ¶ç»ˆæ­¢3029å·è¿›ç¨‹çš„è¿è¡Œï¼Œå…¶ä¸­å‚æ•°-9ä»£è¡¨å¼ºåˆ¶çš„æ„æ€,å®é™…ä¸Škillå‘½ä»¤æ˜¯å‘è¯¥è¿›ç¨‹å‘é€ä¿¡å·ï¼Œè¯¥è¿›ç¨‹æ¥åˆ°ä¿¡å·åå†³å®šæ˜¯å¦åœæ­¢è¿è¡Œï¼Œæœ‰äº›å®ˆæŠ¤è¿›ç¨‹å¿…é¡»è¦æ”¶åˆ°å‚æ•°9æ‰ç»ˆæ­¢è¿è¡Œã€‚</code></pre></div><h3 id="viå‘½ä»¤"><a href="#viå‘½ä»¤" class="headerlink" title="viå‘½ä»¤"></a>viå‘½ä»¤</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506185857940.png" alt="image-20210506185857940"></p><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¸¸ç”¨å‘½ä»¤:</span>iåœ¨å…‰æ ‡å‰æ’å…¥ Iåœ¨å…‰æ ‡å½“å‰è¡Œå¼€å§‹æ’å…¥ aåœ¨å…‰æ ‡åæ’å…¥ Aåœ¨å…‰æ ‡å½“å‰è¡Œæœ«å°¾æ’å…¥ oåœ¨å…‰æ ‡å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œæ’å…¥æ–°è¡Œ Oåœ¨å…‰æ ‡å½“å‰è¡Œçš„ä¸Šä¸€è¡Œæ’å…¥æ–°è¡Œ ----------------é‡ç‚¹--------------------------- :set nuæ˜¾ç¤ºè¡Œå· :set nonuå–æ¶ˆè¡Œå· :set paste  ç²˜è´´æ–‡æœ¬ dd å¿«é€Ÿåˆ é™¤å½“å‰è¡Œ ggåˆ°æ–‡æœ¬çš„ç¬¬ä¸€è¡Œ Gåˆ°æ–‡æœ¬çš„æœ€åä¸€è¡Œ :nåˆ°æ–‡æœ¬çš„ç¬¬nè¡Œ ------------------é‡ç‚¹------------------------- uundo,å–æ¶ˆä¸Šä¸€æ­¥æ“ä½œ Ctrl + rredo,è¿”å›åˆ°undoä¹‹å‰  -------------------é‡ç‚¹------------------------ Shift+ zzä¿å­˜é€€å‡ºï¼Œä¸â€œ:wqâ€ä½œç”¨ç›¸åŒ:qé€€å‡ºä¸ä¿å­˜:q!å¼ºåˆ¶é€€å‡ºä¸ä¿å­˜:wqä¿å­˜é€€å‡º:wq!å¼ºåˆ¶ä¿å­˜é€€å‡º</code></pre></div><h3 id="è½¯ä»¶ç›¸å…³å‘½ä»¤"><a href="#è½¯ä»¶ç›¸å…³å‘½ä»¤" class="headerlink" title="è½¯ä»¶ç›¸å…³å‘½ä»¤"></a>è½¯ä»¶ç›¸å…³å‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> rpm å‘½ä»¤</span>  å¸¸ç”¨å‚æ•°:      iï¼šå®‰è£…åº”ç”¨ç¨‹åºï¼ˆinstallï¼‰      eï¼šå¸è½½åº”ç”¨ç¨‹åºï¼ˆeraseï¼‰      vhï¼šæ˜¾ç¤ºå®‰è£…è¿›åº¦ï¼›ï¼ˆverbose   hashï¼‰       Uï¼šå‡çº§è½¯ä»¶åŒ…ï¼›ï¼ˆupdateï¼‰       qa: æ˜¾ç¤ºæ‰€æœ‰å·²å®‰è£…è½¯ä»¶åŒ…ï¼ˆquery allï¼‰ä¾‹å­ï¼šrmp  -ivh  gcc-c++-4.4.7-3.el6.x86_64.rpmå®‰è£… rpm -ivh  xxxx.rpm    rpm -evh  xxxx.rpm    rpm -Uvh  xxx.rpm    rpm -qa     <span class="hljs-meta">#</span><span class="bash"> yum å‘½ä»¤</span>`ä½¿ç”¨YUMå‘½ä»¤å¿…é¡»è¿æ¥å¤–éƒ¨ç½‘ç»œ`    ä¾‹å­ï¼š    yum  install  gcc-c++    yum  remove   gcc-c++    yum  update   gcc-c++        yum install|remove|update  ä¾èµ–åç§°</code></pre></div><h3 id="ç”¨æˆ·å’Œç»„ç›¸å…³å‘½ä»¤"><a href="#ç”¨æˆ·å’Œç»„ç›¸å…³å‘½ä»¤" class="headerlink" title="ç”¨æˆ·å’Œç»„ç›¸å…³å‘½ä»¤"></a>ç”¨æˆ·å’Œç»„ç›¸å…³å‘½ä»¤</h3><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1.æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼šwhoami</span><span class="hljs-meta">#</span><span class="bash"> 2.æŸ¥çœ‹ç™»å½•ç”¨æˆ·ï¼šwho</span>-mæˆ–am Iåªæ˜¾ç¤ºè¿è¡Œwhoå‘½ä»¤çš„ç”¨æˆ·åã€ç™»å½•ç»ˆç«¯å’Œç™»å½•æ—¶é—´-qæˆ–--countåªæ˜¾ç¤ºç”¨æˆ·çš„ç™»å½•è´¦å·å’Œç™»å½•ç”¨æˆ·çš„æ•°é‡<span class="hljs-meta">#</span><span class="bash"> 3.é€€å‡ºç”¨æˆ·:<span class="hljs-built_in">exit</span></span><span class="hljs-meta">#</span><span class="bash"> 4.æ·»åŠ ã€åˆ é™¤ç»„è´¦å·ï¼šgroupaddã€groupdel</span><span class="hljs-meta">#</span><span class="bash"> 5.æ·»åŠ ç”¨æˆ·è´¦å·ï¼šuseradd</span>-gæŒ‡å®šç»„åç§°  è¯´æ˜:å¦‚æœåˆ›å»ºç”¨æˆ·çš„æ—¶å€™ï¼Œä¸æŒ‡å®šç»„åï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå’Œç”¨æˆ·åä¸€æ ·çš„ç»„åã€‚<span class="hljs-meta">#</span><span class="bash"> 6.è®¾ç½®ç”¨æˆ·å¯†ç ï¼špasswdã€€[ç”¨æˆ·å]</span><span class="hljs-meta">#</span><span class="bash"> 7.su åˆ‡æ¢ç”¨æˆ·</span>su  root</code></pre></div><h3 id="æƒé™ç›¸å…³å‘½ä»¤"><a href="#æƒé™ç›¸å…³å‘½ä»¤" class="headerlink" title="æƒé™ç›¸å…³å‘½ä»¤"></a>æƒé™ç›¸å…³å‘½ä»¤</h3><blockquote><p>Linuxæ–‡ä»¶æœ‰ä¸‰ç§å…¸å‹çš„æƒé™ï¼Œ<code>å³rè¯»æƒé™ã€wå†™æƒé™å’Œxæ‰§è¡Œæƒé™</code>ã€‚åœ¨é•¿æ ¼å¼è¾“å‡ºä¸­åœ¨æ–‡ä»¶ç±»å‹çš„åé¢æœ‰9åˆ—æƒé™ä½ï¼Œå®é™…ä¸Šè¿™æ˜¯é’ˆå¯¹ä¸åŒç”¨æˆ·è€Œè®¾å®šçš„ã€‚<code>r=4ï¼Œw=2ï¼Œx=1</code></p></blockquote><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> chmod</span>   all = user + group + other   chmod  u+rwx,g+rwx,o+rwx   æ–‡ä»¶åå­—æ¯æ³•ï¼šchmod u/g/o/a +/-/= rwx æ–‡ä»¶    [ u/g/o/a ]å«ä¹‰    uuser è¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…    ggroup è¡¨ç¤ºä¸è¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…å±äºåŒä¸€ç»„( group )è€…ï¼Œå³ç”¨æˆ·ç»„    oother è¡¨ç¤ºå…¶ä»–ä»¥å¤–çš„äºº    aall è¡¨ç¤ºè¿™ä¸‰è€…çš†æ˜¯    [ +-= ]å«ä¹‰    +å¢åŠ æƒé™    -æ’¤é”€æƒé™    =è®¾å®šæƒé™    rwxå«ä¹‰    rread è¡¨ç¤ºå¯è¯»å–ï¼Œå¯¹äºä¸€ä¸ªç›®å½•ï¼Œå¦‚æœæ²¡æœ‰ræƒé™ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ä¸èƒ½é€šè¿‡lsæŸ¥çœ‹è¿™ä¸ªç›®å½•çš„å†…å®¹ã€‚    wwrite è¡¨ç¤ºå¯å†™å…¥ï¼Œå¯¹äºä¸€ä¸ªç›®å½•ï¼Œå¦‚æœæ²¡æœ‰wæƒé™ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ä¸èƒ½åœ¨ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æ–‡ä»¶ã€‚    xexcute è¡¨ç¤ºå¯æ‰§è¡Œï¼Œå¯¹äºä¸€ä¸ªç›®å½•ï¼Œå¦‚æœæ²¡æœ‰xæƒé™ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ä¸èƒ½é€šè¿‡cdè¿›å…¥è¿™ä¸ªç›®å½•ã€‚      æ•°å­—æ³•:   4è¯» 2å†™  1æ‰§è¡Œ      chmod 777 æ–‡ä»¶å</code></pre></div><h1 id="CRTé…ç½®"><a href="#CRTé…ç½®" class="headerlink" title="CRTé…ç½®"></a>CRTé…ç½®</h1><p><strong>è®¾ç½®linuxè·å–ipåœ°å€ (ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶)</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">vi /etc/sysconfig/network-scripts/ifcfg-ens33</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506194238775.png" alt="image-20210506194238775"></p><p><strong>ä¿®æ”¹ens33é…ç½®æ–‡ä»¶:</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">BOOTPROTO=dhcpONBOOT=yes</code></pre></div><p><strong>é‡å¯å¯åŠ¨ç½‘è·¯æœåŠ¡åŠ è½½ä¿®æ”¹é…ç½®ç”Ÿæ•ˆ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">systemctl restart network</code></pre></div><p><strong>æŸ¥çœ‹ipåœ°å€</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">ip addr</code></pre></div><p><strong>æ­¤æ—¶ipå·²ç»è·å–</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506194647423-0301639.png" alt="image-20210506194647423"></p><p><strong>æµ‹è¯•å¤–éƒ¨ç½‘ç»œè¿é€š(ä¿è¯å®¿ä¸»æœºå¯ä»¥ä¸Šç½‘å‰æ)</strong></p><div class="hljs code-wrapper"><pre><code>    ping www.baidu.com</code></pre></div><p><strong>ä½¿ç”¨CRTå·¥å…·è¿æ¥å³å¯</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506202557475.png" alt="image-20210506202557475"></p><h1 id="å®‰è£…JDK"><a href="#å®‰è£…JDK" class="headerlink" title="å®‰è£…JDK"></a>å®‰è£…JDK</h1><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œåˆ©ç”¨å‘½ä»¤<code>yum install vim</code>å®‰è£…vim</p><p><strong>åŒæ ·é‡è¦çš„åŠŸèƒ½ï¼Œå¿«ç…§</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506210740915.png" alt="image-20210506210740915"></p><p>èƒ½è®°å½•å½“å‰è™šæ‹Ÿæœºçš„çŠ¶æ€ï¼Œä»¥ä¾¿æ¢å¤åˆ°è®°å½•çš„æ—¶åˆ»é˜²æ­¢æ„å¤–å‘ç”Ÿ</p><p>ç„¶ååˆ©ç”¨FTPå·¥å…·ä¸Šä¼ JDKå®‰è£…åŒ…åˆ°Linuxä¸­</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506203930036.png" alt="image-20210506203930036"></p><p>å®‰è£…åˆ°<code>usr</code>ç›®å½•ä¸‹</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506204006667.png" alt="image-20210506204006667"></p><p>åœ¨è§£å‹ååˆ°jdkçš„<code>bin</code>ç›®å½•ä¸‹æŸ¥çœ‹javaç‰ˆæœ¬</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506204318398.png" alt="image-20210506204318398"></p><p>é…ç½®ç¯å¢ƒå˜é‡</p><div class="hljs code-wrapper"><pre><code class="hljs shell">vim /etc/profile<span class="hljs-meta">#</span><span class="bash">åœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥å¦‚ä¸‹é…ç½®</span>export JAVA_HOME=/usr/jdk1.8.0_202export PATH=$PATH:$JAVA_HOME/bin<span class="hljs-meta">#</span><span class="bash"> åŠ è½½é…ç½®ç”Ÿæ•ˆ</span>source /etc/profile    åŠ è½½é…ç½®ç”Ÿæ•ˆreboot                 é‡å¯ç³»ç»Ÿ<span class="hljs-meta">#</span><span class="bash">æ³¨æ„: ä»¥ä¸Šä¸¤ä¸ªé€‰é¡¹é€‰æ‹©ä»»æ„ä¸€ä¸ªå³å¯<span class="hljs-built_in">source</span>å¯ä»¥ä¸ç”¨é‡å¯ç«‹å³ç”Ÿæ•ˆ,æŸäº›æƒ…å†µä¸‹<span class="hljs-built_in">source</span>æ— æ³•ç”Ÿæ•ˆæ—¶,å¯ä»¥ä½¿ç”¨é‡å¯è¯•è¯•</span></code></pre></div><p>æ­¤æ—¶é…ç½®æˆåŠŸ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506205050362.png" alt="image-20210506205050362"></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>rpm</code>å‘½ä»¤å®‰è£…</p><div class="hljs code-wrapper"><pre><code class="hljs shell">rpm -ivh jdk-8u202-linux-x64.rpm <span class="hljs-meta">#</span><span class="bash">ç„¶åæœç´¢rpmçš„å®‰è£…ä½ç½®</span>whereis java<span class="hljs-meta">#</span><span class="bash">æˆ–è€…</span>find / -name &quot;java&quot;<span class="hljs-meta">#</span><span class="bash">é»˜è®¤åœ¨/usr/java/ä¸‹</span></code></pre></div><p>ç„¶ååŒç†äºä¸Šé¢tarå®‰è£…çš„æ­¥éª¤ï¼Œé…ç½®ç¯å¢ƒåå³å¯</p><h1 id="å®‰è£…Tomcat"><a href="#å®‰è£…Tomcat" class="headerlink" title="å®‰è£…Tomcat"></a>å®‰è£…Tomcat</h1><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><p>åŒç†ä¸Šä¼ åˆ°<code>usr</code>ç›®å½•ä¸‹å¹¶è§£å‹</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506211109844.png" alt="image-20210506211109844"></p><p><strong>å¯åŠ¨tomcat</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">./bin/startup.sh</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506211749770.png" alt="image-20210506211749770"></p><p><strong>æŸ¥çœ‹Tomcatæ˜¯å¦å¯åŠ¨</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506212029242.png" alt="image-20210506212029242"></p><p>ä½¿ç”¨<code>ps</code>æˆ–è€…<code>jps</code>ä¸¤ä¸ªå‘½ä»¤éƒ½å¯ä»¥æŸ¥çœ‹</p><p><strong>å…³é—­ç½‘ç»œé˜²ç«å¢™</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> systemctl stop firewalld   å…³é—­ç½‘ç»œé˜²ç«å¢™</span><span class="hljs-meta">$</span><span class="bash"> systemctl <span class="hljs-built_in">disable</span> firewalld  å…³é—­å¼€æœºè‡ªå¯åŠ¨(æ°¸ä¹…å…³é—­)</span></code></pre></div><p><strong>è®¿é—®tomcat</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">http://172.16.211.4:8080</code></pre></div><p>åœ¨<code>/conf/server.xml</code>ä¸‹å¯ä»¥ä¿®æ”¹ç«¯å£å·</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506212608053.png" alt="image-20210506212608053"></p><p><strong>æ˜¾ç¤ºtomcatå®æ—¶æ§åˆ¶å°ä¿¡æ¯ï¼ˆï¼‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">è¿›å…¥tomcatçš„logsç›®å½•ä¸­ä½¿ç”¨tail -f catalina.out å‘½ä»¤å®æ—¶æŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210506212757867.png" alt="image-20210506212757867"></p><p><strong>å…³é—­tomcat</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">åœ¨tomcatçš„binç›®å½•ä¸‹é¢ä½¿ç”¨ ./shutdown.sh</code></pre></div><p>æ­¤åˆ»Tomcatå·²ç»åœ¨Linuxéƒ¨ç½²å®Œæ¯•ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹åœ¨Linuxéƒ¨ç½²SpringBoot</p><p>éœ€è¦æ³¨æ„ä»¥jspä½œä¸ºæ¨¡æ¿æ—¶å€™çš„é—®é¢˜ï¼Œä½†ä¸æ¨èä»¥jpsä½œä¸ºæ¨¡æ¿ä½¿ç”¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/11.%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%ADjar%E5%8C%85%E6%96%B9%E5%BC%8F%E9%83%A8%E7%BD%B2springboot.png" alt="11.åœ¨linuxç³»ç»Ÿä¸­jaråŒ…æ–¹å¼éƒ¨ç½²springboot"></p><h1 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h1><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><ul><li>å¸è½½mariadbï¼Œå¦åˆ™å®‰è£…mysqlä¼šå‡ºç°å†²çª</li><li>æ‰§è¡Œå‘½ä»¤<code>rpm -qa | grep mariadb</code></li><li>åˆ—å‡ºæ‰€æœ‰è¢«å®‰è£…çš„mariadb rpm åŒ…ï¼›</li><li>æ‰§è¡Œå‘½ä»¤<code>rpm -e --nodeps mariadb-libs-5.5.xx-x.el7.x86_64</code>å¸è½½</li></ul><p><strong>å¼€å§‹å®‰è£…</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æ·»åŠ å®˜æ–¹çš„yumæºåˆ›å»ºå¹¶ç¼–è¾‘mysql-community.repoæ–‡ä»¶</span><span class="hljs-code">vi /etc/yum.repos.d/mysql-community.repo</span><span class="hljs-code"># 2.ç²˜è´´ä»¥ä¸‹å†…å®¹åˆ°æºæ–‡ä»¶ä¸­</span><span class="hljs-code">[mysql56-community]</span><span class="hljs-code">    name=MySQL 5.6 Community Server</span><span class="hljs-code">    baseurl=http://repo.mysql.com/yum/mysql-5.6 -community/el/7/$basearch/</span><span class="hljs-code">    enabled=1</span><span class="hljs-code">    gpgcheck=0</span><span class="hljs-code">    gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><span class="hljs-code">    </span><span class="hljs-code">   #æ³¨æ„:å¦‚æœéœ€è¦å®‰è£…mysql5.7åªéœ€è¦å°†baseurlä¿®æ”¹å³å¯ </span><span class="hljs-code">    baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/</span><span class="hljs-code"></span><span class="hljs-code"># 3.å®‰è£…mysql</span><span class="hljs-code">sudo yum install -y mysql-community-server</span></code></pre></div><p><strong>å¯åŠ¨ä¸ç™»å½•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å¯åŠ¨mysqlæ•°æ®åº“</span>systemctl start mysqld<span class="hljs-section"># 2.ä¿®æ”¹mysqlæ•°æ®åº“å¯†ç </span>mysqladmin -u root -p password å›è½¦ è¾“å…¥åŸå§‹å¯†ç  åœ¨è¾“å…¥æ–°çš„å¯†ç <span class="hljs-section">#æ³¨æ„:5.7ä¹‹å‰ç‰ˆæœ¬å®‰è£…å®Œæˆä¹‹åæ²¡æœ‰å¯†ç ,mysql5.7ä¹‹åçš„ç‰ˆæœ¬çš„åˆå§‹å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ”¾åœ¨äº†Â /var/log/mysqld.log</span><span class="hljs-section">#ä½¿ç”¨å‘½ä»¤Â grep â€˜temporary passwordâ€™ /var/log/mysqld.logÂ è¯»å‡ºæ¥å³å¯</span><span class="hljs-section"># 5.7å¼€å§‹mysqlä¸æ”¯æŒç®€å•å¯†ç ï¼Œä½¿ç”¨Root!123</span><span class="hljs-section"># 3.ç™»å½•mysql</span>mysql -u root -p</code></pre></div><p><strong>ç›®å½•</strong></p><p>æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„åœ¨<code>/var/lib/mysql</code></p><p>5.7ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶åœ¨<code>/usr/etc/my.cnf</code></p><p>ç›¸å…³å‘½ä»¤ç›®å½•åœ¨<code>/usr/bin</code></p><p><strong>é…ç½®æ–‡ä»¶</strong></p><p>åœ¨<code>my.cnf</code>ä¸‹æ·»åŠ </p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># ä¿®æ”¹å­—ç¬¦é›†</span>[mysqld]character-set-server=utf8 [client]default-character-set=utf8 [mysql]default-character-set=utf8</code></pre></div><p>é‡å¯mysqlï¼Œå¯ä»¥å‘ç°</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210508172907727.png" alt="image-20210508172907727"></p><p><strong>å¼€å¯è¿œç¨‹è®¿é—®</strong></p><p>å¼€å¯æˆæƒï¼Œè®©æ‰€æœ‰æœºå™¨éƒ½å¯è®¿é—®ï¼Œåœ¨é…ç½®ä¸»ä»æœºçš„æ—¶å€™åŒæ ·é€‚ç”¨</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210507160110862.png" alt="image-20210507160110862"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210507160339587.png" alt="image-20210507160339587"></p><p><strong>å·²ç»è¿æ¥æˆåŠŸ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210507160436771.png" alt="image-20210507160436771"></p><h1 id="å®‰è£…MyCat"><a href="#å®‰è£…MyCat" class="headerlink" title="å®‰è£…MyCat"></a>å®‰è£…MyCat</h1><blockquote><p>å®ç°è¯»å†™åˆ†ç¦»çš„ä¸­é—´ä»¶ï¼Œä¹Ÿæ˜¯MySQLå¸¸ç”¨çš„è½¯ä»¶</p></blockquote><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ä¸‹è½½mycat</span><span class="hljs-code">http://dl.mycat.io/1.6-RELEASE/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz</span><span class="hljs-code"></span><span class="hljs-code"># 2.è§£å‹mycat</span><span class="hljs-code">tar -zxvf Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191014225929256.png" alt="image-20191014225929256"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.æŸ¥çœ‹è§£å‹ä¹‹åç›®å½•]</span><span class="hljs-code">[root@localhost mycat]# ls</span><span class="hljs-code">æ€»ç”¨é‡ 12</span><span class="hljs-code">drwxr-xr-x. 2 root root  190 10æœˆ 14 22:58 bin</span><span class="hljs-code">drwxrwxrwx. 2 root root    6 3æœˆ   1 2016 catlet</span><span class="hljs-code">drwxrwxrwx. 4 root root 4096 10æœˆ 14 22:58 conf</span><span class="hljs-code">drwxr-xr-x. 2 root root 4096 10æœˆ 14 22:58 lib</span><span class="hljs-code">drwxrwxrwx. 2 root root    6 10æœˆ 28 2016 logs</span><span class="hljs-code">-rwxrwxrwx. 1 root root  217 10æœˆ 28 2016 version.txt</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20191014230002014.png" alt="image-20191014230002014"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 4.ç§»åŠ¨åˆ°/usrç›®å½•</span><span class="hljs-code">mv mycat/ /usr/</span><span class="hljs-code"></span><span class="hljs-code"># 5.é…ç½®mycatä¸­confä¸‹çš„é…ç½®schema.xml</span><span class="hljs-code">å…ˆåˆ é™¤åŸæœ‰çš„å†…å®¹ï¼ŒåŠ å…¥ä»¥ä¸‹é…ç½®</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å®šä¹‰MyCatçš„é€»è¾‘åº“  dataNodeè¡¨ç¤ºæ˜ å°„çš„çœŸå®èŠ‚ç‚¹--&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;test_schema&quot;</span> <span class="hljs-attr">checkSQLschema</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">sqlMaxLimit</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">dataNode</span>=<span class="hljs-string">&quot;testNode&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">schema</span>&gt;</span> <span class="hljs-comment">&lt;!--å®šä¹‰MyCatçš„æ•°æ®èŠ‚ç‚¹ nameä¸dataNodeä¸€è‡´ï¼ŒdataHostæ˜ å°„çœŸå®ä¸»æœºï¼Œdatabaseæ˜ å°„çœŸå®çš„åº“--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dataNode</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;testNode&quot;</span> <span class="hljs-attr">dataHost</span>=<span class="hljs-string">&quot;dtHost&quot;</span> <span class="hljs-attr">database</span>=<span class="hljs-string">&quot;test&quot;</span> /&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰æ•°æ®ä¸»æœº nameå’ŒdataHostä¸€è‡´   --&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">dataHost</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dtHost&quot;</span> <span class="hljs-attr">maxCon</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">minCon</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">balance</span>=<span class="hljs-string">&quot;1&quot;</span>     <span class="hljs-attr">writeType</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">dbType</span>=<span class="hljs-string">&quot;mysql&quot;</span> <span class="hljs-attr">dbDriver</span>=<span class="hljs-string">&quot;native&quot;</span> <span class="hljs-attr">switchType</span>=<span class="hljs-string">&quot;-1&quot;</span>     <span class="hljs-attr">slaveThreshold</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span>  <span class="hljs-comment">&lt;!--å¿ƒè·³é…ç½®   --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">heartbeat</span>&gt;</span>select user()<span class="hljs-tag">&lt;/<span class="hljs-name">heartbeat</span>&gt;</span>                <span class="hljs-comment">&lt;!--å†™èŠ‚ç‚¹--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">writeHost</span> <span class="hljs-attr">host</span>=<span class="hljs-string">&quot;hostM1&quot;</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;192.168.28.128:3306&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;root&quot;</span><span class="hljs-attr">password</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>                 <span class="hljs-comment">&lt;!--ä»èŠ‚ç‚¹--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">readHost</span> <span class="hljs-attr">host</span>=<span class="hljs-string">&quot;hostS1&quot;</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;192.168.28.129:3306&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;root&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">writeHost</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">dataHost</span>&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 6.é…ç½®ç™»é™†mycatçš„æƒé™server.xml</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span>  <span class="hljs-comment">&lt;!-- è¿™é‡Œé…ç½®çš„éƒ½æ˜¯ä¸€äº›ç³»ç»Ÿå±æ€§ï¼Œå¯ä»¥è‡ªå·±æŸ¥çœ‹mycatæ–‡æ¡£--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultSqlParser&quot;</span>&gt;</span>druidparser<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-comment">&lt;!--5.xxå¿…é¡»æ˜¯utf-8ï¼Œ8.xxä¸ºutf8mb4   --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;charset&quot;</span>&gt;</span>utf8<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">system</span>&gt;</span><span class="hljs-comment">&lt;!--é…ç½®ç”¨æˆ·ä¿¡æ¯--&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">user</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>  <span class="hljs-comment">&lt;!--æŒ‡å®šå¯ä»¥æ“ä½œçš„é€»è¾‘åº“--&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;schemas&quot;</span>&gt;</span>test_schema<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 7.åœ¨binç›®å½•ä¸‹å¯åŠ¨mycat</span><span class="hljs-code"> ./mycat console</span><span class="hljs-code"></span><span class="hljs-code"># 8.æŸ¥çœ‹æ—¥å¿—</span><span class="hljs-code">tail -f ../logs/mycat.log</span><span class="hljs-code"></span><span class="hljs-code"># 9.æ•°æ®åº“è¿æ¥é…ç½®,æµ‹è¯•</span></code></pre></div><h1 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h1><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># ä¸‹è½½Nginx</span>   wget http://nginx.org/download/nginx-1.17.0.tar.gz<span class="hljs-section"># ç„¶åè§£å‹ä¸‹è½½çš„ç›®å½•ï¼Œè¿›å…¥è§£å‹ç›®å½•ä¸­ï¼Œåœ¨ç¼–è¯‘å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š</span><span class="hljs-code"> yum -y install pcre-devel</span><span class="hljs-code"> yum -y install openssl openssl-devel</span><span class="hljs-code"></span><span class="hljs-code"># ç„¶åå¼€å§‹ç¼–è¯‘å®‰è£…ï¼š</span><span class="hljs-code">./configure</span><span class="hljs-code">make</span><span class="hljs-code">make install</span><span class="hljs-code"></span><span class="hljs-code"># è£…å¥½ä¹‹åï¼Œé»˜è®¤å®‰è£…ä½ç½®åœ¨:</span><span class="hljs-code">/usr/local/nginx/sbin/nginx</span><span class="hljs-code"></span><span class="hljs-code"># å¯åŠ¨nginx,è¿›å…¥nginxå®‰è£…ç›®å½•çš„sbinç›®å½•ä¸­æ‰§è¡Œ:</span><span class="hljs-code">./nginx</span><span class="hljs-code">ps -aux|grep nginx</span><span class="hljs-code"></span><span class="hljs-code"># æµè§ˆå™¨è®¿é—®,å¯ä»¥çœ‹åˆ°nginxæ¬¢è¿é¡µé¢:</span><span class="hljs-code">http://172.16.211.4:80/</span><span class="hljs-code">æ³¨æ„:å…³é—­ç½‘ç»œé˜²ç«å¢™</span><span class="hljs-code"></span><span class="hljs-code"># å…³é—­nginx,è¿›å…¥nginxå®‰è£…ç›®å½•çš„sbinç›®å½•ä¸­æ‰§è¡Œ:</span><span class="hljs-code">./nginx -s stop</span><span class="hljs-code"></span><span class="hljs-code"># 1nginxé…ç½®æ–‡ä»¶åœ¨nginxå®‰è£…ç›®å½•çš„confç›®å½•ä¸­:</span><span class="hljs-code">[root@localhost conf]# ls -l</span><span class="hljs-code">æ€»ç”¨é‡ 60</span><span class="hljs-code">-rw-r--r--. 1 root root 2656 10æœˆ 14 21:17 nginx.conf</span><span class="hljs-code">.......</span><span class="hljs-code">æ³¨æ„:nginx.confä¸ºnginxçš„é…ç½®æ–‡ä»¶,å¯ä»¥åœ¨nginx.confä¿®æ”¹nginxé»˜è®¤é…ç½®</span></code></pre></div><h1 id="å®‰è£…Redis"><a href="#å®‰è£…Redis" class="headerlink" title="å®‰è£…Redis"></a>å®‰è£…Redis</h1><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 0.å‡†å¤‡ç¯å¢ƒ</span><span class="hljs-bullet">-</span> vmware15.x+<span class="hljs-bullet">-</span> centos7.x+<span class="hljs-section"># 1.ä¸‹è½½redisæºç åŒ…</span><span class="hljs-bullet">-</span> https://redis.io/</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623121621195.png" alt="image-20200623121621195"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 2.ä¸‹è½½å®Œæ•´æºç åŒ…</span><span class="hljs-bullet">-</span> redis-4.0.10.tar.gz</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20200623123918876.png" alt="image-20200623123918876"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 3.å°†ä¸‹è½½redisèµ„æ–™åŒ…ä¸Šä¼ åˆ°Linuxä¸­</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210511115817995.png" alt="image-20210511115817995"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 4.è§£å‹ç¼©æ–‡ä»¶</span>[root@localhost ~]# tar -zxvf redis-4.0.10.tar.gz[root@localhost ~]# ll</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210511115856761.png" alt="image-20210511115856761"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 5.å®‰è£…gcc  </span><span class="hljs-bullet">-</span> yum install -y gcc<span class="hljs-section"># 6.è¿›å…¥è§£å‹ç¼©ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="hljs-bullet">-</span> make MALLOC=libc<span class="hljs-section"># 7.ç¼–è¯‘å®Œæˆåæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="hljs-bullet">-</span> make install PREFIX=/usr/redis<span class="hljs-section"># 8.è¿›å…¥/usr/redisç›®å½•å¯åŠ¨redisæœåŠ¡ </span><span class="hljs-bullet">-</span> ./redis-server</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210511120413476.png" alt="image-20210511120413476"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 9.RedisæœåŠ¡ç«¯å£é»˜è®¤æ˜¯ 6379</span><span class="hljs-section"># 10.è¿›å…¥binç›®å½•æ‰§è¡Œå®¢æˆ·ç«¯è¿æ¥æ“ä½œ</span><span class="hljs-bullet">-</span>  ./redis-cli -h localhost -p 6379 <span class="hljs-bullet">-</span>  å› ä¸ºæ˜¯æœ¬æœºï¼Œæ‰€ä»¥ ./redis-cliå°±å¯ä»¥è¿æ¥</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210511120701317.png" alt="image-20210511120701317"></p><p>é»˜è®¤åœ¨å®‰è£…redisåï¼Œå®‰è£…ç›®å½•æ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶ï¼Œéœ€è¦<strong>æ‹·è´åŸç ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶<code>redis.conf</code>åˆ°usrä¸‹çš„redisç›®å½•ä¸‹</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210511121238577.png" alt="image-20210511121238577"></p><p>ä»¥åŠ è½½é…ç½®æ–‡ä»¶çš„å¯åŠ¨</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> ./redis-server ../redis.conf</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># 11.å¼€å¯è¿œç¨‹è¿æ¥</span><span class="hljs-bullet">-</span>  vim redis.conf</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210512102805521.png" alt="image-20210512102805521"></p><p>é‡å¯åç”Ÿæ•ˆï¼Œè¿æ¥æˆåŠŸ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210512103002519.png" alt="image-20210512103002519"></p><h1 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h1><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown">yum -y update<span class="hljs-section"># Erlangåœ¨é»˜è®¤çš„YUMå­˜å‚¨åº“ä¸­ä¸å¯ç”¨ï¼Œå› æ­¤æ‚¨å°†éœ€è¦å®‰è£…EPELå­˜å‚¨åº“</span>yum -y install epel-releaseyum -y update<span class="hljs-section"># å®‰è£…Erlang</span>yum -y install erlang socat<span class="hljs-section"># æŸ¥çœ‹å®‰è£…åErlangçš„ç‰ˆæœ¬</span>erl -version</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526115805077.png" alt="image-20210526115805077"></p><p><strong>æ­£å¼å®‰è£…</strong></p><p>ä¸Šä¼ æ–‡ä»¶è‡³linux</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526120554574.png" alt="image-20210526120554574"></p><div class="hljs code-wrapper"><pre><code class="hljs markdown">yum install rabbitmq-server-3.6.10-1.el7.noarch.rpm</code></pre></div><p><strong>ä½¿ç”¨å‘½ä»¤</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># è¿è¡Œ</span>systemctl start rabbitmq-server<span class="hljs-section"># è‡ªå¯åŠ¨</span>systemctl enable rabbitmq-server<span class="hljs-section"># æŸ¥çœ‹çŠ¶æ€</span>systemctl status rabbitmq-server</code></pre></div><p><strong>ç”¨æˆ·ç›¸å…³</strong></p><p>é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯guest</p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># æŸ¥çœ‹ç”¨æˆ·</span>sudo rabbitmqctl list<span class="hljs-emphasis">_users</span><span class="hljs-emphasis"># æ·»åŠ ç”¨æˆ·</span><span class="hljs-emphasis">rabbitmqctl add_</span>user username passwordrabbitmqctl set<span class="hljs-emphasis">_user_</span>tags username administrator<span class="hljs-section"># èµ‹äºˆç”¨æˆ·é»˜è®¤çš„å…¨éƒ¨æ“ä½œæƒé™</span>rabbitmqctl set<span class="hljs-emphasis">_permissions -p / username â€œ.*â€ â€œ.*â€ â€œ.*â€</span></code></pre></div><p><strong>å¼€å¯webæ§åˆ¶å°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section"># å¯åŠ¨RabbitMQ Webç®¡ç†æ§åˆ¶å°</span>rabbitmq-plugins enable rabbitmq<span class="hljs-emphasis">_management</span><span class="hljs-emphasis"># å°†RabbitMQæ–‡ä»¶çš„æ‰€æœ‰æƒæä¾›ç»™RabbitMQç”¨æˆ·</span><span class="hljs-emphasis">chown -R rabbitmq:rabbitmq /var/lib/rabbitmq/</span><span class="hljs-emphasis"># url</span><span class="hljs-emphasis">http://Your_</span>Server<span class="hljs-emphasis">_IP:15672/</span></code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210526122044856.png" alt="image-20210526122044856"></p><p><strong>å¼€å¯è¿œç¨‹è®¿é—®</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQçš„é»˜è®¤çš„<code>guest</code>ç”¨æˆ·åªå…è®¸æœ¬æœºè®¿é—®ï¼Œ å¦‚æœæƒ³è®©<code>guest</code>ç”¨æˆ·èƒ½å¤Ÿè¿œç¨‹è®¿é—®çš„è¯ï¼Œåªéœ€è¦å°†é…ç½®æ–‡ä»¶ä¸­çš„<code>loopback_users</code>åˆ—è¡¨ç½®ä¸ºç©ºå³å¯</p><div class="hljs code-wrapper"><pre><code class="hljs markdown">cd /etc/rabbitmq/<span class="hljs-section"># é»˜è®¤æ˜¯æ²¡æœ‰é…ç½®æ–‡ä»¶çš„ï¼Œéœ€è¦è‡ªå·±åˆ›å»º</span>vim rabbitmq.config<span class="hljs-section"># åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹</span>[&#123;rabbit, [&#123;loopback<span class="hljs-emphasis">_users, []&#125;]&#125;]</span><span class="hljs-emphasis"># é‡å¯æœåŠ¡å³å¯</span></code></pre></div><h1 id="å®‰è£…FastDFS"><a href="#å®‰è£…FastDFS" class="headerlink" title="å®‰è£…FastDFS"></a>å®‰è£…FastDFS</h1><p><strong>ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†</strong></p><ul><li><strong>Tracker å®‰è£…</strong></li><li><strong>Storage å®‰è£…</strong></li></ul><h2 id="Tracker-å®‰è£…"><a href="#Tracker-å®‰è£…" class="headerlink" title="Tracker å®‰è£…"></a>Tracker å®‰è£…</h2><p>ç”±äº FastDFS é‡‡ç”¨ C è¯­è¨€å¼€å‘ï¼Œæ‰€ä»¥åœ¨å®‰è£…ä¹‹å‰ï¼Œå¦‚æœæ²¡æœ‰ gcc ç¯å¢ƒï¼Œéœ€è¦å…ˆå®‰è£…ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs shell">yum install gcc-c++</code></pre></div><p>å†æ¥çœ‹ä¸¤ä¸ªåº“ï¼Œç”±äº <strong>FastDFS ä¾èµ– libevent åº“</strong>ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> libevent</code></pre></div><p><strong>å¦ä¸€ä¸ªåº“æ˜¯ libfastcommon</strong>ï¼Œè¿™æ˜¯ FastDFS å®˜æ–¹æä¾›çš„ï¼Œå®ƒåŒ…å«äº† FastDFS è¿è¡Œæ‰€éœ€è¦çš„ä¸€äº›åŸºç¡€åº“ã€‚</p><p>libfastcommon ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/happyfish100/libfastcommon/archive/V1.0.43.tar.gz">https://github.com/happyfish100/libfastcommon/archive/V1.0.43.tar.gz</a></p><p>å°†ä¸‹è½½å¥½çš„ libfastcommon æ‹·è´è‡³ /usr/local/ ç›®å½•ä¸‹ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> /usr/localtar -zxvf V1.<span class="hljs-number">0.43</span>.tar.gz<span class="hljs-keyword">cd</span> libfastcommon-<span class="hljs-number">1.0</span>.<span class="hljs-number">43</span>/./<span class="hljs-keyword">make</span>.<span class="hljs-keyword">sh</span>./<span class="hljs-keyword">make</span>.<span class="hljs-keyword">sh</span> install</code></pre></div><p><strong>æ¥ä¸‹æ¥ä¸‹è½½ Tracker</strong>ï¼Œæ³¨æ„ï¼Œç”±äº Tracker å’Œ Storage æ˜¯ç›¸åŒçš„å®‰è£…åŒ…ï¼Œæ‰€ä»¥ä¸‹è½½ä¸€æ¬¡å³å¯</p><p>å®‰è£…æ–‡ä»¶å¯ä»¥ä» FastDFS çš„ GitHub ä»“åº“ä¸Šä¸‹è½½ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/happyfish100/fastdfs/archive/V6.06.tar.gz">https://github.com/happyfish100/fastdfs/archive/V6.06.tar.gz</a></p><p>ä¸‹è½½æˆåŠŸåï¼Œå°†ä¸‹è½½æ–‡ä»¶æ‹·è´åˆ° /usr/local ç›®å½•ä¸‹ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> /usr/localtar -zxvf V6.<span class="hljs-number">06</span>.tar.gz<span class="hljs-keyword">cd</span> fastdfs-<span class="hljs-number">6.06</span>/./<span class="hljs-keyword">make</span>.<span class="hljs-keyword">sh</span>./<span class="hljs-keyword">make</span>.<span class="hljs-keyword">sh</span> install</code></pre></div><p>å®‰è£…æˆåŠŸåï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†å®‰è£…ç›®å½•å†… conf ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ° /etc/fdfs ç›®å½•ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk">cd conf/cp .<span class="hljs-regexp">/* /</span>etc<span class="hljs-regexp">/fdfs/</span></code></pre></div><p><strong>æ¥ä¸‹æ¥è¿›å…¥ /etc/fdfs/ ç›®å½•ä¸‹è¿›è¡Œé…ç½®</strong>ï¼š</p><p>æ‰“å¼€ tracker.conf æ–‡ä»¶ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">vi</span> tracker.<span class="hljs-keyword">conf</span></code></pre></div><p>ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼š</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712152953238.png" alt="image-20210712152953238"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712153240483.png" alt="image-20210712153240483"></p><p>æ¥ä¸‹æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤<strong>å¯åŠ¨ Trackerï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/fdfs_trackerd /</span>etc<span class="hljs-regexp">/fdfs/</span>tracker.conf start</code></pre></div><p>å¦‚æ­¤ä¹‹åï¼Œæˆ‘ä»¬çš„ Tracker å°±ç®—å®‰è£…æˆåŠŸäº†ã€‚</p><h2 id="Storage-å®‰è£…"><a href="#Storage-å®‰è£…" class="headerlink" title="Storage å®‰è£…"></a>Storage å®‰è£…</h2><p>Storage å®‰è£…ä¹Ÿéœ€è¦ libevent å’Œ libfastcommonï¼Œè¿™ä¸¤ä¸ªåº“çš„å®‰è£…å‚è€ƒä¸Šæ–‡</p><p>Storage æœ¬èº«çš„å®‰è£…ï¼Œä¹Ÿå’Œ Tracker ä¸€è‡´ï¼Œæ‰§è¡Œå‘½ä»¤ä¹Ÿéƒ½ä¸€æ ·ï¼Œå› ä¸ºæˆ‘è¿™é‡Œå°† Tracker å’Œ Storage å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥ä¸ç”¨å†æ‰§è¡Œå®‰è£…å‘½ä»¤äº†ï¼ˆç›¸å½“äºå®‰è£… Tracker æ—¶å·²ç»å®‰è£…äº† Storage äº†ï¼‰</p><p><strong>å”¯ä¸€è¦åšçš„ï¼Œå°±æ˜¯è¿›å…¥åˆ° /etc/fdfs ç›®å½•ä¸‹ï¼Œé…ç½® Storageï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">vi</span> storage.<span class="hljs-keyword">conf</span></code></pre></div><p>è¿™é‡Œä¸€å…±é…ç½®ä¸‰ä¸ªåœ°æ–¹ï¼Œåˆ†åˆ«æ˜¯ <strong>base_pathã€store_path0 ä»¥åŠ tracker_server</strong> ï¼Œ<strong>base_pathã€store_path0</strong>åœ°å€ç›¸åŒï¼Œ<strong>tracker_server</strong> æ¨¡æ¿æœ‰ä¸¤ä¸ªåœ°å€ï¼Œæˆ‘ä»¬è¿™é‡Œåªæœ‰ä¸€ä¸ªï¼Œé…ç½®å®Œæˆåï¼Œè®°å¾—æ³¨é‡Šæ‰å¦å¤–ä¸€ä¸ªä¸ç”¨çš„ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712153654415.png" alt="image-20210712153654415"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712153829253.png" alt="image-20210712153829253"></p><p>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨ Storageï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/fdfs_storaged /</span>etc<span class="hljs-regexp">/fdfs/</span>storage.conf start</code></pre></div><p>è¿™ä¸¤ä¸ªå¯åŠ¨å®Œæˆåï¼Œç°åœ¨å°±å¯ä»¥åšæ–‡ä»¶çš„ä¸Šä¼ äº†ï¼Œä½†æ˜¯ä¸€èˆ¬å¦‚æœæ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œ<strong>æˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªå›¾ç‰‡çš„è®¿é—®åŠŸèƒ½ï¼Œç›®å‰æ¥è¯´æœ€ä½³æ–¹æ¡ˆå½“ç„¶æ˜¯ Nginx</strong> ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè¿åŒ Nginx ä¸€èµ·é…ç½®å¥½ï¼Œå†æ¥åšæµ‹è¯•ã€‚</p><h2 id="fastdfs-nginx-module"><a href="#fastdfs-nginx-module" class="headerlink" title="fastdfs-nginx-module"></a>fastdfs-nginx-module</h2><p>å›¾ç‰‡ä¸Šä¼ æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ FastDFSï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸä¹‹åï¼Œæ¥ä¸‹æ¥çš„å›¾ç‰‡è®¿é—®æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ Nginxï¼ŒNginxå®‰è£…å·²ç»å®Œæˆï¼Œç°åœ¨å¼€å§‹å®‰è£…ä¸‹è½½ fastdfs-nginx-moduleï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.22.tar.gz">https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.22.tar.gz</a></p><p>ä¸‹è½½å®Œæˆåï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶<strong>æ‹·è´åˆ° /usr/local</strong> ç›®å½•ä¸‹ã€‚ç„¶åè¿›å…¥ /usr/local ç›®å½•ï¼Œåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> /usr/local<span class="hljs-attribute">tar</span> -zxvf V<span class="hljs-number">1</span>.<span class="hljs-number">22</span>.tar.gz</code></pre></div><p>ç„¶åå°† <code>/usr/local/fastdfs-nginx-module-1.22/src/mod_fastdfs.conf</code> æ–‡ä»¶æ‹·è´åˆ° <code>/etc/fdfs/</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹è¯¥æ–‡ä»¶çš„å†…å®¹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>fdfs/mod_fastdfs.conf</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712155658437.png" alt="image-20210712155658437"></p><p>æ¥ä¸‹æ¥ï¼Œå›åˆ°ç¬¬ä¸€æ­¥ä¸‹è½½çš„ nginx å®‰è£…æ–‡ä»¶çš„è§£å‹ç›®å½•ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œé‡æ–°é…ç½®ç¼–è¯‘å®‰è£…ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk">.<span class="hljs-regexp">/configure --add-module=/u</span>sr<span class="hljs-regexp">/local/</span>fastdfs-nginx-module-<span class="hljs-number">1.22</span>/srcmakemake install</code></pre></div><p>å®‰è£…å®Œæˆåï¼Œä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs awk">vi <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210712163039593.png" alt="image-20210712163039593"></p><p>åœ¨è¿™é‡Œé…ç½® nginx è¯·æ±‚è½¬å‘ã€‚</p><p>é…ç½®å®Œæˆåï¼Œå¯åŠ¨ nginxï¼Œçœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼Œè¡¨ç¤º nginx å¯åŠ¨æˆåŠŸï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs routeros">ngx_http_fastdfs_set <span class="hljs-attribute">pid</span>=9908</code></pre></div><p><strong>ç–‘é—®ï¼šfastdfs-nginx-module æœ‰å•¥ç”¨</strong></p><p>åˆ°å¤´æ¥è¿˜æ˜¯ nginx æœ¬èº«ç›´æ¥æ‰¾åˆ°äº†å›¾ç‰‡æ–‡ä»¶ç›®å½•ï¼Œfastdfs-nginx-module åˆ°åº•æœ‰å•¥ç”¨ï¼Ÿ</p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒStorage ç”±å¾ˆå¤šç»„æ„æˆï¼Œæ¯ä¸ªç»„åˆæ˜¯ä¸€ä¸ªå°çš„é›†ç¾¤ï¼Œåœ¨æ¯ä¸€ä¸ªç»„é‡Œè¾¹ï¼Œæ•°æ®ä¼šè¿›è¡ŒåŒæ­¥ï¼Œä½†æ˜¯å¦‚æœæ•°æ®è¿˜æ²¡åŒæ­¥ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰è¯·æ±‚å‘æ¥äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæ­¤æ—¶fastdfs-nginx-module ä¼šå¸®åŠ©æˆ‘ä»¬ç›´æ¥ä»æº Storage ä¸Šè·å–æ–‡ä»¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é…ç½®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <link href="/2021/07/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    <url>/2021/07/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><blockquote><p>æœ¬ç¬”è®°æ˜¯æ ¹æ®ç‹é“è€ƒç ”æ‰€è®²çš„æ“ä½œç³»ç»Ÿæ‰€åšçš„ç¬”è®°ï¼Œè€å¸ˆè®²è¯¾é£æ ¼è¯™è°å¹½é»˜ï¼Œå€¼å¾—ä¸€çœ‹</p></blockquote><h1 id="ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"><a href="#ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"></a>ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°</h1><h2 id="1-æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µã€ç‰¹å¾ã€åŠŸèƒ½ã€ç›®æ ‡"><a href="#1-æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µã€ç‰¹å¾ã€åŠŸèƒ½ã€ç›®æ ‡" class="headerlink" title="1.æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µã€ç‰¹å¾ã€åŠŸèƒ½ã€ç›®æ ‡"></a>1.æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µã€ç‰¹å¾ã€åŠŸèƒ½ã€ç›®æ ‡</h2><blockquote><p>æ“ä½œç³»ç»Ÿï¼ˆ Operating Systemï¼ŒOSï¼‰æ˜¯æŒ‡æ§åˆ¶å’Œç®¡ç†æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºï¼Œå¹¶åˆç†åœ°ç»„ç»‡è°ƒåº¦è®¡ç®—æœºçš„å·¥ä½œå’Œèµ„æºçš„åˆ†é…ï¼Œä»¥æä¾›ç»™ç”¨æˆ·å’Œå…¶ä»–è½¯ä»¶æ–¹ä¾¿çš„æ¥å£å’Œç¯å¢ƒçš„ç¨‹åºé›†åˆã€‚è®¡ç®—æœºæ“ä½œç³»ç»Ÿæ˜¯éšç€è®¡ç®—æœºç ”ç©¶å’Œåº”ç”¨çš„å‘å±•é€æ­¥å½¢æˆå¹¶å‘å±•èµ·æ¥çš„ï¼Œå®ƒæ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­æœ€åŸºæœ¬çš„ç³»ç»Ÿè½¯ä»¶</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200401222215527.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-1-æ“ä½œç³»ç»Ÿçš„ç‰¹å¾"><a href="#1-1-æ“ä½œç³»ç»Ÿçš„ç‰¹å¾" class="headerlink" title="1.1 æ“ä½œç³»ç»Ÿçš„ç‰¹å¾"></a>1.1 æ“ä½œç³»ç»Ÿçš„ç‰¹å¾</h3><blockquote><p>æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾åŒ…æ‹¬å¹¶å‘ã€å…±äº«ã€è™šæ‹Ÿå’Œå¼‚æ­¥</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200528183517102.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-1-1-å¹¶å‘-Concurrence"><a href="#1-1-1-å¹¶å‘-Concurrence" class="headerlink" title="1.1.1 å¹¶å‘(Concurrence)"></a>1.1.1 å¹¶å‘(Concurrence)</h4><p><code>å¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å†…å‘ç”Ÿ</code>ã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œä¸€æ®µæ—¶é—´å†…å®è§‚ä¸Šæœ‰å¤šé“ç¨‹åºåœ¨åŒæ—¶æ‰§è¡Œï¼Œè€Œåœ¨æ¯ä¸€æ—¶åˆ»ï¼Œå•å¤„ç†æœºç¯å¢ƒä¸‹å®é™…ä»…èƒ½æœ‰ä¸€é“ç¨‹åºæ‰§è¡Œï¼Œæ•…å¾®è§‚ä¸Šè¿™äº›ç¨‹åºè¿˜æ˜¯åœ¨åˆ†æ—¶åœ°äº¤æ›¿æ‰§è¡Œã€‚æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§æ˜¯é€šè¿‡åˆ†æ—¶å¾—ä»¥å®ç°çš„ã€‚</p><p><strong>è™½ç„¶ç°åœ¨CPUå¾ˆå¤šéƒ½æ˜¯å¤šæ ¸çš„,ä½†æ˜¯ç¨‹åºæœ‰å¯èƒ½å¾ˆå¤š,æ‰€ä»¥å¹¶å‘è¿˜æ˜¯å¾ˆé‡è¦.</strong></p><h4 id="1-1-2-å…±äº«-Sharing"><a href="#1-1-2-å…±äº«-Sharing" class="headerlink" title="1.1.2 å…±äº«(Sharing)"></a>1.1.2 å…±äº«(Sharing)</h4><p>èµ„æºå…±äº«å³å…±äº«ï¼Œæ˜¯æŒ‡ç³»ç»Ÿä¸­çš„èµ„æºå¯ä¾›å†…å­˜ä¸­å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å…±åŒä½¿ç”¨ã€‚å…±äº«å¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§èµ„æºå…±äº«æ–¹å¼</p><ul><li><strong>äº’æ–¥å…±äº«æ–¹å¼</strong> ç³»ç»Ÿä¸­çš„æŸäº›èµ„æºï¼Œå¦‚æ‰“å°æœºã€ç£å¸¦æœºï¼Œ<code>è™½ç„¶å®ƒä»¬å¯ä»¥æä¾›ç»™å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä½†ä¸ºä½¿æ‰€æ‰“å°æˆ–è®°å½•çš„ç»“æœä¸è‡´é€ æˆæ··æ·†ï¼Œåº”è§„å®šåœ¨ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æº</code>ã€‚ä¸ºæ­¤ï¼Œå½“è¿›ç¨‹Aè®¿é—®æŸèµ„æºæ—¶ï¼Œå¿…é¡»å…ˆæå‡ºè¯·æ±‚ï¼Œå¦‚æœæ­¤æ—¶è¯¥èµ„æºç©ºé—²ï¼Œç³»ç»Ÿä¾¿å¯å°†ä¹‹åˆ†é…ç»™è¿›ç¨‹Aä½¿ç”¨ï¼Œæ­¤åè‹¥å†æœ‰å…¶ä»–è¿›ç¨‹ä¹Ÿè¦è®¿é—®è¯¥èµ„æºæ—¶ï¼ˆåªè¦Aæœªç”¨å®Œï¼‰åˆ™å¿…é¡»ç­‰å¾…ã€‚ä»…å½“è¿›ç¨‹Aè®¿é—®å®Œå¹¶é‡Šæ”¾è¯¥èµ„æºåï¼Œæ‰å…è®¸å¦ä¸€è¿›ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®ã€‚æˆ‘ä»¬æŠŠè¿™ç§èµ„æºå…±äº«æ–¹å¼ç§°ä¸ºäº’æ–¥å¼å…±äº«ï¼Œè€ŒæŠŠåœ¨ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºæˆ–ç‹¬å èµ„æºã€‚è®¡ç®—æœºç³»ç»Ÿä¸­çš„å¤§å¤šæ•°ç‰©ç†è®¾å¤‡ï¼Œä»¥åŠæŸäº›è½¯ä»¶ä¸­æ‰€ç”¨çš„æ ˆã€å˜é‡å’Œè¡¨æ ¼ï¼Œéƒ½å±äºä¸´ç•Œèµ„æºï¼Œå®ƒä»¬éƒ½è¦æ±‚è¢«äº’æ–¥åœ°å…±äº«</li><li><strong>åŒæ—¶å…±äº«æ–¹å¼</strong> ç³»ç»Ÿä¸­è¿˜æœ‰å¦ä¸€ç±»èµ„æºï¼Œå…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…ç”±å¤šä¸ªè¿›ç¨‹â€œåŒæ—¶â€å¯¹å®ƒä»¬è¿›è¡Œè®¿é—®ã€‚è¿™é‡Œæ‰€è°“çš„â€œåŒæ—¶â€å¾€å¾€æ˜¯å®è§‚ä¸Šçš„ï¼Œ<code>è€Œåœ¨å¾®è§‚ä¸Šï¼Œè¿™äº›è¿›ç¨‹å¯èƒ½æ˜¯äº¤æ›¿åœ°å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®</code>ï¼Œå³â€œåˆ†æ—¶å…±äº«â€,å…¸å‹çš„å¯ä¾›å¤šä¸ªè¿›ç¨‹â€œåŒæ—¶â€è®¿é—®çš„èµ„æºæ˜¯ç£ç›˜è®¾å¤‡ï¼Œä¸€äº›ç”¨é‡å…¥ç ç¼–å†™çš„æ–‡ä»¶ä¹Ÿå¯ä»¥è¢«â€œåŒæ—¶â€å…±äº«ï¼Œå³è‹¥å¹²ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®è¯¥æ–‡ä»¶. è¦æ³¨æ„åˆ°ï¼Œäº’æ–¥å…±äº«ï¼Œæ˜¯å› ä¸ºä¸€ç§èµ„æºåœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆå“ªæ€•æ˜¯ä¸€æ®µå¾ˆå°çš„æ—¶é—´ï¼‰åªèƒ½æ»¡è¶³ä¸€ä¸ªè¯·æ±‚ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„é—®é¢˜ï¼ˆå¦‚æ‰“å°æœºï¼Œç¬¬ä¸€è¡Œæ‰“å°Aæ–‡æ¡£çš„å†…å®¹ï¼Œç¬¬äºŒè¡Œæ‰“å°Bæ–‡æ¡£çš„å†…å®¹ï¼Œä½ èƒ½æƒ³è±¡æ˜¯ä»€ä¹ˆæ•ˆæœå—ï¼Ÿï¼‰.è€ŒåŒæ—¶å…±äº«æ–¹å¼ï¼Œé€šå¸¸è¦æ±‚ï¼Œä¸€ä¸ªè¯·æ±‚åˆ†å‡ ä¸ªæ—¶é—´ç‰‡æ®µé—´éš”åœ°å®Œæˆçš„æ•ˆæœï¼Œä¸è¿ç»­å®Œæˆçš„æ•ˆæœç›¸åŒ</li></ul><p><strong>å¹¶å‘å’Œå…±äº«æ˜¯æ“ä½œç³»ç»Ÿä¸¤ä¸ªæœ€åŸºæœ¬çš„ç‰¹å¾ï¼Œè¿™ä¸¤è€…ä¹‹é—´åˆæ˜¯äº’ä¸ºå­˜åœ¨æ¡ä»¶çš„ï¼š</strong></p><ul><li>èµ„æºå…±äº«æ˜¯ä»¥ç¨‹åºçš„å¹¶å‘ä¸ºæ¡ä»¶çš„ï¼Œè‹¥ç³»ç»Ÿä¸å…è®¸ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œåˆ™è‡ªç„¶ä¸å­˜åœ¨èµ„æºå…±äº«é—®é¢˜</li><li>è‹¥ç³»ç»Ÿä¸èƒ½å¯¹èµ„æºå…±äº«å®æ–½æœ‰æ•ˆçš„ç®¡ç†ï¼Œä¹Ÿå¿…å°†å½±å“åˆ°ç¨‹åºçš„å¹¶å‘æ‰§è¡Œï¼Œç”šè‡³æ ¹æœ¬æ— æ³•å¹¶å‘æ‰§è¡Œ</li></ul><h4 id="1-1-3-è™šæ‹Ÿ-Virtual"><a href="#1-1-3-è™šæ‹Ÿ-Virtual" class="headerlink" title="1.1.3 è™šæ‹Ÿ(Virtual)"></a>1.1.3 è™šæ‹Ÿ(Virtual)</h4><p>è™šæ‹Ÿæ˜¯æŒ‡æŠŠä¸€ä¸ªç‰©ç†ä¸Šçš„å®ä½“å˜ä¸ºè‹¥å¹²ä¸ªé€»è¾‘ä¸Šçš„å¯¹åº”ç‰©ã€‚ç‰©ç†å®ä½“ï¼ˆå‰è€…ï¼‰æ˜¯å®çš„ï¼Œå³å®é™…å­˜åœ¨çš„ï¼›è€Œåè€…æ˜¯è™šçš„ï¼Œæ˜¯ç”¨æˆ·æ„Ÿè§‰ä¸Šçš„äº‹ç‰©ã€‚ç”¨äºå®ç°è™šæ‹Ÿçš„æŠ€æœ¯ï¼Œç§°ä¸ºè™šæ‹ŸæŠ€æœ¯ã€‚</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­åˆ©ç”¨äº†å¤šç§è™šæ‹ŸæŠ€æœ¯ï¼Œåˆ†åˆ«ç”¨æ¥å®ç°<code>è™šæ‹Ÿå¤„ç†å™¨ã€è™šæ‹Ÿå†…å­˜å’Œè™šæ‹Ÿå¤–éƒ¨è®¾å¤‡</code>ç­‰ã€‚ åœ¨è™šæ‹Ÿå¤„ç†å™¨æŠ€æœ¯ä¸­ï¼Œæ˜¯é€šè¿‡å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯ï¼Œè®©å¤šé“ç¨‹åºå¹¶å‘æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ¥åˆ†æ—¶ä½¿ç”¨ä¸€ä¸ªå¤„ç†å™¨çš„ã€‚æ­¤æ—¶ï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªå¤„ç†å™¨ï¼Œä½†å®ƒèƒ½åŒæ—¶ä¸ºå¤šä¸ªç”¨æˆ·æœåŠ¡ï¼Œä½¿æ¯ä¸ªç»ˆç«¯ç”¨æˆ·éƒ½æ„Ÿè§‰æœ‰ä¸€ä¸ªä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰åœ¨ä¸“é—¨ä¸ºå®ƒæœåŠ¡ã€‚åˆ©ç”¨å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯ï¼Œ<code>æŠŠä¸€ä¸ªç‰©ç†ä¸Šçš„CPUè™šæ‹Ÿä¸ºå¤šä¸ªé€»è¾‘ä¸Šçš„CPUï¼Œç§°ä¸ºè™šæ‹Ÿå¤„ç†å™¨</code> </p><p>ç±»ä¼¼åœ°ï¼Œ<code>å¯ä»¥é€šè¿‡è™šæ‹Ÿå­˜å‚¨å™¨æŠ€æœ¯ï¼Œå°†ä¸€å°æœºå™¨çš„ç‰©ç†å­˜å‚¨å™¨å˜ä¸ºè™šæ‹Ÿå­˜å‚¨å™¨ï¼Œä»¥ä¾¿ä»é€»è¾‘ä¸Šæ¥æ‰©å……å­˜å‚¨å™¨çš„å®¹é‡</code>ã€‚å½“ç„¶ï¼Œè¿™æ—¶ç”¨æˆ·æ‰€æ„Ÿè§‰åˆ°çš„å†…å­˜å®¹é‡æ˜¯è™šçš„ã€‚æˆ‘ä»¬æŠŠç”¨æˆ·æ‰€æ„Ÿè§‰åˆ°çš„å­˜å‚¨å™¨ï¼ˆå®é™…æ˜¯ä¸å­˜åœ¨çš„ï¼‰ç§°ä¸ºè™šæ‹Ÿå­˜å‚¨å™¨ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡è™šæ‹Ÿè®¾å¤‡æŠ€æœ¯ï¼Œå°†ä¸€å°ç‰©ç†I/Oè®¾å¤‡è™šæ‹Ÿä¸ºå¤šå°é€»è¾‘ä¸Šçš„I/Oè®¾å¤‡ï¼Œå¹¶å…è®¸æ¯ä¸ªç”¨æˆ·å ç”¨ä¸€å°é€»è¾‘ä¸Šçš„I/Oè®¾å¤‡ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä½¿åŸæ¥ä»…å…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…ç”±ä¸€ä¸ªç”¨æˆ·è®¿é—®çš„è®¾å¤‡ï¼ˆå³ä¸´ç•Œèµ„æºï¼‰ï¼Œå˜ä¸ºåœ¨ä¸€æ®µæ—¶é—´å†…å…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®çš„å…±äº«è®¾å¤‡.å› æ­¤ï¼Œ<code>æ“ä½œç³»ç»Ÿçš„è™šæ‹ŸæŠ€æœ¯å¯å½’çº³ä¸ºï¼šæ—¶åˆ†å¤ç”¨æŠ€æœ¯ï¼Œå¦‚å¤„ç†å™¨çš„åˆ†æ—¶å…±äº«ï¼›ç©ºåˆ†å¤ç”¨æŠ€æœ¯ï¼Œå¦‚è™šæ‹Ÿå­˜å‚¨å™¨</code></p><p>æŠŠCPUæŠ½è±¡æˆè¿›ç¨‹ï¼ŒæŠŠç£ç›˜æŠ½è±¡æˆæ–‡ä»¶ï¼ŒæŠŠå†…å­˜æŠ½è±¡æˆåœ°å€ç©ºé—´</p><h4 id="1-1-4-å¼‚æ­¥-Asynchronism"><a href="#1-1-4-å¼‚æ­¥-Asynchronism" class="headerlink" title="1.1.4 å¼‚æ­¥(Asynchronism)"></a>1.1.4 å¼‚æ­¥(Asynchronism)</h4><p>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œ<code>å…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä½†ç”±äºèµ„æºæœ‰é™ï¼Œè¿›ç¨‹çš„æ‰§è¡Œä¸æ˜¯ä¸€è´¯åˆ°åº•ï¼Œè€Œæ˜¯èµ°èµ°åœåœ</code>ï¼Œä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ï¼Œè¿™å°±æ˜¯è¿›ç¨‹çš„å¼‚æ­¥æ€§</p><h3 id="1-2-æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½"><a href="#1-2-æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½" class="headerlink" title="1.2 æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½"></a>1.2 æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½</h3><h4 id="1-2-1-æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…"><a href="#1-2-1-æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…" class="headerlink" title="1.2.1 æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…"></a>1.2.1 æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…</h4><p><img src="https://img-blog.csdnimg.cn/20200528180734868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>å¤„ç†æœºç®¡ç†<br>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¤„ç†æœºçš„åˆ†é…å’Œè¿è¡Œéƒ½ä»¥è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ä¸ºåŸºæœ¬å•ä½ï¼Œå› è€Œå¯¹å¤„ç†æœºçš„ç®¡ç†å¯å½’ç»“ä¸ºå¯¹è¿›ç¨‹çš„ç®¡ç†ã€‚å¹¶å‘æ—¶åœ¨è®¡ç®—æœºå†…åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ï¼Œè¿›ç¨‹ä½•æ—¶åˆ›å»ºã€ä½•æ—¶æ’¤é”€ã€å¦‚ä½•ç®¡ç†ã€å¦‚ä½•é¿å…å†²çªã€åˆç†å…±äº«å°±æ˜¯è¿›ç¨‹ç®¡ç†çš„æœ€ä¸»è¦çš„ä»»åŠ¡ã€‚è¿›ç¨‹ç®¡ç†çš„ä¸»è¦åŠŸèƒ½<br>æœ‰ï¼šè¿›ç¨‹æ§åˆ¶ã€è¿›ç¨‹åŒæ­¥ã€è¿›ç¨‹é€šä¿¡ã€æ­»é”å¤„ç†ã€å¤„ç†æœºè°ƒåº¦ç­‰ã€‚</li><li>å­˜å‚¨å™¨ç®¡ç†<br>å­˜å‚¨å™¨ç®¡ç†æ˜¯ä¸ºäº†ç»™å¤šé“ç¨‹åºçš„è¿è¡Œæä¾›è‰¯å¥½çš„ç¯å¢ƒï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ä»¥åŠæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œä¸»è¦åŒ…æ‹¬å†…å­˜åˆ†é…ã€åœ°å€æ˜ å°„ã€å†…å­˜ä¿æŠ¤ä¸å…±äº«å’Œå†…å­˜æ‰©å……ç­‰åŠŸèƒ½</li><li>æ–‡ä»¶ç®¡ç†<br>è®¡ç®—æœºä¸­çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œæ“ä½œç³»ç»Ÿä¸­è´Ÿè´£æ–‡ä»¶ç®¡ç†çš„éƒ¨åˆ†ç§°ä¸ºæ–‡ä»¶ç³»ç»Ÿã€‚æ–‡ä»¶ç®¡ç†åŒ…æ‹¬æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€ç›®å½•ç®¡ç†åŠæ–‡ä»¶è¯»å†™ç®¡ç†å’Œä¿æŠ¤ç­‰ã€‚</li><li>è®¾å¤‡ç®¡ç†<br>è®¾å¤‡ç®¡ç†çš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆç”¨æˆ·çš„I/Oè¯·æ±‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨å„ç§è®¾å¤‡ï¼Œå¹¶æé«˜è®¾å¤‡çš„åˆ©ç”¨ç‡.ä¸»è¦åŒ…æ‹¬ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…ã€è®¾å¤‡å¤„ç†å’Œè™šæ‹Ÿè®¾å¤‡ç­‰åŠŸèƒ½ã€‚</li></ul><h4 id="1-2-2-æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£"><a href="#1-2-2-æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£" class="headerlink" title="1.2.2 æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£"></a>1.2.2 æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£</h4><p><img src="https://img-blog.csdnimg.cn/20200401223245841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200401223603928.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£ä¸»è¦åˆ†ä¸ºä¸¤ç±»<br>ä¸€ç±»æ˜¯<strong>å‘½ä»¤æ¥å£</strong>ï¼Œç”¨æˆ·åˆ©ç”¨è¿™äº›æ“ä½œå‘½ä»¤æ¥ç»„ç»‡å’Œæ§åˆ¶ä½œä¸šçš„æ‰§è¡Œï¼›å¦ä¸€ç±»æ˜¯<strong>ç¨‹åºæ¥å£</strong>ï¼Œç¼–ç¨‹äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è¯·æ±‚æ“ä½œç³»ç»ŸæœåŠ¡ã€‚</p><ul><li><p>å‘½ä»¤æ¥å£<br>ä½¿ç”¨å‘½ä»¤æ¥å£è¿›è¡Œä½œä¸šæ§åˆ¶çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼Œ<strong>å³è”æœºæ§åˆ¶æ–¹å¼å’Œè„±æœºæ§åˆ¶æ–¹å¼</strong>ã€‚æŒ‰ä½œä¸šæ§åˆ¶æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥å°†å‘½ä»¤æ¥å£åˆ†ä¸ºè”æœºå‘½ä»¤æ¥å£å’Œè„±æœºå‘½ä»¤æ¥å£ã€‚è”æœºå‘½ä»¤æ¥å£åˆç§°äº¤äº’å¼å‘½ä»¤æ¥å£ï¼Œé€‚ç”¨äºåˆ†æ—¶æˆ–å®æ—¶ç³»ç»Ÿçš„æ¥å£ã€‚å®ƒç”±ä¸€ç»„é”®ç›˜æ“ä½œå‘½ä»¤ç»„æˆã€‚ç”¨æˆ·é€šè¿‡æ§åˆ¶å°æˆ–ç»ˆç«¯è¾“å…¥æ“ä½œå‘½ä»¤ï¼Œå‘ç³»ç»Ÿæå‡ºå„ç§æœåŠ¡è¦æ±‚ã€‚ç”¨æˆ·æ¯è¾“å…¥å®Œä¸€æ¡å‘½ä»¤ï¼Œæ§åˆ¶æƒå°±è½¬å…¥æ“ä½œç³»ç»Ÿçš„å‘½ä»¤è§£é‡Šç¨‹åºï¼Œç„¶åç”±å‘½ä»¤è§£é‡Šç¨‹åºå¯¹è¾“å…¥çš„å‘½ä»¤è§£é‡Šå¹¶æ‰§è¡Œï¼Œå®ŒæˆæŒ‡å®šçš„åŠŸèƒ½ã€‚ä¹‹åï¼Œæ§åˆ¶æƒåˆè½¬å›åˆ°æ§åˆ¶å°æˆ–ç»ˆç«¯ï¼Œæ­¤æ—¶ç”¨æˆ·åˆå¯ä»¥è¾“å…¥ä¸‹ä¸€æ¡å‘½ä»¤</p><ul><li><strong>è„±æœºå‘½ä»¤æ¥å£åˆç§°æ‰¹å¤„ç†å‘½ä»¤æ¥å£</strong>ï¼Œå³é€‚ç”¨äºæ‰¹å¤„ç†ç³»ç»Ÿï¼Œå®ƒç”±ä¸€ç»„ä½œä¸šæ§åˆ¶å‘½ä»¤ï¼ˆæˆ–ç§°ä½œä¸šæ§åˆ¶è¯­å¥ï¼‰ç»„æˆã€‚è„±æœºç”¨æˆ·ä¸èƒ½ç›´æ¥å¹²é¢„ä½œä¸šçš„è¿è¡Œï¼Œåº”äº‹å…ˆç”¨ç›¸åº”çš„ä½œä¸šæ§åˆ¶å‘½ä»¤å†™æˆä¸€ä»½ä½œä¸šæ“ä½œè¯´æ˜ä¹¦ï¼Œè¿åŒä½œä¸šä¸€èµ·æäº¤ç»™ç³»ç»Ÿã€‚å½“ç³»ç»Ÿè°ƒåº¦åˆ°è¯¥ä½œä¸šæ—¶ï¼Œç”±ç³»ç»Ÿä¸­çš„å‘½ä»¤è§£é‡Šç¨‹åº.å¯¹ä½œä¸šè¯´æ˜ä¹¦ä¸Šçš„å‘½ä»¤æˆ–ä½œä¸šæ§åˆ¶è¯­å¥é€æ¡è§£é‡Šæ‰§è¡Œï¼Œä»è€Œé—´æ¥åœ°æ§åˆ¶ä½œä¸šçš„è¿è¡Œ.<br>è”æœºå‘½ä»¤æ¥å£å¯ä»¥ç†è§£ä¸ºï¼šâ€œé›‡ä¸»â€è¯´ä¸€å¥è¯ï¼Œâ€œå·¥äººâ€åšä¸€ä»¶äº‹ï¼Œå¹¶åšå‡ºåé¦ˆï¼Œè¿™å°±å¼ºè°ƒäº†äº¤äº’æ€§ã€‚</li></ul></li><li><p>ç¨‹åºæ¥å£<br><strong>ç¨‹åºæ¥å£ç”±ä¸€ç»„ç³»ç»Ÿè°ƒç”¨å‘½ä»¤</strong>ï¼ˆç®€ç§°ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿç§°å¹¿ä¹‰æŒ‡ä»¤ï¼‰ç»„æˆã€‚ç”¨æˆ·é€šè¿‡åœ¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨å‘½ä»¤æ¥è¯·æ±‚æ“ä½œç³»ç»Ÿä¸ºå…¶æä¾›æœåŠ¡ã€‚ç”¨æˆ·åœ¨ç¨‹åºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç»„ç³»ç»Ÿè°ƒç”¨å‘½ä»¤å‘ç³»ç»Ÿæå‡ºå„ç§æœåŠ¡è¦æ±‚ï¼Œå¦‚ä½¿ç”¨å„ç§å¤–éƒ¨è®¾å¤‡ï¼Œè¿›è¡Œæœ‰å…³ç£ç›˜æ–‡ä»¶çš„æ“ä½œï¼Œç”³è¯·åˆ†é…å’Œå›æ”¶å†…å­˜ä»¥åŠå…¶ä»–å„ç§æ§åˆ¶è¦æ±‚ã€‚æ“ä½œç³»ç»Ÿä¸å…è®¸ç”¨æˆ·ç›´æ¥æ“ä½œå„ç§ç¡¬ä»¶èµ„æºï¼Œå› æ­¤ç”¨æˆ·ç¨‹åºåªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥è¯·æ±‚å†…æ ¸ä¸ºå…¶æœåŠ¡ï¼Œé—´æ¥åœ°ä½¿ç”¨å„ç§èµ„æº</p></li><li><p>GUI<br>å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰å³å›¾å½¢æ¥å£ï¼Œç”¨æˆ·é€šè¿‡é¼ æ ‡å’Œé”®ç›˜ï¼Œåœ¨å›¾å½¢ç•Œé¢ä¸Šå•å‡»æˆ–ä½¿ç”¨å¿«æ·é”®å°±èƒ½å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿã€‚æœ‰äº›ç³»ç»Ÿæä¾›äº†ä¸Šè¿°ä¸‰ç§æ¥å£ï¼Œä½†GUIæœ€ç»ˆæ˜¯é€šè¿‡è°ƒç”¨ç¨‹åºæ¥å£å®ç°çš„ï¼Œä¸¥æ ¼åœ°è¯´GUIå›¾å½¢æ¥å£ä¸å±äºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œä½†å›¾å½¢æ¥å£æ‰€è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å‘½ä»¤ï¼Œå±äºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</p></li></ul><h4 id="1-2-3-æ“ä½œç³»ç»Ÿç”¨åšæ‰©å……æœºå™¨"><a href="#1-2-3-æ“ä½œç³»ç»Ÿç”¨åšæ‰©å……æœºå™¨" class="headerlink" title="1.2.3 æ“ä½œç³»ç»Ÿç”¨åšæ‰©å……æœºå™¨"></a>1.2.3 æ“ä½œç³»ç»Ÿç”¨åšæ‰©å……æœºå™¨</h4><p>æ²¡æœ‰ä»»ä½•è½¯ä»¶æ”¯æŒçš„è®¡ç®—æœºç§°ä¸ºè£¸æœºï¼Œå®ƒä»…æ„æˆè®¡ç®—æœºç³»ç»Ÿçš„ç‰©è´¨åŸºç¡€ï¼Œè€Œå®é™…å‘ˆç°åœ¨ç”¨æˆ·é¢å‰çš„è®¡ç®—æœºç³»ç»Ÿæ˜¯ç»è¿‡è‹¥å¹²å±‚è½¯ä»¶æ”¹é€ çš„è®¡ç®—æœºã€‚è£¸æœºåœ¨æœ€é‡Œå±‚ï¼Œå®ƒçš„å¤–é¢æ˜¯æ“ä½œç³»ç»Ÿï¼Œç”±æ“ä½œç³»ç»Ÿæä¾›çš„èµ„æºç®¡ç†åŠŸèƒ½å’Œæ–¹ä¾¿ç”¨æˆ·çš„å„ç§æœåŠ¡åŠŸèƒ½ï¼Œå°†è£¸æœºæ”¹é€ æˆåŠŸèƒ½æ›´å¼ºã€ä½¿ç”¨æ›´æ–¹ä¾¿çš„æœºå™¨ï¼Œé€šå¸¸æŠŠ<strong>è¦†ç›–äº†è½¯ä»¶çš„æœºå™¨ç§°ä¸ºæ‰©å……æœºå™¨ï¼Œåˆç§°ä¹‹ä¸ºè™šæ‹Ÿæœº</strong></p><blockquote><p>å•å¤„ç†æœºç³»ç»Ÿä¸­ï¼Œå¯å¹¶è¡Œçš„æ˜¯ï¼ˆDï¼‰. </p><p>I.è¿›ç¨‹ä¸è¿›ç¨‹<br>â…¡.å¤„ç†æœºä¸è®¾å¤‡<br>â…¢.å¤„ç†æœºä¸é€šé“<br>â…£.è®¾å¤‡ä¸è®¾å¤‡ </p><p>A.Iã€â…¡ã€â…¢<br>B.Iã€â…¡ã€â…£<br>C.Iã€â…¢ã€â…£<br>D.â…¡ã€â…¢ã€â…£</p></blockquote><p>åœ¨å•å¤„ç†æœºç³»ç»Ÿï¼ˆä¸åŒ…å«å¤šæ ¸çš„æƒ…å†µï¼‰ä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹å ç”¨å¤„ç†æœºï¼Œå› æ­¤è¿›ç¨‹ä¹‹é—´ä¸èƒ½å¹¶è¡Œæ‰§è¡Œã€‚é€šé“æ˜¯ç‹¬ç«‹äºCPUçš„æ§åˆ¶è¾“å…¥è¾“å‡ºçš„è®¾å¤‡ï¼Œä¸¤è€…å¯ä»¥å¹¶è¡Œï¼Œæ˜¾ç„¶ï¼Œå¤„ç†å™¨ä¸è®¾å¤‡æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œéš¾é“CPUå’Œæ˜¾ç¤ºå±ä¸èƒ½å¹¶è¡Œå·¥ä½œï¼Ÿè®¾å¤‡ä¸è®¾å¤‡æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œéš¾é“æ˜¾ç¤ºå±ä¸æ‰“å°æœºä¸èƒ½å¹¶è¡Œå·¥ä½œï¼Ÿ</p><h2 id="2-æ“ä½œç³»ç»Ÿçš„å‘å±•ä¸åˆ†ç±»"><a href="#2-æ“ä½œç³»ç»Ÿçš„å‘å±•ä¸åˆ†ç±»" class="headerlink" title="2. æ“ä½œç³»ç»Ÿçš„å‘å±•ä¸åˆ†ç±»"></a>2. æ“ä½œç³»ç»Ÿçš„å‘å±•ä¸åˆ†ç±»</h2><p><img src="https://img-blog.csdnimg.cn/20200402002639598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="hello"><br><img src="https://img-blog.csdnimg.cn/2020052914130223.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-1-æ‰‹å·¥æ“ä½œé˜¶æ®µï¼ˆæ­¤é˜¶æ®µæ— æ“ä½œç³»ç»Ÿï¼‰"><a href="#2-1-æ‰‹å·¥æ“ä½œé˜¶æ®µï¼ˆæ­¤é˜¶æ®µæ— æ“ä½œç³»ç»Ÿï¼‰" class="headerlink" title="2.1 æ‰‹å·¥æ“ä½œé˜¶æ®µï¼ˆæ­¤é˜¶æ®µæ— æ“ä½œç³»ç»Ÿï¼‰"></a>2.1 æ‰‹å·¥æ“ä½œé˜¶æ®µï¼ˆæ­¤é˜¶æ®µæ— æ“ä½œç³»ç»Ÿï¼‰</h3><p>ç”¨æˆ·åœ¨è®¡ç®—æœºä¸Šç®—é¢˜çš„æ‰€æœ‰å·¥ä½œéƒ½è¦äººå·¥å¹²é¢„ï¼Œå¦‚ç¨‹åºçš„è£…å…¥ã€è¿è¡Œã€ç»“æœçš„è¾“å‡ºç­‰ã€‚éšç€è®¡ç®—æœºç¡¬ä»¶çš„å‘å±•ï¼ŒäººæœºçŸ›ç›¾ï¼ˆé€Ÿåº¦å’Œèµ„æºåˆ©ç”¨ï¼‰è¶Šæ¥è¶Šå¤§ï¼Œå¿…é¡»å¯»æ±‚æ–°çš„è§£å†³åŠæ³•ã€‚</p><p>æ‰‹å·¥æ“ä½œé˜¶æ®µæœ‰ä¸¤ä¸ªçªå‡ºçš„ç¼ºç‚¹ï¼š</p><ul><li>ç”¨æˆ·ç‹¬å å…¨æœºã€‚ä¸ä¼šå‡ºç°å› èµ„æºå·²è¢«å…¶ä»–ç”¨æˆ·å ç”¨è€Œç­‰å¾…çš„ç°è±¡ï¼Œä½†èµ„æºåˆ©ç”¨ç‡ä½</li><li>CPUç­‰å¾…æ‰‹å·¥æ“ä½œï¼ŒCPUçš„åˆ©ç”¨ä¸å……åˆ†</li></ul><p>å”¯ä¸€çš„è§£å†³åŠæ³•å°±æ˜¯ç”¨é«˜é€Ÿçš„æœºå™¨ä»£æ›¿ç›¸å¯¹è¾ƒæ…¢çš„æ‰‹å·¥æ“ä½œæ¥å¯¹ä½œä¸šè¿›è¡Œæ§åˆ¶</p><h3 id="2-2-æ‰¹å¤„ç†é˜¶æ®µï¼ˆæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°ï¼‰"><a href="#2-2-æ‰¹å¤„ç†é˜¶æ®µï¼ˆæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°ï¼‰" class="headerlink" title="2.2 æ‰¹å¤„ç†é˜¶æ®µï¼ˆæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°ï¼‰"></a>2.2 æ‰¹å¤„ç†é˜¶æ®µï¼ˆæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°ï¼‰</h3><p>ä¸ºäº†è§£å†³äººæœºçŸ›ç›¾åŠCPUå’ŒI/Oè®¾å¤‡ä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ï¼Œå‡ºç°äº†æ‰¹å¤„ç†ç³»ç»Ÿã€‚å®ƒæŒ‰å‘<br>å±•å†ç¨‹åˆåˆ†ä¸º<code>å•é“æ‰¹å¤„ç†ç³»ç»Ÿã€å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ</code>ï¼ˆå¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯å‡ºç°ä»¥åï¼‰.</p><ul><li>å•é“æ‰¹å¤„ç†ç³»ç»Ÿ<br>ç³»ç»Ÿå¯¹ä½œä¸šçš„å¤„ç†æ˜¯æˆæ‰¹è¿›è¡Œçš„ï¼Œä½†å†…å­˜ä¸­å§‹ç»ˆä¿æŒä¸€é“ä½œä¸šã€‚è¯¥ç³»ç»Ÿæ˜¯åœ¨è§£å†³äººæœºçŸ›ç›¾å’ŒCPUä¸I/Oè®¾å¤‡é€Ÿç‡ä¸åŒ¹é…çš„çŸ›ç›¾ä¸­å½¢æˆçš„ã€‚å•é“æ‰¹å¤„ç†ç³»ç»Ÿçš„ä¸»è¦ç‰¹å¾å¦‚ä¸‹<ul><li>è‡ªåŠ¨æ€§ã€‚åœ¨é¡ºåˆ©çš„æƒ…å†µä¸‹ï¼Œåœ¨ç£å¸¦ä¸Šçš„ä¸€æ‰¹ä½œä¸šèƒ½è‡ªåŠ¨åœ°é€ä¸ªä¾æ¬¡è¿è¡Œï¼Œè€Œæ— éœ€äººå·¥</li><li>é¡ºåºæ€§ã€‚ç£å¸¦ä¸Šçš„å„é“ä½œä¸šæ˜¯é¡ºåºåœ°è¿›å…¥å†…å­˜ï¼Œå„é“ä½œä¸šçš„å®Œæˆé¡ºåºä¸å®ƒä»¬è¿›å…¥å†…å­˜çš„é¡ºåºï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹åº”å®Œå…¨ç›¸åŒï¼Œäº¦å³å…ˆè°ƒå…¥å†…å­˜çš„ä½œä¸šå…ˆå®Œæˆ</li><li>å•é“æ€§ã€‚å†…å­˜ä¸­ä»…æœ‰ä¸€é“ç¨‹åºè¿è¡Œï¼Œå³ç›‘ç£ç¨‹åºæ¯æ¬¡ä»ç£å¸¦ä¸Šåªè°ƒå…¥ä¸€é“ç¨‹åºè¿›å…¥å†…å­˜è¿è¡Œï¼Œå½“è¯¥ç¨‹åºå®Œæˆæˆ–å‘ç”Ÿå¼‚å¸¸æƒ…å†µæ—¶ï¼Œæ‰æ¢å…¥å…¶åç»§ç¨‹åºè¿›å…¥å†…å­˜è¿è¡Œ</li></ul></li></ul><p><strong>æ­¤æ—¶é¢ä¸´çš„é—®é¢˜æ˜¯</strong></p><p>æ¯æ¬¡ä¸»æœºå†…å­˜ä¸­ä»…å­˜æ”¾ä¸€é“ä½œä¸šï¼Œæ¯å½“å®ƒè¿è¡ŒæœŸé—´ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯â€œè¿è¡Œæ—¶â€ï¼Œå¹¶ä¸æ˜¯â€œå®Œæˆåâ€ï¼‰å‘å‡ºè¾“å…¥è¾“å‡ºè¯·æ±‚åï¼Œé«˜é€Ÿçš„CPUä¾¿å¤„äºç­‰å¾…ä½é€Ÿçš„I/Oå®ŒæˆçŠ¶æ€.ä¸ºäº†è¿›ä¸€æ­¥æé«˜èµ„æºçš„åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„ååé‡ï¼Œå¼•å…¥äº†å¤šé“ç¨‹åºæŠ€æœ¯.</p><ul><li><p>å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ<br><code>å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯å…è®¸å¤šä¸ªç¨‹åºåŒæ—¶è¿›å…¥å†…å­˜å¹¶è¿è¡Œã€‚å³åŒæ—¶æŠŠå¤šä¸ªç¨‹åºæ”¾å…¥å†…å­˜ï¼Œå¹¶å…è®¸ä»¬äº¤æ›¿åœ¨CPUä¸­è¿è¡Œ</code>ï¼Œå®ƒä»¬å…±äº«ç³»ç»Ÿä¸­çš„å„ç§ç¡¬ã€è½¯ä»¶èµ„æºã€‚å½“ä¸€é“ç¨‹åºå› I/Oè¯·æ±‚è€Œæš‚åœè¿è¡Œæ—¶ï¼ŒCPUä¾¿ç«‹å³è½¬å»è¿è¡Œå¦ä¸€é“ç¨‹åº</p><p>å¤šé“ç¨‹åºè®¾è®¡çš„ç‰¹ç‚¹æœ‰ï¼šå¤šé“ã€å®è§‚ä¸Šå¹¶è¡Œã€å¾®è§‚ä¸Šä¸²è¡Œã€‚</p><ul><li>å¤šé“ï¼šè®¡ç®—æœºå†…å­˜ä¸­åŒæ—¶å­˜æ”¾å¤šé“ç›¸äº’ç‹¬ç«‹çš„ç¨‹åºã€‚</li><li>å®è§‚ä¸Šå¹¶è¡Œï¼šåŒæ—¶è¿›å…¥ç³»ç»Ÿçš„å¤šé“ç¨‹åºéƒ½å¤„äºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå³å®ƒä»¬å…ˆåå¼€å§‹äº†å„è‡ªçš„è¿è¡Œï¼Œä½†éƒ½æœªè¿è¡Œå®Œæ¯•ã€‚</li><li>å¾®è§‚ä¸Šä¸²è¡Œï¼šå†…å­˜ä¸­çš„å¤šé“ç¨‹åºè½®æµå æœ‰CPUï¼Œäº¤æ›¿æ‰§è¡Œ</li></ul></li></ul><p><strong>å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯çš„å®ç°éœ€è¦è§£å†³ä¸‹åˆ—é—®é¢˜</strong></p><ul><li>å¦‚ä½•åˆ†é…å¤„ç†å™¨</li><li>å¤šé“ç¨‹åºçš„å†…å­˜åˆ†é…é—®é¢˜</li><li>I/Oè®¾å¤‡å¦‚ä½•åˆ†é…</li><li>å¦‚ä½•ç»„ç»‡å’Œå­˜æ”¾å¤§é‡çš„ç¨‹åºå’Œæ•°æ®ï¼Œä»¥ä¾¿äºç”¨æˆ·ä½¿ç”¨å’Œä¿è¯å…¶å®‰å…¨æ€§ä¸ä¸€è‡´æ€§ </li></ul><p>ä¼˜ç‚¹æ˜¯èµ„æºåˆ©ç”¨ç‡é«˜ï¼Œå¤šé“ç¨‹åºå…±äº«è®¡ç®—æœºèµ„æºï¼Œä»è€Œä½¿å„ç§èµ„æºå¾—åˆ°å……åˆ†åˆ©ç”¨ï¼šç³»ç»Ÿååé‡å¤§ï¼ŒCPUå’Œå…¶ä»–èµ„æºä¿æŒâ€œå¿™ç¢Œâ€çŠ¶æ€ã€‚ç¼ºç‚¹æ˜¯ç”¨æˆ·å“åº”çš„æ—¶é—´è¾ƒé•¿ã€‚<code>ä¸æä¾›äººæœºäº¤äº’èƒ½åŠ›ï¼Œç”¨æˆ·æ—¢ä¸èƒ½äº†è§£è‡ªå·±ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œä¹Ÿä¸èƒ½æ§åˆ¶è®¡ç®—æœº</code></p><h3 id="2-3-åˆ†æ—¶æ“ä½œç³»ç»Ÿ"><a href="#2-3-åˆ†æ—¶æ“ä½œç³»ç»Ÿ" class="headerlink" title="2.3 åˆ†æ—¶æ“ä½œç³»ç»Ÿ"></a>2.3 åˆ†æ—¶æ“ä½œç³»ç»Ÿ</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­é‡‡ç”¨åˆ†æ—¶æŠ€æœ¯å°±å½¢æˆäº†åˆ†æ—¶ç³»ç»Ÿã€‚æ‰€è°“åˆ†æ—¶æŠ€æœ¯å°±æ˜¯æŠŠå¤„ç†å™¨çš„è¿è¡Œæ—¶é—´åˆ†æˆå¾ˆçŸ­çš„æ—¶é—´ç‰‡ï¼ŒæŒ‰æ—¶é—´ç‰‡è½®æµæŠŠå¤„ç†å™¨åˆ†é…ç»™å„è”æœºä½œä¸šä½¿ç”¨ã€‚è‹¥æŸä¸ªä½œä¸šåœ¨åˆ†é…ç»™å®ƒçš„æ—¶é—´ç‰‡å†…ä¸èƒ½å®Œæˆå…¶è®¡ç®—ï¼Œåˆ™è¯¥ä½œä¸šæš‚æ—¶åœæ­¢è¿è¡Œï¼ŒæŠŠå¤„ç†å™¨è®©ç»™å…¶ä»–ä½œä¸šä½¿ç”¨ï¼Œç­‰å¾…ä¸‹ä¸€è½®å†ç»§ç»­è¿è¡Œã€‚ç”±äºè®¡ç®—æœºé€Ÿåº¦å¾ˆå¿«ï¼Œä½œä¸šè¿è¡Œè½®è½¬å¾—å¾ˆå¿«ï¼Œç»™æ¯ä¸ªç”¨æˆ·çš„æ„Ÿè§‰å¥½åƒæ˜¯è‡ªå·±ç‹¬å ä¸€å°è®¡ç®—æœº.<br>åˆ†æ—¶æ“ä½œç³»ç»Ÿæ˜¯å¤šä¸ªç”¨æˆ·é€šè¿‡ç»ˆç«¯åŒæ—¶å…±äº«ä¸€å°ä¸»æœºï¼Œè¿™äº›ç»ˆç«¯è¿æ¥åœ¨ä¸»æœºä¸Šï¼Œç”¨æˆ·å¯ä»¥åŒæ—¶ä¸ä¸»æœºè¿›è¡Œäº¤äº’æ“ä½œè€Œäº’ä¸å¹²æ‰°ã€‚åˆ†æ—¶ç³»ç»Ÿä¹Ÿæ˜¯æ”¯æŒå¤šé“ç¨‹åºè®¾è®¡çš„ç³»ç»Ÿï¼Œä½†å®ƒä¸åŒäºå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿã€‚å¤šé“æ‰¹å¤„ç†æ˜¯å®ç°ä½œä¸šè‡ªåŠ¨æ§åˆ¶è€Œæ— éœ€äººå·¥å¹²é¢„çš„ç³»ç»Ÿï¼Œè€Œåˆ†æ—¶ç³»ç»Ÿæ˜¯å®ç°äººæœºäº¤äº’çš„ç³»ç»Ÿï¼Œè¿™ä½¿å¾—åˆ†æ—¶ç³»ç»Ÿå…·æœ‰ä¸æ‰¹å¤„ç†ç³»ç»Ÿä¸åŒçš„ç‰¹å¾ï¼Œå…¶ä¸»è¦ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>åŒæ—¶æ€§ã€‚åŒæ—¶æ€§ä¹Ÿç§°å¤šè·¯æ€§ï¼ŒæŒ‡å…è®¸å¤šä¸ªç»ˆç«¯ç”¨æˆ·åŒæ—¶ä½¿ç”¨ä¸€å°è®¡ç®—æœºï¼Œå³ä¸€å°è®¡ç®—æœºä¸è‹¥å¹²å°ç»ˆç«¯ç›¸è¿æ¥ï¼Œç»ˆç«¯ä¸Šçš„è¿™äº›ç”¨æˆ·å¯ä»¥åŒæ—¶æˆ–åŸºæœ¬åŒæ—¶ä½¿ç”¨è®¡ç®—æœºã€‚</li><li>äº¤äº’æ€§ã€‚ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°ä¸ç³»ç»Ÿè¿›è¡Œäººæœºå¯¹è¯ï¼Œå³ç”¨æˆ·é€šè¿‡ç»ˆç«¯é‡‡ç”¨äººæœºå¯¹è¯çš„æ–¹å¼ç›´æ¥æ§åˆ¶ç¨‹åºè¿è¡Œï¼Œä¸åŒç¨‹åºè¿›è¡Œäº¤äº’ã€‚</li><li>ç‹¬ç«‹æ€§ã€‚ç³»ç»Ÿä¸­å¤šä¸ªç”¨æˆ·å¯ä»¥å½¼æ­¤ç‹¬ç«‹åœ°è¿›è¡Œæ“ä½œï¼Œäº’ä¸å¹²æ‰°ï¼Œå•ä¸ªç”¨æˆ·æ„Ÿè§‰ä¸åˆ°åˆ«äººä¹Ÿåœ¨ä½¿ç”¨è¿™å°è®¡ç®—æœºï¼Œå¥½åƒåªæœ‰è‡ªå·±å•ç‹¬ä½¿ç”¨è¿™å°è®¡ç®—æœºä¸€æ ·</li><li>åŠæ—¶æ€§ã€‚ç”¨æˆ·è¯·æ±‚èƒ½åœ¨å¾ˆçŸ­æ—¶é—´å†…è·å¾—å“åº”ã€‚åˆ†æ—¶ç³»ç»Ÿé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬æ–¹å¼ä½¿ä¸€å°è®¡ç®—æœºåŒæ—¶ä¸ºå¤šä¸ªç»ˆç«¯æœåŠ¡ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå¯¹ç³»ç»Ÿçš„åŠæ—¶å“åº”æ„Ÿåˆ°æ»¡æ„</li></ul><p>è™½ç„¶åˆ†æ—¶æ“ä½œç³»ç»Ÿæ¯”è¾ƒå¥½åœ°è§£å†³äº†äººæœºäº¤äº’é—®é¢˜ï¼Œä½†æ˜¯åœ¨ä¸€äº›åº”ç”¨åœºåˆï¼Œ<code>éœ€è¦ç³»ç»Ÿèƒ½å¯¹å¤–éƒ¨çš„ä¿¡æ¯åœ¨è§„å®šçš„æ—¶é—´ï¼ˆæ¯”æ—¶é—´ç‰‡çš„æ—¶é—´è¿˜çŸ­ï¼‰å†…ä½œå‡ºå¤„ç†</code>ï¼ˆæ¯”å¦‚é£æœºè®¢ç¥¨ç³»ç»Ÿæˆ–å¯¼å¼¹åˆ¶å¯¼ç³»ç»Ÿï¼‰å› æ­¤ï¼Œå®æ—¶ç³»ç»Ÿåº”è¿è€Œç”Ÿ</p><h3 id="2-4-å®æ—¶æ“ä½œç³»ç»Ÿ"><a href="#2-4-å®æ—¶æ“ä½œç³»ç»Ÿ" class="headerlink" title="2.4 å®æ—¶æ“ä½œç³»ç»Ÿ"></a>2.4 å®æ—¶æ“ä½œç³»ç»Ÿ</h3><p>ä¸ºäº†èƒ½åœ¨æŸä¸ªæ—¶é—´é™åˆ¶å†…å®ŒæˆæŸäº›ç´§æ€¥ä»»åŠ¡è€Œä¸éœ€æ—¶é—´ç‰‡æ’é˜Ÿï¼Œè¯ç”Ÿäº†å®æ—¶æ“ä½œç³»ç»Ÿã€‚è¿™é‡Œçš„æ—¶é—´é™åˆ¶å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœæŸä¸ªåŠ¨ä½œå¿…é¡»ç»å¯¹åœ°åœ¨è§„å®šçš„æ—¶åˆ»ï¼ˆæˆ–è§„å®šçš„æ—¶é—´èŒƒå›´ï¼‰å‘ç”Ÿï¼Œåˆ™ç§°ä¸ºç¡¬å®æ—¶ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œé£è¡Œå™¨çš„é£è¡Œè‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿï¼Œè¿™ç±»ç³»ç»Ÿå¿…é¡»æä¾›ç»å¯¹ä¿è¯ï¼Œè®©æŸä¸ªç‰¹å®šçš„åŠ¨ä½œåœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆ</li><li>å¦‚æœèƒ½å¤Ÿæ¥å—å¶å°”è¿åæ—¶é—´è§„å®šï¼Œå¹¶ä¸”ä¸ä¼šå¼•èµ·ä»»ä½•æ°¸ä¹…æ€§çš„æŸå®³ï¼Œåˆ™ç§°ä¸ºè½¯å®æ—¶ç³»ç»Ÿï¼Œå¦‚é£æœºè®¢ç¥¨ç³»ç»Ÿã€é“¶è¡Œç®¡ç†ç³»ç»Ÿ</li></ul><p>åœ¨å®æ—¶æ“ä½œç³»ç»Ÿçš„æ§åˆ¶ä¸‹ï¼Œè®¡ç®—æœºç³»ç»Ÿæ¥æ”¶åˆ°å¤–éƒ¨ä¿¡å·ååŠæ—¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”è¦åœ¨ä¸¥æ ¼çš„æ—¶é™å†…å¤„ç†å®Œæ¥æ”¶çš„äº‹ä»¶ã€‚å®æ—¶æ“ä½œç³»ç»Ÿçš„ä¸»è¦ç‰¹ç‚¹æ˜¯åŠæ—¶æ€§å’Œå¯é æ€§ã€‚</p><h3 id="2-5-ç½‘ç»œæ“ä½œç³»ç»Ÿå’Œåˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ"><a href="#2-5-ç½‘ç»œæ“ä½œç³»ç»Ÿå’Œåˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ" class="headerlink" title="2.5 ç½‘ç»œæ“ä½œç³»ç»Ÿå’Œåˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ"></a>2.5 ç½‘ç»œæ“ä½œç³»ç»Ÿå’Œåˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ</h3><p>ç½‘ç»œæ“ä½œç³»ç»ŸæŠŠè®¡ç®—æœºç½‘ç»œä¸­çš„å„å°è®¡ç®—æœºæœ‰æœºåœ°ç»“åˆèµ·æ¥ï¼Œæä¾›ä¸€ç§ç»Ÿä¸€ã€ç»æµè€Œæœ‰æ•ˆçš„ä½¿ç”¨å„å°è®¡ç®—æœºçš„æ–¹æ³•ï¼Œå®ç°å„ä¸ªè®¡ç®—æœºä¹‹é—´çš„äº’ç›¸ä¼ é€æ•°æ®ã€‚ç½‘ç»œæ“ä½œç³»ç»Ÿæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ç½‘ç»œä¸­å„ç§èµ„æºçš„å…±äº«ä»¥åŠå„å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡.</p><p>åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿæ˜¯ç”±å¤šå°è®¡ç®—æœºç»„æˆå¹¶æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„ç³»ç»Ÿï¼šç³»ç»Ÿä¸­ä»»æ„ä¸¤å°è®¡ç®—æœºé€šè¿‡é€šä¿¡æ–¹å¼äº¤æ¢ä¿¡æ¯ï¼šç³»ç»Ÿä¸­çš„æ¯ä¸€å°è®¡ç®—æœºéƒ½å…·æœ‰åŒç­‰çš„åœ°ä½ï¼Œå³æ²¡æœ‰ä¸»æœºä¹Ÿæ²¡æœ‰ä»æœºï¼›æ¯å°è®¡ç®—æœºä¸Šçš„èµ„æºä¸ºæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼›ç³»ç»Ÿä¸­çš„ä»»æ„è‹¥å¹²å°è®¡ç®—æœºéƒ½å¯ä»¥æ„æˆä¸€ä¸ªå­ç³»ç»Ÿï¼Œå¹¶ä¸”è¿˜èƒ½é‡æ„ï¼›ä»»ä½•å·¥ä½œéƒ½å¯ä»¥åˆ†å¸ƒåœ¨å‡ å°è®¡ç®—æœºä¸Šï¼Œç”±å®ƒä»¬å¹¶è¡Œå·¥ä½œã€ååŒå®Œæˆã€‚ç”¨äºç®¡ç†åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿçš„æ“ä½œç³»ç»Ÿç§°ä¸ºåˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿçš„ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼šåˆ†å¸ƒæ€§å’Œå¹¶è¡Œæ€§ã€‚åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿä¸ç½‘ç»œæ“ä½œç³»ç»Ÿæœ¬è´¨ä¸Šçš„ä¸åŒä¹‹å¤„åœ¨äºåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿä¸­ï¼Œè‹¥å¹²å°è®¡ç®—æœºç›¸äº’ååŒå®ŒæˆåŒä¸€ä»»åŠ¡ã€‚</p><h3 id="2-6-ä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿ"><a href="#2-6-ä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿ" class="headerlink" title="2.6 ä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿ"></a>2.6 ä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿ</h3><p>ä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ“ä½œç³»ç»Ÿï¼Œå¹¿æ³›åº”ç”¨äºæ–‡å­—å¤„ç†ã€ç”µå­è¡¨æ ¼ã€æ¸¸æˆç­‰ã€‚å¸¸è§çš„æœ‰ Windowsã€ Linuxå’Œ Macintoshç­‰</p><h2 id="3-æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶è·Ÿä½“ç³»ç»“æ„"><a href="#3-æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶è·Ÿä½“ç³»ç»“æ„" class="headerlink" title="3. æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶è·Ÿä½“ç³»ç»“æ„"></a>3. æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶è·Ÿä½“ç³»ç»“æ„</h2><p><img src="https://img-blog.csdnimg.cn/20200706210933706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402092035655.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210531175254267.png" alt="image-20210531175254267"></p><h3 id="3-1-æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶"><a href="#3-1-æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="3.1 æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶"></a>3.1 æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶</h3><p>è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œé€šå¸¸CPUæ‰§è¡Œä¸¤ç§ä¸åŒæ€§è´¨çš„ç¨‹åºï¼š<code>ä¸€ç§æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºï¼›å¦ä¸€ç§æ˜¯ç”¨æˆ·è‡ªç¼–ç¨‹åºæˆ–ç³»ç»Ÿå¤–å±‚çš„åº”ç”¨ç¨‹åº</code>ã€‚å¯¹æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œè¿™ä¸¤ç§ç¨‹åºçš„ä½œç”¨ä¸åŒï¼Œå‰è€…æ˜¯åè€…çš„ç®¡ç†è€…ï¼Œå› æ­¤â€œç®¡ç†ç¨‹åºâ€è¦æ‰§è¡Œä¸€äº›ç‰¹æƒæŒ‡ä»¤ï¼Œè€Œâ€œè¢«ç®¡ç†ç¨‹åºâ€å‡ºäºå®‰å…¨è€ƒè™‘ä¸èƒ½æ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚æ“ä½œç³»ç»Ÿåœ¨å…·ä½“å®ç°ä¸Šåˆ’åˆ†äº†ç”¨æˆ·æ€ï¼ˆç›®æ€ï¼‰å’Œæ ¸å¿ƒæ€ï¼ˆç®¡æ€ï¼‰ï¼Œä»¥ä¸¥æ ¼åŒºåˆ†ä¸¤ç±»ç¨‹åº.æ“ä½œç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½åˆ†åˆ«è¢«è®¾ç½®åœ¨ä¸åŒçš„å±‚æ¬¡ä¸Šã€‚<code>ä¸€äº›ä¸ç¡¬ä»¶å…³è”è¾ƒç´§å¯†çš„æ¨¡å—ï¼Œè¯¸å¦‚æ—¶é’Ÿç®¡ç†ã€ä¸­æ–­å¤„ç†ã€è®¾å¤‡é©±åŠ¨ç­‰å¤„äºæœ€åº•å±‚ã€‚å…¶æ¬¡æ˜¯è¿è¡Œé¢‘ç‡è¾ƒé«˜çš„ç¨‹åºï¼Œè¯¸å¦‚è¿›ç¨‹ç®¡ç†ã€å­˜å‚¨å™¨ç®¡ç†å’Œè®¾å¤‡ç®¡ç†ç­‰</code>ã€‚è¿™ä¸¤éƒ¨åˆ†å†…å®¹æ„æˆäº†æ“ä½œç³»ç»Ÿçš„å†…æ ¸ã€‚è¿™éƒ¨åˆ†å†…å®¹çš„æŒ‡ä»¤æ“ä½œå·¥ä½œåœ¨æ ¸å¿ƒæ€ã€‚</p><p><code>å†…æ ¸æ˜¯è®¡ç®—æœºä¸Šé…ç½®çš„åº•å±‚è½¯ä»¶ï¼Œæ˜¯è®¡ç®—æœºåŠŸèƒ½çš„å»¶ä¼¸ã€‚ä¸åŒç³»ç»Ÿå¯¹å†…æ ¸çš„å®šä¹‰ç¨æœ‰åŒºåˆ«ã€‚å¤§å¤šæ•°æ“ä½œç³»ç»Ÿå†…æ ¸åŒ…æ‹¬å››ä¸ªæ–¹é¢çš„å†…å®¹</code></p><ul><li>æ—¶é’Ÿç®¡ç†<br>åœ¨è®¡ç®—æœºçš„å„ç§éƒ¨ä»¶ä¸­ï¼Œæ—¶é’Ÿæ˜¯æœ€å…³é”®çš„è®¾å¤‡ã€‚æ—¶é’Ÿçš„ç¬¬ä¸€åŠŸèƒ½æ˜¯è®¡æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦é€šè¿‡æ—¶é’Ÿç®¡ç†ï¼Œå‘ç”¨æˆ·æä¾›æ ‡å‡†çš„ç³»ç»Ÿæ—¶é—´ã€‚å¦å¤–ï¼Œé€šè¿‡æ—¶é’Ÿä¸­æ–­çš„ç®¡ç†ï¼Œå¯ä»¥å®ç°è¿›ç¨‹çš„åˆ‡æ¢ã€‚è¯¸å¦‚ï¼Œåœ¨åˆ†æ—¶æ“ä½œç³»ç»Ÿä¸­ï¼Œé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„å®ç°ï¼›åœ¨å®æ—¶ç³»ç»Ÿä¸­ï¼ŒæŒ‰æˆªæ­¢æ—¶é—´æ§åˆ¶è¿è¡Œçš„å®ç°ï¼›åœ¨æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œé€šè¿‡æ—¶é’Ÿç®¡ç†æ¥è¡¡é‡ä¸€ä¸ªä½œä¸šçš„è¿è¡Œç¨‹åº¦ç­‰ã€‚å› æ­¤ï¼Œç³»ç»Ÿç®¡ç†çš„æ–¹æ–¹é¢æ— ä¸ä¾èµ–äºæ—¶é’Ÿã€‚</li><li>ä¸­æ–­æœºåˆ¶<br>å¼•å…¥ä¸­æ–­æŠ€æœ¯çš„åˆè¡·æ˜¯æé«˜å¤šé“ç¨‹åºè¿è¡Œç¯å¢ƒä¸­CPUçš„åˆ©ç”¨ç‡ï¼Œè€Œä¸”ä¸»è¦æ˜¯é’ˆå¯¹å¤–éƒ¨è®¾å¤‡çš„ã€‚ä¾‹å¦‚ï¼Œé”®ç›˜æˆ–é¼ æ ‡ä¿¡æ¯çš„è¾“å…¥ã€è¿›ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦ã€ç³»ç»ŸåŠŸèƒ½çš„è°ƒç”¨ã€è®¾å¤‡é©±åŠ¨ã€æ–‡ä»¶è®¿é—®ç­‰ï¼Œæ— ä¸ä¾èµ–äºä¸­æ–­æœºåˆ¶ã€‚å¯ä»¥è¯´ï¼Œç°ä»£æ“ä½œç³»ç»Ÿæ˜¯é ä¸­æ–­é©±åŠ¨çš„è½¯ä»¶ã€‚<br>ä¸­æ–­æœºåˆ¶ä¸­ï¼Œåªæœ‰ä¸€å°éƒ¨åˆ†åŠŸèƒ½å±äºå†…æ ¸ï¼Œè´Ÿè´£ä¿æŠ¤å’Œæ¢å¤ä¸­æ–­ç°åœºçš„ä¿¡æ¯ï¼Œè½¬ç§»æ§åˆ¶æƒåˆ°ç›¸å…³çš„å¤„ç†ç¨‹åºã€‚è¿™æ ·å¯ä»¥å‡å°‘ä¸­æ–­çš„å¤„ç†æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›</li><li>åŸè¯­ï¼ŒæŒ‰å±‚æ¬¡ç»“æ„è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œåº•å±‚å¿…ç„¶æ˜¯ä¸€äº›å¯è¢«è°ƒç”¨çš„å…¬ç”¨å°ç¨‹åºï¼Œå®ƒä»¬å„è‡ªå®Œæˆä¸€ä¸ªè§„å®šçš„æ“ä½œã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼š<ul><li>å®ƒä»¬å¤„äºæ“ä½œç³»ç»Ÿçš„æœ€åº•å±‚ï¼Œæ˜¯æœ€æ¥è¿‘ç¡¬ä»¶çš„éƒ¨åˆ†ã€‚</li><li>è¿™äº›ç¨‹åºçš„è¿è¡Œå…·æœ‰åŸå­æ€§â€”å…¶æ“ä½œåªèƒ½ä¸€æ°”å‘µæˆï¼ˆè¿™ä¸»è¦æ˜¯ä»ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œä¾¿äºç®¡ç†è€ƒè™‘çš„ï¼‰</li><li>è¿™äº›ç¨‹åºçš„è¿è¡Œæ—¶é—´éƒ½è¾ƒçŸ­ï¼Œè€Œä¸”è°ƒç”¨é¢‘ç¹ã€‚</li></ul></li></ul><p>é€šå¸¸æŠŠå…·æœ‰è¿™äº›ç‰¹ç‚¹çš„ç¨‹åºç§°ä¸ºåŸè¯­ï¼ˆ Atomic Operationï¼‰.å®šä¹‰åŸè¯­çš„ç›´æ¥æ–¹æ³•æ˜¯å…³é—­ä¸­æ–­ï¼Œè®©å®ƒçš„æ‰€æœ‰åŠ¨ä½œä¸å¯åˆ†å‰²åœ°è¿›è¡Œå®Œï¼Œå†æ‰“å¼€ä¸­æ–­ã€‚</p><p><code>ç³»ç»Ÿä¸­çš„è®¾å¤‡é©±åŠ¨ã€CPUåˆ‡æ¢ã€è¿›ç¨‹é€šä¿¡ç­‰åŠŸèƒ½ä¸­çš„éƒ¨åˆ†æ“ä½œéƒ½å¯ä»¥å®šä¹‰ä¸ºåŸè¯­ï¼Œä½¿å®ƒä»¬æˆä¸ºå†…æ ¸çš„ç»„æˆéƒ¨åˆ†</code></p><ul><li>ç³»ç»Ÿæ§åˆ¶çš„æ•°æ®ç»“æ„åŠå¤„ç†<br>ç³»ç»Ÿä¸­ç”¨æ¥ç™»è®°çŠ¶æ€ä¿¡æ¯çš„æ•°æ®ç»“æ„å¾ˆå¤šï¼Œæ¯”å¦‚ä½œä¸šæ§åˆ¶å—ã€è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ã€è®¾å¤‡æ§åˆ¶å—ã€å„ç±»é“¾è¡¨ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å†²åŒºã€ç©ºé—²åŒºç™»è®°è¡¨ã€å†…å­˜åˆ†é…è¡¨ç­‰ã€‚ä¸ºäº†å®ç°æœ‰æ•ˆçš„ç®¡ç†ï¼Œç³»ç»Ÿéœ€è¦ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œå¸¸è§çš„æ“ä½œæœ‰ä»¥ä¸‹ä¸‰ç§<br>1ï¼‰è¿›ç¨‹ç®¡ç†ï¼šè¿›ç¨‹çŠ¶æ€ç®¡ç†ã€è¿›ç¨‹è°ƒåº¦å’Œåˆ†æ´¾ã€åˆ›å»ºä¸æ’¤é”€è¿›ç¨‹æ§åˆ¶å—ç­‰<br>2ï¼‰å­˜å‚¨å™¨ç®¡ç†ï¼šå­˜å‚¨å™¨çš„ç©ºé—´åˆ†é…å’Œå›æ”¶ã€å†…å­˜ä¿¡æ¯ä¿æŠ¤ç¨‹åºã€ä»£ç å¯¹æ¢ç¨‹åºç­‰<br>3ï¼‰è®¾å¤‡ç®¡ç†ï¼šç¼“å†²åŒºç®¡ç†ã€è®¾å¤‡åˆ†é…å’Œå›æ”¶ç­‰<br>ä»ä¸Šè¿°å†…å®¹å¯ä»¥äº†è§£ï¼Œæ ¸å¿ƒæ€æŒ‡ä»¤å®é™…ä¸ŠåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ç±»æŒ‡ä»¤å’Œä¸€äº›é’ˆå¯¹æ—¶é’Ÿã€ä¸­æ–­å’ŒåŸè¯­çš„æ“ä½œæŒ‡ä»¤</li></ul><h3 id="3-2-ä¸­æ–­å’Œå¼‚å¸¸"><a href="#3-2-ä¸­æ–­å’Œå¼‚å¸¸" class="headerlink" title="3.2 ä¸­æ–­å’Œå¼‚å¸¸"></a>3.2 ä¸­æ–­å’Œå¼‚å¸¸</h3><p><img src="https://img-blog.csdnimg.cn/20200706211009553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200402094023539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402094321685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402094734544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸­æ–­ï¼ˆ Interruptionï¼‰ï¼Œä¹Ÿç§°å¤–ä¸­æ–­ï¼ŒæŒ‡æ¥è‡ªCPUæ‰§è¡ŒæŒ‡ä»¤ä»¥å¤–çš„äº‹ä»¶çš„å‘ç”Ÿï¼Œå¦‚è®¾å¤‡å‘å‡ºçš„I/Oç»“æŸä¸­æ–­ï¼Œè¡¨ç¤ºè®¾å¤‡è¾“å…¥è¾“å‡ºå¤„ç†å·²ç»å®Œæˆï¼Œå¸Œæœ›å¤„ç†æœºèƒ½å¤Ÿå‘è®¾å¤‡å‘ä¸‹ä¸€ä¸ªè¾“å…¥è¾“å‡ºè¯·æ±‚,åŒæ—¶è®©å®Œæˆè¾“å…¥è¾“å‡ºåçš„ç¨‹åºç»§ç»­è¿è¡Œã€‚<code>æ—¶é’Ÿä¸­æ–­ï¼Œè¡¨ç¤ºä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‰‡å·²åˆ°ï¼Œè®©å¤„ç†æœºå¤„ç†è®¡æ—¶ã€å¯åŠ¨å®šæ—¶è¿è¡Œçš„ä»»åŠ¡ç­‰</code>ã€‚è¿™ä¸€ç±»ä¸­æ–­é€šå¸¸æ˜¯ä¸å½“å‰ç¨‹åºè¿è¡Œæ— å…³çš„äº‹ä»¶ï¼Œå³å®ƒä»¬ä¸å½“å‰å¤„ç†æœºè¿è¡Œçš„ç¨‹åºæ— å…³</p><p>å¼‚å¸¸ï¼ˆ Exceptionï¼‰ï¼Œä¹Ÿç§°å†…ä¸­æ–­ã€ä¾‹å¤–æˆ–é™·å…¥ï¼ˆTrapï¼‰ï¼ŒæŒ‡æºè‡ªCPUæ‰§è¡ŒæŒ‡ä»¤å†…éƒ¨çš„äº‹ä»¶ï¼Œ<br><code>å¦‚ç¨‹åºçš„éæ³•æ“ä½œç ã€åœ°å€è¶Šç•Œã€ç®—æœ¯æº¢å‡ºã€è™šå­˜ç³»ç»Ÿçš„ç¼ºé¡µä»¥åŠä¸“é—¨çš„é™·å…¥æŒ‡ä»¤ç­‰å¼•èµ·çš„äº‹ä»¶</code>ã€‚å¯¹å¼‚å¸¸çš„å¤„ç†ä¸€èˆ¬è¦ä¾èµ–äºå½“å‰ç¨‹åºçš„è¿è¡Œç°åœºï¼Œè€Œä¸”å¼‚å¸¸ä¸èƒ½è¢«å±è”½ï¼Œä¸€ä½†å‡ºç°åº”ç«‹å³å¤„ç†ã€‚</p><h3 id="3-3-ç³»ç»Ÿè°ƒç”¨"><a href="#3-3-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="3.3 ç³»ç»Ÿè°ƒç”¨"></a>3.3 ç³»ç»Ÿè°ƒç”¨</h3><p><img src="https://img-blog.csdnimg.cn/20200402100117545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200402100637106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402101046100.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402102114944.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706211048292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>æ‰€è°“ç³»ç»Ÿè°ƒç”¨å°±æ˜¯ç”¨æˆ·åœ¨ç¨‹åºä¸­è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€äº›å­åŠŸèƒ½ï¼Œç³»ç»Ÿè°ƒç”¨å¯ä»¥è¢«çœ‹åšç‰¹æ®Šçš„å…¬å…±å­ç¨‹åº</code>ã€‚ç³»ç»Ÿä¸­çš„å„ç§å…±äº«èµ„æºéƒ½ç”±æ“ä½œç³»ç»Ÿç»Ÿä¸€æŒç®¡ï¼Œå› æ­¤åœ¨ç”¨æˆ·ç¨‹åºä¸­ï¼Œå‡¡æ˜¯ä¸èµ„æºæœ‰å…³çš„æ“ä½œï¼ˆå¦‚å­˜å‚¨åˆ†é…ã€è¿›è¡ŒI/Oä¼ è¾“ä»¥åŠç®¡ç†æ–‡ä»¶ç­‰ï¼‰ï¼Œéƒ½å¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ–¹å¼å‘æ“ä½œç³»ç»Ÿæå‡ºæœåŠ¡è¯·æ±‚ï¼Œå¹¶ç”±æ“ä½œç³»ç»Ÿä»£ä¸ºå®Œæˆã€‚é€šå¸¸ï¼Œä¸€ä¸ªæ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‘½ä»¤æœ‰å‡ åä¹ƒè‡³ä¸Šç™¾æ¡ä¹‹å¤š,è¿™äº›ç³»ç»Ÿè°ƒç”¨æŒ‰åŠŸèƒ½å¤§è‡´å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»</p><ul><li>è®¾å¤‡ç®¡ç†ã€‚å®Œæˆè®¾å¤‡çš„è¯·æ±‚æˆ–é‡Šæ”¾ï¼Œä»¥åŠè®¾å¤‡å¯åŠ¨ç­‰åŠŸèƒ½</li><li>æ–‡ä»¶ç®¡ç†ã€‚å®Œæˆæ–‡ä»¶çš„è¯»ã€å†™ã€åˆ›å»ºåŠåˆ é™¤ç­‰åŠŸèƒ½</li><li>è¿›ç¨‹æ§åˆ¶ã€‚å®Œæˆè¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€é˜»å¡åŠå”¤é†’ç­‰åŠŸèƒ½</li><li>è¿›ç¨‹é€šä¿¡ã€‚å®Œæˆè¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æˆ–ä¿¡å·ä¼ é€’ç­‰åŠŸèƒ½</li><li>å†…å­˜ç®¡ç†ã€‚å®Œæˆå†…å­˜çš„åˆ†é…ã€å›æ”¶ä»¥åŠè·å–ä½œä¸šå ç”¨å†…å­˜åŒºå¤§å°åŠå§‹å€ç­‰åŠŸèƒ½ã€‚</li></ul><p>æ˜¾ç„¶ï¼Œ<code>ç³»ç»Ÿè°ƒç”¨è¿è¡Œåœ¨ç³»ç»Ÿçš„æ ¸å¿ƒæ€ã€‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œé˜²æ­¢ç”¨æˆ·éšæ„æ›´æ”¹æˆ–è®¿é—®ç³»ç»Ÿçš„æ•°æ®æˆ–å‘½ä»¤</code>ã€‚ç³»ç»Ÿè°ƒç”¨å‘½ä»¤æ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­ç¨‹åºæ¨¡å—å®ç°çš„ã€‚<br>ä¸‹é¢åˆ—ä¸¾ä¸€äº›ç”±ç”¨æˆ·æ€è½¬å‘æ ¸å¿ƒæ€çš„ä¾‹å­ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20200529111946326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="3-4-æ“ä½œç³»ç»Ÿçš„ä½“ç³»ç»“æ„"><a href="#3-4-æ“ä½œç³»ç»Ÿçš„ä½“ç³»ç»“æ„" class="headerlink" title="3.4 æ“ä½œç³»ç»Ÿçš„ä½“ç³»ç»“æ„"></a>3.4 æ“ä½œç³»ç»Ÿçš„ä½“ç³»ç»“æ„</h3><p><img src="https://img-blog.csdnimg.cn/2020040209232247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200708100758503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="äºŒã€è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥"><a href="#äºŒã€è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥" class="headerlink" title="äºŒã€è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥"></a>äºŒã€è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥</h1><p><img src="https://img-blog.csdnimg.cn/20200706161604234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706161654480.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706161716690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706161813260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706161859429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706161933796.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706171831433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706172629884.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706174400154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706191129607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706180307698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706191956957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706193311914.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200706194954529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200531193752627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-1-è¿›ç¨‹çš„æ¦‚å¿µå’Œç‰¹å¾"><a href="#1-1-è¿›ç¨‹çš„æ¦‚å¿µå’Œç‰¹å¾" class="headerlink" title="1.1 è¿›ç¨‹çš„æ¦‚å¿µå’Œç‰¹å¾"></a>1.1 è¿›ç¨‹çš„æ¦‚å¿µå’Œç‰¹å¾</h3><p><img src="https://img-blog.csdnimg.cn/20200706161228279.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="è¿›ç¨‹çš„æ¦‚å¿µ"><a href="#è¿›ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="è¿›ç¨‹çš„æ¦‚å¿µ"></a>è¿›ç¨‹çš„æ¦‚å¿µ</h4><p>è¿›ç¨‹ï¼ˆProcessï¼‰ä»¥ä¾¿æ›´å¥½åœ°æè¿°å’Œæ§åˆ¶ç¨‹åºçš„å¹¶å‘æ‰§è¡Œï¼Œå®ç°æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§å’Œå…±äº«æ€§ï¼ˆæœ€åŸºæœ¬çš„ä¸¤ä¸ªç‰¹æ€§ï¼‰<code>ä¸ºäº†ä½¿å‚ä¸å¹¶å‘æ‰§è¡Œçš„ç¨‹åºï¼ˆå«æ•°æ®ï¼‰èƒ½ç‹¬ç«‹åœ°è¿è¡Œï¼Œå¿…é¡»ä¸ºä¹‹é…ç½®ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„ï¼Œç§°ä¸ºè¿›ç¨‹æ§åˆ¶å—ï¼ˆProcessControlBlockï¼ŒPCBï¼‰</code>ç³»ç»Ÿåˆ©ç”¨PCBæ¥æè¿°è¿›ç¨‹çš„åŸºæœ¬æƒ…å†µå’Œè¿è¡ŒçŠ¶æ€ï¼Œè¿›è€Œæ§åˆ¶å’Œç®¡ç†è¿›ç¨‹ã€‚ç›¸åº”åœ°ï¼Œ<code>ç”±ç¨‹åºæ®µã€ç›¸å…³æ•°æ®æ®µå’ŒPCBä¸‰éƒ¨åˆ†æ„æˆäº†è¿›ç¨‹æ˜ åƒï¼ˆè¿›ç¨‹å®ä½“ï¼‰</code>ã€‚<code>æ‰€è°“åˆ›å»ºè¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯åˆ›å»ºè¿›ç¨‹æ˜ åƒä¸­çš„PCBï¼šè€Œæ’¤é”€è¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯æ’¤é”€è¿›ç¨‹çš„PCBã€‚</code></p><p><code>å€¼å¾—æ³¨æ„çš„æ˜¯è¿›ç¨‹æ˜ åƒæ˜¯é™æ€çš„ï¼Œè¿›ç¨‹åˆ™æ˜¯åŠ¨æ€çš„</code></p><p>ä»ä¸åŒçš„è§’åº¦ï¼Œè¿›ç¨‹å¯ä»¥æœ‰ä¸åŒçš„å®šä¹‰ï¼Œæ¯”è¾ƒå…¸å‹çš„å®šä¹‰æœ‰ï¼š<br>1ï¼‰è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡<code>æ‰§è¡Œè¿‡ç¨‹</code><br>2ï¼‰è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºåŠå…¶æ•°æ®åœ¨å¤„ç†æœºä¸Šé¡ºåºæ‰§è¡Œæ—¶<code>æ‰€å‘ç”Ÿçš„æ´»åŠ¨</code>ã€‚<br>3ï¼‰è¿›ç¨‹æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Š<code>è¿è¡Œçš„è¿‡ç¨‹</code>ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚</p><p>åœ¨å¼•å…¥è¿›ç¨‹å®ä½“çš„æ¦‚å¿µåï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¼ ç»Ÿæ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹å®šä¹‰ä¸ºï¼šâ€œè¿›ç¨‹æ˜¯è¿›ç¨‹å®ä½“çš„è¿è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½è¿™é‡Œçš„ç³»ç»Ÿèµ„æºï¼ŒæŒ‡çš„æ˜¯å¤„ç†æœºã€å­˜å‚¨å™¨å’Œå…¶ä»–è®¾å¤‡æœåŠ¡äºæŸè¿›ç¨‹çš„â€œæ—¶é—´â€ï¼Œæ¯”å¦‚ï¼ŒæŠŠå¤„ç†æœºèµ„æºç†è§£ä¸ºå¤„ç†æœºçš„æ—¶é—´ç‰‡æ‰æ˜¯å‡†ç¡®çš„ã€‚å› ä¸ºè¿›ç¨‹æ˜¯è¿™äº›èµ„æºåˆ†é…å’Œè°ƒåº¦çš„ç‹¬ç«‹å•ä½ï¼Œå³â€œæ—¶é—´ç‰‡â€åˆ†é…çš„ç‹¬ç«‹å•ä½ï¼Œè¿™å°±å†³å®šäº†ï¼Œè¿›ç¨‹ä¸€å®šæ˜¯ä¸€ä¸ªåŠ¨æ€çš„ã€è¿‡ç¨‹æ€§çš„æ¦‚å¿µã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601100224159.png" alt="image-20210601100224159"></p><h4 id="è¿›ç¨‹çš„ç‰¹å¾"><a href="#è¿›ç¨‹çš„ç‰¹å¾" class="headerlink" title="è¿›ç¨‹çš„ç‰¹å¾"></a>è¿›ç¨‹çš„ç‰¹å¾</h4><p>è¿›ç¨‹æ˜¯ç”±å¤šç¨‹åºçš„å¹¶å‘æ‰§è¡Œè€Œå¼•å‡ºçš„ï¼Œå®ƒå’Œç¨‹åºæ˜¯ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„æ¦‚å¿µã€‚è¿›ç¨‹çš„åŸºæœ¬ç‰¹å¾æ˜¯å¯¹æ¯”å•ä¸ªç¨‹åºçš„é¡ºåºæ‰§è¡Œæå‡ºçš„ï¼Œä¹Ÿæ˜¯å¯¹è¿›ç¨‹ç®¡ç†æå‡ºçš„åŸºæœ¬è¦æ±‚</p><ul><li>åŠ¨æ€æ€§ï¼šè¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œå®ƒæœ‰ç€åˆ›å»ºã€æ´»åŠ¨ã€æš‚åœã€ç»ˆæ­¢ç­‰è¿‡ç¨‹ï¼Œå…·æœ‰ä¸€å®šçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯åŠ¨æ€åœ°äº§ç”Ÿã€å˜åŒ–å’Œæ¶ˆäº¡çš„ã€‚åŠ¨æ€æ€§æ˜¯è¿›ç¨‹æœ€åŸºæœ¬çš„ç‰¹å¾</li><li>å¹¶å‘æ€§ï¼šæŒ‡å¤šä¸ªè¿›ç¨‹å®ä½“ï¼ŒåŒå­˜äºå†…å­˜ä¸­ï¼Œèƒ½åœ¨ä¸€æ®µæ—¶é—´å†…åŒæ—¶è¿è¡Œï¼Œ<code>å¹¶å‘æ€§æ˜¯è¿›ç¨‹çš„é‡è¦ç‰¹å¾ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿçš„é‡è¦ç‰¹å¾</code>ã€‚å¼•å…¥è¿›ç¨‹çš„ç›®çš„å°±æ˜¯ä¸ºäº†ä½¿ç¨‹åºèƒ½ä¸å…¶ä»–è¿›ç¨‹çš„ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä»¥æé«˜èµ„æºåˆ©ç”¨ç‡</li><li>ç‹¬ç«‹æ€§ï¼šæŒ‡<code>è¿›ç¨‹å®ä½“æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹è·å¾—èµ„æºå’Œç‹¬ç«‹æ¥å—è°ƒåº¦çš„åŸºæœ¬å•ä½</code>ã€‚å‡¡æœªå»ºç«‹PCBçš„ç¨‹åºéƒ½ä¸èƒ½ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•ä½å‚ä¸è¿è¡Œã€‚</li><li>å¼‚æ­¥æ€§ï¼šç”±äºè¿›ç¨‹çš„ç›¸äº’åˆ¶çº¦ï¼Œä½¿è¿›ç¨‹å…·æœ‰æ‰§è¡Œçš„é—´æ–­æ€§ï¼Œå³è¿›ç¨‹æŒ‰å„è‡ªç‹¬ç«‹çš„ã€ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ã€‚å¼‚æ­¥æ€§ä¼šå¯¼è‡´æ‰§è¡Œç»“æœçš„ä¸å¯å†ç°æ€§ï¼Œä¸ºæ­¤ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­å¿…é¡»é…ç½®ç›¸åº”çš„è¿›ç¨‹åŒæ­¥æœºåˆ¶</li><li>ç»“æ„æ€§ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½é…ç½®ä¸€ä¸ªPCBå¯¹å…¶è¿›è¡Œæè¿°ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼Œ<code>è¿›ç¨‹å®ä½“æ˜¯ç”±ç¨‹åºæ®µã€æ•°æ®æ®µå’Œè¿›ç¨‹æ§åˆ¶æ®µä¸‰éƒ¨åˆ†ç»„æˆçš„</code></li></ul><h3 id="1-2-è¿›ç¨‹çš„çŠ¶æ€ä¸è½¬æ¢"><a href="#1-2-è¿›ç¨‹çš„çŠ¶æ€ä¸è½¬æ¢" class="headerlink" title="1.2 è¿›ç¨‹çš„çŠ¶æ€ä¸è½¬æ¢"></a>1.2 è¿›ç¨‹çš„çŠ¶æ€ä¸è½¬æ¢</h3><p><img src="https://img-blog.csdnimg.cn/20200706161301448.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2020040220064459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šå¸¸è¿›ç¨‹æœ‰ä»¥ä¸‹äº”ç§çŠ¶æ€ï¼Œå‰ä¸‰ç§æ˜¯è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€<br>1ï¼‰è¿è¡ŒçŠ¶æ€ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†æœºä¸Šè¿è¡Œã€‚<code>åœ¨å•å¤„ç†æœºç¯å¢ƒä¸‹ï¼Œæ¯ä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€</code>ã€‚</p><p>2ï¼‰å°±ç»ªçŠ¶æ€ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡Œçš„çŠ¶æ€ï¼Œ<code>å³è¿›ç¨‹è·å¾—äº†é™¤å¤„ç†æœºä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æº,ä¸€æ—¦å¾—åˆ°å¤„ç†æœºå³å¯è¿è¡Œ</code></p><p>3ï¼‰é˜»å¡çŠ¶æ€ï¼Œåˆç§°ç­‰å¾…çŠ¶æ€ï¼š<code>è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œï¼Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨ï¼ˆä¸åŒ…æ‹¬å¤„ç†æœºï¼‰æˆ–ç­‰å¾…è¾“å…¥è¾“å‡ºå®Œæˆã€‚å³ä½¿å¤„ç†æœºç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œ</code>ã€‚</p><p>4ï¼‰åˆ›å»ºçŠ¶æ€ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªè½¬åˆ°å°±ç»ªçŠ¶æ€ã€‚åˆ›å»ºè¿›ç¨‹é€šå¸¸éœ€è¦å¤šä¸ªæ­¥éª¤ï¼š<code>é¦–å…ˆç”³è¯·ä¸€ä¸ªç©ºç™½çš„PCBï¼Œå¹¶å‘PCBä¸­å¡«å†™ä¸€äº›æ§åˆ¶å’Œç®¡ç†è¿›ç¨‹çš„ä¿¡æ¯ï¼›ç„¶åç”±ç³»ç»Ÿä¸ºè¯¥è¿›ç¨‹åˆ†é…è¿è¡Œæ—¶æ‰€å¿…éœ€çš„èµ„æºï¼šæœ€åæŠŠè¯¥è¿›ç¨‹è½¬å…¥åˆ°å°±ç»ªçŠ¶æ€</code></p><p>5ï¼‰ç»“æŸçŠ¶æ€ï¼šè¿›ç¨‹æ­£ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ï¼Œè¿™å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œã€‚å½“è¿›ç¨‹éœ€è¦ç»“æŸè¿è¡Œæ—¶ï¼Œ<code>ç³»ç»Ÿé¦–å…ˆå¿…é¡»ç½®è¯¥è¿›ç¨‹ä¸ºç»“æŸçŠ¶æ€ï¼Œç„¶åå†è¿›ä¸€æ­¥å¤„ç†èµ„æºé‡Šæ”¾å’Œå›æ”¶ç­‰å·¥ä½œã€‚</code></p><p><code>æ³¨æ„åŒºåˆ«å°±ç»ªçŠ¶æ€å’Œç­‰å¾…çŠ¶æ€ï¼šå°±ç»ªçŠ¶æ€æ˜¯æŒ‡è¿›ç¨‹ä»…ç¼ºå°‘å¤„ç†æœºï¼Œåªè¦è·å¾—å¤„ç†æœºèµ„æºå°±ç«‹å³æ‰§è¡Œï¼›è€Œç­‰å¾…çŠ¶æ€æ˜¯æŒ‡è¿›ç¨‹éœ€è¦å…¶ä»–èµ„æºï¼ˆé™¤äº†å¤„ç†æœºï¼‰æˆ–ç­‰å¾…æŸä¸€äº‹ä»¶ã€‚</code><br><code>ä¹‹æ‰€ä»¥æŠŠå¤„ç†æœºå’Œå…¶ä»–èµ„æºåˆ’åˆ†å¼€ï¼Œæ˜¯å› ä¸ºåœ¨åˆ†æ—¶ç³»ç»Ÿçš„æ—¶é—´ç‰‡è½®è½¬æœºåˆ¶ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†åˆ°çš„æ—¶é—´ç‰‡æ˜¯è‹¥å¹²æ¯«ç§’</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›ç¨‹å¾—åˆ°å¤„ç†æœºçš„æ—¶é—´å¾ˆçŸ­ä¸”éå¸¸é¢‘ç¹ï¼Œè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å®é™…ä¸Šæ˜¯é¢‘ç¹åœ°è½¬æ¢åˆ°å°±ç»ªçŠ¶æ€çš„ï¼šè€Œå…¶ä»–èµ„æºï¼ˆå¦‚å¤–è®¾ï¼‰çš„ä½¿ç”¨å’Œåˆ†é…æˆ–è€…æŸä¸€äº‹ä»¶çš„å‘ç”Ÿï¼ˆå¦‚I/Oæ“ä½œçš„å®Œæˆï¼‰å¯¹åº”çš„æ—¶é—´ç›¸å¯¹æ¥è¯´å¾ˆé•¿ï¼Œè¿›ç¨‹è½¬æ¢åˆ°ç­‰å¾…çŠ¶æ€çš„æ¬¡æ•°ä¹Ÿç›¸å¯¹è¾ƒå°‘ã€‚è¿™æ ·æ¥çœ‹ï¼Œå°±ç»ªçŠ¶æ€å’Œç­‰å¾…çŠ¶æ€æ˜¯è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„çŠ¶æ€ï¼Œå¾ˆæ˜¾ç„¶éœ€è¦åŠ ä»¥åŒºåˆ†ã€‚</p><h4 id="çŠ¶æ€çš„è½¬æ¢"><a href="#çŠ¶æ€çš„è½¬æ¢" class="headerlink" title="çŠ¶æ€çš„è½¬æ¢"></a>çŠ¶æ€çš„è½¬æ¢</h4><p>å°±ç»ªçŠ¶æ€â†’è¿è¡ŒçŠ¶æ€ï¼šå¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹è¢«è°ƒåº¦åï¼Œè·å¾—å¤„ç†æœºèµ„æºï¼ˆåˆ†æ´¾å¤„ç†æœºæ—¶é—´ç‰‡ï¼‰äºæ˜¯è¿›ç¨‹ç”±å°±ç»ªçŠ¶æ€è½¬æ¢ä¸ºè¿è¡ŒçŠ¶æ€</p><p>è¿è¡ŒçŠ¶æ€â†’å°±ç»ªçŠ¶æ€ï¼šå¤„äºè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç”¨å®Œåï¼Œä¸å¾—ä¸è®©å‡ºå¤„ç†æœºï¼Œä»è€Œè¿›ç¨‹ç”±è¿è¡ŒçŠ¶æ€è½¬æ¢ä¸ºå°±ç»ªçŠ¶æ€ã€‚æ­¤å¤–ï¼Œåœ¨å¯å‰¥å¤ºçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå½“æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å°±ç»ªæ—¶ï¼Œè°ƒåº¦ç¨‹åº¦å°†æ­£æ‰§è¡Œçš„è¿›ç¨‹è½¬æ¢ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè®©æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹æ‰§è¡Œã€‚</p><p>è¿è¡ŒçŠ¶æ€â†’é˜»å¡çŠ¶æ€ï¼šå½“è¿›ç¨‹è¯·æ±‚æŸä¸€èµ„æºï¼ˆå¦‚å¤–è®¾ï¼‰çš„ä½¿ç”¨å’Œåˆ†é…æˆ–ç­‰å¾…æŸä¸€äº‹ä»¶çš„å‘ç”Ÿï¼ˆå¦‚IOæ“ä½œçš„å®Œæˆï¼‰æ—¶ï¼Œå®ƒå°±ä»è¿è¡ŒçŠ¶æ€è½¬æ¢ä¸ºé˜»å¡çŠ¶æ€ã€‚è¿›ç¨‹ä»¥ç³»ç»Ÿè°ƒç”¨çš„å½¢å¼è¯·æ±‚æ“ä½œç³»ç»Ÿæä¾›æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„ã€ç”±è¿è¡Œç”¨æˆ·æ€ç¨‹åºè°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿‡ç¨‹çš„å½¢å¼</p><p>é˜»å¡çŠ¶æ€â†’å°±ç»ªçŠ¶æ€ï¼šå½“è¿›ç¨‹ç­‰å¾…çš„äº‹ä»¶åˆ°æ¥æ—¶ï¼Œå¦‚I/Oæ“ä½œç»“æŸæˆ–ä¸­æ–­ç»“æŸæ—¶ï¼Œä¸­æ–­å¤„ç†ç¨‹åºå¿…é¡»æŠŠç›¸åº”è¿›ç¨‹çš„çŠ¶æ€ç”±é˜»å¡çŠ¶æ€è½¬æ¢ä¸ºå°±ç»ªçŠ¶æ€<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªè¿›ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜æˆé˜»å¡çŠ¶æ€æ˜¯ä¸€ä¸ªä¸»åŠ¨çš„è¡Œä¸ºï¼Œè€Œä»é˜»å¡çŠ¶æ€å˜åˆ°å°±å°±ç»ªçŠ¶æ€æ˜¯ä¸€ä¸ªè¢«åŠ¨çš„è¡Œä¸ºï¼Œéœ€è¦å…¶ä»–ç›¸å…³è¿›ç¨‹çš„ååŠ©</p><h3 id="1-3-è¿›ç¨‹æ§åˆ¶"><a href="#1-3-è¿›ç¨‹æ§åˆ¶" class="headerlink" title="1.3 è¿›ç¨‹æ§åˆ¶"></a>1.3 è¿›ç¨‹æ§åˆ¶</h3><p><img src="https://img-blog.csdnimg.cn/20200706161406983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›ç¨‹æ§åˆ¶çš„ä¸»è¦åŠŸèƒ½æ˜¯å¯¹ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹å®æ–½æœ‰æ•ˆçš„ç®¡ç†ï¼Œå®ƒå…·æœ‰<code>åˆ›å»ºæ–°è¿›ç¨‹ã€æ’¤é”€å·²æœ‰è¿›ç¨‹ã€å®ç°è¿›ç¨‹çŠ¶æ€è½¬æ¢ç­‰åŠŸèƒ½</code>ã€‚<code>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬æŠŠè¿›ç¨‹æ§åˆ¶ç”¨çš„ç¨‹åºæ®µç§°ä¸ºåŸè¯­ï¼ŒåŸè¯­çš„ç‰¹ç‚¹æ˜¯æ‰§è¡ŒæœŸé—´ä¸å…è®¸ä¸­æ–­ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„åŸºæœ¬å•ä½ã€‚</code><br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601103352347.png" alt="image-20210601103352347"></p><h4 id="è¿›ç¨‹çš„åˆ›å»º"><a href="#è¿›ç¨‹çš„åˆ›å»º" class="headerlink" title="è¿›ç¨‹çš„åˆ›å»º"></a>è¿›ç¨‹çš„åˆ›å»º</h4><p>å…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ­¤æ—¶åˆ›å»ºè€…ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œè¢«åˆ›å»ºçš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚å­è¿›ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºã€‚å½“å­è¿›ç¨‹è¢«æ’¤é”€æ—¶ï¼Œåº”å°†å…¶ä»çˆ¶è¿›ç¨‹é‚£é‡Œè·å¾—çš„èµ„æºå½’è¿˜ç»™çˆ¶è¿›ç¨‹ã€‚æ­¤å¤–ï¼Œåœ¨æ’¤é”€çˆ¶è¿›ç¨‹æ—¶ï¼Œä¹Ÿå¿…é¡»åŒæ—¶æ’¤é”€å…¶æ‰€æœ‰çš„å­è¿›ç¨‹</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>ç»ˆç«¯ç”¨æˆ·ç™»å½•ç³»ç»Ÿã€ä½œä¸šè°ƒåº¦ã€ç³»ç»Ÿæä¾›æœåŠ¡ã€ç”¨æˆ·ç¨‹åºçš„åº”ç”¨è¯·æ±‚ç­‰éƒ½ä¼šå¼•èµ·è¿›ç¨‹çš„åˆ›å»º</code>ã€‚æ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼ˆåˆ›å»ºåŸè¯­ï¼‰ï¼š</p><p>1ï¼‰ä¸ºæ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹æ ‡è¯†å·ï¼Œå¹¶ç”³è¯·ä¸€ä¸ªç©ºç™½çš„PCBï¼ˆPCBæ˜¯æœ‰é™çš„ï¼‰.è‹¥PCBç”³è¯·å¤±è´¥åˆ™åˆ›å»ºå¤±è´¥ã€‚</p><p>2ï¼‰ä¸ºè¿›ç¨‹åˆ†é…èµ„æºï¼Œä¸ºæ–°è¿›ç¨‹çš„ç¨‹åºå’Œæ•°æ®ï¼Œä»¥åŠç”¨æˆ·æ ˆåˆ†é…å¿…è¦çš„å†…å­˜ç©ºé—´ï¼ˆåœ¨PCBä¸­ä½“ç°ï¼‰.æ³¨æ„ï¼šè¿™é‡Œå¦‚æœèµ„æºä¸è¶³ï¼ˆæ¯”å¦‚å†…å­˜ç©ºé—´ï¼‰ï¼Œå¹¶ä¸æ˜¯åˆ›å»ºå¤±è´¥ï¼Œè€Œæ˜¯å¤„äºâ€œç­‰å¾…çŠ¶æ€æˆ–ç§°ä¸ºâ€œé˜»å¡çŠ¶æ€â€ï¼Œç­‰å¾…çš„æ˜¯å†…å­˜è¿™ä¸ªèµ„æº</p><p>3ï¼‰åˆå§‹åŒ–PCBï¼Œä¸»è¦åŒ…æ‹¬åˆå§‹åŒ–æ ‡å¿—ä¿¡æ¯ã€åˆå§‹åŒ–å¤„ç†æœºçŠ¶æ€ä¿¡æ¯å’Œåˆå§‹åŒ–å¤„ç†æœºæ§åˆ¶ä¿¡æ¯ï¼Œä»¥åŠè®¾ç½®è¿›ç¨‹çš„ä¼˜å…ˆçº§ç­‰</p><p>4ï¼‰å¦‚æœè¿›ç¨‹å°±ç»ªé˜Ÿåˆ—èƒ½å¤Ÿæ¥çº³æ–°è¿›ç¨‹ï¼Œå°±å°†æ–°è¿›ç¨‹æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ï¼Œç­‰å¾…è¢«è°ƒåº¦è¿è¡Œ</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601103626193.png" alt="image-20210601103626193"></p><h4 id="è¿›ç¨‹çš„ç»ˆæ­¢"><a href="#è¿›ç¨‹çš„ç»ˆæ­¢" class="headerlink" title="è¿›ç¨‹çš„ç»ˆæ­¢"></a>è¿›ç¨‹çš„ç»ˆæ­¢</h4><p>å¼•èµ·è¿›ç¨‹ç»ˆæ­¢çš„äº‹ä»¶ä¸»è¦æœ‰ï¼šæ­£å¸¸ç»“æŸï¼Œè¡¨ç¤ºè¿›ç¨‹çš„ä»»åŠ¡å·²ç»å®Œæˆå’Œå‡†å¤‡é€€å‡ºè¿è¡Œã€‚å¼‚å¸¸ç»“æŸï¼Œè¡¨ç¤ºè¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œå‘ç”Ÿäº†æŸç§å¼‚å¸¸äº‹ä»¶ï¼Œä½¿ç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œï¼Œå¦‚å­˜å‚¨åŒºè¶Šç•Œã€ä¿æŠ¤é”™ã€éæ³•æŒ‡ä»¤ã€ç‰¹æƒæŒ‡ä»¤é”™ã€I/Oæ•…éšœç­‰ã€‚å¤–ç•Œå¹²é¢„æ˜¯æŒ‡è¿›ç¨‹åº”å¤–ç•Œçš„è¯·æ±‚è€Œç»ˆæ­¢è¿è¡Œï¼Œå¦‚æ“ä½œå‘˜æˆ–æ“ä½œç³»ç»Ÿå¹²é¢„ã€çˆ¶è¿›ç¨‹è¯·æ±‚å’Œçˆ¶è¿›ç¨‹ç»ˆæ­¢</p><p>æ“ä½œç³»ç»Ÿç»ˆæ­¢è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼ˆæ’¤é”€åŸè¯­ï¼‰</p><p>1ï¼‰æ ¹æ®è¢«ç»ˆæ­¢è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œæ£€ç´¢PCBï¼Œä»ä¸­è¯»å‡ºè¯¥è¿›ç¨‹çš„çŠ¶æ€<br>2ï¼‰è‹¥è¢«ç»ˆæ­¢è¿›ç¨‹å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå°†å¤„ç†æœºèµ„æºåˆ†é…ç»™å…¶ä»–è¿›ç¨‹<br>3ï¼‰è‹¥è¯¥è¿›ç¨‹è¿˜æœ‰å­è¿›ç¨‹ï¼Œåˆ™åº”å°†å…¶æ‰€æœ‰å­è¿›ç¨‹ç»ˆæ­¢<br>4ï¼‰å°†è¯¥è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºï¼Œæˆ–å½’è¿˜ç»™å…¶çˆ¶è¿›ç¨‹æˆ–å½’è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚<br>5ï¼‰å°†è¯¥PCBä»æ‰€åœ¨é˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰ä¸­åˆ é™¤</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601103701471.png" alt="image-20210601103701471"></p><h4 id="è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’"><a href="#è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’" class="headerlink" title="è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’"></a>è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’</h4><p>æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæœŸå¾…çš„æŸäº›äº‹ä»¶æœªå‘ç”Ÿï¼Œå¦‚è¯·æ±‚ç³»ç»Ÿèµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œçš„å®Œæˆæ•°æ®å°šæœªåˆ°è¾¾æˆ–æ— æ–°å·¥ä½œå¯åšç­‰ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡åŸè¯­ï¼ˆBlockï¼‰ï¼Œä½¿è‡ªå·±ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚å¯è§ï¼Œè¿›ç¨‹çš„é˜»å¡æ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œä¹Ÿå› æ­¤åªæœ‰å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹ï¼ˆè·å¾—CPUï¼‰ï¼Œæ‰å¯èƒ½å°†å…¶è½¬ä¸ºé˜»å¡çŠ¶æ€ã€‚é˜»å¡åŸè¯­çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯</p><p>1ï¼‰æ‰¾åˆ°å°†è¦è¢«é˜»å¡è¿›ç¨‹çš„æ ‡è¯†å·å¯¹åº”çš„PCB.<br>2ï¼‰è‹¥è¯¥è¿›ç¨‹ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä¿æŠ¤å…¶ç°åœºï¼Œå°†å…¶çŠ¶æ€è½¬ä¸ºé˜»å¡çŠ¶æ€ï¼Œåœæ­¢è¿è¡Œã€‚<br>3ï¼‰æŠŠè¯¥PCBæ’å…¥åˆ°ç›¸åº”äº‹ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å»<br>å½“è¢«é˜»å¡è¿›ç¨‹æ‰€æœŸå¾…çš„äº‹ä»¶å‡ºç°æ—¶ï¼Œå¦‚å®ƒæ‰€å¯åŠ¨çš„IOæ“ä½œå·²å®Œæˆæˆ–å…¶æ‰€æœŸå¾…çš„æ•°æ®å·²åˆ°è¾¾åˆ™ç”±æœ‰å…³è¿›ç¨‹ï¼ˆæ¯”å¦‚ï¼Œæä¾›æ•°æ®çš„è¿›ç¨‹ï¼‰è°ƒç”¨å–šé†’åŸè¯­ï¼ˆWakeupï¼‰ï¼Œå°†ç­‰å¾…è¯¥äº‹ä»¶çš„è¿›ç¨‹å”¤é†’å”¤é†’åŸè¯­çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯</p><p>1ï¼‰åœ¨è¯¥äº‹ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰¾åˆ°ç›¸åº”è¿›ç¨‹çš„PCB<br>2ï¼‰å°†å…¶ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»å‡ºï¼Œå¹¶ç½®å…¶çŠ¶æ€ä¸ºå°±ç»ªçŠ¶æ€<br>3ï¼‰æŠŠè¯¥PCBæ’å…¥å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦ç¨‹åºè°ƒåº¦</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBlockåŸè¯­å’Œ WakeupåŸè¯­æ˜¯ä¸€å¯¹ä½œç”¨åˆšå¥½ç›¸åçš„åŸè¯­ï¼Œå¿…é¡»æˆå¯¹ä½¿ç”¨ã€‚ BlockåŸè¯­æ˜¯ç”±è¢«é˜»å¡è¿›ç¨‹è‡ªæˆ‘è°ƒç”¨å®ç°çš„ï¼Œè€Œ WakeupåŸè¯­åˆ™æ˜¯ç”±ä¸€ä¸ªä¸è¢«å”¤é†’è¿›ç¨‹ç›¸åˆä½œæˆ–è¢«å…¶ä»–ç›¸å…³çš„è¿›ç¨‹è°ƒç”¨å®ç°çš„</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601103839486.png" alt="image-20210601103839486"></p><h4 id="è¿›ç¨‹åˆ‡æ¢"><a href="#è¿›ç¨‹åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹åˆ‡æ¢"></a>è¿›ç¨‹åˆ‡æ¢</h4><p>å¯¹äºé€šå¸¸çš„è¿›ç¨‹ï¼Œå…¶åˆ›å»ºã€æ’¤é”€ä»¥åŠè¦æ±‚ç”±ç³»ç»Ÿè®¾å¤‡å®Œæˆçš„IOæ“ä½œéƒ½æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨è€Œè¿›å…¥å†…æ ¸ï¼Œå†ç”±å†…æ ¸ä¸­ç›¸åº”å¤„ç†ç¨‹åºäºˆä»¥å®Œæˆçš„ã€‚è¿›ç¨‹åˆ‡æ¢åŒæ ·æ˜¯åœ¨å†…æ ¸çš„æ”¯æŒä¸‹å®ç°çš„ï¼Œå› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„è¿›ç¨‹åˆ‡æ¢æ˜¯æŒ‡å¤„ç†æœºä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹çš„è¿è¡Œç¯å¢ƒäº§ç”Ÿäº†å®è´¨æ€§çš„å˜åŒ–ã€‚è¿›ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹å¦‚ä¸‹</p><p>1ï¼‰ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚<br>2ï¼‰æ›´æ–°PCBä¿¡æ¯<br>3ï¼‰æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ã€‚<br>4ï¼‰é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCB<br>5ï¼‰æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„<br>6ï¼‰æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡</p><p>æ³¨æ„ï¼Œè¿›ç¨‹åˆ‡æ¢ä¸å¤„ç†æœºæ¨¡å¼åˆ‡æ¢æ˜¯ä¸åŒçš„ï¼Œæ¨¡å¼åˆ‡æ¢æ—¶ï¼Œå¤„ç†æœºé€»è¾‘ä¸Šå¯èƒ½è¿˜åœ¨åŒä¸€è¿›ç¨‹ä¸­è¿è¡Œã€‚å¦‚æœè¿›ç¨‹å› ä¸­æ–­æˆ–å¼‚å¸¸è¿›å…¥åˆ°æ ¸å¿ƒæ€è¿è¡Œï¼Œæ‰§è¡Œå®Œååˆå›åˆ°ç”¨æˆ·æ€åˆšè¢«ä¸­æ–­çš„ç¨‹åºè¿è¡Œåˆ™æ“ä½œç³»ç»Ÿåªéœ€æ¢å¤è¿›ç¨‹è¿›å…¥å†…æ ¸æ—¶æ‰€ä¿å­˜çš„CPUç°åœºï¼Œæ— éœ€æ”¹å˜å½“å‰è¿›ç¨‹çš„ç¯å¢ƒä¿¡æ¯ã€‚ä½†è‹¥è¦åˆ‡æ¢è¿›ç¨‹ï¼Œå½“å‰è¿è¡Œè¿›ç¨‹æ”¹å˜äº†ï¼Œåˆ™å½“å‰è¿›ç¨‹çš„ç¯å¢ƒä¿¡æ¯ä¹Ÿéœ€è¦æ”¹å˜ã€‚</p><p>æ³¨æ„ï¼šâ€œè°ƒåº¦â€å’Œâ€œåˆ‡æ¢â€çš„åŒºåˆ«ï¼Œè°ƒåº¦æ˜¯æŒ‡å†³å®šèµ„æºåˆ†é…ç»™å“ªä¸ªè¿›ç¨‹çš„è¡Œä¸ºï¼Œæ˜¯ä¸€ç§å†³ç­–è¡Œä¸ºåˆ‡æ¢æ˜¯æŒ‡å®é™…åˆ†é…çš„è¡Œä¸ºï¼Œæ˜¯æ‰§è¡Œè¡Œä¸ºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå…ˆæœ‰èµ„æºçš„è°ƒåº¦ï¼Œç„¶åæ‰æœ‰è¿›ç¨‹çš„åˆ‡æ¢</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601104024983.png" alt="image-20210601104024983"></p><h3 id="1-4-è¿›ç¨‹çš„ç»„ç»‡"><a href="#1-4-è¿›ç¨‹çš„ç»„ç»‡" class="headerlink" title="1.4 è¿›ç¨‹çš„ç»„ç»‡"></a>1.4 è¿›ç¨‹çš„ç»„ç»‡</h3><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„èµ„æºåˆ†é…å’Œç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ã€‚å®ƒä¸€èˆ¬ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ</p><ul><li>è¿›ç¨‹æ§åˆ¶å—<br>è¿›ç¨‹åˆ›å»ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±æ–°å»ºä¸€ä¸ªPCBç»“æ„ï¼Œå®ƒä¹‹åå°±å¸¸é©»å†…å­˜ï¼Œä»»ä¸€æ—¶åˆ»å¯ä»¥å­˜å–ï¼Œåœ¨è¿›ç¨‹ç»“æŸæ—¶åˆ é™¤ã€‚PCBæ˜¯è¿›ç¨‹å®ä½“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚å½“åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿä¸ºè¯¥è¿›ç¨‹å»ºç«‹ä¸€ä¸ªPCBï¼šå½“è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿé€šè¿‡å…¶PCBäº†è§£è¿›ç¨‹çš„ç°è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œæ§åˆ¶å’Œç®¡ç†ï¼›å½“è¿›ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿæ”¶å›å…¶PCBï¼Œè¯¥è¿›ç¨‹éšä¹‹æ¶ˆäº¡ã€‚æ“ä½œç³»ç»Ÿé€šè¿‡PCBè¡¨æ¥ç®¡ç†å’Œæ§åˆ¶è¿›ç¨‹PCBä¸»è¦åŒ…æ‹¬è¿›ç¨‹æè¿°ä¿¡æ¯ã€è¿›ç¨‹æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ã€èµ„æºåˆ†é…æ¸…å•å’Œå¤„ç†æœºç›¸å…³ä¿¡æ¯ç­‰ã€‚å„éƒ¨åˆ†çš„ä¸»è¦è¯´æ˜å¦‚ä¸‹ï¼š</li></ul><p><img src="https://img-blog.csdnimg.cn/20200531175224684.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>1ï¼‰è¿›ç¨‹æè¿°ä¿¡æ¯<br>è¿›ç¨‹æ ‡è¯†ç¬¦ï¼šæ ‡å¿—å„ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå¹¶ä¸”æ˜¯å”¯ä¸€çš„æ ‡è¯†å·<br>ç”¨æˆ·æ ‡è¯†ç¬¦ï¼šè¿›ç¨‹å½’å±çš„ç”¨æˆ·ï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ä¸»è¦ä¸ºå…±äº«å’Œä¿æŠ¤æœåŠ¡</p><p>2ï¼‰è¿›ç¨‹æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯è¿›ç¨‹å½“å‰çŠ¶æ€ï¼šæè¿°è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä½œä¸ºå¤„ç†æœºåˆ†é…è°ƒåº¦çš„ä¾æ®è¿›ç¨‹ä¼˜å…ˆçº§ï¼šæè¿°è¿›ç¨‹æŠ¢å å¤„ç†æœºçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹å¯ä»¥ä¼˜å…ˆè·å¾—å¤„ç†æœºã€‚</p><p>3ï¼‰èµ„æºåˆ†é…æ¸…å•ï¼Œç”¨äºè¯´æ˜æœ‰å…³å†…å­˜åœ°å€ç©ºé—´æˆ–è™šæ‹Ÿåœ°å€ç©ºé—´çš„çŠ¶å†µï¼šæ‰€æ‰“å¼€æ–‡ä»¶çš„åˆ—è¡¨å’Œæ‰€ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºè®¾å¤‡ä¿¡æ¯ã€‚</p><p>4ï¼‰å¤„ç†æœºç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æŒ‡å¤„ç†æœºä¸­å„å¯„å­˜å™¨å€¼ï¼Œå½“è¿›ç¨‹è¢«åˆ‡æ¢æ—¶ï¼Œå¤„ç†æœºçŠ¶æ€ä¿¡æ¯éƒ½å¿…é¡»ä¿å­˜åœ¨ç›¸åº”çš„PCBä¸­ï¼Œä»¥ä¾¿åœ¨è¯¥è¿›ç¨‹é‡æ–°æ‰§è¡Œæ—¶ï¼Œèƒ½å†ä»æ–­ç‚¹ç»§ç»­æ‰§è¡Œåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œé€šå¸¸å­˜åœ¨ç€è®¸å¤šè¿›ç¨‹ï¼Œæœ‰çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œæœ‰çš„å¤„äºé˜»å¡çŠ¶æ€ï¼Œè€Œä¸”é˜»å¡çš„åŸå› å„ä¸ç›¸åŒã€‚ä¸ºäº†æ–¹ä¾¿è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ï¼Œéœ€è¦å°†å„è¿›ç¨‹çš„PCBç”¨é€‚å½“çš„æ–¹æ³•ç»„ç»‡èµ·æ¥ã€‚ç›®å‰å¸¸ç”¨çš„ç»„ç»‡æ–¹å¼æœ‰é“¾æ¥æ–¹å¼å’Œç´¢å¼•æ–¹å¼ä¸¤ç§ã€‚é“¾æ¥æ–¹å¼å°†åŒä¸€çŠ¶æ€çš„PCBé“¾æ¥æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æŠŠå¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹çš„PCBï¼Œæ ¹æ®å…¶é˜»å¡åŸå› çš„ä¸åŒï¼Œæ’æˆå¤šä¸ªé˜»å¡é˜Ÿåˆ—ã€‚ç´¢å¼•æ–¹å¼æ˜¯å°†åŒä¸€çŠ¶æ€çš„è¿›ç¨‹ç»„ç»‡åœ¨ä¸€ä¸ªç´¢å¼•è¡¨ä¸­ï¼Œç´¢å¼•è¡¨çš„è¡¨é¡¹æŒ‡å‘ç›¸åº”çš„PCBä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„ç´¢å¼•è¡¨ï¼Œå¦‚å°±ç»ªç´¢å¼•è¡¨å’Œé˜»å¡ç´¢å¼•è¡¨ç­‰</p><ul><li><p>ç¨‹åºæ®µ<br>ç¨‹åºæ®µå°±æ˜¯èƒ½è¢«è¿›ç¨‹è°ƒåº¦ç¨‹åºè°ƒåº¦åˆ°CPUæ‰§è¡Œçš„ç¨‹åºä»£ç æ®µã€‚æ³¨æ„ï¼Œç¨‹åºå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œå°±æ˜¯è¯´å¤šä¸ªè¿›ç¨‹å¯ä»¥è¿è¡ŒåŒä¸€ä¸ªç¨‹åº</p></li><li><p>æ•°æ®æ®µ<br>ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®æ®µï¼Œå¯ä»¥æ˜¯è¿›ç¨‹å¯¹åº”çš„ç¨‹åºåŠ å·¥å¤„ç†çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¨‹åºæ‰§è¡Œæ—¶äº§ç”Ÿçš„ä¸­é—´æˆ–æœ€ç»ˆç»“æœ</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20200402194654392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402194758818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402194818323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-5-è¿›ç¨‹çš„é€šä¿¡"><a href="#1-5-è¿›ç¨‹çš„é€šä¿¡" class="headerlink" title="1.5 è¿›ç¨‹çš„é€šä¿¡"></a>1.5 è¿›ç¨‹çš„é€šä¿¡</h3><p><img src="https://img-blog.csdnimg.cn/20200706161449867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›ç¨‹é€šä¿¡æ˜¯æŒ‡è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚PVæ“ä½œæ˜¯ä½çº§é€šä¿¡æ–¹å¼ï¼Œé«˜çº§é€šä¿¡æ–¹å¼æ˜¯æŒ‡ä»¥è¾ƒé«˜çš„æ•ˆç‡ä¼ è¾“å¤§é‡æ•°æ®çš„é€šä¿¡æ–¹å¼ã€‚é«˜çº§é€šä¿¡æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªç±»:</p><h4 id="1-5-1-å…±äº«å­˜å‚¨"><a href="#1-5-1-å…±äº«å­˜å‚¨" class="headerlink" title="1.5.1 å…±äº«å­˜å‚¨"></a>1.5.1 å…±äº«å­˜å‚¨</h4><p><img src="https://img-blog.csdnimg.cn/20200531184114689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200402205029332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_1,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-5-2-æ¶ˆæ¯ä¼ é€’"><a href="#1-5-2-æ¶ˆæ¯ä¼ é€’" class="headerlink" title="1.5.2 æ¶ˆæ¯ä¼ é€’"></a>1.5.2 æ¶ˆæ¯ä¼ é€’</h4><p><img src="https://img-blog.csdnimg.cn/2020053118444774.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601105328555.png" alt="image-20210601105328555"></p><h4 id="1-5-3-ç®¡é“é€šä¿¡"><a href="#1-5-3-ç®¡é“é€šä¿¡" class="headerlink" title="1.5.3 ç®¡é“é€šä¿¡"></a>1.5.3 ç®¡é“é€šä¿¡</h4><p><img src="https://img-blog.csdnimg.cn/20200531184934335.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200531185020516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601105231233.png" alt="image-20210601105231233"></p><h3 id="1-6-çº¿ç¨‹æ¦‚å¿µå’Œå¤šçº¿ç¨‹æ¨¡å‹"><a href="#1-6-çº¿ç¨‹æ¦‚å¿µå’Œå¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="1.6 çº¿ç¨‹æ¦‚å¿µå’Œå¤šçº¿ç¨‹æ¨¡å‹"></a>1.6 çº¿ç¨‹æ¦‚å¿µå’Œå¤šçº¿ç¨‹æ¨¡å‹</h3><p><img src="https://img-blog.csdnimg.cn/20200706161521969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-6-1-çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-6-1-çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.6.1 çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"></a>1.6.1 çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</h4><p>å¼•å…¥è¿›ç¨‹çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†æ›´å¥½åœ°ä½¿å¤šé“ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä»¥æé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ï¼Œå¢åŠ å¹¶å‘ç¨‹åº¦ï¼›è€Œå¼•å…¥çº¿ç¨‹ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°ç¨‹åºåœ¨å¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œæé«˜æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½çº¿ç¨‹æœ€ç›´æ¥çš„ç†è§£å°±æ˜¯â€œè½»é‡çº§è¿›ç¨‹â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬çš„CPUæ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œç”±çº¿ç¨‹IDã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨é›†åˆå’Œå †æ ˆç»„æˆã€‚</p><p><code>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¢«ç³»ç»Ÿç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½</code>ï¼Œçº¿ç¨‹è‡ªå·±ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æºä½†å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚ç”±äºçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’åˆ¶çº¦ï¼Œè‡´ä½¿çº¿ç¨‹åœ¨è¿è¡Œä¸­å‘ˆç°å‡ºé—´æ–­æ€§ã€‚<code>çº¿ç¨‹ä¹Ÿæœ‰å°±ç»ªã€é˜»å¡å’Œè¿è¡Œä¸‰ç§åŸºæœ¬çŠ¶æ€</code>ã€‚</p><p>å¼•å…¥çº¿ç¨‹åï¼Œè¿›ç¨‹çš„å†…æ¶µå‘ç”Ÿäº†æ”¹å˜ï¼Œè¿›ç¨‹åªä½œä¸ºé™¤CPUä»¥å¤–ç³»ç»Ÿèµ„æºçš„åˆ†é…å•å…ƒï¼Œ<code>çº¿ç¨‹åˆ™ä½œä¸ºå¤„ç†æœºçš„åˆ†é…å•å…ƒã€‚ç”±äºä¸€ä¸ªè¿›ç¨‹å†…éƒ¨æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹çš„åˆ‡æ¢å‘ç”Ÿåœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œåˆ™åªéœ€è¦å¾ˆå°‘çš„æ—¶ç©ºå¼€é”€</code></p><h4 id="1-6-2-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"><a href="#1-6-2-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ" class="headerlink" title="1.6.2 çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"></a>1.6.2 çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ</h4><ul><li>è°ƒåº¦ã€‚åœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œæ‹¥æœ‰èµ„æºå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½éƒ½æ˜¯è¿›ç¨‹ã€‚åœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>çº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯æ‹¥æœ‰èµ„æºçš„åŸºæœ¬å•ä½</code>ã€‚åœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚åœ¨ä¸åŒè¿›ç¨‹ä¸­è¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œå¦‚ä»ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚</li><li>æ‹¥æœ‰èµ„æºã€‚ä¸è®ºæ˜¯ä¼ ç»Ÿæ“ä½œç³»ç»Ÿè¿˜æ˜¯è®¾æœ‰çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿï¼Œ<code>è¿›ç¨‹éƒ½æ˜¯æ‹¥æœ‰èµ„æºçš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼ˆä¹Ÿæœ‰ä¸€ç‚¹å¿…ä¸å¯å°‘çš„èµ„æºï¼‰</code>ï¼Œä½†çº¿ç¨‹å¯ä»¥è®¿é—®å…¶éš¶å±è¿›ç¨‹çš„ç³»ç»Ÿèµ„æºã€‚æˆ‘ä»¬è¦çŸ¥é“ï¼Œå¦‚æœçº¿ç¨‹ä¹Ÿæ˜¯æ‹¥æœ‰èµ„æºçš„å•ä½ï¼Œé‚£ä¹ˆï¼Œåˆ‡æ¢çº¿ç¨‹ä¹Ÿéœ€è¦è¾ƒå¤§çš„æ—¶ç©ºå¼€é”€ï¼Œçº¿ç¨‹è¿™ä¸ªæ¦‚å¿µçš„æå‡ºå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚</li><li>å¹¶å‘æ€§ã€‚åœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>ä¸ä»…è¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸”å¤šä¸ªçº¿ç¨‹ä¹‹é—´ä¹Ÿå¯ä»¥å¹¶å‘æ‰§è¡Œ</code>ï¼Œä»è€Œä½¿æ“ä½œç³»ç»Ÿå…·æœ‰æ›´å¥½çš„å¹¶å‘æ€§ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚</li><li>ç³»ç»Ÿå¼€é”€ã€‚ç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€IOè®¾å¤‡ç­‰ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œ<code>æ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹CPUç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦åˆ°è¿›ç¨‹CPUç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°</code>ã€‚æ­¤å¤–ï¼Œç”±äºåŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå› æ­¤ï¼Œè¿™äº›çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ä¸é€šä¿¡éå¸¸å®¹æ˜“å®ç°ï¼Œç”šè‡³æ— éœ€æ“ä½œç³»ç»Ÿçš„å¹²é¢„</li><li>åœ°å€ç©ºé—´å’Œå…¶ä»–èµ„æºï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶ï¼‰ï¼šè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼ŒåŒ<code>ä¸€è¿›ç¨‹çš„å„çº¿ç¨‹é—´å…±äº«è¿›ç¨‹çš„èµ„æºï¼ŒæŸè¿›ç¨‹å†…çš„çº¿ç¨‹å¯¹äºå…¶ä»–è¿›ç¨‹ä¸å¯è§</code></li><li>é€šä¿¡æ–¹é¢ï¼šè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰éœ€è¦è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥æ‰‹æ®µçš„è¾…åŠ©ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§è€Œçº¿ç¨‹é—´å¯ä»¥ç›´æ¥è¯»/å†™è¿›ç¨‹æ•°æ®æ®µï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰æ¥è¿›è¡Œé€šä¿¡ã€‚</li></ul><h4 id="1-6-3-çº¿ç¨‹çš„å±æ€§"><a href="#1-6-3-çº¿ç¨‹çš„å±æ€§" class="headerlink" title="1.6.3 çº¿ç¨‹çš„å±æ€§"></a>1.6.3 çº¿ç¨‹çš„å±æ€§</h4><p>åœ¨å¤šçº¿ç¨‹æ“ä½œç³»ç»Ÿä¸­ï¼ŒæŠŠçº¿ç¨‹ä½œä¸ºç‹¬ç«‹è¿è¡Œï¼ˆæˆ–è°ƒåº¦ï¼‰çš„åŸºæœ¬å•ä½ï¼Œæ­¤æ—¶çš„è¿›ç¨‹ï¼Œå·²ä¸å†æ˜¯ä¸ªåŸºæœ¬çš„å¯æ‰§è¡Œå®ä½“ã€‚ä½†è¿›ç¨‹ä»å…·æœ‰ä¸æ‰§è¡Œç›¸å…³çš„çŠ¶æ€ï¼Œæ‰€è°“è¿›ç¨‹å¤„äºâ€œæ‰§è¡Œâ€çŠ¶æ€ï¼Œå®é™…ä¸Šæ˜¯æŒ‡è¯¥è¿›ç¨‹ä¸­æŸçº¿ç¨‹æ­£åœ¨æ‰§è¡Œã€‚çº¿ç¨‹çš„ä¸»è¦å±æ€§å¦‚ä¸‹</p><p>1ï¼‰çº¿ç¨‹æ˜¯ä¸€ä¸ªè½»å‹å®ä½“ï¼Œå®ƒä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½åº”æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å’Œä¸€ä¸ªçº¿ç¨‹æ§åˆ¶å—ï¼Œçº¿ç¨‹æ§åˆ¶å—è®°å½•äº†çº¿ç¨‹æ‰§è¡Œçš„å¯„å­˜å™¨å’Œæ ˆç­‰ç°åœºçŠ¶æ€<br>2ï¼‰ä¸åŒçš„çº¿ç¨‹å¯ä»¥æ‰§è¡Œç›¸åŒçš„ç¨‹åºï¼Œå³åŒä¸€ä¸ªæœåŠ¡ç¨‹åºè¢«ä¸åŒçš„ç”¨æˆ·è°ƒç”¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ºå®ƒä»¬åˆ›å»ºæˆä¸åŒçš„çº¿ç¨‹<br>3ï¼‰åŒä¸€è¿›ç¨‹ä¸­çš„å„ä¸ªçº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æº<br>4ï¼‰çº¿ç¨‹æ˜¯å¤„ç†æœºçš„ç‹¬ç«‹è°ƒåº¦å•ä½ï¼Œå¤šä¸ªçº¿ç¨‹æ˜¯å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ã€‚åœ¨å•CPUçš„è®¡ç®—æœºç³»ç»Ÿä¸­å„çº¿ç¨‹å¯äº¤æ›¿åœ°å ç”¨CPUï¼›åœ¨å¤šCPUçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œå„çº¿ç¨‹å¯åŒæ—¶å ç”¨ä¸åŒçš„CPUï¼Œè‹¥å„ä¸ªCPUåŒæ—¶ä¸ºä¸€ä¸ªè¿›ç¨‹å†…çš„å„çº¿ç¨‹æœåŠ¡åˆ™å¯ç¼©çŸ­è¿›ç¨‹çš„å¤„ç†æ—¶é—´ã€‚<br>5ï¼‰ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºåä¾¿å¼€å§‹äº†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œç›´è‡³ç»ˆæ­¢ï¼Œçº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸå†…ä¼šç»å†é˜»å¡æ€å°±ç»ªæ€å’Œè¿è¡Œæ€ç­‰å„ç§çŠ¶æ€å˜åŒ–</p><p>ä¸ºä»€ä¹ˆçº¿ç¨‹çš„æå‡ºæœ‰åˆ©äºæé«˜ç³»ç»Ÿå¹¶å‘æ€§ï¼Ÿå¯ä»¥è¿™æ ·æ¥ç†è§£ï¼šç”±äºæœ‰äº†çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶æœ‰å¯èƒ½ä¼šå‘ç”Ÿè¿›ç¨‹åˆ‡æ¢ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸å‘ç”Ÿè¿›ç¨‹çš„åˆ‡æ¢ï¼Œé‚£ä¹ˆå¹³å‡ä¸‹æ¥ï¼Œæ¯æ¬¡åˆ‡æ¢æ‰€éœ€è¦çš„å¼€é”€å°±å°äº†ï¼Œå› è€Œï¼Œå°±èƒ½å¤Ÿè®©æ›´å¤šçš„çº¿ç¨‹å‚ä¸å¹¶å‘ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å“åº”æ—¶é—´ç­‰é—®é¢˜äº†</p><h4 id="1-6-4-çº¿ç¨‹çš„å®ç°æ–¹å¼"><a href="#1-6-4-çº¿ç¨‹çš„å®ç°æ–¹å¼" class="headerlink" title="1.6.4 çº¿ç¨‹çš„å®ç°æ–¹å¼"></a>1.6.4 çº¿ç¨‹çš„å®ç°æ–¹å¼</h4><p>çº¿ç¨‹çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šç”¨æˆ·çº§çº¿ç¨‹ï¼ˆUser-LevelThreadï¼ŒULTï¼‰å’Œå†…æ ¸çº§çº¿ç¨‹ï¼ˆKernel-LevThreadï¼ŒKLTï¼‰.å†…æ ¸çº§çº¿ç¨‹åˆç§°ä¸ºå†…æ ¸æ”¯æŒçš„çº¿ç¨‹ã€‚</p><p>åœ¨ç”¨æˆ·çº§çº¿ç¨‹ä¸­ï¼Œæœ‰å…³çº¿ç¨‹ç®¡ç†çš„æ‰€æœ‰å·¥ä½œéƒ½ç”±åº”ç”¨ç¨‹åºå®Œæˆï¼Œå†…æ ¸æ„è¯†ä¸åˆ°çº¿ç¨‹çš„å­˜åœ¨åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä½¿ç”¨çº¿ç¨‹åº“è®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºã€‚é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºä»å•çº¿ç¨‹èµ·å§‹ï¼Œåœ¨è¯¥çº¿ç¨‹ä¸­å¼€å§‹è¿è¡Œï¼Œåœ¨å…¶è¿è¡Œçš„ä»»ä½•æ—¶åˆ»ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹åº“ä¸­çš„æ´¾ç”Ÿä¾‹ç¨‹åˆ›å»ºä¸€ä¸ªåœ¨ç›¸åŒè¿›ç¨‹ä¸­è¿è¡Œçš„æ–°çº¿ç¨‹ã€‚</p><ul><li>å›¾ï¼ˆaï¼‰è¯´æ˜äº†ç”¨æˆ·çº§çº¿ç¨‹çš„å®ç°æ–¹å¼åœ¨å†…æ ¸çº§çº¿ç¨‹ä¸­ï¼Œçº¿ç¨‹ç®¡ç†çš„æ‰€æœ‰å·¥ä½œç”±å†…æ ¸å®Œæˆï¼Œåº”ç”¨ç¨‹åºæ²¡æœ‰è¿›è¡Œçº¿ç¨‹ç®¡ç†çš„ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªåˆ°å†…æ ¸çº§çº¿ç¨‹çš„ç¼–ç¨‹æ¥å£ã€‚å†…æ ¸ä¸ºè¿›ç¨‹åŠå…¶å†…éƒ¨çš„æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè°ƒåº¦ä¹Ÿæ˜¯åœ¨å†…æ ¸åŸºäºçº¿ç¨‹æ¶æ„çš„åŸºç¡€ä¸Šå®Œæˆã€‚</li><li>å›¾ï¼ˆbï¼‰è¯´æ˜äº†å†…æ ¸çº§çº¿ç¨‹çš„å®ç°æ–¹å¼åœ¨ä¸€äº›ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ç»„åˆæ–¹å¼çš„å¤šçº¿ç¨‹å®ç°ã€‚çº¿ç¨‹åˆ›å»ºå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®Œæˆï¼Œçº¿ç¨‹çš„è°ƒåº¦å’ŒåŒæ­¥ä¹Ÿåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹è¢«æ˜ å°„åˆ°ä¸€äº›ï¼ˆå°äºæˆ–ç­‰äºç”¨æˆ·çº§çº¿ç¨‹çš„æ•°ç›®ï¼‰å†…æ ¸çº§çº¿ç¨‹ä¸Šã€‚</li><li>å›¾ï¼ˆcï¼‰è¯´æ˜äº†ç”¨æˆ·çº§ä¸å†…æ ¸çº§çš„ç»„åˆå®ç°æ–¹å¼</li></ul><p><img src="https://img-blog.csdnimg.cn/20210103095251735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210103095317592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210103095348648.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-6-5-å¤šçº¿ç¨‹æ¨¡å‹"><a href="#1-6-5-å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="1.6.5 å¤šçº¿ç¨‹æ¨¡å‹"></a>1.6.5 å¤šçº¿ç¨‹æ¨¡å‹</h4><p><img src="https://img-blog.csdnimg.cn/20210103095714208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210103095735307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021010309580711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ‰äº›ç³»ç»ŸåŒæ—¶æ”¯æŒç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ï¼Œç”±æ­¤äº§ç”Ÿäº†ä¸åŒçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå³å®ç°ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹çš„è¿æ¥æ–¹å¼</p><p>1ï¼‰å¤šå¯¹ä¸€æ¨¡å‹ã€‚å°†å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œçº¿ç¨‹ç®¡ç†åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆã€‚æ­¤æ¨¡å¼ä¸­ï¼Œç”¨æˆ·çº§çº¿ç¨‹å¯¹æ“ä½œç³»ç»Ÿä¸å¯è§ï¼ˆå³é€æ˜ï¼‰.ä¼˜ç‚¹ï¼šçº¿ç¨‹ç®¡ç†æ˜¯åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œçš„ï¼Œå› è€Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚ç¼ºç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨å†…æ ¸æœåŠ¡æ—¶è¢«é˜»å¡ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼šå¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶è¡Œåœ°è¿è¡Œåœ¨å¤šå¤„ç†æœºä¸Šã€‚</p><p>2ï¼‰ä¸€å¯¹ä¸€æ¨¡å‹ã€‚å°†æ¯ä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ã€‚ä¼˜ç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åï¼Œå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›è¾ƒå¼ºç¼ºç‚¹ï¼šæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº§çº¿ç¨‹éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸å…¶å¯¹åº”ï¼Œè¿™æ ·åˆ›å»ºçº¿ç¨‹çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œä¼šå½±å“åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½</p><p>3ï¼‰å¤šå¯¹å¤šæ¨¡å‹ã€‚å°†nä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°mä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸Šï¼Œè¦æ±‚mâ‰¤nç‰¹ç‚¹ï¼šåœ¨å¤šå¯¹ä¸€æ¨¡å‹å’Œä¸€å¯¹ä¸€æ¨¡å‹ä¸­å–äº†ä¸ªæŠ˜ä¸­ï¼Œå…‹æœäº†å¤šå¯¹ä¸€æ¨¡å‹çš„å¹¶å‘åº¦ä¸é«˜çš„ç¼ºç‚¹åˆå…‹æœäº†ä¸€å¯¹ä¸€æ¨¡å‹çš„ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å ç”¨å¤ªå¤šå†…æ ¸çº§çº¿ç¨‹ï¼Œå¼€é”€å¤ªå¤§çš„ç¼ºç‚¹ã€‚åˆæ‹¥æœ‰å¤šå¯¹ä¸€æ¨¡å‹å’Œä¸€å¯¹ä¸€æ¨¡å‹å„è‡ªçš„ä¼˜ç‚¹ï¼Œå¯è°“é›†ä¸¤è€…ä¹‹æ‰€é•¿</p><h3 id="1-7-å¤„ç†æœºè°ƒåº¦çš„æ¦‚å¿µã€å±‚æ¬¡"><a href="#1-7-å¤„ç†æœºè°ƒåº¦çš„æ¦‚å¿µã€å±‚æ¬¡" class="headerlink" title="1.7 å¤„ç†æœºè°ƒåº¦çš„æ¦‚å¿µã€å±‚æ¬¡"></a>1.7 å¤„ç†æœºè°ƒåº¦çš„æ¦‚å¿µã€å±‚æ¬¡</h3><p><img src="https://img-blog.csdnimg.cn/20200602121604324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2020040809253446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200408092917283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="é«˜çº§è°ƒåº¦"><a href="#é«˜çº§è°ƒåº¦" class="headerlink" title="é«˜çº§è°ƒåº¦"></a>é«˜çº§è°ƒåº¦</h4><p><img src="https://img-blog.csdnimg.cn/20210218200901411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸­çº§è°ƒåº¦"><a href="#ä¸­çº§è°ƒåº¦" class="headerlink" title="ä¸­çº§è°ƒåº¦"></a>ä¸­çº§è°ƒåº¦</h4><p><img src="https://img-blog.csdnimg.cn/20210218200945224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210601114353166.png" alt="image-20210601114353166"></p><h4 id="ä½çº§è°ƒåº¦"><a href="#ä½çº§è°ƒåº¦" class="headerlink" title="ä½çº§è°ƒåº¦"></a>ä½çº§è°ƒåº¦</h4><p><img src="https://img-blog.csdnimg.cn/2021021820113736.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="è°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µ"><a href="#è°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="è°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µ"></a>è°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µ</h4><p>åœ¨å¤šé“ç¨‹åºç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹çš„æ•°é‡å¾€å¾€å¤šäºå¤„ç†æœºçš„ä¸ªæ•°ï¼Œè¿›ç¨‹äº‰ç”¨å¤„ç†æœºçš„æƒ…å†µå°±åœ¨æ‰€éš¾å…ã€‚<br>å¤„ç†æœºè°ƒåº¦æ˜¯å¯¹å¤„ç†æœºè¿›è¡Œåˆ†é…ï¼Œå°±æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­ï¼ŒæŒ‰ç…§ä¸€å®šçš„ç®—æ³•ï¼ˆå…¬å¹³ã€é«˜æ•ˆï¼‰é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹å¹¶å°†å¤„ç†æœºåˆ†é…ç»™å®ƒè¿è¡Œï¼Œä»¥å®ç°è¿›ç¨‹å¹¶å‘åœ°æ‰§è¡Œï¼Œå¤„ç†æœºè°ƒåº¦æ˜¯å¤šé“ç¨‹åºæ“ä½œç³»ç»Ÿçš„åŸºç¡€ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒé—®é¢˜</p><h4 id="è°ƒåº¦çš„å±‚æ¬¡"><a href="#è°ƒåº¦çš„å±‚æ¬¡" class="headerlink" title="è°ƒåº¦çš„å±‚æ¬¡"></a>è°ƒåº¦çš„å±‚æ¬¡</h4><p>ä½œä¸šä»æäº¤å¼€å§‹ç›´åˆ°å®Œæˆï¼Œå¾€å¾€è¦ç»å†ä»¥ä¸‹ä¸‰çº§è°ƒåº¦<br>1ï¼‰ä½œä¸šè°ƒåº¦ã€‚åˆç§°é«˜çº§è°ƒåº¦ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯æŒ‰ä¸€å®šçš„åŸåˆ™ä»å¤–å­˜ä¸Šå¤„äºåå¤‡çŠ¶æ€çš„ä½œä¸šä¸­æŒ‘é€‰ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ä½œä¸šï¼Œç»™å®ƒï¼ˆä»¬ï¼‰åˆ†é…å†…å­˜ã€è¾“å…¥è¾“å‡ºè®¾å¤‡ç­‰å¿…è¦çš„èµ„æºï¼Œå¹¶å»ºç«‹ç›¸åº”çš„è¿›ç¨‹ï¼Œä»¥ä½¿å®ƒï¼ˆä»¬ï¼‰è·å¾—ç«äº‰å¤„ç†æœºçš„æƒåˆ©ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯å†…å­˜ä¸è¾…å­˜ä¹‹é—´çš„è°ƒåº¦ã€‚å¯¹äºæ¯ä¸ªä½œä¸šåªè°ƒå…¥ä¸€æ¬¡ã€è°ƒå‡ºä¸€æ¬¡ï¼Œå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­å¤§å¤šé…æœ‰ä½œä¸šè°ƒåº¦ï¼Œè€Œå…¶ä»–ç³»ç»Ÿä¸­é€šå¸¸ä¸éœ€è¦é…ç½®ä½œä¸šè°ƒåº¦ã€‚ä½œä¸šè°ƒåº¦çš„æ‰§è¡Œé¢‘ç‡è¾ƒä½ï¼Œé€šå¸¸ä¸ºå‡ åˆ†é’Ÿä¸€æ¬¡ã€‚<br>2ï¼‰ä¸­çº§è°ƒåº¦ã€‚åˆç§°å†…å­˜è°ƒåº¦ã€‚å¼•å…¥ä¸­çº§è°ƒåº¦æ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ã€‚ä¸ºæ­¤åº”ä½¿é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹ï¼Œè°ƒè‡³å¤–å­˜ç­‰å¾…ï¼ŒæŠŠæ­¤æ—¶çš„è¿›ç¨‹çŠ¶æ€ç§°ä¸ºæŒ‚èµ·çŠ¶æ€ã€‚å½“å®ƒä»¬å·²å…·å¤‡è¿è¡Œæ¡ä»¶ä¸”å†…å­˜åˆç¨æœ‰ç©ºé—²æ—¶ï¼Œç”±ä¸­çº§è°ƒåº¦æ¥å†³å®šï¼ŒæŠŠå¤–å­˜ä¸Šçš„é‚£äº›å·²å…·å¤‡è¿è¡Œæ¡ä»¶çš„å°±ç»ªè¿›ç¨‹å†é‡æ–°è°ƒå…¥å†…å­˜ï¼Œå¹¶ä¿®æ”¹å…¶çŠ¶æ€ä¸ºå°±ç»ªçŠ¶æ€ï¼ŒæŒ‚åœ¨å°±ç»ªé˜Ÿåˆ—ä¸Šç­‰å¾…<br>3ï¼‰è¿›ç¨‹è°ƒåº¦ã€‚åˆç§°ä¸ºä½çº§è°ƒåº¦ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯æŒ‰ç…§æŸç§æ–¹æ³•å’Œç­–ç•¥ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™å®ƒã€‚è¿›ç¨‹è°ƒåº¦æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€åŸºæœ¬çš„ä¸€ç§è°ƒåº¦ï¼Œåœ¨ä¸€èˆ¬æ“ä½œç³»ç»Ÿä¸­éƒ½å¿…é¡»é…ç½®è¿›ç¨‹è°ƒåº¦ã€‚è¿›ç¨‹è°ƒåº¦çš„é¢‘ç‡å¾ˆé«˜ï¼Œä¸€èˆ¬å‡ åæ¯«ç§’ä¸€æ¬¡</p><h4 id="ä¸‰çº§è°ƒåº¦çš„è”ç³»"><a href="#ä¸‰çº§è°ƒåº¦çš„è”ç³»" class="headerlink" title="ä¸‰çº§è°ƒåº¦çš„è”ç³»"></a>ä¸‰çº§è°ƒåº¦çš„è”ç³»</h4><p>ä½œä¸šè°ƒåº¦ä»å¤–å­˜çš„åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€æ‰¹ä½œä¸šè¿›å…¥å†…å­˜ï¼Œä¸ºå®ƒä»¬å»ºç«‹è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹è¢«é€å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œè¿›ç¨‹è°ƒåº¦ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶æŠŠå…¶çŠ¶æ€æ”¹ä¸ºè¿è¡ŒçŠ¶æ€ï¼ŒæŠŠCPUåˆ†é…ç»™å®ƒã€‚<br>ä¸­çº§è°ƒåº¦æ˜¯ä¸ºäº†æé«˜å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œç³»ç»Ÿå°†é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹æŒ‚èµ·æ¥ã€‚å½“å†…å­˜ç©ºé—´å®½æ¾æ—¶ï¼Œé€šè¿‡ä¸­çº§è°ƒåº¦é€‰æ‹©å…·å¤‡è¿è¡Œæ¡ä»¶çš„è¿›ç¨‹ï¼Œå°†å…¶å”¤é†’<br>1ï¼‰ä½œä¸šè°ƒåº¦ä¸ºè¿›ç¨‹æ´»åŠ¨åšå‡†å¤‡ï¼Œè¿›ç¨‹è°ƒåº¦ä½¿è¿›ç¨‹æ­£å¸¸æ´»åŠ¨èµ·æ¥ï¼Œä¸­çº§è°ƒåº¦å°†æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹æŒ‚èµ·ï¼Œä¸­çº§è°ƒåº¦å¤„äºä½œä¸šè°ƒåº¦å’Œè¿›ç¨‹è°ƒåº¦ä¹‹é—´<br>2ï¼‰ä½œä¸šè°ƒåº¦æ¬¡æ•°å°‘ï¼Œä¸­çº§è°ƒåº¦æ¬¡æ•°ç•¥å¤šï¼Œè¿›ç¨‹è°ƒåº¦é¢‘ç‡æœ€é«˜ã€‚<br>3ï¼‰è¿›ç¨‹è°ƒåº¦æ˜¯æœ€åŸºæœ¬çš„ï¼Œä¸å¯æˆ–ç¼º</p><p><img src="https://img-blog.csdnimg.cn/20200408092848537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-8-è¿›ç¨‹è°ƒåº¦çš„æ—¶æœºã€åˆ‡æ¢ä¸è¿‡ç¨‹ã€æ–¹å¼"><a href="#1-8-è¿›ç¨‹è°ƒåº¦çš„æ—¶æœºã€åˆ‡æ¢ä¸è¿‡ç¨‹ã€æ–¹å¼" class="headerlink" title="1.8 è¿›ç¨‹è°ƒåº¦çš„æ—¶æœºã€åˆ‡æ¢ä¸è¿‡ç¨‹ã€æ–¹å¼"></a>1.8 è¿›ç¨‹è°ƒåº¦çš„æ—¶æœºã€åˆ‡æ¢ä¸è¿‡ç¨‹ã€æ–¹å¼</h3><h4 id="è¿›ç¨‹è°ƒåº¦çš„æ—¶æœº"><a href="#è¿›ç¨‹è°ƒåº¦çš„æ—¶æœº" class="headerlink" title="è¿›ç¨‹è°ƒåº¦çš„æ—¶æœº"></a>è¿›ç¨‹è°ƒåº¦çš„æ—¶æœº</h4><p><img src="https://img-blog.csdnimg.cn/20210218201609623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218201741149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218201824662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›ç¨‹è°ƒåº¦å’Œåˆ‡æ¢ç¨‹åºæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºã€‚å½“è¯·æ±‚è°ƒåº¦çš„äº‹ä»¶å‘ç”Ÿåï¼Œæ‰å¯èƒ½ä¼šè¿è¡Œè¿›ç¨‹è°ƒåº¦ç¨‹åºï¼Œå½“è°ƒåº¦äº†æ–°çš„å°±ç»ªè¿›ç¨‹åï¼Œæ‰ä¼šå»è¿›è¡Œè¿›ç¨‹é—´çš„åˆ‡æ¢ã€‚ç†è®ºä¸Šè¿™ä¸‰ä»¶äº‹æƒ…åº”è¯¥é¡ºåºæ‰§è¡Œï¼Œä½†åœ¨å®é™…è®¾è®¡ä¸­ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºè¿è¡Œæ—¶ï¼Œå¦‚æœæŸæ—¶å‘ç”Ÿäº†å¼•èµ·è¿›ç¨‹è°ƒåº¦çš„å› ç´ ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¤Ÿé©¬ä¸Šè¿›è¡Œè°ƒåº¦ä¸åˆ‡æ¢ã€‚</p><p><strong>ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸èƒ½è¿›è¡Œè¿›ç¨‹çš„è°ƒåº¦ä¸åˆ‡æ¢çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ</strong><br>1ï¼‰åœ¨å¤„ç†ä¸­æ–­çš„è¿‡ç¨‹ä¸­ï¼šä¸­æ–­å¤„ç†è¿‡ç¨‹å¤æ‚ï¼Œåœ¨å®ç°ä¸Šå¾ˆéš¾åšåˆ°è¿›ç¨‹åˆ‡æ¢ï¼Œè€Œä¸”ä¸­æ–­å¤„ç†æ˜¯ç³»ç»Ÿå·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œé€»è¾‘ä¸Šä¸å±äºæŸä¸€è¿›ç¨‹ï¼Œä¸åº”è¢«å‰¥å¤ºå¤„ç†æœºèµ„æºã€‚<br>2ï¼‰è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºä¸´ç•ŒåŒºä¸­ï¼šè¿›å…¥ä¸´ç•ŒåŒºåï¼Œéœ€è¦ç‹¬å å¼åœ°è®¿é—®å…±äº«æ•°æ®ï¼Œç†è®ºä¸Šå¿…é¡»åŠ é”ï¼Œä»¥é˜²æ­¢å…¶ä»–å¹¶è¡Œç¨‹åºè¿›å…¥ï¼Œåœ¨è§£é”å‰ä¸åº”åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹è¿è¡Œï¼Œä»¥åŠ å¿«è¯¥å…±äº«æ•°æ®çš„é‡Šæ”¾ã€‚<br>3ï¼‰å…¶ä»–éœ€è¦å®Œå…¨å±è”½ä¸­æ–­çš„åŸå­æ“ä½œè¿‡ç¨‹ä¸­ï¼šå¦‚åŠ é”ã€è§£é”ã€ä¸­æ–­ç°åœºä¿æŠ¤ã€æ¢å¤ç­‰åŸå­æ“ä½œã€‚åœ¨åŸå­è¿‡ç¨‹ä¸­ï¼Œè¿ä¸­æ–­éƒ½è¦å±è”½ï¼Œæ›´ä¸åº”è¯¥è¿›è¡Œè¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢ã€‚å¦‚æœåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼•èµ·è°ƒåº¦çš„æ¡ä»¶ï¼Œå¹¶ä¸èƒ½é©¬ä¸Šè¿›è¡Œè°ƒåº¦å’Œåˆ‡æ¢ï¼Œåº”ç½®ç³»ç»Ÿçš„è¯·æ±‚è°ƒåº¦æ ‡å¿—ï¼Œç›´åˆ°ä¸Šè¿°è¿‡ç¨‹ç»“æŸåæ‰è¿›è¡Œç›¸åº”çš„è°ƒåº¦ä¸åˆ‡æ¢ã€‚</p><p><strong>åº”è¯¥è¿›è¡Œè¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢çš„æƒ…å†µæœ‰</strong>ï¼š</p><p>1ï¼‰å½“å‘ç”Ÿå¼•èµ·è°ƒåº¦æ¡ä»¶ï¼Œä¸”å½“å‰è¿›ç¨‹æ— æ³•ç»§ç»­è¿è¡Œä¸‹å»æ—¶ï¼Œå¯ä»¥é©¬ä¸Šè¿›è¡Œè°ƒåº¦ä¸åˆ‡æ¢ã€‚å¦‚æœæ“ä½œç³»ç»Ÿåªåœ¨è¿™ç§æƒ…å†µä¸‹è¿›è¡Œè¿›ç¨‹è°ƒåº¦ï¼Œå°±æ˜¯éå‰¥å¤ºè°ƒåº¦<br>2ï¼‰å½“ä¸­æ–­å¤„ç†ç»“æŸæˆ–è‡ªé™·å¤„ç†ç»“æŸåï¼Œè¿”å›è¢«ä¸­æ–­è¿›ç¨‹çš„ç”¨æˆ·æ€ç¨‹åºæ‰§è¡Œç°åœºå‰ï¼Œè‹¥ç½®ä¸Šè¯·æ±‚è°ƒåº¦æ ‡å¿—ï¼Œå³å¯é©¬ä¸Šè¿›è¡Œè¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢ã€‚å¦‚æœæ“ä½œç³»ç»Ÿæ”¯æŒè¿™ç§æƒ…å†µä¸‹çš„è¿è¡Œè°ƒåº¦ç¨‹åºï¼Œå°±å®ç°äº†å‰¥å¤ºæ–¹å¼çš„è°ƒåº¦ã€‚<br>è¿›ç¨‹åˆ‡æ¢å¾€å¾€åœ¨è°ƒåº¦å®Œæˆåç«‹åˆ»å‘ç”Ÿï¼Œå®ƒè¦æ±‚ä¿å­˜åŸè¿›ç¨‹å½“å‰åˆ‡æ¢ç‚¹çš„ç°åœºä¿¡æ¯ï¼Œæ¢å¤è¢«è°ƒåº¦è¿›ç¨‹çš„ç°åœºä¿¡æ¯ã€‚ç°åœºåˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°†åŸè¿›ç¨‹çš„ç°åœºä¿¡æ¯æ¨å…¥åˆ°å½“å‰è¿›ç¨‹çš„å†…æ ¸å †æ ˆæ¥ä¿å­˜å®ƒä»¬ï¼Œå¹¶æ›´æ–°å †æ ˆæŒ‡é’ˆã€‚å†…æ ¸å®Œæˆä»æ–°è¿›ç¨‹çš„å†…æ ¸æ ˆä¸­è£…å…¥æ–°è¿›ç¨‹çš„ç°åœºä¿¡æ¯ã€æ›´æ–°å½“å‰è¿è¡Œè¿›ç¨‹ç©ºé—´æŒ‡é’ˆã€é‡è®¾PCå¯„å­˜å™¨ç­‰ç›¸å…³å·¥ä½œä¹‹åï¼Œå¼€å§‹è¿è¡Œæ–°çš„è¿›ç¨‹ã€‚</p><h4 id="è¿›ç¨‹è°ƒåº¦æ–¹å¼"><a href="#è¿›ç¨‹è°ƒåº¦æ–¹å¼" class="headerlink" title="è¿›ç¨‹è°ƒåº¦æ–¹å¼"></a>è¿›ç¨‹è°ƒåº¦æ–¹å¼</h4><p><img src="https://img-blog.csdnimg.cn/20210218201922547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€è°“è¿›ç¨‹è°ƒåº¦æ–¹å¼æ˜¯æŒ‡å½“æŸä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†æœºä¸Šæ‰§è¡Œæ—¶ï¼Œè‹¥æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹éœ€è¦å¤„ç†ï¼Œå³æœ‰ä¼˜å…ˆæƒæ›´é«˜çš„è¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œæ­¤æ—¶åº”å¦‚ä½•åˆ†é…å¤„ç†æœºã€‚é€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§è¿›ç¨‹è°ƒåº¦æ–¹å¼</p><p>1ï¼‰éå‰¥å¤ºè°ƒåº¦æ–¹å¼ï¼Œåˆç§°éæŠ¢å æ–¹å¼ã€‚æ˜¯æŒ‡å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†æœºä¸Šæ‰§è¡Œæ—¶ï¼Œå³ä½¿æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œä»ç„¶è®©æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°è¯¥è¿›ç¨‹å®Œæˆæˆ–å‘ç”ŸæŸç§äº‹ä»¶è€Œè¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œæ‰æŠŠå¤„ç†æœºåˆ†é…ç»™æ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹ã€‚<br>åœ¨éå‰¥å¤ºè°ƒåº¦æ–¹å¼ä¸‹ï¼Œä¸€æ—¦æŠŠCPUåˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å°±ä¼šä¿æŒCPUç›´åˆ°ç»ˆæ­¢æˆ–è½¬æ¢åˆ°ç­‰å¾…çŠ¶æ€ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ã€ç³»ç»Ÿå¼€é”€å°ï¼Œé€‚ç”¨äºå¤§å¤šæ•°çš„æ‰¹å¤„ç†ç³»ç»Ÿï¼Œä½†å®ƒä¸èƒ½ç”¨äºåˆ†æ—¶ç³»ç»Ÿå’Œå¤§å¤šæ•°çš„å®æ—¶ç³»ç»Ÿã€‚<br>2ï¼‰å‰¥å¤ºè°ƒåº¦æ–¹å¼ï¼Œåˆç§°æŠ¢å æ–¹å¼ã€‚æ˜¯æŒ‡å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†æœºä¸Šæ‰§è¡Œæ—¶ï¼Œè‹¥æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹éœ€è¦ä½¿ç”¨å¤„ç†æœºï¼Œåˆ™ç«‹å³æš‚åœæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™è¿™ä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹ã€‚</p><p>é‡‡ç”¨å‰¥å¤ºå¼çš„è°ƒåº¦ï¼Œå¯¹æé«˜ç³»ç»Ÿååç‡å’Œå“åº”æ•ˆç‡éƒ½æœ‰æ˜æ˜¾çš„å¥½å¤„ã€‚ä½†â€œå‰¥å¤ºâ€ä¸æ˜¯ä¸€ç§ä»»æ„æ€§è¡Œä¸ºï¼Œå¿…é¡»éµå¾ªä¸€å®šçš„åŸåˆ™ï¼Œä¸»è¦æœ‰ï¼šä¼˜å…ˆæƒã€çŸ­è¿›ç¨‹ä¼˜å…ˆå’Œæ—¶é—´ç‰‡åŸåˆ™ç­‰ã€‚</p><h4 id="è¿›ç¨‹çš„åˆ‡æ¢ä¸è¿‡ç¨‹"><a href="#è¿›ç¨‹çš„åˆ‡æ¢ä¸è¿‡ç¨‹" class="headerlink" title="è¿›ç¨‹çš„åˆ‡æ¢ä¸è¿‡ç¨‹"></a>è¿›ç¨‹çš„åˆ‡æ¢ä¸è¿‡ç¨‹</h4><p><img src="https://img-blog.csdnimg.cn/20210218202035404.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-9-è°ƒåº¦ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡"><a href="#1-9-è°ƒåº¦ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡" class="headerlink" title="1.9 è°ƒåº¦ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡"></a>1.9 è°ƒåº¦ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡</h3><h4 id="CPUåˆ©ç”¨ç‡"><a href="#CPUåˆ©ç”¨ç‡" class="headerlink" title="CPUåˆ©ç”¨ç‡"></a>CPUåˆ©ç”¨ç‡</h4><p><img src="https://img-blog.csdnimg.cn/20210218202359315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç³»ç»Ÿååé‡"><a href="#ç³»ç»Ÿååé‡" class="headerlink" title="ç³»ç»Ÿååé‡"></a>ç³»ç»Ÿååé‡</h4><p><img src="https://img-blog.csdnimg.cn/20210218202449483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å‘¨è½¬æ—¶é—´"><a href="#å‘¨è½¬æ—¶é—´" class="headerlink" title="å‘¨è½¬æ—¶é—´"></a>å‘¨è½¬æ—¶é—´</h4><p><img src="https://img-blog.csdnimg.cn/20210218202534195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218202623484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=" "></p><h4 id="ç­‰å¾…æ—¶é—´"><a href="#ç­‰å¾…æ—¶é—´" class="headerlink" title="ç­‰å¾…æ—¶é—´"></a>ç­‰å¾…æ—¶é—´</h4><p><img src="https://img-blog.csdnimg.cn/20210218202824852.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å“åº”æ—¶é—´"><a href="#å“åº”æ—¶é—´" class="headerlink" title="å“åº”æ—¶é—´"></a>å“åº”æ—¶é—´</h4><p>ä¸åŒçš„è°ƒåº¦ç®—æ³•å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œåœ¨é€‰æ‹©è°ƒåº¦ç®—æ³•æ—¶ï¼Œå¿…é¡»è€ƒè™‘ç®—æ³•æ‰€å…·æœ‰çš„ç‰¹æ€§ã€‚ä¸ºäº†æ¯”è¾ƒå¤„ç†æœºè°ƒåº¦ç®—æ³•çš„æ€§èƒ½ï¼Œäººä»¬æå‡ºå¾ˆå¤šè¯„ä»·å‡†åˆ™ï¼Œä¸‹é¢ä»‹ç»ä¸»è¦çš„å‡ ç§<br>1ï¼‰CPUåˆ©ç”¨ç‡ã€‚CPUæ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­æœ€é‡è¦å’Œæ˜‚è´µçš„èµ„æºä¹‹ä¸€ï¼Œæ‰€ä»¥åº”å°½å¯èƒ½ä½¿CPUä¿æŒâ€œå¿™â€çŠ¶æ€ï¼Œä½¿è¿™ä¸€èµ„æºåˆ©ç”¨ç‡æœ€é«˜<br>2ï¼‰ç³»ç»Ÿååé‡ã€‚è¡¨ç¤ºå•ä½æ—¶é—´å†…CPUå®Œæˆä½œä¸šçš„æ•°é‡ã€‚é•¿ä½œä¸šéœ€è¦æ¶ˆè€—è¾ƒé•¿çš„å¤„ç†æœºæ—¶é—´ï¼Œå› æ­¤ä¼šé™ä½ç³»ç»Ÿçš„ååé‡ã€‚è€Œå¯¹äºçŸ­ä½œä¸šï¼Œå®ƒä»¬æ‰€éœ€è¦æ¶ˆè€—çš„å¤„ç†æœºæ—¶é—´è¾ƒçŸ­ï¼Œå› æ­¤èƒ½æé«˜ç³»ç»Ÿçš„ååé‡ã€‚è°ƒåº¦ç®—æ³•å’Œæ–¹å¼çš„ä¸åŒï¼Œä¹Ÿä¼šå¯¹ç³»ç»Ÿçš„ååé‡äº§ç”Ÿè¾ƒå¤§çš„å½±å“ã€‚<br>3ï¼‰å‘¨è½¬æ—¶é—´ã€‚æ˜¯æŒ‡ä»ä½œä¸šæäº¤åˆ°ä½œä¸šå®Œæˆæ‰€ç»å†çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ä½œä¸šç­‰å¾…ã€åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­æ’é˜Ÿã€åœ¨å¤„ç†æœºä¸Šè¿è¡Œä»¥åŠè¿›è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ‰€èŠ±è´¹æ—¶é—´çš„æ€»å’Œã€‚<br>4ï¼‰ç­‰å¾…æ—¶é—´ã€‚æ˜¯æŒ‡è¿›ç¨‹å¤„äºç­‰å¤„ç†æœºçŠ¶æ€æ—¶é—´ä¹‹å’Œï¼Œç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œç”¨æˆ·æ»¡æ„åº¦è¶Šä½ã€‚å¤„ç†æœºè°ƒåº¦ç®—æ³•å®é™…ä¸Šå¹¶ä¸å½±å“ä½œä¸šæ‰§è¡Œæˆ–è¾“å…¥è¾“å‡ºæ“ä½œçš„æ—¶é—´ï¼Œåªå½±å“ä½œä¸šåœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰€èŠ±çš„æ—¶é—´ã€‚å› æ­¤ï¼Œè¡¡é‡ä¸€ä¸ªè°ƒåº¦ç®—æ³•çš„ä¼˜åŠ£ï¼Œå¸¸å¸¸åªéœ€ç®€å•åœ°è€ƒå¯Ÿç­‰å¾…æ—¶é—´ã€‚<br>5ï¼‰å“åº”æ—¶é—´ã€‚æ˜¯æŒ‡ä»ç”¨æˆ·æäº¤è¯·æ±‚åˆ°ç³»ç»Ÿé¦–æ¬¡äº§ç”Ÿå“åº”æ‰€ç”¨çš„æ—¶é—´ã€‚åœ¨äº¤äº’å¼ç³»ç»Ÿä¸­ï¼Œå‘¨è½¬æ—¶é—´ä¸å¯èƒ½æ˜¯æœ€å¥½çš„è¯„ä»·å‡†åˆ™ï¼Œä¸€èˆ¬é‡‡ç”¨å“åº”æ—¶é—´ä½œä¸ºè¡¡é‡è°ƒåº¦ç®—æ³•çš„é‡è¦å‡†åˆ™ä¹‹ä¸€</p><h3 id="1-10-FCFSã€SJFã€HRRNè°ƒåº¦ç®—æ³•"><a href="#1-10-FCFSã€SJFã€HRRNè°ƒåº¦ç®—æ³•" class="headerlink" title="1.10 FCFSã€SJFã€HRRNè°ƒåº¦ç®—æ³•"></a>1.10 FCFSã€SJFã€HRRNè°ƒåº¦ç®—æ³•</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨å¤šç§è°ƒåº¦ç®—æ³•ï¼Œ<code>å…¶ä¸­æœ‰çš„è°ƒåº¦ç®—æ³•é€‚ç”¨äºä½œä¸šè°ƒåº¦ï¼Œæœ‰çš„è°ƒåº¦ç®—æ³•é€‚ç”¨äºè¿›ç¨‹è°ƒåº¦ï¼Œæœ‰çš„è°ƒåº¦ç®—æ³•ä¸¤è€…éƒ½é€‚ç”¨</code>ã€‚ä¸‹é¢ä»‹ç»å‡ ç§å¸¸ç”¨çš„è°ƒåº¦ç®—æ³•ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210218204030759.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•"><a href="#å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•" class="headerlink" title="å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•"></a>å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210218203207451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218203231218.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>FCFSè°ƒåº¦ç®—æ³•æ˜¯ä¸€ç§æœ€ç®€å•çš„è°ƒåº¦ç®—æ³•ï¼Œè¯¥è°ƒåº¦ç®—æ³•æ—¢å¯ä»¥ç”¨äºä½œä¸šè°ƒåº¦ä¹Ÿå¯ä»¥ç”¨äºè¿›ç¨‹è°ƒåº¦ã€‚åœ¨ä½œä¸šè°ƒåº¦ä¸­ï¼Œç®—æ³•æ¯æ¬¡ä»åå¤‡ä½œä¸šé˜Ÿåˆ—ä¸­é€‰æ‹©æœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„ä¸€ä¸ªæˆ–å‡ ä¸ªä½œä¸šï¼Œå°†å®ƒä»¬è°ƒå…¥å†…å­˜ï¼Œåˆ†é…å¿…è¦çš„èµ„æºï¼Œåˆ›å»ºè¿›ç¨‹å¹¶æ”¾å…¥å°±ç»ªé˜Ÿåˆ—åœ¨è¿›ç¨‹è°ƒåº¦ä¸­ï¼ŒFCFSè°ƒåº¦ç®—æ³•æ¯æ¬¡ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©æœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œä½¿ä¹‹æŠ•å…¥è¿è¡Œï¼Œç›´åˆ°å®Œæˆæˆ–å› æŸç§åŸå› è€Œé˜»å¡æ—¶æ‰é‡Šæ”¾å¤„ç†æœºã€‚</p><p>FCFSè°ƒåº¦ç®—æ³•å±äºä¸å¯å‰¥å¤ºç®—æ³•ã€‚ä»è¡¨é¢ä¸Šçœ‹ï¼Œå®ƒå¯¹æ‰€æœ‰ä½œä¸šéƒ½æ˜¯å…¬å¹³çš„ï¼Œä½†è‹¥ä¸€ä¸ªé•¿ä½œä¸šå…ˆåˆ°è¾¾ç³»ç»Ÿï¼Œå°±ä¼šä½¿åé¢è®¸å¤šçŸ­ä½œä¸šç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤å®ƒä¸èƒ½ä½œä¸ºåˆ†æ—¶ç³»ç»Ÿå’Œå®æ—¶ç³»ç»Ÿçš„ä¸»è¦è°ƒåº¦ç­–ç•¥ã€‚ä½†å®ƒå¸¸è¢«ç»“åˆåœ¨å…¶ä»–è°ƒåº¦ç­–ç•¥ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ä¼˜å…ˆçº§ä½œä¸ºè°ƒåº¦ç­–ç•¥çš„ç³»ç»Ÿä¸­ï¼Œå¾€å¾€å¯¹å¤šä¸ªå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹æŒ‰FCFSåŸåˆ™å¤„ç†ã€‚FCFSè°ƒåº¦ç®—æ³•çš„ç‰¹ç‚¹æ˜¯ç®—æ³•ç®€å•ï¼Œä½†æ•ˆç‡ä½ï¼šå¯¹é•¿ä½œä¸šæ¯”è¾ƒæœ‰åˆ©ï¼Œä½†å¯¹çŸ­ä½œä¸šä¸åˆ©ï¼ˆç›¸å¯¹SJFå’Œé«˜å“åº”æ¯”ï¼‰ï¼šæœ‰åˆ©äºCPUç¹å¿™å‹ä½œä¸šï¼Œè€Œä¸åˆ©äºI/Oç¹å¿™å‹ä½œä¸šã€‚</p><h4 id="çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•"><a href="#çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•" class="headerlink" title="çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•"></a>çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210218203434618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218203616700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218203707934.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ä¼˜å…ˆè°ƒåº¦ç®—æ³•æ˜¯æŒ‡å¯¹çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ä¼˜å…ˆè°ƒåº¦çš„ç®—æ³•ã€‚çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„ä½œä¸šï¼Œå°†å®ƒä»¬è°ƒå…¥å†…å­˜è¿è¡Œã€‚è€ŒçŸ­è¿›ç¨‹ä¼˜å…ˆï¼ˆSPFï¼‰è°ƒåº¦ç®—æ³•ï¼Œåˆ™æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œä½¿ä¹‹ç«‹å³æ‰§è¡Œï¼Œç›´åˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œé˜»å¡æ—¶ï¼Œæ‰é‡Šæ”¾å¤„ç†æœºã€‚</p><p>SJFè°ƒåº¦ç®—æ³•ä¹Ÿå­˜åœ¨ä¸å®¹å¿½è§†çš„ç¼ºç‚¹ï¼š<br>1ï¼‰è¯¥ç®—æ³•å¯¹é•¿ä½œä¸šä¸åˆ©ï¼ŒSJFè°ƒåº¦ç®—æ³•ä¸­é•¿ä½œä¸šçš„å‘¨è½¬æ—¶é—´ä¼šå¢åŠ ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œå¦‚æœæœ‰ä¸€é•¿ä½œä¸šè¿›å…¥ç³»ç»Ÿçš„åå¤‡é˜Ÿåˆ—ï¼Œç”±äºè°ƒåº¦ç¨‹åºæ€»æ˜¯ä¼˜å…ˆè°ƒåº¦é‚£äº›ï¼ˆå³ä½¿æ˜¯åè¿›æ¥çš„ï¼‰çŸ­ä½œä¸šï¼Œå°†å¯¼è‡´é•¿ä½œä¸šé•¿æœŸä¸è¢«è°ƒåº¦ï¼ˆâ€œé¥¥é¥¿â€ç°è±¡ï¼Œæ³¨æ„åŒºåˆ†â€œæ­»é”â€.åè€…æ˜¯ç³»ç»Ÿç¯å½¢ç­‰å¾…ï¼Œå‰è€…æ˜¯è°ƒåº¦ç­–ç•¥é—®é¢˜ï¼‰.<br>2ï¼‰è¯¥ç®—æ³•å®Œå…¨æœªè€ƒè™‘ä½œä¸šçš„ç´§è¿«ç¨‹åº¦ï¼Œå› è€Œä¸èƒ½ä¿è¯ç´§è¿«æ€§ä½œä¸šä¼šè¢«åŠæ—¶å¤„ç†ã€‚<br>3ï¼‰ç”±äºä½œä¸šçš„é•¿çŸ­åªæ˜¯æ ¹æ®ç”¨æˆ·æ‰€æä¾›çš„ä¼°è®¡æ‰§è¡Œæ—¶é—´è€Œå®šçš„ï¼Œè€Œç”¨æˆ·åˆå¯èƒ½ä¼šæœ‰æ„æˆ–æ— æ„åœ°ç¼©çŸ­å…¶ä½œä¸šçš„ä¼°è®¡è¿è¡Œæ—¶é—´ï¼Œè‡´ä½¿è¯¥ç®—æ³•ä¸ä¸€å®šèƒ½çœŸæ­£åšåˆ°çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ã€‚<br>æ³¨æ„ï¼ŒSJFè°ƒåº¦ç®—æ³•çš„å¹³å‡ç­‰å¾…æ—¶é—´ã€å¹³å‡å‘¨è½¬æ—¶é—´æœ€å°‘</p><h4 id="é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•HRRN"><a href="#é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•HRRN" class="headerlink" title="é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•HRRN"></a>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•HRRN</h4><p><img src="https://img-blog.csdnimg.cn/20210218203839373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218203900804.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ä¸»è¦ç”¨äºä½œä¸šè°ƒåº¦ï¼Œè¯¥ç®—æ³•æ˜¯å¯¹FCFSè°ƒåº¦ç®—æ³•å’ŒSJFè°ƒåº¦ç®—æ³•çš„ç§ç»¼åˆå¹³è¡¡ï¼ŒåŒæ—¶è€ƒè™‘æ¯ä¸ªä½œä¸šçš„ç­‰å¾…æ—¶é—´å’Œä¼°è®¡çš„è¿è¡Œæ—¶é—´ã€‚åœ¨æ¯æ¬¡è¿›è¡Œä½œä¸šè°ƒåº¦æ—¶ï¼Œå…ˆè®¡ç®—åå¤‡ä½œä¸šé˜Ÿåˆ—ä¸­æ¯ä¸ªä½œä¸šçš„å“åº”æ¯”ï¼Œä»ä¸­é€‰å‡ºå“åº”æ¯”æœ€é«˜çš„ä½œä¸šæŠ•å…¥è¿è¡Œ</p><h3 id="1-11-æ—¶é—´ç‰‡è½®è½¬ã€ä¼˜å…ˆçº§ã€å¤šçº§åé¦ˆé˜Ÿåˆ—"><a href="#1-11-æ—¶é—´ç‰‡è½®è½¬ã€ä¼˜å…ˆçº§ã€å¤šçº§åé¦ˆé˜Ÿåˆ—" class="headerlink" title="1.11 æ—¶é—´ç‰‡è½®è½¬ã€ä¼˜å…ˆçº§ã€å¤šçº§åé¦ˆé˜Ÿåˆ—"></a>1.11 æ—¶é—´ç‰‡è½®è½¬ã€ä¼˜å…ˆçº§ã€å¤šçº§åé¦ˆé˜Ÿåˆ—</h3><p><img src="https://img-blog.csdnimg.cn/20210218205155253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"><a href="#æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•" class="headerlink" title="æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"></a>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210218204419708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218204514230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ä¸»è¦é€‚ç”¨äºåˆ†æ—¶ç³»ç»Ÿã€‚åœ¨è¿™ç§ç®—æ³•ä¸­ï¼Œç³»ç»Ÿå°†æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰åˆ°è¾¾æ—¶é—´çš„å…ˆåæ¬¡åºæ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿›ç¨‹è°ƒåº¦ç¨‹åºæ€»æ˜¯é€‰æ‹©å°±ç»ªé˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå³å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™ï¼Œä½†ä»…èƒ½è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå¦‚100ms.åœ¨ä½¿ç”¨å®Œä¸€ä¸ªæ—¶é—´ç‰‡åï¼Œå³ä½¿è¿›ç¨‹å¹¶æœªå®Œæˆå…¶è¿è¡Œï¼Œå®ƒä¹Ÿå¿…é¡»é‡Šæ”¾å‡ºï¼ˆè¢«å‰¥å¤ºï¼‰å¤„ç†æœºç»™ä¸‹ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹ï¼Œè€Œè¢«å‰¥å¤ºçš„è¿›ç¨‹è¿”å›åˆ°å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾é‡æ–°æ’é˜Ÿï¼Œç­‰å€™å†æ¬¡è¿è¡Œã€‚<br>åœ¨æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ä¸­ï¼Œæ—¶é—´ç‰‡çš„å¤§å°å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“å¾ˆå¤§ã€‚å¦‚æœæ—¶é—´ç‰‡è¶³å¤Ÿå¤§ï¼Œä»¥è‡³äºæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•å°±é€€åŒ–ä¸ºå…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ã€‚å¦‚æœæ—¶é—´ç‰‡å¾ˆå°ï¼Œé‚£ä¹ˆå¤„ç†æœºå°†åœ¨è¿›ç¨‹é—´è¿‡äºé¢‘ç¹åˆ‡æ¢ï¼Œä½¿å¤„ç†æœºçš„å¼€é”€å¢å¤§ï¼Œè€ŒçœŸæ­£ç”¨äºè¿è¡Œç”¨æˆ·è¿›ç¨‹çš„æ—¶é—´å°†å‡å°‘ã€‚å› æ­¤æ—¶é—´ç‰‡çš„å¤§å°åº”é€‰æ‹©é€‚å½“ã€‚æ—¶é—´ç‰‡çš„é•¿çŸ­é€šå¸¸ç”±ä»¥ä¸‹å› ç´ ç¡®å®šï¼šç³»ç»Ÿçš„å“åº”æ—¶é—´ã€å°±ç»ªé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ç›®å’Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚</p><h4 id="ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"><a href="#ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•" class="headerlink" title="ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"></a>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210218204646593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218204718346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218204738133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"><a href="#å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•" class="headerlink" title="å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"></a>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210218204948784.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210218205035647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•æ˜¯æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•å’Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç»¼åˆå’Œå‘å±•ï¼Œå¦‚å›¾2-5æ‰€ç¤ºã€‚é€šè¿‡åŠ¨æ€è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§å’Œæ—¶é—´ç‰‡å¤§å°ï¼Œå¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•å¯ä»¥å…¼é¡¾å¤šæ–¹é¢çš„ç³»ç»Ÿç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œä¸ºæé«˜ç³»ç»Ÿååé‡å’Œç¼©çŸ­å¹³å‡å‘¨è½¬æ—¶é—´è€Œç…§é¡¾çŸ­è¿›ç¨‹ï¼›ä¸ºè·å¾—è¾ƒå¥½çš„I/Oè®¾å¤‡åˆ©ç”¨ç‡å’Œç¼©çŸ­å“åº”æ—¶é—´è€Œç…§é¡¾I/Oå‹è¿›ç¨‹ï¼›åŒæ—¶ï¼Œä¹Ÿä¸å¿…äº‹å…ˆä¼°è®¡è¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•çš„å®ç°æ€æƒ³å¦‚ä¸‹ï¼š<br>1ï¼‰åº”è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶ä¸ºå„ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ï¼Œç¬¬1çº§é˜Ÿåˆ—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬2çº§é˜Ÿåˆ—æ¬¡ä¹‹ï¼Œå…¶ä½™é˜Ÿåˆ—çš„ä¼˜å…ˆçº§é€æ¬¡é™ä½ã€‚</p><p>2ï¼‰èµ‹äºˆå„ä¸ªé˜Ÿåˆ—ä¸­è¿›ç¨‹æ‰§è¡Œæ—¶é—´ç‰‡çš„å¤§å°ä¹Ÿå„ä¸ç›¸åŒï¼Œåœ¨ä¼˜å…ˆçº§è¶Šé«˜çš„é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹çš„è¿è¡Œæ—¶é—´ç‰‡å°±è¶Šå°ã€‚ä¾‹å¦‚ï¼Œç¬¬2çº§é˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¦æ¯”ç¬¬1çº§é˜Ÿåˆ—çš„æ—¶é—´ç‰‡é•¿1å€â€¦ç¬¬è®¡+1çº§é˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¦æ¯”ç¬¬içº§é˜Ÿåˆ—çš„æ—¶é—´ç‰‡é•¿1å€ã€‚</p><p>3ï¼‰å½“ä¸€ä¸ªæ–°è¿›ç¨‹è¿›å…¥å†…å­˜åï¼Œé¦–å…ˆå°†å®ƒæ”¾å…¥ç¬¬1çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰FCFSåŸåˆ™æ’é˜Ÿç­‰å¾…è°ƒåº¦ã€‚å½“è½®åˆ°è¯¥è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦‚å®ƒèƒ½åœ¨è¯¥æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¾¿å¯å‡†å¤‡æ’¤ç¦»ç³»ç»Ÿï¼›å¦‚æœå®ƒåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸæ—¶å°šæœªå®Œæˆï¼Œè°ƒåº¦ç¨‹åºä¾¿å°†è¯¥è¿›ç¨‹è½¬å…¥ç¬¬2çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå†åŒæ ·åœ°æŒ‰FCFSåŸåˆ™ç­‰å¾…è°ƒåº¦æ‰§è¡Œï¼›å¦‚æœå®ƒåœ¨ç¬¬2çº§é˜Ÿåˆ—ä¸­è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä»æœªå®Œæˆï¼Œå†ä»¥åŒæ ·çš„æ–¹æ³•æ”¾å…¥ç¬¬3çº§é˜Ÿåˆ—å¦‚æ­¤ä¸‹å»ï¼Œå½“ä¸€ä¸ªé•¿è¿›ç¨‹ä»ç¬¬1çº§é˜Ÿåˆ—ä¾æ¬¡é™åˆ°ç¬¬nçº§é˜Ÿåˆ—åï¼Œåœ¨ç¬¬nçº§é˜Ÿåˆ—ä¸­ä¾¿é‡†ç”¨æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼è¿è¡Œã€‚</p><p>4ï¼‰ä»…å½“ç¬¬1çº§é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰è°ƒåº¦ç¬¬2çº§é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œï¼›ä»…å½“ç¬¬1ï¼ˆ-1ï¼‰çº§é˜Ÿåˆ—å‡ä¸ºç©ºæ—¶ï¼Œæ‰ä¼šè°ƒåº¦ç¬¬içº§é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœå¤„ç†æœºæ­£åœ¨æ‰§è¡Œç¬¬içº§é˜Ÿåˆ—ä¸­çš„æŸè¿›ç¨‹æ—¶åˆæœ‰æ–°è¿›ç¨‹è¿›å…¥ä¼˜å…ˆçº§è¾ƒé«˜çš„é˜Ÿåˆ—ï¼ˆç¬¬1~ï¼ˆ-1ï¼‰ä¸­çš„ä»»ä½•ä¸€ä¸ªé˜Ÿåˆ—ï¼‰ï¼Œåˆ™æ­¤æ—¶æ–°è¿›ç¨‹å°†æŠ¢å æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„å¤„ç†æœºï¼Œå³ç”±è°ƒåº¦ç¨‹åºæŠŠæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ”¾å›åˆ°ç¬¬içº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‚å¤šçº§åé¦ˆé˜Ÿåˆ—çš„ä¼˜åŠ¿æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚</p><p>1ï¼‰ç»ˆç«¯å‹ä½œä¸šç”¨æˆ·ï¼šçŸ­ä½œä¸šä¼˜å…ˆã€‚<br>2ï¼‰çŸ­æ‰¹å¤„ç†ä½œä¸šç”¨æˆ·ï¼šå‘¨è½¬æ—¶é—´è¾ƒçŸ­<br>3ï¼‰é•¿æ‰¹å¤„ç†ä½œä¸šç”¨æˆ·ï¼šç»è¿‡å‰é¢å‡ ä¸ªé˜Ÿåˆ—å¾—åˆ°éƒ¨åˆ†æ‰§è¡Œï¼Œä¸ä¼šé•¿æœŸå¾—ä¸åˆ°å¤„ç†</p><h3 id="1-12-è¿›ç¨‹åŒæ­¥ã€äº’æ–¥"><a href="#1-12-è¿›ç¨‹åŒæ­¥ã€äº’æ–¥" class="headerlink" title="1.12 è¿›ç¨‹åŒæ­¥ã€äº’æ–¥"></a>1.12 è¿›ç¨‹åŒæ­¥ã€äº’æ–¥</h3><p><img src="https://img-blog.csdnimg.cn/20200603000704755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä¸´ç•Œèµ„æº</strong><br>è™½ç„¶å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ç³»ç»Ÿä¸­çš„å„ç§èµ„æºï¼Œä½†å…¶ä¸­è®¸å¤šèµ„æºä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œæˆ‘ä»¬æŠŠä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºã€‚è®¸å¤šç‰©ç†è®¾å¤‡éƒ½å±äºä¸´ç•Œèµ„æºï¼Œå¦‚æ‰“å°æœºç­‰.æ­¤å¤–ï¼Œè¿˜æœ‰è®¸å¤šå˜é‡ã€æ•°æ®ç­‰éƒ½å¯ä»¥è¢«è‹¥å¹²è¿›ç¨‹å…±äº«ï¼Œä¹Ÿå±äºä¸´ç•Œèµ„æº.<br>å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®ï¼Œå¿…é¡»äº’æ–¥åœ°è¿›è¡Œï¼Œåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­ï¼Œè®¿é—®ä¸´ç•Œèµ„æºçš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚<br><strong>åŒæ­¥</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602105321250.png" alt="image-20210602105321250"></p><p>åŒæ­¥äº¦ç§°ç›´æ¥åˆ¶çº¦å…³ç³»ï¼Œå®ƒæ˜¯æŒ‡ä¸ºå®ŒæˆæŸç§ä»»åŠ¡è€Œå»ºç«‹çš„ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹å› ä¸ºéœ€è¦åœ¨æŸäº›ä½ç½®ä¸Šåè°ƒå®ƒä»¬çš„å·¥ä½œæ¬¡åºè€Œç­‰å¾…ã€ä¼ é€’ä¿¡æ¯æ‰€äº§ç”Ÿçš„åˆ¶çº¦å…³ç³»ã€‚è¿›ç¨‹é—´çš„ç›´æ¥åˆ¶çº¦å…³ç³»å°±æ˜¯æºäºå®ƒä»¬ä¹‹é—´çš„ç›¸äº’åˆä½œ<br>ä¾‹å¦‚ï¼Œè¾“å…¥è¿›ç¨‹Aé€šè¿‡å•ç¼“å†²å‘è¿›ç¨‹Bæä¾›æ•°æ®ã€‚å½“è¯¥ç¼“å†²åŒºç©ºæ—¶ï¼Œè¿›ç¨‹Bä¸èƒ½è·å¾—æ‰€éœ€æ•°æ®è€Œé˜»å¡ï¼Œä¸€æ—¦è¿›ç¨‹Aå°†æ•°æ®é€å…¥ç¼“å†²åŒºï¼Œè¿›ç¨‹Bè¢«å”¤é†’ã€‚åä¹‹ï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œè¿›ç¨‹Aè¢«é˜»å¡ï¼Œä»…å½“è¿›ç¨‹Bå–èµ°ç¼“å†²æ•°æ®æ—¶ï¼Œæ‰å”¤é†’è¿›ç¨‹A</p><p><strong>äº’æ–¥</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602105226378.png" alt="image-20210602105226378"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602105446229.png" alt="image-20210602105446229"></p><p>äº’æ–¥äº¦ç§°é—´æ¥åˆ¶çº¦å…³ç³»ã€‚å½“ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä½¿ç”¨ä¸´ç•Œèµ„æºæ—¶ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œå½“å ç”¨ä¸´ç•Œèµ„æºçš„è¿›ç¨‹é€€å‡ºä¸´ç•ŒåŒºåï¼Œå¦ä¸€è¿›ç¨‹æ‰å…è®¸å»è®¿é—®æ­¤ä¸´ç•Œèµ„æº<br>ä¾‹å¦‚ï¼Œåœ¨ä»…æœ‰ä¸€å°æ‰“å°æœºçš„ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸¤ä¸ªè¿›ç¨‹Aå’Œè¿›ç¨‹Bï¼Œå¦‚æœè¿›ç¨‹Aéœ€è¦æ‰“å°æ—¶ï¼Œç³»ç»Ÿå·²å°†æ‰“å°æœºåˆ†é…ç»™è¿›ç¨‹Bï¼Œåˆ™è¿›ç¨‹Aå¿…é¡»é˜»å¡ã€‚ä¸€æ—¦è¿›ç¨‹Bå°†æ‰“å°æœºé‡Šæ”¾ï¼Œç³»ç»Ÿä¾¿å°†è¿›ç¨‹Aå”¤é†’ï¼Œå¹¶å°†å…¶ç”±é˜»å¡çŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ã€‚<br>ä¸ºç¦æ­¢ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼ŒåŒæ­¥æœºåˆ¶åº”éµå¾ªä»¥ä¸‹å‡†åˆ™ï¼š<br>1ï¼‰ç©ºé—²è®©è¿›ã€‚ä¸´ç•ŒåŒºç©ºé—²æ—¶ï¼Œå¯ä»¥å…è®¸ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ç«‹å³è¿›å…¥ä¸´ç•ŒåŒº<br>2ï¼‰å¿™åˆ™ç­‰å¾…ã€‚å½“å·²æœ‰è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…¶ä»–è¯•å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚<br>3ï¼‰æœ‰é™ç­‰å¾…ã€‚å¯¹è¯·æ±‚è®¿é—®çš„è¿›ç¨‹ï¼Œåº”ä¿è¯èƒ½åœ¨æœ‰é™æ—¶é—´å†…è¿›å…¥ä¸´ç•ŒåŒº<br>4)è®©æƒç­‰å¾…ã€‚å½“è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œåº”ç«‹å³é‡Šæ”¾å¤„ç†å™¨ï¼Œé˜²æ­¢è¿›ç¨‹å¿™ç­‰å¾…</p><h4 id="å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³•"><a href="#å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³•" class="headerlink" title="å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³•"></a>å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³•</h4><p><img src="https://img-blog.csdnimg.cn/20210220212750798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20210220212506232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220212543496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220212617407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220212710319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>è½¯ä»¶å®ç°æ–¹æ³•</strong></p><ul><li>å•æ ‡å¿—æ³•ã€‚</li><li>åŒæ ‡å¿—æ³•å…ˆæ£€æŸ¥</li><li>åŒæ ‡å¿—æ³•åæ£€æŸ¥ã€‚</li><li>Petersonâ€™s Algorithm</li></ul><p><strong>ç¡¬ä»¶å®ç°æ–¹æ³•</strong></p><p>1ï¼‰<code>ä¸­æ–­å±è”½æ–¹æ³•</code><br>å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨å¤„ç†æœºæ‰§è¡Œå®ƒçš„ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œè¦é˜²æ­¢å…¶ä»–è¿›ç¨‹å†è¿›å…¥å…¶ä¸´ç•ŒåŒºè®¿é—®çš„æœ€ç®€å•æ–¹æ³•æ˜¯ç¦æ­¢ä¸€åˆ‡ä¸­æ–­å‘ç”Ÿï¼Œæˆ–ç§°ä¹‹ä¸ºå±è”½ä¸­æ–­ã€å…³ä¸­æ–­ã€‚å› ä¸ºCPUåªåœ¨å‘ç”Ÿä¸­æ–­æ—¶å¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œè¿™æ ·å±è”½ä¸­æ–­å°±èƒ½ä¿è¯å½“å‰è¿è¡Œè¿›ç¨‹å°†ä¸´ç•ŒåŒºä»£ç é¡ºåˆ©åœ°æ‰§è¡Œå®Œï¼Œä»è€Œä¿è¯äº†äº’æ–¥çš„æ­£ç¡®å®ç°ï¼Œç„¶åå†æ‰§è¡Œå¼€ä¸­æ–­ã€‚å…¶å…¸å‹æ¨¡å¼<br>â€¦<br>å…³ä¸­æ–­ï¼›<br>ä¸´ç•ŒåŒºï¼›<br>å¼€ä¸­æ–­ï¼›<br>â€¦<br>è¿™ç§æ–¹æ³•é™åˆ¶äº†å¤„ç†æœºäº¤æ›¿æ‰§è¡Œç¨‹åºçš„èƒ½åŠ›ï¼Œå› æ­¤æ‰§è¡Œçš„æ•ˆç‡å°†ä¼šæ˜æ˜¾é™ä½ã€‚å¯¹å†…æ ¸æ¥è¯´å½“å®ƒæ‰§è¡Œæ›´æ–°å˜é‡æˆ–åˆ—è¡¨çš„å‡ æ¡æŒ‡ä»¤æœŸé—´å…³ä¸­æ–­æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†å°†å…³ä¸­æ–­çš„æƒåŠ›äº¤ç»™ç”¨æˆ·åˆ™å¾ˆä¸æ˜æ™ºï¼Œè‹¥ä¸€ä¸ªè¿›ç¨‹å…³ä¸­æ–­ä¹‹åä¸å†å¼€ä¸­æ–­ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šå› æ­¤ç»ˆæ­¢ã€‚</p><p>2ï¼‰<code>ç¡¬ä»¶æŒ‡ä»¤æ–¹æ³•</code></p><ul><li>TestAndSetæŒ‡ä»¤</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602111641733.png" alt="image-20210602111641733"></p><ul><li>SwapæŒ‡ä»¤</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602111656074.png" alt="image-20210602111656074"></p><h3 id="1-13-ä¿¡å·é‡"><a href="#1-13-ä¿¡å·é‡" class="headerlink" title="1.13 ä¿¡å·é‡*"></a>1.13 ä¿¡å·é‡*</h3><p><img src="https://img-blog.csdnimg.cn/20210220212940947.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213023527.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213143348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213209435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213417600.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213503108.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220213534503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021022021355937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¿¡å·é‡æœºæ„æ˜¯ä¸€ç§åŠŸèƒ½è¾ƒå¼ºçš„æœºåˆ¶ï¼Œå¯ç”¨æ¥è§£å†³äº’æ–¥ä¸åŒæ­¥çš„é—®é¢˜ï¼Œå®ƒåªèƒ½è¢«ä¸¤ä¸ªæ ‡å‡†çš„åŸè¯­wait(S)å’Œ signal(S)æ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥è®°ä¸ºâ€œPæ“ä½œâ€å’Œâ€œVæ“ä½œâ€.<br>åŸè¯­æ˜¯æŒ‡å®ŒæˆæŸç§åŠŸèƒ½ä¸”ä¸è¢«åˆ†å‰²ä¸è¢«ä¸­æ–­æ‰§è¡Œçš„æ“ä½œåºåˆ—ï¼Œé€šå¸¸å¯ç”±ç¡¬ä»¶æ¥å®ç°å®Œæˆä¸è¢«åˆ†å‰²æ‰§è¡Œç‰¹æ€§çš„åŠŸèƒ½ã€‚å¦‚å‰è¿°çš„â€œ Test-and-Setâ€å’Œâ€œSwapâ€æŒ‡ä»¤ï¼Œå°±æ˜¯ç”±ç¡¬ä»¶å®ç°çš„åŸå­æ“ä½œã€‚<br>åŸè¯­åŠŸèƒ½çš„ä¸è¢«ä¸­æ–­æ‰§è¡Œç‰¹æ€§åœ¨å•å¤„ç†æœºæ—¶å¯ç”±è½¯ä»¶é€šè¿‡å±è”½ä¸­æ–­æ–¹æ³•å®ç°ã€‚<br>åŸè¯­ä¹‹æ‰€ä»¥ä¸èƒ½è¢«ä¸­æ–­æ‰§è¡Œï¼Œæ˜¯å› ä¸ºåŸè¯­å¯¹å˜é‡çš„æ“ä½œè¿‡ç¨‹å¦‚æœè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå»è¿è¡Œå¦ä¸ªå¯¹åŒä¸€å˜é‡çš„æ“ä½œè¿‡ç¨‹ï¼Œä»è€Œå‡ºç°ä¸´ç•Œæ®µé—®é¢˜ã€‚å¦‚æœèƒ½å¤Ÿæ‰¾åˆ°ä¸€ç§è§£å†³ä¸´ç•Œæ®µé—®é¢˜çš„å…ƒæ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°å¯¹å…±äº«å˜é‡æ“ä½œçš„åŸå­æ€§ã€‚</p><ul><li>æ•´å‹ä¿¡å·é‡ </li><li>è®°å½•å‹ä¿¡å·é‡</li><li>åˆ©ç”¨ä¿¡å·é‡å®ç°åŒæ­¥</li><li>åˆ©ç”¨ä¿¡å·é‡å®ç°è¿›ç¨‹äº’æ–¥</li><li>åˆ©ç”¨ä¿¡å·é‡å®ç°å‰é©±å…³ç³»</li></ul><h3 id="1-14-ç»å…¸åŒæ­¥é—®é¢˜"><a href="#1-14-ç»å…¸åŒæ­¥é—®é¢˜" class="headerlink" title="1.14 ç»å…¸åŒæ­¥é—®é¢˜"></a>1.14 ç»å…¸åŒæ­¥é—®é¢˜</h3><p>è§PDF 223é¡µ</p><h4 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"></a>ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h4><p>é—®é¢˜æè¿°ï¼šä¸€ç»„ç”Ÿäº§è€…è¿›ç¨‹å’Œä¸€ç»„æ¶ˆè´¹è€…è¿›ç¨‹å…±äº«ä¸€ä¸ªåˆå§‹ä¸ºç©ºã€å¤§å°ä¸ºnçš„ç¼“å†²åŒºï¼Œåªæœ‰ç¼“å†²åŒºæ²¡æ»¡æ—¶ï¼Œç”Ÿäº§è€…æ‰èƒ½æŠŠæ¶ˆæ¯æ”¾å…¥åˆ°ç¼“å†²åŒºï¼Œå¦åˆ™å¿…é¡»ç­‰å¾…ï¼šåªæœ‰ç¼“å†²åŒºä¸ç©ºæ—¶ï¼Œæ¶ˆè´¹è€…æ‰èƒ½ä»ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå¦åˆ™å¿…é¡»ç­‰å¾…ã€‚ç”±äºç¼“å†²åŒºæ˜¯ä¸´ç•Œèµ„æºï¼Œå®ƒåªå…è®¸ä¸€ä¸ªç”Ÿäº§è€…æ”¾å…¥æ¶ˆæ¯ï¼Œæˆ–è€…ä¸ªæ¶ˆè´¹è€…ä»ä¸­å–å‡ºæ¶ˆæ¯</p><h4 id="å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…"><a href="#å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…" class="headerlink" title="å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…"></a>å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…</h4><h4 id="è¯»è€…-å†™è€…é—®é¢˜"><a href="#è¯»è€…-å†™è€…é—®é¢˜" class="headerlink" title="è¯»è€…-å†™è€…é—®é¢˜"></a>è¯»è€…-å†™è€…é—®é¢˜</h4><p>é—®é¢˜æè¿°ï¼šæœ‰è¯»è€…å’Œå†™è€…ä¸¤ç»„å¹¶å‘è¿›ç¨‹ï¼Œå…±äº«ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„è¯»è¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«æ•°æ®æ—¶ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä½†è‹¥æŸä¸ªå†™è¿›ç¨‹å’Œå…¶ä»–è¿›ç¨‹ï¼ˆè¯»è¿›ç¨‹æˆ–å†™è¿›ç¨‹ï¼‰åŒæ—¶è®¿é—®å…±äº«æ•°æ®æ—¶åˆ™å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é”™è¯¯ã€‚å› æ­¤è¦æ±‚ï¼šâ‘ å…è®¸å¤šä¸ªè¯»è€…å¯ä»¥åŒæ—¶å¯¹æ–‡ä»¶æ‰§è¡Œè¯»æ“ä½œï¼šâ‘¡åªå…è®¸ä¸€ä¸ªå†™è€…å¾€æ–‡ä»¶ä¸­å†™ä¿¡æ¯ï¼šâ‘¢ä»»ä¸€å†™è€…åœ¨å®Œæˆå†™æ“ä½œä¹‹å‰ä¸å…è®¸å…¶ä»–è¯»è€…æˆ–å†™è€…å·¥ä½œï¼›â‘£å†™è€…è¡Œå†™æ“ä½œå‰ï¼Œåº”è®©å·²æœ‰çš„è¯»è€…å’Œå†™è€…å…¨éƒ¨é€€å‡º</p><h4 id="å“²å­¦å®¶è¿›é¤é—®é¢˜"><a href="#å“²å­¦å®¶è¿›é¤é—®é¢˜" class="headerlink" title="å“²å­¦å®¶è¿›é¤é—®é¢˜"></a>å“²å­¦å®¶è¿›é¤é—®é¢˜</h4><p>é—®é¢˜æè¿°ï¼šä¸€å¼ åœ†æ¡Œä¸Šåç€5åå“²å­¦å®¶ï¼Œæ¯ä¸¤ä¸ªå“²å­¦å®¶ä¹‹é—´çš„æ¡Œä¸Šæ‘†ä¸€æ ¹ç­·å­ï¼Œæ¡Œå­çš„ä¸­é—´æ˜¯ä¸€ç¢—ç±³é¥­.å“²å­¦å®¶ä»¬å€¾æ³¨æ¯•ç”Ÿç²¾åŠ›ç”¨äºæ€è€ƒå’Œè¿›é¤ï¼Œå“²å­¦å®¶åœ¨æ€è€ƒæ—¶ï¼Œå¹¶ä¸å½±å“ä»–äººã€‚åªæœ‰å½“æ™¢å­¦å®¶é¥¥é¥¿çš„æ—¶å€™ï¼Œæ‰è¯•å›¾æ‹¿èµ·å·¦ã€å³ä¸¤æ ¹ç­·å­ï¼ˆä¸€æ ¹ä¸€æ ¹åœ°æ‹¿èµ·ï¼‰.å¦‚æœç­·å­å·²åœ¨ä»–äººæ‰‹ä¸Šï¼Œåˆ™éœ€ç­‰å¾…ã€‚é¥¥é¥¿çš„å“²å­¦å®¶åªæœ‰åŒæ—¶æ‹¿åˆ°äº†ä¸¤æ ¹ç­·å­æ‰å¯ä»¥å¼€å§‹è¿›é¤ï¼Œå½“è¿›é¤å®Œæ¯•ç­·å­ç»§ç»­æ€è€ƒ</p><h4 id="å¸çƒŸè€…é—®é¢˜"><a href="#å¸çƒŸè€…é—®é¢˜" class="headerlink" title="å¸çƒŸè€…é—®é¢˜"></a>å¸çƒŸè€…é—®é¢˜</h4><p>é—®é¢˜æè¿°ï¼šå‡è®¾ä¸€ä¸ªç³»ç»Ÿæœ‰ä¸‰ä¸ªæŠ½çƒŸè€…è¿›ç¨‹å’Œä¸€ä¸ªä¾›åº”è€…è¿›ç¨‹ã€‚æ¯ä¸ªæŠ½çƒŸè€…ä¸åœåœ°å·çƒŸå¹¶æŠ½æ‰å®ƒï¼Œä½†æ˜¯è¦å·èµ·å¹¶æŠ½æ‰ä¸€æ”¯çƒŸï¼ŒæŠ½çƒŸè€…éœ€è¦æœ‰ä¸‰ç§ææ–™ï¼šçƒŸè‰ã€çº¸å’Œèƒ¶æ°´ã€‚ä¸‰ä¸ªæŠ½çƒŸè€…ä¸­ï¼Œç¬¬ä¸€ä¸ªæ‹¥æœ‰çƒŸè‰ã€ç¬¬äºŒä¸ªæ‹¥æœ‰çº¸ï¼Œç¬¬ä¸‰ä¸ªæ‹¥æœ‰èƒ¶æ°´ã€‚ä¾›åº”è€…è¿›ç¨‹æ— é™åœ°æä¾›ä¸‰ç§ææ–™ï¼Œä¾›åº”è€…æ¯æ¬¡å°†ä¸¤ç§ææ–™æ”¾åˆ°æ¡Œå­ä¸Šï¼Œæ‹¥æœ‰å‰©ä¸‹é‚£ç§ææ–™çš„æŠ½çƒŸè€…å·ä¸€æ ¹çƒŸå¹¶æŠ½æ‰å®ƒï¼Œå¹¶ç»™ä¾›åº”è€…ä¸€ä¸ªä¿¡å·å‘Šè¯‰å®Œæˆäº†ï¼Œä¾›åº”è€…å°±ä¼šæ”¾å¦å¤–ä¸¤ç§ææ–™åœ¨æ¡Œä¸Šï¼Œè¿™ç§è¿‡ç¨‹ä¸€ç›´é‡å¤ï¼ˆè®©ä¸‰ä¸ªæŠ½çƒŸè€…è½®æµåœ°æŠ½çƒŸï¼‰</p><h3 id="1-15-ç®¡ç¨‹"><a href="#1-15-ç®¡ç¨‹" class="headerlink" title="1.15 ç®¡ç¨‹"></a>1.15 ç®¡ç¨‹</h3><p><img src="https://img-blog.csdnimg.cn/20210220214731921.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>1 ç®¡ç¨‹çš„å®šä¹‰<br>ç³»ç»Ÿä¸­çš„å„ç§ç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æºï¼Œå‡å¯ç”¨æ•°æ®ç»“æ„æŠ½è±¡åœ°æè¿°å…¶èµ„æºç‰¹æ€§ï¼Œå³ç”¨å°‘é‡ä¿¡æ¯å’Œå¯¹èµ„æºæ‰€æ‰§è¡Œçš„æ“ä½œæ¥è¡¨å¾è¯¥èµ„æºï¼Œè€Œå¿½ç•¥äº†å®ƒä»¬çš„å†…éƒ¨ç»“æ„å’Œå®ç°ç»†èŠ‚ã€‚ç®¡ç¨‹æ˜¯ç”±ä¸€ç»„æ•°æ®ä»¥åŠå®šä¹‰åœ¨è¿™ç»„æ•°æ®ä¹‹ä¸Šçš„å¯¹è¿™ç»„æ•°æ®çš„æ“ä½œç»„æˆçš„è½¯ä»¶æ¨¡å—ï¼Œè¿™ç»„æ“ä½œèƒ½åˆå§‹åŒ–å¹¶æ”¹å˜ç®¡ç¨‹ä¸­çš„æ•°æ®å’ŒåŒæ­¥è¿›ç¨‹.</p><p>2 ç®¡ç¨‹çš„çº½æˆ<br>1ï¼‰å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«ç»“æ„æ•°æ®è¯´æ˜<br>2ï¼‰å¯¹è¯¥æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œçš„ä¸€ç»„è¿‡ç¨‹ã€‚<br>3ï¼‰å¯¹å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«æ•°æ®è®¾ç½®åˆå§‹å€¼çš„è¯­å¥</p><p>3 ç®¡ç¨‹çš„åŸºæœ¬ç‰¹æ€§<br>1ï¼‰å±€éƒ¨äºç®¡ç¨‹çš„æ•°æ®åªèƒ½è¢«å±€éƒ¨äºç®¡ç¨‹å†…çš„è¿‡ç¨‹æ‰€è®¿é—®<br>2ï¼‰ä¸€ä¸ªè¿›ç¨‹åªæœ‰é€šè¿‡è°ƒç”¨ç®¡ç¨‹å†…çš„è¿‡ç¨‹æ‰èƒ½è¿›å…¥ç®¡ç¨‹è®¿é—®å…±äº«æ•°æ®<br>3ï¼‰æ¯æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹åœ¨ç®¡ç¨‹å†…æ‰§è¡ŒæŸä¸ªå†…éƒ¨è¿‡ç¨‹ã€‚<br>ç”±äºç®¡ç¨‹æ˜¯ä¸€ä¸ªè¯­è¨€æˆåˆ†ï¼Œæ‰€ä»¥ç®¡ç¨‹çš„äº’æ–¥è®¿é—®å®Œå…¨ç”±ç¼–è¯‘ç¨‹åºåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨æ·»åŠ ï¼Œæ— éœ€ç¨‹åºå‘˜å…³æ³¨ï¼Œè€Œä¸”ä¿è¯æ­£ç¡®.</p><p><strong>è¿™é‡Œï¼Œæˆ‘ä»¬å†ç”¨ç”Ÿæ´»åŒ–çš„è¯­è¨€ä»‹ç»ä»€ä¹ˆæ˜¯ç®¡ç¨‹ã€‚</strong><br>ç®¡ç¨‹å®è´¨ä¸Šæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»æœ‰å¥½å‡ ä¸ªæˆå‘˜å˜é‡ï¼Œç³»ç»Ÿä¸­ä»»ä½•è®¾å¤‡éƒ½å¯ä»¥é€šè¿‡è¿™å‡ æˆå‘˜å˜é‡è¿›è¡ŒåŒºåˆ†å’Œæè¿°ï¼šç®¡ç¨‹ä¸­è¿˜æœ‰å¯¹è¿™äº›æˆå‘˜å˜é‡è¿›è¡Œæ“ä½œçš„ä¸€ç»„æˆå‘˜å‡½æ•°ï¼Œä¾‹å¦‚ï¼Œå¯¹å¤–è®¾çš„æ“ä½œä¸­ï¼Œä¼šæœ‰readï¼Œwriteè¿™ä¸€ç±»å‡½æ•°ã€‚å‡å¦‚ï¼Œè¿›ç¨‹P0è¦ä½¿ç”¨ä¸€å°æ‰“å°æœºï¼Œäºæ˜¯ç®¡ç¨‹è¿™ä¸ªæŠ½è±¡ç±»å°±ä¼šåˆ©ç”¨åˆå§‹å€¼è¯­å¥å¯¹è‡ªèº«çš„å‡ ä¸ªæˆå‘˜å˜é‡èµ‹åˆå€¼ï¼ˆè¿™ä¸ªè¡Œä¸ºä¸éœ€è¦ç¨‹åºå‘˜å…³æ³¨ï¼‰ï¼Œç‰¹å®šçš„å‡ ä¸ªåˆå€¼å¯ä»¥è®©ç®¡ç¨‹è¡¨ç¤ºæˆä¸€å°æ‰“å°æœºï¼Œè¿›ç¨‹P0è¿›å…¥ç®¡ç¨‹åï¼Œé€šè¿‡è°ƒç”¨ç®¡ç¨‹ä¸­çš„æˆå‘˜å‡½æ•°ï¼ˆå³ä¸Šé¢æ‰€è¯´çš„è¿‡ç¨‹ï¼‰å¯¹è¿™å°æ‰“å°æœºè¿›è¡Œæ“ä½œã€‚æ¯æ¬¡è¿›å…¥è¿™ä¸ªç®¡ç¨‹çš„ï¼Œåªèƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹</p><h3 id="1-16-æ­»é”"><a href="#1-16-æ­»é”" class="headerlink" title="1.16 æ­»é”"></a>1.16 æ­»é”</h3><p><img src="https://img-blog.csdnimg.cn/20200603082933257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220214929860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021022021502281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220215048244.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021022021511267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210220215138752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ­»é”çš„å®šä¹‰</strong><br>åœ¨å¤šé“ç¨‹åºç³»ç»Ÿä¸­ï¼Œç”±äºå¤šä¸ªè¿›ç¨‹çš„å¹¶å‘æ‰§è¡Œï¼Œæ”¹å–„äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å¹¶æé«˜äº†ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ç„¶è€Œï¼Œå¤šä¸ªè¿›ç¨‹çš„å¹¶å‘æ‰§è¡Œä¹Ÿå¸¦æ¥äº†æ–°çš„é—®é¢˜â€”æ­»é”ã€‚æ‰€è°“æ­»é”æ˜¯æŒ‡å¤šä¸ªè¿›ç¨‹å› ç«äº‰èµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€ï¼ˆäº’ç›¸ç­‰å¾…ï¼‰ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œè¿™äº›è¿›ç¨‹éƒ½å°†æ— æ³•å‘å‰æ¨è¿›.åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼ŒæŸè®¡ç®—æœºç³»ç»Ÿä¸­åªæœ‰ä¸€å°æ‰“å°æœºå’Œä¸€å°è¾“å…¥è®¾å¤‡è¿›ç¨‹P1æ­£å ç”¨è¾“å…¥è®¾å¤‡ï¼ŒåŒæ—¶åˆæå‡ºä½¿ç”¨æ‰“å°æœºçš„è¯·æ±‚ï¼Œä½†æ­¤æ—¶æ‰“å°æœºæ­£è¢«è¿›ç¨‹P2æ‰€å ç”¨ï¼Œè€ŒP2åœ¨æœªé‡Šæ”¾æ‰“å°æœºä¹‹å‰ï¼Œåˆæå‡ºè¯·æ±‚ä½¿ç”¨æ­£è¢«P1å ç”¨ç€çš„è¾“å…¥è®¾å¤‡ã€‚è¿™æ ·ä¸¤ä¸ªè¿›ç¨‹ç›¸äº’æ— ä¼‘æ­¢åœ°ç­‰å¾…ä¸‹å»ï¼Œå‡æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ä¸¤ä¸ªè¿›ç¨‹é™·å…¥æ­»é”çŠ¶æ€ã€‚</p><p><strong>æ­»é”äº§ç”Ÿçš„åŸå› </strong><br>ï¼ˆ1ï¼‰ç³»ç»Ÿèµ„æºçš„ç«äº‰<br>é€šå¸¸ç³»ç»Ÿä¸­æ‹¥æœ‰çš„ä¸å¯å‰¥å¤ºèµ„æºï¼Œå…¶æ•°é‡ä¸è¶³ä»¥æ»¡è¶³å¤šä¸ªè¿›ç¨‹è¿è¡Œçš„éœ€è¦ï¼Œä½¿å¾—è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå› äº‰å¤ºèµ„æºè€Œé™·å…¥åƒµå±€ï¼Œå¦‚ç£å¸¦æœºã€æ‰“å°æœºç­‰ã€‚åªæœ‰å¯¹ä¸å¯å‰¥å¤ºèµ„æºçš„ç«äº‰æ‰å¯èƒ½äº§ç”Ÿæ­»é”ï¼Œå¯¹å¯å‰¥å¤ºèµ„æºçš„ç«äº‰æ˜¯ä¸ä¼šå¼•èµ·æ­»é”çš„ã€‚<br>ï¼ˆ2ï¼‰è¿›ç¨‹æ¨è¿›é¡ºåºéæ³•<br>è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯·æ±‚å’Œé‡Šæ”¾èµ„æºçš„é¡ºåºä¸å½“ï¼Œä¹ŸåŒæ ·ä¼šå¯¼è‡´æ­»é”ã€‚ä¾‹å¦‚ï¼Œå¹¶å‘è¿›ç¨‹P1P2åˆ†åˆ«ä¿æŒäº†èµ„æºR1ã€R2ï¼Œè€Œè¿›ç¨‹Plç”³è¯·èµ„æºR2ï¼Œè¿›ç¨‹P2ç”³è¯·èµ„æºR1æ—¶ï¼Œä¸¤è€…éƒ½ä¼šå› ä¸ºæ‰€éœ€èµ„æºè¢«å ç”¨è€Œé˜»å¡ã€‚ä¿¡å·é‡ä½¿ç”¨ä¸å½“ä¹Ÿä¼šé€ æˆæ­»é”ã€‚è¿›ç¨‹é—´å½¼æ­¤ç›¸äº’ç­‰å¾…å¯¹æ–¹å‘æ¥çš„æ¶ˆæ¯ï¼Œç»“æœä¹Ÿä¼šä½¿å¾—è¿™äº›è¿›ç¨‹é—´æ— æ³•ç»§ç»­å‘å‰æ¨è¿›ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹Aç­‰å¾…è¿›ç¨‹Bå‘çš„æ¶ˆæ¯ï¼Œè¿›ç¨‹Båˆåœ¨ç­‰å¾…è¿›ç¨‹Aå‘çš„æ¶ˆæ¯å¯ä»¥çœ‹å‡ºè¿›ç¨‹Aå’ŒBä¸æ˜¯å› ä¸ºç«äº‰åŒä¸€èµ„æºï¼Œè€Œæ˜¯åœ¨ç­‰å¾…å¯¹æ–¹çš„èµ„æºå¯¼è‡´æ­»é”.<br>ï¼ˆ3ï¼‰æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶<br>äº§ç”Ÿæ­»é”å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼Œåªè¦å…¶ä¸­ä»»ä¸€æ¡ä»¶ä¸æˆç«‹ï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿäº’æ–¥æ¡ä»¶ï¼šè¿›ç¨‹è¦æ±‚å¯¹æ‰€åˆ†é…çš„èµ„æºï¼ˆå¦‚æ‰“å°æœºï¼‰è¿›è¡Œæ’ä»–æ€§æ§åˆ¶ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºä»…ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ã€‚æ­¤æ—¶è‹¥æœ‰å…¶ä»–è¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è¿›ç¨‹åªèƒ½ç­‰å¾…ã€‚ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œå³åªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ï¼ˆåªèƒ½æ˜¯ä¸»åŠ¨é‡Šæ”¾ï¼‰.è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†å¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾</p><p><img src="https://img-blog.csdnimg.cn/20200603074928110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>èµ„æºåˆ†é…å›¾å«åœˆè€Œç³»ç»Ÿåˆä¸ä¸€å®šæœ‰æ­»é”çš„åŸå› æ˜¯åŒç±»èµ„æºæ•°å¤§äº1.ä½†è‹¥ç³»ç»Ÿä¸­æ¯ç±»èµ„æºéƒ½åªæœ‰ä¸€ä¸ªèµ„æºï¼Œåˆ™èµ„æºåˆ†é…å›¾å«åœˆå°±å˜æˆäº†ç³»ç»Ÿå‡ºç°æ­»é”çš„å……åˆ†å¿…è¦æ¡ä»¶ã€‚è¦æ³¨æ„åŒºåˆ†ä¸å¯å‰¥å¤ºæ¡ä»¶ä¸è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼Œç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼šå¦‚æœä½ æ‰‹ä¸Šæ‹¿ç€ä¸ªè‹¹æœï¼ˆå³ä¾¿ä½ ä¸æ‰“ç®—åƒï¼‰ï¼Œåˆ«äººä¸èƒ½æŠŠä½ æ‰‹ä¸Šçš„è‹¹æœæ‹¿èµ°ï¼Œé‚£å°±æ˜¯ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼›å¦‚æœä½ å·¦æ‰‹æ‹¿ç€ä¸€ä¸ªè‹¹æœï¼Œå…è®¸ä½ å³æ‰‹å†å»æ‹¿ä¸€ä¸ªè‹¹æœï¼Œé‚£å°±æ˜¯è¯·æ±‚å’Œä¿æŒæ¡ä»¶ã€‚</p><h3 id="1-17-æ­»é”çš„å¤„ç†ç­–ç•¥"><a href="#1-17-æ­»é”çš„å¤„ç†ç­–ç•¥" class="headerlink" title="1.17 æ­»é”çš„å¤„ç†ç­–ç•¥"></a>1.17 æ­»é”çš„å¤„ç†ç­–ç•¥</h3><p>ä¸ºä½¿ç³»ç»Ÿä¸å‘ç”Ÿæ­»é”ï¼Œå¿…é¡»è®¾æ³•ç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€ï¼Œæˆ–è€…å…è®¸æ­»é”äº§ç”Ÿï¼Œä½†å½“æ­»é”å‘ç”Ÿæ—¶èƒ½æ£€æµ‹å‡ºæ­»é”ï¼Œå¹¶æœ‰èƒ½åŠ›å®ç°æ¢å¤<br><strong>é¢„é˜²æ­»é”</strong><br>è®¾ç½®æŸäº›é™åˆ¶æ¡ä»¶ï¼Œç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªï¼Œä»¥é˜²æ­¢å‘ç”Ÿæ­»é”<br><strong>é¿å…æ­»é”</strong><br>åœ¨èµ„æºçš„åŠ¨æ€åˆ†é…è¿‡ç¨‹ä¸­ï¼Œç”¨æŸç§æ–¹æ³•é˜²æ­¢ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…æ­»é”<br><strong>æ­»é”çš„æ£€æµ‹åŠè§£é™¤</strong><br>æ— éœ€é‡‡å–ä»»ä½•é™åˆ¶æ€§æªæ–½ï¼Œå…è®¸è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”ã€‚é€šè¿‡ç³»ç»Ÿçš„æ£€æµ‹æœºæ„åŠæ—¶åœ°æ£€æµ‹å‡ºæ­»é”çš„å‘ç”Ÿï¼Œç„¶åé‡‡å–æŸç§æªæ–½è§£é™¤æ­»é”ã€‚<br>é¢„é˜²æ­»é”å’Œé¿å…æ­»é”éƒ½å±äºäº‹å…ˆé¢„é˜²ç­–ç•¥ï¼Œä½†é¢„é˜²æ­»é”çš„é™åˆ¶æ¡ä»¶æ¯”è¾ƒä¸¥æ ¼ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºç®€å•ï¼Œä½†å¾€å¾€å¯¼è‡´ç³»ç»Ÿçš„æ•ˆç‡ä½ï¼Œèµ„æºåˆ©ç”¨ç‡ä½ï¼šé¿å…æ­»é”çš„é™åˆ¶æ¡ä»¶ç›¸å¯¹å®½æ¾ï¼Œèµ„æºåˆ†é…åéœ€è¦é€šè¿‡ç®—æ³•æ¥åˆ¤æ–­æ˜¯å¦è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200603075414636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="1-17-1-æ­»é”é¢„é˜²"><a href="#1-17-1-æ­»é”é¢„é˜²" class="headerlink" title="1.17.1 æ­»é”é¢„é˜²"></a>1.17.1 æ­»é”é¢„é˜²</h4><p>é˜²æ­¢æ­»é”çš„å‘ç”Ÿåªéœ€ç ´åæ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€å³å¯</p><p><strong>ç ´åäº’æ–¥æ¡ä»¶</strong><br>å¦‚æœå…è®¸ç³»ç»Ÿèµ„æºéƒ½èƒ½å…±äº«ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¸ä¼šè¿›å…¥æ­»é”çŠ¶æ€ã€‚ä½†æœ‰äº›èµ„æºæ ¹æœ¬ä¸èƒ½åŒæ—¶è®¿é—®ï¼Œå¦‚æ‰“å°æœºç­‰ä¸´ç•Œèµ„æºåªèƒ½äº’æ–¥ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç ´åäº’æ–¥æ¡ä»¶è€Œé¢„é˜²æ­»é”çš„æ–¹æ³•ä¸å¤ªå¯è¡Œï¼Œè€Œä¸”åœ¨æœ‰çš„åœºåˆåº”è¯¥ä¿æŠ¤è¿™ç§äº’æ–¥æ€§</p><p><strong>ç ´åä¸å‰¥å¤ºæ¡ä»¶</strong><br>å½“ä¸€ä¸ªå·²ä¿æŒäº†æŸäº›ä¸å¯å‰¥å¤ºèµ„æºçš„è¿›ç¨‹ï¼Œè¯·æ±‚æ–°çš„èµ„æºè€Œå¾—ä¸åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»é‡Šæ”¾å·²ç»ä¿æŒçš„æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦æ—¶å†é‡æ–°ç”³è¯·ã€‚è¿™æ„å‘³ç€ï¼Œä¸€ä¸ªè¿›ç¨‹å·²å æœ‰çš„èµ„æºä¼šè¢«æš‚æ—¶é‡Šæ”¾æˆ–è€…è¯´æ˜¯è¢«å‰¥å¤ºäº†ï¼Œæˆ–ä»è€Œç ´åäº†ä¸å¯å‰¥å¤ºæ¡ä»¶</p><p>è¯¥ç­–ç•¥å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œé‡Šæ”¾å·²è·å¾—çš„èµ„æºå¯èƒ½é€ æˆå‰ä¸€é˜¶æ®µå·¥ä½œçš„å¤±æ•ˆï¼Œåå¤åœ°ç”³è¯·å’Œé‡Šæ”¾èµ„æºä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼Œé™ä½ç³»ç»Ÿååé‡.è¿™ç§æ–¹æ³•å¸¸ç”¨äºçŠ¶æ€æ˜“äºä¿å­˜å’Œæ¢å¤çš„èµ„æºï¼Œå¦‚CPUçš„å¯„å­˜å™¨åŠå†…å­˜èµ„æºï¼Œä¸€èˆ¬ä¸èƒ½ç”¨äºæ‰“å°æœºä¹‹ç±»çš„èµ„æº</p><p><strong>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶</strong><br>é‡‡ç”¨é¢„å…ˆé™æ€åˆ†é…æ–¹æ³•ï¼Œå³è¿›ç¨‹åœ¨è¿è¡Œå‰ä¸€æ¬¡ç”³è¯·å®Œå®ƒæ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºï¼Œåœ¨å®ƒçš„èµ„æºæœªæ»¡è¶³å‰ï¼Œä¸æŠŠå®ƒæŠ•å…¥è¿è¡Œã€‚ä¸€æ—¦æŠ•å…¥è¿è¡Œåï¼Œè¿™äº›èµ„æºå°±ä¸€ç›´å½’å®ƒæ‰€æœ‰ï¼Œä¹Ÿä¸å†æå‡ºå…¶ä»–èµ„æºè¯·æ±‚è¿™æ ·å°±å¯ä»¥ä¿è¯ç³»ç»Ÿä¸ä¼šå‘ç”Ÿæ­»é”</p><p>è¿™ç§æ–¹å¼å®ç°ç®€å•ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œç³»ç»Ÿèµ„æºè¢«ä¸¥é‡æµªè´¹ï¼Œå…¶ä¸­æœ‰äº›èµ„æºå¯èƒ½ä»…åœ¨è¿è¡ŒåˆæœŸæˆ–è¿è¡Œå¿«ç»“æŸæ—¶æ‰ä½¿ç”¨ï¼Œç”šè‡³æ ¹æœ¬ä¸ä½¿ç”¨ã€‚è€Œä¸”è¿˜ä¼šå¯¼è‡´â€œé¥¥é¥¿â€ç°è±¡ï¼Œå½“ç”±äºä¸ªåˆ«èµ„æºé•¿æœŸè¢«å…¶ä»–è¿›ç¨‹å ç”¨æ—¶ï¼Œå°†è‡´ä½¿ç­‰å¾…è¯¥èµ„æºçš„è¿›ç¨‹è¿Ÿè¿Ÿä¸èƒ½å¼€å§‹è¿è¡Œã€‚</p><p><strong>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</strong><br>ä¸ºäº†ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå¯é‡‡ç”¨é¡ºåºèµ„æºåˆ†é…æ³•ã€‚é¦–å…ˆç»™ç³»ç»Ÿä¸­çš„èµ„æºç¼–å·ï¼Œè§„å®šæ¯ä¸ªè¿›ç¨‹å¿…é¡»æŒ‰ç¼–å·é€’å¢çš„é¡ºåºè¯·æ±‚èµ„æºï¼ŒåŒç±»èµ„æºä¸€æ¬¡ç”³è¯·å®Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è¿›ç¨‹æå‡ºç”³è¯·åˆ†é…èµ„æºRiï¼Œåˆ™è¯¥è¿›ç¨‹åœ¨ä»¥åçš„èµ„æºç”³è¯·ä¸­ï¼Œåªèƒ½ç”³è¯·ç¼–å·å¤§äºRiçš„èµ„æº.</p><p>è¿™ç§æ–¹æ³•å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œç¼–å·å¿…é¡»ç›¸å¯¹ç¨³å®šï¼Œè¿™å°±é™åˆ¶äº†æ–°ç±»å‹è®¾å¤‡çš„å¢åŠ ï¼šå°½ç®¡åœ¨ä¸ºèµ„æºç¼–å·æ—¶å·²è€ƒè™‘åˆ°å¤§å¤šæ•°ä½œä¸šå®é™…ä½¿ç”¨è¿™äº›èµ„æºçš„é¡ºåºï¼Œä½†ä¹Ÿç»å¸¸ä¼šå‘ç”Ÿä½œä¸šä½¿ç”¨èµ„æºçš„é¡ºåºä¸ç³»ç»Ÿè§„å®šé¡ºåºä¸åŒçš„æƒ…å†µï¼Œé€ æˆèµ„æºçš„æµªè´¹ï¼šæ­¤å¤–ï¼Œè¿™ç§æŒ‰è§„å®šæ¬¡åºç”³è¯·èµ„æºçš„æ–¹æ³•ï¼Œä¹Ÿå¿…ç„¶ä¼šç»™ç”¨æˆ·çš„ç¼–ç¨‹å¸¦æ¥éº»çƒ¦.</p><h4 id="1-17-2-æ­»é”é¿å…"><a href="#1-17-2-æ­»é”é¿å…" class="headerlink" title="1.17.2 æ­»é”é¿å…"></a>1.17.2 æ­»é”é¿å…</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210603162257147.png" alt="image-20210603162257147"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210603162451927.png" alt="image-20210603162451927"></p><p><strong>åˆ™å¯ä»¥å¼•å…¥é“¶è¡Œå®¶ç®—æ³•ï¼Œè§PDF 290é¡µ</strong></p><h4 id="1-17-3-æ­»é”æ£€æµ‹å’Œè§£é™¤"><a href="#1-17-3-æ­»é”æ£€æµ‹å’Œè§£é™¤" class="headerlink" title="1.17.3 æ­»é”æ£€æµ‹å’Œè§£é™¤"></a>1.17.3 æ­»é”æ£€æµ‹å’Œè§£é™¤</h4><p>å‰é¢ä»‹ç»çš„æ­»é”é¢„é˜²å’Œé¿å…ç®—æ³•ï¼Œéƒ½æ˜¯åœ¨ä¸ºè¿›ç¨‹åˆ†é…èµ„æºæ—¶æ–½åŠ é™åˆ¶æ¡ä»¶æˆ–è¿›è¡Œæ£€æµ‹ï¼Œè‹¥ç³»ç»Ÿä¸ºè¿›ç¨‹åˆ†é…èµ„æºæ—¶ä¸é‡‡å–ä»»ä½•æªæ–½ï¼Œåˆ™åº”è¯¥æä¾›æ­»é”æ£€æµ‹å’Œè§£é™¤çš„æ‰‹æ®µã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210603163502062.png" alt="image-20210603163502062"></p><p><strong>å…·ä½“è§PDF 299é¡µ</strong></p><h1 id="ä¸‰ã€å†…å­˜ç®¡ç†"><a href="#ä¸‰ã€å†…å­˜ç®¡ç†" class="headerlink" title="ä¸‰ã€å†…å­˜ç®¡ç†"></a>ä¸‰ã€å†…å­˜ç®¡ç†</h1><p><img src="https://img-blog.csdnimg.cn/20200711083859717.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-1-å†…å­˜ç®¡ç†çš„æ¦‚å¿µ"><a href="#1-1-å†…å­˜ç®¡ç†çš„æ¦‚å¿µ" class="headerlink" title="1.1 å†…å­˜ç®¡ç†çš„æ¦‚å¿µ"></a>1.1 å†…å­˜ç®¡ç†çš„æ¦‚å¿µ</h2><p><img src="https://img-blog.csdnimg.cn/20200705083124193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200705083705203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å†…å­˜ç®¡ç†</strong>ï¼ˆ Memory Managementï¼‰æ˜¯æ“ä½œç³»ç»Ÿè®¾è®¡ä¸­æœ€é‡è¦å’Œæœ€å¤æ‚çš„å†…å®¹ä¹‹ä¸€ã€‚æ“ä½œç³»ç»Ÿå¯¹å†…å­˜çš„åˆ’åˆ†å’ŒåŠ¨æ€åˆ†é…ï¼Œå°±æ˜¯å†…å­˜ç®¡ç†çš„æ¦‚å¿µ<br>å†…å­˜ç®¡ç†çš„åŠŸèƒ½æœ‰ï¼š<br>å†…å­˜ç©ºé—´çš„åˆ†é…ä¸å›æ”¶ï¼šç”±æ“ä½œç³»ç»Ÿå®Œæˆä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œç®¡ç†ï¼Œä½¿ç¨‹åºå‘˜æ‘†è„±å­˜å‚¨åˆ†é…çš„éº»çƒ¦ï¼Œæé«˜ç¼–ç¨‹æ•ˆç‡ã€‚</p><p><strong>åœ°å€è½¬æ¢</strong>ï¼šåœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œç¨‹åºä¸­çš„é€»è¾‘åœ°å€ä¸å†…å­˜ä¸­çš„ç‰©ç†åœ°å€ä¸å¯èƒ½ä¸€è‡´ï¼Œå› æ­¤å­˜å‚¨ç®¡ç†å¿…é¡»æä¾›åœ°å€å˜æ¢åŠŸèƒ½ï¼ŒæŠŠé€»è¾‘åœ°å€è½¬æ¢æˆç›¸åº”çš„ç‰©ç†åœ°å€ã€‚</p><p>å†…å­˜ç©ºé—´çš„æ‰©å……ï¼šåˆ©ç”¨è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯æˆ–è‡ªåŠ¨è¦†ç›–æŠ€æœ¯ï¼Œä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜</p><p><strong>å­˜å‚¨ä¿æŠ¤</strong>ï¼šä¿è¯å„é“ä½œä¸šåœ¨å„è‡ªçš„å­˜å‚¨ç©ºé—´å†…è¿è¡Œï¼Œäº’ä¸å¹²æ‰°ã€‚<br>åœ¨è¿›è¡Œå…·ä½“çš„å†…å­˜ç®¡ç†ä¹‹å‰ï¼Œéœ€è¦äº†è§£è¿›ç¨‹è¿è¡Œçš„åŸºæœ¬åŸç†å’Œè¦æ±‚ã€‚</p><p><strong>ç¨‹åºè£…å…¥å’Œé“¾æ¥</strong></p><p>åˆ›å»ºè¿›ç¨‹é¦–å…ˆè¦å°†ç¨‹åºå’Œæ•°æ®è£…å…¥å†…å­˜ã€‚å°†ç”¨æˆ·æºç¨‹åºå˜ä¸ºå¯åœ¨å†…å­˜ä¸­æ‰§è¡Œçš„ç¨‹åºï¼Œé€šå¸¸éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><p><code>ç¼–è¯‘</code>ï¼šç”±ç¼–è¯‘ç¨‹åºå°†ç”¨æˆ·æºä»£ç ç¼–è¯‘æˆè‹¥å¹²ä¸ªç›®æ ‡æ¨¡å—<br><code>é“¾æ¥</code>ï¼šç”±é“¾æ¥ç¨‹åºå°†ç¼–è¯‘åå½¢æˆçš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œä»¥åŠæ‰€éœ€åº“å‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è£…å…¥æ¨¡å—<br><code>è£…å…¥</code>ï¼šç”±è£…å…¥ç¨‹åºå°†è£…å…¥æ¨¡å—è£…å…¥å†…å­˜è¿è¡Œã€‚</p><p>ç¨‹åºçš„é“¾æ¥æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼</p><p><code>é™æ€é“¾æ¥</code>ï¼šåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå…ˆå°†å„ç›®æ ‡æ¨¡å—åŠå®ƒä»¬æ‰€éœ€çš„åº“å‡½æ•°é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œç¨‹åºï¼Œä»¥åä¸å†æ‹†å¼€ã€‚</p><p><code>è£…å…¥æ—¶åŠ¨æ€é“¾æ¥</code>ï¼šå°†ç”¨æˆ·æºç¨‹åºç¼–è¯‘åæ‰€å¾—åˆ°çš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œåœ¨è£…å…¥å†…å­˜æ—¶ï¼Œé‡‡ç”¨è¾¹è£…å…¥è¾¹é“¾æ¥çš„é“¾æ¥æ–¹å¼</p><p><img src="https://img-blog.csdnimg.cn/20200604130139117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥</code>ï¼šå¯¹æŸäº›ç›®æ ‡æ¨¡å—çš„é“¾æ¥ï¼Œæ˜¯åœ¨ç¨‹åºæ‰§è¡Œä¸­éœ€è¦è¯¥ç›®æ ‡æ¨¡å—æ—¶ï¼Œæ‰å¯¹å®ƒè¿›è¡Œçš„é“¾æ¥ã€‚å…¶ä¼˜ç‚¹æ˜¯ä¾¿äºä¿®æ”¹å’Œæ›´æ–°ï¼Œä¾¿äºå®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«</p><p>å†…å­˜çš„è£…å…¥æ¨¡å—åœ¨è£…å…¥å†…å­˜æ—¶ï¼ŒåŒæ ·æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><p>1ï¼‰<code>ç»å¯¹è£…å…¥</code>ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œå¦‚æœçŸ¥é“ç¨‹åºå°†é©»ç•™åœ¨å†…å­˜çš„æŸä¸ªä½ç½®ï¼Œç¼–è¯‘ç¨‹åºå°†äº§ç”Ÿç»å¯¹åœ°å€çš„ç›®æ ‡ä»£ç ã€‚ç»å¯¹è£…å…¥ç¨‹åºæŒ‰ç…§è£…å…¥æ¨¡å—ä¸­çš„åœ°å€ï¼Œå°†ç¨‹åºå’Œæ•°æ®è£…å…¥å†…å­˜ã€‚ç”±äºç¨‹åºä¸­çš„é€»è¾‘åœ°å€ä¸å®é™…å†…å­˜åœ°å€å®Œå…¨ç›¸åŒï¼Œæ•…ä¸éœ€å¯¹ç¨‹åºå’Œæ•°æ®çš„åœ°å€è¿›è¡Œä¿®æ”¹<br>ç»å¯¹è£…å…¥æ–¹å¼åªé€‚ç”¨äºå•é“ç¨‹åºç¯å¢ƒã€‚å¦å¤–ï¼Œç¨‹åºä¸­æ‰€ä½¿ç”¨çš„ç»å¯¹åœ°å€ï¼Œå¯åœ¨ç¼–è¯‘æˆ–æ±‡ç¼–æ—¶ç»™å‡ºï¼Œä¹Ÿå¯ç”±ç¨‹åºå‘˜ç›´æ¥èµ‹äºˆã€‚è€Œé€šå¸¸æƒ…å†µä¸‹åœ¨ç¨‹åºä¸­é‡‡ç”¨çš„æ˜¯ç¬¦å·åœ°å€ï¼Œç¼–è¯‘æˆ–æ±‡ç¼–æ—¶å†è½¬æ¢ä¸ºç»å¯¹åœ°å€ã€‚</p><p>2ï¼‰<code>å¯é‡å®šä½è£…å…¥</code>ã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¤šä¸ªç›®æ ‡æ¨¡å—çš„èµ·å§‹åœ°å€é€šå¸¸éƒ½æ˜¯ä»0å¼€å§‹ï¼Œç¨‹åºä¸­çš„å…¶ä»–åœ°å€éƒ½æ˜¯ç›¸å¯¹äºèµ·å§‹åœ°å€çš„ï¼Œæ­¤æ—¶åº”é‡‡ç”¨å¯é‡å®šä½è£…å…¥æ–¹å¼ã€‚æ ¹æ®å†…å­˜çš„å½“å‰æƒ…å†µï¼Œå°†è£…å…¥æ¨¡å—è£…å…¥åˆ°å†…å­˜çš„é€‚å½“ä½ç½®ã€‚è£…å…¥æ—¶å¯¹ç›®æ ‡ç¨‹åºä¸­æŒ‡ä»¤å’Œæ•°æ®çš„ä¿®æ”¹è¿‡ç¨‹ç§°ä¸ºé‡å®šä½ï¼Œåœ°å€å˜æ¢é€šå¸¸æ˜¯åœ¨è£…å…¥æ—¶ä¸€æ¬¡å®Œæˆçš„ï¼Œæ‰€ä»¥åˆç§°ä¸ºé™æ€é‡å®šä½ï¼Œå¦‚å›¾ï¼ˆaï¼‰æ‰€ç¤ºã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200604130820626.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é™æ€é‡å®šä½çš„ç‰¹ç‚¹æ˜¯åœ¨ä¸€ä¸ªä½œä¸šè£…å…¥å†…å­˜æ—¶ï¼Œå¿…é¡»åˆ†é…å…¶è¦æ±‚çš„å…¨éƒ¨å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¸èƒ½è£…å…¥è¯¥ä½œä¸šã€‚æ­¤å¤–ï¼Œä½œä¸šä¸€æ—¦è¿›å…¥å†…å­˜åï¼Œåœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´ä¸èƒ½åœ¨å†…å­˜ä¸­ç§»åŠ¨ï¼Œä¹Ÿä¸èƒ½å†ç”³è¯·å†…å­˜ç©ºé—´</p><p>åŠ¨æ€è¿è¡Œæ—¶è£…å…¥ï¼Œä¹Ÿç§°ä¸º<code>åŠ¨æ€é‡å®šä½</code>ï¼Œç¨‹åºåœ¨å†…å­˜ä¸­å¦‚æœå‘ç”Ÿç§»åŠ¨ï¼Œå°±éœ€è¦é‡‡ç”¨åŠ¨æ€çš„è£…å…¥æ–¹å¼ã€‚è£…å…¥ç¨‹åºåœ¨æŠŠè£…å…¥æ¨¡å—è£…å…¥å†…å­˜åï¼Œå¹¶ä¸ç«‹å³æŠŠè£…å…¥æ¨¡å—ä¸­çš„ç›¸å¯¹åœ°å€è½¬æ¢ä¸ºç»å¯¹åœ°å€ï¼Œè€Œæ˜¯æŠŠè¿™ç§åœ°å€è½¬æ¢æ¨è¿Ÿåˆ°ç¨‹åºçœŸæ­£è¦æ‰§è¡Œæ—¶æ‰è¿›è¡Œã€‚å› æ­¤ï¼Œè£…å…¥å†…å­˜åçš„æ‰€æœ‰åœ°å€å‡ä¸ºç›¸å¯¹åœ°å€ã€‚è¿™ç§æ–¹å¼éœ€è¦ä¸€ä¸ªé‡å®šä½å¯„å­˜å™¨çš„æ”¯æŒï¼Œå¦‚å›¾ï¼ˆbï¼‰æ‰€ç¤º<br>åŠ¨æ€é‡å®šä½çš„ç‰¹ç‚¹æ˜¯å¯ä»¥å°†ç¨‹åºåˆ†é…åˆ°ä¸è¿ç»­çš„å­˜å‚¨åŒºä¸­ï¼šåœ¨ç¨‹åºè¿è¡Œä¹‹å‰å¯ä»¥åªè£…å…¥å®ƒçš„éƒ¨åˆ†ä»£ç å³å¯æŠ•å…¥è¿è¡Œï¼Œç„¶ååœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ ¹æ®éœ€è¦åŠ¨æ€ç”³è¯·åˆ†é…å†…å­˜ï¼šä¾¿äºç¨‹åºæ®µçš„å…±äº«,å¯ä»¥å‘ç”¨æˆ·æä¾›ä¸€ä¸ªæ¯”å­˜å‚¨ç©ºé—´å¤§å¾—å¤šçš„åœ°å€ç©ºé—´</p><p><img src="https://img-blog.csdnimg.cn/20200604131137834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>é€»è¾‘åœ°æ‰¯ç©ºé—´ä¸ç‰©ç†åœ°å€ç©ºé—´</strong></p><p>ç¼–è¯‘åï¼Œæ¯ä¸ªç›®æ ‡æ¨¡å—éƒ½æ˜¯ä»0å·å•å…ƒå¼€å§‹ç¼–å€ï¼Œç§°ä¸ºè¯¥ç›®æ ‡æ¨¡å—çš„ç›¸å¯¹åœ°å€ï¼ˆæˆ–é€»è¾‘åœ°å€ï¼‰.<br>é“¾æ¥ç¨‹åºå°†å„ä¸ªæ¨¡å—é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œç›®æ ‡ç¨‹åºæ—¶ï¼Œé“¾æ¥ç¨‹åºé¡ºåºä¾æ¬¡æŒ‰å„ä¸ªæ¨¡å—çš„ç›¸å¯¹åœ°å€æ„æˆç»Ÿä¸€çš„ä»0å·å•å…ƒå¼€å§‹ç¼–å€çš„é€»è¾‘åœ°å€ç©ºé—´ã€‚ç”¨æˆ·ç¨‹åºå’Œç¨‹åºå‘˜åªéœ€çŸ¥é“é€»è¾‘åœ°å€è€Œå†…å­˜ç®¡ç†çš„å…·ä½“æœºåˆ¶åˆ™æ˜¯å®Œå…¨é€æ˜çš„ï¼Œå®ƒä»¬åªæœ‰ç³»ç»Ÿç¼–ç¨‹äººå‘˜æ‰ä¼šæ¶‰åŠã€‚ä¸åŒè¿›ç¨‹å¯ä»¥æœ‰ç›¸åŒçš„é€»è¾‘åœ°å€ï¼Œå› ä¸ºè¿™äº›ç›¸åŒçš„é€»è¾‘åœ°å€å¯ä»¥æ˜ å°„åˆ°ä¸»å­˜çš„ä¸åŒä½ç½®.ç‰©ç†åœ°å€ç©ºé—´æ˜¯æŒ‡å†…å­˜ä¸­ç‰©ç†å•å…ƒçš„é›†åˆï¼Œå®ƒæ˜¯åœ°å€è½¬æ¢çš„æœ€ç»ˆåœ°å€ï¼Œè¿›ç¨‹åœ¨è¿è¡Œæ—¶æ‰§è¡ŒæŒ‡ä»¤å’Œè®¿é—®æ•°æ®æœ€åéƒ½è¦é€šè¿‡ç‰©ç†åœ°å€ä»ä¸»å­˜ä¸­å­˜å–ã€‚å½“è£…å…¥ç¨‹åºå°†å¯æ‰§è¡Œä»£ç è£…å…¥å†…å­˜æ—¶ï¼Œå¿…é¡»é€šè¿‡åœ°å€è½¬æ¢å°†é€»è¾‘åœ°å€è½¬æ¢æˆç‰©ç†åœ°å€ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåœ°å€é‡å®šä½</p><p><strong>å†…å­˜ä¿æŠ¤</strong></p><p>å†…å­˜åˆ†é…å‰ï¼Œéœ€è¦ä¿æŠ¤æ“ä½œç³»ç»Ÿä¸å—ç”¨æˆ·è¿›ç¨‹çš„å½±å“ï¼ŒåŒæ—¶ä¿æŠ¤ç”¨æˆ·è¿›ç¨‹ä¸å—å…¶ä»–ç”¨æˆ·è¿›ç¨‹çš„å½±å“ã€‚å†…å­˜ä¿æŠ¤å¯é‡‡å–ä¸¤ç§æ–¹æ³•</p><ul><li><p>åœ¨CPUä¸­è®¾ç½®ä¸€å¯¹ä¸Šã€ä¸‹é™å¯„å­˜å™¨ï¼Œå­˜æ”¾ç”¨æˆ·ä½œä¸šåœ¨ä¸»å­˜ä¸­çš„ä¸‹é™å’Œä¸Šé™åœ°å€ï¼Œæ¯å½“CPUè¦è®¿é—®ä¸€ä¸ªåœ°å€æ—¶ï¼Œåˆ†åˆ«å’Œä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼ç›¸æ¯”ï¼Œåˆ¤æ–­æœ‰æ— è¶Šç•Œ</p></li><li><p>é€šè¿‡é‡‡ç”¨é‡å®šä½å¯„å­˜å™¨ï¼ˆæˆ–åŸºå€å¯„å­˜å™¨ï¼‰å’Œç•Œåœ°å€å¯„å­˜å™¨ï¼ˆåˆç§°é™é•¿å¯„å­˜å™¨ï¼‰æ¥å®ç°è¿™ç§ä¿æŠ¤ã€‚é‡å®šä½å¯„å­˜å™¨å«æœ€å°çš„ç‰©ç†åœ°å€å€¼ï¼Œç•Œåœ°å€å¯„å­˜å™¨å«é€»è¾‘åœ°å€çš„æœ€å¤§å€¼ã€‚æ¯ä¸ªé€»è¾‘åœ°å€å€¼å¿…é¡»å°äºç•Œåœ°å€å¯„å­˜å™¨ï¼›å†…å­˜ç®¡ç†æœºæ„åŠ¨æ€åœ°å°†é€»è¾‘åœ°å€ä¸ç•Œåœ°å€å¯„å­˜å™¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœªå‘ç”Ÿåœ°å€è¶Šç•Œï¼Œåˆ™åŠ ä¸Šé‡å®šä½å¯„å­˜å™¨çš„å€¼åæ˜ å°„æˆç‰©ç†åœ°å€ï¼Œå†é€äº¤å†…å­˜å•å…ƒï¼Œå¦‚å›¾3-3æ‰€ç¤º</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20200604131837577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å½“CPUè°ƒåº¦ç¨‹åºé€‰æ‹©è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œæ´¾é£ç¨‹åºä¼šåˆå§‹åŒ–é‡å®šä½å¯„å­˜å™¨å’Œç•Œåœ°å€å¯„å­˜å™¨ã€‚æ¯ä¸ªé€»è¾‘åœ°å€éƒ½éœ€è¦ä¸è¿™ä¸¤ä¸ªå¯„å­˜å™¨è¿›è¡Œæ ¸å¯¹ï¼Œä»¥ä¿è¯æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç”¨æˆ·ç¨‹åºåŠæ•°æ®ä¸è¢«è¯¥è¿›ç¨‹çš„è¿è¡Œæ‰€å½±å“.å®ç°å†…å­˜ä¿æŠ¤éœ€è¦é‡å®šä½å¯„å­˜å™¨å’Œç•Œåœ°å€å¯„å­˜å™¨ï¼Œæ³¨æ„ä¸¤è€…çš„åŒºåˆ«ã€‚é‡å®šä½å¯„å­˜å™¨æ˜¯ç”¨æ¥â€œåŠ â€çš„ï¼Œé€»è¾‘åœ°å€åŠ ä¸Šé‡å®šä½å¯„å­˜å™¨ä¸­çš„å€¼å°±èƒ½å¾—åˆ°ç‰©ç†åœ°å€;ç•Œåœ°å€å¯„å­˜å™¨æ˜¯ç”¨æ¥â€œæ¯”â€çš„é€šè¿‡æ¯”è¾ƒç•Œåœ°å€å¯„å­˜å™¨ä¸­çš„å€¼ä¸é‡å®šä½å¯„å­˜å™¨åŠ ä¸Šé€»è¾‘åœ°å€çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦è¶Šç•Œ</p><h2 id="1-2-è¦†ç›–ä¸äº¤æ¢"><a href="#1-2-è¦†ç›–ä¸äº¤æ¢" class="headerlink" title="1.2 è¦†ç›–ä¸äº¤æ¢"></a>1.2 è¦†ç›–ä¸äº¤æ¢</h2><p><img src="https://img-blog.csdnimg.cn/20200705085655673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¦†ç›–ä¸äº¤æ¢æŠ€æœ¯æ˜¯åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ç”¨æ¥æ‰©å……å†…å­˜çš„ä¸¤ç§æ–¹æ³•</p><h3 id="è¦†ç›–"><a href="#è¦†ç›–" class="headerlink" title="è¦†ç›–"></a>è¦†ç›–</h3><p>æ—©æœŸçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä¸»å­˜å®¹é‡å¾ˆå°ï¼Œè™½ç„¶ä¸»å­˜ä¸­ä»…å­˜æ”¾ä¸€é“ç”¨æˆ·ç¨‹åºï¼Œä½†æ˜¯å­˜å‚¨ç©ºé—´æ”¾ä¸ä¸‹ç”¨æˆ·è¿›ç¨‹çš„ç°è±¡ä¹Ÿç»å¸¸å‘ç”Ÿï¼Œè¿™ä¸€çŸ›ç›¾å¯ä»¥ç”¨è¦†ç›–æŠ€æœ¯æ¥è§£å†³</p><p><strong>è¦†ç›–çš„åŸºæœ¬æ€æƒ³</strong>ï¼šç”±äºç¨‹åºè¿è¡Œæ—¶å¹¶éä»»ä½•æ—¶å€™éƒ½è¦è®¿é—®ç¨‹åºåŠæ•°æ®çš„å„ä¸ªéƒ¨åˆ†ï¼ˆå°¤å…¶æ˜¯å¤§ç¨‹åºï¼‰ï¼Œå› æ­¤å¯ä»¥æŠŠç”¨æˆ·ç©ºé—´åˆ†æˆä¸€ä¸ªå›ºå®šåŒºå’Œè‹¥å¹²ä¸ªè¦†ç›–åŒºã€‚å°†ç»å¸¸æ´»è·ƒçš„éƒ¨åˆ†æ”¾åœ¨å›ºå®šåŒº.å…¶ä½™éƒ¨åˆ†æŒ‰è°ƒç”¨å…³ç³»åˆ†æ®µã€‚é¦–å…ˆå°†é‚£äº›å³å°†è¦è®¿é—®çš„æ®µæ”¾å…¥è¦†ç›–åŒºï¼Œå…¶ä»–æ®µæ”¾åœ¨å¤–å­˜ä¸­ï¼Œåœ¨éœ€è¦è°ƒç”¨å‰ï¼Œç³»ç»Ÿå†å°†å…¶è°ƒå…¥è¦†ç›–åŒºï¼Œæ›¿æ¢è¦†ç›–åŒºä¸­åŸæœ‰çš„æ®µ.</p><p><strong>è¦†ç›–æŠ€æœ¯çš„ç‰¹ç‚¹</strong>æ˜¯æ‰“ç ´äº†å¿…é¡»å°†ä¸€ä¸ªè¿›ç¨‹çš„å…¨éƒ¨ä¿¡æ¯è£…å…¥ä¸»å­˜åæ‰èƒ½è¿è¡Œçš„é™åˆ¶ï¼Œä½†å½“åŒæ—¶è¿è¡Œç¨‹åºçš„ä»£ç é‡å¤§äºä¸»å­˜æ—¶ä»ä¸èƒ½è¿è¡Œï¼Œå†è€Œï¼Œå¤§å®¶è¦æ³¨æ„åˆ°ï¼Œå†…å­˜ä¸­èƒ½å¤Ÿæ›´æ–°çš„åœ°æ–¹åªæœ‰è¦†å‡†åŒºçš„æ®µï¼Œä¸åœ¨è¦†ç›–åŒºä¸­çš„æ®µä¼šå¸¸é©»å†…å­˜</p><h3 id="äº¤æ¢"><a href="#äº¤æ¢" class="headerlink" title="äº¤æ¢"></a>äº¤æ¢</h3><p><strong>äº¤æ¢ï¼ˆå¯¹æ¢ï¼‰çš„åŸºæœ¬æ€æƒ³</strong>ï¼ŒæŠŠå¤„äºç­‰å¾…çŠ¶æ€ï¼ˆæˆ–åœ¨CPUè°ƒåº¦åŸåˆ™ä¸‹è¢«å‰¥å¤ºè¿è¡Œæƒåˆ©ï¼‰çš„ç¨‹åºä»å†…å­˜ç§»åˆ°è¾…å­˜ï¼ŒæŠŠå†…å­˜ç©ºé—´è…¾å‡ºæ¥ï¼Œè¿™ä¸€è¿‡ç¨‹åˆå«æ¢å‡ºï¼šæŠŠå‡†å¤‡å¥½ç«äº‰CPUè¿è¡Œçš„ç¨‹åºä»è¾…å­˜ç§»åˆ°å†…å­˜ï¼Œè¿™ä¸€è¿‡ç¨‹åˆç§°ä¸ºæ¢å…¥ã€‚</p><p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªCPUé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•çš„å¤šé“ç¨‹åºç¯å¢ƒã€‚æ—¶é—´ç‰‡åˆ°ï¼Œå†…å­˜ç®¡ç†å™¨å°†åˆšåˆšæ‰§è¡Œè¿‡çš„è¿›ç¨‹æ¢å‡ºï¼Œå°†å¦ä¸€è¿›ç¨‹æ¢å…¥åˆ°åˆšåˆšé‡Šæ”¾çš„å†…å­˜ç©ºé—´ä¸­ã€‚åŒæ—¶ï¼ŒCPUè°ƒåº¦å™¨å¯ä»¥å°†æ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä»–å·²åœ¨å†…å­˜ä¸­çš„è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹ç”¨å®Œæ—¶é—´ç‰‡éƒ½ä¸å¦ä¸€è¿›ç¨‹äº¤æ¢ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå†…å­˜ç®¡ç†å™¨çš„äº¤æ¢è¿‡ç¨‹é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œæ€»æœ‰è¿›ç¨‹åœ¨å†…å­˜ä¸­å¯ä»¥æ‰§è¡Œ.</p><p>æœ‰å…³äº¤æ¢éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<br>äº¤æ¢éœ€è¦å¤‡ä»½å­˜å‚¨ï¼Œé€šå¸¸æ˜¯å¿«é€Ÿç£ç›˜ã€‚å®ƒå¿…é¡»è¶³å¤Ÿå¤§ï¼Œå¹¶ä¸”æä¾›å¯¹è¿™äº›å†…å­˜æ˜ åƒçš„ç›´æ¥è®¿é—®ã€‚ä¸ºäº†æœ‰æ•ˆä½¿ç”¨CPUï¼Œéœ€è¦æ¯ä¸ªè¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´æ¯”äº¤æ¢æ—¶é—´é•¿ï¼Œè€Œå½±å“äº¤æ¢æ—¶é—´çš„ä¸»è¦æ˜¯è½¬ç§»æ—¶é—´ã€‚è½¬ç§»æ—¶é—´ä¸æ‰€äº¤æ¢çš„å†…å­˜ç©ºé—´æˆæ­£æ¯”.å¦‚æœæ¢å‡ºè¿›ç¨‹ï¼Œå¿…é¡»ç¡®ä¿è¯¥è¿›ç¨‹æ˜¯å®Œå…¨å¤„äºç©ºé—²çŠ¶æ€.äº¤æ¢ç©ºé—´é€šå¸¸ä½œä¸ºç£ç›˜çš„ä¸€æ•´å—ï¼Œä¸”ç‹¬ç«‹äºæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤ä½¿ç”¨å°±å¯èƒ½å¾ˆå¿«äº¤æ¢é€šå¸¸åœ¨æœ‰è®¸å¤šè¿›ç¨‹è¿è¡Œä¸”å†…å­˜ç©ºé—´åƒç´§æ—¶å¼€å§‹å¯åŠ¨ï¼Œè€Œç³»ç»Ÿè´Ÿè·é™ä½å°±æš‚åœã€‚æ™®é€šçš„äº¤æ¢ä½¿ç”¨ä¸å¤šï¼Œä½†äº¤æ¢ç­–ç•¥çš„æŸäº›å˜ç§åœ¨è®¸å¤šç³»ç»Ÿä¸­ï¼ˆå¦‚UNâ…¨ç³»ç»Ÿï¼‰ä»å‘æŒ¥ä½œç”¨</p><p>äº¤æ¢æŠ€æœ¯ä¸»è¦æ˜¯åœ¨ä¸åŒè¿›ç¨‹ï¼ˆæˆ–ä½œä¸šï¼‰ä¹‹é—´è¿›è¡Œï¼Œè€Œè¦†ç›–åˆ™ç”¨äºåŒä¸€ä¸ªç¨‹åºæˆ–è¿›ç¨‹ä¸­ã€‚ç”±äºè¦†ç›–æŠ€æœ¯è¦æ±‚ç»™å‡ºç¨‹åºæ®µä¹‹é—´çš„è¦†ç›–ç»“æ„ï¼Œä½¿å¾—å…¶å¯¹ç”¨æˆ·å’Œç¨‹åºå‘˜ä¸é€æ˜ï¼Œæ‰€ä»¥å¯¹äºä¸»å­˜æ— æ³•å­˜æ”¾ç”¨æˆ·ç¨‹åºçš„çŸ›ç›¾ï¼Œç°ä»£æ“ä½œç³»ç»Ÿæ˜¯é€šè¿‡è™šæ‹Ÿå†…å­˜æŠ€æœ¯æ¥è§£å†³çš„ï¼Œè¦†ç›–æŠ€æœ¯åˆ™å·²æˆä¸ºå†å²ï¼šè€Œäº¤æ¢æŠ€æœ¯åœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ä»å…·æœ‰è¾ƒå¼ºçš„ç”Ÿå‘½åŠ›</p><h2 id="1-3-è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼"><a href="#1-3-è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼" class="headerlink" title="1.3 è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼"></a>1.3 è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</h2><p><img src="https://img-blog.csdnimg.cn/20200705092720324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿ç»­åˆ†é…æ–¹å¼ï¼Œæ˜¯æŒ‡ä¸ºä¸€ä¸ªç”¨æˆ·ç¨‹åºåˆ†é…ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¯”å¦‚è¯´æŸç”¨æˆ·éœ€è¦1GBçš„å†…å­˜ç©ºé—´ï¼Œå®ƒå°±åœ¨å†…å­˜ç©ºé—´ä¸­åˆ†é…ä¸€å—è¿ç»­çš„1GBçš„ç©ºé—´ç»™ç”¨æˆ·ã€‚å®ƒä¸»è¦åŒ…æ‹¬å•ä¸€è¿ç»­åˆ†é…/å›ºå®šåˆ†åŒºåˆ†é…å’ŒåŠ¨æ€åˆ†åŒºåˆ†</p><p><strong>å•ä¸€è¿ç»­åˆ†é…</strong></p><p>å†…å­˜åœ¨æ­¤æ–¹å¼ä¸‹åˆ†ä¸ºç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºï¼Œç³»ç»ŸåŒºä»…æä¾›ç»™æ“ä½œç³»ç»Ÿä½¿ç”¨ï¼Œé€šå¸¸åœ¨ä½åœ°å€éƒ¨åˆ†.ç”¨æˆ·åŒºæ˜¯ä¸ºç”¨æˆ·æä¾›çš„ã€é™¤ç³»ç»ŸåŒºä¹‹å¤–çš„å†…å­˜ç©ºé—´ã€‚è¿™ç§æ–¹å¼æ— éœ€è¿›è¡Œå†…å­˜ä¿æŠ¤ã€‚å› ä¸ºå†…å­˜ä¸­æ°¸è¿œåªæœ‰ä¸€é“ç¨‹åºï¼Œè‚¯å®šä¸ä¼šå› ä¸ºè®¿é—®è¶Šç•Œè€Œå¹²æ‰°å…¶ä»–ç¨‹åºã€‚</p><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ã€æ— å¤–éƒ¨ç¢ç‰‡ï¼Œå¯ä»¥é‡‡ç”¨è¦†ç›–æŠ€æœ¯ï¼Œä¸éœ€è¦é¢å¤–çš„æŠ€æœ¯æ”¯æŒã€‚ç¼ºç‚¹æ˜¯åªèƒ½ç”¨äºå•ç”¨æˆ·ã€å•ä»»åŠ¡çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œæœ‰å†…éƒ¨ç¢ç‰‡ï¼Œå­˜å‚¨å™¨çš„åˆ©ç”¨ç‡æä½</p><p><strong>å›ºå®šåˆ†åŒºåˆ†é…</strong></p><p>å›ºå®šåˆ†åŒºåˆ†é…æ˜¯æœ€ç®€å•çš„ä¸€ç§å¤šé“ç¨‹åºå­˜å‚¨ç®¡ç†æ–¹å¼ï¼Œå®ƒå°†ç”¨æˆ·å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„åŒºåŸŸï¼Œæ¯ä¸ªåˆ†åŒºåªè£…å…¥ä¸€é“ä½œä¸šã€‚å½“æœ‰ç©ºé—²åˆ†åŒºæ—¶ï¼Œä¾¿å¯ä»¥å†ä»å¤–å­˜çš„åå¤‡ä½œä¸šé˜Ÿåˆ—ä¸­ï¼Œé€‰æ‹©é€‚å½“å¤§å°çš„ä½œä¸šè£…å…¥è¯¥åˆ†åŒºï¼Œå¦‚æ­¤å¾ªç¯å›ºå®šåˆ†åŒºåˆ†é…åœ¨åˆ’åˆ†åˆ†åŒºæ—¶ï¼Œæœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•ï¼Œå¦‚å›¾3-4æ‰€ç¤º</p><p><img src="https://img-blog.csdnimg.cn/20200604134943455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>åˆ†åŒºå¤§å°ç›¸ç­‰</code>ï¼šç”¨äºåˆ©ç”¨ä¸€å°è®¡ç®—æœºå»æ§åˆ¶å¤šä¸ªç›¸åŒå¯¹è±¡çš„åœºåˆï¼Œç¼ºä¹çµæ´»æ€§</p><p><code>åˆ†åŒºå¤§å°ä¸ç­‰</code>ï¼šåˆ’åˆ†ä¸ºå«æœ‰å¤šä¸ªè¾ƒå°çš„åˆ†åŒºã€é€‚é‡çš„ä¸­ç­‰åˆ†åŒºåŠå°‘é‡çš„å¤§åˆ†åŒºã€‚</p><p>ä¸ºä¾¿äºå†…å­˜åˆ†é…ï¼Œé€šå¸¸å°†åˆ†åŒºæŒ‰å¤§å°æ’é˜Ÿï¼Œå¹¶ä¸ºä¹‹å»ºç«‹ä¸€å¼ åˆ†åŒºè¯´æ˜è¡¨ï¼Œå…¶ä¸­å„è¡¨é¡¹åŒ…æ‹¬æ¯ä¸ªåˆ†åŒºçš„èµ·å§‹åœ°å€ã€å¤§å°åŠçŠ¶æ€ï¼ˆæ˜¯å¦å·²åˆ†é…ï¼‰ï¼Œå¦‚å›¾3-5ï¼ˆaï¼‰æ‰€ç¤ºã€‚å½“æœ‰ç”¨æˆ·ç¨‹åºè¦è£…å…¥æ—¶ï¼Œä¾¿æ£€ç´¢è¯¥è¡¨ï¼Œä»¥æ‰¾åˆ°åˆé€‚çš„åˆ†åŒºç»™äºˆåˆ†é…å¹¶å°†å…¶çŠ¶æ€ç½®ä¸ºâ€œå·²åˆ†é…â€,æœªæ‰¾åˆ°åˆé€‚åˆ†åŒºåˆ™æ‹’ç»ä¸ºè¯¥ç”¨æˆ·ç¨‹åºåˆ†é…å†…å­˜ã€‚å­˜å‚¨ç©ºé—´çš„åˆ†é…æƒ…å†µå¦‚å›¾3-5ï¼ˆbï¼‰æ‰€ç¤º</p><p><strong>è¿™ç§åˆ†åŒºæ–¹å¼å­˜åœ¨ä¸¤ä¸ªé—®é¢˜</strong>ï¼šä¸€æ˜¯ç¨‹åºå¯èƒ½å¤ªå¤§è€Œæ”¾ä¸è¿›ä»»ä½•ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œè¿™æ—¶ç”¨æˆ·ä¸å¾—ä¸ä½¿ç”¨è¦†ç›–æŠ€æœ¯æ¥ä½¿ç”¨å†…å­˜ç©ºé—´ï¼šäºŒæ˜¯ä¸»å­˜åˆ©ç”¨ç‡ä½ï¼Œå½“ç¨‹åºå°äºå›ºå®šåˆ†åŒºå¤§å°æ—¶ï¼Œä¹Ÿå ç”¨äº†ä¸€ä¸ªå®Œæ•´çš„å†…å­˜åˆ†åŒºç©ºé—´ï¼Œè¿™æ ·åˆ†åŒºå†…éƒ¨æœ‰ç©ºé—´æµªè´¹ï¼Œè¿™ç§ç°è±¡ç§°ä¸ºå†…éƒ¨ç¢ç‰‡ã€‚</p><p>å›ºå®šåˆ†åŒºæ˜¯å¯ç”¨äºå¤šé“ç¨‹åºè®¾è®¡æœ€ç®€å•çš„å­˜å‚¨åˆ†é…ï¼Œæ— å¤–éƒ¨ç¢ç‰‡ï¼Œä½†ä¸èƒ½å®ç°å¤šè¿›ç¨‹å…±äº«ä¸€ä¸ªä¸»å­˜åŒºï¼Œæ‰€ä»¥å­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡ä½ã€‚å›ºå®šåˆ†åŒºåˆ†é…å¾ˆå°‘ç”¨äºç°åœ¨é€šç”¨çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œä½†åœ¨æŸäº›ç”¨äºæ§åˆ¶å¤šä¸ªç›¸åŒå¯¹è±¡çš„æ§åˆ¶ç³»ç»Ÿä¸­ä»å‘æŒ¥ç€ä¸€å®šçš„ä½œç”¨ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200604135858857.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-4-åŠ¨æ€åˆ†åŒºåˆ†é…"><a href="#1-4-åŠ¨æ€åˆ†åŒºåˆ†é…" class="headerlink" title="1.4 åŠ¨æ€åˆ†åŒºåˆ†é…"></a>1.4 åŠ¨æ€åˆ†åŒºåˆ†é…</h2><p><img src="https://img-blog.csdnimg.cn/2020070509353090.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>åŠ¨æ€åˆ†åŒºåˆ†é…åˆç§°ä¸ºå¯å˜åˆ†åŒºåˆ†é…</code>ï¼Œæ˜¯ä¸€ç§åŠ¨æ€åˆ’åˆ†å†…å­˜çš„åˆ†åŒºæ–¹æ³•ã€‚è¿™ç§åˆ†åŒºæ–¹æ³•ä¸é¢„å…ˆå°†å†…å­˜åˆ’åˆ†ï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹è£…å…¥å†…å­˜æ—¶ï¼Œæ ¹æ®è¿›ç¨‹çš„å¤§å°åŠ¨æ€åœ°å»ºç«‹åˆ†åŒºï¼Œå¹¶ä½¿åˆ†åŒºçš„å¤§å°æ­£å¥½é€‚åˆè¿›ç¨‹çš„éœ€è¦ã€‚å› æ­¤ç³»ç»Ÿä¸­åˆ†åŒºçš„å¤§å°å’Œæ•°ç›®æ˜¯å¯å˜çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2020060414101810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç³»ç»Ÿæœ‰64MBå†…å­˜ç©ºé—´ï¼Œå…¶ä¸­ä½8MBå›ºå®šåˆ†é…ç»™æ“ä½œç³»ç»Ÿï¼Œå…¶ä½™ä¸ºç”¨æˆ·å¯ç”¨å†…å­˜ã€‚å¼€å§‹æ—¶è£…å…¥å‰ä¸‰ä¸ªè¿›ç¨‹ï¼Œåœ¨å®ƒä»¬åˆ†åˆ«åˆ†é…åˆ°æ‰€éœ€ç©ºé—´åï¼Œå†…å­˜åªå‰©ä¸‹4MBï¼Œè¿›ç¨‹4æ— æ³•è£…å…¥ã€‚åœ¨æŸä¸ªæ—¶åˆ»ï¼Œå†…å­˜ä¸­æ²¡æœ‰ä¸€ä¸ªå°±ç»ªè¿›ç¨‹ï¼ŒCPUå‡ºç°ç©ºé—²ï¼Œæ“ä½œç³»ç»Ÿå°±æ¢å‡ºè¿›ç¨‹2ï¼Œæ¢å…¥è¿›ç¨‹4.ç”±äºè¿›ç¨‹4æ¯”è¿›ç¨‹2å°ï¼Œè¿™æ ·åœ¨ä¸»å­˜ä¸­å°±äº§ç”Ÿäº†ä¸€ä¸ª6MBçš„å†…å­˜å—ã€‚ä¹‹åCPUåˆå‡ºç°ç©ºé—²ï¼Œè€Œä¸»å­˜æ— æ³•å®¹çº³è¿›ç¨‹2ï¼Œæ“ä½œç³»ç»Ÿå°±æ¢å‡ºè¿›ç¨‹1ï¼Œæ¢å…¥è¿›ç¨‹2.</p><p>åŠ¨æ€åˆ†åŒºåœ¨å¼€å§‹åˆ†é…æ—¶æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯ä¹‹åä¼šå¯¼è‡´å†…å­˜ä¸­å‡ºç°è®¸å¤šå°çš„å†…å­˜å—ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†…å­˜ä¸­ä¼šäº§ç”Ÿè¶Šæ¥è¶Šå¤šçš„ç¢ç‰‡ï¼ˆå›¾3-6ä¸­æœ€åçš„4MBå’Œä¸­é—´çš„6MBï¼Œä¸”éšç€è¿›ç¨‹çš„æ¢å…¥æ¢å‡º,å¾ˆå¯èƒ½ä¼šå‡ºç°æ›´å¤šæ›´å°çš„å†…å­˜å—ï¼‰ï¼Œå†…å­˜çš„åˆ©ç”¨ç‡éšä¹‹ä¸‹é™ã€‚è¿™äº›å°çš„å†…å­˜å—ç§°ä¸ºå¤–éƒ¨ç¢ç‰‡ï¼ŒæŒ‡åœ¨æ‰€æœ‰åˆ†åŒºå¤–çš„å­˜å‚¨ç©ºé—´ä¼šå˜æˆè¶Šæ¥è¶Šå¤šçš„ç¢ç‰‡ï¼Œè¿™ä¸å›ºå®šåˆ†åŒºä¸­çš„å†…éƒ¨ç¢ç‰‡æ­£å¥½ç›¸å¯¹ã€‚å…‹æœå¤–éƒ¨ç¢ç‰‡å¯ä»¥é€šè¿‡ç´§å‡‘ï¼ˆ Compactionï¼‰æŠ€æœ¯æ¥è§£å†³ï¼Œå°±æ˜¯æ“ä½œç³»ç»Ÿä¸æ—¶åœ°å¯¹è¿›ç¨‹è¿›è¡Œç§»åŠ¨å’Œæ•´ç†</p><p>ä½†æ˜¯è¿™éœ€è¦åŠ¨æ€é‡å®šä½å¯„å­˜å™¨çš„æ”¯æŒï¼Œä¸”ç›¸å¯¹è´¹æ—¶ã€‚ç´§å‡‘çš„è¿‡ç¨‹å®é™…ä¸Šç±»ä¼¼äº Windowsç³»ç»Ÿä¸­çš„ç£ç›˜æ•´ç†ç¨‹åºï¼Œåªä¸è¿‡åè€…æ˜¯å¯¹å¤–å­˜ç©ºé—´çš„ç´§å‡‘.<br>åœ¨è¿›ç¨‹è£…å…¥æˆ–æ¢å…¥ä¸»å­˜æ—¶ï¼Œå¦‚æœå†…å­˜ä¸­æœ‰å¤šä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²å—ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ç¡®å®šåˆ†é…å“ªä¸ªå†…å­˜å—ç»™è¿›ç¨‹ä½¿ç”¨ï¼Œè¿™å°±æ˜¯åŠ¨æ€åˆ†åŒºçš„åˆ†é…ç­–ç•¥ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ç§ç®—æ³•</p><p>1ï¼‰<code>é¦–æ¬¡é€‚åº”ï¼ˆ First Fitï¼‰ç®—æ³•</code>ï¼šç©ºé—²åˆ†åŒºä»¥åœ°å€é€’å¢çš„æ¬¡åºé“¾æ¥ã€‚åˆ†é…å†…å­˜æ—¶é¡ºåºæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬ä¸€ä¸ªç©ºé—²åˆ†åŒº<br>2ï¼‰<code>æœ€ä½³é€‚åº”ï¼ˆ Best Fitï¼‰ç®—æ³•</code>ï¼šç©ºé—²åˆ†åŒºæŒ‰å®¹é‡é€’å¢å½¢æˆåˆ†åŒºé“¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³è¦æ±‚çš„ç©ºé—²åˆ†åŒº<br>æœ€åé€‚åº”ï¼ˆ Worst Fitï¼‰ç®—æ³•ï¼šåˆç§°æœ€å¤§é€‚åº”ï¼ˆ Largest Fitï¼‰ç®—æ³•ï¼Œç©ºé—²åˆ†åŒºä»¥å®¹é‡é€’å‡çš„æ¬¡åºé“¾æ¥ã€‚æ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³è¦æ±‚çš„ç©ºé—²åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯æŒ‘é€‰å‡ºæœ€å¤§çš„åˆ†åŒº<br>3ï¼‰<code>é‚»è¿‘é€‚åº”ï¼ˆ Next Fitï¼‰ç®—æ³•</code>ï¼šåˆç§°å¾ªç¯é¦–æ¬¡é€‚åº”ç®—æ³•ï¼Œç”±é¦–æ¬¡é€‚åº”ç®—æ³•æ¼”å˜è€Œæˆã€‚ä¸åŒä¹‹å¤„æ˜¯åˆ†é…å†…å­˜æ—¶ä»ä¸Šæ¬¡æŸ¥æ‰¾ç»“æŸçš„ä½ç½®å¼€å§‹ç»§ç»­æŸ¥æ‰¾</p><p>åœ¨è¿™å‡ ç§æ–¹æ³•ä¸­ï¼Œé¦–æ¬¡é€‚åº”ç®—æ³•ä¸ä»…æ˜¯æœ€ç®€å•çš„ï¼Œè€Œä¸”é€šå¸¸ä¹Ÿæ˜¯æœ€å¥½å’Œæœ€å¿«çš„ã€‚åœ¨UNIXç³»ç»Ÿçš„æœ€åˆç‰ˆæœ¬ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨é¦–æ¬¡é€‚åº”ç®—æ³•ä¸ºè¿›ç¨‹åˆ†é…å†…å­˜ç©ºé—´ï¼Œå…¶ä¸­ä½¿ç”¨æ•°ç»„çš„æ•°æ®ç»“æ„ï¼ˆè€Œéé“¾è¡¨ï¼‰æ¥å®ç°ã€‚ä¸è¿‡ï¼Œé¦–æ¬¡é€‚åº”ç®—æ³•ä¼šä½¿å¾—å†…å­˜çš„ä½åœ°å€éƒ¨åˆ†å‡ºç°å¾ˆå¤šå°çš„ç©ºé—²åˆ†åŒº,è€Œæ¯æ¬¡åˆ†é…æŸ¥æ‰¾æ—¶ï¼Œéƒ½è¦ç»è¿‡è¿™äº›åˆ†åŒºï¼Œå› æ­¤ä¹Ÿå¢åŠ äº†æŸ¥æ‰¾çš„å¼€é”€</p><p>é‚»è¿‘é€‚åº”ç®—æ³•è¯•å›¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒå¸¸å¸¸ä¼šå¯¼è‡´åœ¨å†…å­˜çš„æœ«å°¾åˆ†é…ç©ºé—´ï¼ˆå› ä¸ºåœ¨éæ‰«æä¸­ï¼Œå†…å­˜å‰é¢éƒ¨åˆ†ä½¿ç”¨åå†é‡Šæ”¾æ—¶ï¼Œä¸ä¼šå‚ä¸åˆ†é…ï¼‰ï¼Œåˆ†è£‚æˆå°ç¢ç‰‡ã€‚å®ƒé€šå¸¸æ¯”é¦–æ¬¡é€‚åº”ç®—æ³•çš„ç»“æœè¦å·®</p><p>æœ€ä½³é€‚åº”ç®—æ³•è™½ç„¶ç§°ä¸ºâ€œæœ€ä½³â€ï¼Œä½†æ˜¯æ€§èƒ½é€šå¸¸å¾ˆå·®ï¼Œå› ä¸ºæ¯æ¬¡æœ€ä½³çš„åˆ†é…ä¼šç•™ä¸‹å¾ˆå°çš„éš¾ä»¥åˆ©ç”¨çš„å†…å­˜å—ï¼Œå®ƒä¼šäº§ç”Ÿæœ€å¤šçš„å¤–éƒ¨ç¢ç‰‡</p><p>æœ€åé€‚åº”ç®—æ³•ä¸æœ€ä½³é€‚åº”ç®—æ³•ç›¸åï¼Œé€‰æ‹©æœ€å¤§çš„å¯ç”¨å—ï¼Œè¿™çœ‹èµ·æ¥æœ€ä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼Œä½†æ˜¯å´æŠŠæœ€å¤§çš„è¿ç»­å†…å­˜åˆ’åˆ†å¼€ï¼Œä¼šå¾ˆå¿«å¯¼è‡´æ²¡æœ‰å¯ç”¨çš„å¤§çš„å†…å­˜å—ï¼Œå› æ­¤æ€§èƒ½ä¹Ÿéå¸¸å·®</p><p>Knuthå’ŒShoreåˆ†åˆ«å°±å‰ä¸‰ç§æ–¹æ³•å¯¹å†…å­˜ç©ºé—´çš„åˆ©ç”¨æƒ…å†µåšäº†æ¨¡æ‹Ÿå®éªŒï¼Œç»“æœè¡¨æ˜é¦–æ¬¡é€‚åº”ç®—æ³•å¯èƒ½æ¯”æœ€ä½³é€‚åº”æ³•æ•ˆæœå¥½ï¼Œè€Œå®ƒä»¬ä¸¤è€…ä¸€å®šæ¯”æœ€å¤§é€‚åº”æ³•æ•ˆæœå¥½ã€‚å¦å¤–æ³¨æ„ï¼Œåœ¨ç®—æ³•å®ç°æ—¶ï¼Œåˆ†é…æ“ä½œä¸­æœ€ä½³é€‚åº”æ³•å’Œæœ€å¤§é€‚åº”æ³•éœ€è¦å¯¹å¯ç”¨å—è¿›è¡Œæ’åºæˆ–éå†æŸ¥æ‰¾ï¼Œè€Œé¦–æ¬¡é€‚åº”æ³•å’Œé‚»è¿‘é€‚åº”æ³•åªéœ€è¦ç®€å•æŸ¥æ‰¾ï¼šå›æ”¶æ“ä½œä¸­ï¼Œå½“å›æ”¶çš„å—ä¸åŸæ¥çš„ç©ºé—²å—ç›¸é‚»æ—¶ï¼ˆæœ‰ä¸‰ç§ç›¸é‚»çš„æƒ…å†µï¼Œæ¯”è¾ƒå¤æ‚ï¼‰ï¼Œéœ€è¦å°†è¿™äº›å—åˆå¹¶ã€‚åœ¨ç®—æ³•å®ç°æ—¶ï¼Œä½¿ç”¨æ•°ç»„æˆ–é“¾è¡¨è¿›è¡Œç®¡ç†ã€‚é™¤äº†å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œè¿™é‡Œçš„ç®—æ³•å¼€é”€ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿè®¾è®¡éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ </p><p><img src="https://img-blog.csdnimg.cn/2020060414223979.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-5-åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-5-åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.5 åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ"></a>1.5 åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ</h2><p><img src="https://img-blog.csdnimg.cn/20200705144615215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</strong></p><p>éè¿ç»­åˆ†é…å…è®¸ä¸€ä¸ªç¨‹åºåˆ†æ•£åœ°è£…å…¥åˆ°ä¸ç›¸é‚»çš„å†…å­˜åˆ†åŒºä¸­ã€‚åœ¨è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ä¸­æˆ‘ä»¬å‘ç°ï¼Œå³ä½¿å†…å­˜æœ‰è¶…è¿‡1GBçš„ç©ºé—²ç©ºé—´ï¼Œä½†å¦‚æœæ²¡æœ‰è¿ç»­çš„1GBçš„ç©ºé—´ï¼Œéœ€è¦1GBç©ºé—´çš„ä½œä¸šä»ç„¶æ˜¯æ— æ³•è¿è¡Œçš„ï¼›ä½†å¦‚æœé‡‡ç”¨éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ï¼Œä½œä¸šæ‰€è¦æ±‚çš„1GBå†…å­˜ç©ºé—´å¯ä»¥åˆ†æ•£åœ°åˆ†é…åœ¨å†…å­˜çš„å„ä¸ªåŒºåŸŸï¼Œå½“ç„¶ï¼Œè¿™ä¹Ÿéœ€è¦é¢å¤–çš„ç©ºé—´å»å­˜å‚¨å®ƒä»¬ï¼ˆåˆ†æ•£åŒºåŸŸï¼‰çš„ç´¢å¼•ï¼Œä½¿å¾—éè¿ç»­åˆ†é…æ–¹å¼çš„å­˜å‚¨å¯†åº¦ä½äºè¿ç»­å­˜å‚¨æ–¹å¼</p><p>éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼æ ¹æ®åˆ†åŒºçš„å¤§å°æ˜¯å¦å›ºå®šåˆ†ä¸ºåˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼å’Œåˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼ä¸­ï¼Œåˆæ ¹æ®è¿è¡Œä½œä¸šæ—¶æ˜¯å¦è¦æŠŠä½œä¸šçš„æ‰€æœ‰é¡µé¢éƒ½è£…å…¥å†…å­˜æ‰èƒ½è¿è¡Œåˆ†ä¸ºåŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼å’Œè¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼ã€‚ä¸‹é¢ä»‹ç»åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼ã€‚</p><p><strong>åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼</strong></p><p>å›ºå®šåˆ†åŒºä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ï¼ŒåŠ¨æ€åˆ†åŒºä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼Œè¿™ä¸¤ç§æŠ€æœ¯å¯¹å†…å­˜çš„åˆ©ç”¨ç‡éƒ½æ¯”è¾ƒä½.æˆ‘ä»¬å¸Œæœ›å†…å­˜çš„ä½¿ç”¨èƒ½å°½é‡é¿å…ç¢ç‰‡çš„äº§ç”Ÿï¼Œè¿™å°±å¼•å…¥äº†åˆ†é¡µçš„æ€æƒ³ï¼šæŠŠä¸»å­˜ç©ºé—´åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰ä¸”å›ºå®šçš„å—ï¼Œå—ç›¸å¯¹è¾ƒå°ï¼Œä½œä¸ºä¸»å­˜çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªè¿›ç¨‹ä¹Ÿä»¥å—ä¸ºå•ä½è¿›è¡Œåˆ’åˆ†ï¼Œè¿›ç¨‹åœ¨æ‰§è¡Œæ—¶ï¼Œä»¥å—ä¸ºå•ä½é€ä¸ªç”³è¯·ä¸»å­˜ä¸­çš„å—ç©ºé—´ã€‚åˆ†é¡µçš„æ–¹æ³•ä»å½¢å¼ä¸Šçœ‹ï¼Œåƒåˆ†åŒºç›¸ç­‰çš„å›ºå®šåˆ†åŒºæŠ€æœ¯ï¼Œåˆ†é¡µç®¡ç†ä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ã€‚ä½†å®ƒåˆæœ‰æœ¬è´¨çš„ä¸åŒç‚¹ï¼šå—çš„å¤§å°ç›¸å¯¹åˆ†åŒºè¦å°å¾ˆå¤šï¼Œè€Œä¸”è¿›ç¨‹ä¹ŸæŒ‰ç…§å—è¿›è¡Œåˆ’åˆ†ï¼Œè¿›ç¨‹è¿è¡Œæ—¶æŒ‰å—ç”³è¯·ä¸»å­˜å¯ç”¨ç©ºé—´å¹¶æ‰§è¡Œã€‚è¿™æ ·ï¼Œè¿›ç¨‹åªä¼šåœ¨ä¸ºæœ€åä¸€ä¸ªä¸å®Œæ•´çš„å—ç”³è¯·ä¸€ä¸ªä¸»å­˜å—ç©ºé—´æ—¶ï¼Œæ‰ç”Ÿæˆä¸»å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥å°½ç®¡ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ï¼Œä½†æ˜¯è¿™ç§ç¢ç‰‡ç›¸å¯¹äºè¿›ç¨‹æ¥è¯´ä¹Ÿæ˜¯å¾ˆå°çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å¹³<br>å‡åªäº§ç”ŸåŠä¸ªå—å¤§å°çš„å†…éƒ¨ç¢ç‰‡ï¼ˆä¹Ÿç§°é¡µå†…ç¢ç‰‡ï¼‰.</p><p><img src="https://img-blog.csdnimg.cn/20200604144448210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604150239308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>*<img src="https://img-blog.csdnimg.cn/20200604150407527.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åŠ ç²—æ ·å¼"></p><h2 id="1-6-åŸºæœ¬åœ°å€å˜æ¢æœºæ„"><a href="#1-6-åŸºæœ¬åœ°å€å˜æ¢æœºæ„" class="headerlink" title="1.6 åŸºæœ¬åœ°å€å˜æ¢æœºæ„"></a>1.6 åŸºæœ¬åœ°å€å˜æ¢æœºæ„</h2><p><img src="https://img-blog.csdnimg.cn/20200705161226230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604152256836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604154934221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-7-å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢æœºæ„"><a href="#1-7-å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢æœºæ„" class="headerlink" title="1.7 å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢æœºæ„"></a>1.7 å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢æœºæ„</h2><p><img src="https://img-blog.csdnimg.cn/20200604155151158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604155409990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åŠ ç²—æ ·å¼"><br><img src="https://img-blog.csdnimg.cn/20200705162805426.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-8-ä¸¤çº§é¡µè¡¨"><a href="#1-8-ä¸¤çº§é¡µè¡¨" class="headerlink" title="1.8 ä¸¤çº§é¡µè¡¨"></a>1.8 ä¸¤çº§é¡µè¡¨</h2><p><img src="https://img-blog.csdnimg.cn/20200604155533303.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604155611809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/202007051653310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-9-åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼"><a href="#1-9-åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼" class="headerlink" title="1.9 åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼"></a>1.9 åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼</h2><p><img src="https://img-blog.csdnimg.cn/2020060416083722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604160902726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604161001886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200705171647698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-10-æ®µé¡µå¼ç®¡ç†æ–¹å¼"><a href="#1-10-æ®µé¡µå¼ç®¡ç†æ–¹å¼" class="headerlink" title="1.10 æ®µé¡µå¼ç®¡ç†æ–¹å¼"></a>1.10 æ®µé¡µå¼ç®¡ç†æ–¹å¼</h2><p><img src="https://img-blog.csdnimg.cn/20200604161136560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200604161206254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200705175323749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-11-è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-11-è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.11 è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ¦‚å¿µ"></a>1.11 è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ¦‚å¿µ</h2><p><strong>ä¼ ç»Ÿå­˜å‚¨ç®¡ç†æ–¹å¼çš„ç‰¹å¾</strong></p><p>1ï¼‰æ—¶é—´å±€éƒ¨æ€§<br>2ï¼‰ç©ºé—´å±€éƒ¨æ€§</p><p><strong>è™šæ‹Ÿå­˜å‚¨å™¨çš„å®šä¹‰å’Œç‰¹å¾</strong></p><p>1ï¼‰å¤šæ¬¡æ€§ï¼Œæ˜¯æŒ‡æ— éœ€åœ¨ä½œä¸šè¿è¡Œæ—¶ä¸€æ¬¡æ€§åœ°å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œè€Œæ˜¯å…è®¸è¢«åˆ†æˆå¤šæ¬¡è°ƒå…¥å†…å­˜<br>2ï¼‰å¯¹æ¢æ€§ï¼Œæ˜¯æŒ‡æ— éœ€åœ¨ä½œä¸šè¿è¡Œæ—¶ä¸€ç›´å¸¸é©»å†…å­˜ï¼Œè€Œæ˜¯å…è®¸åœ¨ä½œä¸šçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œæ¢è¿›å’Œæ¢å‡ºã€‚<br>3ï¼‰è™šæ‹Ÿæ€§ï¼Œæ˜¯æŒ‡ä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜çš„å®¹é‡ï¼Œä½¿ç”¨æˆ·æ‰€çœ‹åˆ°çš„å†…å­˜å®¹é‡ï¼Œè¿œå¤§äºå®é™…çš„å†…å­˜å®¹é‡ã€‚</p><p><strong>è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„å®ç°</strong></p><p>è™šæ‹Ÿå†…å­˜çš„å®ç°æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼</p><p><code>è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç† è¯·æ±‚åˆ†æ®µå­˜å‚¨ç®¡ç† è¯·æ±‚æ®µé¡µå¼å­˜å‚¨ç®¡ç†</code></p><p>ä¸ç®¡å“ªç§æ–¹å¼ï¼Œéƒ½éœ€è¦æœ‰ä¸€å®šçš„ç¡¬ä»¶æ”¯æŒã€‚ä¸€èˆ¬éœ€è¦çš„æ”¯æŒæœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢</p><ul><li>å®šå®¹é‡çš„å†…å­˜å’Œå¤–å­˜</li><li>é¡µè¡¨æœºåˆ¶ï¼ˆæˆ–æ®µè¡¨æœºåˆ¶ï¼‰ï¼Œä½œä¸ºä¸»è¦çš„æ•°æ®ç»“æ„</li><li>ä¸­æ–­æœºæ„ï¼Œå½“ç”¨æˆ·ç¨‹åºè¦è®¿é—®çš„éƒ¨åˆ†å°šæœªè°ƒå…¥å†…å­˜ï¼Œåˆ™äº§ç”Ÿä¸­æ–­</li><li>åœ°å€å˜æ¢æœºæ„ï¼Œé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„å˜æ¢</li></ul><p><img src="https://img-blog.csdnimg.cn/20200705182312176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-12-è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼"><a href="#1-12-è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼" class="headerlink" title="1.12 è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼"></a>1.12 è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼</h2><p><img src="https://img-blog.csdnimg.cn/20200705184734624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-13-é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå†³å®šåº”è¯¥æ¢å…¥å“ªé¡µæ¢å‡ºå“ªé¡µï¼‰"><a href="#1-13-é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå†³å®šåº”è¯¥æ¢å…¥å“ªé¡µæ¢å‡ºå“ªé¡µï¼‰" class="headerlink" title="1.13 é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå†³å®šåº”è¯¥æ¢å…¥å“ªé¡µæ¢å‡ºå“ªé¡µï¼‰"></a>1.13 é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå†³å®šåº”è¯¥æ¢å…¥å“ªé¡µæ¢å‡ºå“ªé¡µï¼‰</h2><p><img src="https://img-blog.csdnimg.cn/20200705195258840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200710184701146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200710184719340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/20200710184731447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200710184747935.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-14-é¡µé¢åˆ†é…ç­–ç•¥"><a href="#1-14-é¡µé¢åˆ†é…ç­–ç•¥" class="headerlink" title="1.14 é¡µé¢åˆ†é…ç­–ç•¥"></a>1.14 é¡µé¢åˆ†é…ç­–ç•¥</h2><p><img src="https://img-blog.csdnimg.cn/20200705201739116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-15-æŠ–åŠ¨"><a href="#1-15-æŠ–åŠ¨" class="headerlink" title="1.15 æŠ–åŠ¨"></a>1.15 æŠ–åŠ¨</h2><p><img src="https://img-blog.csdnimg.cn/20210221101932861.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-16-å·¥ä½œé›†"><a href="#1-16-å·¥ä½œé›†" class="headerlink" title="1.16 å·¥ä½œé›†"></a>1.16 å·¥ä½œé›†</h2><p><img src="https://img-blog.csdnimg.cn/20210221102019306.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="å››ã€æ–‡ä»¶ç®¡ç†"><a href="#å››ã€æ–‡ä»¶ç®¡ç†" class="headerlink" title="å››ã€æ–‡ä»¶ç®¡ç†"></a>å››ã€æ–‡ä»¶ç®¡ç†</h1><h2 id="1-1-åˆè¯†æ–‡ä»¶ç®¡ç†"><a href="#1-1-åˆè¯†æ–‡ä»¶ç®¡ç†" class="headerlink" title="1.1 åˆè¯†æ–‡ä»¶ç®¡ç†"></a>1.1 åˆè¯†æ–‡ä»¶ç®¡ç†</h2><p><img src="https://img-blog.csdnimg.cn/20210221102430890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ–‡ä»¶</strong>ï¼ˆFileï¼‰æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚æ–‡ä»¶æ˜¯ä»¥è®¡ç®—æœºç¡¬ç›˜ä¸ºè½½ä½“å­˜å‚¨åœ¨è®¡ç®—æœºä¸Šçš„ä¿¡æ¯é›†åˆï¼Œæ–‡ä»¶å¯ä»¥æ˜¯æ–‡æœ¬æ–‡æ¡£ã€å›¾ç‰‡ã€ç¨‹åºï¼Œç­‰ç­‰ã€‚</p><p>1ï¼‰æ•°æ®é¡¹ã€‚æ•°æ®é¡¹æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­æœ€ä½çº§çš„æ•°æ®ç»„ç»‡å½¢å¼ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ç±»å‹ï¼š<br>åŸºæœ¬æ•°æ®é¡¹ï¼šç”¨äºæè¿°ä¸€ä¸ªå¯¹è±¡çš„æŸç§å±æ€§çš„ä¸€ä¸ªå€¼ï¼Œå¦‚å§“åã€æ—¥æœŸæˆ–è¯ä»¶å·ç­‰ï¼Œæ˜¯æ•°æ®ä¸­å¯å‘½åçš„æœ€å°é€»è¾‘æ•°æ®å•ä½ï¼Œå³åŸå­æ•°æ®<br>ç»„åˆæ•°æ®é¡¹ï¼šç”±å¤šä¸ªåŸºæœ¬æ•°æ®é¡¹ç»„æˆã€‚<br>2ï¼‰è®°å½•ã€‚è®°å½•æ˜¯ä¸€ç»„ç›¸å…³çš„æ•°æ®é¡¹çš„é›†åˆï¼Œç”¨äºæè¿°ä¸€ä¸ªå¯¹è±¡åœ¨æŸæ–¹é¢çš„å±æ€§ï¼Œå¦‚ä¸€ä¸ªè€ƒç”ŸæŠ¥åè®°å½•åŒ…æ‹¬è€ƒç”Ÿå§“åã€å‡ºç”Ÿæ—¥æœŸã€æŠ¥è€ƒå­¦æ ¡ä»£å·ã€èº«ä»½è¯å·ç­‰ä¸€ç³»åˆ—åŸŸ<br>3ï¼‰æ–‡ä»¶ã€‚æ–‡ä»¶æ˜¯æŒ‡ç”±åˆ›å»ºè€…æ‰€å®šä¹‰çš„ä¸€ç»„ç›¸å…³ä¿¡æ¯çš„é›†åˆï¼Œé€»è¾‘ä¸Šå¯åˆ†ä¸ºæœ‰ç»“æ„æ–‡ä»¶å’Œæ— ç»“æ„æ–‡ä»¶ä¸¤ç§ã€‚åœ¨æœ‰ç»“æ„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ç”±ä¸€ç»„ç›¸ä¼¼è®°å½•ç»„æˆï¼Œå¦‚æŠ¥è€ƒæŸå­¦æ ¡çš„æ‰€æœ‰è€ƒç”Ÿçš„æŠ¥è€ƒä¿¡æ¯è®°å½•ï¼Œåˆç§°è®°å½•å¼æ–‡ä»¶ï¼šè€Œæ— ç»“æ„æ–‡ä»¶åˆ™è¢«çœ‹æˆæ˜¯ä¸€ä¸ªå­—ç¬¦æµï¼Œæ¯”å¦‚ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æˆ–å­—ç¬¦æ–‡ä»¶ï¼Œåˆç§°æµå¼æ–‡ä»¶.</p><p><strong>æ–‡ä»¶çš„å±æ€§</strong></p><p>æ–‡ä»¶æœ‰ä¸€å®šçš„å±æ€§ï¼Œè¿™æ ¹æ®ç³»ç»Ÿçš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯é€šå¸¸éƒ½åŒ…æ‹¬å¦‚ä¸‹å±æ€§ã€‚<br>â‘ åç§°ï¼šæ–‡ä»¶åç§°å”¯ä¸€ï¼Œä»¥å®¹æ˜“è¯»å–çš„å½¢å¼ä¿å­˜<br>â‘¡æ ‡è¯†ç¬¦ï¼šæ ‡è¯†æ–‡ä»¶ç³»ç»Ÿå†…æ–‡ä»¶çš„å”¯ä¸€æ ‡ç­¾ï¼Œé€šå¸¸ä¸ºæ•°å­—ï¼Œå®ƒæ˜¯å¯¹äººä¸å¯è¯»çš„ä¸€ç§å†…éƒ¨åç§°ã€‚<br>â‘¢ç±»å‹ï¼šè¢«æ”¯æŒä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿæ‰€ä½¿ç”¨<br>â‘£ä½ç½®ï¼šæŒ‡å‘è®¾å¤‡å’Œè®¾å¤‡ä¸Šæ–‡ä»¶çš„æŒ‡é’ˆã€‚<br>â‘¤å¤§å°ï¼šæ–‡ä»¶å½“å‰å¤§å°ï¼ˆç”¨å­—èŠ‚ã€å­—æˆ–å—è¡¨ç¤ºï¼‰ï¼Œä¹Ÿå¯åŒ…å«æ–‡ä»¶å…è®¸çš„æœ€å¤§å€¼ã€‚<br>â‘¥ä¿æŠ¤ï¼šå¯¹æ–‡ä»¶è¿›è¡Œä¿æŠ¤çš„è®¿é—®æ§åˆ¶ä¿¡æ¯<br>â‘¦æ—¶é—´ã€æ—¥æœŸå’Œç”¨æˆ·æ ‡è¯†ï¼šæ–‡ä»¶åˆ›å»ºã€ä¸Šæ¬¡ä¿®æ”¹å’Œä¸Šæ¬¡è®¿é—®çš„ç›¸å…³ä¿¡æ¯ï¼Œç”¨äºä¿æŠ¤ã€å®‰å…¨è·Ÿè¸ªæ–‡ä»¶çš„ä½¿ç”¨.<br>æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨ç›®å½•ç»“æ„ä¸­ï¼Œè€Œç›®å½•ç»“æ„ä¹Ÿä¿å­˜åœ¨å¤–å­˜ä¸Šã€‚æ–‡ä»¶ä¿¡æ¯å½“éœ€è¦æ—¶å†è°ƒå…¥å†…å­˜ã€‚é€šå¸¸ï¼Œç›®å½•æ¡ç›®åŒ…æ‹¬æ–‡ä»¶åç§°åŠå…¶å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè€Œæ ‡è¯†ç¬¦å®šä½å…¶ä»–å±æ€§çš„ä¿¡æ¯.</p><p><strong>æ–‡ä»¶çš„åŸºæœ¬æ“ä½œ</strong></p><p>æ–‡ä»¶å±äºæŠ½è±¡æ•°æ®ç±»å‹ã€‚ä¸ºäº†æ°å½“åœ°å®šä¹‰æ–‡ä»¶ï¼Œå°±éœ€è¦è€ƒè™‘æœ‰å…³æ–‡ä»¶çš„æ“ä½œã€‚æ“ä½œç³»ç»Ÿæä¾›ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œåˆ›å»ºã€å†™ã€è¯»ã€å®šä½å’Œæˆªæ–­ã€‚<br>â‘ åˆ›å»ºæ–‡ä»¶ï¼šåˆ›å»ºæ–‡ä»¶æœ‰ä¸¤ä¸ªå¿…è¦æ­¥éª¤ï¼Œä¸€æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¸ºæ–‡ä»¶æ‰¾åˆ°ç©ºé—´ï¼šäºŒæ˜¯åœ¨ç›®å½•ä¸­ä¸ºæ–°æ–‡ä»¶åˆ›å»ºæ¡ç›®ï¼Œè¯¥æ¡ç›®è®°å½•æ–‡ä»¶åç§°ã€åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®åŠå…¶ä»–å¯èƒ½ä¿¡æ¯<br>â‘¡å†™æ–‡ä»¶ï¼šä¸ºäº†å†™æ–‡ä»¶ï¼Œæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ŒæŒ‡æ˜æ–‡ä»¶åç§°å’Œè¦å†™å…¥æ–‡ä»¶çš„å†…å®¹ã€‚å¯¹äºç»™å®šæ–‡ä»¶åç§°ï¼Œç³»ç»Ÿæœç´¢ç›®å½•ä»¥æŸ¥æ‰¾æ–‡ä»¶ä½ç½®ã€‚ç³»ç»Ÿå¿…é¡»ä¸ºè¯¥æ–‡ä»¶ç»´æŠ¤ä¸€ä¸ªå†™ä½ç½®çš„æŒ‡é’ˆã€‚æ¯å½“å‘ç”Ÿå†™æ“ä½œï¼Œä¾¿æ›´æ–°å†™æŒ‡é’ˆ<br>â‘¢è¯»æ–‡ä»¶ï¼šä¸ºäº†è¯»æ–‡ä»¶ï¼Œæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ŒæŒ‡æ˜æ–‡ä»¶åç§°å’Œè¦è¯»å…¥æ–‡ä»¶å—çš„å†…å­˜ä½ç½®ã€‚<br>åŒæ ·ï¼Œéœ€è¦æœç´¢ç›®å½•ä»¥æ‰¾åˆ°ç›¸å…³ç›®å½•é¡¹ï¼Œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªè¯»ä½ç½®çš„æŒ‡é’ˆã€‚æ¯å½“å‘ç”Ÿè¯»æ“ä½œæ—¶ï¼Œæ›´æ–°è¯»æŒ‡é’ˆã€‚ä¸€ä¸ªè¿›ç¨‹é€šå¸¸åªå¯¹ä¸€ä¸ªæ–‡ä»¶è¯»æˆ–å†™ï¼Œæ‰€ä»¥å½“å‰æ“ä½œä½ç½®å¯ä½œä¸ºæ¯ä¸ªè¿›ç¨‹å½“å‰æ–‡ä»¶ä½ç½®æŒ‡é’ˆã€‚ç”±äºè¯»å’Œå†™æ“ä½œéƒ½ä½¿ç”¨åŒä¸€æŒ‡é’ˆï¼ŒèŠ‚çœäº†ç©ºé—´ä¹Ÿé™ä½äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚<br>â‘£æ–‡ä»¶é‡å®šä½ï¼ˆæ–‡ä»¶å¯»å€ï¼‰ï¼šæŒ‰æŸæ¡ä»¶æœç´¢ç›®å½•ï¼Œå°†å½“å‰æ–‡ä»¶ä½ç½®è®¾ä¸ºç»™å®šå€¼ï¼Œå¹¶ä¸”ä¸ä¼šè¯»å†™æ–‡ä»¶<br>â‘¤åˆ é™¤æ–‡ä»¶ï¼šå…ˆä»ç›®å½•ä¸­æ‰¾åˆ°è¦åˆ é™¤æ–‡ä»¶çš„ç›®å½•é¡¹ï¼Œä½¿ä¹‹æˆä¸ºç©ºé¡¹ï¼Œç„¶åå›æ”¶è¯¥æ–‡ä»¶æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´<br>â‘¥æˆªæ–­æ–‡ä»¶ï¼šå…è®¸æ–‡ä»¶æ‰€æœ‰å±æ€§ä¸å˜ï¼Œå¹¶åˆ é™¤æ–‡ä»¶å†…å®¹ï¼Œå³å°†å…¶é•¿åº¦è®¾ä¸º0å¹¶é‡Šæ”¾å…¶ç©ºé—´<br>è¿™6ä¸ªåŸºæœ¬æ“ä½œå¯ä»¥ç»„åˆæ‰§è¡Œå…¶ä»–æ–‡ä»¶æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶çš„å¤åˆ¶ï¼Œå¯ä»¥åˆ›å»ºæ–°æ–‡ä»¶ã€ä»æ—§æ–‡ä»¶è¯»å‡ºå¹¶å†™å…¥åˆ°æ–°æ–‡ä»¶</p><p><strong>æ–‡ä»¶çš„æ‰“å¼€ä¸å…³é—­</strong></p><h2 id="1-2-æ–‡ä»¶çš„é€»è¾‘ç»“æ„"><a href="#1-2-æ–‡ä»¶çš„é€»è¾‘ç»“æ„" class="headerlink" title="1.2 æ–‡ä»¶çš„é€»è¾‘ç»“æ„"></a>1.2 æ–‡ä»¶çš„é€»è¾‘ç»“æ„</h2><p><img src="https://img-blog.csdnimg.cn/20200704080830897.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŒ‰é€»è¾‘ç»“æ„ï¼Œæ–‡ä»¶æœ‰æ— ç»“æ„æ–‡ä»¶å’Œæœ‰ç»“æ„æ–‡ä»¶ä¸¤ç§ç±»å‹ï¼š<br>1 æ— ç»“æ„æ–‡ä»¶ï¼ˆæµå¼æ–‡ä»¶ï¼‰<br>2.æœ‰ç»“æ„æ–‡ä»¶ï¼ˆè®°å½•å¼æ–‡ä»¶ï¼‰<br>1ï¼‰é¡ºåºæ–‡ä»¶<br>2ï¼‰ç´¢å¼•æ–‡ä»¶<br>3ï¼‰ç´¢å¼•é¡ºåºæ–‡ä»¶æ˜¯é¡ºåºå’Œç´¢å¼•ä¸¤ç§ç»„ç»‡å½¢å¼çš„ç»“åˆ.<br>4ï¼‰ç›´æ¥æ–‡ä»¶æˆ–æ•£åˆ—æ–‡ä»¶ï¼ˆ Hash Fileï¼‰</p><h2 id="1-3-æ–‡ä»¶ç›®å½•"><a href="#1-3-æ–‡ä»¶ç›®å½•" class="headerlink" title="1.3 æ–‡ä»¶ç›®å½•"></a>1.3 æ–‡ä»¶ç›®å½•</h2><p><img src="https://img-blog.csdnimg.cn/20200704083545250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ–‡ä»¶æ§åˆ¶å—å’Œç´¢å¼•ç»“ç‚¹</strong><br>1ï¼‰æ–‡ä»¶æ§åˆ¶å—ã€‚æ–‡ä»¶æ§åˆ¶å—ï¼ˆFCBï¼‰æ˜¯ç”¨æ¥å­˜æ”¾æ§åˆ¶æ–‡ä»¶éœ€è¦çš„å„ç§ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œä»¥å®ç°â€œæŒ‰åå­˜å–â€.FCBçš„æœ‰åºé›†åˆç§°ä¸ºæ–‡ä»¶ç›®å½•ï¼Œä¸€ä¸ªFCBå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ç›®å½•é¡¹ã€‚ä¸ºäº†åˆ›å»ºé…ä¸€ä¸ªFCBå¹¶å­˜æ”¾åœ¨æ–‡ä»¶ç›®å½•ä¸­ï¼Œæˆä¸ºç›®å½•é¡¹</p><p><strong>FCBä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</strong><br>åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶åã€æ–‡ä»¶çš„ç‰©ç†ä½ç½®ã€æ–‡ä»¶çš„é€»è¾‘ç»“æ„ã€æ–‡ä»¶çš„ç‰©ç†ç»“æ„ç­‰ã€‚<br>å­˜å–æ§åˆ¶ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶å­˜å–æƒé™ç­‰<br>ä½¿ç”¨ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶å»ºç«‹æ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰<br>2ï¼‰ç´¢å¼•ç»“ç‚¹</p><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><p><img src="https://img-blog.csdnimg.cn/20200610161755526.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610162141697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610162211853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610162700847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="4ï¼‰æ— ç¯å›¾ç›®å½•ç»“æ„ã€‚"></p><p><img src="https://img-blog.csdnimg.cn/20200704114453333.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-4-æ–‡ä»¶ç‰©ç†ç»“æ„"><a href="#1-4-æ–‡ä»¶ç‰©ç†ç»“æ„" class="headerlink" title="1.4 æ–‡ä»¶ç‰©ç†ç»“æ„"></a>1.4 æ–‡ä»¶ç‰©ç†ç»“æ„</h2><p><img src="https://img-blog.csdnimg.cn/20210221111739893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-4-1-é“¾æ¥åˆ†é…"><a href="#1-4-1-é“¾æ¥åˆ†é…" class="headerlink" title="1.4.1 é“¾æ¥åˆ†é…"></a>1.4.1 é“¾æ¥åˆ†é…</h3><p><img src="https://img-blog.csdnimg.cn/2021022111153759.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="1-4-2-ç´¢å¼•åˆ†é…"><a href="#1-4-2-ç´¢å¼•åˆ†é…" class="headerlink" title="1.4.2 ç´¢å¼•åˆ†é…"></a>1.4.2 ç´¢å¼•åˆ†é…</h3><p><img src="https://img-blog.csdnimg.cn/20210221111647235.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-5-æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†"><a href="#1-5-æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†" class="headerlink" title="1.5 æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†"></a>1.5 æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†</h2><p><img src="https://img-blog.csdnimg.cn/20200704123728867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-6-æ–‡ä»¶çš„åŸºæœ¬æ“ä½œ"><a href="#1-6-æ–‡ä»¶çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="1.6 æ–‡ä»¶çš„åŸºæœ¬æ“ä½œ"></a>1.6 æ–‡ä»¶çš„åŸºæœ¬æ“ä½œ</h2><p><img src="https://img-blog.csdnimg.cn/20200704124644171.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-7-æ–‡ä»¶å…±äº«"><a href="#1-7-æ–‡ä»¶å…±äº«" class="headerlink" title="1.7 æ–‡ä»¶å…±äº«"></a>1.7 æ–‡ä»¶å…±äº«</h2><p><img src="https://img-blog.csdnimg.cn/20200704125140509.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-8-æ–‡ä»¶ä¿æŠ¤"><a href="#1-8-æ–‡ä»¶ä¿æŠ¤" class="headerlink" title="1.8 æ–‡ä»¶ä¿æŠ¤"></a>1.8 æ–‡ä»¶ä¿æŠ¤</h2><p><img src="https://img-blog.csdnimg.cn/20210221112629665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-9-æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„"><a href="#1-9-æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„" class="headerlink" title="1.9 æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„"></a>1.9 æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„</h2><p><img src="https://img-blog.csdnimg.cn/20200704130311622.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200704130352457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610200728418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610200858608.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200610200955594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="äº”ã€ç£ç›˜ç®¡ç†"><a href="#äº”ã€ç£ç›˜ç®¡ç†" class="headerlink" title="äº”ã€ç£ç›˜ç®¡ç†"></a>äº”ã€ç£ç›˜ç®¡ç†</h1><h2 id="1-1-ç£ç›˜çš„ç»“æ„"><a href="#1-1-ç£ç›˜çš„ç»“æ„" class="headerlink" title="1.1 ç£ç›˜çš„ç»“æ„"></a>1.1 ç£ç›˜çš„ç»“æ„</h2><p><img src="https://img-blog.csdnimg.cn/20200704130854420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-2-ç£ç›˜è°ƒåº¦ç®—æ³•"><a href="#1-2-ç£ç›˜è°ƒåº¦ç®—æ³•" class="headerlink" title="1.2 ç£ç›˜è°ƒåº¦ç®—æ³•"></a>1.2 ç£ç›˜è°ƒåº¦ç®—æ³•</h2><p><img src="https://img-blog.csdnimg.cn/20200704133834864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200704133927225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200704134016916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2020070413410374.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200704134142131.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200704134254195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200704134413468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-3-å‡å°‘ç£ç›˜å»¶è¿Ÿæ—¶é—´çš„æ–¹æ³•"><a href="#1-3-å‡å°‘ç£ç›˜å»¶è¿Ÿæ—¶é—´çš„æ–¹æ³•" class="headerlink" title="1.3 å‡å°‘ç£ç›˜å»¶è¿Ÿæ—¶é—´çš„æ–¹æ³•"></a>1.3 å‡å°‘ç£ç›˜å»¶è¿Ÿæ—¶é—´çš„æ–¹æ³•</h2><p><img src="https://img-blog.csdnimg.cn/20200704135844178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="1-4-ç£ç›˜çš„ç®¡ç†"><a href="#1-4-ç£ç›˜çš„ç®¡ç†" class="headerlink" title="1.4 ç£ç›˜çš„ç®¡ç†"></a>1.4 ç£ç›˜çš„ç®¡ç†</h2><p><img src="https://img-blog.csdnimg.cn/20200704142108418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200610215752183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="å…­ã€è®¾å¤‡ç®¡ç†"><a href="#å…­ã€è®¾å¤‡ç®¡ç†" class="headerlink" title="å…­ã€è®¾å¤‡ç®¡ç†"></a>å…­ã€è®¾å¤‡ç®¡ç†</h1><h2 id="è¾“å…¥è¾“å‡ºï¼ˆI-Oï¼‰ç®¡ç†"><a href="#è¾“å…¥è¾“å‡ºï¼ˆI-Oï¼‰ç®¡ç†" class="headerlink" title="è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰ç®¡ç†"></a>è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰ç®¡ç†</h2><h3 id="1-I-Oè®¾å¤‡çš„æ¦‚å¿µå’Œåˆ†ç±»"><a href="#1-I-Oè®¾å¤‡çš„æ¦‚å¿µå’Œåˆ†ç±»" class="headerlink" title="1. I-Oè®¾å¤‡çš„æ¦‚å¿µå’Œåˆ†ç±»"></a>1. I-Oè®¾å¤‡çš„æ¦‚å¿µå’Œåˆ†ç±»</h3><p><img src="https://img-blog.csdnimg.cn/2020070315120126.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æŒ‰ä½¿ç”¨ç‰¹æ€§å¯åˆ†ä¸ºä»¥ä¸‹ç±»å‹</strong><br>1ï¼‰äººæœºäº¤äº’ç±»å¤–éƒ¨è®¾å¤‡ï¼šç”¨äºä¸è®¡ç®—æœºç”¨æˆ·ä¹‹é—´äº¤äº’çš„è®¾å¤‡ï¼Œå¦‚æ‰“å°æœºã€æ˜¾ç¤ºå™¨ã€é¼ æ ‡ã€é”®ç›˜ç­‰ã€‚è¿™ç±»è®¾å¤‡æ•°æ®äº¤æ¢é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œé€šå¸¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œæ•°æ®äº¤æ¢çš„ã€‚<br>2ï¼‰å­˜å‚¨è®¾å¤‡ï¼šç”¨äºå­˜å‚¨ç¨‹åºå’Œæ•°æ®çš„è®¾å¤‡ï¼Œå¦‚ç£ç›˜ã€ç£å¸¦ã€å…‰ç›˜ç­‰ã€‚è¿™ç±»è®¾å¤‡ç”¨äºæ•°æ®äº¤æ¢ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€šå¸¸ä»¥å¤šå­—èŠ‚ç»„æˆçš„å—ä¸ºå•ä½è¿›è¡Œæ•°æ®äº¤æ¢ã€‚<br>3ï¼‰ç½‘ç»œé€šä¿¡è®¾å¤‡ï¼šç”¨äºä¸è¿œç¨‹è®¾å¤‡é€šä¿¡çš„è®¾å¤‡ï¼Œå¦‚å„ç§ç½‘ç»œæ¥å£ã€è°ƒåˆ¶è§£è°ƒå™¨ç­‰ã€‚å…¶é€Ÿåº¦ä»‹äºå‰ä¸¤ç±»è®¾å¤‡ä¹‹é—´ã€‚<br>é™¤äº†ä¸Šé¢æœ€å¸¸è§çš„åˆ†ç±»æ–¹æ³•ï¼ŒI/Oè®¾å¤‡è¿˜å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹æ³•åˆ†ç±»</p><p><strong>æŒ‰ä¼ è¾“é€Ÿç‡åˆ†ç±»</strong><br>1ï¼‰ä½é€Ÿè®¾å¤‡ï¼šä¼ è¾“é€Ÿç‡ä»…ä¸ºæ¯ç§’å‡ ä¸ªåˆ°æ•°ç™¾ä¸ªå­—èŠ‚çš„ä¸€ç±»è®¾å¤‡ï¼Œå¦‚é”®ç›˜ã€é¼ æ ‡ç­‰ã€‚<br>2ï¼‰ä¸­é€Ÿè®¾å¤‡ï¼šä¼ è¾“é€Ÿç‡åœ¨æ¯ç§’æ•°åƒä¸ªå­—èŠ‚è‡³æ•°ä¸‡ä¸ªå­—èŠ‚çš„ä¸€ç±»è®¾å¤‡ï¼Œå¦‚è¡Œå¼æ‰“å°æœºã€æ¿€å…‰æ‰“å°æœºç­‰<br>3ï¼‰é«˜é€Ÿè®¾å¤‡ï¼šä¼ è¾“é€Ÿç‡åœ¨æ•°ç™¾ä¸ªåƒå­—èŠ‚è‡³åƒå…†å­—èŠ‚çš„ä¸€ç±»è®¾å¤‡ï¼Œå¦‚ç£å¸¦æœºã€ç£ç›˜æœºã€å…‰ç›˜æœºç­‰ã€‚</p><p><strong>æŒ‰ä¿¡æ¯äº¤æ¢çš„å•ä½åˆ†ç±»</strong><br>1ï¼‰å—è®¾å¤‡ï¼šç”±äºä¿¡æ¯çš„å­˜å–æ€»æ˜¯ä»¥æ•°æ®å—ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥å­˜å‚¨ä¿¡æ¯çš„è®¾å¤‡ç§°ä¸ºå—è®¾å¤‡ã€‚å®ƒå±äºæœ‰ç»“æ„è®¾å¤‡ï¼Œå¦‚ç£ç›˜ç­‰ã€‚ç£ç›˜è®¾å¤‡çš„åŸºæœ¬ç‰¹å¾æ˜¯ä¼ è¾“é€Ÿç‡è¾ƒé«˜ï¼Œä»¥åŠå¯å¯»å€ï¼Œå³å¯¹å®ƒå¯éšæœºåœ°è¯»/å†™ä»»ä¸€å—<br>2ï¼‰å­—ç¬¦è®¾å¤‡ï¼šç”¨äºæ•°æ®è¾“å…¥è¾“å‡ºçš„è®¾å¤‡ä¸ºå­—ç¬¦è®¾å¤‡ï¼Œå› ä¸ºå…¶ä¼ è¾“çš„åŸºæœ¬å•ä½æ˜¯å­—ç¬¦ã€‚å®ƒå±äºæ— ç»“æ„ç±»å‹ï¼Œå¦‚äº¤äº’å¼ç»ˆç«¯æœºã€æ‰“å°æœºç­‰ã€‚å®ƒä»¬çš„åŸºæœ¬ç‰¹å¾æ˜¯ä¼ è¾“é€Ÿç‡ä½ã€ä¸å¯å¯»å€ï¼Œå¹¶ä¸”åœ¨è¾“å…¥è¾“å‡ºæ—¶å¸¸é‡‡ç”¨ä¸­æ–­é©±åŠ¨æ–¹å¼ã€‚</p><h3 id="2-I-Oæ§åˆ¶å™¨"><a href="#2-I-Oæ§åˆ¶å™¨" class="headerlink" title="2. I-Oæ§åˆ¶å™¨"></a>2. I-Oæ§åˆ¶å™¨</h3><p><img src="https://img-blog.csdnimg.cn/20200703151309306.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="3-I-Oæ§åˆ¶æ–¹å¼"><a href="#3-I-Oæ§åˆ¶æ–¹å¼" class="headerlink" title="3. I-Oæ§åˆ¶æ–¹å¼"></a>3. I-Oæ§åˆ¶æ–¹å¼</h3><p><img src="https://img-blog.csdnimg.cn/2020070315140685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è®¾å¤‡ç®¡ç†çš„ä¸»è¦ä»»åŠ¡ä¹‹ä¸€æ˜¯æ§åˆ¶è®¾å¤‡å’Œå†…å­˜æˆ–å¤„ç†æœºä¹‹é—´çš„æ•°æ®ä¼ é€ã€‚å¤–å›´è®¾å¤‡å’Œå†…å­˜ä¹‹é—´çš„è¾“å…¥è¾“å‡ºæ§åˆ¶æ–¹å¼æœ‰å››ç§ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ã€‚</p><p><strong>ç¨‹åºç›´æ¥æ§åˆ¶æ–¹å¼</strong></p><p>å¦‚å›¾5-1ï¼ˆaï¼‰æ‰€ç¤ºï¼Œè®¡ç®—æœºä»å¤–éƒ¨è®¾å¤‡è¯»å–æ•°æ®åˆ°å­˜å‚¨å™¨ï¼Œæ¯æ¬¡è¯»ä¸€ä¸ªå­—çš„æ•°æ®ã€‚å¯¹è¯»å…¥çš„æ¯ä¸ªå­—ï¼ŒCPUéœ€è¦å¯¹å¤–è®¾çŠ¶æ€è¿›è¡Œå¾ªç¯æ£€æŸ¥ï¼Œç›´åˆ°ç¡®å®šè¯¥å­—å·²ç»åœ¨IOæ§åˆ¶å™¨çš„æ•°æ®å¯„å­˜å™¨ä¸­ã€‚åœ¨ç¨‹åºç›´æ¥æ§åˆ¶æ–¹å¼ä¸­ï¼Œç”±äºCPUçš„é«˜é€Ÿæ€§å’ŒI/Oè®¾å¤‡çš„ä½é€Ÿæ€§ï¼Œè‡´ä½¿CPUçš„ç»å¤§éƒ¨åˆ†æ—¶é—´éƒ½å¤„äºç­‰å¾…I/Oè®¾å¤‡å®Œæˆæ•°æ®I/Oçš„å¾ªç¯æµ‹è¯•ä¸­ï¼Œé€ æˆäº†CPUèµ„æºçš„æå¤§æµªè´¹ã€‚åœ¨è¯¥æ–¹å¼ä¸­ï¼ŒCPUä¹‹æ‰€ä»¥è¦ä¸æ–­åœ°æµ‹è¯•I/Oè®¾å¤‡çš„çŠ¶æ€ï¼Œå°±æ˜¯å› ä¸ºåœ¨CPUä¸­æ²¡æœ‰é‡‡ç”¨ä¸­æ–­æœºæ„ï¼Œä½¿I/Oè®¾å¤‡æ— æ³•å‘CPUæŠ¥å‘Šå®ƒå·²å®Œæˆäº†ä¸€ä¸ªå­—ç¬¦çš„è¾“å…¥æ“ä½œã€‚</p><p><strong>ä¸­æ–­é©±åŠ¨æ–¹å¼</strong></p><p>ä¸­æ–­é©±åŠ¨æ–¹å¼çš„æ€æƒ³æ˜¯ï¼Œå…è®¸I/Oè®¾å¤‡ä¸»åŠ¨æ‰“æ–­CPUçš„è¿è¡Œå¹¶è¯·æ±‚æœåŠ¡ï¼Œä»è€Œâ€œè§£æ”¾â€CPUï¼Œä½¿å¾—å…¶å‘I/Oæ§åˆ¶å™¨å‘é€è¯»å‘½ä»¤åå¯ä»¥ç»§ç»­åšå…¶ä»–æœ‰ç”¨çš„å·¥ä½œã€‚å¦‚å›¾5-1ï¼ˆbï¼‰æ‰€ç¤ºï¼Œæˆ‘ä»¬ä»I/Oæ§åˆ¶å™¨å’ŒCPUä¸¤ä¸ªè§’åº¦åˆ†åˆ«æ¥çœ‹ä¸­æ–­é©±åŠ¨æ–¹å¼çš„å·¥ä½œè¿‡ç¨‹ï¼š</p><p>ä»I/Oæ§åˆ¶å™¨çš„è§’åº¦æ¥çœ‹ï¼ŒI/Oæ§åˆ¶å™¨ä»CPUæ¥æ”¶ä¸€ä¸ªè¯»å‘½ä»¤ï¼Œç„¶åä»å¤–å›´è®¾å¤‡è¯»æ•°æ®ï¼Œä¸€æ—¦æ•°æ®è¯»å…¥åˆ°è¯¥I/Oæ§åˆ¶å™¨çš„æ•°æ®å¯„å­˜å™¨ï¼Œä¾¿é€šè¿‡æ§åˆ¶çº¿ç»™CPUå‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œè¡¨ç¤ºæ•°æ®å·²å‡†å¤‡å¥½ï¼Œç„¶åç­‰å¾…CPUè¯·æ±‚è¯¥æ•°æ®ã€‚I/Oæ§åˆ¶å™¨æ”¶åˆ°CPUå‘å‡ºçš„å–æ•°æ®è¯·æ±‚åï¼Œå°†æ•°æ®æ”¾åˆ°æ•°æ®æ€»çº¿ä¸Šï¼Œä¼ åˆ°CPUçš„å¯„å­˜å™¨ä¸­ã€‚è‡³æ­¤ï¼Œæœ¬æ¬¡I/Oæ“ä½œå®Œæˆï¼ŒI/Oæ§åˆ¶å™¨åˆå¯å¼€å§‹ä¸‹ä¸€æ¬¡I/Oæ“ä½œã€‚</p><p>ä»CPUçš„è§’åº¦æ¥çœ‹ï¼ŒCPUå‘å‡ºè¯»å‘½ä»¤ï¼Œç„¶åä¿å­˜å½“å‰è¿è¡Œç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼ˆç°åœºï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨åŠå¤„ç†æœºå¯„å­˜å™¨ï¼‰ï¼Œè½¬å»æ‰§è¡Œå…¶ä»–ç¨‹åºã€‚åœ¨æ¯ä¸ªæŒ‡ä»¤å‘¨æœŸçš„æœ«å°¾ï¼ŒCPUæ£€æŸ¥ä¸­æ–­ã€‚å½“æœ‰æ¥è‡ªI/Oæ§åˆ¶å™¨çš„ä¸­æ–­æ—¶ï¼ŒCPUä¿å­˜å½“å‰æ­£åœ¨è¿è¡Œç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œè½¬å»æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åºå¤„ç†è¯¥ä¸­æ–­ã€‚è¿™æ—¶ï¼ŒCPUä»I/Oæ§åˆ¶å™¨è¯»ä¸€ä¸ªå­—çš„æ•°æ®ä¼ é€åˆ°å¯„å­˜å™¨ï¼Œå¹¶å­˜å…¥ä¸»å­˜ã€‚æ¥ç€ï¼ŒCPUæ¢å¤å‘å‡ºI/Oå‘½ä»¤çš„ç¨‹åºï¼ˆæˆ–å…¶ä»–ç¨‹åºï¼‰çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åç»§ç»­è¿è¡Œã€‚ä¸­æ–­é©±åŠ¨æ–¹å¼æ¯”ç¨‹åºç›´æ¥æ§åˆ¶æ–¹å¼æœ‰æ•ˆï¼Œä½†ç”±äºæ•°æ®ä¸­çš„æ¯ä¸ªå­—åœ¨å­˜å‚¨å™¨ä¸I/Oæ§åˆ¶å™¨ä¹‹é—´çš„ä¼ è¾“éƒ½å¿…é¡»ç»è¿‡CPUï¼Œè¿™å°±å¯¼è‡´äº†ä¸­æ–­é©±åŠ¨æ–¹å¼ä»ç„¶ä¼šæ¶ˆè€—è¾ƒå¤šçš„CPUæ—¶é—´ã€‚</p><p><strong>DMAæ–¹å¼</strong></p><p>åœ¨ä¸­æ–­é©±åŠ¨æ–¹å¼ä¸­ï¼ŒI/Oè®¾å¤‡ä¸å†…å­˜ä¹‹é—´çš„æ•°æ®äº¤æ¢å¿…é¡»è¦ç»è¿‡CPUä¸­çš„å¯„å­˜å™¨ï¼Œæ‰€ä»¥é€Ÿåº¦è¿˜æ˜¯å—é™ï¼Œè€ŒDMAï¼ˆç›´æ¥å­˜å‚¨å™¨å­˜å–ï¼‰æ–¹å¼çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨I/Oè®¾å¤‡å’Œå†…å­˜ä¹‹é—´å¼€è¾Ÿç›´æ¥çš„æ•°æ®äº¤æ¢é€šè·¯ï¼Œå½»åº•â€œè§£æ”¾â€CPU.DMAæ–¹å¼çš„ç‰¹ç‚¹æ˜¯<br>1ï¼‰åŸºæœ¬å•ä½æ˜¯æ•°æ®å—<br>2ï¼‰æ‰€ä¼ é€çš„æ•°æ®ï¼Œæ˜¯ä»è®¾å¤‡ç›´æ¥é€å…¥å†…å­˜çš„ï¼Œæˆ–è€…ç›¸åã€‚<br>3ï¼‰ä»…åœ¨ä¼ é€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—çš„å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ‰éœ€CPUå¹²é¢„ï¼Œæ•´å—æ•°æ®çš„ä¼ é€æ˜¯åœ¨DMAæ§åˆ¶å™¨çš„æ§åˆ¶ä¸‹å®Œæˆçš„ã€‚</p><p><strong>é€šé“æ§åˆ¶æ–¹å¼</strong></p><p><img src="https://img-blog.csdnimg.cn/20200611002131137.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="4-I-Oè½¯ä»¶å±‚æ¬¡ç»“æ„"><a href="#4-I-Oè½¯ä»¶å±‚æ¬¡ç»“æ„" class="headerlink" title="4. I-Oè½¯ä»¶å±‚æ¬¡ç»“æ„"></a>4. I-Oè½¯ä»¶å±‚æ¬¡ç»“æ„</h3><p><img src="https://img-blog.csdnimg.cn/20200703151513481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="5-I-Oæ ¸å¿ƒå­ç³»ç»Ÿ"><a href="#5-I-Oæ ¸å¿ƒå­ç³»ç»Ÿ" class="headerlink" title="5. I-Oæ ¸å¿ƒå­ç³»ç»Ÿ"></a>5. I-Oæ ¸å¿ƒå­ç³»ç»Ÿ</h3><p><img src="https://img-blog.csdnimg.cn/20200703151554310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”±äºI/Oè®¾å¤‡ç§ç±»ç¹å¤šï¼ŒåŠŸèƒ½å’Œä¼ è¾“é€Ÿç‡å·®å¼‚å·¨å¤§ï¼Œéœ€è¦å¤šç§æ–¹æ³•æ¥è¿›è¡Œè®¾å¤‡æ§åˆ¶ã€‚è¿™äº›æ–¹æ³•å…±åŒç»„æˆäº†æ“ä½œç³»ç»Ÿå†…æ ¸çš„I/Oå­ç³»ç»Ÿï¼Œå®ƒå°†å†…æ ¸çš„å…¶ä»–æ–¹é¢ä»ç¹é‡çš„I/Oè®¾å¤‡ç®¡ç†ä¸­è§£æ”¾å‡ºæ¥ã€‚I/Oæ ¸å¿ƒå­ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸»è¦æœ‰ï¼šIOè°ƒåº¦ã€ç¼“å†²ä¸é«˜é€Ÿç¼“å­˜ã€è®¾å¤‡åˆ†é…ä¸å›æ”¶ã€å‡è„±æœºã€è®¾å¤‡ä¿æŠ¤å’Œå·®é”™å¤„ç†ç­‰</p><h3 id="6-å‡è„±æœºæŠ€æœ¯"><a href="#6-å‡è„±æœºæŠ€æœ¯" class="headerlink" title="6. å‡è„±æœºæŠ€æœ¯"></a>6. å‡è„±æœºæŠ€æœ¯</h3><p><img src="https://img-blog.csdnimg.cn/20200703151714594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸ºäº†ç¼“å’ŒCPUçš„é«˜é€Ÿæ€§ä¸I/Oè®¾å¤‡ä½é€Ÿæ€§ä¹‹é—´çš„çŸ›ç›¾è€Œå¼•å…¥äº†è„±æœºè¾“å…¥/è¾“å‡ºæŠ€æœ¯ã€‚è¯¥æŠ€æœ¯æ˜¯åˆ©ç”¨ä¸“é—¨çš„å¤–å›´æ§åˆ¶æœºï¼Œå°†ä½é€ŸI/Oè®¾å¤‡ä¸Šçš„æ•°æ®ä¼ é€åˆ°é«˜é€Ÿç£ç›˜ä¸Šï¼›æˆ–è€…ç›¸åã€‚ SPOOLingçš„æ„æ€æ˜¯å¤–éƒ¨è®¾å¤‡åŒæ—¶è”æœºæ“ä½œï¼Œåˆç§°ä¸ºå‡è„±æœºè¾“å…¥è¾“å‡ºæ“ä½œï¼Œæ˜¯æ“ä½œç³»ç»Ÿä¸­é‡‡ç”¨çš„ä¸€é¡¹å°†ç‹¬å è®¾å¤‡æ”¹é€ æˆå…±äº«è®¾å¤‡çš„æŠ€æœ¯ã€‚</p><p><strong>è¾“å…¥äº•å’Œè¾“å‡ºäº•</strong></p><p><img src="https://img-blog.csdnimg.cn/20200611082824989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒº</strong></p><p>åœ¨å†…å­˜ä¸­å¼€è¾Ÿçš„ä¸¤ä¸ªç¼“å†²åŒºã€‚è¾“å…¥ç¼“å†²åŒºç”¨äºæš‚å­˜ç”±è¾“å…¥è®¾å¤‡é€æ¥çš„æ•°æ®ï¼Œä»¥åå†ä¼ é€åˆ°è¾“å…¥äº•ã€‚è¾“å‡ºç¼“å†²åŒºç”¨äºæš‚å­˜ä»è¾“å‡ºäº•é€æ¥çš„æ•°æ®ï¼Œä»¥åå†ä¼ é€åˆ°è¾“å‡ºè®¾å¤‡</p><p><strong>è¾“å…¥è¿›ç¨‹å’Œè¾“å‡ºè¿›ç¨‹</strong></p><p>è¾“å…¥è¿›ç¨‹æ¨¡æ‹Ÿè„±æœºè¾“å…¥æ—¶çš„å¤–å›´æ§åˆ¶æœºï¼Œå°†ç”¨æˆ·è¦æ±‚çš„æ•°æ®ä»è¾“å…¥æœºé€šè¿‡è¾“å…¥ç¼“å†²åŒºå†é€åˆ°è¾“å…¥äº•ã€‚å½“CPUéœ€è¦è¾“å…¥æ•°æ®æ—¶ï¼Œç›´æ¥å°†æ•°æ®ä»è¾“å…¥äº•è¯»å…¥å†…å­˜ã€‚è¾“å‡ºè¿›ç¨‹æ¨¡æ‹Ÿè„±æœºè¾“å‡ºæ—¶çš„å¤–å›´æ§åˆ¶æœºï¼ŒæŠŠç”¨æˆ·è¦æ±‚è¾“å‡ºçš„æ•°æ®å…ˆä»å†…å­˜é€åˆ°è¾“å‡ºäº•ï¼Œå¾…è¾“å‡ºè®¾å¤‡ç©ºé—²æ—¶ï¼Œå†å°†è¾“å‡ºäº•ä¸­çš„æ•°æ®ç»è¿‡è¾“å‡ºç¼“å†²åŒºé€åˆ°è¾“å‡ºè®¾å¤‡</p><h3 id="7-è®¾å¤‡çš„åˆ†é…ä¸å›æ”¶"><a href="#7-è®¾å¤‡çš„åˆ†é…ä¸å›æ”¶" class="headerlink" title="7. è®¾å¤‡çš„åˆ†é…ä¸å›æ”¶"></a>7. è®¾å¤‡çš„åˆ†é…ä¸å›æ”¶</h3><p><img src="https://img-blog.csdnimg.cn/20200703152532663.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> </p><p><strong>è®¾å¤‡åˆ†é…æ¦‚è¿°</strong></p><p>è®¾å¤‡åˆ†é…æ˜¯æŒ‡æ ¹æ®ç”¨æˆ·çš„I/Oè¯·æ±‚åˆ†é…æ‰€éœ€çš„è®¾å¤‡ã€‚åˆ†é…çš„æ€»åŸåˆ™æ˜¯å……åˆ†å‘æŒ¥è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡ï¼Œå°½å¯èƒ½åœ°è®©è®¾å¤‡å¿™ç¢Œï¼Œåˆè¦é¿å…ç”±äºä¸åˆç†çš„åˆ†é…æ–¹æ³•é€ æˆè¿›ç¨‹æ­»é”ã€‚ä»è®¾å¤‡çš„ç‰¹æ€§æ¥çœ‹ï¼Œé‡‡ç”¨ä¸‹è¿°ä¸‰ç§ä½¿ç”¨æ–¹å¼çš„è®¾å¤‡åˆ†åˆ«ç§°ä¸ºç‹¬å è®¾å¤‡ã€å…±äº«è®¾å¤‡å’Œè™šæ‹Ÿè®¾å¤‡ã€‚</p><p>1ï¼‰ç‹¬å å¼ä½¿ç”¨è®¾å¤‡ã€‚æŒ‡åœ¨ç”³è¯·è®¾å¤‡æ—¶ï¼Œå¦‚æœè®¾å¤‡ç©ºé—²ï¼Œå°±å°†å…¶ç‹¬å ï¼Œä¸å†å…è®¸å…¶ä»–è¿›ç¨‹ç”³è¯·ä½¿ç”¨ï¼Œä¸€ç›´ç­‰åˆ°è¯¥è®¾å¤‡è¢«é‡Šæ”¾æ‰å…è®¸å…¶ä»–è¿›ç¨‹ç”³è¯·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‰“å°æœºï¼Œåœ¨ä½¿ç”¨å®ƒæ‰“å°æ—¶ï¼Œåªèƒ½ç‹¬å å¼ä½¿ç”¨ï¼Œå¦åˆ™åœ¨åŒä¸€å¼ çº¸ä¸Šäº¤æ›¿æ‰“å°ä¸åŒä»»åŠ¡çš„å†…å®¹ï¼Œæ— æ³•æ­£å¸¸é˜…è¯»ã€‚<br>2ï¼‰åˆ†æ—¶å¼å…±äº«ä½¿ç”¨è®¾å¤‡ã€‚ç‹¬å å¼ä½¿ç”¨è®¾å¤‡æ—¶ï¼Œè®¾å¤‡åˆ©ç”¨ç‡å¾ˆä½ï¼Œå½“è®¾å¤‡æ²¡æœ‰ç‹¬å ä½¿ç”¨çš„è¦æ±‚æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ†æ—¶å…±äº«ä½¿ç”¨æé«˜åˆ©ç”¨ç‡ã€‚ä¾‹å¦‚ï¼Œå¯¹ç£ç›˜è®¾å¤‡çš„I/Oæ“ä½œï¼Œå„è¿›ç¨‹çš„æ¯æ¬¡I/Oæ“ä½œè¯·æ±‚å¯ä»¥é€šè¿‡åˆ†æ—¶æ¥äº¤æ›¿è¿›è¡Œã€‚<br>3ï¼‰ä»¥ SPOOLingæ–¹å¼ä½¿ç”¨å¤–éƒ¨è®¾å¤‡ã€‚ SPOOLingï¼ˆ Simultaneous Peripheral Operation On-Line)æŠ€æœ¯æ˜¯åœ¨æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿæ—¶ä»£å¼•å…¥çš„ï¼Œå³å‡è„±æœºIOæŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯ç”¨äºå¯¹è®¾å¤‡çš„æ“ä½œï¼Œå®è´¨ä¸Šå°±æ˜¯å¯¹I/Oæ“ä½œè¿›è¡Œæ‰¹å¤„ç†ã€‚ SPOOLingæŠ€æœ¯å®è´¨ä¸Šæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æŠ€æœ¯ï¼Œè€Œæˆ‘ä»¬ç†Ÿæ‚‰çš„è¯·æ±‚åˆ†é¡µç³»ç»Ÿä¸­çš„é¡µé¢è°ƒåº¦ç®—æ³•å°±åˆšå¥½ç›¸åï¼Œæ˜¯ä»¥æ—¶é—´æ¢ç©ºé—´çš„æŠ€æœ¯ã€‚</p><p><strong>è®¾å¤‡åˆ†é…çš„æ•°æ®ç»“æ„</strong></p><p><strong>è®¾å¤‡åˆ†é…çš„ç­–ç•¥</strong></p><p>1ï¼‰è®¾å¤‡åˆ†é…åŸåˆ™ï¼šè®¾å¤‡åˆ†é…åº”æ ¹æ®è®¾å¤‡ç‰¹æ€§ã€ç”¨æˆ·è¦æ±‚å’Œç³»ç»Ÿé…ç½®æƒ…å†µã€‚åˆ†é…çš„æ€»åŸåˆ™ï¼šæ—¢è¦å……åˆ†å‘æŒ¥è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡ï¼Œåˆè¦é¿å…é€ æˆè¿›ç¨‹æ­»é”ï¼Œè¿˜è¦å°†ç”¨æˆ·ç¨‹åºå’Œå…·ä½“è®¾å¤‡éš”ç¦»å¼€ã€‚<br>2ï¼‰è®¾å¤‡åˆ†é…æ–¹å¼ï¼šè®¾å¤‡åˆ†é…æ–¹å¼æœ‰é™æ€åˆ†é…å’ŒåŠ¨æ€åˆ†é…ä¸¤ç§ï¼š<br>é™æ€åˆ†é…ä¸»è¦ç”¨äºå¯¹ç‹¬å è®¾å¤‡çš„åˆ†é…ï¼Œå®ƒåœ¨ç”¨æˆ·ä½œä¸šå¼€å§‹æ‰§è¡Œå‰ï¼Œç”±ç³»ç»Ÿä¸€æ¬¡æ€§åˆ†é…è¯¥ä½œä¸šæ‰€è¦æ±‚çš„å…¨éƒ¨è®¾å¤‡ã€æ§åˆ¶å™¨ï¼ˆå¦‚é€šé“ç­‰ï¼‰.ä¸€æ—¦åˆ†é…åï¼Œè¿™äº›è®¾å¤‡ã€æ§åˆ¶å™¨ï¼ˆå’Œé€šé“ï¼‰å°±ä¸€ç›´ä¸ºè¯¥ä½œä¸šæ‰€å ç”¨ï¼Œç›´åˆ°è¯¥ä½œä¸šè¢«æ’¤é”€ã€‚é™æ€åˆ†é…æ–¹å¼ä¸ä¼šå‡ºç°æ­»é”ï¼Œä½†è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡ä½ã€‚å› æ­¤ï¼Œé™æ€åˆ†é…æ–¹å¼å¹¶ä¸ç¬¦åˆåˆ†é…çš„æ€»åŸåˆ™ã€‚<br>åŠ¨æ€åˆ†é…æ˜¯åœ¨è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ ¹æ®æ‰§è¡Œéœ€è¦è¿›è¡Œã€‚å½“è¿›ç¨‹éœ€è¦è®¾å¤‡æ—¶ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘½ä»¤å‘ç³»ç»Ÿæå‡ºè®¾å¤‡è¯·æ±‚ï¼Œç”±ç³»ç»ŸæŒ‰ç…§äº‹å…ˆè§„å®šçš„ç­–ç•¥ç»™è¿›ç¨‹åˆ†é…æ‰€éœ€è¦çš„è®¾å¤‡ã€IOæ§åˆ¶å™¨ï¼Œä¸€æ—¦ç”¨å®Œä¹‹åï¼Œä¾¿ç«‹å³é‡Šæ”¾ã€‚åŠ¨æ€åˆ†é…æ–¹å¼æœ‰åˆ©äºæé«˜è®¾å¤‡çš„åˆ©ç”¨ç‡ï¼Œä½†å¦‚æœåˆ†é…ç®—æ³•ä½¿ç”¨ä¸å½“ï¼Œåˆ™æœ‰å¯èƒ½é€ æˆè¿›ç¨‹æ­»é”ã€‚<br>3ï¼‰è®¾å¤‡åˆ†é…ç®—æ³•ï¼šå¸¸ç”¨çš„åŠ¨æ€è®¾å¤‡åˆ†é…ç®—æ³•æœ‰å…ˆè¯·æ±‚å…ˆåˆ†é…ã€ä¼˜å…ˆçº§é«˜è€…ä¼˜å…ˆç­‰ã€‚<br>å¯¹äºç‹¬å è®¾å¤‡ï¼Œæ—¢å¯ä»¥é‡‡ç”¨åŠ¨æ€åˆ†é…æ–¹å¼ä¹Ÿå¯ä»¥é‡‡ç”¨é™æ€åˆ†é…æ–¹å¼ï¼Œå¾€å¾€é‡‡ç”¨é™æ€åˆ†é…æ–¹å¼ï¼Œå³åœ¨ä½œä¸šæ‰§è¡Œå‰ï¼Œå°†ä½œä¸šæ‰€è¦ç”¨çš„è¿™ä¸€ç±»è®¾å¤‡åˆ†é…ç»™å®ƒã€‚å…±äº«è®¾å¤‡å¯è¢«å¤šä¸ªè¿›ç¨‹æ‰€å…±äº«ï¼Œä¸€èˆ¬é‡‡ç”¨åŠ¨æ€åˆ†é…æ–¹å¼ï¼Œä½†åœ¨æ¯ä¸ªI/Oä¼ è¾“çš„å•ä½æ—¶é—´å†…åªè¢«ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ï¼Œé€šå¸¸é‡‡ç”¨å…ˆè¯·æ±‚å…ˆåˆ†é…å’Œä¼˜å…ˆçº§é«˜è€…ä¼˜å…ˆçš„åˆ†é…ç®—æ³•</p><p><strong>è®¾å¤‡åˆ†é…çš„å®‰å…¨æ€§</strong></p><p>è®¾å¤‡åˆ†é…çš„å®‰å…¨æ€§æ˜¯æŒ‡è®¾å¤‡åˆ†é…ä¸­åº”é˜²æ­¢å‘ç”Ÿè¿›ç¨‹æ­»é”ã€‚<br>1ï¼‰å®‰å…¨åˆ†é…æ–¹å¼ï¼šæ¯å½“è¿›ç¨‹å‘å‡ºI/Oè¯·æ±‚åä¾¿è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶I/Oæ“ä½œå®Œæˆæ—¶æ‰è¢«å”¤é†’ã€‚è¿™æ ·ï¼Œä¸€æ—¦è¿›ç¨‹å·²ç»è·å¾—æŸç§è®¾å¤‡åä¾¿é˜»å¡ï¼Œä¸èƒ½å†è¯·æ±‚ä»»ä½•èµ„æºï¼Œè€Œä¸”åœ¨å®ƒé˜»å¡æ—¶ä¹Ÿä¸ä¿æŒä»»ä½•èµ„æºã€‚ä¼˜ç‚¹æ˜¯è®¾å¤‡åˆ†é…å®‰å…¨ï¼šç¼ºç‚¹æ˜¯CPUå’ŒI/Oè®¾å¤‡æ˜¯ä¸²è¡Œå·¥ä½œçš„ï¼ˆå¯¹åŒä¸€è¿›ç¨‹è€Œè¨€ï¼‰<br>2ï¼‰ä¸å®‰å…¨åˆ†é…æ–¹å¼ï¼šè¿›ç¨‹åœ¨å‘å‡ºI/Oè¯·æ±‚åç»§ç»­è¿è¡Œï¼Œéœ€è¦æ—¶åˆå‘å‡ºç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªI/Oè¯·æ±‚ç­‰ã€‚ä»…å½“è¿›ç¨‹æ‰€è¯·æ±‚çš„è®¾å¤‡å·²è¢«å¦ä¸€è¿›ç¨‹å ç”¨æ—¶ï¼Œæ‰è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ä¼˜ç‚¹æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯åŒæ—¶æ“ä½œå¤šä¸ªè®¾å¤‡ï¼Œä»è€Œä½¿è¿›ç¨‹æ¨è¿›è¿…é€Ÿï¼›ç¼ºç‚¹æ˜¯è¿™ç§è®¾å¤‡åˆ†é…æœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚</p><p><strong>é€»è¾‘è®¾å¤‡ååˆ°ç‰©ç†è®¾å¤‡åçš„æ˜ å°„</strong></p><p>ä¸ºäº†æé«˜è®¾å¤‡åˆ†é…çš„çµæ´»æ€§å’Œè®¾å¤‡çš„åˆ©ç”¨ç‡ã€æ–¹ä¾¿å®ç°I/Oé‡å®šå‘ï¼Œå› æ­¤å¼•å…¥äº†è®¾å¤‡ç‹¬ç«‹æ€§ã€‚è®¾å¤‡ç‹¬ç«‹æ€§æ˜¯æŒ‡åº”ç”¨ç¨‹åºç‹¬ç«‹äºå…·ä½“ä½¿ç”¨çš„ç‰©ç†è®¾å¤‡ã€‚<br>ä¸ºäº†å®ç°è®¾å¤‡ç‹¬ç«‹æ€§ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨é€»è¾‘è®¾å¤‡åæ¥è¯·æ±‚ä½¿ç”¨æŸç±»è®¾å¤‡ï¼Œåœ¨ç³»ç»Ÿä¸­è®¾ç½®å¼ é€»è¾‘è®¾å¤‡è¡¨ï¼ˆ Logical Unit Tableï¼ŒLUTï¼‰ï¼Œç”¨äºå°†é€»è¾‘è®¾å¤‡åæ˜ å°„ä¸ºç‰©ç†è®¾å¤‡åã€‚LUTè¡¨é¡¹åŒ…æ‹¬é€»è¾‘è®¾å¤‡åã€ç‰©ç†è®¾å¤‡åå’Œè®¾å¤‡é©±åŠ¨ç¨‹åºå…¥å£åœ°å€ï¼›å½“è¿›ç¨‹ç”¨é€»è¾‘è®¾å¤‡åæ¥è¯·æ±‚åˆ†é…è®¾å¤‡æ—¶ï¼Œç³»ç»Ÿä¸ºå®ƒåˆ†é…ç›¸åº”çš„ç‰©ç†è®¾å¤‡ï¼Œå¹¶åœ¨LUTä¸­å»ºç«‹ä¸€ä¸ªè¡¨é¡¹ï¼Œä»¥åè¿›ç¨‹å†åˆ©ç”¨é€»è¾‘è®¾å¤‡åè¯·æ±‚IOæ“ä½œæ—¶ï¼Œç³»ç»Ÿé€šè¿‡æŸ¥æ‰¾LUTæ¥å¯»æ‰¾ç›¸åº”çš„ç‰©ç†è®¾å¤‡å’Œé©±åŠ¨ç¨‹åºã€‚</p><p>åœ¨ç³»ç»Ÿä¸­å¯é‡‡å–ä¸¤ç§æ–¹å¼å»ºç«‹é€»è¾‘è®¾å¤‡è¡¨<br>1ï¼‰åœ¨æ•´ä¸ªç³»ç»Ÿä¸­åªè®¾ç½®ä¸€å¼ LUT.è¿™æ ·ï¼Œæ‰€æœ‰è¿›ç¨‹çš„è®¾å¤‡åˆ†é…æƒ…å†µéƒ½è®°å½•åœ¨è¿™å¼ è¡¨ä¸­ï¼Œæ•…ä¸å…è®¸æœ‰ç›¸åŒçš„é€»è¾‘è®¾å¤‡åï¼Œä¸»è¦é€‚ç”¨äºå•ç”¨æˆ·ç³»ç»Ÿä¸­ã€‚<br>2ï¼‰ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®ä¸€å¼ LUT.å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¾¿ä¸ºè¯¥ç”¨æˆ·å»ºç«‹ä¸€ä¸ªè¿›ç¨‹ï¼ŒåŒæ—¶ä¹Ÿä¸ºä¹‹å»ºç«‹ä¸€å¼ LUTï¼Œå¹¶å°†è¯¥è¡¨æ”¾å…¥è¿›ç¨‹çš„PCBä¸­ã€‚</p><h3 id="8-ç¼“å†²åŒºç®¡ç†"><a href="#8-ç¼“å†²åŒºç®¡ç†" class="headerlink" title="8. ç¼“å†²åŒºç®¡ç†"></a>8. ç¼“å†²åŒºç®¡ç†</h3><p><img src="https://img-blog.csdnimg.cn/20200703153108478.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153304460.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153345702.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153438901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153706542.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153803582.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200703153927302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼ˆ Disk Cacheï¼‰</strong></p><p>æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜æŠ€æœ¯æ¥æé«˜ç£ç›˜çš„I/Oé€Ÿåº¦ï¼Œå¯¹é«˜é€Ÿç¼“å­˜å¤åˆ¶çš„è®¿é—®è¦æ¯”åŸå§‹æ•°æ®è®¿é—®æ›´ä¸ºé«˜æ•ˆã€‚ä¾‹å¦‚ï¼Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„æŒ‡ä»¤æ—¢å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä¹Ÿå­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œä¹Ÿè¢«å¤åˆ¶åˆ°CPUçš„äºŒçº§å’Œä¸€çº§é«˜é€Ÿç¼“å­˜ä¸­ã€‚<br>ä¸è¿‡ï¼Œç£ç›˜é«˜é€Ÿç¼“å­˜æŠ€æœ¯ä¸åŒäºé€šå¸¸æ„ä¹‰ä¸‹çš„ä»‹äºCPUä¸å†…å­˜ä¹‹é—´çš„å°å®¹é‡é«˜é€Ÿå­˜å‚¨å™¨ï¼Œè€Œæ˜¯æŒ‡åˆ©ç”¨å†…å­˜ä¸­çš„å­˜å‚¨ç©ºé—´æ¥æš‚å­˜ä»ç£ç›˜ä¸­è¯»å‡ºçš„ä¸€ç³»åˆ—ç›˜å—ä¸­çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œç£ç›˜é«˜é€Ÿç¼“å­˜åœ¨é€»è¾‘ä¸Šå±äºç£ç›˜ï¼Œç‰©ç†ä¸Šåˆ™æ˜¯é©»ç•™åœ¨å†…å­˜ä¸­çš„ç›˜å—ã€‚<br>é«˜é€Ÿç¼“å­˜åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼šä¸€ç§æ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨ç©ºé—´ä½œä¸ºç£ç›˜é«˜é€Ÿç¼“å­˜ï¼Œå¤§å°å›ºå®šï¼›å¦ä¸€ç§æ˜¯æŠŠæœªåˆ©ç”¨çš„å†…å­˜ç©ºé—´ä½œä¸ºä¸€ä¸ªç¼“å†²æ± ï¼Œä¾›è¯·æ±‚åˆ†é¡µç³»ç»Ÿå’Œç£ç›˜I/Oæ—¶å…±äº«ã€‚</p><p><strong>ç¼“å†²åŒºï¼ˆ Bufferï¼‰</strong><br>åœ¨è®¾å¤‡ç®¡ç†å­ç³»ç»Ÿä¸­ï¼Œå¼•å…¥ç¼“å†²åŒºçš„ç›®çš„ä¸»è¦æœ‰ï¼š<br>1ï¼‰ç¼“å’ŒCPUä¸I/Oè®¾å¤‡é—´é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ã€‚<br>2ï¼‰å‡å°‘å¯¹CPUçš„ä¸­æ–­é¢‘ç‡ï¼Œæ”¾å®½å¯¹CPUä¸­æ–­å“åº”æ—¶é—´çš„é™åˆ¶<br>3ï¼‰è§£å†³åŸºæœ¬æ•°æ®å•å…ƒå¤§å°ï¼ˆå³æ•°æ®ç²’åº¦ï¼‰ä¸åŒ¹é…çš„é—®é¢˜ã€‚<br>4ï¼‰æé«˜CPUå’ŒI/Oè®¾å¤‡ä¹‹é—´çš„å¹¶è¡Œæ€§</p><p>å…¶å®ç°æ–¹æ³•æœ‰ï¼š<br>1ï¼‰é‡‡ç”¨ç¡¬ä»¶ç¼“å†²å™¨ï¼Œä½†ç”±äºæˆæœ¬å¤ªé«˜ï¼Œé™¤ä¸€äº›å…³é”®éƒ¨ä½å¤–ï¼Œä¸€èˆ¬ä¸é‡‡ç”¨ç¡¬ä»¶ç¼“å†²å™¨ã€‚<br>2ï¼‰é‡‡ç”¨ç¼“å†²åŒºï¼ˆä½äºå†…å­˜åŒºåŸŸï¼‰.<br>ç¼“å†²åŒºæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå½“ç¼“å†²åŒºçš„æ•°æ®éç©ºçš„æ—¶å€™ï¼Œä¸èƒ½å¾€ç¼“å†²åŒºå†²å…¥æ•°æ®ï¼Œåªèƒ½ä»ç¼“å†²åŒºæŠŠæ•°æ®ä¼ å‡ºï¼›å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œå¯ä»¥å¾€ç¼“å†²åŒºå†²å…¥æ•°æ®ï¼Œä½†å¿…é¡»æŠŠç¼“å†²åŒºå……æ»¡ä»¥åï¼Œæ‰èƒ½ä»ç¼“å†²åŒºæŠŠæ•°æ®ä¼ å‡ºã€‚</p><p>æ ¹æ®ç³»ç»Ÿè®¾ç½®ç¼“å†²å™¨çš„ä¸ªæ•°ï¼Œç¼“å†²æŠ€æœ¯å¯ä»¥åˆ†ä¸º</p><p>1ï¼‰å•ç¼“å†²ï¼šåœ¨è®¾å¤‡å’Œå¤„ç†æœºä¹‹é—´è®¾ç½®ä¸€ä¸ªç¼“å†²åŒºã€‚è®¾å¤‡å’Œå¤„ç†æœºäº¤æ¢æ•°æ®æ—¶ï¼Œå…ˆæŠŠè¢«äº¤æ¢<br>æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œç„¶åéœ€è¦æ•°æ®çš„è®¾å¤‡æˆ–å¤„ç†æœºä»ç¼“å†²åŒºå–èµ°æ•°æ®ã€‚<br>2ï¼‰åŒç¼“å†²ï¼šæ ¹æ®å•ç¼“å†²çš„ç‰¹ç‚¹ï¼ŒCPUåœ¨ä¼ é€æ—¶é—´Må†…å¤„äºç©ºé—²çŠ¶æ€ï¼Œç”±æ­¤å¼•å…¥åŒç¼“å†²ã€‚I/Oè®¾å¤‡è¾“å…¥æ•°æ®æ—¶å…ˆè£…å¡«åˆ°ç¼“å†²åŒº1ï¼Œåœ¨ç¼“å†²åŒº1å¡«æ»¡åæ‰å¼€å§‹è£…å¡«ç¼“å†²åŒº2ï¼Œä¸æ­¤åŒæ—¶å¤„ç†æœºå¯<br>ä»¥ä»ç¼“å†²åŒº1ä¸­å–å‡ºæ•°æ®æ”¾å…¥ç”¨æˆ·è¿›ç¨‹å¤„ç†ï¼Œå½“ç¼“å†²åŒº1ä¸­çš„æ•°æ®å¤„ç†å®Œåï¼Œè‹¥ç¼“å†²åŒº2å·²å¡«æ»¡ï¼Œåˆ™å¤„ç†æœºåˆä»ç¼“å†²åŒº2ä¸­å–å‡ºæ•°æ®æ”¾å…¥ç”¨æˆ·è¿›ç¨‹å¤„ç†ï¼Œè€ŒIOè®¾å¤‡åˆå¯ä»¥è£…å¡«ç¼“å†²åŒº1.è¦æ³¨æ„ï¼Œå¿…é¡»ç­‰ç¼“å†²åŒº2å……æ»¡æ‰èƒ½è®©å¤„ç†æœºä»ç¼“å†²åŒº2å–å‡ºæ•°æ®ã€‚åŒç¼“å†²æœºåˆ¶æé«˜äº†å¤„ç†æœºå’Œè¾“å…¥è®¾å¤‡çš„å¹¶è¡Œæ“ä½œçš„ç¨‹åº¦3ï¼‰å¾ªç¯ç¼“å†²ï¼šåŒ…å«å¤šä¸ªå¤§å°ç›¸ç­‰çš„ç¼“å†²åŒºï¼Œæ¯ä¸ªç¼“å†²åŒºä¸­æœ‰ä¸€ä¸ªé“¾æ¥æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªç¼“å†²ï¼Œæœ€åä¸€ä¸ªç¼“å†²åŒºæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªç¼“å†²åŒºï¼Œå¤šä¸ªç¼“å†²åŒºæ„æˆä¸€ä¸ªç¯å½¢ã€‚</p><p>å¾ªç¯ç¼“å†²ç”¨äºè¾“å…¥è¾“å‡ºæ—¶ï¼Œè¿˜éœ€è¦æœ‰ä¸¤ä¸ªæŒ‡é’ˆinå’Œoutå¯¹è¾“å…¥è€Œè¨€ï¼Œé¦–å…ˆè¦ä»è®¾å¤‡æ¥æ”¶æ•°æ®åˆ°ç¼“å†²åŒºä¸­ï¼ŒinæŒ‡é’ˆæŒ‡å‘å¯ä»¥è¾“å…¥æ•°æ®çš„ç¬¬ä¸€ä¸ªç©ºç¼“å†²åŒºï¼›å½“è¿è¡Œè¿›ç¨‹éœ€è¦æ•°æ®æ—¶ï¼Œä»å¾ªç¯ç¼“å†²åŒºä¸­å–ä¸€ä¸ªè£…æ»¡æ•°æ®çš„ç¼“å†²åŒºï¼Œå¹¶ä»æ­¤ç¼“å†²åŒºä¸­æå–æ•°æ®ï¼ŒoutæŒ‡é’ˆæŒ‡å‘å¯ä»¥æå–æ•°æ®çš„ç¬¬ä¸€ä¸ªæ»¡ç¼“å†²åŒºã€‚è¾“å‡ºåˆ™æ­£å¥½ç›¸å.</p><p>4ï¼‰ç¼“å†²æ± ï¼šç”±å¤šä¸ªç³»ç»Ÿå…¬ç”¨çš„ç¼“å†²åŒºç»„æˆï¼Œç¼“å†²åŒºæŒ‰å…¶ä½¿ç”¨çŠ¶å†µå¯ä»¥å½¢æˆä¸‰ä¸ªé˜Ÿåˆ—ï¼šç©ºç¼“å†²é˜Ÿåˆ—ã€è£…æ»¡è¾“å…¥æ•°æ®çš„ç¼“å†²é˜Ÿåˆ—ï¼ˆè¾“å…¥é˜Ÿåˆ—ï¼‰å’Œè£…æ»¡è¾“å‡ºæ•°æ®çš„ç¼“å†²é˜Ÿåˆ—ï¼ˆè¾“å‡ºé˜Ÿåˆ—ï¼‰.è¿˜åº”å…·æœ‰å››ç§ç¼“å†²åŒºï¼šç”¨äºæ”¶å®¹è¾“å…¥æ•°æ®çš„å·¥ä½œç¼“å†²åŒºã€ç”¨äºæå–è¾“å…¥æ•°æ®çš„å·¥ä½œç¼“å†²åŒºã€ç”¨äºæ”¶å®¹è¾“å‡ºæ•°æ®çš„å·¥ä½œç¼“å†²åŒºåŠç”¨äºæå–è¾“å‡ºæ•°æ®çš„å·¥ä½œç¼“å†²åŒº</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node-sasså®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/07/08/node-sass%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/07/08/node-sass%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="node-sasså®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ"><a href="#node-sasså®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ" class="headerlink" title="node-sasså®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ"></a>node-sasså®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ</h1><p>åœ¨Githubä¸Šçœ‹åˆ°ä¸€ä¸ªç”¨Vueå†™çš„<a href="https://github.com/is-liyiwei/vue-Chat-demo">ä»¿é€ VXçš„èŠå¤©ç•Œé¢</a>ï¼Œæ¯”è¾ƒç¾è§‚ï¼Œæƒ³ç”¨åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708171357360.png" alt="image-20210708171357360"></p><p>å¯æƒœ<code>npm install</code>åæ„å¤–å‘ç”Ÿäº†</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708171832501.png" alt="image-20210708171832501"></p><p>éƒ¨ç½²çš„æ—¶å€™æŠ¥é”™<code>Module build failed: Error: Cannot find module &#39;node-sass&#39;</code></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708171504322.png" alt="image-20210708171504322"></p><p>å¾ˆæ˜æ˜¾æ˜¯node-sassåŒ…å¹¶æ²¡æœ‰å®‰è£…æˆåŠŸï¼Œå½“æˆ‘ä»¥ä¸ºæ˜¯å¤–ç½‘çš„é—®é¢˜ï¼Œé‡è¯•ä½¿ç”¨æ·˜å®é•œåƒå®‰è£…çš„æ—¶å€™</p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm uninstall node-sass //ä½¿ç”¨æ·˜å®é•œåƒå®‰è£…npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/</code></pre></div><p>åˆæŠ¥äº†å…¶ä»–æ¨¡å—æ— æ³•è§£æçš„é”™è¯¯ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿˜è¿˜æ˜¯æ¨¡å—å®‰è£…ä¸å®Œå…¨çš„é—®é¢˜</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708172109790.png" alt="image-20210708172109790"></p><p>æ‰€ä»¥éœ€è¦é‡æ–°å®‰è£…ç›¸å…³çš„æ¨¡å—</p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm uninstall sass-loadernpm uninstall style-loadernpm install sass-loader@7.3.1 --save-devã€€ã€€ã€€ //å®‰è£…7.3.1ç‰ˆæœ¬çš„sassnpm install style-loader --save-dev // å®‰è£…style-loader</code></pre></div><p>å‘ç°è¿™é‡ŒåˆæŠ¥äº†ç‰ˆæœ¬ä¸å¯¹åº”çš„é”™è¯¯</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708172411081.png" alt="image-20210708172411081"></p><p>è¿™æ‰æç„¶å¤§æ‚Ÿï¼Œ<strong>æ·˜å®é•œåƒé»˜è®¤ä¸‹è½½çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„åŒ…ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸‹è½½çš„æ—¶å€™æŒ‡å®šç‰ˆæœ¬</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">npm uninstall node-sass npm i node-sass@4.14.1 --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/</code></pre></div><p>æœ€ç»ˆéƒ¨ç½²æˆåŠŸï¼ŒæˆåŠŸè§£å†³</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210708172544043.png" alt="image-20210708172544043"></p><p><strong>æ€»ç»“ï¼š</strong></p><p><strong>æ ¹æ®æŠ¥é”™å†…å®¹ï¼Œä¸€æ­¥ä¸€æ­¥çš„å»ä¿¡æ¯è§£å†³é—®é¢˜æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸€æ¬¡æŠ¥é”™ä¸å¯æ€•ï¼Œèƒ½ä»”ç»†è§‚å¯Ÿæ—¥è®°è§£å†³é—®é¢˜æ‰æ˜¯æœ€é‡è¦çš„ï¼Œå¸Œæœ›ä¸‹æ¬¡å¼•ä»¥ä¸ºæˆ’</strong></p>]]></content>
    
    
    <categories>
      
      <category>Bugè§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetBrains IDE Gitæ“ä½œæŠ¥é”™è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/06/07/JetBrains%20IDE%20Git%E6%93%8D%E4%BD%9C%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/06/07/JetBrains%20IDE%20Git%E6%93%8D%E4%BD%9C%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="JetBrains-IDE-GitæŠ¥é”™è§£å†³æ–¹æ¡ˆ"><a href="#JetBrains-IDE-GitæŠ¥é”™è§£å†³æ–¹æ¡ˆ" class="headerlink" title="JetBrains IDE GitæŠ¥é”™è§£å†³æ–¹æ¡ˆ"></a>JetBrains IDE GitæŠ¥é”™è§£å†³æ–¹æ¡ˆ</h1><p>åœ¨ä½¿ç”¨<code>IDEAã€WebStormã€PyCharm</code>çš„æ—¶å€™ï¼Œåœ¨è®¾ç½®Githubçš„æ—¶å€™</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607091401404.png" alt="image-20210607091401404"></p><p>æˆ–è€…åœ¨ä½¿ç”¨è‡ªå¸¦çš„ç‰ˆæœ¬ç®¡ç†æ’ä»¶è¿›è¡ŒGitæ“ä½œçš„æ—¶å€™</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607091600563.png" alt="image-20210607091600563"></p><p>å®¹æ˜“å‡ºç°<code>invalid authentication data. connection reset</code>æˆ–è€…<code>LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443 </code>ä¹‹ç±»çš„æŠ¥é”™ï¼Œè¯•è¿‡ç½‘ä¸Šè®¸å¤šè§£å†³æ–¹æ¡ˆï¼Œéƒ½æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§£ç­”</p><h2 id="å¦‚æœPingä¸é€š"><a href="#å¦‚æœPingä¸é€š" class="headerlink" title="å¦‚æœPingä¸é€š"></a>å¦‚æœPingä¸é€š</h2><p>åšä¸»æ˜¯ä½¿ç”¨äº†ä»£ç†å·¥å…·çš„ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ç½‘ç»œçš„é—®é¢˜ï¼Œä½†æ˜¯<code>ping github.com</code>ä¹Ÿèƒ½pingé€šï¼Œå¦‚æœæœ‰pingä¸é€šçš„è¯ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œåˆ©ç”¨åŸŸåè§£æå™¨ï¼Œçœ‹çœ‹github.comåŸŸåä¸‹æ˜ å°„çš„IPåœ°å€ï¼Œè¿™é‡Œå¯ä»¥å» <a href="https://fastly.net.ipaddress.com/github.global.ssl.fastly.net">https://fastly.net.ipaddress.com/github.global.ssl.fastly.net</a> ä¸ŠæŸ¥çœ‹è‡ªå·±çš„æ˜ å°„åœ°å€</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607092335451.png" alt="image-20210607092335451"></p><p>å¡«å…¥åˆ°è‡ªå·±çš„Hostæ–‡ä»¶é…ç½®ä¸­</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607092424140.png" alt="image-20210607092424140"></p><p><strong>åŸºæœ¬å°±èƒ½è§£å†³Pingçš„é—®é¢˜</strong></p><h2 id="invalid-authentication-data-connection-reset"><a href="#invalid-authentication-data-connection-reset" class="headerlink" title="invalid authentication data. connection reset"></a>invalid authentication data. connection reset</h2><p>è¿™æ˜¯ç”±äºä½¿ç”¨äº†ä»£ç†å·¥å…·ä½†æ˜¯åœ¨IDEå¹¶ä¸èƒ½æœ‰æ•ˆçš„è¯†åˆ«ï¼Œå…ˆè®¾ç½®</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607092615434.png" alt="image-20210607092615434"></p><p><strong>ç„¶åå°±å¯ä»¥å‘ç°æ·»åŠ è´¦å·æˆåŠŸ</strong></p><h2 id="LibreSSL-SSL-connect-SSL-ERROR-SYSCALL-in-connection-to-github-com-443"><a href="#LibreSSL-SSL-connect-SSL-ERROR-SYSCALL-in-connection-to-github-com-443" class="headerlink" title="LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443"></a>LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443</h2><p>è¿™æ—¶å€™è™½ç„¶èƒ½å¤Ÿé…ç½®ä¸ŠGithubè´¦å·ï¼Œä½†æ˜¯åœ¨é¡¹ç›®è¿›è¡ŒPushåˆ°githubçš„æ—¶å€™ä¼šå®¹æ˜“æŠ¥è¿™ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨äº†ä»£ç†å·¥å…·ï¼Œåœ¨<code>~</code>ç›®å½•ä¸‹ä½¿ç”¨<code>vim .gitconfig</code>ç›®å½•å¯¹Gitè¿›è¡Œé…ç½®ï¼Œæœ€ä¸ºå…³é”®çš„æ˜¯æ·»åŠ å¦‚ä¸‹é…ç½®</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210607093139972.png" alt="image-20210607093139972"></p><p>è¿›è¡Œå¦‚ä¸‹é…ç½®åï¼ŒPushæˆåŠŸ</p><blockquote><p>ä¸è¦ä¸€ä¸Šæ¥å°±è¿›è¡Œè¿™ä¸ªé…ç½®ï¼Œå¦‚æœå…ˆé…ç½®äº†è¿™ä¸ªï¼Œä¼šåœ¨è®¾ç½®Githubçš„æ—¶å€™æŠ¥é”™<code>invalid authentication data. connection reset</code>ï¼Œå…ˆè®¾ç½®å¥½Githubè´¦å·åéœ€è¦Pushçš„æ—¶å€™å†å†ä¸Šæ­¤é…ç½®è¡Œ</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Bugè§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java NIO</title>
    <link href="/2021/05/13/NIO/"/>
    <url>/2021/05/13/NIO/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-NIO"><a href="#Java-NIO" class="headerlink" title="Java NIO"></a>Java NIO</h1><h1 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h1><p>Java NIOï¼ˆNew IOï¼‰æ˜¯ä»Java 1.4ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„IO APIï¼Œ<strong>å¯ä»¥æ›¿ä»£æ ‡å‡†çš„Java IO API</strong>ã€‚NIOä¸åŸæ¥çš„IOæœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ–¹å¼å®Œå…¨ä¸åŒï¼ŒNIOæ”¯æŒ<strong>é¢å‘ç¼“å†²åŒºçš„ã€åŸºäºé€šé“çš„IOæ“ä½œ</strong>ã€‚NIOå°†ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚</p><h1 id="äºŒã€IOä¸NIOçš„åŒºåˆ«"><a href="#äºŒã€IOä¸NIOçš„åŒºåˆ«" class="headerlink" title="äºŒã€IOä¸NIOçš„åŒºåˆ«"></a>äºŒã€IOä¸NIOçš„åŒºåˆ«</h1><table><thead><tr><th>IO</th><th>NIO</th></tr></thead><tbody><tr><td>é¢å‘æµ(Stream Oriented)</td><td>é¢å‘ç¼“å†²åŒº(Buffer Oriented)</td></tr><tr><td>é˜»å¡IO(Blocking IO)</td><td>éé˜»å¡IO(NonBlocking IO)</td></tr><tr><td></td><td>é€‰æ‹©å™¨(Selectors)</td></tr></tbody></table><h2 id="é¢å‘æµå’Œç¼“å†²åŒº"><a href="#é¢å‘æµå’Œç¼“å†²åŒº" class="headerlink" title="é¢å‘æµå’Œç¼“å†²åŒº"></a>é¢å‘æµå’Œç¼“å†²åŒº</h2><p><strong>IO</strong></p><p>ä¼ ç»ŸIOåœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œæ ¹æ®è¾“å…¥è¾“å‡ºçš„ä¸åŒéœ€è¦åˆ†åˆ«å»ºç«‹ä¸åŒçš„é“¾æ¥ï¼Œè€Œä¸”ä¼ è¾“çš„æ•°æ®æ˜¯ä»¥æµçš„å½¢å¼åœ¨é“¾æ¥ä¸Šè¿›è¡Œä¼ è¾“çš„</p><p>å°±åƒè‡ªæ¥æ°´è¦é€šè¿‡æ°´ç®¡å°†è‡ªæ¥æ°´å‚å’Œå®¶è¿æ¥èµ·æ¥ä¸€æ ·</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109084453.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109084453.png" alt="img"></a></p><p><strong>NIO</strong></p><p>NIOåœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œä¼šåœ¨è¾“å…¥è¾“å‡ºç«¯ä¹‹é—´å»ºç«‹<strong>é€šé“</strong>ï¼Œç„¶åå°†æ•°æ®æ”¾å…¥åˆ°<strong>ç¼“å†²åŒº</strong>ä¸­ã€‚ç¼“å†²åŒºé€šè¿‡é€šé“æ¥ä¼ è¾“æ•°æ®</p><p>è¿™é‡Œé€šé“å°±åƒæ˜¯é“è·¯ï¼Œèƒ½å¤Ÿè¿é€šä¸¤ä¸ªåœ°ç‚¹ã€‚ç¼“å†²åŒºå°±åƒæ˜¯ç«è½¦ï¼Œèƒ½å¤ŸçœŸæ­£åœ°è¿›è¡Œæ•°æ®çš„ä¼ è¾“</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222459918.png" alt="image-20210513222459918"></p><h1 id="ä¸‰ã€é€šé“ä¸ç¼“å†²åŒº"><a href="#ä¸‰ã€é€šé“ä¸ç¼“å†²åŒº" class="headerlink" title="ä¸‰ã€é€šé“ä¸ç¼“å†²åŒº"></a>ä¸‰ã€é€šé“ä¸ç¼“å†²åŒº</h1><p>Java NIOç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºï¼š**é€šé“(Channel)å’Œç¼“å†²åŒº(Buffer)**ã€‚é€šé“è¡¨ç¤ºæ‰“å¼€åˆ° IO è®¾å¤‡(ä¾‹å¦‚ï¼šæ–‡ä»¶ã€å¥—æ¥å­—)çš„è¿æ¥ã€‚è‹¥éœ€è¦ä½¿ç”¨ NIO ç³»ç»Ÿï¼Œéœ€è¦è·å–ç”¨äºè¿æ¥ IO è®¾å¤‡çš„é€šé“ä»¥åŠç”¨äºå®¹çº³æ•°æ®çš„ç¼“å†²åŒºã€‚ç„¶åæ“ä½œç¼“å†²åŒºï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>é€šé“è´Ÿè´£ä¼ è¾“ï¼Œç¼“å†²åŒºè´Ÿè´£å­˜å‚¨</strong></p><h1 id="å››ã€ç¼“å†²åŒº-Buffer"><a href="#å››ã€ç¼“å†²åŒº-Buffer" class="headerlink" title="å››ã€ç¼“å†²åŒº(Buffer)"></a>å››ã€ç¼“å†²åŒº(Buffer)</h1><h2 id="1ã€ç¼“å†²åŒºç±»å‹"><a href="#1ã€ç¼“å†²åŒºç±»å‹" class="headerlink" title="1ã€ç¼“å†²åŒºç±»å‹"></a>1ã€ç¼“å†²åŒºç±»å‹</h2><p>Buffer å°±åƒä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ ¹æ®æ•°æ®ç±»å‹ä¸åŒ(<strong>boolean é™¤å¤–</strong>) ï¼Œæœ‰ä»¥ä¸‹Buffer å¸¸ç”¨å­ç±»</p><ul><li>ByteBuffer</li><li>CharBuffer</li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li></ul><p><strong>å„ç§ç±»å‹çš„ç¼“å†²åŒºä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”ç±»å‹çš„æ•°ç»„</strong>ï¼Œå¦‚</p><p>ByteBuffer</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span>[] hb;                  <span class="hljs-comment">// Non-null only for heap buffersCopy</span></code></pre></div><p>IntBuffer</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] hb;                  <span class="hljs-comment">// Non-null only for heap buffersCopy</span></code></pre></div><p><strong>ä»–ä»¬çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222534808.png" alt="image-20210513222534808"></p><h2 id="2ã€è·å–ç¼“å†²åŒº"><a href="#2ã€è·å–ç¼“å†²åŒº" class="headerlink" title="2ã€è·å–ç¼“å†²åŒº"></a>2ã€è·å–ç¼“å†²åŒº</h2><p>é€šè¿‡<strong>allocateæ–¹æ³•</strong>å¯ä»¥è·å–ä¸€ä¸ªå¯¹åº”ç¼“å†²åŒºçš„å¯¹è±¡ï¼Œå®ƒæ˜¯ç¼“å†²åŒºç±»çš„ä¸€ä¸ªé™æ€æ–¹æ³•</p><p>ä¾‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// è·å–ä¸€ä¸ªå®¹é‡å¤§å°ä¸º1024å­—èŠ‚çš„å­—èŠ‚ç¼“å†²åŒº</span>ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);</code></pre></div><h2 id="3ã€æ ¸å¿ƒå±æ€§"><a href="#3ã€æ ¸å¿ƒå±æ€§" class="headerlink" title="3ã€æ ¸å¿ƒå±æ€§"></a>3ã€æ ¸å¿ƒå±æ€§</h2><p>ç¼“å†²åŒºçš„çˆ¶ç±»Bufferä¸­æœ‰å‡ ä¸ªæ ¸å¿ƒå±æ€§ï¼Œå¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Invariants: mark &lt;= position &lt;= limit &lt;= capacity</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mark = -<span class="hljs-number">1</span>;<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> position = <span class="hljs-number">0</span>;<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> limit;<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;</code></pre></div><ul><li>capacityï¼šç¼“å†²åŒºçš„å®¹é‡ã€‚é€šè¿‡æ„é€ å‡½æ•°èµ‹äºˆï¼Œä¸€æ—¦è®¾ç½®ï¼Œæ— æ³•æ›´æ”¹</li><li>limitï¼šç¼“å†²åŒºçš„ç•Œé™ã€‚ä½äºlimit åçš„æ•°æ®ä¸å¯è¯»å†™ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”<strong>ä¸èƒ½å¤§äºå…¶å®¹é‡</strong></li><li>positionï¼š<strong>ä¸‹ä¸€ä¸ª</strong>è¯»å†™ä½ç½®çš„ç´¢å¼•ï¼ˆç±»ä¼¼PCï¼‰ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”<strong>ä¸èƒ½å¤§äºlimit</strong></li><li>markï¼šè®°å½•å½“å‰positionçš„å€¼ã€‚<strong>positionè¢«æ”¹å˜åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨reset() æ–¹æ³•æ¢å¤åˆ°markçš„ä½ç½®ã€‚</strong></li></ul><p>ä»¥ä¸Šå››ä¸ªå±æ€§å¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚</p><p><strong>mark &lt;= position &lt;= limit &lt;= capacity</strong></p><h2 id="4ã€æ ¸å¿ƒæ–¹æ³•"><a href="#4ã€æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="4ã€æ ¸å¿ƒæ–¹æ³•"></a>4ã€æ ¸å¿ƒæ–¹æ³•</h2><h4 id="put-æ–¹æ³•"><a href="#put-æ–¹æ³•" class="headerlink" title="put()æ–¹æ³•"></a>put()æ–¹æ³•</h4><ul><li>put()æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªæ•°æ®æ”¾å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚</li><li>è¿›è¡Œè¯¥æ“ä½œåï¼Œpostitionçš„å€¼ä¼š+1ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå¯ä»¥æ”¾å…¥çš„ä½ç½®ã€‚capacity = limit ï¼Œä¸ºç¼“å†²åŒºå®¹é‡çš„å€¼ã€‚</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222603127.png" alt="image-20210513222603127"></p><h4 id="flip-æ–¹æ³•"><a href="#flip-æ–¹æ³•" class="headerlink" title="flip()æ–¹æ³•"></a>flip()æ–¹æ³•</h4><ul><li>flip()æ–¹æ³•ä¼š<strong>åˆ‡æ¢å¯¹ç¼“å†²åŒºçš„æ“ä½œæ¨¡å¼</strong>ï¼Œç”±å†™-&gt;è¯» / è¯»-&gt;å†™</li><li>è¿›è¡Œè¯¥æ“ä½œå<ul><li>å¦‚æœæ˜¯å†™æ¨¡å¼-&gt;è¯»æ¨¡å¼ï¼Œposition = 0 ï¼Œ limit æŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œcapacityä¸å˜</li><li>å¦‚æœæ˜¯è¯»-&gt;å†™ï¼Œåˆ™æ¢å¤ä¸ºput()æ–¹æ³•ä¸­çš„å€¼</li></ul></li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222630105.png" alt="image-20210513222630105"></p><h4 id="get-æ–¹æ³•"><a href="#get-æ–¹æ³•" class="headerlink" title="get()æ–¹æ³•"></a>get()æ–¹æ³•</h4><ul><li>get()æ–¹æ³•ä¼šè¯»å–ç¼“å†²åŒºä¸­çš„ä¸€ä¸ªå€¼</li><li>è¿›è¡Œè¯¥æ“ä½œåï¼Œpositionä¼š+1ï¼Œå¦‚æœè¶…è¿‡äº†limitåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222642585.png" alt="image-20210513222642585"></p><h4 id="rewind-æ–¹æ³•"><a href="#rewind-æ–¹æ³•" class="headerlink" title="rewind()æ–¹æ³•"></a>rewind()æ–¹æ³•</h4><ul><li>è¯¥æ–¹æ³•<strong>åªèƒ½åœ¨è¯»æ¨¡å¼ä¸‹ä½¿ç”¨</strong></li><li>rewind()æ–¹æ³•åï¼Œä¼šæ¢å¤positionã€limitå’Œcapacityçš„å€¼ï¼Œå˜ä¸ºè¿›è¡Œget()å‰çš„å€¼</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222657733.png" alt="image-20210513222657733"></p><h4 id="clean-æ–¹æ³•"><a href="#clean-æ–¹æ³•" class="headerlink" title="clean()æ–¹æ³•"></a>clean()æ–¹æ³•</h4><ul><li>clean()æ–¹æ³•ä¼šå°†ç¼“å†²åŒºä¸­çš„å„ä¸ªå±æ€§æ¢å¤ä¸ºæœ€åˆçš„çŠ¶æ€ï¼Œposition = 0, capacity = limit</li><li><strong>æ­¤æ—¶ç¼“å†²åŒºçš„æ•°æ®ä¾ç„¶å­˜åœ¨</strong>ï¼Œå¤„äºâ€œè¢«é—å¿˜â€çŠ¶æ€ï¼Œä¸‹æ¬¡è¿›è¡Œå†™æ“ä½œæ—¶ä¼šè¦†ç›–è¿™äº›æ•°æ®</li></ul><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222714944.png" alt="image-20210513222714944"></p><h4 id="mark-å’Œreset-æ–¹æ³•"><a href="#mark-å’Œreset-æ–¹æ³•" class="headerlink" title="mark()å’Œreset()æ–¹æ³•"></a>mark()å’Œreset()æ–¹æ³•</h4><ul><li>mark()æ–¹æ³•ä¼šå°†postionçš„å€¼ä¿å­˜åˆ°markå±æ€§ä¸­</li><li>reset()æ–¹æ³•ä¼šå°†positionçš„å€¼æ”¹ä¸ºmarkä¸­ä¿å­˜çš„å€¼</li></ul><h4 id="ä½¿ç”¨å±•ç¤º"><a href="#ä½¿ç”¨å±•ç¤º" class="headerlink" title="ä½¿ç”¨å±•ç¤º"></a>ä½¿ç”¨å±•ç¤º</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        System.out.println(<span class="hljs-string">&quot;æ”¾å…¥å‰å‚æ•°&quot;</span>);        System.out.println(<span class="hljs-string">&quot;position &quot;</span> + byteBuffer.position());        System.out.println(<span class="hljs-string">&quot;limit &quot;</span> + byteBuffer.limit());        System.out.println(<span class="hljs-string">&quot;capacity &quot;</span> + byteBuffer.capacity());        System.out.println();        System.out.println(<span class="hljs-string">&quot;------put()------&quot;</span>);        System.out.println(<span class="hljs-string">&quot;æ”¾å…¥3ä¸ªæ•°æ®&quot;</span>);        <span class="hljs-keyword">byte</span> bt = <span class="hljs-number">1</span>;        byteBuffer.put(bt);        byteBuffer.put(bt);        byteBuffer.put(bt);        System.out.println(<span class="hljs-string">&quot;æ”¾å…¥åå‚æ•°&quot;</span>);        System.out.println(<span class="hljs-string">&quot;position &quot;</span> + byteBuffer.position());        System.out.println(<span class="hljs-string">&quot;limit &quot;</span> + byteBuffer.limit());        System.out.println(<span class="hljs-string">&quot;capacity &quot;</span> + byteBuffer.capacity());        System.out.println();        System.out.println(<span class="hljs-string">&quot;------flip()-get()------&quot;</span>);        System.out.println(<span class="hljs-string">&quot;è¯»å–ä¸€ä¸ªæ•°æ®&quot;</span>);        <span class="hljs-comment">// åˆ‡æ¢æ¨¡å¼</span>        byteBuffer.flip();        byteBuffer.get();        System.out.println(<span class="hljs-string">&quot;è¯»å–åå‚æ•°&quot;</span>);        System.out.println(<span class="hljs-string">&quot;position &quot;</span> + byteBuffer.position());        System.out.println(<span class="hljs-string">&quot;limit &quot;</span> + byteBuffer.limit());        System.out.println(<span class="hljs-string">&quot;capacity &quot;</span> + byteBuffer.capacity());        System.out.println();        System.out.println(<span class="hljs-string">&quot;------rewind()------&quot;</span>);        byteBuffer.rewind();        System.out.println(<span class="hljs-string">&quot;æ¢å¤åå‚æ•°&quot;</span>);        System.out.println(<span class="hljs-string">&quot;position &quot;</span> + byteBuffer.position());        System.out.println(<span class="hljs-string">&quot;limit &quot;</span> + byteBuffer.limit());        System.out.println(<span class="hljs-string">&quot;capacity &quot;</span> + byteBuffer.capacity());        System.out.println();        System.out.println(<span class="hljs-string">&quot;------clear()------&quot;</span>);        <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒºï¼Œè¿™é‡Œåªæ˜¯æ¢å¤äº†å„ä¸ªå±æ€§çš„å€¼ï¼Œä½†æ˜¯ç¼“å†²åŒºé‡Œçš„æ•°æ®ä¾ç„¶å­˜åœ¨</span>        <span class="hljs-comment">// ä½†æ˜¯ä¸‹æ¬¡å†™å…¥çš„æ—¶å€™ä¼šè¦†ç›–ç¼“å†²åŒºä¸­ä¹‹å‰çš„æ•°æ®</span>        byteBuffer.clear();        System.out.println(<span class="hljs-string">&quot;æ¸…ç©ºåå‚æ•°&quot;</span>);        System.out.println(<span class="hljs-string">&quot;position &quot;</span> + byteBuffer.position());        System.out.println(<span class="hljs-string">&quot;limit &quot;</span> + byteBuffer.limit());        System.out.println(<span class="hljs-string">&quot;capacity &quot;</span> + byteBuffer.capacity());        System.out.println();        System.out.println(<span class="hljs-string">&quot;æ¸…ç©ºåè·å¾—æ•°æ®&quot;</span>);        System.out.println(byteBuffer.get());    &#125;&#125;</code></pre></div><p>æ‰“å°ç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs java">æ”¾å…¥å‰å‚æ•°position <span class="hljs-number">0</span>limit <span class="hljs-number">1024</span>capacity <span class="hljs-number">1024</span>------put()------æ”¾å…¥<span class="hljs-number">3</span>ä¸ªæ•°æ®æ”¾å…¥åå‚æ•°position <span class="hljs-number">3</span>limit <span class="hljs-number">1024</span>capacity <span class="hljs-number">1024</span>------flip()-get()------è¯»å–ä¸€ä¸ªæ•°æ®è¯»å–åå‚æ•°position <span class="hljs-number">1</span>limit <span class="hljs-number">3</span>capacity <span class="hljs-number">1024</span>------rewind()------æ¢å¤åå‚æ•°position <span class="hljs-number">0</span>limit <span class="hljs-number">3</span>capacity <span class="hljs-number">1024</span>------clear()------æ¸…ç©ºåå‚æ•°position <span class="hljs-number">0</span>limit <span class="hljs-number">1024</span>capacity <span class="hljs-number">1024</span>æ¸…ç©ºåè·å¾—æ•°æ®<span class="hljs-number">1</span></code></pre></div><h2 id="5ã€éç›´æ¥ç¼“å†²åŒºå’Œç›´æ¥ç¼“å†²åŒº"><a href="#5ã€éç›´æ¥ç¼“å†²åŒºå’Œç›´æ¥ç¼“å†²åŒº" class="headerlink" title="5ã€éç›´æ¥ç¼“å†²åŒºå’Œç›´æ¥ç¼“å†²åŒº"></a>5ã€éç›´æ¥ç¼“å†²åŒºå’Œç›´æ¥ç¼“å†²åŒº</h2><h4 id="éç›´æ¥ç¼“å†²åŒº"><a href="#éç›´æ¥ç¼“å†²åŒº" class="headerlink" title="éç›´æ¥ç¼“å†²åŒº"></a>éç›´æ¥ç¼“å†²åŒº</h4><p>é€šè¿‡<strong>allocate()<strong>æ–¹æ³•è·å–çš„ç¼“å†²åŒºéƒ½æ˜¯éç›´æ¥ç¼“å†²åŒºã€‚è¿™äº›ç¼“å†²åŒºæ˜¯å»ºç«‹åœ¨JVM</strong>å †å†…å­˜</strong>ä¹‹ä¸­çš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;    <span class="hljs-keyword">if</span> (capacity &lt; <span class="hljs-number">0</span>)    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();    <span class="hljs-comment">// åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HeapByteBuffer(capacity, capacity);&#125;HeapByteBuffer(<span class="hljs-keyword">int</span> cap, <span class="hljs-keyword">int</span> lim) &#123;        <span class="hljs-comment">// package-private</span>    <span class="hljs-comment">// new byte[cap] åˆ›å»ºæ•°ç»„ï¼Œåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´</span>    <span class="hljs-keyword">super</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, lim, cap, <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[cap], <span class="hljs-number">0</span>);    <span class="hljs-comment">/*</span><span class="hljs-comment">    hb = new byte[cap];</span><span class="hljs-comment">    offset = 0;</span><span class="hljs-comment">    */</span>&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222737771.png" alt="image-20210513222737771"></p><p>é€šè¿‡éç›´æ¥ç¼“å†²åŒºï¼Œæƒ³è¦å°†æ•°æ®å†™å…¥åˆ°ç‰©ç†ç£ç›˜ä¸­ï¼Œæˆ–è€…æ˜¯ä»ç‰©ç†ç£ç›˜è¯»å–æ•°æ®ã€‚<strong>éƒ½éœ€è¦ç»è¿‡JVMå’Œæ“ä½œç³»ç»Ÿ</strong>ï¼Œæ•°æ®åœ¨ä¸¤ä¸ªåœ°å€ç©ºé—´ä¸­ä¼ è¾“æ—¶ï¼Œä¼š<strong>copy</strong>ä¸€ä»½ä¿å­˜åœ¨å¯¹æ–¹çš„ç©ºé—´ä¸­ã€‚æ‰€ä»¥è´¹ç›´æ¥ç¼“å†²åŒºçš„è¯»å–æ•ˆç‡è¾ƒä½</p><h4 id="ç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ç¼“å†²åŒº</h4><p><strong>åªæœ‰ByteBufferå¯ä»¥è·å¾—ç›´æ¥ç¼“å†²åŒº</strong>ï¼Œé€šè¿‡allocateDirect()è·å–çš„ç¼“å†²åŒºä¸ºç›´æ¥ç¼“å†²åŒºï¼Œè¿™äº›ç¼“å†²åŒºæ˜¯å»ºç«‹åœ¨<strong>ç‰©ç†å†…å­˜</strong>ä¹‹ä¸­çš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocateDirect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectByteBuffer(capacity);&#125;DirectByteBuffer(<span class="hljs-keyword">int</span> cap) &#123;                   <span class="hljs-comment">// package-private</span>    ...    <span class="hljs-comment">// ç”³è¯·ç‰©ç†å†…å­˜</span>    <span class="hljs-keyword">boolean</span> pa = VM.isDirectMemoryPageAligned();    ...&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222756664.png" alt="image-20210513222756664"></p><p>ç›´æ¥ç¼“å†²åŒºé€šè¿‡åœ¨æ“ä½œç³»ç»Ÿå’ŒJVMä¹‹é—´åˆ›å»º<strong>ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶</strong>åŠ å¿«ç¼“å†²åŒºæ•°æ®è¯»/å†™å…¥ç‰©ç†ç£ç›˜çš„é€Ÿåº¦ã€‚æ”¾åˆ°ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„æ•°æ®å°±ä¸å½’åº”ç”¨ç¨‹åºæ§åˆ¶äº†ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„æ•°æ®å†™å…¥åˆ°ç‰©ç†å†…å­˜ä¸­</p><h1 id="äº”ã€é€šé“-Channel"><a href="#äº”ã€é€šé“-Channel" class="headerlink" title="äº”ã€é€šé“(Channel)"></a>äº”ã€é€šé“(Channel)</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>Channelç”±java.nio.channels åŒ…å®šä¹‰çš„ã€‚Channel è¡¨ç¤º<strong>IO æºä¸ç›®æ ‡æ‰“å¼€çš„è¿æ¥</strong>ã€‚Channel ç±»ä¼¼äºä¼ ç»Ÿçš„â€œæµâ€ã€‚åªä¸è¿‡<strong>Channel æœ¬èº«ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®ï¼ŒChannel åªèƒ½ä¸Buffer è¿›è¡Œäº¤äº’</strong></p><h2 id="2ã€å›¾è§£"><a href="#2ã€å›¾è§£" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h2><p>åº”ç”¨ç¨‹åºè¿›è¡Œè¯»å†™æ“ä½œè°ƒç”¨å‡½æ•°æ—¶ï¼Œ<strong>åº•å±‚è°ƒç”¨çš„æ“ä½œç³»ç»Ÿæä¾›ç»™ç”¨æˆ·çš„è¯»å†™API</strong>ï¼Œè°ƒç”¨è¿™äº›APIæ—¶ä¼šç”Ÿæˆå¯¹åº”çš„æŒ‡ä»¤ï¼ŒCPUåˆ™ä¼šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚åœ¨è®¡ç®—æœºåˆšå‡ºç°çš„é‚£æ®µæ—¶é—´ï¼Œ<strong>æ‰€æœ‰è¯»å†™è¯·æ±‚çš„æŒ‡ä»¤éƒ½æœ‰CPUå»æ‰§è¡Œ</strong>ï¼Œè¿‡å¤šçš„è¯»å†™è¯·æ±‚ä¼šå¯¼è‡´CPUæ— æ³•å»æ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œä»è€ŒCPUçš„åˆ©ç”¨ç‡é™ä½</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222809288.png" alt="image-20210513222809288"></p><p>åæ¥ï¼Œ<strong>DMA</strong>(Direct Memory Accessï¼Œç›´æ¥å­˜å‚¨å™¨è®¿é—®)å‡ºç°äº†ã€‚å½“IOè¯·æ±‚ä¼ åˆ°è®¡ç®—æœºåº•å±‚æ—¶ï¼Œ<strong>DMAä¼šå‘CPUè¯·æ±‚ï¼Œè®©DMAå»å¤„ç†è¿™äº›IOæ“ä½œ</strong>ï¼Œä»è€Œå¯ä»¥è®©CPUå»æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ã€‚DMAå¤„ç†IOæ“ä½œæ—¶ï¼Œä¼šè¯·æ±‚è·å–æ€»çº¿çš„ä½¿ç”¨æƒã€‚<strong>å½“IOè¯·æ±‚è¿‡å¤šæ—¶ï¼Œä¼šå¯¼è‡´å¤§é‡æ€»çº¿ç”¨äºå¤„ç†IOè¯·æ±‚ï¼Œä»è€Œé™ä½æ•ˆç‡</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222817234.png" alt="image-20210513222817234"></p><p>äºæ˜¯ä¾¿æœ‰äº†<strong>Channel(é€šé“)<strong>ï¼ŒChannelç›¸å½“äºä¸€ä¸ª</strong>ä¸“é—¨ç”¨äºIOæ“ä½œçš„ç‹¬ç«‹å¤„ç†å™¨</strong>ï¼Œå®ƒå…·æœ‰ç‹¬ç«‹å¤„ç†IOè¯·æ±‚çš„èƒ½åŠ›ï¼Œå½“æœ‰IOè¯·æ±‚æ—¶ï¼Œå®ƒä¼šè‡ªè¡Œå¤„ç†è¿™äº›IOè¯·æ±‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222824224.png" alt="image-20210513222824224"></p><h2 id="3ã€Java-Channel"><a href="#3ã€Java-Channel" class="headerlink" title="3ã€Java Channel"></a>3ã€Java Channel</h2><h4 id="å¸¸ç”¨å®ç°ç±»"><a href="#å¸¸ç”¨å®ç°ç±»" class="headerlink" title="å¸¸ç”¨å®ç°ç±»"></a>å¸¸ç”¨å®ç°ç±»</h4><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222909219.png" alt="image-20210513222909219"></p><ul><li>æœ¬åœ°æ–‡ä»¶IO<ul><li>FileChannel</li></ul></li><li>ç½‘ç»œIO<ul><li>SocketChanelã€ServerSocketChannelï¼šç”¨äºTCPä¼ è¾“</li><li>DatagramChannelï¼šç”¨äºUDPä¼ è¾“</li></ul></li></ul><h4 id="è·å¾—é€šé“çš„æ–¹æ³•"><a href="#è·å¾—é€šé“çš„æ–¹æ³•" class="headerlink" title="è·å¾—é€šé“çš„æ–¹æ³•"></a>è·å¾—é€šé“çš„æ–¹æ³•</h4><p>è·å–é€šé“çš„ä¸€ç§æ–¹å¼æ˜¯å¯¹æ”¯æŒé€šé“çš„<strong>å¯¹è±¡è°ƒç”¨getChannel() æ–¹æ³•</strong>ã€‚æ”¯æŒé€šé“çš„ç±»å¦‚ä¸‹ï¼š</p><ul><li>FileInputStream</li><li>FileOutputStream</li><li>RandomAccessFile</li><li>DatagramSocket</li><li>Socket</li><li>ServerSocket</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      <span class="hljs-comment">// æœ¬åœ°é€šé“</span>      FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;&quot;</span>);      FileChannel channel1 = fileInputStream.getChannel();      FileOutputStream fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;&quot;</span>);      FileChannel channel2 = fileOutputStream.getChannel();      <span class="hljs-comment">// ç½‘ç»œé€šé“</span>      Socket socket = <span class="hljs-keyword">new</span> Socket();      SocketChannel channel3 = socket.getChannel();      ServerSocket serverSocket = <span class="hljs-keyword">new</span> ServerSocket();      ServerSocketChannel channel4 = serverSocket.getChannel();      DatagramSocket datagramSocket = <span class="hljs-keyword">new</span> DatagramSocket();      DatagramChannel channel5 = datagramSocket.getChannel();      <span class="hljs-comment">// æœ€åè¦å…³é—­é€šé“</span>   &#125;&#125;</code></pre></div><p><strong>ä¹Ÿå¯ä»¥é€šè¿‡é€šé“çš„é™æ€æ–¹æ³•open()æ¥è·å–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;   FileChannel open = FileChannel.open(Paths.get(<span class="hljs-string">&quot;&quot;</span>));   SocketChannel open1 = SocketChannel.open();   ...&#125;</code></pre></div><p><strong>åŒæ—¶å¯ä»¥åˆ©ç”¨Fileså·¥å…·ç±»çš„newByteChannel()æ–¹æ³•æ¥è·å–</strong></p><h4 id="getChannel-éç›´æ¥ç¼“å†²åŒº"><a href="#getChannel-éç›´æ¥ç¼“å†²åŒº" class="headerlink" title="getChannel()+éç›´æ¥ç¼“å†²åŒº"></a>getChannel()+éç›´æ¥ç¼“å†²åŒº</h4><ul><li>getChannel()è·å¾—é€šé“</li><li>allocate()è·å¾—<strong>éç›´æ¥ç¼“å†²åŒº</strong></li></ul><p>é€šè¿‡éç›´æ¥ç¼“å†²åŒºè¯»å†™æ•°æ®ï¼Œéœ€è¦é€šè¿‡é€šé“æ¥ä¼ è¾“ç¼“å†²åŒºé‡Œçš„æ•°æ®</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      FileInputStream is = <span class="hljs-keyword">null</span>;      FileOutputStream os = <span class="hljs-keyword">null</span>;      <span class="hljs-comment">// è·å¾—é€šé“</span>      FileChannel inChannel = <span class="hljs-keyword">null</span>;      FileChannel outChannel = <span class="hljs-keyword">null</span>;      <span class="hljs-comment">// åˆ©ç”¨ try-catch-finally ä¿è¯å…³é—­</span>      <span class="hljs-keyword">try</span> &#123;         is = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\1.jpg&quot;</span>);         os = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\2.jpg&quot;</span>);         <span class="hljs-comment">// è·å¾—é€šé“</span>         inChannel = is.getChannel();         outChannel = os.getChannel();         <span class="hljs-comment">// è·å¾—ç¼“å†²åŒºï¼Œç”¨äºåœ¨é€šé“ä¸­ä¼ è¾“æ•°æ®</span>         ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);         <span class="hljs-comment">// å¾ªç¯å°†å­—èŠ‚æ•°æ®æ”¾å…¥åˆ°bufferä¸­ï¼Œç„¶åå†™å…¥ç£ç›˜ä¸­</span>         <span class="hljs-keyword">while</span> (inChannel.read(byteBuffer) != -<span class="hljs-number">1</span>) &#123;            <span class="hljs-comment">// åˆ‡æ¢æ¨¡å¼</span>            byteBuffer.flip();            outChannel.write(byteBuffer);            byteBuffer.clear();         &#125;      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;         e.printStackTrace();      &#125; <span class="hljs-keyword">finally</span> &#123;         <span class="hljs-keyword">if</span> (inChannel != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;               inChannel.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;               e.printStackTrace();            &#125;         &#125;         <span class="hljs-keyword">if</span> (outChannel != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;               outChannel.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;               e.printStackTrace();            &#125;         &#125;         <span class="hljs-keyword">if</span> (is != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;               is.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;               e.printStackTrace();            &#125;         &#125;         <span class="hljs-keyword">if</span> (os != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;               os.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;               e.printStackTrace();            &#125;         &#125;      &#125;   &#125;&#125;</code></pre></div><p><strong>å›¾ç‰‡è¯»å–åï¼Œè¢«å†™å…¥åˆ°äº†æŒ‡å®šä½ç½®</strong><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222934130.png" alt="image-20210513222934130"></p><h4 id="open-ç›´æ¥ç¼“å†²åŒº"><a href="#open-ç›´æ¥ç¼“å†²åŒº" class="headerlink" title="open()+ç›´æ¥ç¼“å†²åŒº"></a>open()+ç›´æ¥ç¼“å†²åŒº</h4><ul><li>é€šè¿‡openè·å¾—é€šé“</li><li>é€šè¿‡FileChannel.map()è·å–ç›´æ¥ç¼“å†²åŒº</li></ul><p>ä½¿ç”¨ç›´æ¥ç¼“å†²åŒºæ—¶ï¼Œæ— éœ€é€šè¿‡é€šé“æ¥ä¼ è¾“æ•°æ®ï¼Œç›´æ¥å°†æ•°æ®æ”¾åœ¨ç¼“å†²åŒºå†…å³å¯</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      <span class="hljs-comment">// é€šè¿‡open()æ–¹æ³•æ¥è·å¾—é€šé“</span>      FileChannel inChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\1.jpg&quot;</span>), StandardOpenOption.READ);      <span class="hljs-comment">// outChanneléœ€è¦ä¸º READ WRITE CREATEæ¨¡å¼</span>      <span class="hljs-comment">// READ WRITEæ˜¯å› ä¸ºåé¢è·å–ç›´æ¥ç¼“å†²åŒºæ—¶æ¨¡å¼ä¸ºREAD_WRITEæ¨¡å¼</span>      <span class="hljs-comment">// CREATEæ˜¯å› ä¸ºè¦åˆ›å»ºæ–°çš„æ–‡ä»¶</span>      FileChannel outChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\3.jpg&quot;</span>), StandardOpenOption.READ, StandardOpenOption.WRITE, StandardOpenOption.CREATE);      <span class="hljs-comment">// è·å¾—ç›´æ¥ç¼“å†²åŒº</span>      MappedByteBuffer inMapBuf = inChannel.map(FileChannel.MapMode.READ_ONLY, <span class="hljs-number">0</span>, inChannel.size());      MappedByteBuffer outMapBuf = outChannel.map(FileChannel.MapMode.READ_WRITE, <span class="hljs-number">0</span>, inChannel.size());      <span class="hljs-comment">// å­—èŠ‚æ•°ç»„</span>      <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[inMapBuf.limit()];      <span class="hljs-comment">// å› ä¸ºæ˜¯ç›´æ¥ç¼“å†²åŒºï¼Œå¯ä»¥ç›´æ¥å°†æ•°æ®æ”¾å…¥åˆ°å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œæ— éœ€é€šè¿‡é€šé“ä¼ è¾“</span>      inMapBuf.get(bytes);      outMapBuf.put(bytes);      <span class="hljs-comment">// å…³é—­ç¼“å†²åŒºï¼Œè¿™é‡Œæ²¡æœ‰ç”¨try-catch-finally</span>      inChannel.close();      outChannel.close();   &#125;&#125;</code></pre></div><p><strong>è¿è¡Œç»“æœï¼Œå›¾ç‰‡è¢«åˆ›å»º</strong><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513222959909.png" alt="image-20210513222959909"></p><h4 id="é€šé“é—´ç›´æ¥ä¼ è¾“"><a href="#é€šé“é—´ç›´æ¥ä¼ è¾“" class="headerlink" title="é€šé“é—´ç›´æ¥ä¼ è¾“"></a>é€šé“é—´ç›´æ¥ä¼ è¾“</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelToChannel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;   <span class="hljs-keyword">long</span> start = System.currentTimeMillis();   <span class="hljs-comment">// é€šè¿‡open()æ–¹æ³•æ¥è·å¾—é€šé“</span>   FileChannel inChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\1.mp4&quot;</span>), StandardOpenOption.READ);   <span class="hljs-comment">// outChanneléœ€è¦ä¸º READ WRITE CREATEæ¨¡å¼</span>   <span class="hljs-comment">// READ WRITEæ˜¯å› ä¸ºåé¢è·å–ç›´æ¥ç¼“å†²åŒºæ—¶æ¨¡å¼ä¸ºREAD_WRITEæ¨¡å¼</span>   <span class="hljs-comment">// CREATEæ˜¯å› ä¸ºè¦åˆ›å»ºæ–°çš„æ–‡ä»¶</span>   FileChannel outChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\NIO\\day1\\4.mp4&quot;</span>), StandardOpenOption.READ, StandardOpenOption.WRITE, StandardOpenOption.CREATE);   <span class="hljs-comment">// é€šé“é—´ç›´æ¥ä¼ è¾“</span>   inChannel.transferTo(<span class="hljs-number">0</span>, inChannel.size(), outChannel);   <span class="hljs-comment">// å¯¹åº”çš„è¿˜æœ‰transferFrom</span>   <span class="hljs-comment">// outChannel.transferFrom(inChannel, 0, inChannel.size());</span>   inChannel.close();   outChannel.close();&#125;</code></pre></div><h4 id="ç›´æ¥ç¼“å†²åŒºVSéç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ç¼“å†²åŒºVSéç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ç¼“å†²åŒºVSéç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ç¼“å†²åŒºVSéç›´æ¥ç¼“å†²åŒº</h4><p><strong>æ•ˆç‡</strong></p><p>è¯»å–ä¸€ä¸ªMP4æ–‡ä»¶ï¼Œé€šè¿‡äºŒè€…èŠ±è´¹æ—¶é—´çš„å¤šå°‘æ¥åˆ¤å®šæ‰§è¡Œçš„é€Ÿåº¦</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// getChannel() + éç›´æ¥ç¼“å†²åŒºè€—æ—¶</span><span class="hljs-number">708</span><span class="hljs-comment">// open() + ç›´æ¥ç¼“å†²åŒºè€—æ—¶</span><span class="hljs-number">115</span><span class="hljs-comment">// channel transferTo channelè€—æ—¶</span><span class="hljs-number">47</span></code></pre></div><p><strong>å†…å­˜å ç”¨</strong></p><p>ç›´æ¥ç¼“å†²åŒºçš„è¯»å†™é€Ÿåº¦è™½ç„¶å¾ˆå¿«ï¼Œä½†æ˜¯ä¼šå ç”¨å¾ˆå¤šå¾ˆå¤šå†…å­˜ç©ºé—´ã€‚å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œä¼šä½¿å¾—è®¡ç®—æœºè¿è¡Œé€Ÿåº¦å˜æ…¢</p><h2 id="4ã€åˆ†æ•£å’Œèšé›†"><a href="#4ã€åˆ†æ•£å’Œèšé›†" class="headerlink" title="4ã€åˆ†æ•£å’Œèšé›†"></a>4ã€åˆ†æ•£å’Œèšé›†</h2><h4 id="åˆ†æ•£è¯»å–"><a href="#åˆ†æ•£è¯»å–" class="headerlink" title="åˆ†æ•£è¯»å–"></a>åˆ†æ•£è¯»å–</h4><p>åˆ†æ•£è¯»å–ï¼ˆScattering Readsï¼‰æ˜¯æŒ‡<strong>ä»Channel ä¸­è¯»å–çš„æ•°æ®â€œåˆ†æ•£â€åˆ°å¤šä¸ªBuffer ä¸­</strong></p><p><strong>æ³¨æ„</strong>ï¼šæŒ‰ç…§ç¼“å†²åŒºçš„<strong>é¡ºåº</strong>ï¼Œä»Channel ä¸­è¯»å–çš„æ•°æ®ä¾æ¬¡å°† Buffer å¡«æ»¡</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223014213.png" alt="image-20210513223014213"></p><h4 id="èšé›†å†™å…¥"><a href="#èšé›†å†™å…¥" class="headerlink" title="èšé›†å†™å…¥"></a>èšé›†å†™å…¥</h4><p>èšé›†å†™å…¥ï¼ˆGathering Writesï¼‰æ˜¯æŒ‡å°†<strong>å¤šä¸ªBuffer ä¸­çš„æ•°æ®â€œèšé›†â€åˆ°Channel</strong></p><p>æŒ‰ç…§ç¼“å†²åŒºçš„<strong>é¡ºåº</strong>ï¼Œå†™å…¥position å’Œlimit ä¹‹é—´çš„æ•°æ®åˆ°Channel </p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223022650.png" alt="image-20210513223022650"></p><p><strong>ä»£ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      FileInputStream is = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\nio\\day2\\è®¡åˆ’.txt&quot;</span>);      FileOutputStream os = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\nio\\day2\\è®¡åˆ’2.txt&quot;</span>);      FileChannel inChannel = is.getChannel();      FileChannel outChannel = os.getChannel();      <span class="hljs-comment">// è·å¾—å¤šä¸ªç¼“å†²åŒºï¼Œå¹¶ä¸”æ”¾å…¥åˆ°ç¼“å†²åŒºæ•°ç»„ä¸­</span>      ByteBuffer byteBuffer1 = ByteBuffer.allocate(<span class="hljs-number">50</span>);      ByteBuffer byteBuffer2 = ByteBuffer.allocate(<span class="hljs-number">1024</span>);      ByteBuffer[] byteBuffers = &#123;byteBuffer1, byteBuffer2&#125;;      <span class="hljs-comment">// åˆ†æ•£è¯»å–</span>      inChannel.read(byteBuffers);      byteBuffer1.flip();      byteBuffer2.flip();      <span class="hljs-comment">//æ‰“å°ç»“æœ</span>      System.out.println(<span class="hljs-keyword">new</span> String(byteBuffers[<span class="hljs-number">0</span>].array(),<span class="hljs-number">0</span>,byteBuffers[<span class="hljs-number">0</span>].limit()));      System.out.println(<span class="hljs-string">&quot;--------------&quot;</span>);      System.out.println(<span class="hljs-keyword">new</span> String(byteBuffers[<span class="hljs-number">1</span>].array(),<span class="hljs-number">0</span>,byteBuffers[<span class="hljs-number">1</span>].limit()));      <span class="hljs-comment">// èšé›†å†™å…¥</span>      outChannel.write(byteBuffers);   &#125;&#125;</code></pre></div><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223043503.png" alt="image-20210513223043503"></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223052049.png" alt="image-20210513223052049"></p><h1 id="å…­ã€éé˜»å¡å¼ç½‘ç»œé€šä¿¡"><a href="#å…­ã€éé˜»å¡å¼ç½‘ç»œé€šä¿¡" class="headerlink" title="å…­ã€éé˜»å¡å¼ç½‘ç»œé€šä¿¡"></a>å…­ã€éé˜»å¡å¼ç½‘ç»œé€šä¿¡</h1><h2 id="1ã€æ¦‚å¿µ"><a href="#1ã€æ¦‚å¿µ" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h2><h4 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>åŒ11ä¹°çš„å¿«é€’åˆ°äº†ï¼Œå¿«é€’å°å“¥ç»™ä½ æ‰“ç”µè¯è¯´é©¬ä¸Šåˆ°ï¼Œéº»çƒ¦åœ¨é—¨å£ç­‰ä¸€ä¸‹ï¼Œæ–¹ä¾¿ç­¾æ”¶å¿«é€’</p><ul><li>è‹¥ä¸º<strong>é˜»å¡å¼</strong>çš„ï¼Œä½ åˆ°äº†å°åŒºé—¨å£ä»¥åï¼Œå¿«é€’å°å“¥è¿˜æ²¡åˆ°çš„æœŸé—´ï¼Œä½ ä»€ä¹ˆäº‹å„¿ä¹Ÿåšä¸äº†</li><li>è‹¥ä¸º<strong>éé˜»å¡å¼</strong>çš„ï¼Œå¿«é€’å°å“¥å°†å¿«é€’æ”¾åˆ°é—¨å«å¤„ï¼Œé—¨å«ç»™ä½ å‘æ¶ˆæ¯è¯´å¿«é€’åˆ°äº†ï¼Œéº»çƒ¦å»å–ä¸€ä¸‹ã€‚å½“å¿«é€’è¿˜æ²¡åˆ°çš„æ—¶å€™ä½ å¯ä»¥åšä½ è‡ªå·±çš„äº‹å„¿</li></ul><h4 id="é˜»å¡å¼ç½‘ç»œé€šä¿¡"><a href="#é˜»å¡å¼ç½‘ç»œé€šä¿¡" class="headerlink" title="é˜»å¡å¼ç½‘ç»œé€šä¿¡"></a>é˜»å¡å¼ç½‘ç»œé€šä¿¡</h4><p>ä¼ ç»Ÿçš„IO æµéƒ½æ˜¯é˜»å¡å¼çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨read() æˆ–write() æ—¶ï¼Œ<strong>è¯¥çº¿ç¨‹è¢«é˜»å¡</strong>ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–æˆ–å†™å…¥ï¼Œè¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½æ‰§è¡Œå…¶ä»–ä»»åŠ¡</p><p>å› æ­¤ï¼Œåœ¨å®Œæˆç½‘ç»œé€šä¿¡è¿›è¡ŒIO æ“ä½œæ—¶ï¼Œç”±äºçº¿ç¨‹ä¼šé˜»å¡ï¼Œæ‰€ä»¥<strong>æœåŠ¡å™¨ç«¯å¿…é¡»ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½æä¾›ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹è¿›è¡Œå¤„ç†</strong>ï¼Œå½“æœåŠ¡å™¨ç«¯éœ€è¦å¤„ç†å¤§é‡å®¢æˆ·ç«¯æ—¶ï¼Œ<strong>æ€§èƒ½æ€¥å‰§ä¸‹é™</strong></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨åœ¨ç­‰å¾…IOå‡†å¤‡å°±ç»ªçš„æœŸé—´ï¼Œ<strong>çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€</strong>ï¼Œè‹¥ä¸ºå•çº¿ç¨‹ï¼Œç­‰å¾…æœŸé—´CPUæœªæ‰§è¡Œä»»ä½•ä»»åŠ¡ï¼Œæ•ˆç‡é™ä½ã€‚æ‰€ä»¥éœ€è¦å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå½“æŸäº›çº¿ç¨‹å› ä¸ºç­‰å¾…IOå‡†å¤‡å°±ç»ªæ—¶ï¼ŒCPUå¯ä»¥å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ä¸­çš„ä»»åŠ¡ã€‚ä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ä¸é”€æ¯çš„å¼€é”€ä¹Ÿæ˜¯ä¸å°çš„ã€‚å½“å¤§é‡çš„ä»»åŠ¡åˆ°æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ€§èƒ½ä¹Ÿæ€¥å‰§ä¸‹é™ã€‚</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223107153.png" alt="image-20210513223107153"></p><h4 id="éé˜»å¡å¼ç½‘ç»œé€šä¿¡"><a href="#éé˜»å¡å¼ç½‘ç»œé€šä¿¡" class="headerlink" title="éé˜»å¡å¼ç½‘ç»œé€šä¿¡"></a>éé˜»å¡å¼ç½‘ç»œé€šä¿¡</h4><p>Java NIO æ˜¯éé˜»å¡æ¨¡å¼çš„ã€‚å½“çº¿ç¨‹ä»æŸé€šé“è¿›è¡Œè¯»å†™æ•°æ®æ—¶ï¼Œ<strong>è‹¥æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡</strong>ã€‚çº¿ç¨‹é€šå¸¸å°†éé˜»å¡IO çš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶ä»–é€šé“ä¸Šæ‰§è¡ŒIO æ“ä½œï¼Œæ‰€ä»¥<strong>å•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“</strong></p><p>å› æ­¤ï¼ŒNIO å¯ä»¥è®©æœåŠ¡å™¨ç«¯<strong>ä½¿ç”¨ä¸€ä¸ªæˆ–æœ‰é™å‡ ä¸ªçº¿ç¨‹æ¥åŒæ—¶å¤„ç†è¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„æ‰€æœ‰å®¢æˆ·ç«¯</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223114797.png" alt="image-20210513223114797"></p><h2 id="2ã€ä½¿ç”¨"><a href="#2ã€ä½¿ç”¨" class="headerlink" title="2ã€ä½¿ç”¨"></a>2ã€ä½¿ç”¨</h2><h4 id="é˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º"><a href="#é˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º" class="headerlink" title="é˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º"></a>é˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/*</span><span class="hljs-comment"> * ä¸€ã€ä½¿ç”¨ NIO å®Œæˆç½‘ç»œé€šä¿¡çš„ä¸‰ä¸ªæ ¸å¿ƒï¼š</span><span class="hljs-comment"> * </span><span class="hljs-comment"> * 1. é€šé“ï¼ˆChannelï¼‰ï¼šè´Ÿè´£è¿æ¥</span><span class="hljs-comment"> *         </span><span class="hljs-comment"> *        java.nio.channels.Channel æ¥å£ï¼š</span><span class="hljs-comment"> *             |--SelectableChannel</span><span class="hljs-comment"> *                 |--SocketChannel</span><span class="hljs-comment"> *                 |--ServerSocketChannel</span><span class="hljs-comment"> *                 |--DatagramChannel</span><span class="hljs-comment"> * </span><span class="hljs-comment"> *                 |--Pipe.SinkChannel</span><span class="hljs-comment"> *                 |--Pipe.SourceChannel</span><span class="hljs-comment"> * </span><span class="hljs-comment"> * 2. ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼šè´Ÿè´£æ•°æ®çš„å­˜å–</span><span class="hljs-comment"> * </span><span class="hljs-comment"> * 3. é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ï¼šæ˜¯ SelectableChannel çš„å¤šè·¯å¤ç”¨å™¨ã€‚ç”¨äºç›‘æ§ SelectableChannel çš„ IO çŠ¶å†µ</span><span class="hljs-comment"> * </span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestBlockingNIO</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;         <span class="hljs-keyword">try</span> &#123;            server();         &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();         &#125;      &#125;);      Thread thread2 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;         <span class="hljs-keyword">try</span> &#123;            client();         &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();         &#125;      &#125;);      thread1.start();      thread2.start();   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">client</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      <span class="hljs-comment">// åˆ›å»ºå®¢æˆ·ç«¯é€šé“</span>      SocketChannel socketChannel = SocketChannel.open(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">2022</span>));      <span class="hljs-comment">// è¯»å–ä¿¡æ¯</span>      FileChannel fileChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\nio\\day3\\1.jpg&quot;</span>), StandardOpenOption.READ);      <span class="hljs-comment">// åˆ›å»ºç¼“å†²åŒº</span>      ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);      <span class="hljs-comment">// å†™å…¥æ•°æ®</span>      <span class="hljs-keyword">while</span> (fileChannel.read(byteBuffer) != -<span class="hljs-number">1</span>) &#123;         <span class="hljs-comment">//åˆ‡æ¢ä¸ºè¯»æ¨¡å¼</span>         byteBuffer.flip();         socketChannel.write(byteBuffer);         byteBuffer.clear();      &#125;      fileChannel.close();      socketChannel.close();   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">server</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;      <span class="hljs-comment">// åˆ›å»ºæœåŠ¡ç«¯é€šé“</span>      ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();      FileChannel fileChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;F:\\JDKLearning\\src\\main\\nio\\day3\\2.jpg&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);      <span class="hljs-comment">// ç»‘å®šé“¾æ¥</span>      serverSocketChannel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">2022</span>));      <span class="hljs-comment">// è·å–å®¢æˆ·ç«¯çš„é€šé“</span>      SocketChannel socketChannel = serverSocketChannel.accept();      <span class="hljs-comment">// åˆ›å»ºç¼“å†²åŒº</span>      ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);      <span class="hljs-keyword">while</span> (socketChannel.read(byteBuffer) != -<span class="hljs-number">1</span>) &#123;         byteBuffer.flip();         fileChannel.write(byteBuffer);         byteBuffer.clear();      &#125;      socketChannel.close();      fileChannel.close();      serverSocketChannel.close();   &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestBlockingNIO2</span> </span>&#123;    <span class="hljs-comment">//å®¢æˆ·ç«¯</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">client</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        SocketChannel sChannel = SocketChannel.open(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">9898</span>));        FileChannel inChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;1.jpg&quot;</span>), StandardOpenOption.READ);        ByteBuffer buf = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        <span class="hljs-keyword">while</span>(inChannel.read(buf) != -<span class="hljs-number">1</span>)&#123;            buf.flip();            sChannel.write(buf);            buf.clear();        &#125;        sChannel.shutdownOutput();        <span class="hljs-comment">//æ¥æ”¶æœåŠ¡ç«¯çš„åé¦ˆ</span>        <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span>((len = sChannel.read(buf)) != -<span class="hljs-number">1</span>)&#123;            buf.flip();            System.out.println(<span class="hljs-keyword">new</span> String(buf.array(), <span class="hljs-number">0</span>, len));            buf.clear();        &#125;        inChannel.close();        sChannel.close();    &#125;    <span class="hljs-comment">//æœåŠ¡ç«¯</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">server</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        ServerSocketChannel ssChannel = ServerSocketChannel.open();        FileChannel outChannel = FileChannel.open(Paths.get(<span class="hljs-string">&quot;2.jpg&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);        ssChannel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">9898</span>));        SocketChannel sChannel = ssChannel.accept();        ByteBuffer buf = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        <span class="hljs-keyword">while</span>(sChannel.read(buf) != -<span class="hljs-number">1</span>)&#123;            buf.flip();            <span class="hljs-comment">//ä¿å­˜åˆ°æœ¬åœ°</span>            outChannel.write(buf);            buf.clear();        &#125;        <span class="hljs-comment">//å‘é€åé¦ˆç»™å®¢æˆ·ç«¯</span>        buf.put(<span class="hljs-string">&quot;æœåŠ¡ç«¯æ¥æ”¶æ•°æ®æˆåŠŸ&quot;</span>.getBytes());        buf.flip();        sChannel.write(buf);        sChannel.close();        outChannel.close();        ssChannel.close();    &#125;&#125;</code></pre></div><h4 id="éé˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º"><a href="#éé˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º" class="headerlink" title="éé˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º"></a>éé˜»å¡å¼ç½‘ç»œé€šä¿¡æ¼”ç¤º</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestNonBlockingNIO2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            <span class="hljs-keyword">try</span> &#123;                server();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();            &#125;        &#125;);        Thread thread2 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            <span class="hljs-keyword">try</span> &#123;                client();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();            &#125;        &#125;);        thread1.start();        thread2.start();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">client</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        SocketChannel socketChannel = SocketChannel.open(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">2020</span>));        <span class="hljs-comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span>        socketChannel.configureBlocking(<span class="hljs-keyword">false</span>);        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);        <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;            String str = scanner.next();            byteBuffer.put(str.getBytes());            byteBuffer.flip();            socketChannel.write(byteBuffer);            byteBuffer.clear();        &#125;        byteBuffer.clear();        socketChannel.close();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">server</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//è·å–é€šé“</span>        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();        <span class="hljs-comment">//åˆ‡æ¢ä¸ºéé˜»å¡</span>        serverSocketChannel.configureBlocking(<span class="hljs-keyword">false</span>);        <span class="hljs-comment">//ç»‘å®šé“¾æ¥</span>        serverSocketChannel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">2020</span>));        <span class="hljs-comment">// è·å¾—é€‰æ‹©å™¨</span>        Selector selector = Selector.open();        <span class="hljs-comment">// å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸­ï¼Œè®¾å®šä¸ºæ¥æ”¶æ“ä½œ</span>        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);        <span class="hljs-comment">// è½®è®­æ¥å—</span>        <span class="hljs-keyword">while</span> (selector.select() &gt; <span class="hljs-number">0</span>) &#123;            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();            <span class="hljs-comment">// è·å¾—äº‹ä»¶çš„key</span>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;                <span class="hljs-comment">//è·å–å‡†å¤‡å°±ç»ªçš„äº‹ä»¶</span>                SelectionKey key = iterator.next();                <span class="hljs-comment">//åˆ¤æ–­å…·ä½“æ˜¯ä»€ä¹ˆäº‹ä»¶å‡†å¤‡å°±ç»ª</span>                <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;                    <span class="hljs-comment">//è‹¥æ¥å—å°±ç»ªï¼Œåˆ™è·å–å®¢æˆ·ç«¯è¿æ¥</span>                    SocketChannel socketChannel = serverSocketChannel.accept();                    socketChannel.configureBlocking(<span class="hljs-keyword">false</span>);                    <span class="hljs-comment">//å°†è¯¥é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</span>                    socketChannel.register(selector, SelectionKey.OP_READ);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable()) &#123;                    <span class="hljs-comment">// ä»é€‰æ‹©å™¨ä¸­è·å–è¯»å°±ç»ªé€šé“</span>                    SocketChannel socketChannel = (SocketChannel) key.channel();                    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);                    <span class="hljs-keyword">while</span> (socketChannel.read(byteBuffer) != -<span class="hljs-number">1</span>) &#123;                        <span class="hljs-keyword">int</span> len = byteBuffer.limit();                        byteBuffer.flip();                        System.out.println(<span class="hljs-keyword">new</span> String(byteBuffer.array(), <span class="hljs-number">0</span>, len));                        byteBuffer.clear();                    &#125;                    socketChannel.close();                &#125;                <span class="hljs-comment">//å–æ¶ˆé€‰æ‹©é”®</span>                iterator.remove();            &#125;        &#125;        serverSocketChannel.close();    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ¼”ç¤ºDatagramChannel</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestNonBlockingNIO2</span> </span>&#123;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        DatagramChannel dc = DatagramChannel.open();        dc.configureBlocking(<span class="hljs-keyword">false</span>);        ByteBuffer buf = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        Scanner scan = <span class="hljs-keyword">new</span> Scanner(System.in);        <span class="hljs-keyword">while</span>(scan.hasNext())&#123;            String str = scan.next();            buf.put((<span class="hljs-keyword">new</span> Date().toString() + <span class="hljs-string">&quot;:\n&quot;</span> + str).getBytes());            buf.flip();            dc.send(buf, <span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">9898</span>));            buf.clear();        &#125;        dc.close();    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        DatagramChannel dc = DatagramChannel.open();        dc.configureBlocking(<span class="hljs-keyword">false</span>);        dc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">9898</span>));        Selector selector = Selector.open();        dc.register(selector, SelectionKey.OP_READ);        <span class="hljs-keyword">while</span>(selector.select() &gt; <span class="hljs-number">0</span>)&#123;            Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();            <span class="hljs-keyword">while</span>(it.hasNext())&#123;                SelectionKey sk = it.next();                <span class="hljs-keyword">if</span>(sk.isReadable())&#123;                    ByteBuffer buf = ByteBuffer.allocate(<span class="hljs-number">1024</span>);                    dc.receive(buf);                    buf.flip();                    System.out.println(<span class="hljs-keyword">new</span> String(buf.array(), <span class="hljs-number">0</span>, buf.limit()));                    buf.clear();                &#125;            &#125;            it.remove();        &#125;    &#125;&#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPipe</span> </span>&#123;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        <span class="hljs-comment">//1. è·å–ç®¡é“</span>        Pipe pipe = Pipe.open();        <span class="hljs-comment">//2. å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥ç®¡é“</span>        ByteBuffer buf = ByteBuffer.allocate(<span class="hljs-number">1024</span>);        Pipe.SinkChannel sinkChannel = pipe.sink();        buf.put(<span class="hljs-string">&quot;é€šè¿‡å•å‘ç®¡é“å‘é€æ•°æ®&quot;</span>.getBytes());        buf.flip();        sinkChannel.write(buf);        <span class="hljs-comment">//3. è¯»å–ç¼“å†²åŒºä¸­çš„æ•°æ®</span>        Pipe.SourceChannel sourceChannel = pipe.source();        buf.flip();        <span class="hljs-keyword">int</span> len = sourceChannel.read(buf);        System.out.println(<span class="hljs-keyword">new</span> String(buf.array(), <span class="hljs-number">0</span>, len));        sourceChannel.close();        sinkChannel.close();    &#125;&#125;</code></pre></div><h5 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h5><p>é€‰æ‹©å™¨ï¼ˆSelectorï¼‰æ˜¯<strong>SelectableChannle</strong> å¯¹è±¡çš„å¤šè·¯å¤ç”¨å™¨ï¼ŒSelector å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªSelectableChannel çš„IO çŠ¶å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ©ç”¨Selector å¯ä½¿ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç®¡ç†å¤šä¸ªChannelã€‚<strong>Selector æ˜¯éé˜»å¡IO çš„æ ¸å¿ƒ</strong></p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223137934.png" alt="image-20210513223137934"></p><p><strong>é€‰æ‹©å™¨çš„åˆ›å»º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨</span>Selector selector = Selector.open();</code></pre></div><p><strong>ç»‘å®šé€‰æ‹©å™¨</strong></p><p>é€šè¿‡è°ƒç”¨é€šé“çš„registeræ–¹æ³•å¯ä»¥ç»‘å®šé€‰æ‹©å™¨ï¼Œregisteræ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°</p><ul><li><p>Selectorï¼šå³ç»‘å®šå“ªä¸ªé€‰æ‹©å™¨</p></li><li><p>opsï¼šç›‘å¬äº‹ä»¶ç±»å‹ã€‚opsæœ‰4ä¸ªå€¼å¯ä»¥é€‰æ‹©ï¼Œä¸º<strong>SelectionKey</strong>çš„é™æ€å±æ€§</p><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210513223148530.png" alt="image-20210513223148530"></p></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// è®©é€‰æ‹©å™¨ç›‘å¬ä¸€ç§çŠ¶æ€</span>myChannel.register(selector, SelectionKey.OP_READ);<span class="hljs-comment">// è®©é€‰æ‹©å™¨ç›‘å¬å¤šç§çŠ¶æ€</span>myChannel.register(selector, SelectionKey.OP_READ | SelectionKey.OP_ACCEPT);</code></pre></div><p><strong>SelectionKey</strong></p><p><strong>è¡¨ç¤ºSelectableChannel å’ŒSelector ä¹‹é—´çš„æ³¨å†Œå…³ç³»</strong>ã€‚æ¯æ¬¡å‘é€‰æ‹©å™¨æ³¨å†Œé€šé“æ—¶å°±ä¼šé€‰æ‹©ä¸€ä¸ªäº‹ä»¶(é€‰æ‹©é”®)ã€‚é€‰æ‹©é”®åŒ…å«ä¸¤ä¸ªè¡¨ç¤ºä¸ºæ•´æ•°å€¼çš„æ“ä½œé›†ã€‚æ“ä½œé›†çš„æ¯ä¸€ä½éƒ½è¡¨ç¤ºè¯¥é”®çš„é€šé“æ‰€æ”¯æŒçš„ä¸€ç±»å¯é€‰æ‹©æ“ä½œ</p>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹</title>
    <link href="/2021/05/07/JUC/"/>
    <url>/2021/05/07/JUC/</url>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h1><h1 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#1ã€è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"></a>1ã€è¿›ç¨‹ä¸çº¿ç¨‹</h2><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><ul><li>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚</li><li>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚ </li><li>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰</li></ul><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><ul><li>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚ </li><li>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€<strong>ä¸ªæŒ‡ä»¤æµ</strong>ï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ ã€‚</li><li>Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºå°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„å°å•ä½ã€‚ åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨</li></ul><h3 id="äºŒè€…å¯¹æ¯”"><a href="#äºŒè€…å¯¹æ¯”" class="headerlink" title="äºŒè€…å¯¹æ¯”"></a>äºŒè€…å¯¹æ¯”</h3><ul><li>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›†è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº« <ul><li>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ï¼Œ<strong>åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPC</strong>ï¼ˆInter-process communicationï¼‰ </li><li>ä¸åŒè®¡ç®—æœºä¹‹é—´çš„<strong>è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®</strong>ï¼Œä¾‹å¦‚ HTTP </li></ul></li><li>çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡çº¿ç¨‹æ›´è½»é‡ï¼Œ<strong>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½</strong></li></ul><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢</h4><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p><p>å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŒä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚<strong>ä¸Šä¸‹æ–‡å°±æ˜¯å†…æ ¸é‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«æŠ¢å çš„è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€</strong>åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>é€šç”¨ç›®çš„å¯„å­˜å™¨</li><li>æµ®ç‚¹å¯„å­˜å™¨</li><li>ç¨‹åºè®¡æ•°å™¨</li><li>ç”¨æˆ·æ ˆ</li><li>çŠ¶æ€å¯„å­˜å™¨</li><li>å†…æ ¸æ ˆ</li><li>å„ç§å†…æ ¸æ•°æ®ç»“æ„ï¼šæ¯”å¦‚æç»˜åœ°å€ç©ºé—´çš„<strong>é¡µè¡¨</strong>ï¼ŒåŒ…å«æœ‰å…³å½“å‰è¿›ç¨‹ä¿¡æ¯çš„<strong>è¿›ç¨‹è¡¨</strong>ï¼Œä»¥åŠåŒ…å«è¿›ç¨‹å·²æ‰“å¼€æ–‡ä»¶çš„ä¿¡æ¯çš„<strong>æ–‡ä»¶è¡¨</strong></li></ul><p><strong>è¿›ç¨‹åˆ‡æ¢å’Œçº¿ç¨‹åˆ‡æ¢çš„ä¸»è¦åŒºåˆ«</strong></p><p>æœ€ä¸»è¦çš„ä¸€ä¸ªåŒºåˆ«åœ¨äº<strong>è¿›ç¨‹åˆ‡æ¢æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢è€Œçº¿ç¨‹ä¸ä¼š</strong>ã€‚å› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œ<strong>çº¿ç¨‹æ˜¯å…±äº«æ‰€åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„</strong>ï¼Œå› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹è¿›è¡Œçº¿ç¨‹åˆ‡æ¢æ—¶ä¸æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„è½¬æ¢</p><p>é¡µè¡¨æŸ¥æ‰¾æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„è¿‡ç¨‹ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨cacheæ¥ç¼“å­˜å¸¸ç”¨çš„åœ°å€æ˜ å°„ï¼Œè¿™æ ·å¯ä»¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼Œè¿™ä¸ªcacheå°±æ˜¯å¿«è¡¨TLBï¼ˆtranslation Lookaside Bufferï¼Œç”¨æ¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼‰ã€‚ç”±äºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œé‚£ä¹ˆ<strong>å½“è¿›ç¨‹åˆ‡æ¢åé¡µè¡¨ä¹Ÿè¦è¿›è¡Œåˆ‡æ¢ï¼Œé¡µè¡¨åˆ‡æ¢åTLBå°±å¤±æ•ˆäº†</strong>ï¼Œcacheå¤±æ•ˆå¯¼è‡´å‘½ä¸­ç‡é™ä½ï¼Œé‚£ä¹ˆè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€å°±ä¼šå˜æ…¢ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯ç¨‹åºè¿è¡Œä¼šå˜æ…¢ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢åˆ™ä¸ä¼šå¯¼è‡´TLBå¤±æ•ˆï¼Œå› ä¸ºçº¿ç¨‹çº¿ç¨‹æ— éœ€åˆ‡æ¢åœ°å€ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸è¯´çº¿ç¨‹åˆ‡æ¢è¦æ¯”è¾ƒè¿›ç¨‹åˆ‡æ¢å¿«</p><p>è€Œä¸”è¿˜å¯èƒ½å‡ºç°<strong>ç¼ºé¡µä¸­æ–­</strong>ï¼Œè¿™å°±éœ€è¦æ“ä½œç³»ç»Ÿå°†éœ€è¦çš„å†…å®¹è°ƒå…¥å†…å­˜ä¸­ï¼Œè‹¥å†…å­˜å·²æ»¡åˆ™è¿˜éœ€è¦å°†ä¸ç”¨çš„å†…å®¹è°ƒå‡ºå†…å­˜ï¼Œè¿™ä¹Ÿéœ€è¦èŠ±è´¹æ—¶é—´</p><p><strong>ä¸ºä»€ä¹ˆTLBèƒ½åŠ å¿«è®¿é—®é€Ÿåº¦</strong></p><p>å¿«è¡¨å¯ä»¥é¿å…æ¯æ¬¡éƒ½å¯¹é¡µå·è¿›è¡Œåœ°å€çš„æœ‰æ•ˆæ€§åˆ¤æ–­ã€‚å¿«è¡¨ä¸­ä¿å­˜äº†å¯¹åº”çš„ç‰©ç†å—å·ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºç‰©ç†åœ°å€ï¼Œæ— éœ€å†è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥</p><h2 id="2ã€å¹¶å‘ä¸å¹¶è¡Œ"><a href="#2ã€å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="2ã€å¹¶å‘ä¸å¹¶è¡Œ"></a>2ã€å¹¶å‘ä¸å¹¶è¡Œ</h2><p><strong>å¹¶å‘æ˜¯ä¸€ä¸ªCPUåœ¨ä¸åŒçš„æ—¶é—´å»ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡ä»¤</strong></p><p><strong>å¹¶è¡Œæ˜¯å¤šä¸ªCPUåŒæ—¶å¤„ç†ä¸åŒçš„çº¿ç¨‹</strong></p><p>å¼•ç”¨ Rob Pike çš„ä¸€æ®µæè¿°ï¼š</p><ul><li>å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åº”å¯¹</strong>ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ› </li><li>å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åŠ¨æ‰‹åš</strong>ï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</li></ul><h3 id="3ã€åº”ç”¨"><a href="#3ã€åº”ç”¨" class="headerlink" title="3ã€åº”ç”¨"></a>3ã€åº”ç”¨</h3><h4 id="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"><a href="#åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰" class="headerlink" title="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"></a>åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰</h4><p>ä»¥è°ƒç”¨æ–¹è§’åº¦æ¥è®²ï¼Œå¦‚æœ</p><ul><li><strong>éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥</strong> </li><li><strong>ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥</strong></li></ul><ol><li>è®¾è®¡<br>å¤šçº¿ç¨‹å¯ä»¥è®©æ–¹æ³•æ‰§è¡Œå˜ä¸ºå¼‚æ­¥çš„ï¼ˆå³ä¸è¦å·´å·´å¹²ç­‰ç€ï¼‰æ¯”å¦‚è¯´è¯»å–ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå‡è®¾è¯»å–æ“ä½œèŠ±è´¹äº† 5 ç§’é’Ÿï¼Œå¦‚ æœæ²¡æœ‰çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼Œè¿™ 5 ç§’ cpu ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œå…¶å®ƒä»£ç éƒ½å¾—æš‚åœâ€¦</li><li>ç»“è®º </li></ol><ul><li>æ¯”å¦‚åœ¨é¡¹ç›®ä¸­ï¼Œè§†é¢‘æ–‡ä»¶éœ€è¦è½¬æ¢æ ¼å¼ç­‰æ“ä½œæ¯”è¾ƒè´¹æ—¶ï¼Œè¿™æ—¶å¼€ä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†è§†é¢‘è½¬æ¢ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ </li><li>tomcat çš„å¼‚æ­¥ servlet ä¹Ÿæ˜¯ç±»ä¼¼çš„ç›®çš„ï¼Œè®©ç”¨æˆ·çº¿ç¨‹å¤„ç†è€—æ—¶è¾ƒé•¿çš„æ“ä½œï¼Œé¿å…é˜»å¡</li><li>tomcat çš„å·¥ä½œçº¿ç¨‹ ui ç¨‹åºä¸­ï¼Œå¼€çº¿ç¨‹è¿›è¡Œå…¶ä»–æ“ä½œï¼Œé¿å…é˜»å¡ ui çº¿ç¨‹</li></ul><p>ç»“è®º </p><ol><li>å•æ ¸ cpu ä¸‹ï¼Œå¤šçº¿ç¨‹ä¸èƒ½å®é™…æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´åˆ‡æ¢ï¼Œä¸åŒçº¿ç¨‹è½®æµä½¿ç”¨ cpu ï¼Œä¸è‡³äºä¸€ä¸ªçº¿ç¨‹æ€»å ç”¨ cpuï¼Œåˆ«çš„çº¿ç¨‹æ²¡æ³•å¹²æ´» </li><li>å¤šæ ¸ cpu å¯ä»¥å¹¶è¡Œè·‘å¤šä¸ªçº¿ç¨‹ï¼Œä½†èƒ½å¦æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„ <ul><li>æœ‰äº›ä»»åŠ¡ï¼Œç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå°†ä»»åŠ¡æ‹†åˆ†ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ä½†ä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»»åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼ˆå‚è€ƒåæ–‡çš„ã€é˜¿å§†è¾¾å°”å®šå¾‹ã€‘ï¼‰</li><li>ä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ‹†åˆ†ï¼Œä»»åŠ¡çš„ç›®çš„å¦‚æœä¸åŒï¼Œè°ˆæ‹†åˆ†å’Œæ•ˆç‡æ²¡å•¥æ„ä¹‰ </li></ul></li><li>IO æ“ä½œä¸å ç”¨ cpuï¼Œåªæ˜¯æˆ‘ä»¬<strong>ä¸€èˆ¬æ‹·è´æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ã€é˜»å¡ IOã€‘</strong>ï¼Œè¿™æ—¶ç›¸å½“äºçº¿ç¨‹è™½ç„¶ä¸ç”¨ cpuï¼Œä½†éœ€è¦ä¸€ ç›´ç­‰å¾… IO ç»“æŸï¼Œ<strong>æ²¡èƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹</strong>ã€‚æ‰€ä»¥æ‰æœ‰åé¢çš„ã€éé˜»å¡ IOã€‘å’Œã€å¼‚æ­¥ IOã€‘ä¼˜åŒ–</li></ol><h1 id="äºŒã€çº¿ç¨‹çš„åˆ›å»º"><a href="#äºŒã€çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="äºŒã€çº¿ç¨‹çš„åˆ›å»º"></a>äºŒã€çº¿ç¨‹çš„åˆ›å»º</h1><h2 id="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"><a href="#1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"></a>1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰</h2><h3 id="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿deadåˆ›å»ºçº¿ç¨‹"><a href="#æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿deadåˆ›å»ºçº¿ç¨‹" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿deadåˆ›å»ºçº¿ç¨‹"></a>æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿deadåˆ›å»ºçº¿ç¨‹</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateThread</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Thread myThread = <span class="hljs-keyword">new</span> MyThread();        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>        myThread.start();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;my thread running...&quot;</span>);    &#125;&#125;</code></pre></div><p>ä½¿ç”¨ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯ï¼Œåœ¨runï¼ˆï¼‰æ–¹æ³•å†…è·å–å½“å‰çº¿ç¨‹ç›´æ¥ä½¿ç”¨thiså°±å¯ä»¥äº†ï¼Œæ— é¡»ä½¿ç”¨Thread.currentThreadï¼ˆï¼‰æ–¹æ³•ï¼›ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ã€‚å¦å¤–ä»»åŠ¡ä¸ä»£ç æ²¡æœ‰åˆ†ç¦»ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ ·çš„ä»»åŠ¡æ—¶éœ€è¦å¤šä»½ä»»åŠ¡ä»£ç </p><h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span>        Runnable r = <span class="hljs-keyword">new</span> Runnable() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                System.out.println(<span class="hljs-string">&quot;Runnable running&quot;</span>);            &#125;        &#125;;        <span class="hljs-comment">//å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span>        Thread t = <span class="hljs-keyword">new</span> Thread(r);        <span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹</span>        t.start();    &#125;&#125;</code></pre></div><p>æˆ–è€…</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateThread2</span> </span>&#123;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;      <span class="hljs-meta">@Override</span>      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;         System.out.println(<span class="hljs-string">&quot;my runnable running...&quot;</span>);      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      MyRunnable myRunnable = <span class="hljs-keyword">new</span> MyRunnable();      Thread thread = <span class="hljs-keyword">new</span> Thread(myRunnable);      thread.start();   &#125;&#125;</code></pre></div><p>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå¹¶ä¸”å®ç°run()æ–¹æ³•ã€‚åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥è¯¥ç±»çš„å®ä¾‹å³å¯</p><h4 id="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"><a href="#æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ" class="headerlink" title="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"></a>æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ</h4><p><strong>å½“ä¸€ä¸ªæ¥å£å¸¦æœ‰@FunctionalInterfaceæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨lambdaæ¥ç®€åŒ–æ“ä½œçš„</strong></p><p>æ‰€ä»¥æ–¹æ³•äºŒä¸­çš„ä»£ç å¯ä»¥è¢«ç®€åŒ–ä¸º</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span>        Runnable r = () -&gt; &#123;            <span class="hljs-comment">//ç›´æ¥å†™æ–¹æ³•ä½“å³å¯</span>            System.out.println(<span class="hljs-string">&quot;Runnable running&quot;</span>);            System.out.println(<span class="hljs-string">&quot;Hello Thread&quot;</span>);        &#125;;        <span class="hljs-comment">//å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span>        Thread t = <span class="hljs-keyword">new</span> Thread(r);        <span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹</span>        t.start();    &#125;&#125;</code></pre></div><p>å¯ä»¥å†Runnableä¸Šä½¿ç”¨Alt+Enter(option+Enter)</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png" alt="img"></a></p><h4 id="åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»"><a href="#åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»" class="headerlink" title="åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»"></a>åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»</h4><p>åˆ†æ Thread çš„æºç ï¼Œç†æ¸…å®ƒä¸ Runnable çš„å…³ç³»<br><strong>å°ç»“</strong></p><ul><li>æ–¹æ³•1 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆå¹¶åœ¨äº†ä¸€èµ·</li><li>æ–¹æ³•2 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€äº† </li><li>ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆï¼Œç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»</li></ul><h3 id="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"><a href="#æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"></a>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ</h3><p><strong>ä½¿ç”¨FutureTaskå¯ä»¥ç”¨æ³›å‹æŒ‡å®šçº¿ç¨‹çš„è¿”å›å€¼ç±»å‹ï¼ˆRunnableçš„runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼‰</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test3</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;        <span class="hljs-comment">//éœ€è¦ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡</span>        FutureTask&lt;Integer&gt; task = <span class="hljs-keyword">new</span> FutureTask&lt;Integer&gt;(<span class="hljs-keyword">new</span> Callable&lt;Integer&gt;() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ!&quot;</span>);                Thread.sleep(<span class="hljs-number">1000</span>);                <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;            &#125;        &#125;);        Thread r1 = <span class="hljs-keyword">new</span> Thread(task, <span class="hljs-string">&quot;t2&quot;</span>);        r1.start();        <span class="hljs-comment">//è·å–çº¿ç¨‹ä¸­æ–¹æ³•æ‰§è¡Œåçš„è¿”å›ç»“æœ</span>        System.out.println(task.get());    &#125;&#125;</code></pre></div><p>æˆ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UseFutureTask</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;      FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> FutureTask&lt;&gt;(<span class="hljs-keyword">new</span> MyCall());      Thread thread = <span class="hljs-keyword">new</span> Thread(futureTask);      thread.start();      <span class="hljs-comment">// è·å¾—çº¿ç¨‹è¿è¡Œåçš„è¿”å›å€¼</span>      System.out.println(futureTask.get());   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCall</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">String</span>&gt; </span>&#123;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello world&quot;</span>;   &#125;&#125;</code></pre></div><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½¿ç”¨<strong>ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯æ–¹ä¾¿ä¼ å‚</strong>ï¼Œä½ å¯ä»¥åœ¨å­ç±»é‡Œé¢æ·»åŠ æˆå‘˜å˜é‡ï¼Œé€šè¿‡setæ–¹æ³•è®¾ç½®å‚æ•°æˆ–è€…é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œä¼ é€’ï¼Œè€Œå¦‚æœä½¿ç”¨Runnableæ–¹å¼ï¼Œåˆ™åªèƒ½ä½¿ç”¨ä¸»çº¿ç¨‹é‡Œé¢è¢«å£°æ˜ä¸ºfinalçš„å˜é‡ã€‚<strong>ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿</strong>ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå­ç±»ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ï¼Œè€ŒRunableåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚<strong>å‰ä¸¤ç§æ–¹å¼éƒ½æ²¡åŠæ³•æ‹¿åˆ°ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œä½†æ˜¯Futuretaskæ–¹å¼å¯ä»¥</strong></p><h2 id="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"><a href="#2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ" class="headerlink" title="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"></a>2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ</h2><h4 id="æ ˆä¸æ ˆå¸§"><a href="#æ ˆä¸æ ˆå¸§" class="headerlink" title="æ ˆä¸æ ˆå¸§"></a>æ ˆä¸æ ˆå¸§</h4><p>Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰ æˆ‘ä»¬éƒ½çŸ¥é“ JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿ</p><ul><li>å…¶å®å°±æ˜¯çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—<strong>æ ˆå†…å­˜</strong></li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡<strong>æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</strong>ï¼Œæ ˆå¸§é‡ŒåŒ…å«<strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong>ã€<strong>åŠ¨æ€é“¾æ¥</strong>ã€<strong>æ–¹æ³•è¿”å›åœ°å€</strong>ã€<strong>è¿è¡Œæ—¶å¸¸é‡æ± å¼•ç”¨</strong>å’Œ<strong>é”è®°å½•</strong></li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li></ul><h4 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰</h4><p>å› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç </p><ul><li>çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ</li><li>åƒåœ¾å›æ”¶ æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ</li><li>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³• </li></ul><p>å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µ å°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„</p><ul><li>çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰</li><li>Context Switch é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½ </li></ul><h2 id="3ã€å¸¸ç”¨æ–¹æ³•"><a href="#3ã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="3ã€å¸¸ç”¨æ–¹æ³•"></a>3ã€å¸¸ç”¨æ–¹æ³•</h2><h3 id="1-start-vs-run"><a href="#1-start-vs-run" class="headerlink" title="(1)start() vs run()"></a>(1)start() vs run()</h3><p>è¢«åˆ›å»ºçš„Threadå¯¹è±¡ç›´æ¥è°ƒç”¨é‡å†™çš„runæ–¹æ³•æ—¶ï¼Œ runæ–¹æ³•æ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è¢«æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæƒ³è¦åœ¨æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œrunæ–¹æ³•ï¼Œ<strong>éœ€è¦ä½¿ç”¨Threadå¯¹è±¡çš„startæ–¹æ³•ã€‚</strong></p><h3 id="2-sleep-ä¸yield"><a href="#2-sleep-ä¸yield" class="headerlink" title="(2)sleep()ä¸yield()"></a>(2)sleep()ä¸yield()</h3><h4 id="sleep-ä½¿çº¿ç¨‹é˜»å¡"><a href="#sleep-ä½¿çº¿ç¨‹é˜»å¡" class="headerlink" title="sleep (ä½¿çº¿ç¨‹é˜»å¡)"></a><strong>sleep</strong> (ä½¿çº¿ç¨‹é˜»å¡)</h4><ol><li><p>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰</strong>ï¼Œå¯é€šè¿‡state()æ–¹æ³•æŸ¥çœ‹</p></li><li><p>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ <strong>interrupt</strong> æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException</p></li><li><p>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ</p></li><li><p>å»ºè®®ç”¨ <strong>TimeUnit çš„ sleep</strong> ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ ã€‚å¦‚ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ä¼‘çœ ä¸€ç§’</span>TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<span class="hljs-comment">//ä¼‘çœ ä¸€åˆ†é’Ÿ</span>TimeUnit.MINUTES.sleep(<span class="hljs-number">1</span>);</code></pre></div></li></ol><h4 id="yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"><a href="#yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰" class="headerlink" title="yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"></a>yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</h4><ol><li>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€</strong>ï¼ˆä»ç„¶æœ‰å¯èƒ½è¢«æ‰§è¡Œï¼‰ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ </li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ol><h4 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h4><ul><li><p>çº¿ç¨‹ä¼˜å…ˆçº§ä¼šæç¤ºï¼ˆhintï¼‰è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼Œä½†å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºï¼Œè°ƒåº¦å™¨å¯ä»¥å¿½ç•¥å®ƒ </p></li><li><p>å¦‚æœ cpu æ¯”è¾ƒå¿™ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šè·å¾—æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œä½† cpu é—²æ—¶ï¼Œä¼˜å…ˆçº§å‡ ä¹æ²¡ä½œç”¨</p></li><li><p>è®¾ç½®æ–¹æ³•ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">thread1.setPriority(Thread.MAX_PRIORITY); <span class="hljs-comment">//è®¾ç½®ä¸ºä¼˜å…ˆçº§æœ€é«˜ </span></code></pre></div></li></ul><h3 id="3-join-æ–¹æ³•"><a href="#3-join-æ–¹æ³•" class="headerlink" title="(3)join()æ–¹æ³•"></a>(3)join()æ–¹æ³•</h3><p>ç”¨äºç­‰å¾…æŸä¸ªçº¿ç¨‹ç»“æŸã€‚å“ªä¸ªçº¿ç¨‹å†…è°ƒç”¨join()æ–¹æ³•ï¼Œå°±ç­‰å¾…å“ªä¸ªçº¿ç¨‹ç»“æŸï¼Œç„¶åå†å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p><p>å¦‚åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ti.join()ï¼Œåˆ™æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…t1çº¿ç¨‹ç»“æŸ</p><div class="hljs code-wrapper"><pre><code class="hljs java">Thread thread = <span class="hljs-keyword">new</span> Thread();<span class="hljs-comment">//ç­‰å¾…threadçº¿ç¨‹æ‰§è¡Œç»“æŸ</span>thread.join();<span class="hljs-comment">//æœ€å¤šç­‰å¾…1000ms,å¦‚æœ1000mså†…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šç›´æ¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¸ä¼šç­‰å¤Ÿ1000ms</span>thread.join(<span class="hljs-number">1000</span>);</code></pre></div><h3 id="4-interrupt-æ–¹æ³•"><a href="#4-interrupt-æ–¹æ³•" class="headerlink" title="(4)interrupt()æ–¹æ³•"></a>(4)interrupt()æ–¹æ³•</h3><p>ç”¨äºæ‰“æ–­<strong>é˜»å¡</strong>(sleep wait joinâ€¦)çš„çº¿ç¨‹ã€‚ å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼ŒCPUä¸ä¼šç»™å…¶åˆ†é…æ—¶é—´ç‰‡ã€‚</p><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨åœ¨è¿è¡Œä¸­è¢«æ‰“æ–­ï¼Œæ‰“æ–­æ ‡è®°ä¼šè¢«ç½®ä¸ºtrueã€‚ </li><li>å¦‚æœæ˜¯æ‰“æ–­å› sleep wait joinæ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹ï¼Œä¼šå°†æ‰“æ–­æ ‡è®°ç½®ä¸ºfalse</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ç”¨äºæŸ¥çœ‹æ‰“æ–­æ ‡è®°ï¼Œè¿”å›å€¼è¢«booleanç±»å‹</span>t1.isInterrupted();</code></pre></div><p>æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹åœ¨è¢«æ‰“æ–­åï¼Œ<strong>ä¸ä¼šåœæ­¢</strong>ï¼Œä¼šç»§ç»­æ‰§è¡Œã€‚å¦‚æœè¦è®©çº¿ç¨‹åœ¨è¢«æ‰“æ–­ååœä¸‹æ¥ï¼Œéœ€è¦<strong>ä½¿ç”¨æ‰“æ–­æ ‡è®°æ¥åˆ¤æ–­</strong>ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;    <span class="hljs-keyword">if</span>(Thread.currentThread().isInterrupted()) &#123;        <span class="hljs-keyword">break</span>;    &#125;&#125;</code></pre></div><h5 id="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"><a href="#interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼" class="headerlink" title="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"></a><strong>interruptæ–¹æ³•çš„åº”ç”¨</strong>â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</h5><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œçº¿ç¨‹ä¸€æ—¶ï¼Œæƒ³è¦ç»ˆæ­¢çº¿ç¨‹äºŒï¼Œè¿™æ˜¯å°±éœ€è¦ä½¿ç”¨interruptæ–¹æ³•æ¥<strong>ä¼˜é›…</strong>çš„åœæ­¢çº¿ç¨‹äºŒã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png" alt="img"></a></p><p><strong>ä»£ç </strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        Monitor monitor = <span class="hljs-keyword">new</span> Monitor();        monitor.start();        Thread.sleep(<span class="hljs-number">3500</span>);        monitor.stop();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;    Thread monitor;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span>        monitor = <span class="hljs-keyword">new</span> Thread() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                <span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span>                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;                    <span class="hljs-comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­äº†</span>                    <span class="hljs-keyword">if</span>(Thread.currentThread().isInterrupted()) &#123;                        System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);                        <span class="hljs-comment">//ç»ˆæ­¢çº¿ç¨‹æ‰§è¡Œ</span>                        <span class="hljs-keyword">break</span>;                    &#125;                    <span class="hljs-keyword">try</span> &#123;                        <span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span>                        Thread.sleep(<span class="hljs-number">1000</span>);                        System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                        e.printStackTrace();                        <span class="hljs-comment">//å¦‚æœæ˜¯åœ¨ä¼‘çœ çš„æ—¶å€™è¢«æ‰“æ–­ï¼Œä¸ä¼šå°†æ‰“æ–­æ ‡è®°è®¾ç½®ä¸ºtrueï¼Œè¿™æ—¶è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°</span>                        Thread.currentThread().interrupt();                    &#125;                &#125;            &#125;        &#125;;        monitor.start();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     *     ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span>        monitor.interrupt();    &#125;&#125;</code></pre></div><h3 id="5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"><a href="#5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•" class="headerlink" title="(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"></a>(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•</h3><ul><li>stopæ–¹æ³• åœæ­¢çº¿ç¨‹è¿è¡Œï¼ˆå¯èƒ½é€ æˆå…±äº«èµ„æºæ— æ³•è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä½¿ç”¨è¿™äº›å…±äº«èµ„æºï¼‰</li><li>suspendï¼ˆæš‚åœçº¿ç¨‹ï¼‰/resumeï¼ˆæ¢å¤çº¿ç¨‹ï¼‰æ–¹æ³•</li></ul><h3 id="6-å®ˆæŠ¤çº¿ç¨‹"><a href="#6-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="(6)å®ˆæŠ¤çº¿ç¨‹"></a>(6)å®ˆæŠ¤çº¿ç¨‹</h3><p>å½“JAVAè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ï¼Œåªæœ‰å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼ŒJAVAè¿›ç¨‹æ‰ä¼šç»“æŸã€‚<strong>ä½†å½“éå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œå®ˆæŠ¤çº¿ç¨‹æ— è®ºæ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä¼šä¸€åŒç»“æŸã€‚</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹, é»˜è®¤ä¸ºfalse</span>monitor.setDaemon(<span class="hljs-keyword">true</span>);</code></pre></div><p><strong>å®ˆæŠ¤çº¿ç¨‹çš„åº”ç”¨</strong></p><ul><li>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ </li><li>Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æ¥æ”¶åˆ° shutdown å‘½ä»¤åï¼Œä¸ä¼šç­‰å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚</li></ul><h2 id="4ã€çº¿ç¨‹çš„çŠ¶æ€"><a href="#4ã€çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="4ã€çº¿ç¨‹çš„çŠ¶æ€"></a>4ã€çº¿ç¨‹çš„çŠ¶æ€</h2><h3 id="1-äº”ç§çŠ¶æ€"><a href="#1-äº”ç§çŠ¶æ€" class="headerlink" title="(1)äº”ç§çŠ¶æ€"></a>(1)äº”ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>æ“ä½œç³»ç»Ÿ</strong> å±‚é¢æ¥æè¿°çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png" alt="img"></a></p><ul><li>ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼ˆä¾‹å¦‚çº¿ç¨‹è°ƒç”¨äº†startæ–¹æ³•ï¼‰</li><li>ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ </li><li>ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€ <ul><li>å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ </li></ul></li><li>ã€é˜»å¡çŠ¶æ€ã€‘<ul><li>å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ ã€é˜»å¡çŠ¶æ€ã€‘ </li><li>ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘</li><li>ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬ </li></ul></li><li>ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€</li></ul><h3 id="2-å…­ç§çŠ¶æ€"><a href="#2-å…­ç§çŠ¶æ€" class="headerlink" title="(2)å…­ç§çŠ¶æ€"></a>(2)å…­ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>Java API</strong> å±‚é¢æ¥æè¿°çš„<br>æ ¹æ® Thread.State æšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png" alt="img"></a></p><ul><li><strong>NEW</strong> çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•</li><li><strong>RUNNABLE</strong> å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„ ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äº BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸º æ˜¯å¯è¿è¡Œï¼‰ </li><li><strong>BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING</strong> éƒ½æ˜¯ <strong>Java API å±‚é¢</strong>å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ†ï¼Œå¦‚sleepå°±ä½TIMED_WAITINGï¼Œ joinä¸ºWAITINGçŠ¶æ€ã€‚åé¢ä¼šåœ¨çŠ¶æ€è½¬æ¢ä¸€èŠ‚è¯¦è¿°ã€‚ </li><li><strong>TERMINATED</strong> å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ</li></ul><h1 id="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"><a href="#ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹" class="headerlink" title="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"></a>ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</h1><h2 id="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜</h2><h3 id="1-ä¸´ç•ŒåŒº-Critical-Section"><a href="#1-ä¸´ç•ŒåŒº-Critical-Section" class="headerlink" title="(1)ä¸´ç•ŒåŒº Critical Section"></a>(1)ä¸´ç•ŒåŒº Critical Section</h3><ul><li><p>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</p></li><li><p>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®<strong>å…±äº«èµ„æº</strong></p></li><li><p><strong>å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æº</strong>å…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜ </p></li><li><p>åœ¨<strong>å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œ</strong>æ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ </p></li><li><p>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong><br>ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒº</p></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span><span class="hljs-function"><span class="hljs-comment">// ä¸´ç•ŒåŒº </span></span><span class="hljs-function"></span>&#123;       counter++; &#125;<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> </span><span class="hljs-function"><span class="hljs-comment">// ä¸´ç•ŒåŒº </span></span><span class="hljs-function"></span>&#123;     counter--; &#125;</code></pre></div><h3 id="2-ç«æ€æ¡ä»¶-Race-Condition"><a href="#2-ç«æ€æ¡ä»¶-Race-Condition" class="headerlink" title="(2)ç«æ€æ¡ä»¶ Race Condition"></a><strong>(2)ç«æ€æ¡ä»¶ Race Condition</strong></h3><p>å¤šä¸ªçº¿ç¨‹åœ¨<strong>ä¸´ç•ŒåŒº</strong>å†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p><h2 id="2ã€synchronized-è§£å†³æ–¹æ¡ˆ"><a href="#2ã€synchronized-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€synchronized è§£å†³æ–¹æ¡ˆ"></a>2ã€synchronized è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-è§£å†³æ‰‹æ®µ"><a href="#1-è§£å†³æ‰‹æ®µ" class="headerlink" title="(1)è§£å†³æ‰‹æ®µ"></a>(1)è§£å†³æ‰‹æ®µ</h3><p>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p><ul><li>é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock </li><li>éé˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</li></ul><p>æœ¬æ¬¡è¯¾ä½¿ç”¨é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼š<strong>synchronized</strong>ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå³ä¿—ç§°çš„<strong>ã€å¯¹è±¡é”ã€‘</strong>ï¼Œå®ƒé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€ æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡ä½(blocked)ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é” çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p><h3 id="2-synchronizedè¯­æ³•"><a href="#2-synchronizedè¯­æ³•" class="headerlink" title="(2)synchronizedè¯­æ³•"></a>(2)synchronizedè¯­æ³•</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span>(å¯¹è±¡) &#123;    <span class="hljs-comment">//ä¸´ç•ŒåŒº</span>&#125;</code></pre></div><p>ä¾‹ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>; <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå…¬å…±å¯¹è±¡ï¼Œä½œä¸ºå¯¹è±¡é”çš„å¯¹è±¡</span><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object room = <span class="hljs-keyword">new</span> Object();<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        Thread t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;                    <span class="hljs-keyword">synchronized</span> (room) &#123;             counter++;                        &#125;               &#125;        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);    Thread t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;               <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;                     <span class="hljs-keyword">synchronized</span> (room) &#123;                        counter--;                      &#125;            &#125;     &#125;, <span class="hljs-string">&quot;t2&quot;</span>);    t1.start();        t2.start();     t1.join();       t2.join();        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,counter); &#125;</code></pre></div><h3 id="3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"><a href="#3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š" class="headerlink" title="(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"></a>(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š</h3><ul><li><p>åŠ åœ¨<strong>æˆå‘˜æ–¹æ³•</strong>ä¸Š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test1</span> </span>&#123;    <span class="hljs-comment">//åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-comment">//ç­‰ä»·äº</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">synchronized</span>(<span class="hljs-keyword">this</span>) &#123;        &#125;    &#125;&#125;</code></pre></div></li><li><p>åŠ åœ¨<strong>é™æ€æ–¹æ³•</strong>ä¸Š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;    <span class="hljs-comment">//åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-comment">//ç­‰ä»·äº</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">synchronized</span>(Demo.class) &#123;        &#125;    &#125;&#125;</code></pre></div></li></ul><h2 id="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h2><h4 id="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul><li>å¦‚æœå®ƒä»¬<strong>æ²¡æœ‰å…±äº«ï¼Œåˆ™çº¿ç¨‹å®‰å…¨</strong></li><li>å¦‚æœå®ƒä»¬è¢«å…±äº«äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ<ul><li>å¦‚æœ<strong>åªæœ‰è¯»</strong>æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨ </li><li>å¦‚æœ<strong>æœ‰è¯»å†™</strong>æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ul></li></ul><h4 id="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul><li><p>å±€éƒ¨å˜é‡æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</p></li><li><p>ä½†<strong>å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡åˆ™æœªå¿…</strong> ï¼ˆè¦çœ‹è¯¥å¯¹è±¡æ˜¯å¦è¢«å…±äº«ä¸”è¢«æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼‰</p><ul><li>å¦‚æœè¯¥å¯¹è±¡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>å¦‚æœè¯¥å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ul></li><li><p><strong>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨</strong>çš„â€”â€”æ¯ä¸ªæ–¹æ³•éƒ½åœ¨å¯¹åº”çº¿ç¨‹çš„æ ˆä¸­åˆ›å»ºæ ˆå¸§ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å…±äº«</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;  i++;&#125;</code></pre></div></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png" alt="img"></a></p><ul><li><p>å¦‚æœè°ƒç”¨çš„å¯¹è±¡è¢«å…±äº«ï¼Œä¸”æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼Œåˆ™<strong>çº¿ç¨‹ä¸å®‰å…¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadUnsafe</span> </span>&#123;    ArrayList&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;            method2();            method3();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method2</span><span class="hljs-params">()</span> </span>&#123;        list.add(<span class="hljs-string">&quot;1&quot;</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method3</span><span class="hljs-params">()</span> </span>&#123;        list.remove(<span class="hljs-number">0</span>);    &#125;&#125;</code></pre></div></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png" alt="img"></a></p><ul><li><p>å¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œåˆ™ä¼šåœ¨å †ä¸­åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafe</span> </span>&#123;  <span class="hljs-comment">//finalä¿è¯å­ç±»ä¸å¯¹å…¶æœ‰å½±å“ï¼Œä¿éšœçº¿æ€§å®‰å…¨</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;        <span class="hljs-comment">//æ”¹ä¸ºå±€éƒ¨å˜é‡</span>        ArrayList&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;            method2(list);            method3(list);        &#125;    &#125;<span class="hljs-comment">//è®¾ä¸ºprivateä¸ºäº†ä¿æŠ¤æœ‰å­ç±»æ—¶èƒ½å¤å†™æ–¹æ³•åˆ™ä¸å®‰å…¨</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method2</span><span class="hljs-params">(ArrayList&lt;String&gt; list)</span> </span>&#123;        list.add(<span class="hljs-string">&quot;1&quot;</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method3</span><span class="hljs-params">(ArrayList&lt;String&gt; list)</span> </span>&#123;        System.out.println(<span class="hljs-number">1</span>);        list.remove(<span class="hljs-number">0</span>);    &#125;&#125;</code></pre></div></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png" alt="img"></a></p><p>ä»ä»¥ä¸Šä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨<strong>privateæˆ–è€…final</strong>æä¾›<strong>å®‰å…¨</strong>çš„æ„ä¹‰æ‰€åœ¨</p><h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"></a>å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h3><ul><li>String</li><li>Integer</li><li>StringBuï¬€er </li><li>Random</li><li>Vector ï¼ˆListçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li><li>Hashtable ï¼ˆHashçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li><li>java.util.concurrent åŒ…ä¸‹çš„ç±»</li></ul><p>è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬<strong>åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶</strong>ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p><ul><li>å®ƒä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­çš„ï¼ˆéƒ½è¢«åŠ ä¸Šäº†synchronizedï¼‰</li><li>ä½†æ³¨æ„å®ƒä»¬<strong>å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­çš„</strong>ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png" alt="img"></a></p><h3 id="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"><a href="#ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"></a>ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§</h3><p>Stringã€Integer ç­‰éƒ½æ˜¯<strong>ä¸å¯å˜ç±»</strong>ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ </p><p>æœ‰åŒå­¦æˆ–è®¸æœ‰ç–‘é—®ï¼ŒString æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•ã€å¯ä»¥ã€‘æ”¹å˜å€¼å•Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰ å…¨çš„å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•çš„è¿”å›å€¼éƒ½<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¹å˜Stringã€Integerå¯¹è±¡æœ¬èº«ã€‚</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span></span>&#123;       <span class="hljs-comment">//å®‰å…¨</span>       String S1  = <span class="hljs-string">&quot;...&quot;</span>;       <span class="hljs-comment">//å®‰å…¨</span>       <span class="hljs-keyword">final</span> String S2  = <span class="hljs-string">&quot;...&quot;</span>;       <span class="hljs-comment">//ä¸å®‰å…¨</span>       Date D1 = <span class="hljs-keyword">new</span> Date();       <span class="hljs-comment">//ä¸å®‰å…¨ï¼Œå› ä¸ºDateä¸æ˜¯Stringï¼Œå†…éƒ¨å±æ€§ä¼šè¢«ä¿®æ”¹</span>       <span class="hljs-keyword">final</span> Date D2 = <span class="hljs-keyword">new</span> Date();       <span class="hljs-comment">//ä¸å®‰å…¨</span>       <span class="hljs-keyword">private</span> UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();       <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span></span>&#123;           <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;           <span class="hljs-comment">//æœ‰å¯èƒ½å¤šä¸ªä»£ç æ¥ä¿®æ”¹é‡Œé¢çš„å€¼</span>           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span>&#123;               <span class="hljs-comment">// ...</span>               count++;           &#125;       &#125;  &#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;    <span class="hljs-comment">//ä¸å®‰å…¨ï¼Œå› ä¸ºstartä¼šè¢«ä¿®æ”¹</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> start = <span class="hljs-number">0L</span>;    <span class="hljs-meta">@Before(&quot;execution(* *(..))&quot;)</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span> </span>&#123;       start = System.nanoTime();     &#125;    <span class="hljs-meta">@After(&quot;execution(* *(..))&quot;)</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">after</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">long</span> end = System.nanoTime();        System.out.println(<span class="hljs-string">&quot;cost time:&quot;</span> + (end-start));    &#125;&#125;</code></pre></div><h2 id="4ã€Monitorï¼ˆé”ï¼‰æ¦‚å¿µ"><a href="#4ã€Monitorï¼ˆé”ï¼‰æ¦‚å¿µ" class="headerlink" title="4ã€Monitorï¼ˆé”ï¼‰æ¦‚å¿µ"></a>4ã€Monitorï¼ˆé”ï¼‰æ¦‚å¿µ</h2><h3 id="1-åŸç†ä¹‹Monitor"><a href="#1-åŸç†ä¹‹Monitor" class="headerlink" title="(1)åŸç†ä¹‹Monitor"></a>(1)åŸç†ä¹‹Monitor</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png" alt="img"></a></p><ul><li><p>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedï¼Œä¼šå…ˆæŸ¥è¯¢synchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>æ˜¯å¦ç»‘å®šäº†Monitor</strong>ã€‚</p><ul><li><p>å¦‚æœ<strong>æ²¡æœ‰ç»‘å®š</strong>ï¼Œåˆ™ä¼šå…ˆå»å»ä¸Monitorç»‘å®šï¼Œå¹¶ä¸”å°†Ownerè®¾ä¸ºå½“å‰çº¿ç¨‹ã€‚</p></li><li><p>å¦‚æœå·²ç»ç»‘å®šï¼Œåˆ™ä¼šå»æŸ¥è¯¢è¯¥Monitoræ˜¯å¦å·²ç»æœ‰äº†Owner</p><ul><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™Ownerä¸å°†å½“å‰çº¿ç¨‹ç»‘å®š</li><li>å¦‚æœæœ‰ï¼Œåˆ™æ”¾å…¥EntryListï¼Œè¿›å…¥é˜»å¡çŠ¶æ€(blocked)</li></ul></li></ul></li><li><p>å½“Monitorçš„Ownerå°†ä¸´ç•ŒåŒºä¸­ä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒOwnerä¾¿ä¼šè¢«æ¸…ç©ºï¼Œæ­¤æ—¶EntryListä¸­å¤„äº<strong>é˜»å¡</strong>çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«<strong>å«é†’å¹¶ç«äº‰</strong>ï¼Œæ­¤æ—¶çš„ç«äº‰æ˜¯<strong>éå…¬å¹³çš„</strong></p></li><li><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>å¯¹è±¡åœ¨ä½¿ç”¨äº†synchronizedåä¸Monitorç»‘å®šæ—¶ï¼Œä¼šå°†å¯¹è±¡å¤´ä¸­çš„<strong>Mark Word</strong>ç½®ä¸ºMonitoræŒ‡é’ˆã€‚</li><li>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»‘å®šä¸€ä¸ª<strong>å”¯ä¸€çš„Monitor</strong>ï¼Œå¦‚æœsynchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>ä¸åŒ</strong>ï¼Œåˆ™ä¼šç»‘å®š<strong>ä¸åŒ</strong>çš„Monitor</li></ul></li></ul><h2 id="5ã€SynchronizedåŸç†è¿›é˜¶"><a href="#5ã€SynchronizedåŸç†è¿›é˜¶" class="headerlink" title="5ã€SynchronizedåŸç†è¿›é˜¶"></a>5ã€SynchronizedåŸç†è¿›é˜¶</h2><h3 id="å¯¹è±¡å¤´æ ¼å¼"><a href="#å¯¹è±¡å¤´æ ¼å¼" class="headerlink" title="å¯¹è±¡å¤´æ ¼å¼"></a>å¯¹è±¡å¤´æ ¼å¼</h3><p>æ™®é€šå¯¹è±¡</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gph8nfmtlrj30ya086gmo.jpg" alt="image-20210412203347281"></p><p>æ•°ç»„å¯¹è±¡</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gph8n1ce41j316w07yag2.jpg" alt="image-20210412203425689"></p><p>å…¶ä¸­Klasså¯ä»¥æ‰¾åˆ°ç±»å¯¹è±¡ï¼Œæœ‰<strong>ç±»å‹æŒ‡é’ˆObject reference</strong>ï¼ŒMac Wordç»“æ„ä¸º</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png" alt="img"></a></p><h3 id="1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"><a href="#1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰" class="headerlink" title="(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"></a>(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰</h3><p><strong>è½»é‡çº§é”ä½¿ç”¨åœºæ™¯ï¼š</strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œä½†è®¿é—®çš„æ—¶é—´æ˜¯<strong>é”™å¼€çš„ï¼ˆä¸å­˜åœ¨ç«äº‰ï¼‰</strong>ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<strong>è½»é‡çº§é”</strong>æ¥ä¼˜åŒ–ã€‚</p><ul><li><p>åˆ›å»º<strong>é”è®°å½•</strong>ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„<strong>æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•å¯¹è±¡</strong>ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„mark wordï¼ˆä¸å†ä¸€å¼€å§‹å°±ä½¿ç”¨Monitorï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png" alt="img"></a></p></li><li><p>è®©é”è®°å½•ä¸­çš„Object referenceæŒ‡å‘é”å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå¹¶å°è¯•ç”¨caså»æ›¿æ¢Objectä¸­çš„mark wordï¼Œå°†æ­¤mark wordæ”¾å…¥lock recordä¸­ä¿å­˜</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png" alt="img"></a></p><ul><li>å¦‚æœcasæ›¿æ¢æˆåŠŸï¼Œåˆ™å°†Objectçš„å¯¹è±¡å¤´æ›¿æ¢ä¸º<strong>é”è®°å½•çš„åœ°å€</strong>å’Œ<strong>çŠ¶æ€ 00ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</strong>ï¼Œå¹¶ç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png" alt="img"></a></p><ul><li>å¦‚æœcaså¤±è´¥ï¼Œæ˜¯è‡ªå·±æ‰§è¡Œäº†Synchronizedé”é‡å…¥ï¼Œé‚£ä¹ˆå†æ·»åŠ ä¸€æ¡Lock Recordä½œä¸ºé‡å…¥çš„è®¡æ•°</li></ul><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gph7zqfw55j30rw0hu7d2.jpg" alt="image-20210412201158273"  /><ul><li>å½“é€€å‡ºSynchronizedä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰å¦‚æœæœ‰å–å€¼ä¸ºnullçš„é”è®°å½•ï¼Œè¡¨ç¤º<strong>æœ‰é‡å…¥</strong>ï¼Œè¿™æ—¶<strong>é‡ç½®é”è®°å½•</strong>ï¼Œè¡¨ç¤ºé‡å…¥è®¡æ•°å‡ä¸€</li></ul><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gph84y06q0j30qu0g4jy0.jpg" alt="image-20210412201704193"></p><ul><li>å½“é€€å‡ºSynchronizedä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰é”è®°å½•çš„å€¼ä¸ä¸ºnullï¼Œè¿™æ—¶ä½¿ç”¨caså°†Mac Wordçš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´<ul><li>æˆåŠŸåˆ™è§£é”æˆåŠŸ</li><li>å¤±è´¥è¯´æ˜è½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–å·²ç»å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹</li></ul></li></ul><h3 id="2-é”è†¨èƒ€"><a href="#2-é”è†¨èƒ€" class="headerlink" title="(2)é”è†¨èƒ€"></a>(2)é”è†¨èƒ€</h3><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç»™ä¸€ä¸ªå¯¹è±¡åŠ è½»é‡çº§é”æ—¶ï¼Œ<strong>casæ›¿æ¢æ“ä½œå¤±è´¥</strong>ï¼ˆå› ä¸ºæ­¤æ—¶å…¶ä»–çº¿ç¨‹å·²ç»ç»™å¯¹è±¡åŠ äº†è½»é‡çº§é”ï¼‰ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥<strong>é”è†¨èƒ€</strong>è¿‡ç¨‹</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png" alt="img"></a></p><ul><li><p>æ­¤æ—¶ä¾¿ä¼šç»™å¯¹è±¡åŠ ä¸Šé‡é‡çº§é”ï¼ˆä½¿ç”¨Monitorï¼‰</p><ul><li><p>å°†å¯¹è±¡å¤´çš„Mark Wordæ”¹ä¸ºMonitorçš„åœ°å€ï¼Œå¹¶ä¸”çŠ¶æ€æ”¹ä¸º01(é‡é‡çº§é”)</p></li><li><p>å¹¶ä¸”è¯¥çº¿ç¨‹æ”¾å…¥å…¥EntryListä¸­ï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€(blocked)</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png" alt="img"></a></p></li></ul></li><li><p>å½“Thread-0é€€å‡ºåŒæ­¥å—è§£é”æ—¶ï¼Œä½¿ç”¨caså°†Mark Wordçš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ï¼Œå¤±è´¥ã€‚è¿™æ—¶ä¼šè¿›å…¥é‡é‡çº§è§£é”æµç¨‹ï¼Œå³æŒ‰ç…§Monitoråœ°å€æ‰¾åˆ°Monitorå¯¹è±¡ï¼Œè®¾ç½®Ownerä¸ºNullï¼Œå”¤é†’Entrylistä¸­BLOCKEDçº¿ç¨‹</p></li></ul><h3 id="3-è‡ªæ—‹ä¼˜åŒ–"><a href="#3-è‡ªæ—‹ä¼˜åŒ–" class="headerlink" title="(3)è‡ªæ—‹ä¼˜åŒ–"></a>(3)è‡ªæ—‹ä¼˜åŒ–</h3><p><strong>é‡é‡çº§é”</strong>ç«äº‰æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªé€‰æ¥ä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨<strong>è‡ªæ—‹æˆåŠŸ</strong>ï¼ˆä½¿ç”¨é”çš„çº¿ç¨‹é€€å‡ºäº†åŒæ­¥å—ï¼Œ<strong>é‡Šæ”¾äº†é”</strong>ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥é¿å…çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png" alt="img"></a></p><ul><li>ç¬¬äºŒç§æƒ…å†µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png" alt="img"></a></p><h3 id="4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥"><a href="#4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥" class="headerlink" title="(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)"></a>(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)</h3><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œæ¯æ¬¡<strong>é‡å…¥</strong>ï¼ˆè¯¥çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•ä¸­å†æ¬¡é”ä½è¯¥å¯¹è±¡ï¼‰æ“ä½œä»éœ€è¦casæ›¿æ¢æ“ä½œï¼Œè¿™æ ·æ˜¯ä¼šä½¿æ€§èƒ½é™ä½çš„ã€‚</p><p>æ‰€ä»¥å¼•å…¥äº†<strong>åå‘é”</strong>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼šåœ¨<strong>ç¬¬ä¸€æ¬¡</strong>casæ—¶ä¼šå°†<strong>çº¿ç¨‹çš„ID</strong>å†™å…¥å¯¹è±¡çš„Mark Wordä¸­ã€‚æ­¤åå‘ç°è¿™ä¸ªçº¿ç¨‹IDå°±æ˜¯è‡ªå·±çš„ï¼Œå°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œå°±ä¸éœ€è¦å†æ¬¡casï¼Œä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png" alt="img"></a></p><h4 id="åå‘çŠ¶æ€"><a href="#åå‘çŠ¶æ€" class="headerlink" title="åå‘çŠ¶æ€"></a>åå‘çŠ¶æ€</h4><ul><li>Normalï¼šä¸€èˆ¬çŠ¶æ€ï¼Œæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œå‰é¢62ä½ä¿å­˜çš„æ˜¯å¯¹è±¡çš„ä¿¡æ¯ï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆæœªä½¿ç”¨ï¼š0ï¼‰</strong></li><li>Biasedï¼šåå‘çŠ¶æ€ï¼Œä½¿ç”¨åå‘é”ï¼Œå‰é¢54ä½ä¿å­˜çš„å½“å‰çº¿ç¨‹çš„IDï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆä½¿ç”¨ï¼š1ï¼‰</strong></li><li>Lightweightï¼šä½¿ç”¨è½»é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯é”è®°å½•çš„æŒ‡é’ˆï¼Œ<strong>æœ€åä¸¤ä½ä¸ºçŠ¶æ€ï¼ˆ00ï¼‰</strong></li><li>Heavyweightï¼šä½¿ç”¨é‡é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯Monitorçš„åœ°å€æŒ‡é’ˆï¼Œ<strong>åä¸¤ä½ä¸ºçŠ¶æ€(10)</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png" alt="img"></a></p><ul><li>å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯101</li><li>ä½†æ˜¯åå‘é”é»˜è®¤æ˜¯<strong>æœ‰å»¶è¿Ÿ</strong>çš„ï¼Œä¸ä¼šå†ç¨‹åºä¸€å¯åŠ¨å°±ç”Ÿæ•ˆï¼Œè€Œæ˜¯ä¼šåœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’ä¹‹åï¼‰ï¼Œæ‰ä¼šå¯¹åˆ›å»ºçš„å¯¹è±¡è®¾ç½®ä¸ºåå‘çŠ¶æ€ï¼Œå¯ç”¨VMå‚æ•° -XX: BiasedLockingStartopDelay=0æ¥ç¦ç”¨å»¶è¿Ÿ</li><li>å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯001ï¼Œè¿™æ—¶å€™å®ƒçš„hashcodeã€ageéƒ½ä¸º0ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°hashcodeæ—¶æ‰ä¼šèµ‹å€¼</li></ul><h4 id="æ’¤é”€åå‘"><a href="#æ’¤é”€åå‘" class="headerlink" title="æ’¤é”€åå‘"></a>æ’¤é”€åå‘</h4><p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šä½¿å¯¹è±¡çš„<strong>åå‘é”å¤±æ•ˆ</strong></p><ul><li>è°ƒç”¨å¯¹è±¡çš„hashCodeæ–¹æ³•</li><li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥å¯¹è±¡</li><li><strong>è°ƒç”¨äº†wait/notifyæ–¹æ³•</strong>ï¼ˆè°ƒç”¨waitæ–¹æ³•ä¼šå¯¼è‡´é”è†¨èƒ€è€Œä½¿ç”¨<strong>é‡é‡çº§é”</strong>ï¼‰</li></ul><h3 id="5-æ‰¹é‡é‡åå‘"><a href="#5-æ‰¹é‡é‡åå‘" class="headerlink" title="(5)æ‰¹é‡é‡åå‘"></a>(5)æ‰¹é‡é‡åå‘</h3><ul><li>å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯çº¿ç¨‹é—´ä¸å­˜åœ¨ç«äº‰ï¼Œè¿™æ—¶åå‘T1çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘T2<ul><li>é‡åå‘ä¼šé‡ç½®Thread ID</li></ul></li><li>å½“<strong>æ’¤é”€è¶…è¿‡20æ¬¡å</strong>ï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰ï¼ŒJVMä¼šè§‰å¾—æ˜¯ä¸æ˜¯åå‘é”™äº†ï¼Œè¿™æ—¶ä¼šåœ¨ç»™å¯¹è±¡åŠ é”æ—¶ï¼Œ<strong>é‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹</strong>ã€‚</li></ul><h3 id="6-æ‰¹é‡æ’¤é”€"><a href="#6-æ‰¹é‡æ’¤é”€" class="headerlink" title="(6)æ‰¹é‡æ’¤é”€"></a>(6)æ‰¹é‡æ’¤é”€</h3><p>å½“æ’¤é”€åå‘é”çš„é˜ˆå€¼<strong>è¶…è¿‡40ä»¥å</strong>ï¼Œå°±ä¼šå°†<strong>æ•´ä¸ªç±»çš„å¯¹è±¡éƒ½æ”¹ä¸ºä¸å¯åå‘çš„</strong></p><h2 id="6ã€Wait-Notify"><a href="#6ã€Wait-Notify" class="headerlink" title="6ã€Wait/Notify"></a>6ã€Wait/Notify</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="(1)åŸç†"></a>(1)åŸç†</h3><p> <a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png" alt="img"></a></p><ul><li><p>é”å¯¹è±¡è°ƒç”¨waitæ–¹æ³•ï¼ˆobj.waitï¼‰ï¼Œå°±ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥WaitSetä¸­ï¼Œå˜ä¸ºWAITINGçŠ¶æ€ã€‚</p></li><li><p>å¤„äº<strong>BLOCKEDå’ŒWAITINGçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¸ºé˜»å¡</strong>çŠ¶æ€ï¼ŒCPUéƒ½ä¸ä¼šåˆ†ç»™ä»–ä»¬æ—¶é—´ç‰‡ã€‚ä½†æ˜¯æœ‰æ‰€åŒºåˆ«ï¼š</p><ul><li>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹æ˜¯åœ¨ç«äº‰å¯¹è±¡æ—¶ï¼Œå‘ç°Monitorçš„Ownerå·²ç»æ˜¯åˆ«çš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥EntryListä¸­ï¼Œå¹¶å¤„äºBLOCKEDçŠ¶æ€</li><li>WAITINGçŠ¶æ€çš„çº¿ç¨‹æ˜¯è·å¾—äº†å¯¹è±¡çš„é”ï¼Œä½†æ˜¯è‡ªèº«å› ä¸ºæŸäº›åŸå› éœ€è¦è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œé”å¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•è€Œè¿›å…¥äº†WaitSetä¸­ï¼Œå¤„äºWAITINGçŠ¶æ€</li></ul></li><li><p>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹ä¼šåœ¨é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’ï¼Œä½†æ˜¯å¤„äºWAITINGçŠ¶æ€çš„çº¿ç¨‹åªæœ‰è¢«é”å¯¹è±¡è°ƒç”¨äº†notifyæ–¹æ³•(obj.notify/obj.notifyAll)ï¼Œæ‰ä¼šè¢«å”¤é†’ã€‚</p></li></ul><p><strong>æ³¨ï¼šåªæœ‰å½“å¯¹è±¡è¢«é”ä»¥åï¼Œæ‰èƒ½è°ƒç”¨waitå’Œnotifyæ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test1</span> </span>&#123;    <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Object LOCK = <span class="hljs-keyword">new</span> Object();    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-comment">//åªæœ‰åœ¨å¯¹è±¡è¢«é”ä½åæ‰èƒ½è°ƒç”¨waitæ–¹æ³•</span>        <span class="hljs-keyword">synchronized</span> (LOCK) &#123;            LOCK.wait();        &#125;    &#125;&#125;</code></pre></div><h3 id="2-Waitä¸Sleepçš„åŒºåˆ«"><a href="#2-Waitä¸Sleepçš„åŒºåˆ«" class="headerlink" title="(2)Waitä¸Sleepçš„åŒºåˆ«"></a>(2)Waitä¸Sleepçš„åŒºåˆ«</h3><p><strong>ä¸åŒç‚¹</strong></p><ul><li>Sleepæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼ŒWaitæ˜¯Objectçš„æ–¹æ³•ï¼ŒObjectåˆæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥æ‰€æœ‰ç±»éƒ½æœ‰Waitæ–¹æ³•ã€‚</li><li><strong>Sleepåœ¨é˜»å¡çš„æ—¶å€™ä¸ä¼šé‡Šæ”¾é”ï¼Œè€ŒWaitåœ¨é˜»å¡çš„æ—¶å€™ä¼šé‡Šæ”¾é”</strong></li><li>Sleepä¸éœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼Œè€ŒWaitéœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼ˆå¯¹è±¡è¢«é”ä»¥åæ‰èƒ½ä½¿ç”¨ï¼‰</li></ul><p><strong>ç›¸åŒç‚¹</strong></p><ul><li>é˜»å¡çŠ¶æ€éƒ½ä¸º<strong>TIMED_WAITING</strong></li></ul><h3 id="3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify"><a href="#3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify" class="headerlink" title="(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify"></a>(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify</h3><p><strong>ä»€ä¹ˆæ—¶å€™é€‚åˆä½¿ç”¨wait</strong></p><ul><li>å½“çº¿ç¨‹<strong>ä¸æ»¡è¶³æŸäº›æ¡ä»¶</strong>ï¼Œéœ€è¦æš‚åœè¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨waitã€‚è¿™æ ·ä¼šå°†<strong>å¯¹è±¡çš„é”é‡Šæ”¾</strong>ï¼Œè®©å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚å¦‚æœæ­¤æ—¶ä½¿ç”¨sleepï¼Œä¼šå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥é˜»å¡ï¼Œå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½æ²¡æ³•è¿è¡Œï¼Œç›´åˆ°å½“å‰çº¿ç¨‹sleepç»“æŸåï¼Œè¿è¡Œå®Œæ¯•ï¼Œæ‰èƒ½å¾—åˆ°æ‰§è¡Œã€‚</li></ul><p><strong>ä½¿ç”¨wait/notifyéœ€è¦æ³¨æ„ä»€ä¹ˆ</strong></p><ul><li>å½“æœ‰<strong>å¤šä¸ª</strong>çº¿ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œå¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•ï¼Œæ­¤æ—¶è¿™äº›çº¿ç¨‹éƒ½ä¼šè¿›å…¥WaitSetä¸­ç­‰å¾…ã€‚å¦‚æœè¿™æ—¶ä½¿ç”¨äº†<strong>notify</strong>æ–¹æ³•ï¼Œå¯èƒ½ä¼šé€ æˆ<strong>è™šå‡å”¤é†’</strong>ï¼ˆå”¤é†’çš„ä¸æ˜¯æ»¡è¶³æ¡ä»¶çš„ç­‰å¾…çº¿ç¨‹ï¼‰ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨<strong>notifyAll</strong>æ–¹æ³•ï¼ŒåŒæ—¶å°†waitæ–¹æ³•ç½®äºwhileå¾ªç¯ä¸­åˆ¤æ–­ï¼ŒåŒæ ·é¿å…è™šå‡å”¤é†’ã€‚</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (LOCK) &#123;    <span class="hljs-keyword">while</span>(<span class="hljs-comment">//ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’) &#123;</span>        LOCK.wait();    &#125;    <span class="hljs-comment">//æ»¡è¶³æ¡ä»¶åå†è¿è¡Œ</span>&#125;<span class="hljs-keyword">synchronized</span> (LOCK) &#123;    <span class="hljs-comment">//å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>    LOCK.notifyAll();&#125;</code></pre></div><h2 id="7ã€åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"><a href="#7ã€åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ" class="headerlink" title="7ã€åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"></a>7ã€åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ</h2><h3 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png" alt="img"></a></p><h3 id="2-ä¸¾ä¾‹"><a href="#2-ä¸¾ä¾‹" class="headerlink" title="(2)ä¸¾ä¾‹"></a>(2)ä¸¾ä¾‹</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        String hello = <span class="hljs-string">&quot;hello thread!&quot;</span>;        Guarded guarded = <span class="hljs-keyword">new</span> Guarded();        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            System.out.println(<span class="hljs-string">&quot;æƒ³è¦å¾—åˆ°ç»“æœ&quot;</span>);            <span class="hljs-keyword">synchronized</span> (guarded) &#123;                System.out.println(<span class="hljs-string">&quot;ç»“æœæ˜¯ï¼š&quot;</span>+guarded.getResponse());            &#125;            System.out.println(<span class="hljs-string">&quot;å¾—åˆ°ç»“æœ&quot;</span>);        &#125;).start();        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            System.out.println(<span class="hljs-string">&quot;è®¾ç½®ç»“æœ&quot;</span>);            <span class="hljs-keyword">synchronized</span> (guarded) &#123;                guarded.setResponse(hello);            &#125;        &#125;).start();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Guarded</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¦è¿”å›çš„ç»“æœ</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> Object response;    <span class="hljs-comment">//ä¼˜é›…åœ°ä½¿ç”¨wait/notify</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getResponse</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//å¦‚æœè¿”å›ç»“æœä¸ºç©ºå°±ä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’</span>        <span class="hljs-keyword">while</span>(response == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;                <span class="hljs-keyword">try</span> &#123;                    <span class="hljs-keyword">this</span>.wait();                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> response;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setResponse</span><span class="hljs-params">(Object response)</span> </span>&#123;        <span class="hljs-keyword">this</span>.response = response;        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;            <span class="hljs-comment">//å”¤é†’ä¼‘çœ çš„çº¿ç¨‹</span>            <span class="hljs-keyword">this</span>.notifyAll();        &#125;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Guarded&#123;&quot;</span> +                <span class="hljs-string">&quot;response=&quot;</span> + response +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;&#125;</code></pre></div><p><strong>å¸¦è¶…æ—¶åˆ¤æ–­çš„æš‚åœ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getResponse</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time)</span> </span>&#123;        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;            <span class="hljs-comment">//è·å–å¼€å§‹æ—¶é—´</span>            <span class="hljs-keyword">long</span> currentTime = System.currentTimeMillis();            <span class="hljs-comment">//ç”¨äºä¿å­˜å·²ç»ç­‰å¾…äº†çš„æ—¶é—´</span>            <span class="hljs-keyword">long</span> passedTime = <span class="hljs-number">0</span>;            <span class="hljs-keyword">while</span>(response == <span class="hljs-keyword">null</span>) &#123;                <span class="hljs-comment">//çœ‹ç»è¿‡çš„æ—¶é—´-å¼€å§‹æ—¶é—´æ˜¯å¦è¶…è¿‡äº†æŒ‡å®šæ—¶é—´</span>                <span class="hljs-keyword">long</span> waitTime = time -passedTime;                <span class="hljs-keyword">if</span>(waitTime &lt;= <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">break</span>;                &#125;                <span class="hljs-keyword">try</span> &#123;                       <span class="hljs-comment">//ç­‰å¾…å‰©ä½™æ—¶é—´</span>                    <span class="hljs-keyword">this</span>.wait(waitTime);                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;                <span class="hljs-comment">//è·å–å½“å‰æ—¶é—´</span>                passedTime = System.currentTimeMillis()-currentTime                    &#125;        &#125;        <span class="hljs-keyword">return</span> response;    &#125;</code></pre></div><h3 id="3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"><a href="#3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼" class="headerlink" title="(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"></a>(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">join</span><span class="hljs-params">(<span class="hljs-keyword">long</span> millis)</span></span><span class="hljs-function">    <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">long</span> base = System.currentTimeMillis();        <span class="hljs-keyword">long</span> now = <span class="hljs-number">0</span>;        <span class="hljs-keyword">if</span> (millis &lt; <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;timeout value is negative&quot;</span>);        &#125;        <span class="hljs-keyword">if</span> (millis == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">while</span> (isAlive()) &#123;                wait(<span class="hljs-number">0</span>);            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">while</span> (isAlive()) &#123;              <span class="hljs-comment">//åŒæ ·çš„æ€æƒ³ï¼Œç”¨äºjoin</span>                <span class="hljs-keyword">long</span> delay = millis - now;                <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">break</span>;                &#125;                wait(delay);                now = System.currentTimeMillis() - base;            &#125;        &#125;    &#125;</code></pre></div><h2 id="8ã€å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…"><a href="#8ã€å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…" class="headerlink" title="8ã€å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…/æ¶ˆè´¹è€…"></a>8ã€å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…/æ¶ˆè´¹è€…</h2><h3 id="1-å®šä¹‰-1"><a href="#1-å®šä¹‰-1" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><ul><li>ä¸å‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„GuardObjectä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æœå’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº”</li><li>æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº</li><li>ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æœæ•°æ®</li><li>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ®</li><li>JDKä¸­å„ç§é˜»å¡é˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼</li></ul><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpj133103oj31bo0bmahb.jpg" alt="image-20210414094410348"></p><h3 id="2-ä»£ç "><a href="#2-ä»£ç " class="headerlink" title="(2)ä»£ç "></a>(2)ä»£ç </h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test21&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMessageQueue</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        MessageQueue queue = <span class="hljs-keyword">new</span> MessageQueue(<span class="hljs-number">2</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;            <span class="hljs-keyword">int</span> id = i;            <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;                queue.put(<span class="hljs-keyword">new</span> Message(id , <span class="hljs-string">&quot;å€¼&quot;</span>+id));            &#125;, <span class="hljs-string">&quot;ç”Ÿäº§è€…&quot;</span> + i).start();        &#125;        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;                sleep(<span class="hljs-number">1</span>);                Message message = queue.take();            &#125;        &#125;, <span class="hljs-string">&quot;æ¶ˆè´¹è€…&quot;</span>).start();    &#125;&#125;<span class="hljs-comment">// æ¶ˆæ¯é˜Ÿåˆ—ç±» ï¼Œ java çº¿ç¨‹ä¹‹é—´é€šä¿¡</span><span class="hljs-meta">@Slf4j(topic = &quot;c.MessageQueue&quot;)</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageQueue</span> </span>&#123;    <span class="hljs-comment">// æ¶ˆæ¯çš„é˜Ÿåˆ—é›†åˆ,åŒå‘é˜Ÿåˆ—</span>    <span class="hljs-keyword">private</span> LinkedList&lt;Message&gt; list = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();    <span class="hljs-comment">// é˜Ÿåˆ—å®¹é‡</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capcity;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MessageQueue</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capcity)</span> </span>&#123;        <span class="hljs-keyword">this</span>.capcity = capcity;    &#125;    <span class="hljs-comment">// è·å–æ¶ˆæ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">take</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">// æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span>        <span class="hljs-keyword">synchronized</span> (list) &#123;            <span class="hljs-keyword">while</span>(list.isEmpty()) &#123;                <span class="hljs-keyword">try</span> &#123;                    log.debug(<span class="hljs-string">&quot;é˜Ÿåˆ—ä¸ºç©º, æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…&quot;</span>);                    list.wait();                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;            &#125;            <span class="hljs-comment">// ä»é˜Ÿåˆ—å¤´éƒ¨è·å–æ¶ˆæ¯å¹¶è¿”å›</span>            Message message = list.removeFirst();            log.debug(<span class="hljs-string">&quot;å·²æ¶ˆè´¹æ¶ˆæ¯ &#123;&#125;&quot;</span>, message);            list.notifyAll();            <span class="hljs-keyword">return</span> message;        &#125;    &#125;    <span class="hljs-comment">// å­˜å…¥æ¶ˆæ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(Message message)</span> </span>&#123;        <span class="hljs-keyword">synchronized</span> (list) &#123;            <span class="hljs-comment">// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²æ»¡</span>            <span class="hljs-keyword">while</span>(list.size() == capcity) &#123;                <span class="hljs-keyword">try</span> &#123;                    log.debug(<span class="hljs-string">&quot;é˜Ÿåˆ—å·²æ»¡, ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…&quot;</span>);                    list.wait();                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;            &#125;            <span class="hljs-comment">// å°†æ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨</span>            list.addLast(message);            log.debug(<span class="hljs-string">&quot;å·²ç”Ÿäº§æ¶ˆæ¯ &#123;&#125;&quot;</span>, message);            list.notifyAll();        &#125;    &#125;&#125;<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;    <span class="hljs-keyword">private</span> Object value;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Message</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, Object value)</span> </span>&#123;        <span class="hljs-keyword">this</span>.id = id;        <span class="hljs-keyword">this</span>.value = value;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> id;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getValue</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> value;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Message&#123;&quot;</span> +                <span class="hljs-string">&quot;id=&quot;</span> + id +                <span class="hljs-string">&quot;, value=&quot;</span> + value +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;&#125;</code></pre></div><h2 id="9ã€park-unpark"><a href="#9ã€park-unpark" class="headerlink" title="9ã€park/unpark"></a>9ã€park/unpark</h2><h3 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="(1)åŸºæœ¬ä½¿ç”¨"></a>(1)åŸºæœ¬ä½¿ç”¨</h3><p><strong>park/unparkéƒ½æ˜¯LockSupportç±»ä¸­çš„çš„æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span>LockSupport.park;<span class="hljs-comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span>LockSupport.unpark(thread); <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        Thread thread = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            System.out.println(<span class="hljs-string">&quot;park&quot;</span>);            <span class="hljs-comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span>            LockSupport.park();            System.out.println(<span class="hljs-string">&quot;resume&quot;</span>);        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);        thread.start();        Thread.sleep(<span class="hljs-number">1000</span>);        System.out.println(<span class="hljs-string">&quot;unpark&quot;</span>);        <span class="hljs-comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span>        LockSupport.unpark(thread);    &#125;</code></pre></div><h3 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="(2)ç‰¹ç‚¹"></a>(2)ç‰¹ç‚¹</h3><p><strong>ä¸wait/notifyçš„åŒºåˆ«</strong></p><ul><li>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ<strong>Object Monitor</strong>ä¸€èµ·ä½¿ç”¨ï¼Œè€Œparkï¼Œunparkä¸å¿…</li><li>park ï¼Œunpark æ˜¯ä»¥<strong>çº¿ç¨‹ä¸ºå•ä½</strong>æ¥<strong>é˜»å¡</strong>å’Œ<strong>å”¤é†’</strong>çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆç²¾ç¡®</li><li>park &amp; unpark å¯ä»¥<strong>å…ˆ unpark</strong>ï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</li><li><strong>parkä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œè€Œwaitä¼šé‡Šæ”¾é”</li></ul><h3 id="3-åŸç†"><a href="#3-åŸç†" class="headerlink" title="(3)åŸç†"></a>(3)åŸç†</h3><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„<strong>Parkå¯¹è±¡</strong>ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡**_counter, _cond,__mutex**ç»„æˆ</p><ul><li>å…ˆè°ƒç”¨parkå†è°ƒç”¨unparkæ—¶<ul><li><p>å…ˆè°ƒç”¨park</p><ul><li>çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä¼šå°†Parkå¯¹è±¡ä¸­çš„**_counterçš„å€¼è®¾ä¸º0**ï¼›</li><li>è°ƒç”¨parkæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹counterçš„å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—condä¸­</li><li>æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­åï¼Œä¼š<strong>å†æ¬¡</strong>å°†counterè®¾ç½®ä¸º0</li></ul></li><li><p>ç„¶åè°ƒç”¨unpark</p><ul><li><p>è°ƒç”¨unparkæ–¹æ³•åï¼Œä¼šå°†counterçš„å€¼è®¾ç½®ä¸º1</p></li><li><p>å»å”¤é†’é˜»å¡é˜Ÿåˆ—condä¸­çš„çº¿ç¨‹</p></li><li><p>çº¿ç¨‹ç»§ç»­è¿è¡Œå¹¶å°†counterçš„å€¼è®¾ä¸º0</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png" alt="img"></a></p></li></ul></li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png" alt="img"></a></p><ul><li>å…ˆè°ƒç”¨unparkï¼Œå†è°ƒç”¨park<ul><li>è°ƒç”¨unpark<ul><li>ä¼šå°†counterè®¾ç½®ä¸º1ï¼ˆè¿è¡Œæ—¶0ï¼‰</li></ul></li><li>è°ƒç”¨parkæ–¹æ³•<ul><li>æŸ¥çœ‹counteræ˜¯å¦ä¸º0</li><li>å› ä¸ºunparkå·²ç»æŠŠcounterè®¾ç½®ä¸º1ï¼Œæ‰€ä»¥æ­¤æ—¶å°†counterè®¾ç½®ä¸º0ï¼Œä½†<strong>ä¸æ”¾å…¥</strong>é˜»å¡é˜Ÿåˆ—condä¸­</li></ul></li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png" alt="img"></a></p><h2 id="10ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"><a href="#10ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢" class="headerlink" title="10ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"></a>10ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png" alt="img"></a></p><h3 id="æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE"><a href="#æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE" class="headerlink" title="æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE"></a>æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE</h3><ul><li>å½“è°ƒç”¨äº†t.start()æ–¹æ³•æ—¶ï¼Œç”± NEW â€“&gt; RUNNABLE </li></ul><h3 id="æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul><li>å½“è°ƒç”¨äº†t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å<ul><li><p>è°ƒç”¨ obj.wait() æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</p></li><li><p>è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶</p><ul><li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE </li><li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; BLOCKED </li></ul></li></ul></li></ul><h3 id="æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING</h3><ul><li><p>å½“å‰çº¿ç¨‹</p><p>è°ƒç”¨ t.join() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</p><ul><li>æ³¨æ„æ˜¯<strong>å½“å‰çº¿ç¨‹</strong>åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li></ul></li><li><p>t çº¿ç¨‹<strong>è¿è¡Œç»“æŸ</strong>ï¼Œæˆ–è°ƒç”¨äº†<strong>å½“å‰çº¿ç¨‹</strong>çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</p></li></ul><h3 id="æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.park() æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</li><li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><p>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å</p><ul><li>è°ƒç”¨ obj.wait(<strong>long n</strong>) æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li><li>t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶<ul><li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li><li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; BLOCKED </li></ul></li></ul><h3 id="æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li><p>å½“å‰çº¿ç¨‹è°ƒç”¨ t.join(long n) æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</p></li><li><p>æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾… </p></li><li><p>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</p></li></ul><h3 id="æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ Thread.sleep(long n) ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING </li><li>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.parkNanos(long nanos) æˆ– LockSupport.parkUntil(long millis) æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING </li><li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» TIMED_WAITINGâ€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED"><a href="#æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED" class="headerlink" title="æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED"></a>æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED</h3><ul><li>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”æ—¶å¦‚æœ<strong>ç«äº‰å¤±è´¥</strong>ï¼Œä» RUNNABLE â€“&gt; BLOCKED </li><li>æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ BLOCKED çš„çº¿ç¨‹é‡æ–°ç«äº‰ï¼Œå¦‚æœå…¶ä¸­ t çº¿ç¨‹ç«äº‰ æˆåŠŸï¼Œä» BLOCKED â€“&gt; RUNNABLE ï¼Œå…¶å®ƒ<strong>å¤±è´¥</strong>çš„çº¿ç¨‹ä»ç„¶ BLOCKED </li></ul><h3 id="æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED"><a href="#æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED" class="headerlink" title="æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED"></a>æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED</h3><p>å½“å‰çº¿<strong>ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•</strong>ï¼Œè¿›å…¥ TERMINATED</p><h2 id="11ã€å¤šæŠŠé”"><a href="#11ã€å¤šæŠŠé”" class="headerlink" title="11ã€å¤šæŠŠé”"></a>11ã€å¤šæŠŠé”</h2><p><strong>å°†é”çš„ç²’åº¦ç»†åˆ†</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigRoom</span> </span>&#123;    <span class="hljs-comment">//é¢å¤–åˆ›å»ºå¯¹è±¡æ¥ä½œä¸ºé”</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object studyRoom = <span class="hljs-keyword">new</span> Object();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object bedRoom = <span class="hljs-keyword">new</span> Object();&#125;</code></pre></div><ul><li>å¥½å¤„ï¼Œæ˜¯å¯ä»¥å¢åŠ å¹¶å‘åº¦</li><li>åå¤„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å¾—å¤šæŠŠé”ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ­»é”</li></ul><h2 id="12ã€æ´»è·ƒæ€§"><a href="#12ã€æ´»è·ƒæ€§" class="headerlink" title="12ã€æ´»è·ƒæ€§"></a>12ã€æ´»è·ƒæ€§</h2><h3 id="1-å®šä¹‰-2"><a href="#1-å®šä¹‰-2" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p>å› ä¸ºæŸç§åŸå› ï¼Œä½¿å¾—ä»£ç ä¸€ç›´æ— æ³•æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ ·çš„ç°è±¡å«åšæ´»è·ƒæ€§</p><h3 id="2-æ­»é”"><a href="#2-æ­»é”" class="headerlink" title="(2)æ­»é”"></a>(2)æ­»é”</h3><p>æœ‰è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦<strong>åŒæ—¶è·å–å¤šæŠŠé”</strong>ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p><p>å¦‚ï¼št1çº¿ç¨‹è·å¾—Aå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”</p><p>â€‹         t2çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é” </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">final</span> Object A = <span class="hljs-keyword">new</span> Object();        <span class="hljs-keyword">final</span> Object B = <span class="hljs-keyword">new</span> Object();        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            <span class="hljs-keyword">synchronized</span> (A) &#123;                <span class="hljs-keyword">try</span> &#123;                    Thread.sleep(<span class="hljs-number">2000</span>);                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;                <span class="hljs-keyword">synchronized</span> (B) &#123;                &#125;            &#125;        &#125;).start();        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            <span class="hljs-keyword">synchronized</span> (B) &#123;                <span class="hljs-keyword">try</span> &#123;                    Thread.sleep(<span class="hljs-number">1000</span>);                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;                <span class="hljs-keyword">synchronized</span> (A) &#123;                &#125;            &#125;        &#125;).start();    &#125;</code></pre></div><h4 id="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"></a>å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h4><ul><li>äº’æ–¥æ¡ä»¶<ul><li>åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œä¸€ç§èµ„æºåªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨</li></ul></li><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶<ul><li>è¿›ç¨‹å·²ç»æ‹¥æœ‰äº†è‡³å°‘ä¸€ç§èµ„æºï¼ŒåŒæ—¶åˆå»ç”³è¯·å…¶ä»–èµ„æºã€‚å› ä¸ºå…¶ä»–èµ„æºè¢«åˆ«çš„è¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œè¯¥è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”ä¸é‡Šæ”¾è‡ªå·±å·²æœ‰çš„èµ„æº</li></ul></li><li>ä¸å¯æŠ¢å æ¡ä»¶<ul><li>è¿›ç¨‹å¯¹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæˆå‰ä¸èƒ½è¢«å¼ºå ï¼Œåªèƒ½åœ¨è¿›ç¨‹ä½¿ç”¨å®Œåè‡ªå·±é‡Šæ”¾</li></ul></li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶<ul><li>å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”â€”èµ„æºçš„å¾ªç¯é“¾ã€‚</li></ul></li></ul><h4 id="å®šä½æ­»é”çš„æ–¹æ³•"><a href="#å®šä½æ­»é”çš„æ–¹æ³•" class="headerlink" title="å®šä½æ­»é”çš„æ–¹æ³•"></a>å®šä½æ­»é”çš„æ–¹æ³•</h4><ul><li><p><code>jps+jstack ThreadID</code></p><ul><li>åœ¨JAVAæ§åˆ¶å°ä¸­çš„Terminalä¸­è¾“å…¥<strong>jps</strong>æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹è¿è¡Œä¸­çš„çº¿ç¨‹IDï¼Œä½¿ç”¨<strong>jstack ThreadID</strong>å¯ä»¥æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€‚<a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png" alt="img"></a></li></ul><div class="hljs code-wrapper"><pre><code class="hljs sh">â¯ jps14196 RemoteMavenServer36694 NutstoreGUI14871 Launcher14872 TestDeadLock14121 14876 Jpsâ¯ â¯ â¯ jstack 14872</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs smali">  - æ‰“å°çš„ç»“æœ    ```java  //æ‰¾åˆ°ä¸€ä¸ªjavaçº§åˆ«çš„æ­»é”  Found one Java-level deadlock:  =============================  <span class="hljs-string">&quot;Thread-1&quot;</span>:    waiting to lock<span class="hljs-built_in"> monitor </span>0x0000000017f40de8 (object 0x00000000d6188880, a java.lang.Object),    which is held by <span class="hljs-string">&quot;Thread-0&quot;</span>  <span class="hljs-string">&quot;Thread-0&quot;</span>:    waiting to lock<span class="hljs-built_in"> monitor </span>0x0000000017f43678 (object 0x00000000d6188890, a java.lang.Object),    which is held by <span class="hljs-string">&quot;Thread-1&quot;</span></code></pre></div></li><li><p>jconsoleæ£€æµ‹æ­»é”</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png" alt="img"></a></p></li></ul><h4 id="å“²å­¦å®¶å°±é¤é—®é¢˜"><a href="#å“²å­¦å®¶å°±é¤é—®é¢˜" class="headerlink" title="å“²å­¦å®¶å°±é¤é—®é¢˜"></a>å“²å­¦å®¶å°±é¤é—®é¢˜</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png" alt="img"></a></p><h4 id="é¿å…æ­»é”çš„æ–¹æ³•"><a href="#é¿å…æ­»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ­»é”çš„æ–¹æ³•"></a>é¿å…æ­»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹ä½¿ç”¨é”å¯¹è±¡æ—¶<strong>ï¼Œé¡ºåºåŠ é”</strong>å³å¯é¿å…æ­»é”</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png" alt="img"></a></p><h3 id="3-æ´»é”"><a href="#3-æ´»é”" class="headerlink" title="(3)æ´»é”"></a>(3)æ´»é”</h3><p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹<strong>äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶</strong>ï¼Œåè°ä¹Ÿæ— æ³•ç»“æŸã€‚</p><h4 id="é¿å…æ´»é”çš„æ–¹æ³•"><a href="#é¿å…æ´»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ´»é”çš„æ–¹æ³•"></a>é¿å…æ´»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¸­é€”ç»™äºˆ<strong>ä¸åŒçš„é—´éš”æ—¶é—´</strong>å³å¯ã€‚</p><h4 id="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"><a href="#æ­»é”ä¸æ´»é”çš„åŒºåˆ«" class="headerlink" title="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"></a>æ­»é”ä¸æ´»é”çš„åŒºåˆ«</h4><ul><li>æ­»é”æ˜¯å› ä¸ºçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹è±¡æƒ³è¦çš„é”ï¼Œå¹¶ä¸”éƒ½ä¸é‡Šæ”¾ï¼Œæœ€ååˆ°æ—¶<strong>çº¿ç¨‹é˜»å¡</strong>ï¼Œ<strong>åœæ­¢è¿è¡Œ</strong>çš„ç°è±¡ã€‚</li><li>æ´»é”æ˜¯å› ä¸ºçº¿ç¨‹é—´ä¿®æ”¹äº†å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œè€Œå¯¼è‡´ä»£ç <strong>ä¸€ç›´åœ¨è¿è¡Œ</strong>ï¼Œå´ä¸€ç›´<strong>è¿è¡Œä¸å®Œ</strong>çš„ç°è±¡ã€‚</li></ul><h3 id="4-é¥¥é¥¿"><a href="#4-é¥¥é¥¿" class="headerlink" title="(4)é¥¥é¥¿"></a>(4)é¥¥é¥¿</h3><p>æŸäº›çº¿ç¨‹å› ä¸ºä¼˜å…ˆçº§å¤ªä½ï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•è·å¾—èµ„æºçš„ç°è±¡ã€‚</p><p><strong>åœ¨ä½¿ç”¨é¡ºåºåŠ é”æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿ç°è±¡</strong></p><h2 id="13ã€ReentrantLock"><a href="#13ã€ReentrantLock" class="headerlink" title="13ã€ReentrantLock"></a>13ã€ReentrantLock</h2><p><strong>å’Œsynchronizedç›¸æ¯”å…·æœ‰çš„çš„ç‰¹ç‚¹</strong></p><ul><li>å¯ä¸­æ–­ </li><li>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ </li><li>å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” (å…ˆåˆ°å…ˆå¾—)</li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡( å…·æœ‰<strong>å¤šä¸ª</strong>waitset)</li></ul><p><strong>åŸºæœ¬è¯­æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//è·å–ReentrantLockå¯¹è±¡</span><span class="hljs-keyword">private</span> ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<span class="hljs-comment">//åŠ é”</span>lock.lock();<span class="hljs-keyword">try</span> &#123;    <span class="hljs-comment">//éœ€è¦æ‰§è¡Œçš„ä»£ç </span>&#125;<span class="hljs-keyword">finally</span> &#123;    <span class="hljs-comment">//é‡Šæ”¾é”</span>    lock.unlock();&#125;</code></pre></div><h4 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h4><ul><li>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”</li><li>å¦‚æœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½</li></ul><h4 id="å¯æ‰“æ–­"><a href="#å¯æ‰“æ–­" class="headerlink" title="å¯æ‰“æ–­"></a>å¯æ‰“æ–­</h4><p>å¦‚æœæŸä¸ªçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥è°ƒç”¨å…¶interruptæ–¹æ³•è®©å…¶åœæ­¢é˜»å¡ï¼Œè·å¾—é”å¤±è´¥</p><p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šå¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¢«æ‰“æ–­äº†å°±ä¸ç”¨é˜»å¡äº†ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();        Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">//åŠ é”ï¼Œå¯æ‰“æ–­é”</span>                lock.lockInterruptibly();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();                <span class="hljs-comment">//è¢«æ‰“æ–­ï¼Œè¿”å›ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œ</span>                <span class="hljs-keyword">return</span>;            &#125;<span class="hljs-keyword">finally</span> &#123;                <span class="hljs-comment">//é‡Šæ”¾é”</span>                lock.unlock();            &#125;        &#125;);        lock.lock();        <span class="hljs-keyword">try</span> &#123;            t1.start();            Thread.sleep(<span class="hljs-number">1000</span>);            <span class="hljs-comment">//æ‰“æ–­</span>            t1.interrupt();        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;</code></pre></div><h4 id="é”è¶…æ—¶"><a href="#é”è¶…æ—¶" class="headerlink" title="é”è¶…æ—¶"></a>é”è¶…æ—¶</h4><p>ä½¿ç”¨<strong>lock.tryLock</strong>æ–¹æ³•ä¼šè¿”å›è·å–é”æ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œåä¹‹åˆ™è¿”å›falseã€‚</p><p>å¹¶ä¸”tryLockæ–¹æ³•å¯ä»¥<strong>æŒ‡å®šç­‰å¾…æ—¶é—´</strong>ï¼Œå‚æ•°ä¸ºï¼štryLock(long timeout, TimeUnit unit), å…¶ä¸­timeoutä¸ºæœ€é•¿ç­‰å¾…æ—¶é—´ï¼ŒTimeUnitä¸ºæ—¶é—´å•ä½</p><p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šè·å–å¤±è´¥äº†ã€è·å–è¶…æ—¶äº†æˆ–è€…è¢«æ‰“æ–­äº†ï¼Œä¸å†é˜»å¡ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p><p>ä¸è®¾ç½®ç­‰å¾…æ—¶é—´</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();        Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            <span class="hljs-comment">//æœªè®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œä¸€æ—¦è·å–å¤±è´¥ï¼Œç›´æ¥è¿”å›false</span>            <span class="hljs-keyword">if</span>(!lock.tryLock()) &#123;                System.out.println(<span class="hljs-string">&quot;è·å–å¤±è´¥&quot;</span>);                <span class="hljs-comment">//è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›</span>                <span class="hljs-keyword">return</span>;            &#125;            System.out.println(<span class="hljs-string">&quot;å¾—åˆ°äº†é”&quot;</span>);            lock.unlock();        &#125;);        lock.lock();        <span class="hljs-keyword">try</span>&#123;            t1.start();            Thread.sleep(<span class="hljs-number">3000</span>);        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;</code></pre></div><p>è®¾ç½®ç­‰å¾…æ—¶é—´</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();        Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">//åˆ¤æ–­è·å–é”æ˜¯å¦æˆåŠŸï¼Œæœ€å¤šç­‰å¾…1ç§’</span>                <span class="hljs-keyword">if</span>(!lock.tryLock(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) &#123;                    System.out.println(<span class="hljs-string">&quot;è·å–å¤±è´¥&quot;</span>);                    <span class="hljs-comment">//è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span>                    <span class="hljs-keyword">return</span>;                &#125;            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();                <span class="hljs-comment">//è¢«æ‰“æ–­ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span>                <span class="hljs-keyword">return</span>;            &#125;            System.out.println(<span class="hljs-string">&quot;å¾—åˆ°äº†é”&quot;</span>);            <span class="hljs-comment">//é‡Šæ”¾é”</span>            lock.unlock();        &#125;);        lock.lock();        <span class="hljs-keyword">try</span>&#123;            t1.start();            <span class="hljs-comment">//æ‰“æ–­ç­‰å¾…</span>            t1.interrupt();            Thread.sleep(<span class="hljs-number">3000</span>);        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;</code></pre></div><h4 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h4><p>åœ¨çº¿ç¨‹è·å–é”å¤±è´¥ï¼Œè¿›å…¥é˜»å¡é˜Ÿåˆ—æ—¶ï¼Œ<strong>å…ˆè¿›å…¥</strong>çš„ä¼šåœ¨é”è¢«é‡Šæ”¾å<strong>å…ˆè·å¾—</strong>é”ã€‚è¿™æ ·çš„è·å–æ–¹å¼å°±æ˜¯<strong>å…¬å¹³</strong>çš„ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//é»˜è®¤æ˜¯ä¸å…¬å¹³é”ï¼Œéœ€è¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸ºå…¬å¹³é”</span>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock(<span class="hljs-keyword">true</span>);</code></pre></div><h4 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h4><p>synchronized ä¸­ä¹Ÿæœ‰æ¡ä»¶å˜é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è®²åŸç†æ—¶é‚£ä¸ª waitSet ä¼‘æ¯å®¤ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥waitSet ç­‰å¾…</p><p>ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯æ”¯æŒ<strong>å¤šä¸ª</strong>æ¡ä»¶å˜é‡çš„ï¼Œè¿™å°±å¥½æ¯” </p><ul><li>synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯ </li><li>è€Œ ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤ é†’</li></ul><p>ä½¿ç”¨è¦ç‚¹ï¼š</p><ul><li>await å‰éœ€è¦<strong>è·å¾—é”</strong></li><li>await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾…</li><li>await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é” </li><li>ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> Boolean judge = <span class="hljs-keyword">false</span>;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;    ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();    <span class="hljs-comment">//è·å¾—æ¡ä»¶å˜é‡</span>    Condition condition = lock.newCondition();    <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;        lock.lock();        <span class="hljs-keyword">try</span>&#123;            <span class="hljs-keyword">while</span>(!judge) &#123;                System.out.println(<span class="hljs-string">&quot;ä¸æ»¡è¶³æ¡ä»¶ï¼Œç­‰å¾…...&quot;</span>);                <span class="hljs-comment">//ç­‰å¾…</span>                condition.await();            &#125;        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">finally</span> &#123;            System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œå®Œæ¯•ï¼&quot;</span>);            lock.unlock();        &#125;    &#125;).start();    <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;        lock.lock();        <span class="hljs-keyword">try</span> &#123;            Thread.sleep(<span class="hljs-number">1</span>);            judge = <span class="hljs-keyword">true</span>;            <span class="hljs-comment">//é‡Šæ”¾</span>            condition.signal();        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;).start();&#125;</code></pre></div><h4 id="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"><a href="#é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”" class="headerlink" title="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"></a>é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lock</span> </span>&#123;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> </span>&#123;      <span class="hljs-meta">@Override</span>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryAcquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;               setExclusiveOwnerThread(Thread.currentThread());               <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;         &#125;         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() == Thread.currentThread()) &#123;            <span class="hljs-keyword">int</span> state = getState();            compareAndSetState(state, state + <span class="hljs-number">1</span>);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;         &#125;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;      &#125;      <span class="hljs-meta">@Override</span>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryRelease</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;         <span class="hljs-keyword">if</span> (getState() &lt;= <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalMonitorStateException();         &#125;         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() != Thread.currentThread()) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalMonitorStateException();         &#125;         <span class="hljs-keyword">int</span> state = getState();         <span class="hljs-keyword">if</span> (state == <span class="hljs-number">1</span>) &#123;            setExclusiveOwnerThread(<span class="hljs-keyword">null</span>);            compareAndSetState(state, <span class="hljs-number">0</span>);         &#125; <span class="hljs-keyword">else</span> &#123;            compareAndSetState(state, state - <span class="hljs-number">1</span>);         &#125;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;      &#125;      <span class="hljs-meta">@Override</span>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHeldExclusively</span><span class="hljs-params">()</span> </span>&#123;         <span class="hljs-keyword">return</span> getState() &gt;= <span class="hljs-number">1</span>;      &#125;      <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConditionObject();      &#125;   &#125;   Sync sync = <span class="hljs-keyword">new</span> Sync();   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;      sync.acquire(<span class="hljs-number">1</span>);   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;      sync.acquireInterruptibly(<span class="hljs-number">1</span>);   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;      <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, time);   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;      sync.release(<span class="hljs-number">1</span>);   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> sync.newCondition();   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;   <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, IOException </span>&#123;      MyLock lock = <span class="hljs-keyword">new</span> MyLock();      Object syncLock = <span class="hljs-keyword">new</span> Object();      Thread t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;            lock.lock();            <span class="hljs-keyword">try</span> &#123;               lock.lock();               <span class="hljs-keyword">try</span> &#123;                  lock.lock();                  <span class="hljs-keyword">try</span> &#123;                     num++;                  &#125; <span class="hljs-keyword">finally</span> &#123;                     lock.unlock();                  &#125;               &#125; <span class="hljs-keyword">finally</span> &#123;                  lock.unlock();               &#125;            &#125; <span class="hljs-keyword">finally</span> &#123;               lock.unlock();            &#125;         &#125;      &#125;);      Thread t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;            lock.lock();            <span class="hljs-keyword">try</span> &#123;               lock.lock();               <span class="hljs-keyword">try</span> &#123;                  lock.lock();                  <span class="hljs-keyword">try</span> &#123;                     num--;                  &#125; <span class="hljs-keyword">finally</span> &#123;                     lock.unlock();                  &#125;               &#125; <span class="hljs-keyword">finally</span> &#123;                  lock.unlock();               &#125;            &#125; <span class="hljs-keyword">finally</span> &#123;               lock.unlock();            &#125;         &#125;      &#125;);      t1.start();      t2.start();      t1.join();      t2.join();      <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;   &#125;&#125;</code></pre></div><h2 id="14ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"><a href="#14ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶" class="headerlink" title="14ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"></a>14ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</h2><h3 id="Wait-Notifyç‰ˆæœ¬"><a href="#Wait-Notifyç‰ˆæœ¬" class="headerlink" title="Wait/Notifyç‰ˆæœ¬"></a>Wait/Notifyç‰ˆæœ¬</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object LOCK = <span class="hljs-keyword">new</span> Object();<span class="hljs-comment">//åˆ¤æ–­å…ˆæ‰§è¡Œçš„å†…å®¹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span><span class="hljs-keyword">static</span> Boolean judge = <span class="hljs-keyword">false</span>;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;    <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;        <span class="hljs-keyword">synchronized</span> (LOCK) &#123;            <span class="hljs-keyword">while</span> (!judge) &#123;                <span class="hljs-keyword">try</span> &#123;                    LOCK.wait();                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;            &#125;            System.out.println(<span class="hljs-string">&quot;2&quot;</span>);        &#125;    &#125;).start();    <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;        <span class="hljs-keyword">synchronized</span> (LOCK) &#123;            System.out.println(<span class="hljs-string">&quot;1&quot;</span>);            judge = <span class="hljs-keyword">true</span>;               <span class="hljs-comment">//æ‰§è¡Œå®Œæ¯•ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>            LOCK.notifyAll();        &#125;    &#125;).start();&#125;</code></pre></div><h3 id="äº¤æ›¿è¾“å‡º"><a href="#äº¤æ›¿è¾“å‡º" class="headerlink" title="äº¤æ›¿è¾“å‡º"></a>äº¤æ›¿è¾“å‡º</h3><h5 id="wait-notifyç‰ˆæœ¬"><a href="#wait-notifyç‰ˆæœ¬" class="headerlink" title="wait/notifyç‰ˆæœ¬"></a><strong>wait/notifyç‰ˆæœ¬</strong></h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test27&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test27</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        WaitNotify wn = <span class="hljs-keyword">new</span> WaitNotify(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            wn.print(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);        &#125;).start();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            wn.print(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);        &#125;).start();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            wn.print(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>);        &#125;).start();    &#125;&#125;<span class="hljs-comment">/*</span><span class="hljs-comment">è¾“å‡ºå†…å®¹       ç­‰å¾…æ ‡è®°     ä¸‹ä¸€ä¸ªæ ‡è®°</span><span class="hljs-comment">   a           1             2</span><span class="hljs-comment">   b           2             3</span><span class="hljs-comment">   c           3             1</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WaitNotify</span> </span>&#123;    <span class="hljs-comment">// æ‰“å°               a           1             2</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">(String str, <span class="hljs-keyword">int</span> waitFlag, <span class="hljs-keyword">int</span> nextFlag)</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;            <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;                <span class="hljs-keyword">while</span>(flag != waitFlag) &#123;                    <span class="hljs-keyword">try</span> &#123;                        <span class="hljs-keyword">this</span>.wait();                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                        e.printStackTrace();                    &#125;                &#125;                System.out.print(str);                flag = nextFlag;                <span class="hljs-keyword">this</span>.notifyAll();            &#125;        &#125;    &#125;    <span class="hljs-comment">// ç­‰å¾…æ ‡è®°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> flag; <span class="hljs-comment">// 2</span>    <span class="hljs-comment">// å¾ªç¯æ¬¡æ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> loopNumber;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WaitNotify</span><span class="hljs-params">(<span class="hljs-keyword">int</span> flag, <span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;        <span class="hljs-keyword">this</span>.flag = flag;        <span class="hljs-keyword">this</span>.loopNumber = loopNumber;    &#125;&#125;</code></pre></div><h5 id="await-signalç‰ˆæœ¬"><a href="#await-signalç‰ˆæœ¬" class="headerlink" title="await/signalç‰ˆæœ¬"></a>await/signalç‰ˆæœ¬</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test30</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        AwaitSignal awaitSignal = <span class="hljs-keyword">new</span> AwaitSignal(<span class="hljs-number">5</span>);        Condition a = awaitSignal.newCondition();        Condition b = awaitSignal.newCondition();        Condition c = awaitSignal.newCondition();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            awaitSignal.print(<span class="hljs-string">&quot;a&quot;</span>, a, b);        &#125;).start();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            awaitSignal.print(<span class="hljs-string">&quot;b&quot;</span>, b, c);        &#125;).start();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            awaitSignal.print(<span class="hljs-string">&quot;c&quot;</span>, c, a);        &#125;).start();        Thread.sleep(<span class="hljs-number">1000</span>);        <span class="hljs-comment">//åˆšå¼€å§‹æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨awaitï¼Œéœ€è¦ä¸»çº¿ç¨‹å”¤é†’a</span>        awaitSignal.lock();        <span class="hljs-keyword">try</span> &#123;            System.out.println(<span class="hljs-string">&quot;å¼€å§‹...&quot;</span>);            a.signal();        &#125; <span class="hljs-keyword">finally</span> &#123;            awaitSignal.unlock();        &#125;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwaitSignal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ReentrantLock</span></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> loopNumber;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AwaitSignal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;        <span class="hljs-keyword">this</span>.loopNumber = loopNumber;    &#125;    <span class="hljs-comment">//            å‚æ•°1 æ‰“å°å†…å®¹ï¼Œ å‚æ•°2 è¿›å…¥å“ªä¸€é—´ä¼‘æ¯å®¤, å‚æ•°3 ä¸‹ä¸€é—´ä¼‘æ¯å®¤</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">(String str, Condition current, Condition next)</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;            <span class="hljs-comment">//ç»§æ‰¿äº†ReentrantLockï¼Œå¯ä»¥ç›´æ¥Lockï¼Œç›¸å½“äºthis.lock()</span>            lock();            <span class="hljs-keyword">try</span> &#123;                current.await();                System.out.print(str);                next.signal();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125; <span class="hljs-keyword">finally</span> &#123;                unlock();            &#125;        &#125;    &#125;&#125;</code></pre></div><h5 id="park-unpark"><a href="#park-unpark" class="headerlink" title="park/unpark"></a>park/unpark</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test31&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test31</span> </span>&#123;    <span class="hljs-keyword">static</span> Thread t1;    <span class="hljs-keyword">static</span> Thread t2;    <span class="hljs-keyword">static</span> Thread t3;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ParkUnpark pu = <span class="hljs-keyword">new</span> ParkUnpark(<span class="hljs-number">5</span>);        t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            pu.print(<span class="hljs-string">&quot;a&quot;</span>, t2);        &#125;);        t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            pu.print(<span class="hljs-string">&quot;b&quot;</span>, t3);        &#125;);        t3 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            pu.print(<span class="hljs-string">&quot;c&quot;</span>, t1);        &#125;);        t1.start();        t2.start();        t3.start();        <span class="hljs-comment">//ä¸»çº¿ç¨‹å‘èµ·è€…</span>        LockSupport.unpark(t1);    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParkUnpark</span> </span>&#123;    <span class="hljs-comment">//parkä¸éœ€è¦è®°å½•å½“å‰ï¼Œå› ä¸ºparkä¼šè‡ªå·±è®°å½•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">(String str, Thread next)</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;            LockSupport.park();            System.out.print(str);            LockSupport.unpark(next);        &#125;    &#125;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> loopNumber;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ParkUnpark</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;        <span class="hljs-keyword">this</span>.loopNumber = loopNumber;    &#125;&#125;</code></pre></div><h2 id="14ã€ThreadLocal"><a href="#14ã€ThreadLocal" class="headerlink" title="14ã€ThreadLocal"></a>14ã€ThreadLocal</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ThreadLocalæ˜¯JDKåŒ…æä¾›çš„ï¼Œå®ƒæä¾›äº†çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆ<strong>è®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬</strong>ã€‚å½“å¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡æ—¶ï¼Œå®é™…æ“ä½œçš„æ˜¯è‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ï¼Œä»è€Œ<strong>é¿å…äº†çº¿ç¨‹å®‰å…¨</strong>é—®é¢˜</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadLocalStudy</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-comment">// åˆ›å»ºThreadLocalå˜é‡</span>      ThreadLocal&lt;String&gt; stringThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();      ThreadLocal&lt;User&gt; userThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();      <span class="hljs-comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªThreadLocalå˜é‡</span>      Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;         <span class="hljs-comment">// stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span>         stringThreadLocal.set(<span class="hljs-string">&quot;thread1 stringThreadLocal first&quot;</span>);         <span class="hljs-comment">// stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span>         stringThreadLocal.set(<span class="hljs-string">&quot;thread1 stringThreadLocal second&quot;</span>);         <span class="hljs-comment">// userThreadLocalèµ‹å€¼</span>         userThreadLocal.set(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;Lucifer&quot;</span>, <span class="hljs-number">24</span>));         <span class="hljs-comment">// å–å€¼</span>         System.out.println(stringThreadLocal.get());         System.out.println(userThreadLocal.get());          <span class="hljs-comment">// ç§»é™¤</span>         userThreadLocal.remove();         System.out.println(userThreadLocal.get());      &#125;);      Thread thread2 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;         <span class="hljs-comment">// stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span>         stringThreadLocal.set(<span class="hljs-string">&quot;thread2 stringThreadLocal first&quot;</span>);         <span class="hljs-comment">// stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span>         stringThreadLocal.set(<span class="hljs-string">&quot;thread2 stringThreadLocal second&quot;</span>);         <span class="hljs-comment">// userThreadLocalèµ‹å€¼</span>         userThreadLocal.set(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;Melrose&quot;</span>, <span class="hljs-number">9</span>));         <span class="hljs-comment">// å–å€¼</span>         System.out.println(stringThreadLocal.get());         System.out.println(userThreadLocal.get());      &#125;);      <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>      thread1.start();      thread2.start();   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;   String name;   <span class="hljs-keyword">int</span> age;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> age)</span> </span>&#123;      <span class="hljs-keyword">this</span>.name = name;      <span class="hljs-keyword">this</span>.age = age;   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +            <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +            <span class="hljs-string">&quot;, age=&quot;</span> + age +            <span class="hljs-string">&#x27;&#125;&#x27;</span>;   &#125;&#125;</code></pre></div><p><strong>è¿è¡Œç»“æœ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">thread1 stringThreadLocal secondthread2 stringThreadLocal secondUser&#123;name=&#x27;Lucifer&#x27;, age=24&#125;User&#123;name=&#x27;Melrose&#x27;, age=9&#125;null</code></pre></div><p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡º</p><ul><li><strong>æ¯ä¸ªçº¿ç¨‹ä¸­çš„ThreadLocalå˜é‡æ˜¯çº¿ç¨‹ç§æœ‰çš„</strong>ï¼Œè€Œä¸æ˜¯å…±äº«çš„<ul><li>ä»çº¿ç¨‹1å’Œçº¿ç¨‹2çš„æ‰“å°ç»“æœå¯ä»¥çœ‹å‡º</li></ul></li><li>ThreadLocalå…¶å®å°±ç›¸å½“äºå…¶æ³›å‹ç±»å‹çš„ä¸€ä¸ªå˜é‡ï¼Œåªä¸è¿‡æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„<ul><li>stringThreadLocalè¢«èµ‹å€¼äº†ä¸¤æ¬¡ï¼Œä¿å­˜çš„æ˜¯æœ€åä¸€æ¬¡èµ‹å€¼çš„ç»“æœ</li></ul></li><li>ThreadLocalå¯ä»¥è¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œ<ul><li>set è®¾ç½®å€¼</li><li>get å–å‡ºå€¼</li><li>remove ç§»é™¤å€¼</li></ul></li></ul><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="Threadä¸­çš„threadLocals"><a href="#Threadä¸­çš„threadLocals" class="headerlink" title="Threadä¸­çš„threadLocals"></a>Threadä¸­çš„threadLocals</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123; ... ThreadLocal.ThreadLocalMap threadLocals = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// æ”¾åœ¨åé¢è¯´</span> ThreadLocal.ThreadLocalMap inheritableThreadLocals = <span class="hljs-keyword">null</span>; ...&#125; <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadLocalMap</span> </span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference</span>&lt;<span class="hljs-title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;        <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span>        Object value;        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;            <span class="hljs-keyword">super</span>(k);            value = v;        &#125;    &#125;</code></pre></div><p>å¯ä»¥çœ‹å‡ºThreadç±»ä¸­æœ‰ä¸€ä¸ªthreadLocalså’Œä¸€ä¸ªinheritableThreadLocalsï¼Œå®ƒä»¬éƒ½æ˜¯ThreadLocalMapç±»å‹çš„å˜é‡ï¼Œè€ŒThreadLocalMapæ˜¯ä¸€ä¸ªå®šåˆ¶åŒ–çš„Hashmapã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„è¿™ä¸¤ä¸ªå˜é‡éƒ½ä¸ºnullã€‚æ­¤å¤„å…ˆè®¨è®ºthreadLocalsï¼ŒinheritableThreadLocalsæ”¾åœ¨åé¢è®¨è®º</p><h4 id="ThreadLocalä¸­çš„æ–¹æ³•"><a href="#ThreadLocalä¸­çš„æ–¹æ³•" class="headerlink" title="ThreadLocalä¸­çš„æ–¹æ³•"></a><strong>ThreadLocalä¸­çš„æ–¹æ³•</strong></h4><p><strong>setæ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(T value)</span> </span>&#123;    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span>    Thread t = Thread.currentThread();    <span class="hljs-comment">// è·å¾—ThreadLocalMapå¯¹è±¡ </span>    <span class="hljs-comment">// è¿™é‡Œçš„getä¼šè¿”å›Threadç±»ä¸­çš„threadLocals</span>    ThreadLocalMap map = getMap(t);    <span class="hljs-comment">// åˆ¤æ–­mapæ˜¯å¦å·²ç»åˆ›å»ºï¼Œæ²¡åˆ›å»ºå°±åˆ›å»ºå¹¶æ”¾å…¥å€¼ï¼Œåˆ›å»ºäº†å°±ç›´æ¥æ”¾å…¥</span>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)        <span class="hljs-comment">// ThreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span>        map.set(<span class="hljs-keyword">this</span>, value);    <span class="hljs-keyword">else</span>        createMap(t, value);&#125;</code></pre></div><p><strong>å¦‚æœæœªåˆ›å»º</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> </span>&#123;    <span class="hljs-comment">// åˆ›å»ºçš„åŒæ—¶è®¾ç½®æƒ³æ”¾å…¥çš„å€¼</span>    <span class="hljs-comment">// hreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span>    t.threadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(<span class="hljs-keyword">this</span>, firstValue);&#125;</code></pre></div><p><strong>getæ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span>    Thread t = Thread.currentThread();    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡</span>    ThreadLocalMap map = getMap(t);    <span class="hljs-comment">// åˆ¤æ–­threadLocalsæ˜¯å¦è¢«åˆå§‹åŒ–äº†</span>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">// å·²ç»åˆå§‹åŒ–åˆ™ç›´æ¥è¿”å›</span>        ThreadLocalMap.Entry e = map.getEntry(<span class="hljs-keyword">this</span>);        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span>            T result = (T)e.value;            <span class="hljs-keyword">return</span> result;        &#125;    &#125;    <span class="hljs-comment">// å¦åˆ™å°±åˆ›å»ºthreadLocals</span>    <span class="hljs-keyword">return</span> setInitialValue();&#125; <span class="hljs-function"><span class="hljs-keyword">private</span> T <span class="hljs-title">setInitialValue</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•è¿”å›æ˜¯null</span>    T value = initialValue();    Thread t = Thread.currentThread();    ThreadLocalMap map = getMap(t);    <span class="hljs-comment">// æ— è®ºmapåˆ›å»ºä¸å¦ï¼Œæœ€ç»ˆvalueçš„å€¼éƒ½ä¸ºnull</span>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)        map.set(<span class="hljs-keyword">this</span>, value);    <span class="hljs-keyword">else</span>        createMap(t, value);    <span class="hljs-keyword">return</span> value;&#125;<span class="hljs-function">Cop otected T <span class="hljs-title">initialValue</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre></div><p><strong>removeæ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;    ThreadLocalMap m = getMap(Thread.currentThread());    <span class="hljs-keyword">if</span> (m != <span class="hljs-keyword">null</span>)        <span class="hljs-comment">// å¦‚æœthreadLocalså·²ç»è¢«åˆå§‹åŒ–ï¼Œåˆ™ç§»é™¤</span>        m.remove(<span class="hljs-keyword">this</span>);&#125;</code></pre></div><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h4><p>åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªåä¸ºthreadLocalsçš„æˆå‘˜å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹ä¸ºHashMapï¼Œå…¶ä¸­<strong>keyä¸ºæˆ‘ä»¬å®šä¹‰çš„ThreadLocalå˜é‡çš„thiså¼•ç”¨ï¼Œvalueåˆ™ä¸ºæˆ‘ä»¬ä½¿ç”¨setæ–¹æ³•è®¾ç½®çš„å€¼</strong>ã€‚æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡å­˜æ”¾åœ¨çº¿ç¨‹è‡ªå·±çš„å†…å­˜å˜é‡threadLocalsä¸­</p><p>åªæœ‰å½“å‰çº¿ç¨‹<strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocalçš„setæˆ–è€…getæ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºthreadLocals</strong>ï¼ˆinheritableThreadLocalsä¹Ÿæ˜¯ä¸€æ ·ï¼‰ã€‚å…¶å®æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸æ˜¯å­˜æ”¾åœ¨ThreadLocalå®ä¾‹é‡Œé¢ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨è°ƒç”¨çº¿ç¨‹çš„threadLocalså˜é‡é‡Œé¢</p><h2 id="15ã€InheritableThreadLocal"><a href="#15ã€InheritableThreadLocal" class="headerlink" title="15ã€InheritableThreadLocal"></a>15ã€InheritableThreadLocal</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä»ThreadLocalçš„æºç å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯setã€getã€è¿˜æ˜¯removeï¼Œéƒ½æ˜¯ç›¸å¯¹äºå½“å‰çº¿ç¨‹æ“ä½œçš„</p><div class="hljs code-wrapper"><pre><code class="hljs java">Thread.currentThread()</code></pre></div><p><strong>ThreadLocalæ— æ³•ä»çˆ¶çº¿ç¨‹ä¼ å‘å­çº¿ç¨‹</strong>ï¼Œ<strong>InheritableThreadLocalå®ƒèƒ½å¤Ÿè®©çˆ¶çº¿ç¨‹ä¸­ThreadLocalçš„å€¼ä¼ ç»™å­çº¿ç¨‹ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯ä»mainæ‰€åœ¨çš„çº¿ç¨‹ï¼Œä¼ ç»™thread1æˆ–thread2</p><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      ThreadLocal&lt;String&gt; stringThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();      InheritableThreadLocal&lt;String&gt; stringInheritable = <span class="hljs-keyword">new</span> InheritableThreadLocal&lt;&gt;();      <span class="hljs-comment">// ä¸»çº¿ç¨‹èµ‹å¯¹ä¸Šé¢ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼</span>      stringThreadLocal.set(<span class="hljs-string">&quot;this is threadLocal&quot;</span>);      stringInheritable.set(<span class="hljs-string">&quot;this is inheritableThreadLocal&quot;</span>);      <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span>      Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;         <span class="hljs-comment">// è·å¾—ThreadLocalä¸­å­˜æ”¾çš„å€¼</span>         System.out.println(stringThreadLocal.get());         <span class="hljs-comment">// è·å¾—InheritableThreadLocalå­˜æ”¾çš„å€¼</span>         System.out.println(stringInheritable.get());      &#125;);      thread1.start();   &#125;&#125;</code></pre></div><p><strong>è¿è¡Œç»“æœ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sh">nullthis is inheritableThreadLocal</code></pre></div><p>å¯ä»¥çœ‹å‡ºInheritableThreadLocalçš„å€¼æˆåŠŸä»ä¸»çº¿ç¨‹ä¼ å…¥äº†å­çº¿ç¨‹ï¼Œè€ŒThreadLocalåˆ™æ²¡æœ‰</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="InheritableThreadLocal"><a href="#InheritableThreadLocal" class="headerlink" title="InheritableThreadLocal"></a>InheritableThreadLocal</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritableThreadLocal</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">ThreadLocal</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;    <span class="hljs-comment">// ä¼ å…¥çˆ¶çº¿ç¨‹ä¸­çš„ä¸€ä¸ªå€¼ï¼Œç„¶åç›´æ¥è¿”å›</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> T <span class="hljs-title">childValue</span><span class="hljs-params">(T parentValue)</span> </span>&#123;        <span class="hljs-keyword">return</span> parentValue;    &#125;      <span class="hljs-comment">// è¿”å›ä¼ å…¥çº¿ç¨‹çš„inheritableThreadLocals</span>    <span class="hljs-comment">// Threadä¸­æœ‰ä¸€ä¸ªinheritableThreadLocalså˜é‡</span>    <span class="hljs-comment">// ThreadLocal.ThreadLocalMap inheritableThreadLocals = null;</span>    <span class="hljs-function">ThreadLocalMap <span class="hljs-title">getMap</span><span class="hljs-params">(Thread t)</span> </span>&#123;       <span class="hljs-keyword">return</span> t.inheritableThreadLocals;    &#125;     <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªinheritableThreadLocals</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> </span>&#123;        t.inheritableThreadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(<span class="hljs-keyword">this</span>, firstValue);    &#125;&#125;</code></pre></div><p>ç”±å¦‚ä¸Šä»£ç å¯çŸ¥ï¼ŒInheritableThreadLocalç»§æ‰¿äº†ThreadLocalï¼Œå¹¶é‡å†™äº†ä¸‰ä¸ªæ–¹æ³•ã€‚InheritableThreadLocalé‡å†™äº†<strong>createMapæ–¹æ³•</strong>ï¼Œé‚£ä¹ˆç°åœ¨å½“ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•æ—¶ï¼Œåˆ›å»ºçš„æ˜¯å½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡çš„å®ä¾‹è€Œä¸å†æ˜¯threadLocalsã€‚å½“è°ƒç”¨<strong>getMapæ–¹æ³•</strong>è·å–å½“å‰çº¿ç¨‹å†…éƒ¨çš„mapå˜é‡æ—¶ï¼Œè·å–çš„æ˜¯inheritableThreadLocalsè€Œä¸å†æ˜¯threadLocals</p><h4 id="childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨"><a href="#childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨"></a>childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨</h4><p>åœ¨ä¸»å‡½æ•°è¿è¡Œæ—¶ï¼Œä¼šè°ƒç”¨Threadçš„é»˜è®¤æ„é€ å‡½æ•°ï¼ˆ<strong>åˆ›å»ºä¸»çº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯çˆ¶çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹çœ‹Threadçš„é»˜è®¤æ„é€ å‡½æ•°</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Thread</span><span class="hljs-params">()</span> </span>&#123;    init(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="hljs-number">0</span>);&#125; <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span></span><span class="hljs-function"><span class="hljs-params">                  <span class="hljs-keyword">long</span> stackSize, AccessControlContext acc,</span></span><span class="hljs-function"><span class="hljs-params">                  <span class="hljs-keyword">boolean</span> inheritThreadLocals)</span> </span>&#123;       ...    <span class="hljs-comment">// è·å¾—å½“å‰çº¿ç¨‹çš„ï¼Œåœ¨è¿™é‡Œæ˜¯ä¸»çº¿ç¨‹</span>    Thread parent = currentThread();    ...    <span class="hljs-comment">// å¦‚æœçˆ¶çº¿ç¨‹çš„inheritableThreadLocalså­˜åœ¨</span>    <span class="hljs-comment">// æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨setå’Œgetæ—¶ï¼Œä¼šåˆ›å»ºinheritableThreadLocals</span>    <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-keyword">null</span>)        <span class="hljs-comment">// è®¾ç½®å­çº¿ç¨‹çš„inheritableThreadLocals</span>        <span class="hljs-keyword">this</span>.inheritableThreadLocals =            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);    <span class="hljs-comment">/* Stash the specified stack size in case the VM cares */</span>    <span class="hljs-keyword">this</span>.stackSize = stackSize;    <span class="hljs-comment">/* Set thread ID */</span>    tid = nextThreadID();&#125;<span class="hljs-function">Cop atic ThreadLocalMap <span class="hljs-title">createInheritedMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadLocalMap(parentMap);&#125;</code></pre></div><p>åœ¨createInheritedMapå†…éƒ¨ä½¿ç”¨çˆ¶çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ä½œä¸ºæ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ThreadLocalMapå˜é‡ï¼Œç„¶åèµ‹å€¼ç»™äº†å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ThreadLocalMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> </span>&#123;    Entry[] parentTable = parentMap.table;    <span class="hljs-keyword">int</span> len = parentTable.length;    setThreshold(len);    table = <span class="hljs-keyword">new</span> Entry[len];    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; len; j++) &#123;        Entry e = parentTable[j];        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span>            ThreadLocal&lt;Object&gt; key = (ThreadLocal&lt;Object&gt;) e.get();            <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span>) &#123;                <span class="hljs-comment">// è¿™é‡Œè°ƒç”¨äº† childValue æ–¹æ³•</span>                <span class="hljs-comment">// è¯¥æ–¹æ³•ä¼šè¿”å›parentçš„å€¼</span>                Object value = key.childValue(e.value);                Entry c = <span class="hljs-keyword">new</span> Entry(key, value);                <span class="hljs-keyword">int</span> h = key.threadLocalHashCode &amp; (len - <span class="hljs-number">1</span>);                <span class="hljs-keyword">while</span> (table[h] != <span class="hljs-keyword">null</span>)                    h = nextIndex(h, len);                table[h] = c;                size++;            &#125;        &#125;    &#125;&#125;</code></pre></div><p>åœ¨è¯¥æ„é€ å‡½æ•°å†…éƒ¨æŠŠçˆ¶çº¿ç¨‹çš„inheritableThreadLocalsæˆå‘˜å˜é‡çš„å€¼å¤åˆ¶åˆ°æ–°çš„ThreadLocalMapå¯¹è±¡ä¸­</p><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>InheritableThreadLocalç±»é€šè¿‡é‡å†™getMapå’ŒcreateMapï¼Œè®©æœ¬åœ°å˜é‡ä¿å­˜åˆ°äº†å…·ä½“çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ï¼Œé‚£ä¹ˆçº¿ç¨‹åœ¨é€šè¿‡InheritableThreadLocalç±»å®ä¾‹çš„setæˆ–è€…getæ–¹æ³•è®¾ç½®å˜é‡æ—¶ï¼Œå°±ä¼šåˆ›å»ºå½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ã€‚</p><p><strong>å½“çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šæŠŠçˆ¶çº¿ç¨‹ä¸­inheritableThreadLocalså˜é‡é‡Œé¢çš„æœ¬åœ°å˜é‡å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ã€‚</strong></p><h1 id="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"><a href="#å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜" class="headerlink" title="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"></a>å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜</h1><h2 id="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h2><p>JMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†<strong>ä¸»å­˜ï¼ˆå…±äº«å†…å­˜ï¼‰ã€å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰</strong>æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€ CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚ </p><p><strong>JMMä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢</strong></p><ul><li>åŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“</li><li>å¯è§æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“</li><li>æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“</li></ul><h2 id="2ã€å¯è§æ€§"><a href="#2ã€å¯è§æ€§" class="headerlink" title="2ã€å¯è§æ€§"></a>2ã€å¯è§æ€§</h2><h4 id="å¼•ä¾‹"><a href="#å¼•ä¾‹" class="headerlink" title="å¼•ä¾‹"></a>å¼•ä¾‹</h4><p><strong>é€€å‡ºä¸å‡ºçš„å¾ªç¯</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> Boolean run = <span class="hljs-keyword">true</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;            <span class="hljs-keyword">while</span> (run) &#123;                <span class="hljs-comment">//å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span>            &#125;        &#125;).start();        Thread.sleep(<span class="hljs-number">1000</span>);        System.out.println(<span class="hljs-string">&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;</span>);        run = <span class="hljs-keyword">false</span>;    &#125;</code></pre></div><p><strong>ä¸ºä»€ä¹ˆæ— æ³•é€€å‡ºè¯¥å¾ªç¯</strong></p><ul><li>åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»<strong>ä¸»å†…å­˜</strong>è¯»å–äº† run çš„å€¼åˆ°<strong>å·¥ä½œå†…å­˜</strong>ã€‚</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png" alt="img"></a></p><ul><li>å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼<strong>ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜</strong>ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ å‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png" alt="img"></a></p><ul><li>1 ç§’ä¹‹åï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡ çš„å€¼ï¼Œç»“æœæ°¸è¿œæ˜¯<strong>æ—§å€¼</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png" alt="img"></a></p><p><strong>è§£å†³æ–¹æ³•</strong></p><ul><li>ä½¿ç”¨<strong>volatile</strong>æ˜“å˜å…³é”®å­—</li><li>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°<strong>æˆå‘˜å˜é‡</strong>å’Œ<strong>é™æ€æˆå‘˜å˜é‡</strong>ï¼ˆæ”¾åœ¨ä¸»å­˜ä¸­çš„å˜é‡ï¼‰ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯<strong>ç›´æ¥æ“ä½œä¸»å­˜</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨æ˜“å˜å…³é”®å­—</span><span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Boolean run = <span class="hljs-keyword">true</span>;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;    <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;        <span class="hljs-keyword">while</span> (run) &#123;            <span class="hljs-comment">//å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span>        &#125;    &#125;).start();    Thread.sleep(<span class="hljs-number">1000</span>);    System.out.println(<span class="hljs-string">&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;</span>);    run = <span class="hljs-keyword">false</span>;&#125;</code></pre></div><h4 id="å¯è§æ€§ä¸åŸå­æ€§"><a href="#å¯è§æ€§ä¸åŸå­æ€§" class="headerlink" title="å¯è§æ€§ä¸åŸå­æ€§"></a>å¯è§æ€§ä¸åŸå­æ€§</h4><p>å‰é¢ä¾‹å­ä½“ç°çš„å®é™…å°±æ˜¯<strong>å¯è§æ€§</strong>ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹<strong>volatileå˜é‡</strong>çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ <strong>ä¸èƒ½</strong>ä¿è¯åŸå­æ€§ï¼Œä»…ç”¨åœ¨<strong>ä¸€ä¸ªå†™</strong>çº¿ç¨‹ï¼Œ<strong>å¤šä¸ªè¯»</strong>çº¿ç¨‹çš„æƒ…å†µ</p><ul><li><p>æ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„<strong>åŸå­æ€§</strong>ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„<strong>å¯è§æ€§</strong>ã€‚</p></li><li><p>ä½†ç¼ºç‚¹æ˜¯ synchronized æ˜¯å±äº<strong>é‡é‡çº§</strong>æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½ã€‚</p></li><li><p>å¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘ç°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ° å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ</p><ul><li>å› ä¸ºä½¿ç”¨äº†<strong>synchronized</strong>å…³é”®å­—<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">println</span><span class="hljs-params">(String x)</span> </span>&#123;        <span class="hljs-comment">//ä½¿ç”¨äº†synchronizedå…³é”®å­—</span>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;            print(x);            newLine();        &#125;    &#125;</code></pre></div></li></ul></li></ul><h4 id="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"><a href="#ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–" class="headerlink" title="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"></a>ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        Monitor monitor = <span class="hljs-keyword">new</span> Monitor();        monitor.start();        Thread.sleep(<span class="hljs-number">3500</span>);        monitor.stop();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;    Thread monitor;    <span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> stop = <span class="hljs-keyword">false</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span>        monitor = <span class="hljs-keyword">new</span> Thread() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                <span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span>                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;                    <span class="hljs-keyword">if</span>(stop) &#123;                        System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);                        <span class="hljs-keyword">break</span>;                    &#125;                    System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);                    <span class="hljs-keyword">try</span> &#123;                        <span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span>                        Thread.sleep(<span class="hljs-number">1000</span>);                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                        System.out.println(<span class="hljs-string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);                    &#125;                &#125;            &#125;        &#125;;        monitor.start();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     *     ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span>        monitor.interrupt();        <span class="hljs-comment">//ä¿®æ”¹æ ‡è®°</span>        stop = <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><h4 id="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"><a href="#åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼" class="headerlink" title="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"></a>åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼</h4><p><strong>å®šä¹‰</strong></p><p>Balking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹<strong>å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒ</strong>çš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åš äº†ï¼Œ<strong>ç›´æ¥ç»“æŸè¿”å›</strong></p><ul><li>ç”¨ä¸€ä¸ªæ ‡è®°æ¥åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»è¢«æ‰§è¡Œè¿‡äº†</li><li>éœ€è¦é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜<ul><li>åŠ é”çš„ä»£ç å—è¦å°½é‡çš„å°ï¼Œä»¥ä¿è¯æ€§èƒ½</li></ul></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        Monitor monitor = <span class="hljs-keyword">new</span> Monitor();        monitor.start();        monitor.start();        Thread.sleep(<span class="hljs-number">3500</span>);        monitor.stop();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;    Thread monitor;    <span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> stop = <span class="hljs-keyword">false</span>;    <span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»å¯åŠ¨è¿‡äº†</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> starting = <span class="hljs-keyword">false</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//ä¸Šé”ï¼Œé¿å…å¤šçº¿ç¨‹è¿è¡Œæ—¶å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</span>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;            <span class="hljs-keyword">if</span> (starting) &#123;                <span class="hljs-comment">//å·²è¢«å¯åŠ¨ï¼Œç›´æ¥è¿”å›</span>                <span class="hljs-keyword">return</span>;            &#125;            <span class="hljs-comment">//å¯åŠ¨ç›‘è§†å™¨ï¼Œæ”¹å˜æ ‡è®°</span>            starting = <span class="hljs-keyword">true</span>;        &#125;        <span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span>        monitor = <span class="hljs-keyword">new</span> Thread() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                <span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span>                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;                    <span class="hljs-keyword">if</span>(stop) &#123;                        System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);                        <span class="hljs-keyword">break</span>;                    &#125;                    System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);                    <span class="hljs-keyword">try</span> &#123;                        <span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span>                        Thread.sleep(<span class="hljs-number">1000</span>);                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                        System.out.println(<span class="hljs-string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);                    &#125;                &#125;            &#125;        &#125;;        monitor.start();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     *     ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span>        monitor.interrupt();        stop = <span class="hljs-keyword">true</span>;    &#125;&#125;</code></pre></div><h2 id="3ã€æœ‰åºæ€§"><a href="#3ã€æœ‰åºæ€§" class="headerlink" title="3ã€æœ‰åºæ€§"></a>3ã€æœ‰åºæ€§</h2><h3 id="æŒ‡ä»¤é‡æ’"><a href="#æŒ‡ä»¤é‡æ’" class="headerlink" title="æŒ‡ä»¤é‡æ’"></a>æŒ‡ä»¤é‡æ’</h3><ul><li>JVM ä¼šåœ¨<strong>ä¸å½±å“æ­£ç¡®æ€§</strong>çš„å‰æä¸‹ï¼Œå¯ä»¥<strong>è°ƒæ•´</strong>è¯­å¥çš„æ‰§è¡Œ<strong>é¡ºåº</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png" alt="img"></a></p><p>è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€<strong>æŒ‡ä»¤é‡æ’</strong>ã€ï¼Œ<strong>å¤šçº¿ç¨‹ä¸‹ã€æŒ‡ä»¤é‡æ’ã€ä¼šå½±å“æ­£ç¡®æ€§</strong>ã€‚</p><h3 id="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"><a href="#æŒ‡ä»¤é‡æ’åºä¼˜åŒ–" class="headerlink" title="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"></a>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</h3><ul><li>äº‹å®ä¸Šï¼Œç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> è¿™5 ä¸ªé˜¶æ®µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png" alt="img"></a></p><ul><li><p>åœ¨ä¸æ”¹å˜ç¨‹åºç»“æœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡<strong>é‡æ’åº</strong>å’Œ<strong>ç»„åˆ</strong>æ¥å®ç°<strong>æŒ‡ä»¤çº§å¹¶è¡Œ</strong></p></li><li><p>æŒ‡ä»¤é‡æ’çš„å‰ææ˜¯ï¼Œé‡æ’æŒ‡ä»¤<strong>ä¸èƒ½å½±å“ç»“æœ</strong>ï¼Œä¾‹å¦‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å¯ä»¥é‡æ’çš„ä¾‹å­ </span><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>; <span class="hljs-keyword">int</span> b = <span class="hljs-number">20</span>; System.out.println( a + b );<span class="hljs-comment">// ä¸èƒ½é‡æ’çš„ä¾‹å­ </span><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<span class="hljs-keyword">int</span> b = a - <span class="hljs-number">5</span>;</code></pre></div></li></ul><h3 id="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"><a href="#æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨" class="headerlink" title="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"></a>æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨</h3><p>ç°ä»£ CPU æ”¯æŒå¤šçº§<strong>æŒ‡ä»¤æµæ°´çº¿</strong>ï¼Œä¾‹å¦‚æ”¯æŒ<strong>åŒæ—¶</strong>æ‰§è¡Œ <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€ æ¡æ‰§è¡Œæ—¶é—´é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°<strong>ååç‡</strong>ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png" alt="img"></a></p><p><strong>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å‡ºç°æ„æ–™ä¹‹å¤–çš„ç»“æœ</strong></p><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><p><strong>volatile</strong> ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥<strong>ç¦ç”¨</strong>æŒ‡ä»¤é‡æ’</p><ul><li>ç¦æ­¢çš„æ˜¯åŠ volatileå…³é”®å­—å˜é‡ä¹‹å‰çš„ä»£ç è¢«é‡æ’åº</li></ul><h2 id="4ã€å†…å­˜å±éšœ"><a href="#4ã€å†…å­˜å±éšœ" class="headerlink" title="4ã€å†…å­˜å±éšœ"></a>4ã€å†…å­˜å±éšœ</h2><h5 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h5><ul><li><strong>å†™å±éšœ</strong>ï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å‰</strong>çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­ </li><li><strong>è¯»å±éšœ</strong>ï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å</strong>ï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ® </li></ul><h5 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h5><ul><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>å†™å±éšœä¹‹å‰</strong>çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å </li><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>è¯»å±éšœä¹‹å</strong>çš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li></ul><h2 id="5ã€volatile-åŸç†"><a href="#5ã€volatile-åŸç†" class="headerlink" title="5ã€volatile åŸç†"></a>5ã€volatile åŸç†</h2><p>volatileçš„åº•å±‚å®ç°åŸç†æ˜¯<strong>å†…å­˜å±éšœ</strong>ï¼ŒMemory Barrierï¼ˆMemory Fenceï¼‰</p><ul><li>å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤åä¼šåŠ å…¥å†™å±éšœ </li><li>å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰ä¼šåŠ å…¥è¯»å±éšœ</li></ul><h3 id="å¦‚ä½•ä¿è¯å¯è§æ€§"><a href="#å¦‚ä½•ä¿è¯å¯è§æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯å¯è§æ€§"></a>å¦‚ä½•ä¿è¯å¯è§æ€§</h3><ul><li><p>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png" alt="img"></a></p></li><li><p>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png" alt="img"></a></p></li></ul><h3 id="å¦‚ä½•ä¿è¯æœ‰åºæ€§"><a href="#å¦‚ä½•ä¿è¯æœ‰åºæ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æœ‰åºæ€§"></a>å¦‚ä½•ä¿è¯æœ‰åºæ€§</h3><ul><li><p>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png" alt="img"></a></p></li><li><p>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png" alt="img"></a></p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png" alt="img"></a></p><p><strong>ä½†æ˜¯ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜</strong></p><ul><li>å†™å±éšœä»…ä»…æ˜¯ä¿è¯ä¹‹åçš„è¯»èƒ½å¤Ÿè¯»åˆ°æ–°çš„ç»“æœï¼Œä½†ä¸èƒ½ä¿è¯è¯»è·‘åˆ°å®ƒå‰é¢å» </li><li>è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿåªæ˜¯ä¿è¯äº†<strong>æœ¬çº¿ç¨‹å†…</strong>ç›¸å…³ä»£ç ä¸è¢«é‡æ’åº</li></ul><h3 id="double-checked-locking"><a href="#double-checked-locking" class="headerlink" title="double-checked locking"></a>double-checked locking</h3><p>ä»¥è‘—åçš„ double-checked locking å•ä¾‹æ¨¡å¼ä¸ºä¾‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span><span class="hljs-params">()</span> </span>&#123; &#125; <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton INSTANCE = <span class="hljs-keyword">null</span>; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// t2</span><span class="hljs-comment">// é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åçš„ä½¿ç”¨æ²¡æœ‰ synchronized</span><span class="hljs-keyword">synchronized</span>(Singleton.class) &#123;   <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;   <span class="hljs-comment">// t1 </span>   INSTANCE = <span class="hljs-keyword">new</span> Singleton();   &#125;&#125;&#125;   <span class="hljs-keyword">return</span> INSTANCE;&#125;&#125;</code></pre></div><p>ä»¥ä¸Šçš„å®ç°ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>æ‡’æƒ°å®ä¾‹åŒ–</li><li>é¦–æ¬¡ä½¿ç”¨ getInstance() æ‰ä½¿ç”¨ synchronized åŠ é”ï¼Œåç»­ä½¿ç”¨æ—¶æ— éœ€åŠ é”</li><li>æœ‰éšå«çš„ï¼Œä½†å¾ˆå…³é”®çš„ä¸€ç‚¹ï¼šç¬¬ä¸€ä¸ª if ä½¿ç”¨äº† INSTANCE å˜é‡ï¼Œæ˜¯åœ¨åŒæ­¥å—ä¹‹å¤–</li></ul><p>ä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼ŒgetInstance æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpjnh8hyzhj31ba0u0wjy.jpg" alt="image-20210414223856348"></p><p>å…¶ä¸­</p><ul><li>17 è¡¨ç¤ºåˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡å¼•ç”¨å…¥æ ˆ // new Singleton</li><li>20 è¡¨ç¤ºå¤åˆ¶ä¸€ä»½å¯¹è±¡å¼•ç”¨ // å¼•ç”¨åœ°å€</li><li>21 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè°ƒç”¨æ„é€ æ–¹æ³•</li><li>24 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œèµ‹å€¼ç»™ static INSTANCE</li></ul><p>ä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸ºï¼šå…ˆæ‰§è¡Œ 24ï¼Œå†æ‰§è¡Œ 21ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpjnibyqsnj31j50u0n0r.jpg" alt="image-20210414224002739"></p><p>å…³é”®åœ¨äº 0: getstatic è¿™è¡Œä»£ç åœ¨ monitor æ§åˆ¶ä¹‹å¤–ï¼Œå®ƒå°±åƒä¹‹å‰ä¸¾ä¾‹ä¸­ä¸å®ˆè§„åˆ™çš„äººï¼Œå¯ä»¥è¶Šè¿‡ monitor è¯»å– INSTANCE å˜é‡çš„å€¼ </p><p>è¿™æ—¶ <strong>t1 è¿˜æœªå®Œå…¨å°†æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•</strong>ï¼Œå¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ <strong>t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹</strong> </p><p>å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ä¼šçœŸæ­£æœ‰æ•ˆ</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span><span class="hljs-params">()</span> </span>&#123; &#125;   <span class="hljs-comment">//è§£å†³é‡æ’åºçš„é—®é¢˜</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton INSTANCE = <span class="hljs-keyword">null</span>;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-comment">// å®ä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å—</span><span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-keyword">synchronized</span> (Singleton.class) &#123; <span class="hljs-comment">// t2 </span>         <span class="hljs-comment">// ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡ </span>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// t1 </span>          INSTANCE = <span class="hljs-keyword">new</span> Singleton();         &#125;&#125;&#125;     <span class="hljs-keyword">return</span> INSTANCE;&#125;&#125;</code></pre></div><p>å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥ volatile æŒ‡ä»¤çš„æ•ˆæœ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// -------------------------------------&gt; åŠ å…¥å¯¹ INSTANCE å˜é‡çš„è¯»å±éšœ</span>0: getstatic  #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpk7c82cqxj31c00u0dpb.jpg" alt="image-20210415100608659"></p><p>å¦‚ä¸Šé¢çš„æ³¨é‡Šå†…å®¹æ‰€ç¤ºï¼Œè¯»å†™ volatile å˜é‡æ—¶ä¼šåŠ å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼ˆMemory Fenceï¼‰ï¼‰ï¼Œä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpk7dys4gzj31gq0u0443.jpg" alt="image-20210415100749610"></p><h3 id="balkingæ¨¡å¼ä¹ é¢˜"><a href="#balkingæ¨¡å¼ä¹ é¢˜" class="headerlink" title="balkingæ¨¡å¼ä¹ é¢˜"></a>balkingæ¨¡å¼ä¹ é¢˜</h3><p>å¸Œæœ›doInitæ–¹æ³•ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹é¢å®ç°æœ‰é—®é¢˜</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestVolatile</span></span>&#123;  <span class="hljs-comment">//volatileåªèƒ½ä¿è¯å…±äº«å˜é‡å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§</span>  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> initialized = <span class="hljs-keyword">false</span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//ä¸€æ¬¡å‡ºç°ï¼Œvolatileæœ‰åºæ€§ä¹Ÿåªèƒ½ä¿è¯å˜é‡ä¹‹å‰çš„è¯»å†™å±éšœ</span>    <span class="hljs-keyword">if</span>(initialized)&#123;      <span class="hljs-keyword">return</span>;    &#125;    doInit();    <span class="hljs-comment">//äºŒæ¬¡å‡ºç°ï¼Œçº¿ç¨‹1è¿˜æ²¡æ¥å¾—åŠèµ‹å€¼ï¼Œçº¿ç¨‹2å·²ç»è¿›å…¥åˆ°äº†ifåˆ¤æ–­</span>    initialized = <span class="hljs-keyword">true</span>;  &#125;  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doInit</span><span class="hljs-params">()</span></span>&#123;&#125;&#125;</code></pre></div><p>æ‰€ä»¥è¦ç”¨<strong>synchronized</strong>æ¥ä¿è¯ä»¥ä¸Šçš„é—®é¢˜</p><h3 id="å®ç°åŸç†ä¹‹Lockå‰ç¼€"><a href="#å®ç°åŸç†ä¹‹Lockå‰ç¼€" class="headerlink" title="å®ç°åŸç†ä¹‹Lockå‰ç¼€"></a>å®ç°åŸç†ä¹‹Lockå‰ç¼€</h3><p>åœ¨X86å¤„ç†å™¨ä¸‹é€šè¿‡å·¥å…·è·å–JITç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ¥æŸ¥çœ‹å¯¹volatileè¿›è¡Œå†™æ“ä½œæ—¶</p><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">instance</span> = new Singleton()<span class="hljs-comment">; </span></code></pre></div><p>å¯¹åº”çš„æ±‡ç¼–ä»£ç æ˜¯</p><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">...</span> lock addl <span class="hljs-string">...</span></code></pre></div><p>æœ‰volatileå˜é‡ä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¼šå¤šå‡ºç¬¬äºŒè¡Œæ±‡ç¼–ä»£ç ï¼Œé€šè¿‡æŸ¥IA-32æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œå¯çŸ¥ï¼Œ<strong>Lockå‰ç¼€</strong>çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨ä¸‹ä¼šå¼•å‘äº†ä¸¤ä»¶äº‹</p><ul><li>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨ç¼“å­˜å›å†™åˆ°å†…å­˜<ul><li>Lockå‰ç¼€æŒ‡ä»¤å¯¼è‡´åœ¨æ‰§è¡ŒæŒ‡ä»¤æœŸé—´ï¼Œå£°è¨€å¤„ç†å™¨çš„LOCK#ä¿¡å·ã€‚åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼ŒLOCK#ä¿¡å·ç¡®ä¿åœ¨å£°è¨€è¯¥ä¿¡å·æœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥ç‹¬å ä»»ä½•å…±äº«å†…å­˜ã€‚ä½†æ˜¯ï¼Œåœ¨æœ€è¿‘çš„å¤„ç†å™¨é‡Œï¼ŒLOCK #ä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯<strong>é”ç¼“å­˜</strong>ï¼Œæ¯•ç«Ÿé”æ€»çº¿å¼€é”€çš„æ¯”è¾ƒå¤§ã€‚ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œ<strong>ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®</strong></li></ul></li><li>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ<ul><li>åœ¨å¤šæ ¸å¤„ç†å™¨ç³»ç»Ÿä¸­è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼ŒIA-32å’ŒIntel 64å¤„ç†å™¨èƒ½<strong>å—…æ¢å…¶ä»–å¤„ç†å™¨è®¿é—®ç³»ç»Ÿå†…å­˜å’Œå®ƒä»¬çš„å†…éƒ¨ç¼“å­˜</strong>ã€‚å¤„ç†å™¨ä½¿ç”¨å—…æ¢æŠ€æœ¯ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´</li></ul></li></ul><h2 id="6ã€finalåŸç†"><a href="#6ã€finalåŸç†" class="headerlink" title="6ã€finalåŸç†"></a>6ã€finalåŸç†</h2><p>ç†è§£äº† volatile åŸç†ï¼Œå†å¯¹æ¯” ï¬nal çš„å®ç°å°±æ¯”è¾ƒç®€å•äº†</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFinal</span> </span>&#123;   <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">20</span>; &#125;</code></pre></div><p>å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">0</span>: aload_0 1: invokespecial #1 <span class="hljs-number">4</span>: aload_0 <span class="hljs-number">5</span>: bipush <span class="hljs-number">20</span> 7: putfield #2 &lt;-- å†™å±éšœ <span class="hljs-number">10</span>: <span class="hljs-keyword">return</span></code></pre></div><p>å‘ç°ï¬nalå˜é‡çš„èµ‹å€¼ä¹Ÿä¼šé€šè¿‡putï¬eldæŒ‡ä»¤æ¥å®Œæˆï¼ŒåŒæ ·åœ¨è¿™æ¡æŒ‡ä»¤ä¹‹åä¹Ÿä¼šåŠ å…¥å†™å±éšœï¼Œä¿è¯åœ¨å…¶å®ƒçº¿ç¨‹è¯»åˆ°å®ƒçš„å€¼æ—¶ä¸ä¼šå‡ºç°ä¸º0çš„æƒ…å†µ</p><p><strong>finalä¿®é¥°çš„å˜é‡ä¼šæœ‰ä¸€ä¸ªæ ˆå†…å­˜è¯»å–é€Ÿåº¦çš„ä¼˜åŒ–</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> A = <span class="hljs-number">10</span>;<span class="hljs-comment">//ç›´æ¥ä»æ ˆå†…å­˜æ‹¿å–</span></code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkvwtaow5j30m605gtbi.jpg" alt="image-20210416001619162"></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> A = <span class="hljs-number">10</span>;<span class="hljs-comment">//ä»å…±äº«å†…å­˜æ‹¿å–ï¼Œæ•ˆç‡ä½ï¼Œåœ¨å †ä¸­</span></code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkvxy4mlpj30mg05cq6p.jpg" alt="image-20210416001725052"></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> B = Short.MAX_VALUE+<span class="hljs-number">1</span>;<span class="hljs-comment">//æ•°å€¼å¤ªå¤§ï¼Œæ­¤æ—¶ä»å¸¸é‡æ± ä¸­æ‹¿å–</span></code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkvzmusmoj30lw05ujuf.jpg" alt="image-20210416001902406"></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> B = Short.MAX_VALUE+<span class="hljs-number">1</span>;<span class="hljs-comment">//åŒç†ï¼Œä»å…±äº«å†…å­˜æ‹¿å–ï¼Œæ•ˆç‡ä½ï¼Œåœ¨å †ä¸­</span></code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkw0d2xsyj30m60580w6.jpg" alt="image-20210416001944201"></p><h1 id="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"><a href="#äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”" class="headerlink" title="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"></a>äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”</h1><h2 id="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><p>ä½¿ç”¨<strong>åŸå­æ•´æ•°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">AtomicInteger balance = <span class="hljs-keyword">new</span> AtomicInteger();</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Account</span> </span>&#123;    <span class="hljs-function">Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span></span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">(Account account)</span> </span>&#123;        List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">long</span> start = System.nanoTime();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;            ts.add(<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;                account.withdraw(<span class="hljs-number">10</span>);            &#125;));        &#125;        ts.forEach(Thread::start);        ts.forEach(t -&gt; &#123;            <span class="hljs-keyword">try</span> &#123;                t.join();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;);        <span class="hljs-keyword">long</span> end = System.nanoTime();        System.out.println(account.getBalance() + <span class="hljs-string">&quot; cost: &quot;</span> + (end - start) / <span class="hljs-number">1000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);    &#125;&#125;<span class="hljs-comment">//çº¿ç¨‹ä¸å®‰å…¨çš„åšæ³•</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountUnsafe</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Account</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer balance;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccountUnsafe</span><span class="hljs-params">(Integer balance)</span> </span>&#123;        <span class="hljs-keyword">this</span>.balance = balance;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.balance;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span> </span>&#123;        balance -= amount;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Account.demo(<span class="hljs-keyword">new</span> AccountUnsafe(<span class="hljs-number">10000</span>));        Account.demo(<span class="hljs-keyword">new</span> AccountCas(<span class="hljs-number">10000</span>));    &#125;&#125;<span class="hljs-comment">//çº¿ç¨‹å®‰å…¨çš„åšæ³•</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountCas</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Account</span> </span>&#123;    <span class="hljs-comment">//ä½¿ç”¨åŸå­æ•´æ•°</span>    <span class="hljs-keyword">private</span> AtomicInteger balance;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccountCas</span><span class="hljs-params">(<span class="hljs-keyword">int</span> balance)</span> </span>&#123;        <span class="hljs-keyword">this</span>.balance = <span class="hljs-keyword">new</span> AtomicInteger(balance);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//å¾—åˆ°åŸå­æ•´æ•°çš„å€¼</span>        <span class="hljs-keyword">return</span> balance.get();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span> </span>&#123;        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;            <span class="hljs-comment">//è·å¾—ä¿®æ”¹å‰çš„å€¼</span>            <span class="hljs-keyword">int</span> prev = balance.get();            <span class="hljs-comment">//è·å¾—ä¿®æ”¹åçš„å€¼</span>            <span class="hljs-keyword">int</span> next = prev-amount;            <span class="hljs-comment">//æ¯”è¾ƒå¹¶è®¾å€¼</span>            <span class="hljs-keyword">if</span>(balance.compareAndSet(prev, next)) &#123;                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;&#125;</code></pre></div><h2 id="2ã€CASä¸volatile"><a href="#2ã€CASä¸volatile" class="headerlink" title="2ã€CASä¸volatile"></a>2ã€CASä¸volatile</h2><p>å‰é¢çœ‹åˆ°çš„ AtomicInteger çš„è§£å†³æ–¹æ³•ï¼Œå†…éƒ¨å¹¶æ²¡æœ‰ç”¨é”æ¥ä¿æŠ¤å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>å…¶ä¸­çš„<strong>å…³é”®æ˜¯ compareAndSwap</strong>ï¼ˆæ¯”è¾ƒå¹¶è®¾ç½®å€¼ï¼‰ï¼Œå®ƒçš„<strong>ç®€ç§°å°±æ˜¯ CAS</strong> ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯<strong>åŸå­æ“ä½œ</strong>ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png" alt="img"></a></p><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a><strong>å·¥ä½œæµç¨‹</strong></h3><ul><li>å½“ä¸€ä¸ªçº¿ç¨‹è¦å»ä¿®æ”¹Accountå¯¹è±¡ä¸­çš„å€¼æ—¶ï¼Œå…ˆè·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ã€‚åœ¨è°ƒç”¨casæ–¹æ³•æ—¶ï¼Œä¼šå°†preä¸Accountä¸­çš„ä½™é¢è¿›è¡Œæ¯”è¾ƒã€‚<ul><li>å¦‚æœ<strong>ä¸¤è€…ç›¸ç­‰</strong>ï¼Œå°±è¯´æ˜è¯¥å€¼è¿˜æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</li><li>å¦‚æœ<strong>ä¸¤è€…ä¸ç›¸ç­‰</strong>ï¼Œå°±ä¸è®¾ç½®å€¼ï¼Œé‡æ–°è·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ï¼Œç›´åˆ°ä¿®æ”¹æˆåŠŸä¸ºæ­¢ã€‚</li></ul></li></ul><p><strong>æ³¨æ„</strong></p><ul><li>å…¶å® CAS çš„åº•å±‚æ˜¯ <strong>lock cmpxchg</strong> æŒ‡ä»¤ï¼ˆX86 æ¶æ„ï¼‰ï¼Œåœ¨å•æ ¸ CPU å’Œå¤šæ ¸ CPU ä¸‹éƒ½èƒ½å¤Ÿä¿è¯ã€æ¯”è¾ƒ-äº¤æ¢ã€‘çš„<strong>åŸå­æ€§</strong>ã€‚</li><li>åœ¨å¤šæ ¸çŠ¶æ€ä¸‹ï¼ŒæŸä¸ªæ ¸æ‰§è¡Œåˆ°å¸¦ lock çš„æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè®©æ€»çº¿é”ä½ï¼Œå½“è¿™ä¸ªæ ¸æŠŠæ­¤æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå†å¼€å¯æ€»çº¿ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¢«çº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶æ‰€æ‰“æ–­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹å¯¹å†…å­˜æ“ä½œçš„å‡†ç¡®æ€§ï¼Œæ˜¯åŸå­çš„ã€‚</li></ul><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„<strong>å¯è§æ€§</strong>ï¼Œéœ€è¦ä½¿ç”¨ <strong>volatile</strong> ä¿®é¥°ã€‚<br>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œvolatileå˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹volatileå˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p><p><strong>æ³¨æ„</strong></p><div class="hljs code-wrapper"><pre><code class="hljs arduino"><span class="hljs-keyword">volatile</span> ä»…ä»…ä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œè®©å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æ–°å€¼ï¼Œä½†ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰</code></pre></div><p><strong>CAS å¿…é¡»å€ŸåŠ© volatile</strong> æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æ–°å€¼æ¥å®ç°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæœ </p><h3 id="æ•ˆç‡é—®é¢˜"><a href="#æ•ˆç‡é—®é¢˜" class="headerlink" title="æ•ˆç‡é—®é¢˜"></a>æ•ˆç‡é—®é¢˜</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ— é”æ¯”ä½¿ç”¨åŠ é”çš„<strong>æ•ˆç‡æ›´é«˜ã€‚</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png" alt="img"></a></p><p><strong>åŸå› </strong></p><h3 id="CASç‰¹ç‚¹"><a href="#CASç‰¹ç‚¹" class="headerlink" title="CASç‰¹ç‚¹"></a>CASç‰¹ç‚¹</h3><p>ç»“åˆ CAS å’Œ volatile å¯ä»¥å®ç°<strong>æ— é”å¹¶å‘</strong>ï¼Œé€‚ç”¨äº<strong>çº¿ç¨‹æ•°å°‘ã€å¤šæ ¸ CPU</strong> çš„åœºæ™¯ä¸‹ã€‚</p><ul><li><p>CAS æ˜¯åŸºäº<strong>ä¹è§‚é”</strong>çš„æ€æƒ³ï¼šä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚ </p></li><li><p>synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³ï¼šæ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚ </p></li><li><p>CAS ä½“ç°çš„æ˜¯æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘ï¼Œè¯·ä»”ç»†ä½“ä¼šè¿™ä¸¤å¥è¯çš„æ„æ€</p><ul><li>å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€ </li><li>ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li></ul></li></ul><h2 id="3ã€åŸå­æ•´æ•°"><a href="#3ã€åŸå­æ•´æ•°" class="headerlink" title="3ã€åŸå­æ•´æ•°"></a>3ã€åŸå­æ•´æ•°</h2><p>J.U.C å¹¶å‘åŒ…æä¾›äº†</p><ul><li>AtomicBoolean</li><li>AtomicInteger </li><li>AtomicLong</li></ul><p><strong>ä»¥ AtomicInteger ä¸ºä¾‹</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"> AtomicInteger i = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);<span class="hljs-comment">// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++ System.out.println(i.getAndIncrement());</span><span class="hljs-comment">// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i System.out.println(i.incrementAndGet());</span><span class="hljs-comment">// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i System.out.println(i.decrementAndGet());</span><span class="hljs-comment">// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span>System.out.println(i.getAndDecrement());<span class="hljs-comment">// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰ </span>System.out.println(i.getAndAdd(<span class="hljs-number">5</span>));<span class="hljs-comment">// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span>System.out.println(i.addAndGet(-<span class="hljs-number">5</span>));<span class="hljs-comment">// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰ </span><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span>System.out.println(i.getAndUpdate(p -&gt; p - <span class="hljs-number">2</span>));<span class="hljs-comment">// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰</span><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span>System.out.println(i.updateAndGet(p -&gt; p + <span class="hljs-number">2</span>));<span class="hljs-comment">// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰ </span><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ // getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„ </span><span class="hljs-comment">// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ </span><span class="hljs-keyword">final</span> System.out.println(i.getAndAccumulate(<span class="hljs-number">10</span>, (p, x) -&gt; p + x));<span class="hljs-comment">// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span>System.out.println(i.accumulateAndGet(-<span class="hljs-number">10</span>, (p, x) -&gt; p + x));</code></pre></div><h2 id="4ã€åŸå­å¼•ç”¨"><a href="#4ã€åŸå­å¼•ç”¨" class="headerlink" title="4ã€åŸå­å¼•ç”¨"></a>4ã€åŸå­å¼•ç”¨</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DecimalAccount</span> </span>&#123;    <span class="hljs-function">BigDecimal <span class="hljs-title">getBalance</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(BigDecimal amount)</span></span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ    </span><span class="hljs-comment">     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">(DecimalAccountImpl account)</span> </span>&#123;        List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">long</span> start = System.nanoTime();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;            ts.add(<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;                account.withdraw(BigDecimal.TEN);            &#125;));        &#125;        ts.forEach(Thread::start);        ts.forEach(t -&gt; &#123;            <span class="hljs-keyword">try</span> &#123;                t.join();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;);        <span class="hljs-keyword">long</span> end = System.nanoTime();        System.out.println(account.getBalance() + <span class="hljs-string">&quot; cost: &quot;</span> + (end - start) / <span class="hljs-number">1000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecimalAccountImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DecimalAccount</span> </span>&#123;    <span class="hljs-comment">//åŸå­å¼•ç”¨ï¼Œæ³›å‹ç±»å‹ä¸ºå°æ•°ç±»å‹</span>    AtomicReference&lt;BigDecimal&gt; balance;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DecimalAccountImpl</span><span class="hljs-params">(BigDecimal balance)</span> </span>&#123;        <span class="hljs-keyword">this</span>.balance = <span class="hljs-keyword">new</span> AtomicReference&lt;BigDecimal&gt;(balance);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> balance.get();    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(BigDecimal amount)</span> </span>&#123;        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;            BigDecimal pre = balance.get();            BigDecimal next = pre.subtract(amount);            <span class="hljs-keyword">if</span>(balance.compareAndSet(pre, next)) &#123;                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        DecimalAccount.demo(<span class="hljs-keyword">new</span> DecimalAccountImpl(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-string">&quot;10000&quot;</span>)));    &#125;&#125;</code></pre></div><h2 id="5ã€ABAé—®é¢˜"><a href="#5ã€ABAé—®é¢˜" class="headerlink" title="5ã€ABAé—®é¢˜"></a>5ã€ABAé—®é¢˜</h2><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;    <span class="hljs-keyword">static</span> AtomicReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>);    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            String pre = str.get();            System.out.println(<span class="hljs-string">&quot;change&quot;</span>);            <span class="hljs-keyword">try</span> &#123;                other();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-keyword">try</span> &#123;                Thread.sleep(<span class="hljs-number">1000</span>);            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC</span>            System.out.println(<span class="hljs-string">&quot;change A-&gt;C &quot;</span> + str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>));        &#125;).start();    &#125;    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            System.out.println(<span class="hljs-string">&quot;change A-&gt;B &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>));        &#125;).start();        Thread.sleep(<span class="hljs-number">500</span>);        <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            System.out.println(<span class="hljs-string">&quot;change B-&gt;A &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>));        &#125;).start();    &#125;&#125;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png" alt="img"></a></p><p>ä¸»çº¿ç¨‹ä»…èƒ½åˆ¤æ–­å‡ºå…±äº«å˜é‡çš„å€¼ä¸åˆå€¼ A <strong>æ˜¯å¦ç›¸åŒ</strong>ï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ç§ä» A æ”¹ä¸º B åˆ æ”¹å› A çš„æƒ…å†µï¼Œå¦‚æœä¸»çº¿ç¨‹å¸Œæœ›ï¼š<br>åªè¦æœ‰å…¶å®ƒçº¿ç¨‹ã€<strong>åŠ¨è¿‡äº†</strong>ã€‘å…±äº«å˜é‡ï¼Œé‚£ä¹ˆè‡ªå·±çš„ <strong>cas å°±ç®—å¤±è´¥</strong>ï¼Œè¿™æ—¶ï¼Œä»…æ¯”è¾ƒå€¼æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦å†åŠ ä¸€ä¸ª<strong>ç‰ˆæœ¬å·</strong></p><h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a><strong>AtomicStampedReference</strong></h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;    <span class="hljs-comment">//æŒ‡å®šç‰ˆæœ¬å·</span>    <span class="hljs-keyword">static</span> AtomicStampedReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicStampedReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0</span>);    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            String pre = str.getReference();            <span class="hljs-comment">//è·å¾—ç‰ˆæœ¬å·</span>            <span class="hljs-keyword">int</span> stamp = str.getStamp();            System.out.println(<span class="hljs-string">&quot;change&quot;</span>);            <span class="hljs-keyword">try</span> &#123;                other();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-keyword">try</span> &#123;                Thread.sleep(<span class="hljs-number">1000</span>);            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span>            System.out.println(<span class="hljs-string">&quot;change A-&gt;C stamp &quot;</span> + stamp + str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));        &#125;).start();    &#125;    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            <span class="hljs-keyword">int</span> stamp = str.getStamp();            System.out.println(<span class="hljs-string">&quot;change A-&gt;B stamp &quot;</span> + stamp + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));        &#125;).start();        Thread.sleep(<span class="hljs-number">500</span>);        <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;            <span class="hljs-keyword">int</span> stamp = str.getStamp();            System.out.println(<span class="hljs-string">&quot;change B-&gt;A stamp &quot;</span> + stamp +  str.compareAndSet(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));        &#125;).start();    &#125;&#125;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png" alt="img"></a></p><h3 id="AtomicMarkableReference"><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3><p>AtomicStampedReference å¯ä»¥ç»™åŸå­å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªåŸå­å¼•ç”¨æ•´ä¸ªçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; A -&gt; C ï¼Œé€šè¿‡AtomicStampedReferenceï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†å‡ æ¬¡ã€‚<br>ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªæ˜¯å•çº¯çš„å…³å¿ƒ<strong>æ˜¯å¦æ›´æ”¹è¿‡</strong>ï¼Œæ‰€ä»¥å°±æœ‰äº† <strong>AtomicMarkableReference</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;    <span class="hljs-comment">//æŒ‡å®šç‰ˆæœ¬å·</span>    <span class="hljs-keyword">static</span> AtomicMarkableReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicMarkableReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-keyword">true</span>);    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            String pre = str.getReference();            System.out.println(<span class="hljs-string">&quot;change&quot;</span>);            <span class="hljs-keyword">try</span> &#123;                other();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-keyword">try</span> &#123;                Thread.sleep(<span class="hljs-number">1000</span>);            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;            <span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span>            System.out.println(<span class="hljs-string">&quot;change A-&gt;C mark &quot;</span> +  str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>));        &#125;).start();    &#125;    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            System.out.println(<span class="hljs-string">&quot;change A-&gt;A mark &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>));        &#125;).start();    &#125;&#125;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png" alt="img"></a></p><h3 id="ä¸¤è€…çš„åŒºåˆ«"><a href="#ä¸¤è€…çš„åŒºåˆ«" class="headerlink" title="ä¸¤è€…çš„åŒºåˆ«"></a>ä¸¤è€…çš„åŒºåˆ«</h3><ul><li><strong>AtomicStampedReference</strong> éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>æ•´å‹å˜é‡</strong>ä½œä¸ºç‰ˆæœ¬å·ï¼Œæ¥åˆ¤å®šæ˜¯å¦è¢«æ›´æ”¹è¿‡</li><li><strong>AtomicMarkableReference</strong>éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>å¸ƒå°”å˜é‡</strong>ä½œä¸ºæ ‡è®°ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¢«æ›´æ”¹è¿‡</li></ul><h2 id="6ã€åŸå­æ•°ç»„"><a href="#6ã€åŸå­æ•°ç»„" class="headerlink" title="6ã€åŸå­æ•°ç»„"></a>6ã€åŸå­æ•°ç»„</h2><ul><li>AtomicIntegerArray</li><li>AtomicLongArray </li><li>AtomicReferenceArray</li></ul><h3 id="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"><a href="#lambaè¡¨è¾¾å¼çš„ä½¿ç”¨" class="headerlink" title="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"></a>lambaè¡¨è¾¾å¼çš„ä½¿ç”¨</h3><ul><li><p>æä¾›è€…</p></li><li><p>æ— å‚åˆè¿”å›</p></li><li><p>()-&gt;è¿”å›ç»“æœ</p></li><li><p>æ–¹æ³•</p><ul><li>æœ‰å‚æœ‰è¿”å›</li><li>(å‚æ•°ä¸€â€¦)-&gt;è¿”å›ç»“æœ</li></ul></li><li><p>æ¶ˆè´¹è€…</p><ul><li>æœ‰å‚æ— è¿”å›</li><li>(å‚æ•°ä¸€â€¦)-&gt;void</li></ul></li></ul><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkipn3olxj30u00usthn.jpg" alt="image-20210415163935411"></p><p>ä¸å®‰å…¨çš„æ•°ç»„</p><div class="hljs code-wrapper"><pre><code class="hljs java">demo(   ()-&gt;<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>],   (array)-&gt;array.length,   (array, index) -&gt; array[index]++,   array-&gt; System.out.println(Arrays.toString(array)) );<span class="hljs-comment">//[9870, 9862, 9774, 9697, 9683, 9678, 9679, 9668, 9680, 9698]</span></code></pre></div><p>å®‰å…¨çš„æ•°ç»„</p><div class="hljs code-wrapper"><pre><code class="hljs java">demo(   ()-&gt; <span class="hljs-keyword">new</span> AtomicIntegerArray(<span class="hljs-number">10</span>),   (array) -&gt; array.length(),   (array, index) -&gt; array.getAndIncrement(index),   array -&gt; System.out.println(array) );<span class="hljs-comment">//[10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000]</span></code></pre></div><h2 id="7ã€åŸå­æ›´æ–°å™¨"><a href="#7ã€åŸå­æ›´æ–°å™¨" class="headerlink" title="7ã€åŸå­æ›´æ–°å™¨"></a>7ã€åŸå­æ›´æ–°å™¨</h2><ul><li>AtomicReferenceFieldUpdater // åŸŸ å­—æ®µ </li><li>AtomicIntegerFieldUpdater </li><li>AtomicLongFieldUpdate</li></ul><p>åŸå­æ›´æ–°å™¨ç”¨äºå¸®åŠ©æˆ‘ä»¬æ”¹å˜æŸä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      Student student = <span class="hljs-keyword">new</span> Student();      <span class="hljs-comment">// è·å¾—åŸå­æ›´æ–°å™¨</span>      <span class="hljs-comment">// æ³›å‹</span>      <span class="hljs-comment">// å‚æ•°1 æŒæœ‰å±æ€§çš„ç±» å‚æ•°2 è¢«æ›´æ–°çš„å±æ€§çš„ç±»</span>      <span class="hljs-comment">// newUpdaterä¸­çš„å‚æ•°ï¼šç¬¬ä¸‰ä¸ªä¸ºå±æ€§çš„åç§°</span>      AtomicReferenceFieldUpdater&lt;Student, String&gt; updater = AtomicReferenceFieldUpdater.newUpdater(Student.class, String.class, <span class="hljs-string">&quot;name&quot;</span>);      <span class="hljs-comment">// ä¿®æ”¹</span>      updater.compareAndSet(student, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;LLL&quot;</span>);      System.out.println(student);   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;   <span class="hljs-keyword">volatile</span> String name;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +            <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +            <span class="hljs-string">&#x27;&#125;&#x27;</span>;   &#125;&#125;</code></pre></div><h3 id="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"></a>åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹</h3><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒåŸå­æ›´æ–°å™¨æ˜¯é€šè¿‡newUpdateræ¥è·å–å®ä¾‹çš„ã€‚å…¶ä¸­ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°</p><ul><li>æ‹¥æœ‰å±æ€§çš„ç±»çš„Class</li><li>å±æ€§çš„Class</li><li>å±æ€§çš„åç§°</li></ul><p>å¤§æ¦‚å¯ä»¥çŒœå‡ºæ¥ï¼Œ<strong>åˆå§‹åŒ–è¿‡ç¨‹ç”¨åˆ°äº†åå°„</strong>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æºç æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹ã€‚</p><h4 id="newUpdateræ–¹æ³•"><a href="#newUpdateræ–¹æ³•" class="headerlink" title="newUpdateræ–¹æ³•"></a>newUpdateræ–¹æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;U,W&gt; <span class="hljs-function">AtomicReferenceFieldUpdater&lt;U,W&gt; <span class="hljs-title">newUpdater</span><span class="hljs-params">(Class&lt;U&gt; tclass,</span></span><span class="hljs-function"><span class="hljs-params">                                                                Class&lt;W&gt; vclass,</span></span><span class="hljs-function"><span class="hljs-params">                                                                String fieldName)</span> </span>&#123;    <span class="hljs-comment">// è¿”å›äº†ä¸€ä¸ªAtomicReferenceFieldUpdaterImplå®ä¾‹</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AtomicReferenceFieldUpdaterImpl&lt;U,W&gt;        (tclass, vclass, fieldName, Reflection.getCallerClass());&#125;</code></pre></div><p>ä»newUpdateræ–¹æ³•è¿˜å¹¶ä¸èƒ½çœ‹å‡ºæ¥å…·ä½“çš„åˆå§‹åŒ–è¿‡ç¨‹</p><h4 id="å†…éƒ¨å®ç°ç±»"><a href="#å†…éƒ¨å®ç°ç±»" class="headerlink" title="å†…éƒ¨å®ç°ç±»"></a>å†…éƒ¨å®ç°ç±»</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png" alt="img"></a></p><p>AtomicReferenceFieldUpdaterä¸ºæŠ½è±¡ç±»ï¼Œè¯¥ç±»<strong>å†…éƒ¨æœ‰ä¸€ä¸ªè‡ªå·±çš„å®ç°ç±»AtomicReferenceFieldUpdaterImpl</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReferenceFieldUpdaterImpl</span>&lt;<span class="hljs-title">T</span>,<span class="hljs-title">V</span>&gt;</span><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">AtomicReferenceFieldUpdater</span>&lt;<span class="hljs-title">T</span>,<span class="hljs-title">V</span>&gt; </span></code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png" alt="img"></a></p><p><strong>æ„é€ æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">AtomicReferenceFieldUpdaterImpl(<span class="hljs-keyword">final</span> Class&lt;T&gt; tclass,                                <span class="hljs-keyword">final</span> Class&lt;V&gt; vclass,                                <span class="hljs-keyword">final</span> String fieldName,                                <span class="hljs-keyword">final</span> Class&lt;?&gt; caller) &#123;    <span class="hljs-comment">// ç”¨äºä¿å­˜è¦è¢«ä¿®æ”¹çš„å±æ€§</span>    <span class="hljs-keyword">final</span> Field field;    <span class="hljs-comment">// å±æ€§çš„Class</span>    <span class="hljs-keyword">final</span> Class&lt;?&gt; fieldClass;    <span class="hljs-comment">// fieldçš„ä¿®é¥°ç¬¦</span>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> modifiers;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">// åå°„è·å¾—å±æ€§</span>        field = AccessController.doPrivileged(            <span class="hljs-keyword">new</span> PrivilegedExceptionAction&lt;Field&gt;() &#123;                <span class="hljs-function"><span class="hljs-keyword">public</span> Field <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchFieldException </span>&#123;                    <span class="hljs-comment">// tclassä¸ºä¼ å…¥çš„å±æ€§çš„Classï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å¾—å±æ€§</span>                    <span class="hljs-keyword">return</span> tclass.getDeclaredField(fieldName);                &#125;            &#125;);        <span class="hljs-comment">// è·å¾—å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­</span>        <span class="hljs-comment">// 1ã€vclass ä¸ å±æ€§ç¡®åˆ‡çš„ç±»å‹æ˜¯å¦åŒ¹é…</span>        <span class="hljs-comment">// 2ã€æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹</span>        <span class="hljs-comment">// 3ã€è¢«ä¿®æ”¹çš„å±æ€§æ˜¯å¦åŠ äº†volatileå…³é”®å­—</span>        modifiers = field.getModifiers();        sun.reflect.misc.ReflectUtil.ensureMemberAccess(            caller, tclass, <span class="hljs-keyword">null</span>, modifiers);        ClassLoader cl = tclass.getClassLoader();        ClassLoader ccl = caller.getClassLoader();        <span class="hljs-keyword">if</span> ((ccl != <span class="hljs-keyword">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;            ((cl == <span class="hljs-keyword">null</span>) || !isAncestor(cl, ccl))) &#123;            sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);        &#125;        <span class="hljs-comment">// è·å¾—å±æ€§ç±»çš„Class</span>        fieldClass = field.getType();    &#125; <span class="hljs-keyword">catch</span> (PrivilegedActionException pae) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(pae.getException());    &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(ex);    &#125;    <span class="hljs-keyword">if</span> (vclass != fieldClass)        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClassCastException();    <span class="hljs-keyword">if</span> (vclass.isPrimitive())        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Must be reference type&quot;</span>);    <span class="hljs-keyword">if</span> (!Modifier.isVolatile(modifiers))        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Must be volatile type&quot;</span>);    <span class="hljs-comment">// Access to protected field members is restricted to receivers only</span>    <span class="hljs-comment">// of the accessing class, or one of its subclasses, and the</span>    <span class="hljs-comment">// accessing class must in turn be a subclass (or package sibling)</span>    <span class="hljs-comment">// of the protected member&#x27;s defining class.</span>    <span class="hljs-comment">// If the updater refers to a protected field of a declaring class</span>    <span class="hljs-comment">// outside the current package, the receiver argument will be</span>    <span class="hljs-comment">// narrowed to the type of the accessing class.</span>     <span class="hljs-comment">// å¯¹ç±»ä¸­çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–</span>    <span class="hljs-keyword">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;                   tclass.isAssignableFrom(caller) &amp;&amp;                   !isSamePackage(tclass, caller))                  ? caller : tclass;    <span class="hljs-keyword">this</span>.tclass = tclass;    <span class="hljs-keyword">this</span>.vclass = vclass;    <span class="hljs-comment">// è·å¾—åç§»é‡</span>    <span class="hljs-keyword">this</span>.offset = U.objectFieldOffset(field);&#125;</code></pre></div><p><strong>å¯ä»¥çœ‹å‡ºï¼ŒåŸå­å¼•ç”¨æ›´æ–°å™¨ç¡®å®ä½¿ç”¨äº†åå°„</strong></p><h2 id="8ã€LongAdderåŸç†"><a href="#8ã€LongAdderåŸç†" class="headerlink" title="8ã€LongAdderåŸç†"></a>8ã€LongAdderåŸç†</h2><h3 id="åŸç†ä¹‹ä¼ªå…±äº«"><a href="#åŸç†ä¹‹ä¼ªå…±äº«" class="headerlink" title="åŸç†ä¹‹ä¼ªå…±äº«"></a>åŸç†ä¹‹ä¼ªå…±äº«</h3><p> <a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png" alt="img"></a></p><p>ç¼“å­˜è¡Œä¼ªå…±äº«å¾—ä»ç¼“å­˜è¯´èµ·<br>ç¼“å­˜ä¸å†…å­˜çš„é€Ÿåº¦æ¯”è¾ƒ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png" alt="img"></a></p><p>å› ä¸º CPU ä¸ å†…å­˜çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦é é¢„è¯»æ•°æ®è‡³<strong>ç¼“å­˜</strong>æ¥æå‡æ•ˆç‡ã€‚<br>è€Œç¼“å­˜ä»¥<strong>ç¼“å­˜è¡Œ</strong>ä¸ºå•ä½ï¼Œæ¯ä¸ªç¼“å­˜è¡Œå¯¹åº”ç€ä¸€å—å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ <strong>64 byte</strong>ï¼ˆ8 ä¸ª longï¼‰<br>ç¼“å­˜çš„åŠ å…¥ä¼šé€ æˆæ•°æ®å‰¯æœ¬çš„äº§ç”Ÿï¼Œå³åŒä¸€ä»½æ•°æ®ä¼šç¼“å­˜åœ¨ä¸åŒæ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­<br>CPU è¦ä¿è¯æ•°æ®çš„<strong>ä¸€è‡´æ€§</strong>ï¼Œå¦‚æœæŸä¸ª CPU æ ¸å¿ƒ<strong>æ›´æ”¹</strong>äº†æ•°æ®ï¼Œå…¶å®ƒ CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»<strong>å¤±æ•ˆ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png" alt="img"></a></p><p>å› ä¸º Cell æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¸€ä¸ª Cell ä¸º 24 å­—èŠ‚ï¼ˆ16 å­—èŠ‚çš„å¯¹è±¡å¤´å’Œ 8 å­—èŠ‚çš„ valueï¼‰ï¼Œå›  æ­¤ç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 2 ä¸ªçš„ Cell å¯¹è±¡ã€‚è¿™æ ·é—®é¢˜æ¥äº†ï¼š</p><ul><li>Core-0 è¦ä¿®æ”¹ Cell[0]</li><li>Core-1 è¦ä¿®æ”¹ Cell[1] </li></ul><p>æ— è®ºè°ä¿®æ”¹æˆåŠŸï¼Œéƒ½ä¼šå¯¼è‡´å¯¹æ–¹ Core çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œ</p><p>æ¯”å¦‚ Core-0 ä¸­ Cell[0]=6000, Cell[1]=8000 è¦ç´¯åŠ  Cell[0]=6001, Cell[1]=8000 ï¼Œè¿™æ—¶ä¼šè®© Core-1 çš„ç¼“å­˜è¡Œå¤±æ•ˆ</p><p><strong>@sun.misc.Contended ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜</strong>ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„<strong>å‰åå„å¢åŠ  128 å­—èŠ‚å¤§å°çš„ padding</strong>ï¼ˆç©ºç™½ï¼‰ï¼Œä»è€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶<strong>å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œ</strong>ï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png" alt="img"></a></p><p><strong>ç´¯åŠ ä¸»è¦è°ƒç”¨ä»¥ä¸‹æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x)</span> </span>&#123;       Cell[] as; <span class="hljs-keyword">long</span> b, v; <span class="hljs-keyword">int</span> m; Cell a;       <span class="hljs-keyword">if</span> ((as = cells) != <span class="hljs-keyword">null</span> || !casBase(b = base, b + x)) &#123;           <span class="hljs-keyword">boolean</span> uncontended = <span class="hljs-keyword">true</span>;           <span class="hljs-keyword">if</span> (as == <span class="hljs-keyword">null</span> || (m = as.length - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> ||               (a = as[getProbe() &amp; m]) == <span class="hljs-keyword">null</span> ||               !(uncontended = a.cas(v = a.value, v + x)))               longAccumulate(x, <span class="hljs-keyword">null</span>, uncontended);       &#125;   &#125;</code></pre></div><p><strong>ç´¯åŠ æµç¨‹å›¾</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png" alt="img"></a></p><h2 id="9ã€Unsafe"><a href="#9ã€Unsafe" class="headerlink" title="9ã€Unsafe"></a>9ã€Unsafe</h2><p>Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡<strong>åå°„</strong>è·å¾—</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetUnsafe</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException </span>&#123;        <span class="hljs-comment">// é€šè¿‡åå°„è·å¾—Unsafeå¯¹è±¡</span>        Class unsafeClass = Unsafe.class;        <span class="hljs-comment">// è·å¾—æ„é€ å‡½æ•°ï¼ŒUnsafeçš„æ„é€ å‡½æ•°ä¸ºç§æœ‰çš„</span>        Constructor constructor = unsafeClass.getDeclaredConstructor();        <span class="hljs-comment">// è®¾ç½®ä¸ºå…è®¸è®¿é—®ç§æœ‰å†…å®¹</span>        constructor.setAccessible(<span class="hljs-keyword">true</span>);        <span class="hljs-comment">// åˆ›å»ºUnsafeå¯¹è±¡</span>        Unsafe unsafe = (Unsafe) constructor.newInstance();        <span class="hljs-comment">// åˆ›å»ºPersonå¯¹è±¡</span>        Person person = <span class="hljs-keyword">new</span> Person();        <span class="hljs-comment">// è·å¾—å…¶å±æ€§ name çš„åç§»é‡</span>        Field field = Person.class.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>);        <span class="hljs-keyword">long</span> offset = unsafe.objectFieldOffset(field);        <span class="hljs-comment">// é€šè¿‡unsafeçš„CASæ“ä½œæ”¹å˜å€¼</span>        unsafe.compareAndSwapObject(person, offset, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;OOOOh&quot;</span>);        System.out.println(person);    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;    <span class="hljs-comment">// é…åˆCASæ“ä½œï¼Œå¿…é¡»ç”¨volatileä¿®é¥°</span>     <span class="hljs-keyword">volatile</span> String name;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;&#125;</code></pre></div><p><strong>è‡ªå®šä¹‰AcomicDataå®ç°ä¹‹å‰çº¿ç¨‹å®‰å…¨çš„åŸå­æ•´æ•°Accountå®ç°</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpksjiq4abj30u00uh7cm.jpg" alt="image-20210415221945212"></p><p>Account å®ç°</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpkskfabo3j30tg0eyacp.jpg" alt="image-20210415222036997"></p><h1 id="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"><a href="#å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜" class="headerlink" title="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"></a>å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜</h1><h3 id="1ã€ä¸å¯å˜"><a href="#1ã€ä¸å¯å˜" class="headerlink" title="1ã€ä¸å¯å˜"></a>1ã€ä¸å¯å˜</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨<strong>ä¸èƒ½å¤Ÿä¿®</strong>æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸å­˜åœ¨å¹¶å‘ä¿®æ”¹ã€‚</p><h3 id="2ã€ä¸å¯å˜è®¾è®¡"><a href="#2ã€ä¸å¯å˜è®¾è®¡" class="headerlink" title="2ã€ä¸å¯å˜è®¾è®¡"></a>2ã€ä¸å¯å˜è®¾è®¡</h3><h4 id="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"><a href="#Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°" class="headerlink" title="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"></a>Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span></span><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span>, <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">String</span>&gt;, <span class="hljs-title">CharSequence</span> </span>&#123;    <span class="hljs-comment">/** The value is used for character storage. */</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span> value[];    <span class="hljs-comment">/** Cache the hash code for the string */</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> hash; <span class="hljs-comment">// Default to 0</span>   <span class="hljs-comment">//....</span>  &#125;&#125;</code></pre></div><p>**ï¬nal çš„ä½¿ç”¨ **<br>å‘ç°è¯¥ç±»ã€ç±»ä¸­æ‰€æœ‰å±æ€§éƒ½æ˜¯ <strong>ï¬nal</strong>çš„</p><ul><li>å±æ€§ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹ </li><li>ç±»ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œ<strong>é˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§</strong></li></ul><p>**ä¿æŠ¤æ€§æ‹·è´ **</p><p>ä½†æœ‰åŒå­¦ä¼šè¯´ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›è·Ÿä¿®æ”¹ç›¸å…³çš„æ–¹æ³•å•Šï¼Œæ¯”å¦‚ substring ç­‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€çœ‹è¿™äº›æ–¹æ³•æ˜¯ å¦‚ä½•å®ç°çš„ï¼Œå°±ä»¥ substring ä¸ºä¾‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">substring</span><span class="hljs-params">(<span class="hljs-keyword">int</span> beginIndex)</span> </span>&#123;        <span class="hljs-keyword">if</span> (beginIndex &lt; <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(beginIndex);        &#125;        <span class="hljs-keyword">int</span> subLen = value.length - beginIndex;        <span class="hljs-keyword">if</span> (subLen &lt; <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(subLen);        &#125;        <span class="hljs-comment">//è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡</span>        <span class="hljs-keyword">return</span> (beginIndex == <span class="hljs-number">0</span>) ? <span class="hljs-keyword">this</span> : <span class="hljs-keyword">new</span> String(value, beginIndex, subLen);    &#125;</code></pre></div><p>å‘ç°å…¶å†…éƒ¨æ˜¯è°ƒç”¨ String çš„æ„é€ æ–¹æ³•<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-keyword">char</span> value[], <span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> count)</span> </span>&#123;        <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(offset);        &#125;        <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>) &#123;                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(count);            &#125;            <span class="hljs-keyword">if</span> (offset &lt;= value.length) &#123;                <span class="hljs-keyword">this</span>.value = <span class="hljs-string">&quot;&quot;</span>.value;                <span class="hljs-keyword">return</span>;            &#125;        &#125;        <span class="hljs-comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span>        <span class="hljs-keyword">if</span> (offset &gt; value.length - count) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(offset + count);        &#125;        <span class="hljs-keyword">this</span>.value = Arrays. OfRange(value, offset, offset+count);    &#125;Cop</code></pre></div><p>æ„é€ æ–°å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ char[] valueï¼Œå¯¹å†…å®¹è¿›è¡Œå¤åˆ¶ ã€‚è¿™ç§é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡æ¥é¿å…å…±äº«çš„æ‰‹æ®µç§°ä¹‹ä¸ºã€<strong>ä¿æŠ¤æ€§æ‹·è´</strong>ï¼ˆdefensive  ï¼‰ã€‘</p><h3 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h3><blockquote><p>Flyweight patternæ˜¯ä¸€ä¸ªé€šè¿‡ä¸å…¶ä»–ç±»ä¼¼å¯¹è±¡å…±äº«å°½å¯èƒ½å¤šçš„æ•°æ®æ¥æœ€å°åŒ–å†…å­˜ä½¿ç”¨çš„å¯¹è±¡</p></blockquote><h6 id="è‡ªå·±DIYä¸€ä¸ª"><a href="#è‡ªå·±DIYä¸€ä¸ª" class="headerlink" title="è‡ªå·±DIYä¸€ä¸ª"></a>è‡ªå·±DIYä¸€ä¸ª</h6><p>ä¾‹å¦‚ï¼šä¸€ä¸ªçº¿ä¸Šå•†åŸåº”ç”¨ï¼ŒQPS è¾¾åˆ°æ•°åƒï¼Œå¦‚æœæ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºå’Œå…³é—­æ•°æ®åº“è¿æ¥ï¼Œæ€§èƒ½ä¼šå—åˆ°æå¤§å½±å“ã€‚ è¿™æ—¶ é¢„å…ˆåˆ›å»ºå¥½ä¸€æ‰¹è¿æ¥ï¼Œæ”¾å…¥è¿æ¥æ± ã€‚ä¸€æ¬¡è¯·æ±‚åˆ°è¾¾åï¼Œä»è¿æ¥æ± è·å–è¿æ¥ï¼Œä½¿ç”¨å®Œæ¯•åå†è¿˜å›è¿æ¥æ± ï¼Œè¿™æ ·æ—¢èŠ‚çº¦ äº†è¿æ¥çš„åˆ›å»ºå’Œå…³é—­æ—¶é—´ï¼Œä¹Ÿå®ç°äº†è¿æ¥çš„é‡ç”¨ï¼Œä¸è‡³äºè®©åºå¤§çš„è¿æ¥æ•°å‹å®æ•°æ®åº“ã€‚</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pool</span> </span>&#123;<span class="hljs-comment">// 1. è¿æ¥æ± å¤§å° </span>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> poolSize;<span class="hljs-comment">// 2. è¿æ¥å¯¹è±¡æ•°ç»„ </span>  <span class="hljs-keyword">private</span> Connection[] connections;<span class="hljs-comment">// 3. è¿æ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™ </span>  <span class="hljs-keyword">private</span> AtomicIntegerArray states;<span class="hljs-comment">// 4. æ„é€ æ–¹æ³•åˆå§‹åŒ– </span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Pool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> poolSize)</span> </span>&#123;<span class="hljs-keyword">this</span>.poolSize = poolSize;     <span class="hljs-keyword">this</span>.connections = <span class="hljs-keyword">new</span> Connection[poolSize];     <span class="hljs-keyword">this</span>.states = <span class="hljs-keyword">new</span> AtomicIntegerArray(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[poolSize]);     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;       connections[i] = <span class="hljs-keyword">new</span> MockConnection(<span class="hljs-string">&quot;è¿æ¥&quot;</span> + (i+<span class="hljs-number">1</span>));     &#125;&#125;  <span class="hljs-comment">// 5. å€Ÿè¿æ¥ </span>  <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">borrow</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;           <span class="hljs-comment">// è·å–ç©ºé—²è¿æ¥ </span>          <span class="hljs-keyword">if</span>(states.get(i) == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">if</span> (states.compareAndSet(i, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;           log.debug(<span class="hljs-string">&quot;borrow &#123;&#125;&quot;</span>, connections[i]);                 <span class="hljs-keyword">return</span> connections[i];             &#125;           &#125;&#125;     <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾… </span>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<span class="hljs-keyword">try</span> &#123;           log.debug(<span class="hljs-string">&quot;wait...&quot;</span>);           <span class="hljs-keyword">this</span>.wait();         &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();         &#125;&#125;&#125;&#125;  <span class="hljs-comment">// 6. å½’è¿˜è¿æ¥ </span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">free</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;           <span class="hljs-keyword">if</span> (connections[i] == conn) &#123;             states.set(i, <span class="hljs-number">0</span>);             <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;              log.debug(<span class="hljs-string">&quot;free &#123;&#125;&quot;</span>, conn);               <span class="hljs-keyword">this</span>.notifyAll();             &#125;             <span class="hljs-keyword">break</span>;&#125;&#125;&#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Connection</span> </span>&#123;   <span class="hljs-comment">// å®ç°ç•¥ </span>&#125;</code></pre></div><p>ä½¿ç”¨è¿æ¥æ± ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">Pool pool = <span class="hljs-keyword">new</span> Pool(<span class="hljs-number">2</span>); <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;     Connection conn = pool.borrow();     <span class="hljs-keyword">try</span> &#123;       Thread.sleep(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>));    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;       e.printStackTrace();     &#125;     pool.free(conn);   &#125;).start();&#125;</code></pre></div><p>ä»¥ä¸Šå®ç°æ²¡æœ‰è€ƒè™‘ï¼š</p><ul><li>è¿æ¥çš„åŠ¨æ€å¢é•¿ä¸æ”¶ç¼© </li><li>è¿æ¥ä¿æ´»ï¼ˆå¯ç”¨æ€§æ£€æµ‹ï¼‰ </li><li>ç­‰å¾…è¶…æ—¶å¤„ç† </li><li>åˆ†å¸ƒå¼ hash</li></ul><p>å¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼Œæœ‰æ¯”è¾ƒæˆç†Ÿçš„è¿æ¥æ± å®ç°ï¼Œä¾‹å¦‚c3p0, druidç­‰ å¯¹äºæ›´é€šç”¨çš„å¯¹è±¡æ± ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨apache commons poolï¼Œä¾‹å¦‚redisè¿æ¥æ± å¯ä»¥å‚è€ƒjedisä¸­å…³äºè¿æ¥æ± çš„å®ç°</p><h1 id="ä¸ƒã€çº¿ç¨‹æ± "><a href="#ä¸ƒã€çº¿ç¨‹æ± " class="headerlink" title="ä¸ƒã€çº¿ç¨‹æ± "></a>ä¸ƒã€çº¿ç¨‹æ± </h1><h2 id="1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± </h2><h3 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png" alt="img"></a></p><ul><li>é˜»å¡é˜Ÿåˆ—ä¸­ç»´æŠ¤äº†ç”±ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…å…¶ä»–çº¿ç¨‹ï¼‰æ‰€äº§ç”Ÿçš„çš„ä»»åŠ¡</li><li>ä¸»çº¿ç¨‹ç±»ä¼¼äº<strong>ç”Ÿäº§è€…</strong>ï¼Œäº§ç”Ÿä»»åŠ¡å¹¶æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­</li><li>çº¿ç¨‹æ± ç±»ä¼¼äº<strong>æ¶ˆè´¹è€…</strong>ï¼Œå¾—åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„ä»»åŠ¡å¹¶æ‰§è¡Œ</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      ThreadPool threadPool = <span class="hljs-keyword">new</span> ThreadPool(<span class="hljs-number">2</span>,  TimeUnit.SECONDS, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;         threadPool.execute(()-&gt;&#123;            <span class="hljs-keyword">try</span> &#123;               TimeUnit.SECONDS.sleep(<span class="hljs-number">10000</span>);            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;               e.printStackTrace();            &#125;            System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ!&quot;</span>);         &#125;);      &#125;   &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * è‡ªå®šä¹‰çº¿ç¨‹æ± </span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPool</span> </span>&#123;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * è‡ªå®šä¹‰é˜»å¡é˜Ÿåˆ—</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> BlockingQueue&lt;Runnable&gt; blockingQueue;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * æ ¸å¿ƒçº¿ç¨‹æ•°</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> coreSize;   <span class="hljs-keyword">private</span> HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();   <span class="hljs-comment">/**</span><span class="hljs-comment">    * ç”¨äºæŒ‡å®šçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> TimeUnit timeUnit;   <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> timeout;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * å·¥ä½œçº¿ç¨‹ç±»</span><span class="hljs-comment">    * å†…éƒ¨å°è£…äº†Threadç±»ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€äº›å±æ€§</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>&#123;      Runnable task;      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Worker</span><span class="hljs-params">(Runnable task)</span> </span>&#123;         System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–ä»»åŠ¡&quot;</span>);         <span class="hljs-keyword">this</span>.task = task;      &#125;      <span class="hljs-meta">@Override</span>      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;         <span class="hljs-comment">// å¦‚æœæœ‰ä»»åŠ¡å°±æ‰§è¡Œ</span>         <span class="hljs-comment">// å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œå°±ç»§ç»­æ‰§è¡Œ</span>         <span class="hljs-keyword">while</span> (task != <span class="hljs-keyword">null</span> || (task = blockingQueue.take()) != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">try</span> &#123;               System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œä»»åŠ¡&quot;</span>);               task.run();            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;               e.printStackTrace();            &#125; <span class="hljs-keyword">finally</span> &#123;               <span class="hljs-comment">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè®¾ä¸ºç©º</span>               System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&quot;</span>);               task = <span class="hljs-keyword">null</span>;            &#125;         &#125;         <span class="hljs-comment">// ç§»é™¤ä»»åŠ¡</span>         <span class="hljs-keyword">synchronized</span> (workers) &#123;            System.out.println(<span class="hljs-string">&quot;ç§»é™¤ä»»åŠ¡&quot;</span>);            workers.remove(<span class="hljs-keyword">this</span>);         &#125;      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> coreSize, TimeUnit timeUnit, <span class="hljs-keyword">long</span> timeout, <span class="hljs-keyword">int</span> capacity)</span> </span>&#123;      <span class="hljs-keyword">this</span>.coreSize = coreSize;      <span class="hljs-keyword">this</span>.timeUnit = timeUnit;      blockingQueue = <span class="hljs-keyword">new</span> BlockingQueue&lt;&gt;(capacity);      <span class="hljs-keyword">this</span>.timeout = timeout;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable task)</span> </span>&#123;      <span class="hljs-keyword">synchronized</span> (workers) &#123;         <span class="hljs-comment">// åˆ›å»ºä»»åŠ¡</span>         <span class="hljs-comment">// æ± ä¸­è¿˜æœ‰ç©ºä½™çº¿ç¨‹æ—¶ï¼Œå¯ä»¥è¿è¡Œä»»åŠ¡</span>         <span class="hljs-comment">// å¦åˆ™é˜»å¡</span>         <span class="hljs-keyword">if</span> (workers.size() &lt; coreSize) &#123;            Worker worker = <span class="hljs-keyword">new</span> Worker(task);            workers.add(worker);            worker.start();         &#125; <span class="hljs-keyword">else</span> &#123;            System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ± ä¸­çº¿ç¨‹å·²ç”¨å®Œï¼Œè¯·ç¨ç­‰&quot;</span>);            blockingQueue.put(task);         &#125;      &#125;   &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * é˜»å¡é˜Ÿåˆ—</span><span class="hljs-comment"> * ç”¨äºå­˜æ”¾ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹äº§ç”Ÿçš„ä»»åŠ¡</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlockingQueue</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * é˜»å¡é˜Ÿåˆ—</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span>  Deque&lt;T&gt; blockingQueue;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * é˜»å¡é˜Ÿåˆ—å®¹é‡</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * é”</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> ReentrantLock lock;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * æ¡ä»¶é˜Ÿåˆ—</span><span class="hljs-comment">    */</span>   <span class="hljs-keyword">private</span> Condition fullQueue;   <span class="hljs-keyword">private</span> Condition emptyQueue;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BlockingQueue</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;      blockingQueue = <span class="hljs-keyword">new</span> ArrayDeque&lt;&gt;(capacity);      lock = <span class="hljs-keyword">new</span> ReentrantLock();      fullQueue = lock.newCondition();      emptyQueue = lock.newCondition();      <span class="hljs-keyword">this</span>.capacity = capacity;   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * è·å–ä»»åŠ¡çš„æ–¹æ³•</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">take</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-comment">// åŠ é”</span>      lock.lock();      <span class="hljs-keyword">try</span> &#123;         <span class="hljs-comment">// å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼ˆæ²¡æœ‰ä»»åŠ¡ï¼‰ï¼Œå°±ä¸€ç›´ç­‰å¾…</span>         <span class="hljs-keyword">while</span> (blockingQueue.isEmpty()) &#123;            <span class="hljs-keyword">try</span> &#123;               emptyQueue.await();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;               e.printStackTrace();            &#125;         &#125;         <span class="hljs-comment">// è·å–ä»»åŠ¡å¹¶å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹</span>         T task = blockingQueue.removeFirst();         fullQueue.signalAll();         <span class="hljs-keyword">return</span> task;      &#125; <span class="hljs-keyword">finally</span> &#123;         lock.unlock();      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">takeNanos</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> </span>&#123;      <span class="hljs-comment">// è½¬æ¢ç­‰å¾…æ—¶é—´</span>      lock.lock();      <span class="hljs-keyword">try</span> &#123;         <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);         <span class="hljs-keyword">while</span> (blockingQueue.isEmpty()) &#123;            <span class="hljs-keyword">try</span> &#123;               <span class="hljs-comment">// awaitNanosä¼šè¿”å›å‰©ä¸‹çš„ç­‰å¾…æ—¶é—´</span>               nanos = emptyQueue.awaitNanos(nanos);               <span class="hljs-keyword">if</span> (nanos &lt; <span class="hljs-number">0</span>) &#123;                  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;               &#125;            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;               e.printStackTrace();            &#125;         &#125;         T task = blockingQueue.removeFirst();         fullQueue.signalAll();         <span class="hljs-keyword">return</span> task;      &#125; <span class="hljs-keyword">finally</span> &#123;         lock.unlock();      &#125;   &#125;   <span class="hljs-comment">/**</span><span class="hljs-comment">    * æ”¾å…¥ä»»åŠ¡çš„æ–¹æ³•</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> task æ”¾å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡</span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(T task)</span> </span>&#123;      lock.lock();      <span class="hljs-keyword">try</span> &#123;         <span class="hljs-keyword">while</span> (blockingQueue.size() == capacity) &#123;            <span class="hljs-keyword">try</span> &#123;               System.out.println(<span class="hljs-string">&quot;é˜»å¡é˜Ÿåˆ—å·²æ»¡&quot;</span>);               fullQueue.await();            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;               e.printStackTrace();            &#125;         &#125;         blockingQueue.add(task);         <span class="hljs-comment">// å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…</span>         emptyQueue.signalAll();      &#125; <span class="hljs-keyword">finally</span> &#123;         lock.unlock();      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> </span>&#123;      lock.lock();      <span class="hljs-keyword">try</span> &#123;         <span class="hljs-keyword">return</span> blockingQueue.size();      &#125; <span class="hljs-keyword">finally</span> &#123;         lock.unlock();      &#125;   &#125;&#125;</code></pre></div><p>å®ç°äº†ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± </p><ul><li>é˜»å¡é˜Ÿåˆ—BlockingQueueç”¨äºæš‚å­˜æ¥ä¸åŠè¢«çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡<ul><li>ä¹Ÿå¯ä»¥è¯´æ˜¯å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œé€Ÿåº¦ä¸Šçš„å·®å¼‚</li><li>é‡Œé¢çš„è·å–ä»»åŠ¡å’Œæ”¾å…¥ä»»åŠ¡ç”¨åˆ°äº†<strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</strong></li></ul></li><li>çº¿ç¨‹æ± ä¸­å¯¹çº¿ç¨‹Threadè¿›è¡Œäº†å†æ¬¡çš„å°è£…ï¼Œå°è£…ä¸ºäº†Worker<ul><li>åœ¨è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šå»æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åè¿˜ä¼š<strong>åˆ°é˜»å¡é˜Ÿåˆ—ä¸­è·å–æ–°ä»»åŠ¡æ¥æ‰§è¡Œ</strong></li></ul></li><li>çº¿ç¨‹æ± ä¸­æ‰§è¡Œä»»åŠ¡çš„ä¸»è¦æ–¹æ³•ä¸ºexecuteæ–¹æ³•<ul><li>æ‰§è¡Œæ—¶è¦åˆ¤æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¦å¤§äºäº†çº¿ç¨‹æ± å®¹é‡</li></ul></li></ul><h2 id="2ã€ThreadPoolExecutor"><a href="#2ã€ThreadPoolExecutor" class="headerlink" title="2ã€ThreadPoolExecutor"></a>2ã€ThreadPoolExecutor</h2><h3 id="ç»§æ‰¿å…³ç³»"><a href="#ç»§æ‰¿å…³ç³»" class="headerlink" title="ç»§æ‰¿å…³ç³»"></a>ç»§æ‰¿å…³ç³»</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png" alt="img"></a></p><h3 id="çº¿ç¨‹æ± çŠ¶æ€"><a href="#çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€"></a>çº¿ç¨‹æ± çŠ¶æ€</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€</span><span class="hljs-comment">// runState is stored in the high-order bits</span><span class="hljs-comment">// RUNNING é«˜3ä½ä¸º111</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RUNNING    = -<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<span class="hljs-comment">// SHUTDOWN é«˜3ä½ä¸º000</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SHUTDOWN   =  <span class="hljs-number">0</span> &lt;&lt; COUNT_BITS;<span class="hljs-comment">// é«˜3ä½ 001</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STOP       =  <span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<span class="hljs-comment">// é«˜3ä½ 010</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TIDYING    =  <span class="hljs-number">2</span> &lt;&lt; COUNT_BITS;<span class="hljs-comment">// é«˜3ä½ 011</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TERMINATED =  <span class="hljs-number">3</span> &lt;&lt; COUNT_BITS;</code></pre></div><table><thead><tr><th>çŠ¶æ€åç§°</th><th>é«˜3ä½çš„å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>RUNNING</td><td>111</td><td>æ¥æ”¶æ–°ä»»åŠ¡ï¼ŒåŒæ—¶å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>SHUTDOWN</td><td>000</td><td>ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>STOP</td><td>001</td><td>ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>TIDYING</td><td>010</td><td>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º0æ—¶ï¼Œå³å°†è¿›å…¥ç»ˆç»“é˜¶æ®µ</td></tr><tr><td>TERMINATED</td><td>011</td><td>ç»ˆç»“çŠ¶æ€</td></tr></tbody></table><p>çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡<strong>ç”±ä¸€ä¸ªåŸå­æ•´å‹ctlæ¥å…±åŒè¡¨ç¤º</strong></p><ul><li>ä½¿ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºä¸¤ä¸ªå€¼çš„ä¸»è¦åŸå› æ˜¯ï¼š<strong>å¯ä»¥é€šè¿‡ä¸€æ¬¡CASåŒæ—¶æ›´æ”¹ä¸¤ä¸ªå±æ€§çš„å€¼</strong></li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// åŸå­æ•´æ•°ï¼Œå‰3ä½ä¿å­˜äº†çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå‰©ä½™ä½ä¿å­˜çš„æ˜¯çº¿ç¨‹æ•°é‡</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger ctl = <span class="hljs-keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="hljs-number">0</span>));<span class="hljs-comment">// å¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°çš„intéƒ½æ˜¯32ä½ã€‚</span><span class="hljs-comment">// å»æ‰å‰ä¸‰ä½ä¿å­˜çº¿ç¨‹çŠ¶æ€çš„ä½æ•°ï¼Œå‰©ä¸‹çš„ç”¨äºä¿å­˜çº¿ç¨‹æ•°é‡</span><span class="hljs-comment">// é«˜3ä½ä¸º0ï¼Œå‰©ä½™ä½æ•°å…¨ä¸º1</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="hljs-number">3</span>;<span class="hljs-comment">// 2^COUNT_BITSæ¬¡æ–¹ï¼Œè¡¨ç¤ºå¯ä»¥ä¿å­˜çš„æœ€å¤§çº¿ç¨‹æ•°</span><span class="hljs-comment">// CAPACITY çš„é«˜3ä½ä¸º 0</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAPACITY   = (<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS) - <span class="hljs-number">1</span>;</code></pre></div><p>è·å–çº¿ç¨‹æ± çŠ¶æ€ã€çº¿ç¨‹æ•°é‡ä»¥åŠåˆå¹¶ä¸¤ä¸ªå€¼çš„æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Packing and unpacking ctl</span><span class="hljs-comment">// è·å–è¿è¡ŒçŠ¶æ€</span><span class="hljs-comment">// è¯¥æ“ä½œä¼šè®©é™¤é«˜3ä½ä»¥å¤–çš„æ•°å…¨éƒ¨å˜ä¸º0</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">runStateOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span>     </span>&#123; <span class="hljs-keyword">return</span> c &amp; ~CAPACITY; &#125;<span class="hljs-comment">// è·å–è¿è¡Œçº¿ç¨‹æ•°</span><span class="hljs-comment">// è¯¥æ“ä½œä¼šè®©é«˜3ä½ä¸º0</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">workerCountOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span>  </span>&#123; <span class="hljs-keyword">return</span> c &amp; CAPACITY; &#125;<span class="hljs-comment">// è®¡ç®—ctlæ–°å€¼</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ctlOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rs, <span class="hljs-keyword">int</span> wc)</span> </span>&#123; <span class="hljs-keyword">return</span> rs | wc; &#125;</code></pre></div><h3 id="çº¿ç¨‹æ± å±æ€§"><a href="#çº¿ç¨‹æ± å±æ€§" class="headerlink" title="çº¿ç¨‹æ± å±æ€§"></a>çº¿ç¨‹æ± å±æ€§</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å·¥ä½œçº¿ç¨‹ï¼Œå†…éƒ¨å°è£…äº†Thread</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span></span><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span></span><span class="hljs-class">        <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;    ...&#125;<span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾æ¥ä¸åŠè¢«æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;<span class="hljs-comment">// é”</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">new</span> ReentrantLock();<span class="hljs-comment">//  ç”¨äºå­˜æ”¾æ ¸å¿ƒçº¿ç¨‹çš„å®¹å™¨ï¼Œåªæœ‰å½“æŒæœ‰é”æ—¶æ‰èƒ½å¤Ÿè·å–å…¶ä¸­çš„å…ƒç´ ï¼ˆæ ¸å¿ƒçº¿ç¨‹ï¼‰</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> HashSet&lt;Worker&gt;();</code></pre></div><h3 id="æ„é€ æ–¹æ³•æå…¶å‚æ•°"><a href="#æ„é€ æ–¹æ³•æå…¶å‚æ•°" class="headerlink" title="æ„é€ æ–¹æ³•æå…¶å‚æ•°"></a>æ„é€ æ–¹æ³•æå…¶å‚æ•°</h3><p><strong>ThreadPoolExecutoræœ€å…¨é¢çš„æ„é€ æ–¹æ³•</strong></p><p>ä¹Ÿæ˜¯æ„é€ è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><span class="hljs-function"><span class="hljs-params">                          ThreadFactory threadFactory,</span></span><span class="hljs-function"><span class="hljs-params">                          RejectedExecutionHandler handler)</span> </span></code></pre></div><h4 id="å‚æ•°è§£é‡Š"><a href="#å‚æ•°è§£é‡Š" class="headerlink" title="å‚æ•°è§£é‡Š"></a><strong>å‚æ•°è§£é‡Š</strong></h4><ul><li>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°</li><li>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°<ul><li>maximumPoolSize - corePoolSize = æ•‘æ€¥çº¿ç¨‹æ•°</li></ul></li><li>keepAliveTimeï¼šæ•‘æ€¥çº¿ç¨‹ç©ºé—²æ—¶çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´</li><li>unitï¼šæ—¶é—´å•ä½</li><li>workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼ˆå­˜æ”¾ä»»åŠ¡ï¼‰<ul><li>æœ‰ç•Œé˜»å¡é˜Ÿåˆ— ArrayBlockingQueue</li><li>æ— ç•Œé˜»å¡é˜Ÿåˆ— LinkedBlockingQueue</li><li>æœ€å¤šåªæœ‰ä¸€ä¸ªåŒæ­¥å…ƒç´ çš„ SynchronousQueue</li><li>ä¼˜å…ˆé˜Ÿåˆ— PriorityBlockingQueue</li></ul></li><li>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼ˆç»™çº¿ç¨‹å–åå­—ï¼‰</li><li>handlerï¼šæ‹’ç»ç­–ç•¥</li></ul><h4 id="å·¥ä½œæ–¹å¼"><a href="#å·¥ä½œæ–¹å¼" class="headerlink" title="å·¥ä½œæ–¹å¼"></a>å·¥ä½œæ–¹å¼</h4><ul><li>å½“ä¸€ä¸ªä»»åŠ¡ä¼ ç»™çº¿ç¨‹æ± ä»¥åï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½<ul><li>å°†ä»»åŠ¡åˆ†é…ç»™ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œ</li><li>æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå°†ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—workQueueä¸­ç­‰å¾…è¢«æ‰§è¡Œ</li><li><strong>é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä½¿ç”¨æ•‘æ€¥çº¿ç¨‹</strong>æ¥æ‰§è¡Œä»»åŠ¡<ul><li>æ•‘æ€¥çº¿ç¨‹ç”¨å®Œä»¥åï¼Œè¶…è¿‡ç”Ÿå­˜æ—¶é—´ï¼ˆkeepAliveTimeï¼‰åä¼šè¢«é‡Šæ”¾</li></ul></li><li>ä»»åŠ¡æ€»æ•°å¤§äºäº† æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ä¸é˜»å¡é˜Ÿåˆ—å®¹é‡çš„æœ€å¤§å€¼ï¼ˆworkQueue.capacityï¼‰ï¼Œä½¿ç”¨æ‹’æ¥ç­–ç•¥</li></ul></li></ul><h4 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h4><p>å¦‚æœçº¿ç¨‹åˆ°è¾¾ maximumPoolSize ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œ<strong>æ‹’ç»ç­–ç•¥</strong>ã€‚æ‹’ç»ç­–ç•¥ jdk æä¾›äº† 4 ç§å®ç°</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png" alt="img"></a></p><ul><li>AbortPolicyï¼šè®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œ<strong>è¿™æ˜¯é»˜è®¤ç­–ç•¥</strong></li><li>CallerRunsPolicyï¼šè®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡</li><li>DiscardPolicyï¼šæ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡</li><li>DiscardOldestPolicyï¼šæ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹</li></ul><h4 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;   <span class="hljs-keyword">static</span> AtomicInteger threadId = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-comment">// æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span>      <span class="hljs-comment">// åˆ›å»ºæœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span>      ArrayBlockingQueue&lt;Runnable&gt; runnable = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="hljs-number">10</span>);      <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹å·¥å‚</span>      ThreadFactory threadFactory = <span class="hljs-keyword">new</span> ThreadFactory() &#123;         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> Thread <span class="hljs-title">newThread</span><span class="hljs-params">(Runnable r)</span> </span>&#123;            Thread thread = <span class="hljs-keyword">new</span> Thread(r, <span class="hljs-string">&quot;working_thread_&quot;</span>+threadId.getAndIncrement());            <span class="hljs-keyword">return</span> thread;         &#125;      &#125;;      <span class="hljs-comment">// æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span>      <span class="hljs-comment">// æ‹’ç»ç­–ç•¥é‡‡ç”¨é»˜è®¤ç­–ç•¥</span>      ThreadPoolExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS, runnable, threadFactory);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;         executor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;               System.out.println(Thread.currentThread());               <span class="hljs-keyword">try</span> &#123;                  Thread.sleep(<span class="hljs-number">100000</span>);               &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                  e.printStackTrace();               &#125;            &#125;         &#125;);      &#125;   &#125;&#125;</code></pre></div><h3 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//æ²¡æœ‰æ•‘æ€¥çº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFixedThreadPool</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚</span>      ThreadFactory factory = <span class="hljs-keyword">new</span> ThreadFactory() &#123;         AtomicInteger atomicInteger = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">1</span>);         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> Thread <span class="hljs-title">newThread</span><span class="hljs-params">(Runnable r)</span> </span>&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Thread(r, <span class="hljs-string">&quot;myPool_&quot;</span> + atomicInteger.getAndIncrement());         &#125;      &#125;;      <span class="hljs-comment">// åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º2çš„çº¿ç¨‹æ± </span>      <span class="hljs-comment">// é€šè¿‡ ThreadFactoryå¯ä»¥ç»™çº¿ç¨‹æ·»åŠ åå­—</span>      ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">2</span>, factory);      <span class="hljs-comment">// ä»»åŠ¡</span>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            System.out.println(Thread.currentThread().getName());            System.out.println(<span class="hljs-string">&quot;this is fixedThreadPool&quot;</span>);         &#125;      &#125;;      executorService.execute(runnable);   &#125;&#125;</code></pre></div><p>å›ºå®šå¤§å°çš„çº¿ç¨‹æ± å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°</p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šnThreads</li><li>çº¿ç¨‹å·¥å‚ï¼šthreadFactory</li></ul><p>å†…éƒ¨è°ƒç”¨çš„æ„é€ æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java">ThreadPoolExecutor(nThreads, nThreads,                              <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,                              <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),                              threadFactory);</code></pre></div><h3 id="CachedThreadPool"><a href="#CachedThreadPool" class="headerlink" title="CachedThreadPool"></a>CachedThreadPool</h3><div class="hljs code-wrapper"><pre><code class="hljs java">ExecutorService executorService = Executors.newCachedThreadPool();</code></pre></div><p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">ThreadPoolExecutor(<span class="hljs-number">0</span>, Integer.MAX_VALUE,                              <span class="hljs-number">60L</span>, TimeUnit.SECONDS,                              <span class="hljs-keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</code></pre></div><ul><li><p>æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œ<strong>æ‰€æœ‰åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹</strong>ï¼Œç©ºé—²æ—¶ç”Ÿå­˜æ—¶é—´ä¸º60ç§’</p></li><li><p>é˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯SynchronousQueue</p><ul><li>SynchronousQueueæ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—<ul><li><strong>æ²¡æœ‰å®¹é‡</strong>ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„</li><li>åªæœ‰å½“çº¿ç¨‹å–ä»»åŠ¡æ—¶ï¼Œæ‰ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜»å¡é˜Ÿåˆ—ä¸­</li></ul></li></ul></li></ul><h3 id="SingleThread"><a href="#SingleThread" class="headerlink" title="SingleThread"></a>SingleThread</h3><div class="hljs code-wrapper"><pre><code class="hljs java">ExecutorService service = Executors.newSingleThreadExecutor();</code></pre></div><p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">new</span> FinalizableDelegatedExecutorService    (<span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,                            <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,                            <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</code></pre></div><p>å†…éƒ¨è°ƒç”¨äº†<strong>new ThreadPoolExecutor</strong>çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥çš„corePoolSizeå’ŒmaximumPoolSizeéƒ½ä¸º1ã€‚ç„¶åå°†è¯¥å¯¹è±¡ä¼ ç»™äº†FinalizableDelegatedExecutorServiceã€‚è¯¥ç±»ä¿®é¥°äº†ThreadPoolExecutorï¼Œè®©å¤–éƒ¨æ— æ³•è°ƒç”¨ThreadPoolExecutorå†…éƒ¨çš„æŸäº›æ–¹æ³•æ¥ä¿®æ”¹æ‰€åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°ã€‚</p><h4 id="å‡ ä¸ªæ³¨æ„"><a href="#å‡ ä¸ªæ³¨æ„" class="headerlink" title="å‡ ä¸ªæ³¨æ„"></a>å‡ ä¸ªæ³¨æ„</h4><ul><li><p>SingleThreadå’Œè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œå¤šä¸ªä»»åŠ¡çš„åŒºåˆ«</p><ul><li>å½“çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ï¼Œè¯¥ä»»åŠ¡å’Œå‰©ä½™çš„ä»»åŠ¡å°±æ— æ³•å†ç»§ç»­è¿è¡Œä¸‹å»ã€‚è€Œ<strong>SingleThreadä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­å‰©ä½™çš„ä»»åŠ¡</strong>ã€‚</li></ul></li><li><p>SingleThreadå’ŒnewFixedThreadPool(1)çš„åŒºåˆ«</p><ul><li>newFixedThreadPool(1)ä¼ å€¼ä¸º1ï¼Œå¯ä»¥å°†FixedThreadPoolå¼ºè½¬ä¸ºThreadPoolExecutorï¼Œç„¶åé€šè¿‡setCorePoolSizeæ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å¼ºè½¬ä¸ºThreadPoolExecutor</span>ThreadPoolExecutor threadPool = (ThreadPoolExecutor) Executors.newFixedThreadPool(<span class="hljs-number">1</span>);<span class="hljs-comment">// æ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</span>threadPool.setCorePoolSize(<span class="hljs-number">2</span>);</code></pre></div><ul><li>è€ŒSingleThreadæ— æ³•ä¿®æ”¹æ ¸å¿ƒçº¿ç¨‹æ•°</li></ul></li></ul><h3 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h3><h4 id="execute-æ–¹æ³•"><a href="#execute-æ–¹æ³•" class="headerlink" title="execute()æ–¹æ³•"></a>execute()æ–¹æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java">execute(Runnable command)</code></pre></div><p>ä¼ å…¥ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œæ‰§è¡Œå…¶ä¸­çš„runæ–¹æ³•</p><p><strong>æºç è§£æ</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;    <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();    <span class="hljs-comment">// è·å–ctl</span>    <span class="hljs-keyword">int</span> c = ctl.get();    <span class="hljs-comment">// åˆ¤æ–­å½“å‰å¯ç”¨çš„çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span>    <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;        <span class="hljs-comment">// ä¸ºè¯¥ä»»åŠ¡åˆ†é…çº¿ç¨‹</span>        <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-keyword">true</span>))            <span class="hljs-comment">// åˆ†é…æˆåŠŸå°±è¿”å›</span>            <span class="hljs-keyword">return</span>;        <span class="hljs-comment">// åˆ†é…å¤±è´¥å†æ¬¡è·å–ctl</span>        c = ctl.get();    &#125;    <span class="hljs-comment">// åˆ†é…å’Œä¿¡æ¯çº¿ç¨‹å¤±è´¥ä»¥å</span>    <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºRUNNINGå¹¶ä¸”æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—æˆåŠŸ</span>    <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;        <span class="hljs-comment">// åŒé‡æ£€æµ‹ï¼Œå¯èƒ½åœ¨æ·»åŠ åçº¿ç¨‹æ± çŠ¶æ€å˜ä¸ºäº†éRUNNING</span>        <span class="hljs-keyword">int</span> recheck = ctl.get();        <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGï¼Œåˆ™ä¸ä¼šæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡</span>        <span class="hljs-comment">// å°†è¯¥ä»»åŠ¡ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»é™¤</span>        <span class="hljs-keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))            <span class="hljs-comment">// è°ƒç”¨æ‹’ç»ç­–ç•¥ï¼Œæ‹’ç»è¯¥ä»»åŠ¡çš„æ‰§è¡Œ</span>            reject(command);        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</span>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)            <span class="hljs-comment">// å°±åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡</span>            addWorker(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);    &#125;    <span class="hljs-comment">// å¦‚æœæ·»åŠ å¤±è´¥äº†ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œå°±è°ƒç”¨æ‹’ç»ç­–ç•¥</span>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-keyword">false</span>))        reject(command);&#125;</code></pre></div><p>å…¶ä¸­è°ƒç”¨äº†**addWoker()**æ–¹æ³•ï¼Œå†çœ‹çœ‹çœ‹è¿™ä¸ªæ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addWorker</span><span class="hljs-params">(Runnable firstTask, <span class="hljs-keyword">boolean</span> core)</span> </span>&#123;    retry:    <span class="hljs-keyword">for</span> (;;) &#123;        <span class="hljs-keyword">int</span> c = ctl.get();        <span class="hljs-keyword">int</span> rs = runStateOf(c);        <span class="hljs-comment">// Check if queue empty only if necessary.</span>        <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGçŠ¶æ€ã€çº¿ç¨‹æ± ä¸ºSHUTDOWNä¸”è¯¥ä»»åŠ¡ä¸ºç©º æˆ–è€…é˜»å¡é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä»»åŠ¡</span>        <span class="hljs-keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;            ! (rs == SHUTDOWN &amp;&amp;               firstTask == <span class="hljs-keyword">null</span> &amp;&amp;               ! workQueue.isEmpty()))            <span class="hljs-comment">// åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥</span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        <span class="hljs-keyword">for</span> (;;) &#123;            <span class="hljs-comment">// è·å¾—å½“å‰å·¥ä½œçº¿ç¨‹æ•°</span>            <span class="hljs-keyword">int</span> wc = workerCountOf(c);            <span class="hljs-comment">// å‚æ•°ä¸­ core ä¸ºtrue</span>            <span class="hljs-comment">// CAPACITY ä¸º 1 &lt;&lt; COUNT_BITS-1ï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡</span>            <span class="hljs-comment">// å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å¤§äºäº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºå¤±è´¥</span>            <span class="hljs-keyword">if</span> (wc &gt;= CAPACITY ||                wc &gt;= (core ? corePoolSize : maximumPoolSize))                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            <span class="hljs-comment">// é€šè¿‡CASæ“ä½œæ”¹å˜cçš„å€¼</span>            <span class="hljs-keyword">if</span> (compareAndIncrementWorkerCount(c))                <span class="hljs-comment">// æ›´æ”¹æˆåŠŸå°±è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”ä¸å†è¿è¡Œå¾ªç¯</span>                <span class="hljs-keyword">break</span> retry;            <span class="hljs-comment">// æ›´æ”¹å¤±è´¥ï¼Œé‡æ–°è·å–ctlçš„å€¼</span>            c = ctl.get();  <span class="hljs-comment">// Re-read ctl</span>            <span class="hljs-keyword">if</span> (runStateOf(c) != rs)                <span class="hljs-comment">// è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”é‡æ–°è¿›å…¥å¾ªç¯</span>                <span class="hljs-keyword">continue</span> retry;            <span class="hljs-comment">// else CAS failed due to workerCount change; retry inner loop</span>        &#125;    &#125;    <span class="hljs-comment">// ç”¨äºæ ‡è®°workä¸­çš„ä»»åŠ¡æ˜¯å¦æˆåŠŸæ‰§è¡Œ</span>    <span class="hljs-keyword">boolean</span> workerStarted = <span class="hljs-keyword">false</span>;    <span class="hljs-comment">// ç”¨äºæ ‡è®°workeræ˜¯å¦æˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ä¸­</span>    <span class="hljs-keyword">boolean</span> workerAdded = <span class="hljs-keyword">false</span>;    Worker w = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">// åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</span>        w = <span class="hljs-keyword">new</span> Worker(firstTask);        <span class="hljs-keyword">final</span> Thread t = w.thread;        <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;            <span class="hljs-comment">// åŠ é”</span>            mainLock.lock();            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">// Recheck while holding lock.</span>                <span class="hljs-comment">// Back out on ThreadFactory failure or if</span>                <span class="hljs-comment">// shut down before lock acquired.</span>                <span class="hljs-comment">// åŠ é”çš„åŒæ—¶å†æ¬¡æ£€æµ‹</span>                <span class="hljs-comment">// é¿å…åœ¨é‡Šæ”¾é”ä¹‹å‰è°ƒç”¨äº†shut down</span>                <span class="hljs-keyword">int</span> rs = runStateOf(ctl.get());                <span class="hljs-keyword">if</span> (rs &lt; SHUTDOWN ||                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class="hljs-keyword">null</span>)) &#123;                    <span class="hljs-keyword">if</span> (t.isAlive()) <span class="hljs-comment">// precheck that t is startable</span>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalThreadStateException();                    <span class="hljs-comment">// å°†çº¿ç¨‹æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­</span>                    workers.add(w);                    <span class="hljs-keyword">int</span> s = workers.size();                    <span class="hljs-keyword">if</span> (s &gt; largestPoolSize)                        largestPoolSize = s;                    <span class="hljs-comment">// æ·»åŠ æˆåŠŸæ ‡å¿—ä½å˜ä¸ºtrue</span>                    workerAdded = <span class="hljs-keyword">true</span>;                &#125;            &#125; <span class="hljs-keyword">finally</span> &#123;                mainLock.unlock();            &#125;            <span class="hljs-comment">// å¦‚æœworkeræˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ï¼Œå°±æ‰§è¡Œå…¶ä¸­çš„ä»»åŠ¡</span>            <span class="hljs-keyword">if</span> (workerAdded) &#123;                t.start();                <span class="hljs-comment">// å¯åŠ¨æˆåŠŸ</span>                workerStarted = <span class="hljs-keyword">true</span>;            &#125;        &#125;    &#125; <span class="hljs-keyword">finally</span> &#123;        <span class="hljs-comment">// å¦‚æœæ‰§è¡Œå¤±è´¥</span>        <span class="hljs-keyword">if</span> (! workerStarted)            <span class="hljs-comment">// è°ƒç”¨æ·»åŠ å¤±è´¥çš„å‡½æ•°</span>            addWorkerFailed(w);    &#125;    <span class="hljs-keyword">return</span> workerStarted;&#125;</code></pre></div><h4 id="submit-æ–¹æ³•"><a href="#submit-æ–¹æ³•" class="headerlink" title="submit()æ–¹æ³•"></a>submit()æ–¹æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span> </span></code></pre></div><p>ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡ï¼Œç”¨Futureæ¥<strong>æ•è·è¿”å›å€¼</strong></p><p><strong>ä½¿ç”¨</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡submitæ‰§è¡ŒCallableä¸­çš„callæ–¹æ³•</span><span class="hljs-comment">// é€šè¿‡Futureæ¥æ•è·è¿”å›å€¼</span>Future&lt;String&gt; future = threadPool.submit(<span class="hljs-keyword">new</span> Callable&lt;String&gt;() &#123;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello submit&quot;</span>;   &#125;&#125;);<span class="hljs-comment">// æŸ¥çœ‹æ•è·çš„è¿”å›å€¼</span>System.out.println(future.get());</code></pre></div><h4 id="invokeAll-æ–¹æ³•"><a href="#invokeAll-æ–¹æ³•" class="headerlink" title="invokeAll()æ–¹æ³•"></a>invokeAll()æ–¹æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ </span>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)   <span class="hljs-keyword">throws</span> InterruptedException;</code></pre></div><h4 id="invokeAny-æ–¹æ³•"><a href="#invokeAny-æ–¹æ³•" class="headerlink" title="invokeAny()æ–¹æ³•"></a>invokeAny()æ–¹æ³•</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›æ­¤ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆ </span>&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span><span class="hljs-function"></span><span class="hljs-function"><span class="hljs-keyword">throws</span> InterruptedException, ExecutionException</span>;</code></pre></div><h3 id="å…³é—­çº¿ç¨‹æ± "><a href="#å…³é—­çº¿ç¨‹æ± " class="headerlink" title="å…³é—­çº¿ç¨‹æ± "></a>å…³é—­çº¿ç¨‹æ± </h3><h4 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown()"></a>shutdown()</h4><p>çº¿ç¨‹æ± çŠ¶æ€å˜ä¸ºSHUTDOWN</p><ul><li>ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡</li><li>ä½†å·²æäº¤ä»»åŠ¡ä¼šæ‰§è¡Œå®Œ</li><li>æ­¤æ–¹æ³•ä¸ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œ</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º SHUTDOWN</span><span class="hljs-comment">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œ</span><span class="hljs-comment">*/</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;    mainLock.lock();    <span class="hljs-keyword">try</span> &#123;        checkShutdownAccess();        <span class="hljs-comment">// ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN</span>        advanceRunState(SHUTDOWN);          <span class="hljs-comment">// ä¸­æ–­ç©ºé—²çº¿ç¨‹ï¼ˆæ²¡æœ‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼‰</span>        <span class="hljs-comment">// Idleï¼šç©ºé—²çš„</span>        interruptIdleWorkers();        onShutdown(); <span class="hljs-comment">// hook for ScheduledThreadPoolExecutor</span>    &#125; <span class="hljs-keyword">finally</span> &#123;        mainLock.unlock();    &#125;    <span class="hljs-comment">// å°è¯•ç»ˆç»“ï¼Œä¸ä¸€å®šæˆåŠŸ</span>    tryTerminate();&#125; <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryTerminate</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">for</span> (;;) &#123;        <span class="hljs-keyword">int</span> c = ctl.get();        <span class="hljs-comment">// ç»ˆç»“å¤±è´¥çš„æ¡ä»¶</span>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸ºRUNNING</span>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸º RUNNING SHUTDOWN STOP ï¼ˆçŠ¶æ€å€¼å¤§äºTIDYINGï¼‰</span>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œä½†é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ç­‰å¾…æ‰§è¡Œ</span>        <span class="hljs-keyword">if</span> (isRunning(c) ||            runStateAtLeast(c, TIDYING) ||            (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))            <span class="hljs-keyword">return</span>;        <span class="hljs-comment">// å¦‚æœæ´»è·ƒçº¿ç¨‹æ•°ä¸ä¸º0</span>        <span class="hljs-keyword">if</span> (workerCountOf(c) != <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// Eligible to terminate</span>            <span class="hljs-comment">// ä¸­æ–­ç©ºé—²çº¿ç¨‹</span>            interruptIdleWorkers(ONLY_ONE);            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;        mainLock.lock();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">// å¤„äºå¯ä»¥ç»ˆç»“çš„çŠ¶æ€</span>            <span class="hljs-comment">// é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTIDYING</span>            <span class="hljs-keyword">if</span> (ctl.compareAndSet(c, ctlOf(TIDYING, <span class="hljs-number">0</span>))) &#123;                <span class="hljs-keyword">try</span> &#123;                    terminated();                &#125; <span class="hljs-keyword">finally</span> &#123;                    <span class="hljs-comment">// é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTERMINATED</span>                    ctl.set(ctlOf(TERMINATED, <span class="hljs-number">0</span>));                    termination.signalAll();                &#125;                <span class="hljs-keyword">return</span>;            &#125;        &#125; <span class="hljs-keyword">finally</span> &#123;            mainLock.unlock();        &#125;        <span class="hljs-comment">// else retry on failed CAS</span>    &#125;&#125;</code></pre></div><h4 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow()"></a>shutdownNow()</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º STOP</span><span class="hljs-comment">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span><span class="hljs-comment">* ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­æœªæ‰§è¡Œçš„ä»»åŠ¡è¿”å›ç»™è°ƒç”¨è€…</span><span class="hljs-comment">*/</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span><span class="hljs-params">()</span> </span>&#123;    List&lt;Runnable&gt; tasks;    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;    mainLock.lock();    <span class="hljs-keyword">try</span> &#123;        checkShutdownAccess();        <span class="hljs-comment">// ä¿®æ”¹çŠ¶æ€ä¸ºSTOPï¼Œä¸æ‰§è¡Œä»»ä½•ä»»åŠ¡</span>        advanceRunState(STOP);        <span class="hljs-comment">// ä¸­æ–­æ‰€æœ‰çº¿ç¨‹</span>        interruptWorkers();        <span class="hljs-comment">// å°†æœªæ‰§è¡Œçš„ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œç„¶åè¿”å›ç»™è°ƒç”¨è€…</span>        tasks = drainQueue();    &#125; <span class="hljs-keyword">finally</span> &#123;        mainLock.unlock();    &#125;    <span class="hljs-comment">// å°è¯•ç»ˆç»“ï¼Œä¸€å®šä¼šæˆåŠŸï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ºç©ºäº†</span>    tryTerminate();    <span class="hljs-keyword">return</span> tasks;&#125;</code></pre></div><h2 id="3ã€åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± "><a href="#3ã€åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± " class="headerlink" title="3ã€åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± "></a>3ã€åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± </h2><ul><li>è¿‡å°ä¼šå¯¼è‡´ç¨‹åºä¸èƒ½å……åˆ†åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å®¹æ˜“å¯¼è‡´é¥¥é¥¿ </li><li>è¿‡å¤§ä¼šå¯¼è‡´æ›´å¤šçš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå ç”¨æ›´å¤šå†…å­˜</li></ul><h4 id="CPU-å¯†é›†å‹è¿ç®—"><a href="#CPU-å¯†é›†å‹è¿ç®—" class="headerlink" title="CPU å¯†é›†å‹è¿ç®—"></a>CPU å¯†é›†å‹è¿ç®—</h4><p>é€šå¸¸é‡‡ç”¨<code>cpuæ ¸æ•°+1</code>èƒ½å¤Ÿå®ç°æœ€ä¼˜çš„CPUåˆ©ç”¨ç‡ï¼Œ+1æ˜¯ä¿è¯å½“çº¿ç¨‹ç”±äºé¡µç¼ºå¤±æ•…éšœï¼ˆæ“ä½œç³»ç»Ÿï¼‰æˆ–å…¶å®ƒåŸå› å¯¼è‡´æš‚åœæ—¶ï¼Œé¢å¤–çš„è¿™ä¸ªçº¿ç¨‹å°±èƒ½é¡¶ä¸Šå»ï¼Œä¿è¯CPUæ—¶é’Ÿå‘¨æœŸä¸è¢«æµªè´¹</p><h4 id="I-O-å¯†é›†å‹è¿ç®—"><a href="#I-O-å¯†é›†å‹è¿ç®—" class="headerlink" title="I/O å¯†é›†å‹è¿ç®—"></a>I/O å¯†é›†å‹è¿ç®—</h4><p>CPUä¸æ€»æ˜¯å¤„äºç¹å¿™çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå½“ä½ æ‰§è¡Œä¸šåŠ¡è®¡ç®—æ—¶ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨CPUèµ„æºï¼Œä½†å½“ä½ æ‰§è¡ŒI/Oæ“ä½œæ—¶ã€è¿œç¨‹RPCè°ƒç”¨æ—¶ï¼ŒåŒ…æ‹¬è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™CPUå°±é—²ä¸‹æ¥äº†ï¼Œä½ å¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æé«˜å®ƒçš„åˆ©ç”¨ç‡ã€‚</p><p>ç»éªŒå…¬å¼å¦‚ä¸‹</p><p><code>çº¿ç¨‹æ•° = æ ¸æ•° * æœŸæœ› CPU åˆ©ç”¨ç‡ * æ€»æ—¶é—´(CPUè®¡ç®—æ—¶é—´+ç­‰å¾…æ—¶é—´) / CPU è®¡ç®—æ—¶é—´</code></p><p>ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 50% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 50%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼</p><p><code>4 * 100% * 100% / 50% = 8</code></p><p>ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 10% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 90%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼</p><p><code>4 * 100% * 100% / 10% = 40</code></p><h2 id="4ã€Tomcatçº¿ç¨‹æ± "><a href="#4ã€Tomcatçº¿ç¨‹æ± " class="headerlink" title="4ã€Tomcatçº¿ç¨‹æ± "></a>4ã€Tomcatçº¿ç¨‹æ± </h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplpdijconj31ag0bmdkl.jpg" alt="image-20210416171541056"></p><ul><li>LimitLatchç”¨æ¥é™æµï¼Œå¯ä»¥æ§åˆ¶æœ€å¤§è¿æ¥ä¸ªæ•°ï¼Œç±»ä¼¼J.U.Cä¸­çš„Semaphoreåé¢å†è®²</li><li>Acceptoråªè´Ÿè´£ã€æ¥æ”¶æ–°çš„socketè¿æ¥ã€‘</li><li>Polleråªè´Ÿè´£ç›‘å¬socketchannelæ˜¯å¦æœ‰ã€å¯è¯»çš„I/Oäº‹ä»¶ã€‘</li><li>ä¸€æ—¦å¯è¯»ï¼Œå°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼ˆsocketProcessorï¼‰ï¼Œæäº¤ç»™Executorçº¿ç¨‹æ± å¤„ç†</li><li>Executorçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æœ€ç»ˆè´Ÿè´£ã€å¤„ç†è¯·æ±‚ã€‘</li></ul><p><strong>Tomcat çº¿ç¨‹æ± æ‰©å±•äº† ThreadPoolExecutorï¼Œè¡Œä¸ºç¨æœ‰ä¸åŒ</strong></p><ul><li>å¦‚æœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize<ul><li>è¿™æ—¶ä¸ä¼šç«‹åˆ»æŠ› RejectedExecutionException å¼‚å¸¸ </li><li>è€Œæ˜¯å†æ¬¡å°è¯•å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æœè¿˜å¤±è´¥ï¼Œæ‰æŠ›å‡º RejectedExecutionException å¼‚å¸¸</li></ul></li></ul><p>æºç  tomcat-7.0.42</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command, <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> </span>&#123;submittedCount.incrementAndGet();   <span class="hljs-keyword">try</span> &#123;<span class="hljs-keyword">super</span>.execute(command);   &#125; <span class="hljs-keyword">catch</span> (RejectedExecutionException rx) &#123;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">super</span>.getQueue() <span class="hljs-keyword">instanceof</span> TaskQueue) &#123;<span class="hljs-keyword">final</span> TaskQueue queue = (TaskQueue)<span class="hljs-keyword">super</span>.getQueue();<span class="hljs-keyword">try</span> &#123;             <span class="hljs-keyword">if</span> (!queue.force(command, timeout, unit)) &#123;            submittedCount.decrementAndGet();             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RejectedExecutionException(<span class="hljs-string">&quot;Queue capacity is full.&quot;</span>);           &#125;&#125; <span class="hljs-keyword">catch</span> (InterruptedException x) &#123;             submittedCount.decrementAndGet();            Thread.interrupted();             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RejectedExecutionException(x);&#125;      &#125; <span class="hljs-keyword">else</span> &#123;         submittedCount.decrementAndGet();         <span class="hljs-keyword">throw</span> rx;       &#125;&#125;&#125;</code></pre></div><p>Connector é…ç½®</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplpsby8wnj31d00fiwhd.jpg" alt="image-20210416172958903"></p><p>Executor çº¿ç¨‹é…ç½®</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplpsqz78uj31d40kiwir.jpg" alt="image-20210416173023391"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplptha33fj319a0c876b.jpg" alt="image-20210416173104274"></p><h2 id="5ã€Fork-Join"><a href="#5ã€Fork-Join" class="headerlink" title="5ã€Fork/Join"></a>5ã€Fork/Join</h2><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul><li>Fork/Join æ˜¯ JDK 1.7 åŠ å…¥çš„æ–°çš„çº¿ç¨‹æ± å®ç°ï¼Œå®ƒä½“ç°çš„æ˜¯ä¸€ç§åˆ†æ²»æ€æƒ³ï¼Œé€‚ç”¨äºèƒ½å¤Ÿè¿›è¡Œä»»åŠ¡æ‹†åˆ†çš„ cpu å¯†é›†å‹è¿ç®— </li><li>æ‰€è°“çš„ä»»åŠ¡æ‹†åˆ†ï¼Œæ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºç®—æ³•ä¸Šç›¸åŒçš„å°ä»»åŠ¡ï¼Œç›´è‡³ä¸èƒ½æ‹†åˆ†å¯ä»¥ç›´æ¥æ±‚è§£ã€‚è·Ÿé€’å½’ç›¸å…³çš„ä¸€äº›è®¡ç®—ï¼Œå¦‚å½’å¹¶æ’åºã€æ–æ³¢é‚£å¥‘æ•°åˆ—ã€éƒ½å¯ä»¥ç”¨åˆ†æ²»æ€æƒ³è¿›è¡Œæ±‚è§£ </li><li>Fork/Join åœ¨åˆ†æ²»çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¤šçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ¯ä¸ªä»»åŠ¡çš„åˆ†è§£å’Œåˆå¹¶äº¤ç»™ä¸åŒçš„çº¿ç¨‹æ¥å®Œæˆï¼Œè¿›ä¸€æ­¥æå‡äº†è¿ç®—æ•ˆç‡ </li><li>Fork/Join é»˜è®¤ä¼šåˆ›å»ºä¸ cpu æ ¸å¿ƒæ•°å¤§å°ç›¸åŒçš„çº¿ç¨‹æ± </li></ul><h4 id="ä½¿ç”¨-3"><a href="#ä½¿ç”¨-3" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>æäº¤ç»™Fork/Joinçº¿ç¨‹æ± çš„ä»»åŠ¡éœ€è¦ç»§æ‰¿RecursiveTaskï¼ˆæœ‰è¿”å›å€¼ï¼‰æˆ–RecursiveActionï¼ˆæ²¡æœ‰è¿”å›å€¼ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå¯¹1~nä¹‹é—´çš„æ•´æ•°æ±‚å’Œçš„ä»»åŠ¡</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplpzqfow9j30u00zpthz.jpg" alt="image-20210416173704832"></p><p>ç„¶åæäº¤ç»™ ForkJoinPool æ¥æ‰§è¡Œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;   ForkJoinPool pool = <span class="hljs-keyword">new</span> ForkJoinPool(<span class="hljs-number">4</span>);   System.out.println(pool.invoke(<span class="hljs-keyword">new</span> AddTask1(<span class="hljs-number">5</span>))); &#125;</code></pre></div><div class="hljs code-wrapper"><pre><code class="hljs java">[ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">0</span>] - fork() <span class="hljs-number">2</span> + &#123;<span class="hljs-number">1</span>&#125; [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">1</span>] - fork() <span class="hljs-number">5</span> + &#123;<span class="hljs-number">4</span>&#125; [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">0</span>] - join() <span class="hljs-number">1</span> [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">0</span>] - join() <span class="hljs-number">2</span> + &#123;<span class="hljs-number">1</span>&#125; = <span class="hljs-number">3</span> [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">2</span>] - fork() <span class="hljs-number">4</span> + &#123;<span class="hljs-number">3</span>&#125; [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">3</span>] - fork() <span class="hljs-number">3</span> + &#123;<span class="hljs-number">2</span>&#125; [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">3</span>] - join() <span class="hljs-number">3</span> + &#123;<span class="hljs-number">2</span>&#125; = <span class="hljs-number">6</span> [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">2</span>] - join() <span class="hljs-number">4</span> + &#123;<span class="hljs-number">3</span>&#125; = <span class="hljs-number">10</span> [ForkJoinPool-<span class="hljs-number">1</span>-worker-<span class="hljs-number">1</span>] - join() <span class="hljs-number">5</span> + &#123;<span class="hljs-number">4</span>&#125; = <span class="hljs-number">15</span> <span class="hljs-number">15</span></code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpltkmas1yj31d00dggnq.jpg" alt="image-20210416194057872"></p><h1 id="å…«ã€J-U-C"><a href="#å…«ã€J-U-C" class="headerlink" title="å…«ã€J.U.C"></a>å…«ã€J.U.C</h1><h2 id="1ã€AQS"><a href="#1ã€AQS" class="headerlink" title="1ã€AQS"></a>1ã€AQS</h2><h4 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><p>ç”¨ state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆåˆ†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼‰ï¼Œå­ç±»éœ€è¦å®šä¹‰å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œæ§åˆ¶å¦‚ä½•è·å–é”å’Œé‡Šæ”¾é”</p><ul><li>getState - è·å– state çŠ¶æ€ </li><li>setState - è®¾ç½® state çŠ¶æ€ </li><li>compareAndSetState - cas æœºåˆ¶è®¾ç½® state çŠ¶æ€ </li><li>ç‹¬å æ¨¡å¼æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œè€Œå…±äº«æ¨¡å¼å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æº </li></ul></li><li><p>æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äº Monitor çš„ EntryList </p></li><li><p>æ¡ä»¶å˜é‡æ¥å®ç°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äº Monitor çš„ WaitSet</p></li></ul><p><strong>å­ç±»ä¸»è¦å®ç°è¿™æ ·ä¸€äº›æ–¹æ³•</strong>ï¼ˆé»˜è®¤æŠ›å‡º UnsupportedOperationExceptionï¼‰</p><ul><li>tryAcquire </li><li>tryRelease </li><li>tryAcquireShared </li><li>tryReleaseShared </li><li>isHeldExclusively</li></ul><p>è·å–é”çš„å§¿åŠ¿</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å¦‚æœè·å–é”å¤±è´¥ </span><span class="hljs-keyword">if</span> (!tryAcquire(arg)) &#123;   <span class="hljs-comment">// å…¥é˜Ÿ, å¯ä»¥é€‰æ‹©é˜»å¡å½“å‰çº¿ç¨‹ park unpark</span>&#125;</code></pre></div><p>é‡Šæ”¾é”çš„å§¿åŠ¿</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// å¦‚æœé‡Šæ”¾é”æˆåŠŸ </span><span class="hljs-keyword">if</span> (tryRelease(arg)) &#123;   <span class="hljs-comment">// è®©é˜»å¡çº¿ç¨‹æ¢å¤è¿è¡Œ </span>&#125;</code></pre></div><h4 id="å®ç°ä¸å¯é‡å…¥é”"><a href="#å®ç°ä¸å¯é‡å…¥é”" class="headerlink" title="å®ç°ä¸å¯é‡å…¥é”"></a>å®ç°ä¸å¯é‡å…¥é”</h4><p>è‡ªå®šä¹‰é”</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰é”ï¼ˆä¸å¯é‡å…¥é”ï¼‰</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lock</span> </span>&#123;    <span class="hljs-comment">// ç‹¬å é”  åŒæ­¥å™¨ç±»</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> </span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryAcquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;            <span class="hljs-keyword">if</span>(compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;                <span class="hljs-comment">// åŠ ä¸Šäº†é”ï¼Œå¹¶è®¾ç½® owner ä¸ºå½“å‰çº¿ç¨‹</span>                setExclusiveOwnerThread(Thread.currentThread());                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryRelease</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;            setExclusiveOwnerThread(<span class="hljs-keyword">null</span>);            setState(<span class="hljs-number">0</span>);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;        <span class="hljs-meta">@Override</span> <span class="hljs-comment">// æ˜¯å¦æŒæœ‰ç‹¬å é”</span>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHeldExclusively</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">1</span>;        &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConditionObject();        &#125;    &#125;    <span class="hljs-keyword">private</span> MySync sync = <span class="hljs-keyword">new</span> MySync();    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// åŠ é”ï¼ˆä¸æˆåŠŸä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼‰</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;        sync.acquire(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// åŠ é”ï¼Œå¯æ‰“æ–­</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        sync.acquireInterruptibly(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// å°è¯•åŠ é”ï¼ˆä¸€æ¬¡ï¼‰</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// å°è¯•åŠ é”ï¼Œå¸¦è¶…æ—¶</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, unit.toNanos(time));    &#125;    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// è§£é”</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;        sync.release(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// åˆ›å»ºæ¡ä»¶å˜é‡</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> sync.newCondition();    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestAqs</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        MyLock lock = <span class="hljs-keyword">new</span> MyLock();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            lock.lock();            <span class="hljs-keyword">try</span> &#123;                log.debug(<span class="hljs-string">&quot;locking...&quot;</span>);                sleep(<span class="hljs-number">1</span>);            &#125; <span class="hljs-keyword">finally</span> &#123;                log.debug(<span class="hljs-string">&quot;unlocking...&quot;</span>);                lock.unlock();            &#125;        &#125;,<span class="hljs-string">&quot;t1&quot;</span>).start();        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;            lock.lock();            <span class="hljs-keyword">try</span> &#123;                log.debug(<span class="hljs-string">&quot;locking...&quot;</span>);            &#125; <span class="hljs-keyword">finally</span> &#123;                log.debug(<span class="hljs-string">&quot;unlocking...&quot;</span>);                lock.unlock();            &#125;        &#125;,<span class="hljs-string">&quot;t2&quot;</span>).start();    &#125;&#125;</code></pre></div><p>è¾“å‡º</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">22</span>:<span class="hljs-number">29</span>:<span class="hljs-number">28.727</span> c.TestAqs [t1] - locking... <span class="hljs-number">22</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29.732</span> c.TestAqs [t1] - unlocking... <span class="hljs-number">22</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29.732</span> c.TestAqs [t2] - locking... <span class="hljs-number">22</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29.732</span> c.TestAqs [t2] - unlocking...</code></pre></div><p>ä¸å¯é‡å…¥æµ‹è¯•</p><p>å¦‚æœæ”¹ä¸ºä¸‹é¢ä»£ç ï¼Œä¼šå‘ç°è‡ªå·±ä¹Ÿä¼šè¢«æŒ¡ä½ï¼ˆåªä¼šæ‰“å°ä¸€æ¬¡ lockingï¼‰</p><div class="hljs code-wrapper"><pre><code class="hljs java">lock.lock(); log.debug(<span class="hljs-string">&quot;locking...&quot;</span>); lock.lock(); log.debug(<span class="hljs-string">&quot;locking...&quot;</span>);</code></pre></div><h4 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h4><p>æ—©æœŸç¨‹åºå‘˜ä¼šè‡ªå·±é€šè¿‡ä¸€ç§åŒæ­¥å™¨å»å®ç°å¦ä¸€ç§ç›¸è¿‘çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ç”¨å¯é‡å…¥é”å»å®ç°ä¿¡å·é‡ï¼Œæˆ–åä¹‹ã€‚è¿™æ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼Œäºæ˜¯åœ¨JSR166ï¼ˆjavaè§„èŒƒææ¡ˆï¼‰ä¸­åˆ›å»ºäº†AQSï¼Œæä¾›äº†è¿™ç§é€šç”¨çš„åŒæ­¥å™¨æœºåˆ¶ã€‚</p><p><strong>ç›®æ ‡</strong></p><p>AQS è¦å®ç°çš„åŠŸèƒ½ç›®æ ‡</p><ul><li>é˜»å¡ç‰ˆæœ¬è·å–é” acquire å’Œéé˜»å¡çš„ç‰ˆæœ¬å°è¯•è·å–é” tryAcquire </li><li>è·å–é”è¶…æ—¶æœºåˆ¶</li><li>é€šè¿‡æ‰“æ–­å–æ¶ˆæœºåˆ¶ </li><li>ç‹¬å æœºåˆ¶åŠå…±äº«æœºåˆ¶ </li><li>æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„ç­‰å¾…æœºåˆ¶</li></ul><h4 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h4><p>AQS çš„åŸºæœ¬æ€æƒ³å…¶å®å¾ˆç®€å•</p><p>è·å–é”çš„é€»è¾‘</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(state çŠ¶æ€ä¸å…è®¸è·å–) &#123;   <span class="hljs-keyword">if</span>(é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰æ­¤çº¿ç¨‹) &#123;    å…¥é˜Ÿå¹¶é˜»å¡   &#125; &#125; å½“å‰çº¿ç¨‹å‡ºé˜Ÿ</code></pre></div><p>é‡Šæ”¾é”çš„é€»è¾‘</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(state çŠ¶æ€å…è®¸äº†) &#123;   æ¢å¤é˜»å¡çš„çº¿ç¨‹(s) &#125;</code></pre></div><p>è¦ç‚¹</p><ul><li>åŸå­ç»´æŠ¤ state çŠ¶æ€ </li><li>é˜»å¡åŠæ¢å¤çº¿ç¨‹ </li><li>ç»´æŠ¤é˜Ÿåˆ—</li></ul><p><strong>(1)stateè®¾è®¡</strong></p><ul><li>state ä½¿ç”¨ volatile é…åˆ cas ä¿è¯å…¶ä¿®æ”¹æ—¶çš„åŸå­æ€§ </li><li>state ä½¿ç”¨äº† 32bit int æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºå½“æ—¶ä½¿ç”¨ long åœ¨å¾ˆå¤šå¹³å°ä¸‹æµ‹è¯•çš„ç»“æœå¹¶ä¸ç†æƒ³</li></ul><p><strong>(2)é˜»å¡æ¢å¤è®¾è®¡</strong></p><ul><li>æ—©æœŸçš„æ§åˆ¶çº¿ç¨‹æš‚åœå’Œæ¢å¤çš„ api æœ‰ suspend å’Œ resumeï¼Œä½†å®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºå¦‚æœå…ˆè°ƒç”¨çš„ resume é‚£ä¹ˆ suspend å°†æ„ŸçŸ¥ä¸åˆ°</li><li>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ park &amp; unpark æ¥å®ç°çº¿ç¨‹çš„æš‚åœå’Œæ¢å¤ï¼Œå…·ä½“åŸç†åœ¨ä¹‹å‰è®²è¿‡äº†ï¼Œå…ˆ unpark å† park ä¹Ÿæ²¡é—®é¢˜ </li><li>park &amp; unpark æ˜¯é’ˆå¯¹çº¿ç¨‹çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŒæ­¥å™¨çš„ï¼Œå› æ­¤æ§åˆ¶ç²’åº¦æ›´ä¸ºç²¾ç»†</li><li>park çº¿ç¨‹è¿˜å¯ä»¥é€šè¿‡ interrupt æ‰“æ–­</li></ul><p><strong>(3)é˜Ÿåˆ—è®¾è®¡</strong></p><ul><li>ä½¿ç”¨äº† FIFO å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¹¶ä¸æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ— </li><li>è®¾è®¡æ—¶å€Ÿé‰´äº† CLH é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§å•å‘æ— é”é˜Ÿåˆ—</li></ul><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gplus4v425j30p60rsjto.jpg" alt="image-20210416202245564" style="zoom:50%;" /><p>é˜Ÿåˆ—ä¸­æœ‰ head å’Œ tail ä¸¤ä¸ªæŒ‡é’ˆèŠ‚ç‚¹ï¼Œéƒ½ç”¨ volatile ä¿®é¥°é…åˆ cas ä½¿ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ state ç»´æŠ¤èŠ‚ç‚¹çŠ¶æ€ </p><p>å…¥é˜Ÿä¼ªä»£ç ï¼Œåªéœ€è¦è€ƒè™‘ tail èµ‹å€¼çš„åŸå­æ€§</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">do</span> &#123;<span class="hljs-comment">// åŸæ¥çš„ tail </span> Node prev = tail; <span class="hljs-comment">// ç”¨ cas åœ¨åŸæ¥ tail çš„åŸºç¡€ä¸Šæ”¹ä¸º node </span>&#125; <span class="hljs-keyword">while</span>(tail.compareAndSet(prev, node))</code></pre></div><p>å‡ºé˜Ÿä¼ªä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// prev æ˜¯ä¸Šä¸€ä¸ªèŠ‚ç‚¹ </span><span class="hljs-keyword">while</span>((Node prev=node.prev).state != å”¤é†’çŠ¶æ€) &#123; &#125; <span class="hljs-comment">// è®¾ç½®å¤´èŠ‚ç‚¹ </span>head = node;</code></pre></div><p>CLH å¥½å¤„ï¼š</p><ul><li>æ— é”ï¼Œä½¿ç”¨è‡ªæ—‹</li><li>å¿«é€Ÿï¼Œæ— é˜»å¡</li></ul><p>AQS åœ¨ä¸€äº›æ–¹é¢æ”¹è¿›äº† CLH</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> Node <span class="hljs-title">enq</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node)</span> </span>&#123;<span class="hljs-keyword">for</span> (;;) &#123;       Node t = tail;      <span class="hljs-comment">// é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰å…ƒç´  tail ä¸º null </span>      <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>) &#123;         <span class="hljs-comment">// å°† head ä» null -&gt; dummy </span>        <span class="hljs-keyword">if</span> (compareAndSetHead(<span class="hljs-keyword">new</span> Node()))           tail = head;       &#125;<span class="hljs-keyword">else</span>&#123;         <span class="hljs-comment">// å°† node çš„ prev è®¾ç½®ä¸ºåŸæ¥çš„ tail </span>        node.prev = t;         <span class="hljs-comment">// å°† tail ä»åŸæ¥çš„ tail è®¾ç½®ä¸º node </span>        <span class="hljs-keyword">if</span> (compareAndSetTail(t, node)) &#123;           <span class="hljs-comment">// åŸæ¥ tail çš„ next è®¾ç½®ä¸º node </span>          t.next = node;           <span class="hljs-keyword">return</span> t;         &#125;&#125;&#125;&#125;</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpluy79sipj31fe0k048c.jpg" alt="image-20210416202836479"></p><h2 id="2ã€ReentranLock"><a href="#2ã€ReentranLock" class="headerlink" title="2ã€ReentranLock"></a>2ã€ReentranLock</h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1uh4accj30vs0fudir.jpg" alt="image-20210418175513322"></p><h3 id="éå…¬å¹³é”å®ç°åŸç†"><a href="#éå…¬å¹³é”å®ç°åŸç†" class="headerlink" title="éå…¬å¹³é”å®ç°åŸç†"></a><strong>éå…¬å¹³é”å®ç°åŸç†</strong></h3><p><strong>åŠ é”è§£é”æµç¨‹</strong></p><p>å…ˆä»æ„é€ å™¨å¼€å§‹çœ‹ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”å®ç°</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReentrantLock</span><span class="hljs-params">()</span> </span>&#123;   sync = <span class="hljs-keyword">new</span> NonfairSync(); &#125;</code></pre></div><p>NonfairSync ç»§æ‰¿è‡ª AQS</p><p>æ²¡æœ‰ç«äº‰æ—¶</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1vlvso1j30u20eaabh.jpg" alt="image-20210418175927482"></p><p>ç¬¬ä¸€ä¸ªç«äº‰å‡ºç°æ—¶</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1w3ptbhj30uy0e20va.jpg" alt="image-20210418175955873"></p><p>Thread-1 æ‰§è¡Œäº†</p><ol><li>CAS å°è¯•å°† state ç”± 0 æ”¹ä¸º 1ï¼Œç»“æœå¤±è´¥</li><li>è¿›å…¥ tryAcquire é€»è¾‘ï¼Œè¿™æ—¶ state å·²ç»æ˜¯1ï¼Œç»“æœä»ç„¶å¤±è´¥</li><li>æ¥ä¸‹æ¥è¿›å…¥ addWaiter é€»è¾‘ï¼Œæ„é€  Node é˜Ÿåˆ— <ul><li>å›¾ä¸­é»„è‰²ä¸‰è§’è¡¨ç¤ºè¯¥ Node çš„ waitStatus çŠ¶æ€ï¼Œå…¶ä¸­ 0 ä¸ºé»˜è®¤æ­£å¸¸çŠ¶æ€ </li><li>Node çš„åˆ›å»ºæ˜¯æ‡’æƒ°çš„ </li><li>å…¶ä¸­ç¬¬ä¸€ä¸ª Node ç§°ä¸º Dummyï¼ˆå“‘å…ƒï¼‰æˆ–å“¨å…µï¼Œç”¨æ¥å ä½ï¼Œå¹¶ä¸å…³è”çº¿ç¨‹</li></ul></li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1xpsvhxj30za0cmac3.jpg" alt="image-20210418180129167"></p><p>å½“å‰çº¿ç¨‹è¿›å…¥ acquireQueued é€»è¾‘</p><ol><li><p>acquireQueued ä¼šåœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­ä¸æ–­å°è¯•è·å¾—é”ï¼Œå¤±è´¥åè¿›å…¥ park é˜»å¡</p></li><li><p>å¦‚æœè‡ªå·±æ˜¯ç´§é‚»ç€ headï¼ˆæ’ç¬¬äºŒä½ï¼‰ï¼Œé‚£ä¹ˆå†æ¬¡ tryAcquire å°è¯•è·å–é”ï¼Œå½“ç„¶è¿™æ—¶ state ä»ä¸º 1ï¼Œå¤±è´¥</p></li><li><p>è¿›å…¥ shouldParkAfterFailedAcquire é€»è¾‘ï¼Œå°†å‰é©± nodeï¼Œå³ head çš„ waitStatus æ”¹ä¸º -1ï¼Œè¿™æ¬¡è¿”å› false</p></li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1z9xf6sj30z40cuwgk.jpg" alt="image-20210418180257642"></p><ol start="4"><li><p>shouldParkAfterFailedAcquire æ‰§è¡Œå®Œæ¯•å›åˆ° acquireQueued ï¼Œå†æ¬¡ tryAcquire å°è¯•è·å–é”ï¼Œå½“ç„¶è¿™æ—¶ state ä»ä¸º 1ï¼Œå¤±è´¥</p></li><li><p>å½“å†æ¬¡è¿›å…¥ shouldParkAfterFailedAcquire æ—¶ï¼Œè¿™æ—¶å› ä¸ºå…¶å‰é©± node çš„ waitStatus å·²ç»æ˜¯ -1ï¼Œè¿™æ¬¡è¿”å› true</p></li><li><p>è¿›å…¥ parkAndCheckInterruptï¼Œ Thread-1 parkï¼ˆç°è‰²è¡¨ç¤ºï¼‰</p></li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo1zpcge6j30zk0cen05.jpg" alt="image-20210418180324526"></p><p>å†æ¬¡æœ‰å¤šä¸ªçº¿ç¨‹ç»å†ä¸Šè¿°è¿‡ç¨‹ç«äº‰å¤±è´¥ï¼Œå˜æˆè¿™ä¸ªæ ·å­</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo24izl02j310008a3zx.jpg" alt="image-20210418180345185"></p><p>Thread-0é‡Šæ”¾é”ï¼Œè¿›å…¥tryReleaseæµç¨‹ï¼Œå¦‚æœæˆåŠŸ</p><ul><li>è®¾ç½®exclusiveOwnerThreadä¸ºnull</li><li>state=0</li></ul><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo20zf7azj310407u0up.jpg" alt="image-20210418180436882"></p><p>å½“å‰é˜Ÿåˆ—ä¸ä¸º nullï¼Œå¹¶ä¸” head çš„ waitStatus = -1ï¼Œè¿›å…¥ unparkSuccessor æµç¨‹</p><p>æ‰¾åˆ°é˜Ÿåˆ—ä¸­ç¦» head æœ€è¿‘çš„ä¸€ä¸ª Nodeï¼ˆæ²¡å–æ¶ˆçš„ï¼‰ï¼Œunpark æ¢å¤å…¶è¿è¡Œï¼Œæœ¬ä¾‹ä¸­å³ä¸º Thread-1 </p><p>å›åˆ° Thread-1 çš„ acquireQueued æµç¨‹</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo21l0tmuj310608kta0.jpg" alt="image-20210418180512195"></p><p>å¦‚æœåŠ é”æˆåŠŸï¼ˆæ²¡æœ‰ç«äº‰ï¼‰ï¼Œä¼šè®¾ç½® </p><ul><li>exclusiveOwnerThread ä¸º Thread-1ï¼Œstate = 1 </li><li>head æŒ‡å‘åˆšåˆš Thread-1 æ‰€åœ¨çš„ Nodeï¼Œè¯¥ Node æ¸…ç©º Thread </li><li>åŸæœ¬çš„ head å› ä¸ºä»é“¾è¡¨æ–­å¼€ï¼Œè€Œå¯è¢«åƒåœ¾å›æ”¶ </li></ul><p>å¦‚æœè¿™æ—¶å€™æœ‰å…¶å®ƒçº¿ç¨‹æ¥ç«äº‰ï¼ˆéå…¬å¹³çš„ä½“ç°ï¼‰ï¼Œä¾‹å¦‚è¿™æ—¶æœ‰ Thread-4 æ¥äº†</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo22axqamj310c09oaco.jpg" alt="image-20210418180554170"></p><p>å¦‚æœä¸å·§åˆè¢« Thread-4 å äº†å…ˆ</p><ul><li>Thread-4 è¢«è®¾ç½®ä¸º exclusiveOwnerThreadï¼Œstate = 1 </li><li>Thread-1 å†æ¬¡è¿›å…¥ acquireQueued æµç¨‹ï¼Œè·å–é”å¤±è´¥ï¼Œé‡æ–°è¿›å…¥ park é˜»å¡</li></ul><h3 id="å¯é‡å…¥åŸç†"><a href="#å¯é‡å…¥åŸç†" class="headerlink" title="å¯é‡å…¥åŸç†"></a>å¯é‡å…¥åŸç†</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sync</span> </span>&#123;   <span class="hljs-comment">// ...</span><span class="hljs-comment">// Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ </span>  <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> acquires)</span> </span>&#123;<span class="hljs-keyword">final</span> Thread current = Thread.currentThread();     <span class="hljs-keyword">int</span> c = getState();     <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) &#123;         <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, acquires)) &#123;           setExclusiveOwnerThread(current);           <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;         &#125;       &#125;    <span class="hljs-comment">// å¦‚æœå·²ç»è·å¾—äº†é”, çº¿ç¨‹è¿˜æ˜¯å½“å‰çº¿ç¨‹, è¡¨ç¤ºå‘ç”Ÿäº†é”é‡å…¥ </span>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) &#123;       <span class="hljs-comment">// state++ </span>      <span class="hljs-keyword">int</span> nextc = c + acquires;       <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow </span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">&quot;Maximum lock count exceeded&quot;</span>);       setState(nextc);       <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;&#125;     <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;  <span class="hljs-comment">// Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ </span>  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryRelease</span><span class="hljs-params">(<span class="hljs-keyword">int</span> releases)</span> </span>&#123;<span class="hljs-comment">// state--</span>    <span class="hljs-keyword">int</span> c = getState() - releases;     <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalMonitorStateException();     <span class="hljs-keyword">boolean</span> free = <span class="hljs-keyword">false</span>;     <span class="hljs-comment">// æ”¯æŒé”é‡å…¥, åªæœ‰ state å‡ä¸º 0, æ‰é‡Šæ”¾æˆåŠŸ </span>    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) &#123;free = <span class="hljs-keyword">true</span>;setExclusiveOwnerThread(<span class="hljs-keyword">null</span>);&#125;setState(c);     <span class="hljs-keyword">return</span> free; &#125;&#125;</code></pre></div><h3 id="å¯æ‰“æ–­åŸç†"><a href="#å¯æ‰“æ–­åŸç†" class="headerlink" title="å¯æ‰“æ–­åŸç†"></a>å¯æ‰“æ–­åŸç†</h3><p><strong>ä¸å¯æ‰“æ–­æ¨¡å¼</strong></p><p>åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå³ä½¿å®ƒè¢«æ‰“æ–­ï¼Œä»ä¼šé©»ç•™åœ¨ AQS é˜Ÿåˆ—ä¸­ï¼Œä¸€ç›´è¦ç­‰åˆ°è·å¾—é”åæ–¹èƒ½ç»§ç»­è¿è¡Œï¼ˆæ˜¯ç»§ç»­è¿è¡Œï¼Œåªæ˜¯æ‰“æ–­æ ‡è®°è¢«è®¾ç½®ä¸ºtrueï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo2gotu50j30u012rn3q.jpg" alt="image-20210418181943236"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo2h1aa9ij30sy0dedhe.jpg" alt="image-20210418182001896"></p><p><strong>å¯æ‰“æ–­æ¨¡å¼</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo2hpjb09j30u00xvdmc.jpg" alt="image-20210418182041288"></p><h3 id="å…¬å¹³é”å®ç°åŸç†"><a href="#å…¬å¹³é”å®ç°åŸç†" class="headerlink" title="å…¬å¹³é”å®ç°åŸç†"></a>å…¬å¹³é”å®ç°åŸç†</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo2ilonptj30u010gwl3.jpg" alt="image-20210418182132330"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2iz4ws1j30s40agq4t.jpg" alt="image-20210418182154563"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2j8je4cj30q604gmxi.jpg" alt="image-20210418182210122"></p><h3 id="æ¡ä»¶å˜é‡å®ç°åŸç†"><a href="#æ¡ä»¶å˜é‡å®ç°åŸç†" class="headerlink" title="æ¡ä»¶å˜é‡å®ç°åŸç†"></a>æ¡ä»¶å˜é‡å®ç°åŸç†</h3><p>æ¯ä¸ªæ¡ä»¶å˜é‡å…¶å®å°±å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®ç°ç±»æ˜¯ ConditionObject</p><p><strong>await æµç¨‹</strong></p><p>å¼€å§‹ Thread-0 æŒæœ‰é”ï¼Œè°ƒç”¨ awaitï¼Œè¿›å…¥ ConditionObject çš„ addConditionWaiter æµç¨‹ </p><p>åˆ›å»ºæ–°çš„ Node çŠ¶æ€ä¸º -2ï¼ˆNode.CONDITIONï¼‰ï¼Œå…³è” Thread-0ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—å°¾éƒ¨</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2kdqpmkj31ay0gwjuw.jpg" alt="image-20210418182314247"></p><p>æ¥ä¸‹æ¥è¿›å…¥ AQS çš„ fullyRelease æµç¨‹ï¼Œé‡Šæ”¾åŒæ­¥å™¨ä¸Šçš„é”</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2kqp1clj31bc0ha77n.jpg" alt="image-20210418182335941"></p><p>unpark AQS é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç«äº‰é”ï¼Œå‡è®¾æ²¡æœ‰å…¶ä»–ç«äº‰çº¿ç¨‹ï¼Œé‚£ä¹ˆ Thread-1 ç«äº‰æˆåŠŸ</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2l55unlj31bg0haado.jpg" alt="image-20210418182359834"></p><p>park é˜»å¡ Thread-0</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2lnbfbij31bq0h4q6h.jpg" alt="image-20210418182428801"></p><p><strong>signal æµç¨‹</strong></p><p>å‡è®¾ Thread-1 è¦æ¥å”¤é†’ Thread-0</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2m6dzi5j31au0lujvm.jpg" alt="image-20210418182459334"></p><p>è¿›å…¥ ConditionObject çš„ doSignal æµç¨‹ï¼Œå–å¾—ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ª Nodeï¼Œå³ Thread-0 æ‰€åœ¨ Node</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2mlbrz8j31am0luaea.jpg" alt="image-20210418182522585"></p><p>æ‰§è¡Œ transferForSignal æµç¨‹ï¼Œå°†è¯¥ Node åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨ï¼Œå°† Thread-0 çš„ waitStatus æ”¹ä¸º 0ï¼ŒThread-3 çš„waitStatus æ”¹ä¸º -1</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo2n1hqisj31b20h477k.jpg" alt="image-20210418182547437"></p><p>Thread-1 é‡Šæ”¾é”ï¼Œè¿›å…¥ unlock æµç¨‹</p><h2 id="3ã€ReentranReadWriteLock"><a href="#3ã€ReentranReadWriteLock" class="headerlink" title="3ã€ReentranReadWriteLock"></a>3ã€ReentranReadWriteLock</h2><h3 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h3><p>å½“è¯»æ“ä½œè¿œè¿œé«˜äºå†™æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ä½¿ç”¨<code>è¯»å†™é”</code>è®©<code>è¯»-è¯»</code>æé«˜æ€§èƒ½ã€‚ ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ <code>select ... from ... lock in share mode</code></p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ </li><li>é‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šå³æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹å»è·å–å†™é”ï¼Œä¼šå¯¼è‡´è·å–å†™é”æ°¸ä¹…ç­‰å¾…</li></ul><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo6c2t414j30xs0iqwfq.jpg" alt="image-20210418203339576" style="zoom: 67%;" /><h3 id="ç¼“å­˜æ›´æ–°ç­–ç•¥"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥</h3><p>æ›´æ–°æ—¶ï¼Œæ˜¯å…ˆæ¸…ç¼“å­˜è¿˜æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ </p><p><strong>å…ˆæ¸…ç¼“å­˜</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo6k508roj31840k0q54.jpg" alt="image-20210418204125189"></p><p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼ˆé€šå¸¸ä½¿ç”¨çš„ï¼‰</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo6kwvm2mj30v00u00yi.jpg" alt="image-20210418204208526"></p><p>è¿™ç§æƒ…å†µçš„å‡ºç°å‡ ç‡éå¸¸å°ï¼Œè§ facebook è®ºæ–‡</p><h3 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è¯»å†™é”ç”¨çš„æ˜¯åŒä¸€ä¸ª Sycn åŒæ­¥å™¨ï¼Œå› æ­¤ç­‰å¾…é˜Ÿåˆ—ã€state ç­‰ä¹Ÿæ˜¯åŒä¸€ä¸ª</p><p><strong>t1 w.lockï¼Œt2 r.lock</strong></p><p>1ï¼‰ t1 æˆåŠŸä¸Šé”ï¼Œæµç¨‹ä¸ ReentrantLock åŠ é”ç›¸æ¯”æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„ï¼Œä¸åŒæ˜¯å†™é”çŠ¶æ€å äº† state çš„ä½ 16 ä½ï¼Œè€Œè¯»é” ä½¿ç”¨çš„æ˜¯ state çš„é«˜ 16 ä½</p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo6fn47u7j30uu0kk0v1.jpg" alt="image-20210418203705054"  /><p>2ï¼‰t2 æ‰§è¡Œ r.lockï¼Œè¿™æ—¶è¿›å…¥è¯»é”çš„ sync.acquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¼šè¿›å…¥ tryAcquireShared æµç¨‹ã€‚å¦‚æœæœ‰å†™ é”å æ®ï¼Œé‚£ä¹ˆ tryAcquireShared è¿”å› -1 è¡¨ç¤ºå¤±è´¥</p><blockquote><p>tryAcquireShared è¿”å›å€¼è¡¨ç¤º </p><ul><li>-1 è¡¨ç¤ºå¤±è´¥</li><li>0 è¡¨ç¤ºæˆåŠŸï¼Œä½†åç»§èŠ‚ç‚¹ä¸ä¼šç»§ç»­å”¤é†’ </li><li>æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œè€Œä¸”æ•°å€¼æ˜¯è¿˜æœ‰å‡ ä¸ªåç»§èŠ‚ç‚¹éœ€è¦å”¤é†’ï¼Œè¯»å†™é”è¿”å› 1</li></ul></blockquote><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpo6hjkzjwj30v80ksgo3.jpg" alt="image-20210418203853099"  /><p>3ï¼‰è¿™æ—¶ä¼šè¿›å…¥ sync.doAcquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¹Ÿæ˜¯è°ƒç”¨ addWaiter æ·»åŠ èŠ‚ç‚¹ï¼Œä¸åŒä¹‹å¤„åœ¨äºèŠ‚ç‚¹è¢«è®¾ç½®ä¸º Node.SHARED æ¨¡å¼è€Œé Node.EXCLUSIVE æ¨¡å¼ï¼Œæ³¨æ„æ­¤æ—¶ t2 ä»å¤„äºæ´»è·ƒçŠ¶æ€</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo70kto80j312m0hyacj.jpg" alt="image-20210418205713020"></p><p>4ï¼‰t2 ä¼šçœ‹çœ‹è‡ªå·±çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯è€äºŒï¼Œå¦‚æœæ˜¯ï¼Œè¿˜ä¼šå†æ¬¡è°ƒç”¨ tryAcquireShared(1) æ¥å°è¯•è·å–é”</p><p>5ï¼‰å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œåœ¨ doAcquireShared å†… for (;;) å¾ªç¯ä¸€æ¬¡ï¼ŒæŠŠå‰é©±èŠ‚ç‚¹çš„ waitStatus æ”¹ä¸º -1ï¼Œå† for (;;) å¾ªç¯ä¸€ æ¬¡å°è¯• tryAcquireShared(1) å¦‚æœè¿˜ä¸æˆåŠŸï¼Œé‚£ä¹ˆåœ¨ parkAndCheckInterrupt() å¤„ park</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo711ahexj312o0iyn00.jpg" alt="image-20210418205738331"></p><p><strong>t3 r.lockï¼Œt4 w.lock</strong></p><p>è¿™ç§çŠ¶æ€ä¸‹ï¼Œå‡è®¾åˆæœ‰ t3 åŠ è¯»é”ï¼ˆå…±äº«çŠ¶æ€Sharedï¼‰å’Œ t4 åŠ å†™é”ï¼ˆç‹¬å çŠ¶æ€Exï¼‰ï¼Œè¿™æœŸé—´ t1 ä»ç„¶æŒæœ‰é”ï¼Œå°±å˜æˆäº†ä¸‹é¢çš„æ ·å­</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo78pxcpdj31d20fqmzx.jpg" alt="image-20210418210503783"></p><p><strong>t1 w.unlock</strong></p><p>è¿™æ—¶ä¼šèµ°åˆ°å†™é”çš„ sync.release(1) æµç¨‹ï¼Œè°ƒç”¨ sync.tryRelease(1) æˆåŠŸï¼Œå˜æˆä¸‹é¢çš„æ ·å­</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7akuhgwj31dw0fcgo9.jpg" alt="image-20210418210650519"></p><p>æ¥ä¸‹æ¥æ‰§è¡Œå”¤é†’æµç¨‹ sync.unparkSuccessorï¼Œå³è®©è€äºŒæ¢å¤è¿è¡Œï¼Œè¿™æ—¶ t2 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ</p><p>è¿™å›å†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7bb28gtj31ei0g0whg.jpg" alt="image-20210418210732099"></p><p>è¿™æ—¶ t2 å·²ç»æ¢å¤è¿è¡Œï¼Œæ¥ä¸‹æ¥ t2 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7e9zj7uj31de0iujuu.jpg" alt="image-20210418211022747"></p><p>äº‹æƒ…è¿˜æ²¡å®Œï¼Œåœ¨ setHeadAndPropagate æ–¹æ³•å†…è¿˜ä¼šæ£€æŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ sharedï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨ doReleaseShared() å°† head çš„çŠ¶æ€ä» -1 æ”¹ä¸º 0 ï¼ˆä¸ºäº†é˜²æ­¢å…¶ä»–çº¿ç¨‹é‡å¤å”¤é†’ï¼‰å¹¶å”¤é†’è€äºŒï¼Œè¿™æ—¶ t3 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7fah466j31ee0j00wa.jpg" alt="image-20210418211121650"></p><p>è¿™å›å†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7g68m2gj31e20is0wa.jpg" alt="image-20210418211213069"></p><p>è¿™æ—¶ t3 å·²ç»æ¢å¤è¿è¡Œï¼Œæ¥ä¸‹æ¥ t3 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7gmq2taj31da0oyaeb.jpg" alt="image-20210418211239666"></p><p>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯ shared äº†ï¼Œå› æ­¤ä¸ä¼šç»§ç»­å”¤é†’ t4 æ‰€åœ¨èŠ‚ç‚¹</p><p><strong>t2 r.unlockï¼Œt3 r.unlock</strong></p><p>t2 è¿›å…¥ sync.releaseShared(1) ä¸­ï¼Œè°ƒç”¨ tryReleaseShared(1) è®©è®¡æ•°å‡ä¸€ï¼Œä½†ç”±äºè®¡æ•°è¿˜ä¸ä¸ºé›¶</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7hftc0dj31dc0omaet.jpg" alt="image-20210418211326010"></p><p>t3è¿›å…¥sync.releaseShared(1)ä¸­ï¼Œè°ƒç”¨tryReleaseShared(1)è®©è®¡æ•°å‡ä¸€ï¼Œè¿™å›è®¡æ•°ä¸ºé›¶äº†ï¼Œè¿›å…¥doReleaseShared()å°†å¤´èŠ‚ç‚¹ä»-1æ”¹ä¸º0å¹¶å”¤é†’è€äºŒï¼Œå³</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7hzy646j31dk0p2tcz.jpg" alt="image-20210418211358350"></p><p>ä¹‹å t4 åœ¨ acquireQueued ä¸­ parkAndCheckInterrupt å¤„æ¢å¤è¿è¡Œï¼Œå†æ¬¡ for (;;) è¿™æ¬¡è‡ªå·±æ˜¯è€äºŒï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»– ç«äº‰ï¼ŒtryAcquire(1) æˆåŠŸï¼Œä¿®æ”¹å¤´ç»“ç‚¹ï¼Œæµç¨‹ç»“æŸ</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpo7igo09yj313g0q6tcf.jpg" alt="image-20210418211425394"></p><h3 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h3><p>è¯¥ç±»è‡ª JDK 8 åŠ å…¥ï¼Œæ˜¯ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–è¯»æ€§èƒ½ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä½¿ç”¨è¯»é”ã€å†™é”æ—¶éƒ½å¿…é¡»é…åˆã€æˆ³ã€‘ä½¿ç”¨</p><p><strong>åŠ è§£è¯»é”</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">long</span> stamp = lock.readLock(); lock.unlockRead(stamp);</code></pre></div><p><strong>åŠ è§£å†™é”</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">long</span> stamp = lock.writeLock(); lock.unlockWrite(stamp);</code></pre></div><p>ä¹è§‚è¯»ï¼ŒStampedLock æ”¯æŒ <strong>tryOptimisticRead()</strong> æ–¹æ³•ï¼ˆä¹è§‚è¯»ï¼‰ï¼Œè¯»å–å®Œæ¯•åéœ€è¦åšä¸€æ¬¡<strong>æˆ³æ ¡éªŒ</strong>å¦‚æœæ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºè¿™æœŸé—´ç¡®å®æ²¡æœ‰å†™æ“ä½œï¼Œæ•°æ®å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå¦‚æœæ ¡éªŒæ²¡é€šè¿‡ï¼Œéœ€è¦é‡æ–°è·å–è¯»é”ï¼Œä¿è¯æ•°æ®å®‰å…¨</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">long</span> stamp = lock.tryOptimisticRead(); <span class="hljs-comment">// éªŒæˆ³ </span><span class="hljs-keyword">if</span>(!lock.validate(stamp))&#123;   <span class="hljs-comment">// é”å‡çº§ </span>&#125;</code></pre></div><p>æä¾›ä¸€ä¸ªæ•°æ®å®¹å™¨ç±»å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„**read()<strong>æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„</strong>write()**æ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataContainerStamped</span> </span>&#123;<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> data;  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StampedLock lock = <span class="hljs-keyword">new</span> StampedLock();<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataContainerStamped</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data)</span> </span>&#123;       <span class="hljs-keyword">this</span>.data = data;     &#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span> readTime)</span> </span>&#123;<span class="hljs-keyword">long</span> stamp = lock.tryOptimisticRead();     log.debug(<span class="hljs-string">&quot;optimistic read locking...&#123;&#125;&quot;</span>, stamp);     sleep(readTime);     <span class="hljs-keyword">if</span> (lock.validate(stamp)) &#123;log.debug(<span class="hljs-string">&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;</span>, stamp, data);<span class="hljs-keyword">return</span> data;       &#125;    <span class="hljs-comment">// é”å‡çº§ - è¯»é” </span>      log.debug(<span class="hljs-string">&quot;updating to read lock... &#123;&#125;&quot;</span>, stamp);    <span class="hljs-keyword">try</span> &#123;stamp = lock.readLock();log.debug(<span class="hljs-string">&quot;read lock &#123;&#125;&quot;</span>, stamp);sleep(readTime);log.debug(<span class="hljs-string">&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;</span>, stamp, data);<span class="hljs-keyword">return</span> data;       &#125; <span class="hljs-keyword">finally</span> &#123;log.debug(<span class="hljs-string">&quot;read unlock &#123;&#125;&quot;</span>, stamp);lock.unlockRead(stamp);       &#125;&#125;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newData)</span> </span>&#123;<span class="hljs-keyword">long</span> stamp = lock.writeLock();     log.debug(<span class="hljs-string">&quot;write lock &#123;&#125;&quot;</span>, stamp);     <span class="hljs-keyword">try</span> &#123;sleep(<span class="hljs-number">2</span>);<span class="hljs-keyword">this</span>.data = newData;           &#125; <span class="hljs-keyword">finally</span> &#123;log.debug(<span class="hljs-string">&quot;write unlock &#123;&#125;&quot;</span>, stamp);lock.unlockWrite(stamp);           &#125;&#125;&#125;</code></pre></div><p>æµ‹è¯•<code>è¯»-è¯»</code>å¯ä»¥ä¼˜åŒ–</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;DataContainerStamped dataContainer = <span class="hljs-keyword">new</span> DataContainerStamped(<span class="hljs-number">1</span>);   <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;dataContainer.read(<span class="hljs-number">1</span>);     &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();   sleep(<span class="hljs-number">0.5</span>);   <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;dataContainer.read(<span class="hljs-number">0</span>);     &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();&#125;</code></pre></div><p>è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°å®é™…æ²¡æœ‰åŠ è¯»é”</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">50.217</span> c.DataContainerStamped [t1] - optimistic read locking..<span class="hljs-number">.256</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">50.717</span> c.DataContainerStamped [t2] - optimistic read locking..<span class="hljs-number">.256</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">50.717</span> c.DataContainerStamped [t2] - read finish..<span class="hljs-number">.256</span>, data:<span class="hljs-number">1</span><span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">51.220</span> c.DataContainerStamped [t1] - read finish..<span class="hljs-number">.256</span>, data:<span class="hljs-number">1</span></code></pre></div><p>æµ‹è¯•<code>è¯»-å†™</code>æ—¶ä¼˜åŒ–è¯»è¡¥åŠ è¯»é”</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;DataContainerStamped dataContainer = <span class="hljs-keyword">new</span> DataContainerStamped(<span class="hljs-number">1</span>);   <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;dataContainer.read(<span class="hljs-number">1</span>);     &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();   sleep(<span class="hljs-number">0.5</span>);   <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;dataContainer.write(<span class="hljs-number">100</span>);     &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();&#125;</code></pre></div><p>è¾“å‡ºç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">00.219</span> c.DataContainerStamped [t1] - optimistic read locking..<span class="hljs-number">.256</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">00.717</span> c.DataContainerStamped [t2] - write lock <span class="hljs-number">384</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">01.225</span> c.DataContainerStamped [t1] - updating to read lock... <span class="hljs-number">256</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">02.719</span> c.DataContainerStamped [t2] - write unlock <span class="hljs-number">384</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">02.719</span> c.DataContainerStamped [t1] - read lock <span class="hljs-number">513</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">03.719</span> c.DataContainerStamped [t1] - read finish..<span class="hljs-number">.513</span>, data:<span class="hljs-number">1000</span> <span class="hljs-number">15</span>:<span class="hljs-number">57</span>:<span class="hljs-number">03.719</span> c.DataContainerStamped [t1] - read unlock <span class="hljs-number">513</span></code></pre></div><blockquote><p>æ³¨æ„</p><ul><li>StampedLock ä¸æ”¯æŒæ¡ä»¶å˜é‡ </li><li>StampedLock ä¸æ”¯æŒå¯é‡å…¥</li></ul></blockquote><h2 id="4ã€Semaphore"><a href="#4ã€Semaphore" class="headerlink" title="4ã€Semaphore"></a>4ã€Semaphore</h2><p>ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶èƒ½åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ä¸Šé™</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpou72jxqbj310u0tkn3h.jpg" alt="image-20210419101910684"></p><p>è¾“å‡º</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpou7e4yggj310s0o6tj9.jpg" alt="image-20210419101931207"></p><p><strong>åŠ é”è§£é”æµç¨‹</strong></p><p>Semaphore æœ‰ç‚¹åƒä¸€ä¸ªåœè½¦åœºï¼Œpermits å°±å¥½åƒåœè½¦ä½æ•°é‡ï¼Œå½“çº¿ç¨‹è·å¾—äº† permits å°±åƒæ˜¯è·å¾—äº†åœè½¦ä½ï¼Œç„¶å åœè½¦åœºæ˜¾ç¤ºç©ºä½™è½¦ä½å‡ä¸€</p><p>åˆšå¼€å§‹ï¼Œpermitsï¼ˆstateï¼‰ä¸º 3ï¼Œè¿™æ—¶ 5 ä¸ªçº¿ç¨‹æ¥è·å–èµ„æº</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpou93wrw9j31cs0qwdmg.jpg" alt="image-20210419102112057"></p><p>å‡è®¾å…¶ä¸­Thread-1ï¼ŒThread-2ï¼ŒThread-4casç«äº‰æˆåŠŸï¼Œè€ŒThread-0å’ŒThread-3ç«äº‰å¤±è´¥ï¼Œè¿›å…¥AQSé˜Ÿåˆ—parké˜»å¡</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpou9xdnv7j31cs0ceq59.jpg" alt="image-20210419102158503"></p><p>è¿™æ—¶ Thread-4 é‡Šæ”¾äº† permitsï¼ŒçŠ¶æ€å¦‚ä¸‹</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpouad858aj31dg0dmwhm.jpg" alt="image-20210419102225028"></p><p>æ¥ä¸‹æ¥ Thread-0 ç«äº‰æˆåŠŸï¼Œpermits å†æ¬¡è®¾ç½®ä¸º 0ï¼Œè®¾ç½®è‡ªå·±ä¸º head èŠ‚ç‚¹ï¼Œæ–­å¼€åŸæ¥çš„ head èŠ‚ç‚¹ï¼Œunpark æ¥ ä¸‹æ¥çš„ Thread-3 èŠ‚ç‚¹ï¼Œä½†ç”±äº permits æ˜¯ 0ï¼Œå› æ­¤ Thread-3 åœ¨å°è¯•ä¸æˆåŠŸåå†æ¬¡è¿›å…¥ park çŠ¶æ€</p><h2 id="5ã€çº¿æ€§å®‰å…¨é›†åˆç±»"><a href="#5ã€çº¿æ€§å®‰å…¨é›†åˆç±»" class="headerlink" title="5ã€çº¿æ€§å®‰å…¨é›†åˆç±»"></a>5ã€çº¿æ€§å®‰å…¨é›†åˆç±»</h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpowxpot12j31nq0dugnz.jpg" alt="image-20210419115346068"></p><p>çº¿ç¨‹å®‰å…¨é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><ul><li><p>é—ç•™çš„çº¿ç¨‹å®‰å…¨é›†åˆå¦‚ Hashtable ï¼Œ Vector </p></li><li><p>ä½¿ç”¨ Collections è£…é¥°çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¦‚ï¼š</p><ul><li>Collections.synchronizedCollection</li><li>Collections.synchronizedList</li><li>Collections.synchronizedMap</li><li>Collections.synchronizedSet</li><li>Collections.synchronizedNavigableMap</li><li>Collections.synchronizedNavigableSet</li><li>Collections.synchronizedSortedMap</li><li>Collections.synchronizedSortedSet</li></ul></li><li><p>java.util.concurrent.*</p></li></ul><p>é‡ç‚¹ä»‹ç» java.util.concurrent.* ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼Œå¯ä»¥å‘ç°å®ƒä»¬æœ‰è§„å¾‹ï¼Œé‡Œé¢åŒ…å«ä¸‰ç±»å…³é”®è¯ï¼š Blockingã€CopyOnWriteã€Concurrent</p><ul><li>Blocking å¤§éƒ¨åˆ†å®ç°åŸºäºé”ï¼Œå¹¶æä¾›ç”¨æ¥é˜»å¡çš„æ–¹æ³• </li><li>CopyOnWrite ä¹‹ç±»å®¹å™¨ä¿®æ”¹å¼€é”€ç›¸å¯¹è¾ƒé‡ </li><li>Concurrent ç±»å‹çš„å®¹å™¨ <ul><li>å†…éƒ¨å¾ˆå¤šæ“ä½œä½¿ç”¨ cas ä¼˜åŒ–ï¼Œä¸€èˆ¬å¯ä»¥æä¾›è¾ƒé«˜ååé‡ </li><li>å¼±ä¸€è‡´æ€§ <ul><li>éå†æ—¶å¼±ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ï¼Œå½“åˆ©ç”¨è¿­ä»£å™¨éå†æ—¶ï¼Œå¦‚æœå®¹å™¨å‘ç”Ÿä¿®æ”¹ï¼Œè¿­ä»£å™¨ä»ç„¶å¯ä»¥ç»§ç»­è¿›è¡Œéå†ï¼Œè¿™æ—¶å†…å®¹æ˜¯æ—§çš„ </li><li>æ±‚å¤§å°å¼±ä¸€è‡´æ€§ï¼Œsize æ“ä½œæœªå¿…æ˜¯ 100% å‡†ç¡® </li><li>è¯»å–å¼±ä¸€è‡´æ€§</li></ul></li></ul></li></ul><blockquote><p>éå†æ—¶å¦‚æœå‘ç”Ÿäº†ä¿®æ”¹ï¼Œå¯¹äºéå®‰å…¨å®¹å™¨æ¥è®²ï¼Œä½¿ç”¨ <strong>fail-fast</strong> æœºåˆ¶ä¹Ÿå°±æ˜¯è®©éå†ç«‹åˆ»å¤±è´¥ï¼ŒæŠ›å‡º ConcurrentModiï¬cationExceptionï¼Œä¸å†ç»§ç»­éå†</p></blockquote><h2 id="6ã€ConcurrentHashMap"><a href="#6ã€ConcurrentHashMap" class="headerlink" title="6ã€ConcurrentHashMap"></a>6ã€ConcurrentHashMap</h2><h4 id="JDK-7-HashMap-å¹¶å‘æ­»é“¾"><a href="#JDK-7-HashMap-å¹¶å‘æ­»é“¾" class="headerlink" title="JDK 7 HashMap å¹¶å‘æ­»é“¾"></a>JDK 7 HashMap å¹¶å‘æ­»é“¾</h4><p>åœ¨JDK7ä¸‹ä½¿ç”¨HashMapä¼šå‘ç”Ÿæ­»é“¾ï¼Œç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨äº†éçº¿ç¨‹å®‰å…¨çš„ map é›†åˆ </p><p>JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½ å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºç°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰</p><h4 id="é‡è¦å±æ€§å’Œå†…éƒ¨ç±»"><a href="#é‡è¦å±æ€§å’Œå†…éƒ¨ç±»" class="headerlink" title="é‡è¦å±æ€§å’Œå†…éƒ¨ç±»"></a>é‡è¦å±æ€§å’Œå†…éƒ¨ç±»</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpp3gxgovjj30zl0u0n7q.jpg" alt="image-20210419154006079"></p><h4 id="é‡è¦æ–¹æ³•"><a href="#é‡è¦æ–¹æ³•" class="headerlink" title="é‡è¦æ–¹æ³•"></a>é‡è¦æ–¹æ³•</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gpp3kg3yovj316q0bawi6.jpg" alt="image-20210419154328609"></p><p><strong>Java 8 æ•°ç»„ï¼ˆNodeï¼‰ +ï¼ˆ é“¾è¡¨ Node | çº¢é»‘æ ‘ TreeNode ï¼‰ ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰</strong></p><ul><li>åˆå§‹åŒ–ï¼Œä½¿ç”¨ cas æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ‡’æƒ°åˆå§‹åŒ– table </li><li>æ ‘åŒ–ï¼Œå½“ table.length &lt; 64 æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹ï¼Œè¶…è¿‡ 64 æ—¶ï¼Œå¹¶ä¸” bin.length &gt; 8 æ—¶ï¼Œä¼šå°†é“¾è¡¨æ ‘åŒ–ï¼Œæ ‘åŒ–è¿‡ç¨‹ ä¼šç”¨ synchronized é”ä½é“¾è¡¨å¤´ </li><li>putï¼Œå¦‚æœè¯¥ bin å°šæœªåˆ›å»ºï¼Œåªéœ€è¦ä½¿ç”¨ cas åˆ›å»º binï¼›å¦‚æœå·²ç»æœ‰äº†ï¼Œé”ä½é“¾è¡¨å¤´è¿›è¡Œåç»­ put æ“ä½œï¼Œå…ƒç´  æ·»åŠ è‡³ bin çš„å°¾éƒ¨ </li><li>getï¼Œæ— é”æ“ä½œä»…éœ€è¦ä¿è¯å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ get æ“ä½œæ‹¿åˆ°çš„æ˜¯ ForwardingNode å®ƒä¼šè®© get æ“ä½œåœ¨æ–° table è¿›è¡Œæœç´¢ </li><li>æ‰©å®¹ï¼Œæ‰©å®¹æ—¶ä»¥ bin ä¸ºå•ä½è¿›è¡Œï¼Œéœ€è¦å¯¹ bin è¿›è¡Œ synchronizedï¼Œä½†è¿™æ—¶å¦™çš„æ˜¯å…¶å®ƒç«äº‰çº¿ç¨‹ä¹Ÿä¸æ˜¯æ— äº‹å¯ åšï¼Œå®ƒä»¬ä¼šå¸®åŠ©æŠŠå…¶å®ƒ bin è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ—¶å¹³å‡åªæœ‰ 1/6 çš„èŠ‚ç‚¹ä¼šæŠŠå¤åˆ¶åˆ°æ–° table ä¸­ </li><li>sizeï¼Œå…ƒç´ ä¸ªæ•°ä¿å­˜åœ¨ baseCount ä¸­ï¼Œå¹¶å‘æ—¶çš„ä¸ªæ•°å˜åŠ¨ä¿å­˜åœ¨ CounterCell[] å½“ä¸­ã€‚æœ€åç»Ÿè®¡æ•°é‡æ—¶ç´¯åŠ  å³å¯</li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMè™šæ‹Ÿæœº</title>
    <link href="/2021/05/05/JVM/"/>
    <url>/2021/05/05/JVM/</url>
    
    <content type="html"><![CDATA[<h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><h1 id="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"></a>ä¸€ã€ä»€ä¹ˆæ˜¯JVM</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Java Virtual Machineï¼ŒJAVAç¨‹åºçš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼ˆJAVAäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p><h2 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h2><ul><li>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</li><li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶</li><li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</li></ul><h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><p>JVM JRE JDKçš„åŒºåˆ«</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png" alt="img"></a></p><h1 id="äºŒã€å†…å­˜ç»“æ„"><a href="#äºŒã€å†…å­˜ç»“æ„" class="headerlink" title="äºŒã€å†…å­˜ç»“æ„"></a>äºŒã€å†…å­˜ç»“æ„</h1><p><strong>æ•´ä½“æ¶æ„</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png" alt="img"></a></p><h2 id="1ã€ç¨‹åºè®¡æ•°å™¨"><a href="#1ã€ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1ã€ç¨‹åºè®¡æ•°å™¨"></a>1ã€ç¨‹åºè®¡æ•°å™¨</h2><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨äºä¿å­˜JVMä¸­ä¸‹ä¸€æ¡æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>çº¿ç¨‹ç§æœ‰<ul><li>CPUä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œå½“å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ä½¿ç”¨å®Œä»¥åï¼ŒCPUå°±ä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç </li><li>ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ¯ä¸ªçº¿ç¨‹</strong>æ‰€<strong>ç§æœ‰</strong>çš„ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆè¿”å›æ¥æ‰§è¡Œå½“å‰çº¿ç¨‹çš„ä»£ç æ—¶ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨å¯ä»¥çŸ¥é“åº”è¯¥æ‰§è¡Œå“ªä¸€å¥æŒ‡ä»¤</li></ul></li><li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</li></ul><h2 id="2ã€è™šæ‹Ÿæœºæ ˆ"><a href="#2ã€è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2ã€è™šæ‹Ÿæœºæ ˆ"></a>2ã€è™šæ‹Ÿæœºæ ˆ</h2><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><ul><li>æ¯ä¸ª<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œç§°ä¸º<strong>è™šæ‹Ÿæœºæ ˆ</strong></li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰€å ç”¨çš„å†…å­˜</li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰<strong>ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”ç€<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</strong></li></ul><h4 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><p>ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        method1();    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>&#123;        method2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;        <span class="hljs-keyword">int</span> c = a + b;        <span class="hljs-keyword">return</span> c;    &#125;&#125;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png" alt="img"></a></p><p>åœ¨æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç±»ä¸­çš„æ–¹æ³•åœ¨è¿›å…¥è™šæ‹Ÿæœºæ ˆçš„æ—¶å€™ï¼Œç¬¦åˆæ ˆçš„ç‰¹ç‚¹</p><h4 id="é—®é¢˜è¾¨æ"><a href="#é—®é¢˜è¾¨æ" class="headerlink" title="é—®é¢˜è¾¨æ"></a>é—®é¢˜è¾¨æ</h4><ul><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ<ul><li><strong>ä¸éœ€è¦</strong>ã€‚å› ä¸ºè™šæ‹Ÿæœºæ ˆä¸­æ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«å¼¹å‡ºæ ˆã€‚æ‰€ä»¥æ— éœ€é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å»å›æ”¶å†…å­˜ã€‚</li></ul></li><li>æ ˆå†…å­˜çš„åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<ul><li>ä¸æ˜¯ã€‚å› ä¸º<strong>ç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„</strong>ï¼Œæ ˆå†…å­˜è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘ã€‚</li></ul></li><li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<ul><li>å¦‚æœæ–¹æ³•å†…<strong>å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li><li>å¦‚æœå¦‚æœ<strong>å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡</strong>ï¼Œå¹¶<strong>é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li></ul></li></ul><h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p><strong>Java.lang.stackOverflowError</strong> æ ˆå†…å­˜æº¢å‡º</p><p><strong>å‘ç”ŸåŸå› </strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­ï¼Œ<strong>æ ˆå¸§è¿‡å¤š</strong>ï¼ˆæ— é™é€’å½’ï¼‰</li><li>æ¯ä¸ªæ ˆå¸§<strong>æ‰€å ç”¨è¿‡å¤§</strong></li></ul><h4 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>çº¿ç¨‹è¿è¡Œè¯Šæ–­</h4><p>CPUå ç”¨è¿‡é«˜</p><ul><li>Linuxç¯å¢ƒä¸‹è¿è¡ŒæŸäº›ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´CPUçš„å ç”¨è¿‡é«˜ï¼Œè¿™æ—¶éœ€è¦å®šä½å ç”¨CPUè¿‡é«˜çš„çº¿ç¨‹<ul><li><strong>top</strong>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ª<strong>è¿›ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li><li><strong>ps H -eo pid, tidï¼ˆçº¿ç¨‹idï¼‰, %cpu | grep åˆšæ‰é€šè¿‡topæŸ¥åˆ°çš„è¿›ç¨‹å·</strong> é€šè¿‡pså‘½ä»¤è¿›ä¸€æ­¥æŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜</li><li><strong>jstack è¿›ç¨‹id</strong> é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„nidï¼Œåˆšæ‰é€šè¿‡pså‘½ä»¤çœ‹åˆ°çš„tidæ¥<strong>å¯¹æ¯”å®šä½</strong>ï¼Œæ³¨æ„jstackæŸ¥æ‰¾å‡ºçš„çº¿ç¨‹idæ˜¯<strong>16è¿›åˆ¶çš„</strong>ï¼Œ<strong>éœ€è¦è½¬æ¢</strong></li></ul></li></ul><h2 id="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3ã€æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"></a>3ã€æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>ä¸€äº›å¸¦æœ‰<strong>nativeå…³é”®å­—</strong>çš„æ–¹æ³•å°±æ˜¯éœ€è¦JAVAå»è°ƒç”¨æœ¬åœ°çš„Cæˆ–è€…C++æ–¹æ³•ï¼Œå› ä¸ºJAVAæœ‰æ—¶å€™æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•</p><h2 id="4ã€å †"><a href="#4ã€å †" class="headerlink" title="4ã€å †"></a>4ã€å †</h2><h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>é€šè¿‡newå…³é”®å­—<strong>åˆ›å»ºçš„å¯¹è±¡</strong>éƒ½ä¼šè¢«æ”¾åœ¨å †å†…å­˜</p><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡éƒ½éœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></li><li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li></ul><h4 id="å †å†…å­˜æº¢å‡º"><a href="#å †å†…å­˜æº¢å‡º" class="headerlink" title="å †å†…å­˜æº¢å‡º"></a>å †å†…å­˜æº¢å‡º</h4><p><strong>java.lang.OutofMemoryError</strong> ï¼šjava heap space. å †å†…å­˜æº¢å‡º</p><h4 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h4><p><strong>jps</strong></p><p><strong>jmap</strong></p><p><strong>jconsole</strong></p><p><strong>jvirsalvm</strong></p><h2 id="5ã€æ–¹æ³•åŒº"><a href="#5ã€æ–¹æ³•åŒº" class="headerlink" title="5ã€æ–¹æ³•åŒº"></a>5ã€æ–¹æ³•åŒº</h2><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" alt="img"></a></p><h4 id="å†…å­˜æº¢å‡º-1"><a href="#å†…å­˜æº¢å‡º-1" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><ul><li>1.8ä»¥å‰ä¼šå¯¼è‡´<strong>æ°¸ä¹…ä»£</strong>å†…å­˜æº¢å‡º</li><li>1.8ä»¥åä¼šå¯¼è‡´<strong>å…ƒç©ºé—´</strong>å†…å­˜æº¢å‡º</li></ul><h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç»„æˆï¼šç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€ç±»çš„æ–¹æ³•å®šä¹‰ï¼ˆåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰</p><p><strong>é€šè¿‡åç¼–è¯‘æ¥æŸ¥çœ‹ç±»çš„ä¿¡æ¯</strong></p><ul><li><p>è·å¾—å¯¹åº”ç±»çš„.classæ–‡ä»¶</p><ul><li><p>åœ¨JDKå¯¹åº”çš„binç›®å½•ä¸‹è¿è¡Œcmdï¼Œ<strong>ä¹Ÿå¯ä»¥åœ¨IDEAæ§åˆ¶å°è¾“å…¥</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png" alt="img"></a></p></li><li><p>è¾“å…¥ <strong>javac å¯¹åº”ç±»çš„ç»å¯¹è·¯å¾„</strong></p><div class="hljs code-wrapper"><pre><code class="hljs shell">F:\JAVA\JDK8.0\bin&gt;javac F:\Thread_study\src\com\nyima\JVM\day01\Main.java</code></pre></div><p>è¾“å…¥å®Œæˆåï¼Œå¯¹åº”çš„ç›®å½•ä¸‹å°±ä¼šå‡ºç°ç±»çš„.classæ–‡ä»¶</p></li></ul></li><li><p>åœ¨æ§åˆ¶å°è¾“å…¥ javap -v ç±»çš„ç»å¯¹è·¯å¾„</p><div class="hljs code-wrapper"><pre><code class="hljs sh">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.class</code></pre></div></li><li><p>ç„¶åèƒ½åœ¨æ§åˆ¶å°çœ‹åˆ°åç¼–è¯‘ä»¥åç±»çš„ä¿¡æ¯äº†</p><ul><li><p>ç±»çš„åŸºæœ¬ä¿¡æ¯</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png" alt="img"></a></p></li><li><p>å¸¸é‡æ± </p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png" alt="img"></a></p></li><li><p>è™šæ‹Ÿæœºä¸­æ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼ˆæ¡†å†…çš„æ˜¯çœŸæ­£ç¼–è¯‘æ‰§è¡Œçš„å†…å®¹ï¼Œ**#å·çš„å†…å®¹éœ€è¦åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾**ï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png" alt="img"></a></p></li></ul></li></ul><h4 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul><li>å¸¸é‡æ± <ul><li>å°±æ˜¯ä¸€å¼ è¡¨ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„constant poolï¼‰ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ä¿¡æ¯</li></ul></li><li>è¿è¡Œæ—¶å¸¸é‡æ± <ul><li>å¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥<strong>ç±»è¢«åŠ è½½ä»¥å</strong>ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼š<strong>æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¹¶æŠŠé‡Œé¢çš„<strong>ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</strong></li></ul></li></ul><h4 id="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"><a href="#å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»" class="headerlink" title="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"></a>å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»</h4><h5 id="ä¸²æ± StringTable"><a href="#ä¸²æ± StringTable" class="headerlink" title="ä¸²æ± StringTable"></a><strong>ä¸²æ± </strong>StringTable</h5><p><strong>ç‰¹å¾</strong></p><ul><li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰<strong>åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡</strong></li><li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li><li>å­—ç¬¦ä¸²<strong>å˜é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>StringBuilder</strong></li><li>å­—ç¬¦ä¸²<strong>å¸¸é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong></li><li>å¯ä»¥ä½¿ç”¨<strong>internæ–¹æ³•</strong>ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</li><li><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ä¸²æ± è¿˜æ˜¯å †é‡Œé¢çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¯¹è±¡</li></ul><p>ç”¨æ¥æ”¾å­—ç¬¦ä¸²å¯¹è±¡ä¸”é‡Œé¢çš„<strong>å…ƒç´ ä¸é‡å¤</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        String a = <span class="hljs-string">&quot;a&quot;</span>;         String b = <span class="hljs-string">&quot;b&quot;</span>;        String ab = <span class="hljs-string">&quot;ab&quot;</span>;    &#125;&#125;</code></pre></div><p>å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä½†è¿™æ˜¯a b ab ä»…æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œ<strong>è¿˜æ²¡æœ‰æˆä¸ºjavaå­—ç¬¦ä¸²</strong></p><div class="hljs code-wrapper"><pre><code class="hljs sh">0: ldc           <span class="hljs-comment">#2                  // String a</span>2: astore_13: ldc           <span class="hljs-comment">#3                  // String b</span>5: astore_26: ldc           <span class="hljs-comment">#4                  // String ab</span>8: astore_39: <span class="hljs-built_in">return</span></code></pre></div><p>å½“æ‰§è¡Œåˆ° ldc #2 æ—¶ï¼Œä¼šæŠŠç¬¦å· a å˜ä¸º â€œaâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>å¹¶æ”¾å…¥ä¸²æ± ä¸­</strong>ï¼ˆhashtableç»“æ„ ä¸å¯æ‰©å®¹ï¼‰</p><p>å½“æ‰§è¡Œåˆ° ldc #3 æ—¶ï¼Œä¼šæŠŠç¬¦å· b å˜ä¸º â€œbâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p><p>å½“æ‰§è¡Œåˆ° ldc #4 æ—¶ï¼Œä¼šæŠŠç¬¦å· ab å˜ä¸º â€œabâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p><p>æœ€ç»ˆ<strong>StringTable [â€œaâ€, â€œbâ€, â€œabâ€]</strong></p><p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯<strong>æ‡’æƒ°çš„</strong>ï¼Œåªæœ‰å½“è¿è¡Œåˆ°é‚£ä¸€è¡Œå­—ç¬¦ä¸²ä¸”åœ¨ä¸²æ± ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼ˆå¦‚ ldc #2ï¼‰æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ‰ä¼šè¢«åˆ›å»ºå¹¶æ”¾å…¥ä¸²æ± ä¸­ã€‚</p><p>ä½¿ç”¨æ‹¼æ¥<strong>å­—ç¬¦ä¸²å˜é‡å¯¹è±¡</strong>åˆ›å»ºå­—ç¬¦ä¸²çš„è¿‡ç¨‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        String a = <span class="hljs-string">&quot;a&quot;</span>;        String b = <span class="hljs-string">&quot;b&quot;</span>;        String ab = <span class="hljs-string">&quot;ab&quot;</span>;        <span class="hljs-comment">//æ‹¼æ¥å­—ç¬¦ä¸²å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²</span>        String ab2 = a+b;     &#125;&#125;</code></pre></div><p>åç¼–è¯‘åçš„ç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs shell">     Code:      stack=2, locals=5, args_size=1         0: ldc           #2                  // String a         2: astore_1         3: ldc           #3                  // String b         5: astore_2         6: ldc           #4                  // String ab         8: astore_3         9: new           #5                  // class java/lang/StringBuilder        12: dup        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V        16: aload_1        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;        20: aload_2        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;        27: astore        4        29: return</code></pre></div><p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„<strong>è¿‡ç¨‹</strong>æ˜¯ï¼šStringBuilder().append(â€œaâ€).append(â€œbâ€).toString()</p><p>æœ€åçš„toStringæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>æ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œä½†å­—ç¬¦ä¸²çš„<strong>å€¼</strong>å’Œæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸€è‡´ï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œ<strong>ä¸€ä¸ªå­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œä¸€ä¸ªå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">String ab = <span class="hljs-string">&quot;ab&quot;</span>;String ab2 = a+b;<span class="hljs-comment">//ç»“æœä¸ºfalse,å› ä¸ºabæ˜¯å­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œab2æ˜¯ç”±StringBufferçš„toStringæ–¹æ³•æ‰€è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span>System.out.println(ab == ab2);</code></pre></div><p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡</strong>çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        String a = <span class="hljs-string">&quot;a&quot;</span>;        String b = <span class="hljs-string">&quot;b&quot;</span>;        String ab = <span class="hljs-string">&quot;ab&quot;</span>;        String ab2 = a+b;        <span class="hljs-comment">//ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</span>        String ab3 = <span class="hljs-string">&quot;a&quot;</span> + <span class="hljs-string">&quot;b&quot;</span>;    &#125;&#125;</code></pre></div><p>åç¼–è¯‘åçš„ç»“æœ</p><div class="hljs code-wrapper"><pre><code class="hljs java">       Code:      stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">6</span>, args_size=<span class="hljs-number">1</span>         0: ldc           #2                  // String a         <span class="hljs-number">2</span>: astore_1         3: ldc           #3                  // String b         <span class="hljs-number">5</span>: astore_2         6: ldc           #4                  // String ab         <span class="hljs-number">8</span>: astore_3         9: new           #5                  // class java/lang/StringBuilder        <span class="hljs-number">12</span>: dup        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V        <span class="hljs-number">16</span>: aload_1        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;        <span class="hljs-number">20</span>: aload_2        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;        <span class="hljs-number">27</span>: astore        <span class="hljs-number">4</span>        <span class="hljs-comment">//ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²</span>        29: ldc           #4                  // String ab        <span class="hljs-number">31</span>: astore        <span class="hljs-number">5</span>        <span class="hljs-number">33</span>: <span class="hljs-keyword">return</span></code></pre></div><ul><li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸º<strong>å†…å®¹æ˜¯å¸¸é‡ï¼Œjavacåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç»“æœå·²åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</strong>ï¼Œè€Œåˆ›å»ºabçš„æ—¶å€™å·²ç»åœ¨ä¸²æ± ä¸­æ”¾å…¥äº†â€œabâ€ï¼Œæ‰€ä»¥ab3ç›´æ¥ä»ä¸²æ± ä¸­è·å–å€¼ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ“ä½œå’Œ ab = â€œabâ€ ä¸€è‡´ã€‚</li><li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å˜é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå†…å®¹æ˜¯å˜é‡ï¼Œåªèƒ½<strong>åœ¨è¿è¡ŒæœŸç¡®å®šå®ƒçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨StringBuilderæ¥åˆ›å»º</strong></li></ul><h5 id="internæ–¹æ³•-1-8"><a href="#internæ–¹æ³•-1-8" class="headerlink" title="internæ–¹æ³• 1.8"></a>internæ–¹æ³• 1.8</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p><ul><li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥æˆåŠŸ</li><li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li></ul><p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p><p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶å¦‚æœè°ƒç”¨internæ–¹æ³•æˆåŠŸï¼Œå †å†…å­˜ä¸ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p><p><strong>ä¾‹1</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span>        String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);        <span class="hljs-comment">//è°ƒç”¨strçš„internæ–¹æ³•ï¼Œè¿™æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span>        String st2 = str.intern();        <span class="hljs-comment">//ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span>        String str3 = <span class="hljs-string">&quot;ab&quot;</span>;        <span class="hljs-comment">//å› ä¸ºå †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤æ¡è¯­å¥æ‰“å°çš„éƒ½ä¸ºtrue</span>        System.out.println(str == st2);        System.out.println(str == str3);    &#125;&#125;</code></pre></div><p><strong>ä¾‹2</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">//æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span>        String str3 = <span class="hljs-string">&quot;ab&quot;</span>;        <span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span>        String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);        <span class="hljs-comment">//æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span>        String str2 = str.intern();        <span class="hljs-comment">//false</span>        System.out.println(str == str2);        <span class="hljs-comment">//false</span>        System.out.println(str == str3);        <span class="hljs-comment">//true</span>        System.out.println(str2 == str3);    &#125;&#125;</code></pre></div><h5 id="internæ–¹æ³•-1-6"><a href="#internæ–¹æ³•-1-6" class="headerlink" title="internæ–¹æ³• 1.6"></a>internæ–¹æ³• 1.6</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p><ul><li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå†æ”¾å…¥åˆ°ä¸²æ± ä¸­</li><li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li></ul><p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p><p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶æ— è®ºè°ƒç”¨internæ–¹æ³•æˆåŠŸä¸å¦ï¼Œä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œå †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡<strong>éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></p><h4 id="StringTable-åƒåœ¾å›æ”¶"><a href="#StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="StringTable åƒåœ¾å›æ”¶"></a>StringTable åƒåœ¾å›æ”¶</h4><p>StringTableåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šå‘ç”Ÿåƒåœ¾å›æ”¶</p><h4 id="StringTableè°ƒä¼˜"><a href="#StringTableè°ƒä¼˜" class="headerlink" title="StringTableè°ƒä¼˜"></a>StringTableè°ƒä¼˜</h4><ul><li><p>å› ä¸ºStringTableæ˜¯ç”±HashTableå®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥<strong>é€‚å½“å¢åŠ HashTableæ¡¶çš„ä¸ªæ•°</strong>ï¼Œæ¥å‡å°‘å­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± æ‰€éœ€è¦çš„æ—¶é—´</p><div class="hljs code-wrapper"><pre><code class="hljs routeros">-XX:<span class="hljs-attribute">StringTableSize</span>=xxxx</code></pre></div></li><li><p>è€ƒè™‘æ˜¯å¦éœ€è¦å°†å­—ç¬¦ä¸²å¯¹è±¡å…¥æ± </p><p>å¯ä»¥é€šè¿‡<strong>internæ–¹æ³•å‡å°‘é‡å¤å…¥æ± </strong></p></li></ul><h2 id="6ã€ç›´æ¥å†…å­˜"><a href="#6ã€ç›´æ¥å†…å­˜" class="headerlink" title="6ã€ç›´æ¥å†…å­˜"></a>6ã€ç›´æ¥å†…å­˜</h2><ul><li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li><li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li></ul><h4 id="æ–‡ä»¶è¯»å†™æµç¨‹"><a href="#æ–‡ä»¶è¯»å†™æµç¨‹" class="headerlink" title="æ–‡ä»¶è¯»å†™æµç¨‹"></a>æ–‡ä»¶è¯»å†™æµç¨‹</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png" alt="img"></a></p><p><strong>ä½¿ç”¨äº†DirectBuffer</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png" alt="img"></a></p><p>ç›´æ¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿå’ŒJavaä»£ç <strong>éƒ½å¯ä»¥è®¿é—®çš„ä¸€å—åŒºåŸŸ</strong>ï¼Œæ— éœ€å°†ä»£ç ä»ç³»ç»Ÿå†…å­˜å¤åˆ¶åˆ°Javaå †å†…å­˜ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p><h4 id="é‡Šæ”¾åŸç†"><a href="#é‡Šæ”¾åŸç†" class="headerlink" title="é‡Šæ”¾åŸç†"></a>é‡Šæ”¾åŸç†</h4><p>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸æ˜¯é€šè¿‡JVMçš„åƒåœ¾å›æ”¶æ¥é‡Šæ”¾çš„ï¼Œè€Œæ˜¯é€šè¿‡<strong>unsafe.freeMemory</strong>æ¥æ‰‹åŠ¨é‡Šæ”¾</p><p>é€šè¿‡</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡ByteBufferç”³è¯·1Mçš„ç›´æ¥å†…å­˜</span>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1M);</code></pre></div><p>ç”³è¯·ç›´æ¥å†…å­˜ï¼Œä½†JVMå¹¶ä¸èƒ½å›æ”¶ç›´æ¥å†…å­˜ä¸­çš„å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°å›æ”¶çš„å‘¢ï¼Ÿ</p><p><strong>allocateDirectçš„å®ç°</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocateDirect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectByteBuffer(capacity);&#125;</code></pre></div><p>DirectByteBufferç±»</p><div class="hljs code-wrapper"><pre><code class="hljs java">DirectByteBuffer(<span class="hljs-keyword">int</span> cap) &#123;   <span class="hljs-comment">// package-private</span>    <span class="hljs-keyword">super</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, cap, cap);    <span class="hljs-keyword">boolean</span> pa = VM.isDirectMemoryPageAligned();    <span class="hljs-keyword">int</span> ps = Bits.pageSize();    <span class="hljs-keyword">long</span> size = Math.max(<span class="hljs-number">1L</span>, (<span class="hljs-keyword">long</span>)cap + (pa ? ps : <span class="hljs-number">0</span>));    Bits.reserveMemory(size, cap);    <span class="hljs-keyword">long</span> base = <span class="hljs-number">0</span>;    <span class="hljs-keyword">try</span> &#123;        base = unsafe.allocateMemory(size); <span class="hljs-comment">//ç”³è¯·å†…å­˜</span>    &#125; <span class="hljs-keyword">catch</span> (OutOfMemoryError x) &#123;        Bits.unreserveMemory(size, cap);        <span class="hljs-keyword">throw</span> x;    &#125;    unsafe.setMemory(base, size, (<span class="hljs-keyword">byte</span>) <span class="hljs-number">0</span>);    <span class="hljs-keyword">if</span> (pa &amp;&amp; (base % ps != <span class="hljs-number">0</span>)) &#123;        <span class="hljs-comment">// Round up to page boundary</span>        address = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>));    &#125; <span class="hljs-keyword">else</span> &#123;        address = base;    &#125;    cleaner = Cleaner.create(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> Deallocator(base, size, cap)); <span class="hljs-comment">//é€šè¿‡è™šå¼•ç”¨ï¼Œæ¥å®ç°ç›´æ¥å†…å­˜çš„é‡Šæ”¾ï¼Œthisä¸ºè™šå¼•ç”¨çš„å®é™…å¯¹è±¡</span>    att = <span class="hljs-keyword">null</span>;&#125;</code></pre></div><p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªCleanerçš„createæ–¹æ³•ï¼Œä¸”åå°çº¿ç¨‹è¿˜ä¼šå¯¹è™šå¼•ç”¨çš„å¯¹è±¡ç›‘æµ‹ï¼Œå¦‚æœè™šå¼•ç”¨çš„å®é™…å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯DirectByteBufferï¼‰è¢«å›æ”¶ä»¥åï¼Œå°±ä¼šè°ƒç”¨Cleanerçš„cleanæ–¹æ³•ï¼Œæ¥æ¸…é™¤ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clean</span><span class="hljs-params">()</span> </span>&#123;       <span class="hljs-keyword">if</span> (remove(<span class="hljs-keyword">this</span>)) &#123;           <span class="hljs-keyword">try</span> &#123;               <span class="hljs-keyword">this</span>.thunk.run(); <span class="hljs-comment">//è°ƒç”¨runæ–¹æ³•</span>           &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> Throwable var2) &#123;               AccessController.doPrivileged(<span class="hljs-keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;                   <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                       <span class="hljs-keyword">if</span> (System.err != <span class="hljs-keyword">null</span>) &#123;                           (<span class="hljs-keyword">new</span> Error(<span class="hljs-string">&quot;Cleaner terminated abnormally&quot;</span>, var2)).printStackTrace();                       &#125;                       System.exit(<span class="hljs-number">1</span>);                       <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;                   &#125;               &#125;);           &#125;</code></pre></div><p>å¯¹åº”å¯¹è±¡çš„runæ–¹æ³•</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">if</span> (address == <span class="hljs-number">0</span>) &#123;        <span class="hljs-comment">// Paranoia</span>        <span class="hljs-keyword">return</span>;    &#125;    unsafe.freeMemory(address); <span class="hljs-comment">//é‡Šæ”¾ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</span>    address = <span class="hljs-number">0</span>;    Bits.unreserveMemory(size, capacity);&#125;</code></pre></div><h5 id="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"><a href="#ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“" class="headerlink" title="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"></a>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</h5><ul><li>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li><li>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜</li></ul><h1 id="ä¸‰ã€åƒåœ¾å›æ”¶"><a href="#ä¸‰ã€åƒåœ¾å›æ”¶" class="headerlink" title="ä¸‰ã€åƒåœ¾å›æ”¶"></a>ä¸‰ã€åƒåœ¾å›æ”¶</h1><h2 id="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h2><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png" alt="img"></a></p><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><ul><li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li><li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li><li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ã€€</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul></li></ul><h4 id="äº”ç§å¼•ç”¨"><a href="#äº”ç§å¼•ç”¨" class="headerlink" title="äº”ç§å¼•ç”¨"></a>äº”ç§å¼•ç”¨</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png" alt="img"></a></p><h5 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h5><p>åªæœ‰GC Root<strong>éƒ½ä¸å¼•ç”¨</strong>è¯¥å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå›æ”¶<strong>å¼ºå¼•ç”¨</strong>å¯¹è±¡</p><ul><li>å¦‚ä¸Šå›¾Bã€Cå¯¹è±¡éƒ½ä¸å¼•ç”¨A1å¯¹è±¡æ—¶ï¼ŒA1å¯¹è±¡æ‰ä¼šè¢«å›æ”¶</li></ul><h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>å½“GC RootæŒ‡å‘è½¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåœ¨<strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼Œä¼š<strong>å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</strong></p><ul><li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A2å¯¹è±¡ä¸”å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„A2å¯¹è±¡å°±ä¼šè¢«å›æ”¶</li></ul><h6 id="è½¯å¼•ç”¨çš„ä½¿ç”¨"><a href="#è½¯å¼•ç”¨çš„ä½¿ç”¨" class="headerlink" title="è½¯å¼•ç”¨çš„ä½¿ç”¨"></a>è½¯å¼•ç”¨çš„ä½¿ç”¨</h6><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;        <span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span>        List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);    &#125;&#125;</code></pre></div><p>å¦‚æœåœ¨åƒåœ¾å›æ”¶æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼Œåœ¨å›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œ<strong>è½¯å¼•ç”¨æœ¬èº«ä¸ä¼šè¢«æ¸…ç†</strong></p><p>å¦‚æœæƒ³è¦<strong>æ¸…ç†è½¯å¼•ç”¨</strong>ï¼Œéœ€è¦ä½¿<strong>ç”¨å¼•ç”¨é˜Ÿåˆ—</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;        <span class="hljs-comment">//ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨äºç§»é™¤å¼•ç”¨ä¸ºç©ºçš„è½¯å¼•ç”¨å¯¹è±¡</span>        ReferenceQueue&lt;<span class="hljs-keyword">byte</span>[]&gt; queue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();        <span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span>        List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);        <span class="hljs-comment">//éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ ï¼Œåˆ™ç§»é™¤</span>        Reference&lt;? extends <span class="hljs-keyword">byte</span>[]&gt; poll = queue.poll();        <span class="hljs-keyword">while</span>(poll != <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-comment">//å¼•ç”¨é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ä»é›†åˆä¸­ç§»é™¤è¯¥å…ƒç´ </span>            list.remove(poll);            <span class="hljs-comment">//ç§»åŠ¨åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span>            poll = queue.poll();        &#125;    &#125;&#125;</code></pre></div><p><strong>å¤§æ¦‚æ€è·¯ä¸ºï¼š</strong>æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ— è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†è¯¥è½¯å¼•ç”¨ä»å­˜æ”¾å®ƒçš„é›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œä¸ºä¸€ä¸ªlisté›†åˆï¼‰</p><h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>åªæœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p><ul><li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A3å¯¹è±¡ï¼Œåˆ™A3å¯¹è±¡ä¼šè¢«å›æ”¶</li></ul><p><strong>å¼±å¼•ç”¨çš„ä½¿ç”¨å’Œè½¯å¼•ç”¨ç±»ä¼¼</strong>ï¼Œåªæ˜¯å°† <strong>SoftReference æ¢ä¸ºäº† WeakReference</strong></p><h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a><strong>è™šå¼•ç”¨</strong></h5><p>å½“è™šå¼•ç”¨å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨è™šå¼•ç”¨çš„æ–¹æ³•</p><ul><li>è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯<strong>é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜</strong>ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li><li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li></ul><h5 id="ç»ˆç»“å™¨å¼•ç”¨"><a href="#ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="ç»ˆç»“å™¨å¼•ç”¨"></a>ç»ˆç»“å™¨å¼•ç”¨</h5><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥é¥®ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</p><ul><li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨A4å¯¹è±¡ã€‚è¿™æ˜¯ç»ˆç»“å™¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå¼•ç”¨é˜Ÿåˆ—ä¼šæ ¹æ®å®ƒï¼Œæ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åè°ƒç”¨è¢«å¼•ç”¨å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</li></ul><h5 id="å¼•ç”¨é˜Ÿåˆ—"><a href="#å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—"></a>å¼•ç”¨é˜Ÿåˆ—</h5><ul><li>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨<strong>å¯ä»¥é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul><li>åœ¨<strong>å¼±å¼•ç”¨</strong>å’Œ<strong>è™šå¼•ç”¨</strong>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œä¼šå°†è¿™äº›å¼•ç”¨æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä¸€èµ·å›æ”¶è¿™äº›è½¯/å¼±å¼•ç”¨å¯¹è±¡</li></ul></li><li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨<strong>å¿…é¡»é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul><li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨åœ¨ä½¿ç”¨æ—¶ä¼šå…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</li></ul></li></ul><h2 id="2ã€åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2ã€åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2ã€åƒåœ¾å›æ”¶ç®—æ³•"></a>2ã€åƒåœ¾å›æ”¶ç®—æ³•</h2><h4 id="æ ‡è®°-æ¸…é™¤"><a href="#æ ‡è®°-æ¸…é™¤" class="headerlink" title="æ ‡è®°-æ¸…é™¤"></a>æ ‡è®°-æ¸…é™¤</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png" alt="img"></a></p><p><strong>å®šä¹‰</strong>ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºæ‰§è¡Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆé‡‡ç”¨æ ‡è®°ç®—æ³•ç¡®å®šå¯å›æ”¶å¯¹è±¡ï¼Œç„¶ååƒåœ¾æ”¶é›†å™¨æ ¹æ®æ ‡è¯†æ¸…é™¤ç›¸åº”çš„å†…å®¹ï¼Œç»™å †å†…å­˜è…¾å‡ºç›¸åº”çš„ç©ºé—´</p><ul><li>è¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸…0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢</p><h4 id="æ ‡è®°-æ•´ç†"><a href="#æ ‡è®°-æ•´ç†" class="headerlink" title="æ ‡è®°-æ•´ç†"></a>æ ‡è®°-æ•´ç†</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png" alt="img"></a></p><p>æ ‡è®°-æ•´ç† ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…æ¥šå…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•´ä½“éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½</p><h4 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png" alt="img"></a></p><p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼ŒFROMå’ŒTOï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="3ã€åˆ†ä»£å›æ”¶"><a href="#3ã€åˆ†ä»£å›æ”¶" class="headerlink" title="3ã€åˆ†ä»£å›æ”¶"></a>3ã€åˆ†ä»£å›æ”¶</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png" alt="img"></a></p><h4 id="å›æ”¶æµç¨‹"><a href="#å›æ”¶æµç¨‹" class="headerlink" title="å›æ”¶æµç¨‹"></a>å›æ”¶æµç¨‹</h4><p>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«æ”¾åœ¨äº†<strong>æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­</strong>ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png" alt="img"></a></p><p>å½“ä¼Šç”¸å›­ä¸­çš„å†…å­˜ä¸è¶³æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ—¶çš„å›æ”¶å«åš <strong>Minor GC</strong></p><p>Minor GC ä¼šå°†<strong>ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºFROM</strong>å­˜æ´»çš„å¯¹è±¡<strong>å…ˆ</strong>å¤åˆ¶åˆ° <strong>å¹¸å­˜åŒº TO</strong>ä¸­ï¼Œ å¹¶è®©å…¶<strong>å¯¿å‘½åŠ 1</strong>ï¼Œå†<strong>äº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒº</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png" alt="img"></a></p><p>å†æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œè‹¥æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­åˆæ»¡äº†ï¼Œåˆ™ä¼š<strong>å†æ¬¡è§¦å‘ Minor GC</strong>ï¼ˆä¼šè§¦å‘ <strong>stop the world</strong>ï¼Œ æš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåªè®©åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œï¼‰ï¼Œè¿™æ—¶ä¸ä»…ä¼šå›æ”¶ä¼Šç”¸å›­ä¸­çš„åƒåœ¾ï¼Œ<strong>è¿˜ä¼šå›æ”¶å¹¸å­˜åŒºä¸­çš„åƒåœ¾</strong>ï¼Œå†å°†æ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ã€‚å›æ”¶ä»¥åä¼šäº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒºï¼Œå¹¶è®©å¹¸å­˜åŒºä¸­çš„å¯¹è±¡<strong>å¯¿å‘½åŠ 1</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png" alt="img"></a></p><p>å¦‚æœå¹¸å­˜åŒºä¸­çš„å¯¹è±¡çš„<strong>å¯¿å‘½è¶…è¿‡æŸä¸ªé˜ˆå€¼</strong>ï¼ˆæœ€å¤§ä¸º15ï¼Œ4bitï¼‰ï¼Œå°±ä¼šè¢«<strong>æ”¾å…¥è€å¹´ä»£</strong>ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png" alt="img"></a></p><p>å¦‚æœæ–°ç”Ÿä»£è€å¹´ä»£ä¸­çš„å†…å­˜éƒ½æ»¡äº†ï¼Œå°±ä¼šå…ˆå‡ºæ³•Minor Gcï¼Œå†è§¦å‘<strong>Full GC</strong>ï¼Œæ‰«æ<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸­</strong>æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶å›æ”¶</p><h4 id="GC-åˆ†æ"><a href="#GC-åˆ†æ" class="headerlink" title="GC åˆ†æ"></a>GC åˆ†æ</h4><h5 id="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"><a href="#å¤§å¯¹è±¡å¤„ç†ç­–ç•¥" class="headerlink" title="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"></a>å¤§å¯¹è±¡å¤„ç†ç­–ç•¥</h5><p>å½“é‡åˆ°ä¸€ä¸ª<strong>è¾ƒå¤§çš„å¯¹è±¡</strong>æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„<strong>ä¼Šç”¸å›­</strong>ä¸ºç©ºï¼Œä¹Ÿ<strong>æ— æ³•å®¹çº³è¯¥å¯¹è±¡</strong>æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡<strong>ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£</strong></p><h5 id="çº¿ç¨‹å†…å­˜æº¢å‡º"><a href="#çº¿ç¨‹å†…å­˜æº¢å‡º" class="headerlink" title="çº¿ç¨‹å†…å­˜æº¢å‡º"></a>çº¿ç¨‹å†…å­˜æº¢å‡º</h5><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ</p><p>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹<strong>æŠ›å‡ºOOMå¼‚å¸¸å</strong>ï¼Œ<strong>å®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰</strong>ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œ<strong>è¿›ç¨‹ä¾ç„¶æ­£å¸¸</strong></p><h2 id="4ã€åƒåœ¾å›æ”¶å™¨"><a href="#4ã€åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4ã€åƒåœ¾å›æ”¶å™¨"></a>4ã€åƒåœ¾å›æ”¶å™¨</h2><h4 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h4><p><strong>å¹¶è¡Œæ”¶é›†</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</p><p><strong>å¹¶å‘æ”¶é›†</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹<strong>åŒæ—¶å·¥ä½œ</strong>ï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚<strong>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œ</strong>ï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š</p><p><strong>ååé‡</strong>ï¼šå³CPUç”¨äº<strong>è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´</strong>ä¸CPU<strong>æ€»æ¶ˆè€—æ—¶é—´</strong>çš„æ¯”å€¼ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ100åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99%</p><h4 id="ä¸²è¡Œ"><a href="#ä¸²è¡Œ" class="headerlink" title="ä¸²è¡Œ"></a>ä¸²è¡Œ</h4><ul><li>å•çº¿ç¨‹</li><li>å†…å­˜è¾ƒå°ï¼Œä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ï¼‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png" alt="img"></a></p><p><strong>å®‰å…¨ç‚¹</strong>ï¼šè®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡</p><p>å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥<strong>é˜»å¡</strong>çŠ¶æ€</p><h5 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h5><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹ï¼š</strong>å•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ‰‹æœºæ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰</p><h5 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h5><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ã€ParNewæ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨-XX:ParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’ŒSerialæ”¶é›†å™¨ä¸€æ ·å­˜åœ¨Stop The Worldé—®é¢˜</p><h5 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h5><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p><h4 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li><li>å•ä½æ—¶é—´å†…ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li><li><strong>JDK1.8é»˜è®¤ä½¿ç”¨</strong>çš„åƒåœ¾å›æ”¶å™¨</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png" alt="img"></a></p><h5 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h5><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ParNewæ”¶é›†å™¨ç±»ä¼¼ï¼‰</p><p>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼š<strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼ˆä¸ParNewæ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p><p><strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼šParallel Scavengeæ”¶é›†å™¨å¯è®¾ç½®-XX:+UseAdptiveSizePolicyå‚æ•°ã€‚å½“å¼€å…³æ‰“å¼€æ—¶<strong>ä¸éœ€è¦</strong>æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p><p>Parallel Scavengeæ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</p><ul><li>XX:MaxGCPauseMillis æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li><li>XX:GCRatio ç›´æ¥è®¾ç½®ååé‡çš„å¤§å°</li></ul><h5 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a><strong>Parallel Old æ”¶é›†å™¨</strong></h5><p>æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè€å¹´ä»£æ²¡æœ‰å¹¸å­˜åŒºï¼‰</p><h4 id="å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆ"></a>å“åº”æ—¶é—´ä¼˜å…ˆ</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li><li>å°½å¯èƒ½è®©å•æ¬¡STWæ—¶é—´å˜çŸ­ï¼ˆå°½é‡ä¸å½±å“å…¶ä»–çº¿ç¨‹è¿è¡Œï¼‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png" alt="img"></a></p><h5 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h5><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–<strong>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„<strong>è€å¹´ä»£</strong>æ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäº<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡</p><p><strong>CMSæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</strong></p><p><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯<strong>ä»å­˜åœ¨Stop The Worldé—®é¢˜</strong></p><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</p><p><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The Worldé—®é¢˜</p><p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶</p><p>CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·<strong>å¹¶å‘æ‰§è¡Œ</strong>çš„</p><h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><h5 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a><strong>å®šä¹‰</strong>ï¼š</h5><p>Garbage First</p><p>JDK 9ä»¥åé»˜è®¤ä½¿ç”¨ï¼Œè€Œä¸”æ›¿ä»£äº†CMS æ”¶é›†å™¨</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png" alt="img"></a></p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul><li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li><li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª<strong>å¤§å°ç›¸ç­‰</strong>çš„åŒºåŸŸ</li><li>æ•´ä½“ä¸Šæ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯<strong>å¤åˆ¶</strong>ç®—æ³•</li></ul><p><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€éœ€è¦å‚æ•°å¼€å¯</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png" alt="img"></a></p><h5 id="G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>G1åƒåœ¾å›æ”¶é˜¶æ®µ</h5><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png" alt="img"></a></p><p>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶â€”â€“&gt;å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°â€”â€“&gt;å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜â€”â€”&gt;æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶(é‡æ–°å¼€å§‹)</p><h5 id="Young-Collection"><a href="#Young-Collection" class="headerlink" title="Young Collection"></a>Young Collection</h5><p><strong>åˆ†åŒºç®—æ³•region</strong></p><p>åˆ†ä»£æ˜¯æŒ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼Œåˆ†åŒºåˆ™æ˜¯å°†å †ç©ºé—´åˆ’åˆ†è¿ç»­å‡ ä¸ªä¸åŒå°åŒºé—´ï¼Œæ¯ä¸€ä¸ªå°åŒºé—´ç‹¬ç«‹å›æ”¶ï¼Œå¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ï¼Œæ–¹ä¾¿æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´</p><p>Eï¼šä¼Šç”¸å›­ Sï¼šå¹¸å­˜åŒº Oï¼šè€å¹´ä»£</p><ul><li>ä¼šSTW</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png" alt="img"></a></p><h5 id="Young-Collection-CM"><a href="#Young-Collection-CM" class="headerlink" title="Young Collection + CM"></a>Young Collection + CM</h5><p>CMï¼šå¹¶å‘æ ‡è®°</p><ul><li>åœ¨ Young GC æ—¶ä¼š<strong>å¯¹ GC Root è¿›è¡Œåˆå§‹æ ‡è®°</strong></li><li>åœ¨è€å¹´ä»£<strong>å ç”¨å †å†…å­˜çš„æ¯”ä¾‹</strong>è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¯¹è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼šSTWï¼‰ï¼Œé˜ˆå€¼å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥è¿›è¡Œè®¾å®š</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png" alt="img"></a></p><h5 id="Mixed-Collection"><a href="#Mixed-Collection" class="headerlink" title="Mixed Collection"></a>Mixed Collection</h5><p>ä¼šå¯¹E S O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong></p><ul><li>æœ€ç»ˆæ ‡è®°</li><li><strong>æ‹·è´</strong>å­˜æ´»</li></ul><p>-XX:MaxGCPauseMills:xxx ç”¨äºæŒ‡å®šæœ€é•¿çš„åœé¡¿æ—¶é—´</p><p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ</p><p>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„åœé¡¿æ—¶é—´ï¼Œä¼š<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png" alt="img"></a></p><h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><p>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰</p><ul><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†</li><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GC</li></ul><h5 id="Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="Young Collection è·¨ä»£å¼•ç”¨"></a>Young Collection è·¨ä»£å¼•ç”¨</h5><ul><li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png" alt="img"></a></p><ul><li>å¡è¡¨ä¸Remembered Set<ul><li>Remembered Set å­˜åœ¨äºEä¸­ï¼Œç”¨äºä¿å­˜æ–°ç”Ÿä»£å¯¹è±¡å¯¹åº”çš„è„å¡<ul><li>è„å¡ï¼šOè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆä¸€ä¸ªåŒºåŸŸ512Kï¼‰ï¼Œå¦‚æœè¯¥åŒºåŸŸå¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œåˆ™è¯¥åŒºåŸŸè¢«ç§°ä¸ºè„å¡</li></ul></li></ul></li><li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡post-write barried + dirty card queue</li><li>concurrent refinement threads æ›´æ–° Remembered Set</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png" alt="img"></a></p><h5 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h5><p>é‡æ–°æ ‡è®°é˜¶æ®µ</p><p>åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ”¶é›†å™¨å¤„ç†å¯¹è±¡çš„è¿‡ç¨‹ä¸­</p><p>é»‘è‰²ï¼šå·²è¢«å¤„ç†ï¼Œéœ€è¦ä¿ç•™çš„ ç°è‰²ï¼šæ­£åœ¨å¤„ç†ä¸­çš„ ç™½è‰²ï¼šè¿˜æœªå¤„ç†çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png" alt="img"></a></p><p>ä½†æ˜¯åœ¨<strong>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­</strong>ï¼Œæœ‰å¯èƒ½Aè¢«å¤„ç†äº†ä»¥åæœªå¼•ç”¨Cï¼Œä½†è¯¥å¤„ç†è¿‡ç¨‹è¿˜æœªç»“æŸï¼Œåœ¨å¤„ç†è¿‡ç¨‹ç»“æŸä¹‹å‰Aå¼•ç”¨äº†Cï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°remark</p><p>è¿‡ç¨‹å¦‚ä¸‹</p><ul><li>ä¹‹å‰Cæœªè¢«å¼•ç”¨ï¼Œè¿™æ—¶Aå¼•ç”¨äº†Cï¼Œå°±ä¼šç»™CåŠ ä¸€ä¸ªå†™å±éšœï¼Œå†™å±éšœçš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œå°†Cæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶å°†Cå˜ä¸º å¤„ç†ä¸­ çŠ¶æ€</li><li>åœ¨<strong>å¹¶å‘æ ‡è®°</strong>é˜¶æ®µç»“æŸä»¥åï¼Œé‡æ–°æ ‡è®°é˜¶æ®µä¼šSTWï¼Œç„¶åå°†æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°å¤„ç†ï¼Œå‘ç°æœ‰å¼ºå¼•ç”¨å¼•ç”¨å®ƒï¼Œå°±ä¼šå¤„ç†å®ƒ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png" alt="img"></a></p><h5 id="JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>JDK 8u20 å­—ç¬¦ä¸²å»é‡</h5><p>è¿‡ç¨‹</p><ul><li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²ï¼ˆåº•å±‚æ˜¯char[]ï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li><li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²</li><li>å¦‚æœå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ï¼Œå°±è®©ä»–ä»¬<strong>å¼•ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong></li><li>æ³¨æ„ï¼Œå…¶ä¸String.internçš„åŒºåˆ«<ul><li>internå…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li><li>å­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[]</li><li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²æ ‡</li></ul></li></ul><p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p><ul><li>èŠ‚çœäº†å¤§é‡å†…å­˜</li><li>æ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ ï¼Œå¯¼è‡´ç•¥å¾®å¤šå ç”¨CPU</li></ul><h5 id="JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h5><p>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸä»¥åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸åœ¨ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</p><h5 id="JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h5><ul><li>ä¸€ä¸ªå¯¹è±¡å¤§äºregionçš„ä¸€åŠæ—¶ï¼Œå°±ç§°ä¸ºå·¨å‹å¯¹è±¡</li><li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li><li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li><li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå¦‚æœè€å¹´ä»£incomingå¼•ç”¨ä¸º0çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png" alt="img"></a></p><h2 id="5ã€GC-è°ƒä¼˜"><a href="#5ã€GC-è°ƒä¼˜" class="headerlink" title="5ã€GC è°ƒä¼˜"></a>5ã€GC è°ƒä¼˜</h2><p>æŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°å‘½ä»¤</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-string">&quot;F:\JAVA\JDK8.0\bin\java&quot;</span> -XX:+PrintFlagsFinal -version | findstr <span class="hljs-string">&quot;GC&quot;</span></code></pre></div><p>å¯ä»¥æ ¹æ®å‚æ•°å»æŸ¥è¯¢å…·ä½“çš„ä¿¡æ¯</p><h4 id="è°ƒä¼˜é¢†åŸŸ"><a href="#è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="è°ƒä¼˜é¢†åŸŸ"></a>è°ƒä¼˜é¢†åŸŸ</h4><ul><li>å†…å­˜</li><li>é”ç«äº‰</li><li>CPUå ç”¨</li><li>IO</li><li>GC</li></ul><h4 id="ç¡®å®šç›®æ ‡"><a href="#ç¡®å®šç›®æ ‡" class="headerlink" title="ç¡®å®šç›®æ ‡"></a>ç¡®å®šç›®æ ‡</h4><p>ä½å»¶è¿Ÿ/é«˜ååé‡ï¼Ÿ é€‰æ‹©åˆé€‚çš„GC</p><ul><li>CMS G1 ZGC</li><li>ParallelGC</li><li>Zing</li></ul><h4 id="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"><a href="#æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC" class="headerlink" title="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"></a>æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h4><p>é¦–å…ˆæ’é™¤å‡å°‘å› ä¸ºè‡ªèº«ç¼–å†™çš„ä»£ç è€Œå¼•å‘çš„å†…å­˜é—®é¢˜ </p><ul><li>æŸ¥çœ‹Full GCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<ul><li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ</li><li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿<ul><li>å¯¹è±¡å›¾</li><li>å¯¹è±¡å¤§å°</li></ul></li><li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</li></ul></li></ul><h4 id="æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="æ–°ç”Ÿä»£è°ƒä¼˜"></a>æ–°ç”Ÿä»£è°ƒä¼˜</h4><ul><li>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹<ul><li>æ‰€æœ‰çš„newæ“ä½œåˆ†é…å†…å­˜éƒ½æ˜¯éå¸¸å»‰ä»·çš„<ul><li>TLAB</li></ul></li><li>æ­»äº¡å¯¹è±¡å›æ”¶é›¶ä»£ä»·</li><li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»ï¼ˆæœç”Ÿå¤•æ­»ï¼‰</li><li>MInor GC æ‰€ç”¨æ—¶é—´è¿œå°äºFull GC</li></ul></li><li>æ–°ç”Ÿä»£å†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ<ul><li>ä¸æ˜¯<ul><li>æ–°ç”Ÿä»£å†…å­˜å¤ªå°ï¼šé¢‘ç¹è§¦å‘Minor GCï¼Œä¼šSTWï¼Œä¼šä½¿å¾—ååé‡ä¸‹é™</li><li>æ–°ç”Ÿä»£å†…å­˜å¤ªå¤§ï¼šè€å¹´ä»£å†…å­˜å æ¯”æœ‰æ‰€é™ä½ï¼Œä¼šæ›´é¢‘ç¹åœ°è§¦å‘Full GCã€‚è€Œä¸”è§¦å‘Minor GCæ—¶ï¼Œæ¸…ç†æ–°ç”Ÿä»£æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ›´é•¿</li></ul></li><li>æ–°ç”Ÿä»£å†…å­˜è®¾ç½®ä¸ºå†…å®¹çº³[å¹¶å‘é‡*(è¯·æ±‚-å“åº”)]çš„æ•°æ®ä¸ºå®œ</li></ul></li></ul><h4 id="å¹¸å­˜åŒºè°ƒä¼˜"><a href="#å¹¸å­˜åŒºè°ƒä¼˜" class="headerlink" title="å¹¸å­˜åŒºè°ƒä¼˜"></a>å¹¸å­˜åŒºè°ƒä¼˜</h4><ul><li>å¹¸å­˜åŒºéœ€è¦èƒ½å¤Ÿä¿å­˜ <strong>å½“å‰æ´»è·ƒå¯¹è±¡</strong>+<strong>éœ€è¦æ™‹å‡çš„å¯¹è±¡</strong></li><li>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡å°½å¿«æ™‹å‡</li></ul><h4 id="è€å¹´ä»£è°ƒä¼˜"><a href="#è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="è€å¹´ä»£è°ƒä¼˜"></a>è€å¹´ä»£è°ƒä¼˜</h4><h1 id="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"><a href="#å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"></a>å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯</h1><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png" alt="img"></a></p><h2 id="1ã€ç±»æ–‡ä»¶ç»“æ„"><a href="#1ã€ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="1ã€ç±»æ–‡ä»¶ç»“æ„"></a>1ã€ç±»æ–‡ä»¶ç»“æ„</h2><p>é¦–å…ˆè·å¾—.classå­—èŠ‚ç æ–‡ä»¶</p><p>æ–¹æ³•ï¼š</p><ul><li>åœ¨æ–‡æœ¬æ–‡æ¡£é‡Œå†™å…¥javaä»£ç ï¼ˆæ–‡ä»¶åä¸ç±»åä¸€è‡´ï¼‰ï¼Œå°†æ–‡ä»¶ç±»å‹æ”¹ä¸º.java</li><li>javaç»ˆç«¯ä¸­ï¼Œæ‰§è¡Œjavac X:â€¦\XXX.java</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png" alt="img"></a></p><p>ä»¥ä¸‹æ˜¯å­—èŠ‚ç æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs shell">0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e 0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63 0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01 0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63 0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f 0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16 0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61 0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46 0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 640000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e 0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61 0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61 0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f 0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76 0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a 0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01 0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00 0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00 0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00 0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00 0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a 0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b 0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00 0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00 0001120 00 00 02 00 14</code></pre></div><p>æ ¹æ® JVM è§„èŒƒï¼Œ<strong>ç±»æ–‡ä»¶ç»“æ„</strong>å¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs java">u4              magicu2             minor_version;    u2             major_version;    u2             constant_pool_count;    cp_info        constant_pool[constant_pool_count-<span class="hljs-number">1</span>];    u2             access_flags;    u2             this_class;    u2             super_class;   u2             interfaces_count;    u2             interfaces[interfaces_count];   u2             fields_count;    field_info     fields[fields_count];   u2             methods_count;    method_info    methods[methods_count];    u2             attributes_count;    attribute_info attributes[attributes_count];</code></pre></div><h4 id="é­”æ•°"><a href="#é­”æ•°" class="headerlink" title="é­”æ•°"></a>é­”æ•°</h4><p>u4 magic </p><p>å¯¹åº”å­—èŠ‚ç æ–‡ä»¶çš„0~3ä¸ªå­—èŠ‚</p><p>0000000 <strong>ca fe ba be</strong> 00 00 00 34 00 23 0a 00 06 00 15 09</p><h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>u2 minor_version; </p><p>u2 major_version;</p><p>0000000 ca fe ba be <strong>00 00 00 34</strong> 00 23 0a 00 06 00 15 09 </p><p>34H = 52ï¼Œä»£è¡¨JDK8</p><h4 id="å¸¸é‡æ± -1"><a href="#å¸¸é‡æ± -1" class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>è§èµ„æ–™æ–‡ä»¶</p><p>â€¦ç•¥</p><h2 id="2ã€å­—èŠ‚ç æŒ‡ä»¤"><a href="#2ã€å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="2ã€å­—èŠ‚ç æŒ‡ä»¤"></a>2ã€å­—èŠ‚ç æŒ‡ä»¤</h2><p>å¯å‚è€ƒ </p><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a></p><h4 id="javapå·¥å…·"><a href="#javapå·¥å…·" class="headerlink" title="javapå·¥å…·"></a>javapå·¥å…·</h4><p>Oracle æä¾›äº† <strong>javap</strong> å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶</p><div class="hljs code-wrapper"><pre><code class="hljs java">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.classCopyF:\Thread_study&gt;javap -v F:\Thread_study\src\com\nyima\JVM\day5\Demo1.classClassfile /F:/Thread_study/src/com/nyima/JVM/day5/Demo1.class  Last modified <span class="hljs-number">2020</span>-<span class="hljs-number">6</span>-<span class="hljs-number">6</span>; size <span class="hljs-number">434</span> bytes  MD5 checksum df1dce65bf6fb0b4c1de318051f4a67e  Compiled from <span class="hljs-string">&quot;Demo1.java&quot;</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">com</span>.<span class="hljs-title">nyima</span>.<span class="hljs-title">JVM</span>.<span class="hljs-title">day5</span>.<span class="hljs-title">Demo1</span></span>  minor version: 0  major version: <span class="hljs-number">52</span>  flags: ACC_PUBLIC, ACC_SUPERConstant pool:   #1 = Methodref          #6.#15         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V   #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;   #3 = String             #18            // hello world   #4 = Methodref          #19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V   #5 = Class              #21            // com/nyima/JVM/day5/Demo1   #6 = Class              #22            // java/lang/Object   #7 = Utf8               &lt;init&gt;   #8 = Utf8               ()V   #9 = Utf8               Code  #10 = Utf8               LineNumberTable  #11 = Utf8               main  #12 = Utf8               ([Ljava/lang/String;)V  #13 = Utf8               SourceFile  #14 = Utf8               Demo1.java  #15 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V  #16 = Class              #23            // java/lang/System  #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;  #18 = Utf8               hello world  #19 = Class              #26            // java/io/PrintStream  #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V  #21 = Utf8               com/nyima/JVM/day5/Demo1  #22 = Utf8               java/lang/Object  #23 = Utf8               java/lang/System  #24 = Utf8               out  #25 = Utf8               Ljava/io/PrintStream;  #26 = Utf8               java/io/PrintStream  #27 = Utf8               println  #28 = Utf8               (Ljava/lang/String;)V&#123;  <span class="hljs-keyword">public</span> com.nyima.JVM.day5.Demo1();    descriptor: ()V    flags: ACC_PUBLIC    Code:      stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">1</span>, args_size=<span class="hljs-number">1</span>         <span class="hljs-number">0</span>: aload_0         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V         <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span>      LineNumberTable:        line <span class="hljs-number">7</span>: <span class="hljs-number">0</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(java.lang.String[])</span></span>;    descriptor: ([Ljava/lang/String;)V    flags: ACC_PUBLIC, ACC_STATIC    Code:      stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">1</span>, args_size=<span class="hljs-number">1</span>         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;         3: ldc           #3                  // String hello world         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V         <span class="hljs-number">8</span>: <span class="hljs-keyword">return</span>      LineNumberTable:        line <span class="hljs-number">9</span>: <span class="hljs-number">0</span>        line <span class="hljs-number">10</span>: <span class="hljs-number">8</span>&#125;</code></pre></div><h4 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h4><p>ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3_1</span> </span>&#123;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;                <span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;                <span class="hljs-keyword">int</span> b = Short.MAX_VALUE + <span class="hljs-number">1</span>;                <span class="hljs-keyword">int</span> c = a + b;                System.out.println(c);       &#125; &#125;</code></pre></div><p><strong>å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><p>å¸¸é‡æ± ä¹Ÿå±äºæ–¹æ³•åŒºï¼Œåªä¸è¿‡è¿™é‡Œå•ç‹¬æå‡ºæ¥äº†</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png" alt="img"></a></p><p><strong>æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</strong></p><p>ï¼ˆstack=2ï¼Œlocals=4ï¼‰ å¯¹åº”æ“ä½œæ•°æ ˆæœ‰2ä¸ªç©ºé—´ï¼ˆæ¯ä¸ªç©ºé—´4ä¸ªå­—èŠ‚ï¼‰ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­æœ‰4ä¸ªæ§½ä½</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png" alt="img"></a></p><p><strong>æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </strong></p><p><strong>bipush 10</strong></p><ul><li><p>å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆ</p><p>ï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰</p></li><li><p>sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰</p></li><li><p>ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ </p></li><li><p>ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆ<strong>åˆ†ä¸¤æ¬¡å‹å…¥</strong>ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰</p></li><li><p>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œ<strong>è¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </strong></p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png" alt="img"></a></p><p><strong>istore 1</strong></p><p>å°†æ“ä½œæ•°æ ˆæ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„slot 1ä¸­</p><p>å¯¹åº”ä»£ç ä¸­çš„ </p><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">a</span> = <span class="hljs-number">10</span></code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png" alt="img"></a></p><p><strong>ldc #3</strong></p><p>è¯»å–è¿è¡Œæ—¶å¸¸é‡æ± ä¸­#3ï¼Œå³32768(è¶…è¿‡shortæœ€å¤§å€¼èŒƒå›´çš„æ•°ä¼šè¢«æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­)ï¼Œå°†å…¶åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­</p><p>æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png" alt="img"></a></p><p><strong>istore 2</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png" alt="img"></a></p><p><strong>iload1 iload2</strong></p><p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­1å·ä½ç½®å’Œ2å·ä½ç½®çš„å…ƒç´ æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p><ul><li>å› ä¸ºåªèƒ½åœ¨æ“ä½œæ•°æ ˆä¸­æ‰§è¡Œè¿ç®—æ“ä½œ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png" alt="img"></a></p><p><strong>iadd</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ <strong>å¼¹å‡ºæ ˆ</strong>å¹¶ç›¸åŠ ï¼Œç»“æœåœ¨å‹å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png" alt="img"></a></p><p><strong>istore 3</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„3å·ä½ç½®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png" alt="img"></a></p><p><strong>getstatic #4</strong></p><p>åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°#4ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p>åœ¨å †å†…å­˜ä¸­æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¹¶å°†å…¶<strong>å¼•ç”¨</strong>æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png" alt="img"></a></p><p><strong>iload 3</strong></p><p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­3å·ä½ç½®çš„å…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png" alt="img"></a></p><p><strong>invokevirtual 5</strong></p><p>æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ï¼Œå®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³• </p><p>ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰ </p><p>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png" alt="img"></a></p><p>æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§ </p><p>æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png" alt="img"></a></p><p><strong>return</strong><br>å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ï¼Œç¨‹åºç»“æŸ</p><h4 id="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"><a href="#é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜" class="headerlink" title="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"></a>é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜</h4><p>ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span>(i&lt;<span class="hljs-number">10</span>) &#123;            x = x++;            i++;        &#125;        System.out.println(x); <span class="hljs-comment">//æ¥è¿‡ä¸º0</span>    &#125;&#125;</code></pre></div><p>ä¸ºä»€ä¹ˆæœ€ç»ˆçš„xç»“æœä¸º0å‘¢ï¼Ÿ é€šè¿‡åˆ†æå­—èŠ‚ç æŒ‡ä»¤å³å¯çŸ¥æ™“</p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">1</span>    <span class="hljs-comment">//æ“ä½œæ•°æ ˆåˆ†é…2ä¸ªç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨åˆ†é…3ä¸ªç©ºé—´</span>        <span class="hljs-number">0</span>: iconst_0    <span class="hljs-comment">//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0</span>        <span class="hljs-number">1</span>: istore_1    <span class="hljs-comment">//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„1å·æ§½ä½ i=0</span>        <span class="hljs-number">2</span>: iconst_0    <span class="hljs-comment">//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0</span>        <span class="hljs-number">3</span>: istore_2    <span class="hljs-comment">//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡çš„2å·æ§½ä½ x=0    </span>        <span class="hljs-number">4</span>: iload_1        <span class="hljs-comment">//å°†å±€éƒ¨å˜é‡è¡¨1å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</span>        <span class="hljs-number">5</span>: bipush        <span class="hljs-number">10</span>    <span class="hljs-comment">//å°†æ•°å­—10æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰2ä¸ªæ•°</span>        <span class="hljs-number">7</span>: if_icmpge     <span class="hljs-number">21</span>    <span class="hljs-comment">//æ¯”è¾ƒæ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªæ•°ï¼Œå¦‚æœä¸‹é¢çš„æ•°å¤§äºä¸Šé¢çš„æ•°ï¼Œå°±è·³è½¬åˆ°21ã€‚è¿™é‡Œçš„æ¯”è¾ƒæ˜¯å°†ä¸¤ä¸ªæ•°åšå‡æ³•ã€‚å› ä¸ºæ¶‰åŠè¿ç®—æ“ä½œï¼Œæ‰€ä»¥ä¼šå°†ä¸¤ä¸ªæ•°å¼¹å‡ºæ“ä½œæ•°æ ˆæ¥è¿›è¡Œè¿ç®—ã€‚è¿ç®—ç»“æŸåæ“ä½œæ•°æ ˆä¸ºç©º</span>       <span class="hljs-number">10</span>: iload_2        <span class="hljs-comment">//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ”¾å…¥çš„å€¼æ˜¯0</span>       <span class="hljs-number">11</span>: iinc          <span class="hljs-number">2</span>, <span class="hljs-number">1</span>    <span class="hljs-comment">//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°åŠ 1ï¼Œè‡ªå¢åï¼Œæ§½ä½ä¸­çš„å€¼ä¸º1</span>       <span class="hljs-number">14</span>: istore_2    <span class="hljs-comment">//å°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½ï¼Œ2å·æ§½ä½çš„å€¼åˆå˜ä¸ºäº†0</span>       <span class="hljs-number">15</span>: iinc          <span class="hljs-number">1</span>, <span class="hljs-number">1</span> <span class="hljs-comment">//1å·æ§½ä½çš„å€¼è‡ªå¢1</span>       <span class="hljs-number">18</span>: goto          <span class="hljs-number">4</span> <span class="hljs-comment">//è·³è½¬åˆ°ç¬¬4æ¡æŒ‡ä»¤</span>       21: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;       <span class="hljs-number">24</span>: iload_2       25: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V       <span class="hljs-number">28</span>: <span class="hljs-keyword">return</span></code></pre></div><h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><h5 id="cinit-V"><a href="#cinit-V" class="headerlink" title="cinit()V"></a>cinit()V</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;    <span class="hljs-keyword">static</span> &#123;        i = <span class="hljs-number">20</span>;    &#125;    <span class="hljs-keyword">static</span> &#123;        i = <span class="hljs-number">30</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        System.out.println(i); <span class="hljs-comment">//ç»“æœä¸º30</span>    &#125;&#125;</code></pre></div><p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œ<strong>åˆå¹¶</strong>ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• cinit()V ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java">stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">0</span>, args_size=<span class="hljs-number">0</span>         <span class="hljs-number">0</span>: bipush        <span class="hljs-number">10</span>         2: putstatic     #3                  // Field i:I         <span class="hljs-number">5</span>: bipush        <span class="hljs-number">20</span>         7: putstatic     #3                  // Field i:I        <span class="hljs-number">10</span>: bipush        <span class="hljs-number">30</span>        12: putstatic     #3                  // Field i:I        <span class="hljs-number">15</span>: <span class="hljs-keyword">return</span></code></pre></div><h5 id="init-V"><a href="#init-V" class="headerlink" title="init()V"></a>init()V</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;    <span class="hljs-keyword">private</span> String a = <span class="hljs-string">&quot;s1&quot;</span>;    &#123;        b = <span class="hljs-number">20</span>;    &#125;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> b = <span class="hljs-number">10</span>;    &#123;        a = <span class="hljs-string">&quot;s2&quot;</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo4</span><span class="hljs-params">(String a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;        <span class="hljs-keyword">this</span>.a = a;        <span class="hljs-keyword">this</span>.b = b;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Demo4 d = <span class="hljs-keyword">new</span> Demo4(<span class="hljs-string">&quot;s3&quot;</span>, <span class="hljs-number">30</span>);        System.out.println(d.a);        System.out.println(d.b);    &#125;&#125;</code></pre></div><p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œ<strong>å½¢æˆæ–°çš„æ„é€ æ–¹æ³•</strong>ï¼Œä½†<strong>åŸå§‹æ„é€ æ–¹æ³•</strong>å†…çš„ä»£ç <strong>æ€»æ˜¯åœ¨å</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">3</span>        <span class="hljs-number">0</span>: aload_0        1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V        <span class="hljs-number">4</span>: aload_0        5: ldc           #2                  // String s1        7: putfield      #3                  // Field a:Ljava/lang/String;       <span class="hljs-number">10</span>: aload_0       <span class="hljs-number">11</span>: bipush        <span class="hljs-number">20</span>       13: putfield      #4                  // Field b:I       <span class="hljs-number">16</span>: aload_0       <span class="hljs-number">17</span>: bipush        <span class="hljs-number">10</span>       19: putfield      #4                  // Field b:I       <span class="hljs-number">22</span>: aload_0       23: ldc           #5                  // String s2       25: putfield      #3                  // Field a:Ljava/lang/String;       <span class="hljs-comment">//åŸå§‹æ„é€ æ–¹æ³•åœ¨æœ€åæ‰§è¡Œ</span>       <span class="hljs-number">28</span>: aload_0       <span class="hljs-number">29</span>: aload_1       30: putfield      #3                  // Field a:Ljava/lang/String;       <span class="hljs-number">33</span>: aload_0       <span class="hljs-number">34</span>: iload_2       35: putfield      #4                  // Field b:I       <span class="hljs-number">38</span>: <span class="hljs-keyword">return</span></code></pre></div><h4 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo5</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Demo5 demo5 = <span class="hljs-keyword">new</span> Demo5();        demo5.test1();        demo5.test2();        demo5.test3();        Demo5.test4();    &#125;&#125;</code></pre></div><p>ä¸åŒæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æ‰€åŒºåˆ«</p><ul><li>ç§æœ‰ã€æ„é€ ã€è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶éƒ½ä½¿ç”¨<strong>invokespecial</strong>æŒ‡ä»¤</li><li>æ™®é€šæˆå‘˜æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨invokespecialæŒ‡ä»¤ã€‚å› ä¸ºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šè¯¥æ–¹æ³•çš„å†…å®¹ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š</li><li>é™æ€æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä½¿ç”¨invokestaticæŒ‡ä»¤</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java">Code:      stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">2</span>, args_size=<span class="hljs-number">1</span>         0: new           #2                  // class com/nyima/JVM/day5/Demo5          <span class="hljs-number">3</span>: dup         4: invokespecial #3                  // Method &quot;&lt;init&gt;&quot;:()V         <span class="hljs-number">7</span>: astore_1         <span class="hljs-number">8</span>: aload_1         9: invokespecial #4                  // Method test1:()V        <span class="hljs-number">12</span>: aload_1        13: invokespecial #5                  // Method test2:()V        <span class="hljs-number">16</span>: aload_1        17: invokevirtual #6                  // Method test3:()V        20: invokestatic  #7                  // Method test4:()V        <span class="hljs-number">23</span>: <span class="hljs-keyword">return</span></code></pre></div><ul><li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘å‹å…¥æ“ä½œæ•°æ ˆ </li><li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• â€œinitâ€:()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦ é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡ </li><li>ç»ˆæ–¹æ³•ï¼ˆï¬nalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š </li><li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äº<strong>åŠ¨æ€ç»‘å®š</strong>ï¼Œå³æ”¯æŒå¤šæ€ æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘ </li></ul><h4 id="å¤šæ€åŸç†"><a href="#å¤šæ€åŸç†" class="headerlink" title="å¤šæ€åŸç†"></a>å¤šæ€åŸç†</h4><p>å› ä¸ºæ™®é€šæˆå‘˜æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéœ€è¦è°ƒç”¨<strong>invokevirtual</strong>æŒ‡ä»¤</p><p>åœ¨æ‰§è¡ŒinvokevirtualæŒ‡ä»¤æ—¶ï¼Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><ul><li>å…ˆé€šè¿‡æ ˆå¸§ä¸­å¯¹è±¡çš„å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</li><li>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡å®é™…çš„Class</li><li>Classç»“æ„ä¸­æœ‰<strong>vtable</strong></li><li>æŸ¥è¯¢vtableæ‰¾åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</li><li>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç </li></ul><h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><h5 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;        <span class="hljs-keyword">try</span> &#123;            i = <span class="hljs-number">10</span>;        &#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;            i = <span class="hljs-number">20</span>;        &#125;    &#125;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç æŒ‡ä»¤</p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">1</span>        <span class="hljs-number">0</span>: iconst_0        <span class="hljs-number">1</span>: istore_1        <span class="hljs-number">2</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">4</span>: istore_1        <span class="hljs-number">5</span>: goto          <span class="hljs-number">12</span>        <span class="hljs-number">8</span>: astore_2        <span class="hljs-number">9</span>: bipush        <span class="hljs-number">20</span>       <span class="hljs-number">11</span>: istore_1       <span class="hljs-number">12</span>: <span class="hljs-keyword">return</span>     <span class="hljs-comment">//å¤šå‡ºæ¥ä¸€ä¸ªå¼‚å¸¸è¡¨</span>     Exception table:        from    to  target type            <span class="hljs-number">2</span>     <span class="hljs-number">5</span>     <span class="hljs-number">8</span>   Class java/lang/Exception</code></pre></div><ul><li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯<strong>å‰é—­åå¼€</strong>ï¼ˆä¹Ÿå°±æ˜¯æ£€æµ‹2~4è¡Œï¼‰çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå· </li><li>8è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®ï¼ˆä¸ºeï¼‰</li></ul><h5 id="å¤šä¸ªsingle-catch"><a href="#å¤šä¸ªsingle-catch" class="headerlink" title="å¤šä¸ªsingle-catch"></a>å¤šä¸ªsingle-catch</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;        <span class="hljs-keyword">try</span> &#123;            i = <span class="hljs-number">10</span>;        &#125;<span class="hljs-keyword">catch</span> (ArithmeticException e) &#123;            i = <span class="hljs-number">20</span>;        &#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;            i = <span class="hljs-number">30</span>;        &#125;    &#125;&#125;</code></pre></div><p>å¯¹åº”çš„å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">1</span>        <span class="hljs-number">0</span>: iconst_0        <span class="hljs-number">1</span>: istore_1        <span class="hljs-number">2</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">4</span>: istore_1        <span class="hljs-number">5</span>: goto          <span class="hljs-number">19</span>        <span class="hljs-number">8</span>: astore_2        <span class="hljs-number">9</span>: bipush        <span class="hljs-number">20</span>       <span class="hljs-number">11</span>: istore_1       <span class="hljs-number">12</span>: goto          <span class="hljs-number">19</span>       <span class="hljs-number">15</span>: astore_2       <span class="hljs-number">16</span>: bipush        <span class="hljs-number">30</span>       <span class="hljs-number">18</span>: istore_1       <span class="hljs-number">19</span>: <span class="hljs-keyword">return</span>     Exception table:        from    to  target type            <span class="hljs-number">2</span>     <span class="hljs-number">5</span>     <span class="hljs-number">8</span>   Class java/lang/ArithmeticException            <span class="hljs-number">2</span>     <span class="hljs-number">5</span>    <span class="hljs-number">15</span>   Class java/lang/Exception</code></pre></div><ul><li>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œ<strong>åªèƒ½è¿›å…¥</strong> Exception table ä¸­<strong>ä¸€ä¸ªåˆ†æ”¯</strong>ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®<strong>è¢«å…±ç”¨</strong></li></ul><h5 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;        <span class="hljs-keyword">try</span> &#123;            i = <span class="hljs-number">10</span>;        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            i = <span class="hljs-number">20</span>;        &#125; <span class="hljs-keyword">finally</span> &#123;            i = <span class="hljs-number">30</span>;        &#125;    &#125;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">4</span>, args_size=<span class="hljs-number">1</span>        <span class="hljs-number">0</span>: iconst_0        <span class="hljs-number">1</span>: istore_1        <span class="hljs-comment">//tryå—</span>        <span class="hljs-number">2</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">4</span>: istore_1        <span class="hljs-comment">//tryå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally    </span>        <span class="hljs-number">5</span>: bipush        <span class="hljs-number">30</span>        <span class="hljs-number">7</span>: istore_1        <span class="hljs-number">8</span>: goto          <span class="hljs-number">27</span>       <span class="hljs-comment">//catchå—     </span>       <span class="hljs-number">11</span>: astore_2 <span class="hljs-comment">//å¼‚å¸¸ä¿¡æ¯æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½</span>       <span class="hljs-number">12</span>: bipush        <span class="hljs-number">20</span>       <span class="hljs-number">14</span>: istore_1       <span class="hljs-comment">//catchå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally        </span>       <span class="hljs-number">15</span>: bipush        <span class="hljs-number">30</span>       <span class="hljs-number">17</span>: istore_1       <span class="hljs-number">18</span>: goto          <span class="hljs-number">27</span>       <span class="hljs-comment">//å‡ºç°å¼‚å¸¸ï¼Œä½†æœªè¢«Exceptionæ•è·ï¼Œä¼šæŠ›å‡ºå…¶ä»–å¼‚å¸¸ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰§è¡Œfinallyå—ä¸­çš„ä»£ç    </span>       <span class="hljs-number">21</span>: astore_3       <span class="hljs-number">22</span>: bipush        <span class="hljs-number">30</span>       <span class="hljs-number">24</span>: istore_1       <span class="hljs-number">25</span>: aload_3       <span class="hljs-number">26</span>: athrow  <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>       <span class="hljs-number">27</span>: <span class="hljs-keyword">return</span>     Exception table:        from    to  target type            <span class="hljs-number">2</span>     <span class="hljs-number">5</span>    <span class="hljs-number">11</span>   Class java/lang/Exception            <span class="hljs-number">2</span>     <span class="hljs-number">5</span>    <span class="hljs-number">21</span>   any           <span class="hljs-number">11</span>    <span class="hljs-number">15</span>    <span class="hljs-number">21</span>   any</code></pre></div><p>å¯ä»¥çœ‹åˆ° ï¬nally ä¸­çš„ä»£ç è¢«<strong>å¤åˆ¶äº† 3 ä»½</strong>ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catchå‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹ </p><p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶ä»å­—èŠ‚ç æŒ‡ä»¤çœ‹æ¥ï¼Œæ¯ä¸ªå—ä¸­éƒ½æœ‰finallyå—ï¼Œä½†æ˜¯finallyå—ä¸­çš„ä»£ç <strong>åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</strong></p><h5 id="finallyä¸­çš„return"><a href="#finallyä¸­çš„return" class="headerlink" title="finallyä¸­çš„return"></a>finallyä¸­çš„return</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = Demo3.test();        <span class="hljs-comment">//ç»“æœä¸º20</span>        System.out.println(i);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">int</span> i;        <span class="hljs-keyword">try</span> &#123;            i = <span class="hljs-number">10</span>;            <span class="hljs-keyword">return</span> i;        &#125; <span class="hljs-keyword">finally</span> &#123;            i = <span class="hljs-number">20</span>;            <span class="hljs-keyword">return</span> i;        &#125;    &#125;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">0</span>        <span class="hljs-number">0</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">2</span>: istore_0        <span class="hljs-number">3</span>: iload_0        <span class="hljs-number">4</span>: istore_1  <span class="hljs-comment">//æš‚å­˜è¿”å›å€¼</span>        <span class="hljs-number">5</span>: bipush        <span class="hljs-number">20</span>        <span class="hljs-number">7</span>: istore_0        <span class="hljs-number">8</span>: iload_0        <span class="hljs-number">9</span>: ireturn    <span class="hljs-comment">//ireturnä¼šè¿”å›æ“ä½œæ•°æ ˆé¡¶çš„æ•´å‹å€¼20</span>       <span class="hljs-comment">//å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œfinallyå—ä¸­çš„å†…å®¹ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸</span>       <span class="hljs-number">10</span>: astore_2       <span class="hljs-number">11</span>: bipush        <span class="hljs-number">20</span>       <span class="hljs-number">13</span>: istore_0       <span class="hljs-number">14</span>: iload_0       <span class="hljs-number">15</span>: ireturn    <span class="hljs-comment">//è¿™é‡Œæ²¡æœ‰athrowäº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨finallyå—ä¸­å¦‚æœæœ‰è¿”å›æ“ä½œçš„è¯ï¼Œä¸”tryå—ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¼šåæ‰å¼‚å¸¸ï¼</span>     Exception table:        from    to  target type            <span class="hljs-number">0</span>     <span class="hljs-number">5</span>    <span class="hljs-number">10</span>   any</code></pre></div><ul><li>ç”±äº ï¬nally ä¸­çš„ <strong>ireturn</strong> è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ï¬nallyçš„ä¸ºå‡† </li><li>è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­ </li><li>è·Ÿä¸Šä¾‹ä¸­çš„ ï¬nally ç›¸æ¯”ï¼Œå‘ç°<strong>æ²¡æœ‰ athrow äº†</strong>ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ ï¬nally ä¸­å‡ºç°äº† returnï¼Œä¼š<strong>åæ‰å¼‚å¸¸</strong></li><li>æ‰€ä»¥<strong>ä¸è¦åœ¨finallyä¸­è¿›è¡Œè¿”å›æ“ä½œ</strong></li></ul><h5 id="è¢«åæ‰çš„å¼‚å¸¸"><a href="#è¢«åæ‰çš„å¼‚å¸¸" class="headerlink" title="è¢«åæ‰çš„å¼‚å¸¸"></a>è¢«åæ‰çš„å¼‚å¸¸</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-keyword">int</span> i = Demo3.test();      <span class="hljs-comment">//æœ€ç»ˆç»“æœä¸º20</span>      System.out.println(i);   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-keyword">int</span> i;      <span class="hljs-keyword">try</span> &#123;         i = <span class="hljs-number">10</span>;         <span class="hljs-comment">//è¿™é‡Œåº”è¯¥ä¼šæŠ›å‡ºå¼‚å¸¸</span>         i = i/<span class="hljs-number">0</span>;         <span class="hljs-keyword">return</span> i;      &#125; <span class="hljs-keyword">finally</span> &#123;         i = <span class="hljs-number">20</span>;         <span class="hljs-keyword">return</span> i;      &#125;   &#125;&#125;</code></pre></div><p>ä¼šå‘ç°æ‰“å°ç»“æœä¸º20ï¼Œå¹¶æœªæŠ›å‡ºå¼‚å¸¸</p><h5 id="finallyä¸å¸¦return"><a href="#finallyä¸å¸¦return" class="headerlink" title="finallyä¸å¸¦return"></a>finallyä¸å¸¦return</h5><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = Demo4.test();        System.out.println(i);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">return</span> i;        &#125; <span class="hljs-keyword">finally</span> &#123;            i = <span class="hljs-number">20</span>;        &#125;    &#125;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">0</span>        <span class="hljs-number">0</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">2</span>: istore_0 <span class="hljs-comment">//èµ‹å€¼ç»™i 10</span>        <span class="hljs-number">3</span>: iload_0    <span class="hljs-comment">//åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶</span>        <span class="hljs-number">4</span>: istore_1 <span class="hljs-comment">//åŠ è½½åˆ°å±€éƒ¨å˜é‡è¡¨çš„1å·ä½ç½®</span>        <span class="hljs-number">5</span>: bipush        <span class="hljs-number">20</span>        <span class="hljs-number">7</span>: istore_0 <span class="hljs-comment">//èµ‹å€¼ç»™i 20</span>        <span class="hljs-number">8</span>: iload_1 <span class="hljs-comment">//åŠ è½½å±€éƒ¨å˜é‡è¡¨1å·ä½ç½®çš„æ•°10åˆ°æ“ä½œæ•°æ ˆ</span>        <span class="hljs-number">9</span>: ireturn <span class="hljs-comment">//è¿”å›æ“ä½œæ•°æ ˆé¡¶å…ƒç´  10</span>       <span class="hljs-number">10</span>: astore_2       <span class="hljs-number">11</span>: bipush        <span class="hljs-number">20</span>       <span class="hljs-number">13</span>: istore_0       <span class="hljs-number">14</span>: aload_2 <span class="hljs-comment">//åŠ è½½å¼‚å¸¸</span>       <span class="hljs-number">15</span>: athrow <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>     Exception table:        from    to  target type            <span class="hljs-number">3</span>     <span class="hljs-number">5</span>    <span class="hljs-number">10</span>   any</code></pre></div><h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;        Lock lock = <span class="hljs-keyword">new</span> Lock();        <span class="hljs-keyword">synchronized</span> (lock) &#123;            System.out.println(i);        &#125;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock</span></span>&#123;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:     stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">5</span>, args_size=<span class="hljs-number">1</span>        <span class="hljs-number">0</span>: bipush        <span class="hljs-number">10</span>        <span class="hljs-number">2</span>: istore_1        3: new           #2                  // class com/nyima/JVM/day06/Lock        <span class="hljs-number">6</span>: dup <span class="hljs-comment">//å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼Œç”¨äºæ„é€ å‡½æ•°æ¶ˆè€—</span>        7: invokespecial #3                  // Method com/nyima/JVM/day06/Lock.&quot;&lt;init&gt;&quot;:()V       <span class="hljs-number">10</span>: astore_2 <span class="hljs-comment">//å‰©ä¸‹çš„ä¸€ä»½æ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</span>       <span class="hljs-number">11</span>: aload_2 <span class="hljs-comment">//åŠ è½½åˆ°æ“ä½œæ•°æ ˆ</span>       <span class="hljs-number">12</span>: dup <span class="hljs-comment">//å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆï¼Œç”¨äºåŠ é”æ—¶æ¶ˆè€—</span>       <span class="hljs-number">13</span>: astore_3 <span class="hljs-comment">//å°†æ“ä½œæ•°æ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæš‚å­˜åˆ°å±€éƒ¨å˜é‡è¡¨çš„ä¸‰å·æ§½ä½ã€‚è¿™æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰ä¸€ä»½å¯¹è±¡çš„å¼•ç”¨</span>       <span class="hljs-number">14</span>: monitorenter <span class="hljs-comment">//åŠ é”</span>       <span class="hljs-comment">//é”ä½åä»£ç å—ä¸­çš„æ“ä½œ    </span>       15: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;       <span class="hljs-number">18</span>: iload_1       19: invokevirtual #5                  // Method java/io/PrintStream.println:(I)V       <span class="hljs-comment">//åŠ è½½å±€éƒ¨å˜é‡è¡¨ä¸­ä¸‰å·æ§½ä½å¯¹è±¡çš„å¼•ç”¨ï¼Œç”¨äºè§£é”    </span>       <span class="hljs-number">22</span>: aload_3           <span class="hljs-number">23</span>: monitorexit <span class="hljs-comment">//è§£é”</span>       <span class="hljs-number">24</span>: goto          <span class="hljs-number">34</span>       <span class="hljs-comment">//å¼‚å¸¸æ“ä½œ    </span>       <span class="hljs-number">27</span>: astore        <span class="hljs-number">4</span>       <span class="hljs-number">29</span>: aload_3       <span class="hljs-number">30</span>: monitorexit <span class="hljs-comment">//è§£é”</span>       <span class="hljs-number">31</span>: aload         <span class="hljs-number">4</span>       <span class="hljs-number">33</span>: athrow       <span class="hljs-number">34</span>: <span class="hljs-keyword">return</span>     <span class="hljs-comment">//å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºä½•æ—¶å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè·³è½¬åˆ°27è¡Œï¼Œå°†å¼‚å¸¸æ”¾å…¥å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶è¿›è¡Œè§£é”æ“ä½œï¼Œç„¶ååŠ è½½å¼‚å¸¸å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚      </span>     Exception table:        from    to  target type           <span class="hljs-number">15</span>    <span class="hljs-number">24</span>    <span class="hljs-number">27</span>   any           <span class="hljs-number">27</span>    <span class="hljs-number">31</span>    <span class="hljs-number">27</span>   any</code></pre></div><h2 id="3ã€ç¼–è¯‘æœŸå¤„ç†"><a href="#3ã€ç¼–è¯‘æœŸå¤„ç†" class="headerlink" title="3ã€ç¼–è¯‘æœŸå¤„ç†"></a>3ã€ç¼–è¯‘æœŸå¤„ç†</h2><p>æ‰€è°“çš„ <strong>è¯­æ³•ç³–</strong> ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>å’Œ<strong>è½¬æ¢</strong>çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©</p><p><strong>æ³¨æ„</strong>ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„<strong>ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç </strong>ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚ </p><h4 id="é»˜è®¤æ„é€ å‡½æ•°"><a href="#é»˜è®¤æ„é€ å‡½æ•°" class="headerlink" title="é»˜è®¤æ„é€ å‡½æ•°"></a>é»˜è®¤æ„é€ å‡½æ•°</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;&#125;</code></pre></div><p>ç»è¿‡ç¼–è¯‘æœŸä¼˜åŒ–å</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;   <span class="hljs-comment">//è¿™ä¸ªæ— å‚æ„é€ å™¨æ˜¯javaç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ ä¸Šçš„</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Candy1</span><span class="hljs-params">()</span> </span>&#123;      <span class="hljs-comment">//å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot; &lt;init&gt;&quot;:()V</span>      <span class="hljs-keyword">super</span>();   &#125;&#125;</code></pre></div><h4 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h4><p>åŸºæœ¬ç±»å‹å’Œå…¶åŒ…è£…ç±»å‹çš„ç›¸äº’è½¬æ¢è¿‡ç¨‹ï¼Œç§°ä¸ºæ‹†è£…ç®±</p><p>åœ¨JDK 5ä»¥åï¼Œå®ƒä»¬çš„è½¬æ¢å¯ä»¥åœ¨ç¼–è¯‘æœŸè‡ªåŠ¨å®Œæˆ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      Integer x = <span class="hljs-number">1</span>;      <span class="hljs-keyword">int</span> y = x;   &#125;&#125;</code></pre></div><p>è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-comment">//åŸºæœ¬ç±»å‹èµ‹å€¼ç»™åŒ…è£…ç±»å‹ï¼Œç§°ä¸ºè£…ç®±</span>      Integer x = Integer.valueOf(<span class="hljs-number">1</span>);      <span class="hljs-comment">//åŒ…è£…ç±»å‹èµ‹å€¼ç»™åŸºæœ¬ç±»å‹ï¼Œç§°è°“æ‹†ç®±</span>      <span class="hljs-keyword">int</span> y = x.intValue();   &#125;&#125;</code></pre></div><h4 id="æ³›å‹é›†åˆå–å€¼"><a href="#æ³›å‹é›†åˆå–å€¼" class="headerlink" title="æ³›å‹é›†åˆå–å€¼"></a>æ³›å‹é›†åˆå–å€¼</h4><p>æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨<strong>ç¼–è¯‘æ³›å‹ä»£ç å</strong>ä¼šæ‰§è¡Œ <strong>æ³›å‹æ“¦é™¤</strong> çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±<strong>ä¸¢å¤±</strong>äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† <strong>Object</strong> ç±»å‹æ¥å¤„ç†ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();      list.add(<span class="hljs-number">10</span>);      Integer x = list.get(<span class="hljs-number">0</span>);   &#125;&#125;</code></pre></div><p>å¯¹åº”å­—èŠ‚ç </p><div class="hljs code-wrapper"><pre><code class="hljs java">Code:    stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">3</span>, args_size=<span class="hljs-number">1</span>       0: new           #2                  // class java/util/ArrayList       <span class="hljs-number">3</span>: dup       4: invokespecial #3                  // Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V       <span class="hljs-number">7</span>: astore_1       <span class="hljs-number">8</span>: aload_1       <span class="hljs-number">9</span>: bipush        <span class="hljs-number">10</span>      11: invokestatic  #4                  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;      <span class="hljs-comment">//è¿™é‡Œè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯add(Objcet o)</span>      14: invokeinterface #5,  2            // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z      <span class="hljs-number">19</span>: pop      <span class="hljs-number">20</span>: aload_1      <span class="hljs-number">21</span>: iconst_0      <span class="hljs-comment">//è¿™é‡Œä¹Ÿè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯get(Object o)   </span>      22: invokeinterface #6,  2            // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;<span class="hljs-comment">//è¿™é‡Œè¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå°†Objectè½¬æ¢æˆäº†Integer</span>      27: checkcast     #7                  // class java/lang/Integer      <span class="hljs-number">30</span>: astore_2      <span class="hljs-number">31</span>: <span class="hljs-keyword">return</span></code></pre></div><p>æ‰€ä»¥è°ƒç”¨getå‡½æ•°å–å€¼æ—¶ï¼Œæœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs java">Integer x = (Integer) list.get(<span class="hljs-number">0</span>);</code></pre></div><p>å¦‚æœè¦å°†è¿”å›ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªintç±»å‹çš„å˜é‡ï¼Œåˆ™è¿˜æœ‰<strong>è‡ªåŠ¨æ‹†ç®±</strong>çš„æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">int</span> x = (Integer) list.get(<span class="hljs-number">0</span>).intValue();</code></pre></div><h4 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String... args)</span> </span>&#123;      <span class="hljs-comment">//å°†argsèµ‹å€¼ç»™arrï¼Œå¯ä»¥çœ‹å‡ºString...å®é™…å°±æ˜¯String[] </span>      String[] arr = args;      System.out.println(arr.length);   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      foo(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);   &#125;&#125;</code></pre></div><p>å¯å˜å‚æ•° <strong>Stringâ€¦</strong> args å…¶å®æ˜¯ä¸€ä¸ª <strong>String[]</strong> args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒ æ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;   <span class="hljs-keyword">public</span> Demo4 &#123;&#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String[] args)</span> </span>&#123;      String[] arr = args;      System.out.println(arr.length);   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      foo(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>&#125;);   &#125;&#125;</code></pre></div><p>æ³¨æ„ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯foo()ï¼Œå³æœªä¼ é€’å‚æ•°æ—¶ï¼Œç­‰ä»·ä»£ç ä¸ºfoo(new String[]{})ï¼Œ<strong>åˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’çš„null</p><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">//æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</span>        <span class="hljs-keyword">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> x : arr) &#123;            System.out.println(x);        &#125;    &#125;&#125;</code></pre></div><p>ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è½¬æ¢ä¸º</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;arr.length; ++i) &#123;            <span class="hljs-keyword">int</span> x = arr[i];            System.out.println(x);        &#125;    &#125;&#125;</code></pre></div><p><strong>å¦‚æœæ˜¯é›†åˆä½¿ç”¨foreach</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);      <span class="hljs-keyword">for</span> (Integer x : list) &#123;         System.out.println(x);      &#125;   &#125;&#125;</code></pre></div><p>é›†åˆè¦ä½¿ç”¨foreachï¼Œéœ€è¦è¯¥é›†åˆç±»å®ç°äº†<strong>Iterableæ¥å£</strong>ï¼Œå› ä¸ºé›†åˆçš„éå†éœ€è¦ç”¨åˆ°<strong>è¿­ä»£å™¨Iterator</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);      <span class="hljs-comment">//è·å¾—è¯¥é›†åˆçš„è¿­ä»£å™¨</span>      Iterator&lt;Integer&gt; iterator = list.iterator();      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;         Integer x = iterator.next();         System.out.println(x);      &#125;   &#125;&#125;</code></pre></div><h4 id="switchå­—ç¬¦ä¸²"><a href="#switchå­—ç¬¦ä¸²" class="headerlink" title="switchå­—ç¬¦ä¸²"></a>switchå­—ç¬¦ä¸²</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      String str = <span class="hljs-string">&quot;hello&quot;</span>;      <span class="hljs-keyword">switch</span> (str) &#123;         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;hello&quot;</span> :            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;world&quot;</span> :            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:            <span class="hljs-keyword">break</span>;      &#125;   &#125;&#125;</code></pre></div><p>åœ¨ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„æ“ä½œ</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo6</span><span class="hljs-params">()</span> </span>&#123;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      String str = <span class="hljs-string">&quot;hello&quot;</span>;      <span class="hljs-keyword">int</span> x = -<span class="hljs-number">1</span>;      <span class="hljs-comment">//é€šè¿‡å­—ç¬¦ä¸²çš„hashCode+valueæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…</span>      <span class="hljs-keyword">switch</span> (str.hashCode()) &#123;         <span class="hljs-comment">//helloçš„hashCode</span>         <span class="hljs-keyword">case</span> <span class="hljs-number">99162322</span> :            <span class="hljs-comment">//å†æ¬¡æ¯”è¾ƒï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„hashCodeæœ‰å¯èƒ½ç›¸ç­‰</span>            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;hello&quot;</span>)) &#123;               x = <span class="hljs-number">0</span>;            &#125;            <span class="hljs-keyword">break</span>;         <span class="hljs-comment">//worldçš„hashCode</span>         <span class="hljs-keyword">case</span> <span class="hljs-number">11331880</span> :            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;world&quot;</span>)) &#123;               x = <span class="hljs-number">1</span>;            &#125;            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:            <span class="hljs-keyword">break</span>;      &#125;      <span class="hljs-comment">//ç”¨ç¬¬äºŒä¸ªswitchåœ¨è¿›è¡Œè¾“å‡ºåˆ¤æ–­</span>      <span class="hljs-keyword">switch</span> (x) &#123;         <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:            <span class="hljs-keyword">break</span>;      &#125;   &#125;&#125;</code></pre></div><p>è¿‡ç¨‹è¯´æ˜ï¼š</p><ul><li>åœ¨ç¼–è¯‘æœŸé—´ï¼Œå•ä¸ªçš„switchè¢«åˆ†ä¸ºäº†ä¸¤ä¸ª<ul><li>ç¬¬ä¸€ä¸ªç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œå¹¶ç»™xèµ‹å€¼<ul><li>å­—ç¬¦ä¸²çš„åŒ¹é…ç”¨åˆ°äº†å­—ç¬¦ä¸²çš„hashCodeï¼Œè¿˜ç”¨åˆ°äº†equalsæ–¹æ³•</li><li>ä½¿ç”¨hashCodeæ˜¯ä¸ºäº†æé«˜æ¯”è¾ƒæ•ˆç‡ï¼Œä½¿ç”¨equalsæ˜¯é˜²æ­¢æœ‰hashCodeå†²çªï¼ˆå¦‚BMå’ŒC.ï¼‰</li></ul></li><li>ç¬¬äºŒä¸ªç”¨æ¥æ ¹æ®xçš„å€¼æ¥å†³å®šè¾“å‡ºè¯­å¥</li></ul></li></ul><h4 id="switchæšä¸¾"><a href="#switchæšä¸¾" class="headerlink" title="switchæšä¸¾"></a>switchæšä¸¾</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      SEX sex = SEX.MALE;      <span class="hljs-keyword">switch</span> (sex) &#123;         <span class="hljs-keyword">case</span> MALE:            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">case</span> FEMALE:            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:            <span class="hljs-keyword">break</span>;      &#125;   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;   MALE, FEMALE;&#125;</code></pre></div><p>ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;   <span class="hljs-comment">/**     </span><span class="hljs-comment">    * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰     </span><span class="hljs-comment">    * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»     </span><span class="hljs-comment">    * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹     </span><span class="hljs-comment">    * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1     </span><span class="hljs-comment">    */</span>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> $<span class="hljs-title">MAP</span> </span>&#123;      <span class="hljs-comment">//æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜æ”¾äº†caseç”¨äºæ¯”è¾ƒçš„æ•°å­—</span>      <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] map = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];      <span class="hljs-keyword">static</span> &#123;         <span class="hljs-comment">//ordinalå³æšä¸¾å…ƒç´ å¯¹åº”æ‰€åœ¨çš„ä½ç½®ï¼ŒMALEä¸º0ï¼ŒFEMALEä¸º1</span>         map[SEX.MALE.ordinal()] = <span class="hljs-number">1</span>;         map[SEX.FEMALE.ordinal()] = <span class="hljs-number">2</span>;      &#125;   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      SEX sex = SEX.MALE;      <span class="hljs-comment">//å°†å¯¹åº”ä½ç½®æšä¸¾å…ƒç´ çš„å€¼èµ‹ç»™xï¼Œç”¨äºcaseæ“ä½œ</span>      <span class="hljs-keyword">int</span> x = $MAP.map[sex.ordinal()];      <span class="hljs-keyword">switch</span> (x) &#123;         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:            <span class="hljs-keyword">break</span>;      &#125;   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;   MALE, FEMALE;&#125;</code></pre></div><h4 id="æšä¸¾ç±»"><a href="#æšä¸¾ç±»" class="headerlink" title="æšä¸¾ç±»"></a>æšä¸¾ç±»</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;   MALE, FEMALE;&#125;</code></pre></div><p>è½¬æ¢åçš„ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sex</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Enum</span>&lt;<span class="hljs-title">Sex</span>&gt; </span>&#123;      <span class="hljs-comment">//å¯¹åº”æšä¸¾ç±»ä¸­çš„å…ƒç´ </span>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex MALE;       <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex FEMALE;       <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex[] $VALUES;    <span class="hljs-keyword">static</span> &#123;               <span class="hljs-comment">//è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥æšä¸¾å…ƒç´ çš„å€¼åŠordinal</span>        MALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;MALE&quot;</span>, <span class="hljs-number">0</span>);            FEMALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;FEMALE&quot;</span>, <span class="hljs-number">1</span>);           $VALUES = <span class="hljs-keyword">new</span> Sex[]&#123;MALE, FEMALE&#125;;    &#125;   <span class="hljs-comment">//è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Sex</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> ordinal)</span> </span>&#123;             <span class="hljs-keyword">super</span>(name, ordinal);        &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex[] values() &#123;          <span class="hljs-keyword">return</span> $VALUES.clone();      &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex <span class="hljs-title">valueOf</span><span class="hljs-params">(String name)</span> </span>&#123;         <span class="hljs-keyword">return</span> Enum.valueOf(Sex.class, name);      &#125; &#125;</code></pre></div><h4 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);         &#125;      &#125;;   &#125;&#125;</code></pre></div><p>è½¬æ¢åçš„ä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-comment">//ç”¨é¢å¤–åˆ›å»ºçš„ç±»æ¥åˆ›å»ºåŒ¿åå†…éƒ¨ç±»å¯¹è±¡</span>      Runnable runnable = <span class="hljs-keyword">new</span> Demo8$<span class="hljs-number">1</span>();   &#125;&#125;<span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„ç±»ï¼Œå®ç°äº†Runnableæ¥å£</span><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>() &#123;&#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;      System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);   &#125;&#125;</code></pre></div><p>å¦‚æœåŒ¿åå†…éƒ¨ç±»ä¸­å¼•ç”¨äº†<strong>å±€éƒ¨å˜é‡</strong></p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            System.out.println(x);         &#125;      &#125;;   &#125;&#125;</code></pre></div><p>è½¬åŒ–åä»£ç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;         <span class="hljs-meta">@Override</span>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            System.out.println(x);         &#125;      &#125;;   &#125;&#125;<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;   <span class="hljs-comment">//å¤šåˆ›å»ºäº†ä¸€ä¸ªå˜é‡</span>   <span class="hljs-keyword">int</span> val$x;   <span class="hljs-comment">//å˜ä¸ºäº†æœ‰å‚æ„é€ å™¨</span>   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>(<span class="hljs-keyword">int</span> x) &#123;      <span class="hljs-keyword">this</span>.val$x = x;   &#125;   <span class="hljs-meta">@Override</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;      System.out.println(val$x);   &#125;&#125;</code></pre></div><h2 id="4ã€ç±»åŠ è½½é˜¶æ®µ"><a href="#4ã€ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="4ã€ç±»åŠ è½½é˜¶æ®µ"></a>4ã€ç±»åŠ è½½é˜¶æ®µ</h2><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><ul><li><p>å°†ç±»çš„å­—èŠ‚ç è½½å…¥</p><p>æ–¹æ³•åŒº</p><p>ï¼ˆ1.8åä¸ºå…ƒç©ºé—´ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­ï¼‰ä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ ï¬eld æœ‰ï¼š</p></li><li><p>_java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå®ƒçš„é•œåƒç±»å°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨ </p></li><li><p>_super å³çˆ¶ç±»</p></li><li><p>_ï¬elds å³æˆå‘˜å˜é‡ </p></li><li><p>_methods å³æ–¹æ³• </p></li><li><p>_constants å³å¸¸é‡æ±  </p></li><li><p>_class_loader å³ç±»åŠ è½½å™¨ </p></li><li><p>_vtable è™šæ–¹æ³•è¡¨ </p></li><li><p>_itable æ¥å£æ–¹æ³•</p></li><li><p>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œ<strong>å…ˆåŠ è½½çˆ¶ç±»</strong></p></li><li><p>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯<strong>äº¤æ›¿è¿è¡Œ</strong>çš„</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png" alt="img"></a></p><ul><li>instanceKlassä¿å­˜åœ¨<strong>æ–¹æ³•åŒº</strong>ã€‚JDK 8ä»¥åï¼Œæ–¹æ³•åŒºä½äºå…ƒç©ºé—´ä¸­ï¼Œè€Œå…ƒç©ºé—´åˆä½äºæœ¬åœ°å†…å­˜ä¸­</li><li>_java_mirroråˆ™æ˜¯ä¿å­˜åœ¨<strong>å †å†…å­˜</strong>ä¸­</li><li>InstanceKlasså’Œ*.class(JAVAé•œåƒç±»)äº’ç›¸ä¿å­˜äº†å¯¹æ–¹çš„åœ°å€</li><li>ç±»çš„å¯¹è±¡åœ¨å¯¹è±¡å¤´ä¸­ä¿å­˜äº†*.classçš„åœ°å€ã€‚è®©å¯¹è±¡å¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„instanceKlassï¼Œä»è€Œè·å–ç±»çš„å„ç§ä¿¡æ¯</li></ul><h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><h5 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h5><p>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</p><h5 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h5><p>ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼</p><ul><li>staticå˜é‡åœ¨JDK 7ä»¥å‰æ˜¯å­˜å‚¨ä¸instanceKlassæœ«å°¾ã€‚ä½†åœ¨JDK 7ä»¥åå°±å­˜å‚¨åœ¨_java_mirroræœ«å°¾äº†</li><li>staticå˜é‡åœ¨åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚åˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li><li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œä»¥åŠ<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œ<strong>èµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</strong></li><li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„ï¼Œä½†å±äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨<strong>åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</strong></li></ul><h5 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h5><p><strong>HSDBçš„ä½¿ç”¨</strong></p><ul><li>å…ˆè·å¾—è¦æŸ¥çœ‹çš„è¿›ç¨‹ID</li></ul><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">jps</span></code></pre></div><ul><li>æ‰“å¼€HSDB</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java">java -cp F:\JAVA\JDK8<span class="hljs-number">.0</span>\lib\sa-jdi.jar sun.jvm.hotspot.HSDB</code></pre></div><ul><li>è¿è¡Œæ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º<strong>ç¼ºå°‘ä¸€ä¸ª.dllçš„æ–‡ä»¶</strong>ï¼Œæˆ‘ä»¬åœ¨JDKçš„å®‰è£…ç›®å½•ä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°ç¼ºå¤±çš„æ–‡ä»¶ä¸‹å³å¯</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png" alt="img"></a></p><ul><li>å®šä½éœ€è¦çš„è¿›ç¨‹</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png" alt="img"></a></p><p><strong>è§£æçš„å«ä¹‰</strong></p><p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p><ul><li>æœªè§£ææ—¶ï¼Œå¸¸é‡æ± ä¸­çš„çœ‹åˆ°çš„å¯¹è±¡ä»…æ˜¯ç¬¦å·ï¼ŒæœªçœŸæ­£çš„å­˜åœ¨äºå†…å­˜ä¸­</li></ul><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>&#123;      ClassLoader loader = Demo1.class.getClassLoader();      <span class="hljs-comment">//åªåŠ è½½ä¸è§£æ</span>      Class&lt;?&gt; c = loader.loadClass(<span class="hljs-string">&quot;com.nyima.JVM.day8.C&quot;</span>);      <span class="hljs-comment">//ç”¨äºé˜»å¡ä¸»çº¿ç¨‹</span>      System.in.read();   &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>&#123;   D d = <span class="hljs-keyword">new</span> D();&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span> </span>&#123;&#125;</code></pre></div><ul><li>æ‰“å¼€HSDB<ul><li>å¯ä»¥çœ‹åˆ°æ­¤æ—¶åªåŠ è½½äº†ç±»C</li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png" alt="img"></a></p><p>æŸ¥çœ‹ç±»Cçš„å¸¸é‡æ± ï¼Œå¯ä»¥çœ‹åˆ°ç±»D<strong>æœªè¢«è§£æ</strong>ï¼Œåªæ˜¯å­˜åœ¨äºå¸¸é‡æ± ä¸­çš„ç¬¦å·</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png" alt="img"></a></p><ul><li>è§£æä»¥åï¼Œä¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨<ul><li>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å·²åŠ è½½å¹¶è§£æäº†ç±»Cå’Œç±»D</li></ul><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png" alt="img"></a></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png" alt="img"></a></p><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯<strong>æ‰§è¡Œç±»æ„é€ å™¨clinit()æ–¹æ³•çš„è¿‡ç¨‹</strong>ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨</p><ul><li>clinit()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„<strong>èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—</strong>ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„</li></ul><p><strong>æ³¨æ„</strong></p><p>ç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­<strong>å‡ºç°çš„é¡ºåºå†³å®š</strong>çš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒ<strong>ä¹‹å</strong>çš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—<strong>å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®</strong>ï¼Œå¦‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png" alt="img"></a></p><h5 id="å‘ç”Ÿæ—¶æœº"><a href="#å‘ç”Ÿæ—¶æœº" class="headerlink" title="å‘ç”Ÿæ—¶æœº"></a>å‘ç”Ÿæ—¶æœº</h5><p><strong>ç±»çš„åˆå§‹åŒ–çš„æ‡’æƒ°çš„</strong>ï¼Œä»¥ä¸‹æƒ…å†µä¼šåˆå§‹åŒ–</p><ul><li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ– </li><li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶ </li><li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘ </li><li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li><li>Class.forName </li><li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li></ul><p>ä»¥ä¸‹æƒ…å†µä¸ä¼šåˆå§‹åŒ–</p><ul><li>è®¿é—®ç±»çš„ static ï¬nal é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰</li><li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>åˆ›å»ºè¯¥ç±»å¯¹è±¡çš„æ•°ç»„</li><li>ç±»åŠ è½½å™¨çš„.loadClassæ–¹æ³•</li><li>Class.forNamedçš„å‚æ•°2ä¸ºfalseæ—¶</li></ul><p><strong>éªŒè¯ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥çœ‹æ”¹ç±»çš„é™æ€ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œ</strong></p><h2 id="5ã€ç±»åŠ è½½å™¨"><a href="#5ã€ç±»åŠ è½½å™¨" class="headerlink" title="5ã€ç±»åŠ è½½å™¨"></a>5ã€ç±»åŠ è½½å™¨</h2><p>Javaè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿæœ‰æ„æŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„<strong>â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€</strong>è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç è¢«ç§°ä¸º<strong>â€œç±»åŠ è½½å™¨â€</strong>ï¼ˆClassLoaderï¼‰</p><h4 id="ç±»ä¸ç±»åŠ è½½å™¨"><a href="#ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="ç±»ä¸ç±»åŠ è½½å™¨"></a>ç±»ä¸ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¶…ç±»åŠ è½½é˜¶æ®µ</p><p>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½å¿…é¡»ç”±åŠ è½½å®ƒçš„<strong>ç±»åŠ è½½å™¨</strong>å’Œè¿™ä¸ª<strong>ç±»æœ¬èº«</strong>ä¸€èµ·å…±åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚è¿™å¥è¯å¯ä»¥è¡¨è¾¾å¾—æ›´é€šä¿—ä¸€äº›ï¼š<strong>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰</strong>ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰</p><p>ä»¥JDK 8ä¸ºä¾‹</p><table><thead><tr><th>åç§°</th><th>åŠ è½½çš„ç±»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Bootstrap ClassLoaderï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</td><td>JAVA_HOME/jre/lib</td><td>æ— æ³•ç›´æ¥è®¿é—®</td></tr><tr><td>Extension ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</td><td>JAVA_HOME/jre/lib/ext</td><td>ä¸Šçº§ä¸ºBootstrapï¼Œ<strong>æ˜¾ç¤ºä¸ºnull</strong></td></tr><tr><td>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</td><td>classpath</td><td>ä¸Šçº§ä¸ºExtension</td></tr><tr><td>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td><td>è‡ªå®šä¹‰</td><td>ä¸Šçº§ä¸ºApplication</td></tr></tbody></table><h4 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h4><p>å¯é€šè¿‡åœ¨æ§åˆ¶å°è¾“å…¥æŒ‡ä»¤ï¼Œä½¿å¾—ç±»è¢«å¯åŠ¨ç±»åŠ å™¨åŠ è½½</p><h4 id="æ‹“å±•ç±»åŠ è½½å™¨"><a href="#æ‹“å±•ç±»åŠ è½½å™¨" class="headerlink" title="æ‹“å±•ç±»åŠ è½½å™¨"></a>æ‹“å±•ç±»åŠ è½½å™¨</h4><p>å¦‚æœclasspathå’ŒJAVA_HOME/jre/lib/ext ä¸‹æœ‰åŒåç±»ï¼ŒåŠ è½½æ—¶ä¼šä½¿ç”¨<strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>åŠ è½½ã€‚å½“åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å‘ç°æ‹“å±•ç±»åŠ è½½å™¨å·²å°†è¯¥åŒåç±»åŠ è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŠ è½½</p><h4 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h4><p>åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³è°ƒç”¨ç±»åŠ è½½å™¨ClassLoader çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</p><p>loadClassæºç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-keyword">boolean</span> resolve)    <span class="hljs-keyword">throws</span> ClassNotFoundException&#123;    <span class="hljs-keyword">synchronized</span> (getClassLoadingLock(name)) &#123;        <span class="hljs-comment">// é¦–å…ˆæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»è¢«è¯¥ç±»åŠ è½½å™¨åŠ è½½è¿‡äº†</span>        Class&lt;?&gt; c = findLoadedClass(name);        <span class="hljs-comment">//å¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡</span>        <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">long</span> t0 = System.nanoTime();            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å®ƒçš„ä¸Šçº§åŠ è½½å™¨åŠ è½½è¿‡äº† Extensionçš„ä¸Šçº§æ˜¯Bootstarpï¼Œä½†å®ƒæ˜¾ç¤ºä¸ºnull</span>                <span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;                    c = parent.loadClass(name, <span class="hljs-keyword">false</span>);                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½è¿‡</span>                    c = findBootstrapClassOrNull(name);                &#125;            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;                <span class="hljs-comment">// ClassNotFoundException thrown if class not found</span>                <span class="hljs-comment">// from the non-null parent class loader</span>                <span class="hljs-comment">//æ•è·å¼‚å¸¸ï¼Œä½†ä¸åšä»»ä½•å¤„ç†</span>            &#125;            <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;                <span class="hljs-comment">//å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆè®©æ‹“å±•ç±»åŠ è½½å™¨è°ƒç”¨findClassæ–¹æ³•å»æ‰¾åˆ°è¯¥ç±»ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span>                <span class="hljs-comment">//ç„¶åè®©åº”ç”¨ç±»åŠ è½½å™¨å»æ‰¾classpathä¸‹æ‰¾è¯¥ç±»</span>                <span class="hljs-keyword">long</span> t1 = System.nanoTime();                c = findClass(name);                <span class="hljs-comment">// è®°å½•æ—¶é—´</span>                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);                sun.misc.PerfCounter.getFindClasses().increment();            &#125;        &#125;        <span class="hljs-keyword">if</span> (resolve) &#123;            resolveClass(c);        &#125;        <span class="hljs-keyword">return</span> c;    &#125;&#125;</code></pre></div><h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul><li>æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶ </li><li>é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡ </li><li>è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨</li></ul><h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ul><li><p>ç»§æ‰¿ClassLoaderçˆ¶ç±»</p></li><li><p>è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•</p></li><li><p>ä¸æ˜¯é‡å†™loadClassæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶</p></li><li><p>è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç </p></li><li><p>è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±» </p></li><li><p>ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</p></li></ul><h4 id="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"><a href="#ç ´ååŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"></a>ç ´ååŒäº²å§”æ´¾æ¨¡å¼</h4><ul><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£<ul><li>å»ºè®®ç”¨æˆ·é‡å†™findClass()æ–¹æ³•ï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­çš„loadClass()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•</li></ul></li><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„<ul><li>å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œæ­¤æ—¶ä¹Ÿä¼šç ´ååŒäº²å§”æ´¾æ¨¡å¼</li></ul></li><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„<ul><li>è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰</li></ul></li></ul><h2 id="6ã€è¿è¡ŒæœŸä¼˜åŒ–"><a href="#6ã€è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="6ã€è¿è¡ŒæœŸä¼˜åŒ–"></a>6ã€è¿è¡ŒæœŸä¼˜åŒ–</h2><h4 id="åˆ†å±‚ç¼–è¯‘"><a href="#åˆ†å±‚ç¼–è¯‘" class="headerlink" title="åˆ†å±‚ç¼–è¯‘"></a>åˆ†å±‚ç¼–è¯‘</h4><p>JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š</p><ul><li>0å±‚ï¼šè§£é‡Šæ‰§è¡Œï¼Œç”¨è§£é‡Šå™¨å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºæœºå™¨ç </li><li>1å±‚ï¼šä½¿ç”¨ C1 <strong>å³æ—¶ç¼–è¯‘å™¨</strong>ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ proï¬lingï¼‰ </li><li>2å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„profilingï¼‰</li><li>3å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„profilingï¼‰</li><li>4å±‚ï¼šä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ</li></ul><p>proï¬ling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„ å›è¾¹æ¬¡æ•°ã€‘ç­‰</p><h5 id="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"><a href="#å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«" class="headerlink" title="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"></a>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«</h5><ul><li><p>è§£é‡Šå™¨</p><ul><li>å°†å­—èŠ‚ç <strong>è§£é‡Š</strong>ä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š </li><li>æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç  </li></ul></li><li><p>å³æ—¶ç¼–è¯‘å™¨</p></li><li><p>å°†ä¸€äº›å­—èŠ‚ç <strong>ç¼–è¯‘</strong>ä¸ºæœºå™¨ç ï¼Œ<strong>å¹¶å­˜å…¥ Code Cache</strong>ï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘ </p></li><li><p>æ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç </p></li></ul><p>å¯¹äºå¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1 &lt; C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”± æ¥ï¼‰ï¼Œå¹¶ä¼˜åŒ–è¿™äº›çƒ­ç‚¹ä»£ç </p><h5 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h5><p>é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯</p><p>é€ƒé€¸åˆ†æçš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯é€ƒé€¸åˆ†æï¼š-XX:+DoEscapeAnalysis</li><li>å…³é—­é€ƒé€¸åˆ†æï¼š-XX:-DoEscapeAnalysis</li><li>æ˜¾ç¤ºåˆ†æç»“æœï¼š-XX:+PrintEscapeAnalysis</li></ul><p>é€ƒé€¸åˆ†ææŠ€æœ¯åœ¨ Java SE 6u23+ å¼€å§‹æ”¯æŒï¼Œå¹¶é»˜è®¤è®¾ç½®ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä¸ç”¨é¢å¤–åŠ è¿™ä¸ªå‚æ•°</p><p><strong>å¯¹è±¡é€ƒé€¸çŠ¶æ€</strong></p><p><strong>å…¨å±€é€ƒé€¸ï¼ˆGlobalEscapeï¼‰</strong></p><ul><li>å³ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´é€ƒå‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š<ul><li>å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å˜é‡</li><li>å¯¹è±¡æ˜¯ä¸€ä¸ªå·²ç»å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡</li><li>å¯¹è±¡ä½œä¸ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼</li></ul></li></ul><p><strong>å‚æ•°é€ƒé€¸ï¼ˆArgEscapeï¼‰</strong></p><ul><li>å³ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’æˆ–è€…è¢«å‚æ•°å¼•ç”¨ï¼Œä½†åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå…¨å±€é€ƒé€¸ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯é€šè¿‡è¢«è°ƒæ–¹æ³•çš„å­—èŠ‚ç ç¡®å®šçš„</li></ul><p><strong>æ²¡æœ‰é€ƒé€¸</strong></p><ul><li>å³æ–¹æ³•ä¸­çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸</li></ul><p><strong>é€ƒé€¸åˆ†æä¼˜åŒ–</strong></p><p>é’ˆå¯¹ä¸Šé¢ç¬¬ä¸‰ç‚¹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡<strong>æ²¡æœ‰é€ƒé€¸</strong>æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæœºçš„ä¼˜åŒ–</p><p><strong>é”æ¶ˆé™¤</strong></p><p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹åŒæ­¥é”æ˜¯éå¸¸ç‰ºç‰²æ€§èƒ½çš„ï¼Œå½“ç¼–è¯‘å™¨ç¡®å®šå½“å‰å¯¹è±¡åªæœ‰å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”</p><p>ä¾‹å¦‚ï¼ŒStringBuffer å’Œ Vector éƒ½æ˜¯ç”¨ synchronized ä¿®é¥°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­ç”¨åˆ°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šä¼˜åŒ–ç§»é™¤æ‰è¿™äº›é”æ“ä½œ</p><p>é”æ¶ˆé™¤çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯é”æ¶ˆé™¤ï¼š-XX:+EliminateLocks</li><li>å…³é—­é”æ¶ˆé™¤ï¼š-XX:-EliminateLocks</li></ul><p>é”æ¶ˆé™¤åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”é”æ¶ˆé™¤éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p><p><strong>æ ‡é‡æ›¿æ¢</strong></p><p>é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼Œ<strong>åŸºç¡€ç±»å‹</strong>å’Œ<strong>å¯¹è±¡çš„å¼•ç”¨</strong>å¯ä»¥ç†è§£ä¸º<strong>æ ‡é‡</strong>ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡</p><p>å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åš<strong>æ ‡é‡æ›¿æ¢</strong>ã€‚</p><p>è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p><p>æ ‡é‡æ›¿æ¢çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯æ ‡é‡æ›¿æ¢ï¼š-XX:+EliminateAllocations</li><li>å…³é—­æ ‡é‡æ›¿æ¢ï¼š-XX:-EliminateAllocations</li><li>æ˜¾ç¤ºæ ‡é‡æ›¿æ¢è¯¦æƒ…ï¼š-XX:+PrintEliminateAllocations</li></ul><p>æ ‡é‡æ›¿æ¢åŒæ ·åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p><p><strong>æ ˆä¸Šåˆ†é…</strong></p><p>å½“å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œè¯¥<strong>å¯¹è±¡</strong>å°±å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢åˆ†è§£æˆæˆå‘˜æ ‡é‡åˆ†é…åœ¨<strong>æ ˆå†…å­˜</strong>ä¸­ï¼Œå’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œéšç€æ ˆå¸§å‡ºæ ˆæ—¶é”€æ¯ï¼Œå‡å°‘äº† GC å‹åŠ›ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p><h4 id="æ–¹æ³•å†…è”"><a href="#æ–¹æ³•å†…è”" class="headerlink" title="æ–¹æ³•å†…è”"></a>æ–¹æ³•å†…è”</h4><h5 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a><strong>å†…è”å‡½æ•°</strong></h5><p>å†…è”å‡½æ•°å°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†ç¨‹åºä¸­å‡ºç°çš„å†…è”å‡½æ•°çš„è°ƒç”¨è¡¨è¾¾å¼ç”¨å†…è”å‡½æ•°çš„å‡½æ•°ä½“æ¥ç›´æ¥è¿›è¡Œæ›¿æ¢</p><h5 id="JVMå†…è”å‡½æ•°"><a href="#JVMå†…è”å‡½æ•°" class="headerlink" title="JVMå†…è”å‡½æ•°"></a><strong>JVMå†…è”å‡½æ•°</strong></h5><p>C++æ˜¯å¦ä¸ºå†…è”å‡½æ•°ç”±è‡ªå·±å†³å®šï¼ŒJavaç”±<strong>ç¼–è¯‘å™¨å†³å®š</strong>ã€‚Javaä¸æ”¯æŒç›´æ¥å£°æ˜ä¸ºå†…è”å‡½æ•°çš„ï¼Œå¦‚æœæƒ³è®©ä»–å†…è”ï¼Œä½ åªèƒ½å¤Ÿå‘ç¼–è¯‘å™¨æå‡ºè¯·æ±‚: å…³é”®å­—<strong>finalä¿®é¥°</strong> ç”¨æ¥æŒ‡æ˜é‚£ä¸ªå‡½æ•°æ˜¯å¸Œæœ›è¢«JVMå†…è”çš„ï¼Œå¦‚</p><div class="hljs code-wrapper"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>&#123;          <span class="hljs-comment">// to do something  </span>&#125;Copy</code></pre></div><p>æ€»çš„æ¥è¯´ï¼Œä¸€èˆ¬çš„å‡½æ•°éƒ½ä¸ä¼šè¢«å½“åšå†…è”å‡½æ•°ï¼Œåªæœ‰å£°æ˜äº†finalåï¼Œç¼–è¯‘å™¨æ‰ä¼šè€ƒè™‘æ˜¯ä¸æ˜¯è¦æŠŠä½ çš„å‡½æ•°å˜æˆå†…è”å‡½æ•°</p><p>JVMå†…å»ºæœ‰è®¸å¤šè¿è¡Œæ—¶ä¼˜åŒ–ã€‚é¦–å…ˆ<strong>çŸ­æ–¹æ³•</strong>æ›´åˆ©äºJVMæ¨æ–­ã€‚æµç¨‹æ›´æ˜æ˜¾ï¼Œä½œç”¨åŸŸæ›´çŸ­ï¼Œå‰¯ä½œç”¨ä¹Ÿæ›´æ˜æ˜¾ã€‚å¦‚æœæ˜¯é•¿æ–¹æ³•JVMå¯èƒ½ç›´æ¥å°±è·ªäº†ã€‚</p><p>ç¬¬äºŒä¸ªåŸå› åˆ™æ›´é‡è¦ï¼š<strong>æ–¹æ³•å†…è”</strong></p><p>å¦‚æœJVMç›‘æµ‹åˆ°ä¸€äº›<strong>å°æ–¹æ³•è¢«é¢‘ç¹çš„æ‰§è¡Œ</strong>ï¼Œå®ƒä¼šæŠŠæ–¹æ³•çš„è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“æœ¬èº«ï¼Œå¦‚ï¼š</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123;         <span class="hljs-comment">//è¿™é‡Œè°ƒç”¨äº†add2æ–¹æ³•</span>        <span class="hljs-keyword">return</span> add2(x1, x2) + add2(x3, x4);      &#125;      <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2)</span> </span>&#123;          <span class="hljs-keyword">return</span> x1 + x2;      &#125;</code></pre></div><p>æ–¹æ³•è°ƒç”¨è¢«æ›¿æ¢å</p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123;          <span class="hljs-comment">//è¢«æ›¿æ¢ä¸ºäº†æ–¹æ³•æœ¬èº«</span>        <span class="hljs-keyword">return</span> x1 + x2 + x3 + x4;      &#125;</code></pre></div><h4 id="åå°„ä¼˜åŒ–"><a href="#åå°„ä¼˜åŒ–" class="headerlink" title="åå°„ä¼˜åŒ–"></a>åå°„ä¼˜åŒ–</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reflect1</span> </span>&#123;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>&#123;      System.out.println(<span class="hljs-string">&quot;foo...&quot;</span>);   &#125;   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;      Method foo = Demo3.class.getMethod(<span class="hljs-string">&quot;foo&quot;</span>);      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt;=<span class="hljs-number">16</span>; i++) &#123;         foo.invoke(<span class="hljs-keyword">null</span>);      &#125;   &#125;&#125;</code></pre></div><p>foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç°</p><p>invokeæ–¹æ³•æºç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@CallerSensitive</span><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object obj, Object... args)</span></span><span class="hljs-function">    <span class="hljs-keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span><span class="hljs-function">       InvocationTargetException</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (!override) &#123;        <span class="hljs-keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;            Class&lt;?&gt; caller = Reflection.getCallerClass();            checkAccess(caller, clazz, obj, modifiers);        &#125;    &#125;    <span class="hljs-comment">//MethodAccessoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰3ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯æŠ½è±¡ç±»</span>    MethodAccessor ma = methodAccessor;             <span class="hljs-comment">// read volatile</span>    <span class="hljs-keyword">if</span> (ma == <span class="hljs-keyword">null</span>) &#123;        ma = acquireMethodAccessor();    &#125;    <span class="hljs-keyword">return</span> ma.invoke(obj, args);&#125;</code></pre></div><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png" alt="img"></a></p><p>ä¼šç”±DelegatingMehodAccessorImplå»è°ƒç”¨NativeMethodAccessorImpl</p><p>NativeMethodAccessorImplæºç </p><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NativeMethodAccessorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MethodAccessorImpl</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method method;    <span class="hljs-keyword">private</span> DelegatingMethodAccessorImpl parent;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> numInvocations;    NativeMethodAccessorImpl(Method var1) &#123;        <span class="hljs-keyword">this</span>.method = var1;    &#125;    <span class="hljs-comment">//æ¯æ¬¡è¿›è¡Œåå°„è°ƒç”¨ï¼Œä¼šè®©numInvocationä¸ReflectionFactory.inflationThresholdçš„å€¼ï¼ˆ15ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä½¿ä½¿å¾—numInvocationçš„å€¼åŠ ä¸€</span>    <span class="hljs-comment">//å¦‚æœnumInvocation&gt;ReflectionFactory.inflationThresholdï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object var1, Object[] var2)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;        <span class="hljs-keyword">if</span> (++<span class="hljs-keyword">this</span>.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(<span class="hljs-keyword">this</span>.method.getDeclaringClass())) &#123;            MethodAccessorImpl var3 = (MethodAccessorImpl)(<span class="hljs-keyword">new</span> MethodAccessorGenerator()).generateMethod(<span class="hljs-keyword">this</span>.method.getDeclaringClass(), <span class="hljs-keyword">this</span>.method.getName(), <span class="hljs-keyword">this</span>.method.getParameterTypes(), <span class="hljs-keyword">this</span>.method.getReturnType(), <span class="hljs-keyword">this</span>.method.getExceptionTypes(), <span class="hljs-keyword">this</span>.method.getModifiers());            <span class="hljs-keyword">this</span>.parent.setDelegate(var3);        &#125;        <span class="hljs-keyword">return</span> invoke0(<span class="hljs-keyword">this</span>.method, var1, var2);    &#125;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParent</span><span class="hljs-params">(DelegatingMethodAccessorImpl var1)</span> </span>&#123;        <span class="hljs-keyword">this</span>.parent = var1;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title">invoke0</span><span class="hljs-params">(Method var0, Object var1, Object[] var2)</span></span>;&#125;Copy<span class="hljs-comment">//ReflectionFactory.inflationThreshold()æ–¹æ³•çš„è¿”å›å€¼</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> inflationThreshold = <span class="hljs-number">15</span>;</code></pre></div><ul><li>ä¸€å¼€å§‹ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0</li><li>éšç€numInvocationçš„å¢å¤§ï¼Œå½“å®ƒå¤§äºReflectionFactory.inflationThresholdçš„å€¼16æ—¶ï¼Œå°±ä¼šæœ¬åœ°æ–¹æ³•è®¿é—®å™¨æ›¿æ¢ä¸ºä¸€ä¸ªè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„è®¿é—®å™¨ï¼Œæ¥æé«˜æ•ˆç‡<ul><li>è¿™æ—¶ä¼šä»åå°„è°ƒç”¨å˜ä¸º<strong>æ­£å¸¸è°ƒç”¨</strong>ï¼Œå³ç›´æ¥è°ƒç”¨ Reflect1.foo()</li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png" alt="img"></a></p>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
