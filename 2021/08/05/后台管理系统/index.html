

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/bat.png">
  <link rel="icon" href="/img/bat.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Lucifer">
  <meta name="keywords" content="">
  
  <title>后台管理系统开发记录 - Lucifer&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/monokai.min.css" />
    
  

  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"lucifer2u.github.io","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":false,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"Q8utolFFXQsi71pQY6bCltkI-gzGzoHsz","app_key":"x4RAlPOpmFX9HdGyI6MLoCGn","server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 80vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Lucifer</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/Flower.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="后台管理系统开发记录">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-08-05 20:37" pubdate>
        2021年8月5日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      32.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      559
       分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">后台管理系统开发记录</h1>
            
            <div class="markdown-body">
              <h1 id="人力资源管理系统"><a href="#人力资源管理系统" class="headerlink" title="人力资源管理系统"></a>人力资源管理系统</h1><blockquote>
<p>本文记录开发一个 SpringBoot+Vue 前后端分离的人力资源管理系统</p>
</blockquote>
<h1 id="一、技术栈"><a href="#一、技术栈" class="headerlink" title="一、技术栈"></a>一、技术栈</h1><h2 id="后端技术栈"><a href="#后端技术栈" class="headerlink" title="后端技术栈"></a>后端技术栈</h2><ul>
<li>Spring Boot</li>
<li>Spring Security</li>
<li>MyBatis</li>
<li>MySQL</li>
<li>Redis</li>
<li>RabbitMQ</li>
<li>Spring Cache</li>
<li>WebSocket</li>
</ul>
<h2 id="前端技术栈"><a href="#前端技术栈" class="headerlink" title="前端技术栈"></a>前端技术栈</h2><ul>
<li>Vue</li>
<li>ElementUI</li>
<li>axios</li>
<li>vue-router</li>
<li>Vuex</li>
<li>WebSocket</li>
<li>vue-cli4</li>
</ul>
<h3 id="为什么选用Vue？"><a href="#为什么选用Vue？" class="headerlink" title="为什么选用Vue？"></a>为什么选用Vue？</h3><p>Vue 是一套用于构建用户界面的渐进式框架。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与现代化的工具链以及各种支持类库结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p>
<ul>
<li>只关注视图层</li>
<li>MVVM 框架</li>
</ul>
<p>在使用 jQuery 过程中，掺杂了大量的 DOM 操作，修改视图或者获取 value ，都需要 DOM 操作，MVVM 是一种视图和数据模型双向绑定的框架，即数据发生变化，视图会跟着变化，视图发生变化，数据模型也会跟着变化，开发者再也不需要操作 DOM 节点</p>
<h3 id="MVC与MVVM"><a href="#MVC与MVVM" class="headerlink" title="MVC与MVVM"></a>MVC与MVVM</h3><p><strong>MVC</strong>中的<strong>M</strong>就是单纯的从网络获取回来的数据模型，<strong>V</strong>指的我们的视图界面，而<strong>C</strong>就是我们的ViewController。</p>
<p>在其中，ViewController负责View和Model之间调度，View发生交互事件会通过target-action或者delegate方式回调给ViewController，与此同时ViewController还要承担把Model通过KVO、Notification方式传来的数据传输给View用于展示的责任。<code>随着业务越来越复杂，视图交互越复杂，导致Controller越来越臃肿，负重前行。脏活累活都它干了，到头来还一点不讨好。福报修多了的结果就是，不行了就重构你，重构不了就换掉你</code>。来一张斯坦福老头经典的MVC架构图。</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809000010550.png" srcset="/img/loading.gif" lazyload alt="image-20210809000010550"></p>
<p>所以为了解决这个问题，MVVM就闪亮登场了。他把View和Contrller都放在了View层（相当于把Controller一部分逻辑抽离了出来），Model层依然是服务端返回的数据模型。<code>而ViewModel充当了一个UI适配器的角色，也就是说View中每个UI元素都应该在ViewModel找到与之对应的属性。除此之外，从Controller抽离出来的与UI有关的逻辑都放在了ViewModel中，这样就减轻了Controller的负担</code>。下面是网上经典的MVVM的架构图</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210809000029611.png" srcset="/img/loading.gif" lazyload alt="image-20210809000029611"></p>
<p>从以上的架构图中，我们可以很清晰的梳理出各自的分工。</p>
<ul>
<li><strong>View层</strong>：视图展示。包含UIView以及UIViewController，View层是可以持有ViewModel的。</li>
<li><strong>ViewModel层</strong>：视图适配器。暴露属性与View元素显示内容或者元素状态一一对应。一般情况下ViewModel暴露的属性建议是readOnly的。还有一点，ViewModel层是可以持有Model的，但是ViewModel不能持有View，1.ViewModel可测性，即单元测试方便进行。2.团队人员可分离开发（View和ViewModel开发可以是两个人同时进行）。</li>
<li><strong>Model层</strong>：数据模型与持久化抽象模型。数据模型很好理解，就是从服务器拉回来的JSON数据。而持久化抽象模型暂时放在Model层，是因为MVVM诞生之初就没有对这块进行很细致的描述。按照经验，我们通常把数据库、文件操作封装成Model，并对外提供操作接口。（有些公司把数据存取操作单拎出来一层，称之为<strong>DataAdapter层</strong>，所以在业内会有很多MVVM的变种，但其本质上都是MVVM）。</li>
<li><strong>Binder</strong>：MVVM的灵魂。可惜在MVVM这几个英文单词中并没有它的一席之地，它的最主要作用是在View和ViewModel之间做了双向数据绑定。如果MVVM没有Binder，那么它与MVC的差异不是很大。</li>
</ul>
<p>我们发现，正是因为View、ViewModel以及Model间的清晰的持有关系，所以在三个模块间的数据流转有了很好的控制</p>
<h1 id="二、SPA"><a href="#二、SPA" class="headerlink" title="二、SPA"></a>二、SPA</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p><strong>单页应用</strong>（英语：single-page application，缩写<strong>SPA</strong>）是一种<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">网络应用程序</a>或<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E7%AB%99">网站</a>的模型，它通过动态重写当前页面来与用户交互，而非传统的从服务器重新加载整个新页面。这种方法避免了页面之间切换打断<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C">用户体验</a>，使应用程序更像一个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6">桌面应用程序</a>。它将所有的活动局限于一个 Web 页面中，仅在该 Web 页面初始化时加载相应的 HTML、JavaScript、CSS。一旦页面加载完成，SPA 不会因为用户的操作而进行页面的重新加载或跳转，而是利用 JavaScript 动态的变换 HTML（采用的是 div 切换显示和隐藏），从而实现UI与用户的交互。在 SPA 应用中，应用加载之后就不会再有整页刷新。</p>
</blockquote>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p><strong>1) 有良好的交互体验</strong><br>能提升页面切换体验，用户在访问应用页面是不会频繁的去切换浏览页面，从而避免了页面的重新加载；<br><strong>2) 前后端分离开发</strong><br>单页Web应用可以和 RESTful 规约一起使用，通过 REST API 提供接口数据，并使用 Ajax 异步获取，这样有助于分离客户端和服务器端工作。更进一步，可以在客户端也可以分解为静态页面和页面交互两个部分；<br><strong>3) 减轻服务器压力</strong><br>服务器只用出数据就可以，不用管展示逻辑和页面合成，吞吐能力会提高几倍；<br><strong>4) 共用一套后端程序代码</strong><br>不用修改后端程序代码就可以同时用于 Web 界面、手机、平板等多种客户端；</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p><strong>1) SEO难度较高</strong><br>由于所有的内容都在一个页面中动态替换显示，所以在SEO上其有着天然的弱势，所以如果你的站点对SEO很看重，且要用单页应用，那么就做些静态页面给搜索引擎用吧；<br><strong>2) 前进、后退管理</strong><br>由于单页Web应用在一个页面中显示所有的内容，所以不能使用浏览器的前进后退功能，所有的页面切换需要自己建立堆栈管理，当然此问题也有解决方案，比如利用URI中的散列+iframe实现；<br><strong>3) 初次加载耗时多</strong><br>为实现单页Web应用功能及显示效果，需要在加载页面的时候将JavaScript、CSS统一加载，部分页面可以在需要的时候加载。所以必须对JavaScript及CSS代码进行合并压缩处理；</p>
<p><code>本项目是后台管理系统，因为不需要搜索引擎优化，所以选用了单页面应用的技术</code></p>
<h1 id="三、Vue的构建"><a href="#三、Vue的构建" class="headerlink" title="三、Vue的构建"></a>三、Vue的构建</h1><h3 id="安装NodeJS与npm"><a href="#安装NodeJS与npm" class="headerlink" title="安装NodeJS与npm"></a>安装NodeJS与npm</h3><p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528161005216.png" srcset="/img/loading.gif" lazyload alt="image-20210528161005216"></p>
<h3 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h3><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g vue-cli   # 只需要第一次安装时执行
vue init webpack my-project  # 使用webpack模板创建一个vue项目
cd my-project #进入到项目目录中
npm install  # 下载依赖（如果在项目创建的最后一步选择了自动执行npm install，则该步骤可以省略）
npm run dev # 启动项目</code></pre></div>

<h3 id="Vue-项目结构介绍"><a href="#Vue-项目结构介绍" class="headerlink" title="Vue 项目结构介绍"></a>Vue 项目结构介绍</h3><p>Vue 项目创建完成后，使用 Web Storm 打开项目，项目目录如下：</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528162924438.png" srcset="/img/loading.gif" lazyload alt="image-20210528162924438"></p>
<ul>
<li>build 文件夹，用来存放项目构建脚本</li>
<li>config 中存放项目的一些基本配置信息，最常用的就是端口转发</li>
<li>node_modules 这个目录存放的是项目的所有依赖，即 npm install 命令下载下来的文件</li>
<li>src 这个目录下存放项目的源码，即开发者写的代码放在这里</li>
<li>static 用来存放静态资源</li>
<li>index.html 则是项目的首页，入口页，也是整个项目唯一的HTML页面</li>
<li>package.json 中定义了项目的所有依赖，包括开发时依赖和发布时依赖</li>
</ul>
<p>对于开发者来说，以后 99.99% 的工作都是在 src 中完成的，src 中的文件目录如下：</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528163055327.png" srcset="/img/loading.gif" lazyload alt="image-20210528163055327"></p>
<ul>
<li>assets 目录用来存放资产文件</li>
<li>components 目录用来存放组件（一些可复用，非独立的页面），当然开发者也可以在 components 中直接创建完整页面。</li>
<li>推荐在 components 中存放组件，另外单独新建一个 page 文件夹，专门用来放完整页面。</li>
<li>router 目录中，存放了路由的js文件</li>
<li>App.vue 是一个Vue组件，也是项目的第一个Vue组件</li>
<li>main.js相当于Java中的main方法，是整个项目的入口js</li>
</ul>
<p><strong>main.js</strong> 内容如下：</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App&#x27;</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span>
Vue.config.productionTip = <span class="hljs-literal">false</span>
<span class="hljs-comment">/* eslint-disable no-new */</span>
<span class="hljs-keyword">new</span> Vue(&#123;
  el: <span class="hljs-string">&#x27;#app&#x27;</span>,
  router,
  components: &#123; App &#125;,
  template: <span class="hljs-string">&#x27;&lt;App/&gt;&#x27;</span>
&#125;)</code></pre></div>

<ul>
<li>在main.js 中，首先导入 Vue 对象</li>
<li>导入 App.vue ，并且命名为 App</li>
<li>导入router，注意，由于router目录下路由默认文件名为 index.js ，因此可以省略</li>
<li>所有东西都导入成功后，创建一个Vue对象，设置要被Vue处理的节点是 ‘#app’，’#app’ 指提前在index.html 文件中定义的一个div</li>
<li>将 router 设置到 vue 对象中，这里是一个简化的写法，完整的写法是 router:router，如果 key/value 一模一样，则可以简写。</li>
<li>声明一个组件 App，App 这个组件在一开始已经导入到项目中了，但是直接导入的组件无法直接使用，必须要声明。</li>
<li>template 中定义了页面模板，即将 App 组件中的内容渲染到 ‘#app’ 这个div 中。</li>
</ul>
<p>因此，可以猜测，项目启动成功后，看到的页面效果定义在 <strong>App.vue</strong> 中</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;img src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;
    &lt;router-view&#x2F;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &#39;App&#39;
&#125;
&lt;&#x2F;script&gt;

&lt;style&gt;
#app &#123;
  font-family: &#39;Avenir&#39;, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
&#125;
&lt;&#x2F;style&gt;</code></pre></div>

<ul>
<li>App.vue 是一个vue组件，这个组件中包含三部分内容：<ul>
<li>页面模板（template）</li>
<li>页面脚本（script）；</li>
<li>页面样式（style）</li>
</ul>
</li>
<li>页面模板中，定义了页面的 HTML 元素，这里定义了两个，一个是一张图片，另一个则是一个 router-view</li>
<li>页面脚本主要用来实现当前页面数据初始化、事件处理等等操作</li>
<li>页面样式就是针对 template 中 HTML 元素的页面美化操作</li>
</ul>
<p>需要额外解释的是，<strong>router-view</strong>，这个指展示路由页面的位置，可以简单理解为一个占位符，这个占位符展示的内容将根据当前具体的 URL 地址来定。具体展示的内容，要参考路由表，即 <strong>router/index.js</strong> 文件，该文件如下：</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> Router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>
<span class="hljs-keyword">import</span> HelloWorld <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/HelloWorld&#x27;</span>
Vue.use(Router)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Router(&#123;
  routes: [
    &#123;
      path: <span class="hljs-string">&#x27;/&#x27;</span>,
      name: <span class="hljs-string">&#x27;HelloWorld&#x27;</span>,
      component: HelloWorld
    &#125;
  ]
&#125;)</code></pre></div>

<ul>
<li>这个文件中，首先导入了Vue对象、Router对象以及 HelloWorld 组件，</li>
<li>创建一个Router对象，并定义路由表</li>
<li>这里定义的路由表，path为 <code>/</code> ，对应的组件为 HelloWorld，即浏览器地址为 <code>/</code> 时，在router-view位置显示 HelloWorld 组件</li>
</ul>
<h3 id="项目编译"><a href="#项目编译" class="headerlink" title="项目编译"></a>项目编译</h3><p>这么大一个前端项目，肯定没法直接发布运行，当开发者完成项目开发后，将 cmd 命令行定位到当前项目目录，然后执行如下命令对项目进行打包：</p>
<div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run build</span></code></pre></div>

<p>打包成功后，当前项目目录下会生成一个 dist 文件夹，这个文件夹中有两个文件，分别是 index.html 和 static ，index.html 页面就是我们 SPA 项目中唯一的 HTML 页面了，static 中则保存了编译后的 js、css等文件，项目发布时，可以使用 nginx 独立部署 dist 中的静态文件，也可以将静态文件拷贝到 Spring Boot 项目的 static 目录下，然后对 Spring Boot 项目进行编译打包发布。</p>
<h3 id="使用Vue-cli3构建项目"><a href="#使用Vue-cli3构建项目" class="headerlink" title="使用Vue-cli3构建项目"></a>使用Vue-cli3构建项目</h3><blockquote>
<p>Vue 提供了一个<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli">官方的 CLI</a>，为单页面应用 (SPA) 快速搭建繁杂的脚手架。它为现代前端工作流提供了 batteries-included 的构建设置。只需要几分钟的时间就可以运行起来并带有热重载、保存时 lint 校验，以及生产环境可用的构建版本</p>
</blockquote>
<div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 安装</span>
npm install -g @vue/cli
<span class="hljs-comment"># 创建项目</span>
vue create vuehr
$ <span class="hljs-built_in">cd</span> vuehr
$ npm run serve</code></pre></div>

<p>整体项目变得更加简洁</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210528193634072.png" srcset="/img/loading.gif" lazyload alt="image-20210528193634072"></p>
<p>至此，前端部分的准备工作已经结束，现在可以开始搭建项目</p>
<h1 id="四、前端的搭建"><a href="#四、前端的搭建" class="headerlink" title="四、前端的搭建"></a>四、前端的搭建</h1><p><strong>安装element</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs bash">npm i element-ui -S</code></pre></div>

<p><strong>引用element</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> ElementUI <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;
Vue.use(ElementUI);</code></pre></div>

<h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><p><strong>main.js</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;postKeyValueRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;
<span class="hljs-keyword">import</span> &#123;putRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;
<span class="hljs-keyword">import</span> &#123;getRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;
<span class="hljs-keyword">import</span> &#123;deleteRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/api&quot;</span>;

Vue.prototype.postRequest = postRequest;
Vue.prototype.postKeyValueRequest = postKeyValueRequest;
Vue.prototype.putRequest = putRequest;
Vue.prototype.getRequest = getRequest;
Vue.prototype.deleteRequest = deleteRequest;

Vue.use(ElementUI);

Vue.config.productionTip = <span class="hljs-literal">false</span>

<span class="hljs-keyword">new</span> Vue(&#123;
  router,
  render: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> h(App)
&#125;).$mount(<span class="hljs-string">&#x27;#app&#x27;</span>)</code></pre></div>

<p><strong>router里配置index.js</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> VueRouter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>
<span class="hljs-keyword">import</span> Login <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Login.vue&#x27;</span>
<span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Home.vue&#x27;</span>


Vue.use(VueRouter)

<span class="hljs-keyword">const</span> routes = [
    &#123;
      path: <span class="hljs-string">&#x27;/&#x27;</span>,
      name: <span class="hljs-string">&#x27;Login&#x27;</span>,
      component: Login
    &#125;,
    &#123;
      path: <span class="hljs-string">&#x27;/home&#x27;</span>,
      name: <span class="hljs-string">&#x27;Home&#x27;</span>,
      component: Home

    &#125;
]

<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> VueRouter(&#123;
  routes
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router</code></pre></div>

<h3 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h3><p><strong>Login.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
&lt;div&gt;
&lt;!--  v-model:rules&#x3D;:rules--&gt;
  &lt;el-form :rules&#x3D;&quot;rules&quot; ref&#x3D;&quot;loginForm&quot; :model&#x3D;&quot;loginForm&quot; class&#x3D;&quot;loginContainer&quot;&gt;
    &lt;h3 class&#x3D;&quot;login-title&quot;&gt;系统登录&lt;&#x2F;h3&gt;

    &lt;el-form-item prop&#x3D;&quot;username&quot;&gt;
      &lt;el-input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;loginForm.username&quot; auto-complete&#x3D;&quot;off&quot; placeholder&#x3D;&quot;请输入你的用户名&quot;&gt;&lt;&#x2F;el-input&gt;
    &lt;&#x2F;el-form-item&gt;

    &lt;el-form-item prop&#x3D;&quot;password&quot;&gt;
      &lt;el-input type&#x3D;&quot;password&quot; v-model&#x3D;&quot;loginForm.password&quot; auto-complete&#x3D;&quot;off&quot; placeholder&#x3D;&quot;请输入密码&quot;&gt;&lt;&#x2F;el-input&gt;
    &lt;&#x2F;el-form-item&gt;

    &lt;el-checkbox class&#x3D;&quot;loginRemember&quot; v-model&#x3D;&quot;checked&quot;&gt;&lt;&#x2F;el-checkbox&gt;

    &lt;el-button type&#x3D;&quot;primary&quot; style&#x3D;&quot;width:100%;&quot; @click&#x3D;&quot;submitLogin&quot;&gt;登录&lt;&#x2F;el-button&gt;
  &lt;&#x2F;el-form&gt;
&lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;

export default &#123;
  name: &quot;Login&quot;,
  data()&#123;
    return &#123;
      loginForm:&#123;
        username:&#39;admin&#39;,
        password:&#39;123&#39;
      &#125;,
      checked: true,
      rules:&#123;
        username:[&#123;required: true, message:&quot;请输入你的用户名&quot;,trigger:&quot;blur&quot;&#125;],
        password:[&#123;required: true, message:&quot;请输入密码&quot;,trigger:&quot;blur&quot;&#125;]
      &#125;
    &#125;
  &#125;,
  methods:&#123;
    submitLogin()&#123;
      this.$refs.loginForm.validate((valid) &#x3D;&gt; &#123;
        if (valid) &#123;
          this.postKeyValueRequest(&#39;&#x2F;doLogin&#39;,this.loginForm).then(resp &#x3D;&gt; &#123;
            if (resp)&#123;
              window.sessionStorage.setItem(&quot;user&quot;, JSON.stringify(resp.obj));
              this.$router.replace(&#39;&#x2F;home&#39;)
            &#125;
          &#125;)
          &#x2F;&#x2F; alert(&#39;提交成功!&#39;);
        &#125; else &#123;
          this.$message.error(&#39;请输入所有字段&#39;);
          return false;
        &#125;
      &#125;);
    &#125;
  &#125;
&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;
.loginContainer&#123;
  border-radius: 15px;
  background-clip: padding-box;
  margin: 180px auto;
  width:350px;
  padding:35px 35px 15px 35px;
  background: #fff;
  border: 1px solid #eaeaea;
  box-shadow: 0 0 25px #cac6c6;
&#125;
.login-title&#123;
  margin:10px auto 20px auto;
  text-align:center;
  color: #000000;
&#125;
.loginRemember&#123;
  text-align:left;
  margin:0 0 15px 0;
&#125;

&lt;&#x2F;style&gt;</code></pre></div>

<h3 id="制作基本页面"><a href="#制作基本页面" class="headerlink" title="制作基本页面"></a>制作基本页面</h3><p><strong>Home.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
    &lt;div&gt;
        &lt;el-container&gt;
            &lt;el-header class&#x3D;&quot;homeHeader&quot;&gt;
                &lt;div class&#x3D;&quot;title&quot;&gt;微人事&lt;&#x2F;div&gt;
                &lt;div&gt;
                    &lt;el-button icon&#x3D;&quot;el-icon-bell&quot; type&#x3D;&quot;text&quot; style&#x3D;&quot;margin-right: 8px;color: #000000;&quot; size&#x3D;&quot;normal&quot; @click&#x3D;&quot;goChat&quot;&gt;&lt;&#x2F;el-button&gt;
                    &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;
  &lt;span class&#x3D;&quot;el-dropdown-link&quot;&gt;
    &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;
  &lt;&#x2F;span&gt;
                        &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;
                            &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;个人中心&lt;&#x2F;el-dropdown-item&gt;
                            &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;设置&lt;&#x2F;el-dropdown-item&gt;
                            &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;注销登录&lt;&#x2F;el-dropdown-item&gt;
                        &lt;&#x2F;el-dropdown-menu&gt;
                    &lt;&#x2F;el-dropdown&gt;
                &lt;&#x2F;div&gt;
            &lt;&#x2F;el-header&gt;
            &lt;el-container&gt;
                &lt;el-aside width&#x3D;&quot;200px&quot;&gt;
                    &lt;el-menu router unique-opened&gt;
                        &lt;el-submenu :index&#x3D;&quot;index+&#39;&#39;&quot; v-for&#x3D;&quot;(item,index) in routes&quot; v-if&#x3D;&quot;!item.hidden&quot; :key&#x3D;&quot;index&quot;&gt;
                            &lt;template slot&#x3D;&quot;title&quot;&gt;
                                &lt;i style&#x3D;&quot;color: #409eff;margin-right: 5px&quot; :class&#x3D;&quot;item.iconCls&quot;&gt;&lt;&#x2F;i&gt;
                                &lt;span&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;span&gt;
                            &lt;&#x2F;template&gt;
                            &lt;el-menu-item :index&#x3D;&quot;child.path&quot; v-for&#x3D;&quot;(child,indexj) in item.children&quot; :key&#x3D;&quot;indexj&quot;&gt;
                                &#123;&#123;child.name&#125;&#125;
                            &lt;&#x2F;el-menu-item&gt;
                        &lt;&#x2F;el-submenu&gt;
                    &lt;&#x2F;el-menu&gt;
                &lt;&#x2F;el-aside&gt;
                &lt;el-main&gt;
                    &lt;el-breadcrumb separator-class&#x3D;&quot;el-icon-arrow-right&quot; v-if&#x3D;&quot;this.$router.currentRoute.path!&#x3D;&#39;&#x2F;home&#39;&quot;&gt;
                        &lt;el-breadcrumb-item :to&#x3D;&quot;&#123; path: &#39;&#x2F;home&#39; &#125;&quot;&gt;首页&lt;&#x2F;el-breadcrumb-item&gt;
                        &lt;el-breadcrumb-item&gt;&#123;&#123;this.$router.currentRoute.name&#125;&#125;&lt;&#x2F;el-breadcrumb-item&gt;
                    &lt;&#x2F;el-breadcrumb&gt;
                    &lt;div class&#x3D;&quot;homeWelcome&quot; v-if&#x3D;&quot;this.$router.currentRoute.path&#x3D;&#x3D;&#39;&#x2F;home&#39;&quot;&gt;
                        欢迎来到微人事！
                    &lt;&#x2F;div&gt;
                    &lt;router-view class&#x3D;&quot;homeRouterView&quot;&#x2F;&gt;
                &lt;&#x2F;el-main&gt;
            &lt;&#x2F;el-container&gt;
        &lt;&#x2F;el-container&gt;
    &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
    export default &#123;
        name: &quot;Home&quot;,
        data() &#123;
            return &#123;
                &#x2F;&#x2F; user: JSON.parse(window.sessionStorage.getItem(&quot;user&quot;))
            &#125;
        &#125;,
        computed: &#123;
            routes() &#123;
                return this.$store.state.routes;
            &#125;,
            user() &#123;
                return this.$store.state.currentHr;
            &#125;
        &#125;,
        methods: &#123;
            goChat() &#123;
                this.$router.push(&quot;&#x2F;chat&quot;);
            &#125;,
            commandHandler(cmd) &#123;
                if (cmd &#x3D;&#x3D; &#39;logout&#39;) &#123;
                    this.$confirm(&#39;此操作将注销登录, 是否继续?&#39;, &#39;提示&#39;, &#123;
                        confirmButtonText: &#39;确定&#39;,
                        cancelButtonText: &#39;取消&#39;,
                        type: &#39;warning&#39;
                    &#125;).then(() &#x3D;&gt; &#123;
                        this.getRequest(&quot;&#x2F;logout&quot;);
                        window.sessionStorage.removeItem(&quot;user&quot;)
                        this.$store.commit(&#39;initRoutes&#39;, []);
                        this.$router.replace(&quot;&#x2F;&quot;);
                    &#125;).catch(() &#x3D;&gt; &#123;
                        this.$message(&#123;
                            type: &#39;info&#39;,
                            message: &#39;已取消操作&#39;
                        &#125;);
                    &#125;);
                &#125;else if (cmd &#x3D;&#x3D; &#39;userinfo&#39;) &#123;
                    this.$router.push(&#39;&#x2F;hrinfo&#39;);
                &#125;
            &#125;
        &#125;
    &#125;
&lt;&#x2F;script&gt;

&lt;style&gt;
    .homeRouterView &#123;
        margin-top: 10px;
    &#125;

    .homeWelcome &#123;
        text-align: center;
        font-size: 30px;
        font-family: 华文行楷;
        color: #409eff;
        padding-top: 50px;
    &#125;

    .homeHeader &#123;
        background-color: #409eff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0px 15px;
        box-sizing: border-box;
    &#125;

    .homeHeader .title &#123;
        font-size: 30px;
        font-family: 华文行楷;
        color: #ffffff
    &#125;

    .homeHeader .userInfo &#123;
        cursor: pointer;
    &#125;

    .el-dropdown-link img &#123;
        width: 48px;
        height: 48px;
        border-radius: 24px;
        margin-left: 8px;
    &#125;

    .el-dropdown-link &#123;
        display: flex;
        align-items: center;
    &#125;
&lt;&#x2F;style&gt;</code></pre></div>

<h3 id="制作Menu菜单"><a href="#制作Menu菜单" class="headerlink" title="制作Menu菜单"></a>制作Menu菜单</h3><p><strong>Home.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;div&gt;

  &lt;el-container&gt;
    &lt;el-header class&#x3D;&quot;homeHeader&quot;&gt;
      &lt;div class&#x3D;&quot;title&quot;&gt;后台管理系统&lt;&#x2F;div&gt;

            &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;
      &lt;span class&#x3D;&quot;el-dropdown-link&quot;&gt;
        &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;
      &lt;&#x2F;span&gt;
              &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;
                &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;个人中心&lt;&#x2F;el-dropdown-item&gt;
                &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;设置&lt;&#x2F;el-dropdown-item&gt;
                &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;注销登录&lt;&#x2F;el-dropdown-item&gt;
              &lt;&#x2F;el-dropdown-menu&gt;
            &lt;&#x2F;el-dropdown&gt;

    &lt;&#x2F;el-header&gt;
    &lt;el-container&gt;
      &lt;el-aside width&#x3D;&quot;200px&quot;&gt;
        &lt;el-menu router&gt;
          &lt;el-submenu index&#x3D;&quot;1&quot; v-for&#x3D;&quot;(item,index) in this.$router.options.routes&quot; v-if&#x3D;&quot;!item.hidden&quot; :key&#x3D;&quot;index&quot;&gt;
            &lt;template slot&#x3D;&quot;title&quot;&gt;
              &lt;i class&#x3D;&quot;el-icon-location&quot;&gt;&lt;&#x2F;i&gt;
              &lt;span&gt;导航一&lt;&#x2F;span&gt;
            &lt;&#x2F;template&gt;
              &lt;el-menu-item :index&#x3D;&quot;child.path&quot; v-for&#x3D;&quot;(child,indexj) in item.children&quot; :key&#x3D;&quot;indexj&quot;&gt;
                &#123;&#123;child.name&#125;&#125;
              &lt;&#x2F;el-menu-item&gt;
          &lt;&#x2F;el-submenu&gt;
        &lt;&#x2F;el-menu&gt;
      &lt;&#x2F;el-aside&gt;
      &lt;el-main&gt;
        &lt;router-view&#x2F;&gt;
      &lt;&#x2F;el-main&gt;
    &lt;&#x2F;el-container&gt;
  &lt;&#x2F;el-container&gt;

&lt;&#x2F;div&gt;</code></pre></div>

<p>新增router中的跳转<strong>index.js</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> VueRouter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>
<span class="hljs-keyword">import</span> Login <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Login.vue&#x27;</span>
<span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Home.vue&#x27;</span>
<span class="hljs-keyword">import</span> Test1 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Test1.vue&#x27;</span>
<span class="hljs-keyword">import</span> Test2 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/Test2.vue&#x27;</span>


Vue.use(VueRouter)

<span class="hljs-keyword">const</span> routes = [
    &#123;
      path: <span class="hljs-string">&#x27;/&#x27;</span>,
      name: <span class="hljs-string">&#x27;Login&#x27;</span>,
      component: Login,
      hidden:<span class="hljs-literal">true</span>
    &#125;,
    &#123;
      path: <span class="hljs-string">&#x27;/home&#x27;</span>,
      name: <span class="hljs-string">&#x27;Home&#x27;</span>,
      component: Home,
      hidden:<span class="hljs-literal">true</span>
    &#125;,
    &#123;
        path: <span class="hljs-string">&#x27;/home&#x27;</span>,
        name: <span class="hljs-string">&#x27;导航一&#x27;</span>,
        component: Home,
        children: [
            &#123;
                path: <span class="hljs-string">&#x27;/test1&#x27;</span>,
                name: <span class="hljs-string">&#x27;选项1&#x27;</span>,
                component: Test1
            &#125;,
            &#123;
                path: <span class="hljs-string">&#x27;/test2&#x27;</span>,
                name: <span class="hljs-string">&#x27;选项2&#x27;</span>,
                component: Test2
            &#125;
        ]
    &#125;

]

<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> VueRouter(&#123;
  routes
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router</code></pre></div>

<p>根据数据库中存储的menu表</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602172047103.png" srcset="/img/loading.gif" lazyload alt="image-20210602172047103"></p>
<p>可以给每个角色分配不同的menu访问权限</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210602172709842.png" srcset="/img/loading.gif" lazyload alt="image-20210602172709842"></p>
<p>这样就不用去router中自己定义每个menu的名字和显示的类别，通过读取数据库，当前用户根据不同的权限去访问不同的menu，[此部分在后端搭建部分补充](# 数据库驱动Menu菜单)</p>
<h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><p>下一步引入<code>Vuex</code>来做状态管理，是所有状态都放在一个公共的位置，实现状态实时转换，首先安装</p>
<div class="hljs code-wrapper"><pre><code class="hljs shell">npm install vuex</code></pre></div>

<p>建立组件store下的<strong>index.js</strong>实现vuex</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>

Vue.use(Vuex)


<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Vuex.Store(&#123;

    state:&#123;
        routes:[]
    &#125;,
    mutations:&#123;
        <span class="hljs-function"><span class="hljs-title">initRoutes</span>(<span class="hljs-params">state, data</span>)</span>&#123;
            state.routes = data;
        &#125;
    &#125;,
    actions:&#123;

    &#125;

&#125;)</code></pre></div>

<p>配置工具类<strong>menus.js</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;getRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/api&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> initMenu=<span class="hljs-function">(<span class="hljs-params">router,store</span>)=&gt;</span>&#123;
    <span class="hljs-comment">//正常的跳转</span>
    <span class="hljs-keyword">if</span> (store.state.routes.length &gt; <span class="hljs-number">0</span>)&#123;
        <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-comment">//F5刷新</span>
    getRequest(<span class="hljs-string">&quot;/system/config/menu&quot;</span>).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (data)&#123;
            <span class="hljs-keyword">let</span> fmtRoutes = formatRoutes(data);
            router.addRoutes(fmtRoutes);
            store.commit(<span class="hljs-string">&#x27;initRoutes&#x27;</span>, fmtRoutes)
        &#125;
    &#125;)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> formatRoutes = <span class="hljs-function">(<span class="hljs-params">routes</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">let</span> fmRoutes = [];
    routes.forEach(<span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> &#123;
        <span class="hljs-keyword">let</span>  &#123;
            path,
            component,
            name,
            meta,
            iconCls,
            children
        &#125; = router;
        <span class="hljs-keyword">if</span> (children &amp;&amp; children <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)&#123;
            children = formatRoutes(children);
        &#125;
        <span class="hljs-keyword">let</span> fmRouter = &#123;
            path:path,
            name:name,
            iconCls:iconCls,
            meta:meta,
            children: children,
            <span class="hljs-function"><span class="hljs-title">component</span>(<span class="hljs-params">resolve</span>)</span> &#123;
                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Emp&quot;</span>))&#123;
                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/emp/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)
                &#125;
                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Per&quot;</span>))&#123;
                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/per/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)
                &#125;
                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sal&quot;</span>))&#123;
                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sal/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)
                &#125;
                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sta&quot;</span>))&#123;
                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sta/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)
                &#125;
                <span class="hljs-keyword">if</span> (component.startsWith(<span class="hljs-string">&quot;Sys&quot;</span>))&#123;
                    <span class="hljs-built_in">require</span> ([<span class="hljs-string">&#x27;../views/sys/&#x27;</span> + component + <span class="hljs-string">&#x27;.vue&#x27;</span>], resolve)
                &#125;
            &#125;
        &#125;
        fmRoutes.push(fmRouter)

    &#125;)
    <span class="hljs-keyword">return</span> fmRoutes;
&#125;</code></pre></div>

<p>最后在<strong>main.js</strong>中配置跳转</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;initMenu&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/menus&quot;</span>;

router.beforeEach(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">if</span> (to.path == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;
    next();
  &#125; <span class="hljs-keyword">else</span> &#123;
    initMenu(router, store);
    next();
  &#125;
&#125;)</code></pre></div>

<p>在<strong>Home.vue</strong>中加载</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;
export default &#123;
computed : &#123;
  routes() &#123;
    return this.$store.state.routes
  &#125;
&#125;
&lt;&#x2F;script&gt;</code></pre></div>

<p><strong>安装图表库</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs shell">npm install font-awesome</code></pre></div>

<p>在<strong>main.js</strong>中引入</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;font-awesome/css/font-awesome.min.css&#x27;</span></code></pre></div>

<p><strong>Home.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;i style&#x3D;&quot;color: #409eff; margin-right: 8px&quot; :class&#x3D;&quot;item.iconCls&quot;&gt;&lt;&#x2F;i&gt;</code></pre></div>

<h3 id="配置权限的跳转"><a href="#配置权限的跳转" class="headerlink" title="配置权限的跳转"></a>配置权限的跳转</h3><p><strong>main.js</strong>中</p>
<div class="hljs code-wrapper"><pre><code class="hljs js">router.beforeEach(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>) =&gt;</span> &#123;
  <span class="hljs-keyword">if</span> (to.path == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;
    next();
  &#125; <span class="hljs-keyword">else</span> &#123;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">&quot;user&quot;</span>))&#123;
        initMenu(router, store);
        next();
      &#125; <span class="hljs-keyword">else</span> &#123;

        next(<span class="hljs-string">&#x27;/?redirect=&#x27;</span> + to.path);

      &#125;

  &#125;
&#125;)</code></pre></div>

<p>为了让登录时的url在登录后同样适用，配置<strong>Login.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">let path &#x3D; this.$route.query.redirect;

this.$router.replace((path &#x3D;&#x3D; &#39;&#x2F;home&#39; || path &#x3D;&#x3D; undefined)? &#39;&#x2F;home&#39; : path)</code></pre></div>

<h1 id="五、前后端对接"><a href="#五、前后端对接" class="headerlink" title="五、前后端对接"></a>五、前后端对接</h1><h3 id="基础连接"><a href="#基础连接" class="headerlink" title="基础连接"></a>基础连接</h3><p><strong>安装axios</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs bash">npm install axios</code></pre></div>

<p>封装工具类<code>api.js</code>，处理登录请求的状态码信息</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>
<span class="hljs-keyword">import</span> &#123; Message &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../router&#x27;</span>

axios.interceptors.response.use(<span class="hljs-function"><span class="hljs-params">success</span>=&gt;</span>&#123;

    <span class="hljs-keyword">if</span> (success.status &amp;&amp; success.status ==<span class="hljs-number">200</span> &amp;&amp; success.data.status ==<span class="hljs-number">500</span>)&#123;
        Message.error(&#123;<span class="hljs-attr">message</span>:success.data.msg&#125;)
        <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-keyword">if</span> (success.data.msg)&#123;
        Message.success(&#123;<span class="hljs-attr">message</span>:success.data.msg&#125;)
    &#125;

    <span class="hljs-keyword">return</span> success.data;

&#125;,<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">504</span> || error.response.status == <span class="hljs-number">404</span>)&#123;
        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;服务器GG了哦　╮(￣▽￣&quot;&quot;)╭&#x27;</span>&#125;)
    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">403</span>) &#123;
        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;您的权限不够哦　╮(￣▽￣&quot;&quot;)╭&#x27;</span>&#125;)
    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.response.status == <span class="hljs-number">401</span>)&#123;
        Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;尚未登录，请登录&#x27;</span>&#125;)
        router.replace(<span class="hljs-string">&#x27;/&#x27;</span>)
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">if</span> (error.response.data.msg)&#123;
            Message.error(&#123;<span class="hljs-attr">message</span>:error.response.data.msg&#125;)
        &#125; <span class="hljs-keyword">else</span> &#123;
            Message.error(&#123;<span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;未知错误（；゜０゜）&#x27;</span>&#125;)
        &#125;
    &#125;
    <span class="hljs-keyword">return</span>;
&#125;)

<span class="hljs-keyword">let</span> base = <span class="hljs-string">&#x27;&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> postKeyValueRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span>&#123;
    <span class="hljs-keyword">return</span> axios(&#123;
        method:<span class="hljs-string">&#x27;POST&#x27;</span>,
        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,
        data:params,
        transformRequest:[<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>)</span>&#123;
            <span class="hljs-keyword">let</span> ret = <span class="hljs-string">&#x27;&#x27;</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> data)&#123;
                ret+=<span class="hljs-built_in">encodeURIComponent</span>(i) + <span class="hljs-string">&#x27;=&#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(data[i]) + <span class="hljs-string">&#x27;&amp;&#x27;</span>
            &#125;
            <span class="hljs-built_in">console</span>.log(ret);
            <span class="hljs-keyword">return</span> ret;
        &#125;],
        headers:&#123;
            <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>
        &#125;
    &#125;);
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> postRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">return</span> axios (&#123;
        method : <span class="hljs-string">&#x27;post&#x27;</span>,
        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,
        data:params
    &#125;)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> putRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">return</span> axios (&#123;
        method : <span class="hljs-string">&#x27;put&#x27;</span>,
        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,
        data:params
    &#125;)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">return</span> axios (&#123;
        method : <span class="hljs-string">&#x27;get&#x27;</span>,
        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,
        data:params
    &#125;)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteRequest = <span class="hljs-function">(<span class="hljs-params">url, params</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">return</span> axios (&#123;
        method : <span class="hljs-string">&#x27;delete&#x27;</span>,
        url:<span class="hljs-string">`<span class="hljs-subst">$&#123;base&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,
        data:params
    &#125;)
&#125;</code></pre></div>

<p>在<code>Login.vue</code>下引入</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;
import &#123;postKeyValueRequest&#125; from &quot;@&#x2F;utils&#x2F;api&quot;;

  export default &#123;
  name: &quot;Login&quot;,
  data()&#123;
    return &#123;
      loginForm:&#123;
        username:&#39;admin&#39;,
        password:&#39;123&#39;
      &#125;,
      checked: true,
      rules:&#123;
        username:[&#123;required: true, message:&quot;请输入你的用户名&quot;,trigger:&quot;blur&quot;&#125;],
        password:[&#123;required: true, message:&quot;请输入密码&quot;,trigger:&quot;blur&quot;&#125;]
      &#125;
    &#125;
  &#125;,
  methods:&#123;
    submitLogin()&#123;
      this.$refs.loginForm.validate((valid) &#x3D;&gt; &#123;
        if (valid) &#123;
          postKeyValueRequest(&#39;&#x2F;doLogin&#39;,this.loginForm).then(resp &#x3D;&gt; &#123;
            if (resp)&#123;
              alert(JSON.stringify(resp))
            &#125;
          &#125;)
          &#x2F;&#x2F; alert(&#39;提交成功!&#39;);
        &#125; else &#123;
          this.$message.error(&#39;请输入所有字段&#39;);
          return false;
        &#125;
      &#125;);
    &#125;
  &#125;
&#125;
&lt;&#x2F;script&gt;</code></pre></div>

<p><strong>前后端连接配置vue.config.js</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> proxyObj = &#123;&#125;;
proxyObj [<span class="hljs-string">&#x27;/&#x27;</span>] = &#123;
    ws:<span class="hljs-literal">false</span>,
    target:<span class="hljs-string">&#x27;http://localhost:8081&#x27;</span>,
    changeOrigin:<span class="hljs-literal">true</span>,
    pathRewrite:&#123;
        <span class="hljs-string">&#x27;^/&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>
    &#125;
&#125;

<span class="hljs-built_in">module</span>.exports=&#123;
    devServer:&#123;
        host:<span class="hljs-string">&#x27;localhost&#x27;</span>,
        port:<span class="hljs-number">8080</span>,
        proxy:proxyObj
    &#125;
&#125;</code></pre></div>

<p><strong>登录成功</strong></p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210531134218777.png" srcset="/img/loading.gif" lazyload alt="image-20210531134218777"></p>
<p>返回的是从数据库中读取到的JSON信息</p>
<p><strong>登录失败</strong></p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210531134244306.png" srcset="/img/loading.gif" lazyload alt="image-20210531134244306"></p>
<p>对应着后端配置类中的failureHandle中的处理字段，到目前为止，前后端已经对接成功</p>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>在传统的前后端不分的开发中，权限管理主要通过过滤器或者拦截器来进行（权限管理框架本身也是通过过滤器来实现功能），如果用户不具备某一个角色或者某一个权限，则无法访问某一个页面。</p>
<p>但是在前后端分离中，页面的跳转统统交给前端去做，后端只提供数据，这种时候，权限管理不能再按照之前的思路来。</p>
<p>首先要明确一点，<code>前端是展示给用户看的，所有的菜单显示或者隐藏目的不是为了实现权限管理，而是为了给用户一个良好的体验，不能依靠前端隐藏控件来实现权限管理，即数据安全不能依靠前端</code>。</p>
<p>这点就像普通的表单提交一样，前端做数据校验是为了提高效率，提高用户体验，后端才是真正的确保数据完整性。</p>
<p>所以，<code>真正的数据安全管理是在后端实现的，后端在接口设计的过程中，就要确保每一个接口都是在满足某种权限的基础上才能访问，也就是说，不怕将后端数据接口地址暴露出来，即使暴露出来，只要你没有相应的角色，也是访问不了的</code>。</p>
<p>前端为了良好的用户体验，需要将用户不能访问的接口或者菜单隐藏起来。</p>
<p>有人说，如果用户直接在地址拦输入某一个页面的路径，怎么办？此时，如果没有做任何额外的处理的话，用户确实可以通过直接输入某一个路径进入到系统中的某一个页面中，但是，不用担心数据泄露问题，因为没有相关的角色，就无法访问相关的接口。</p>
<p>但是，如果用户非这样操作，进入到一个空白的页面，用户体验不好，此时，我们可以使用 Vue 中的前置路由导航守卫，来监听页面跳转，如果用户想要去一个未获授权的页面，则直接在前置路由导航守卫中将之拦截下来，重定向到登录页，或者直接就停留在当前页，不让用户跳转，也可以顺手再给用户一点点未获授权的提示信息。</p>
<p>总而言之一句话，前端的所有操作，都是为了提高用户体验，不是为了数据安全，真正的权限校验要在后端来做，后端如果是 SSM 架构，建议使用 Shiro ，如果是 <code>Spring Boot + 微服务</code>，建议使用 <code>Spring Security</code>，本系统就是利用 Spring Security 来实现的</p>
<h1 id="六、后端的搭建"><a href="#六、后端的搭建" class="headerlink" title="六、后端的搭建"></a>六、后端的搭建</h1><h3 id="服务器环境的搭建"><a href="#服务器环境的搭建" class="headerlink" title="服务器环境的搭建"></a>服务器环境的搭建</h3><p>创建项目，添加依赖</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210529222859839.png" srcset="/img/loading.gif" lazyload alt="image-20210529222859839"></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>权限数据库主要包含了五张表，分别是资源表、角色表、用户表、资源角色表、用户角色表，数据库关系模型如下：</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/p274.png" srcset="/img/loading.gif" lazyload alt="p274"></p>
<ul>
<li>hr表是用户表，存放了用户的基本信息。</li>
<li>role是角色表，name字段表示角色的英文名称，按照SpringSecurity的规范，将以<code>ROLE_</code>开始，nameZh字段表示角色的中文名称。</li>
<li>menu表是一个资源表，该表涉及到的字段有点多，由于我的前端采用了Vue来做，因此当用户登录成功之后，系统将根据用户的角色动态加载需要的模块，所有模块的信息将保存在menu表中，menu表中的path、component、iconCls、keepAlive、requireAuth等字段都是Vue-Router中需要的字段，也就是说menu中的数据到时候会以json的形式返回给前端，再由vue动态更新router，menu中还有一个字段url，表示一个url pattern，即路径匹配规则，假设有一个路径匹配规则为<code>/admin/**</code>,那么当用户在客户端发起一个<code>/admin/user</code>的请求，将被<code>/admin/**</code>拦截到，系统再去查看这个规则对应的角色是哪些，然后再去查看该用户是否具备相应的角色，进而判断该请求是否合法</li>
</ul>
<p><code>共有22个表</code></p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210529225927805.png" srcset="/img/loading.gif" lazyload alt="image-20210529225927805"></p>
<p>同时导入mapper和model模板文件，见项目中代码<code>model</code>和<code>mapper</code></p>
<p>配置mapper扫描和pom文件</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan(basePackages=&quot;org.lucifer.vbluciferpro.mapper&quot;)</span></code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div>

<p>并完成JDBC的相关配置</p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
<span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span>
<span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">Root!123</span>
<span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/vhr?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
<span class="hljs-comment"># 前端Vue的接口为8080</span>
<span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span></code></pre></div>

<h3 id="简单的测试"><a href="#简单的测试" class="headerlink" title="简单的测试"></a>简单的测试</h3><p>这里先简单的测试一个接口的效果</p>
<p><strong>用户类配置</strong></p>
<p>为了使用<code>SpringSecurity</code>，需要实现<code>UserDetails</code>接口并重写方法，因为重写了<code>isEnabled</code>方法，需要删除生成的<code>getEnabled</code>方法</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer id;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> String phone;

    <span class="hljs-keyword">private</span> String telephone;

    <span class="hljs-keyword">private</span> String address;

    <span class="hljs-keyword">private</span> Boolean enabled;

    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-keyword">private</span> String userface;

    <span class="hljs-keyword">private</span> String remark;
  
   <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> enabled;
    &#125;
  
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    HrMapper hrMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;

        Hr hr = hrMapper.loadUserByUsername(username);
        <span class="hljs-keyword">if</span> (hr == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;用户名不存在！&quot;</span>);
        &#125;

        <span class="hljs-keyword">return</span> hr;
    &#125;
&#125;</code></pre></div>

<p><strong>Mapper接口</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HrMapper</span> </span>&#123;
    <span class="hljs-function">Hr <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span></span>;
&#125;</code></pre></div>

<p><strong>Mapper.xml</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.mapper.HrMapper&quot;</span> &gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Hr&quot;</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;phone&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;phone&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;CHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;telephone&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;telephone&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;userface&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userface&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
  
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loadUserByUsername&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  select * from hr where username=#&#123;username&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div>

<p><strong>Security配置类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    HrService hrService;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        auth.userDetailsService(hrService);
    &#125;

&#125;</code></pre></div>

<p><strong>Controller</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;

    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;
    &#125;
&#125;</code></pre></div>

<p>这样通过登录就能访问到hello了，接下来，我们开始对<code>Security</code>进行登录成功失败相关配置，首先创建响应实体类(实体类都有<code>setter/getter</code>方法，只不过为了优雅，在这里就不展示)</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RespBean</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> String msg;
    <span class="hljs-keyword">private</span> Object obj;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg)</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg,<span class="hljs-keyword">null</span>);
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg, Object obj)</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg, obj);
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg)</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>,msg,<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg, Object obj)</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>, msg, obj);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">(Integer status, String msg, Object obj)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.status = status;
        <span class="hljs-keyword">this</span>.msg = msg;
        <span class="hljs-keyword">this</span>.obj = obj;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">()</span> </span>&#123;
    &#125;
    
&#125;</code></pre></div>

<p>接着继续完善配置类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    HrService hrService;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        auth.userDetailsService(hrService);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        http.authorizeRequests()
                .anyRequest().authenticated()
                .and()
                .formLogin()
                .usernameParameter(<span class="hljs-string">&quot;username&quot;</span>)
                .passwordParameter(<span class="hljs-string">&quot;password&quot;</span>)
                .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)
                .loginPage(<span class="hljs-string">&quot;/login&quot;</span>)
                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() &#123;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                        PrintWriter out = resp.getWriter();
                        Hr hr = (Hr) authentication.getPrincipal();
                        hr.setPassword(<span class="hljs-keyword">null</span>);
                        RespBean ok = RespBean.ok(<span class="hljs-string">&quot;登录成功&quot;</span>, hr);
                        String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);
                        out.write(s);
                        out.flush();
                        out.close();
                    &#125;
                &#125;)

                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() &#123;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException exception)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                        PrintWriter out = resp.getWriter();
                        RespBean respBean = RespBean.error(<span class="hljs-string">&quot;登录失败&quot;</span>);
                        <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException)&#123;
                            respBean.setMsg(<span class="hljs-string">&quot;账户被锁定，请联系管理员&quot;</span>);
                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException)&#123;
                            respBean.setMsg(<span class="hljs-string">&quot;密码已过期，请联系管理员&quot;</span>);
                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException)&#123;
                            respBean.setMsg(<span class="hljs-string">&quot;账号已过期，请联系管理员&quot;</span>);
                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException)&#123;
                            respBean.setMsg(<span class="hljs-string">&quot;账户被禁用，请联系管理员&quot;</span>);
                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException)&#123;
                            respBean.setMsg(<span class="hljs-string">&quot;用户名或者密码输入错误&quot;</span>);
                        &#125;
                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));
                        out.flush();
                        out.close();
                    &#125;
                &#125;)
                .permitAll()
                .and()
                .logout()
                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() &#123;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                        PrintWriter out = resp.getWriter();
                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;注销成功&quot;</span>)));
                        out.flush();
                        out.close();
                    &#125;
                &#125;)
                .permitAll()
                .and()
                .csrf().disable();
    &#125;
&#125;</code></pre></div>

<p>设置登录的接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;

    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">login</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;尚未登录，请登录&quot;</span>);
    &#125;

&#125;</code></pre></div>

<h3 id="数据库驱动Menu菜单"><a href="#数据库驱动Menu菜单" class="headerlink" title="数据库驱动Menu菜单"></a>数据库驱动Menu菜单</h3><p>新建实体类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Menu</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer id;

    <span class="hljs-keyword">private</span> String url;

    <span class="hljs-keyword">private</span> String path;

    <span class="hljs-keyword">private</span> String component;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> String iconCls;

    <span class="hljs-keyword">private</span> Meta meta;

    <span class="hljs-comment">//对应router中的子级菜单</span>
    <span class="hljs-keyword">private</span> List&lt;Menu&gt; children;

    <span class="hljs-keyword">private</span> Integer parentId;

    <span class="hljs-keyword">private</span> Boolean enabled;
&#125;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span> </span>&#123;

    <span class="hljs-keyword">private</span> Boolean keepAlive;

    <span class="hljs-keyword">private</span> Boolean requireAuth;
&#125;</code></pre></div>

<p>创建Service</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    MenuMapper menuMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuMapper.getMenusByHrId(((Hr) SecurityContextHolder.getContext().getAuthentication().getPrincipal()).getId());
    &#125;
&#125;</code></pre></div>

<p>调用Mapper</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MenuMapper</span> </span>&#123;
	<span class="hljs-function">List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">(Integer hrid)</span></span>;
&#125;</code></pre></div>

<p>根据数据库的id，设计SQL</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> &gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;meta&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Meta&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span> &gt;</span>
  id, url, path, component, name, iconCls, keepAlive, requireAuth, parentId, enabled
<span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Menus2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;path2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;path&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;component2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;component&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;iconCls2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;iconCls&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;parentId2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;parentId&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;enabled2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;enabled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;meta&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Meta&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;keepAlive2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;keepAlive&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;requireAuth2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;requireAuth&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;BIT&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMenusByHrId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;Menus2&quot;</span>&gt;</span>
  SELECT DISTINCT  m1.*, m2.`id` as id2, m2.`component` as component2, m2.`enabled` as enabled2,
         m2.`iconCls` as iconCls2, m2.`keepAlive` as keepAlive2, m2.`name` as name2,
         m2.`parentId` as parentId2, m2.`requireAuth` as requireAuth2, m2.`path` as path2
  FROM menu m1,menu m2, hr_role hrr,menu_role mr
  where m1.`id`=m2.`parentId` and hrr.`hrid`=#&#123;hrid&#125; and hrr.`rid`=mr.`rid` and mr.`mid`=m2.`id` and m2.`enabled`=true
  ORDER BY m1.`id`,m2.`id`
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p>测试用Controller</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/config&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemConfigController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    MenuService menuService;

    <span class="hljs-meta">@GetMapping(&quot;/menu&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> menuService.getMenusByHrId();
    &#125;

&#125;</code></pre></div>

<h3 id="后端接口权限设计"><a href="#后端接口权限设计" class="headerlink" title="后端接口权限设计"></a>后端接口权限设计</h3><p>根据<code>Menu</code>表中的<code>path/id/name</code>可以确定前端发过来的请求的url访问的名字以及id</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210604171529329.png" srcset="/img/loading.gif" lazyload alt="image-20210604171529329"></p>
<p>然后在<code>Menu_role</code>表中可以发现那些role具有当前mid的权限rid，去检查rid是否为当前登录的角色</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210604171656534.png" srcset="/img/loading.gif" lazyload alt="image-20210604171656534"></p>
<p>新增配置类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> lucifer</span>
<span class="hljs-comment"> *</span>
<span class="hljs-comment"> * 根据用户传来的请求地址，分析出请求需要的角色</span>
<span class="hljs-comment"> */</span>

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFilterInvocationSecurityMetadataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FilterInvocationSecurityMetadataSource</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    MenuService menuService;

    AntPathMatcher antPathMatcher = <span class="hljs-keyword">new</span> AntPathMatcher();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(Object object)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException </span>&#123;
        String requestUrl = ((FilterInvocation) object).getRequestUrl();
        List&lt;Menu&gt; menus = menuService.getAllMenusWithRole();
        <span class="hljs-keyword">for</span> (Menu menu : menus) &#123;
            <span class="hljs-keyword">if</span> (antPathMatcher.match(menu.getUrl(), requestUrl)) &#123;
                List&lt;Role&gt; roles = menu.getRoles();

                String[] str = <span class="hljs-keyword">new</span> String[roles.size()];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; roles.size(); i++) &#123;
                    str[i] = roles.get(i).getName();
                &#125;

                <span class="hljs-keyword">return</span> SecurityConfig.createList(str);
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> SecurityConfig.createList(<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAllConfigAttributes</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;
&#125;



<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomUrlDecisionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccessDecisionManager</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decide</span><span class="hljs-params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="hljs-keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;
        <span class="hljs-keyword">for</span> (ConfigAttribute configAttribute : configAttributes) &#123;
            String needRole = configAttribute.getAttribute();
            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) &#123;
                <span class="hljs-keyword">if</span> (authentication <span class="hljs-keyword">instanceof</span> AnonymousAuthenticationToken)&#123;
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;尚未登录，请登录！&quot;</span>);
                &#125; <span class="hljs-keyword">else</span> &#123;
                    <span class="hljs-keyword">return</span>;
                &#125;
            &#125;
            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();
            <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;
                <span class="hljs-comment">//需要的角色能被检测到</span>
                <span class="hljs-keyword">if</span> (authority.getAuthority().equals(needRole))&#123;
                    <span class="hljs-keyword">return</span>;
                &#125;
            &#125;
        &#125;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;权限不足，请返回！&quot;</span>);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(ConfigAttribute attribute)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;
&#125;
</code></pre></div>

<p>在<strong>Security</strong>配置类中注入</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;

<span class="hljs-meta">@Autowired</span>
CustomUrlDecisionManager customUrlDecisionManager;

 <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-comment">//防止访问登录页面死循环，不用进入Security拦截</span>
        web.ignoring().antMatchers(<span class="hljs-string">&quot;/login&quot;</span>);
    &#125;


 <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        http.authorizeRequests()

                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;
                        object.setAccessDecisionManager(customUrlDecisionManager);
                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);
                        <span class="hljs-keyword">return</span> object;
                    &#125;
                &#125;)
                <span class="hljs-comment">//.anyRequest().authenticated()</span>
          
          
          
                  <span class="hljs-comment">//解决没登录时，重定向的跨域问题，这里直接处理，不重定向</span>
                .csrf().disable().exceptionHandling().authenticationEntryPoint(<span class="hljs-keyword">new</span> AuthenticationEntryPoint() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commence</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException authException)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;
                resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
              	<span class="hljs-comment">//重启服务器的时候，设置状态码，跳转登录页面</span>
              	resp.setStatus(<span class="hljs-number">401</span>);
                PrintWriter out = resp.getWriter();
                RespBean respBean = RespBean.error(<span class="hljs-string">&quot;访问失败&quot;</span>);
                <span class="hljs-comment">//session失效，跳转登录页面</span>
                <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException)&#123;
                    respBean.setMsg(<span class="hljs-string">&quot;请求失败，请联系管理员！&quot;</span>);
                &#125;
                out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));
                out.flush();
            &#125;</code></pre></div>

<p>实体类Hr新增Role属性</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</code></pre></div>

<p>实体类Menu同样新增Role属性</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</code></pre></div>

<p><strong>MenuService</strong>新增方法</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//@Cacheable</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();
&#125;</code></pre></div>

<p><strong>MenuMapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MenuWithRole&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roles&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rnameZh&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nameZh&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllMenusWithRole&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;MenuWithRole&quot;</span>&gt;</span>
  SELECT m.*, r.`id` as rid, r.`name` as rname, r.`nameZh` as rnameZh
  FROM menu m, menu_role mr, role r
  WHERE m.`id` = mr.`mid` AND mr.`rid` = r.`id`
  ORDER BY m.`id`;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p><strong>HrService</strong>中需要添加注入角色的字段，不然为null</p>
<div class="hljs code-wrapper"><pre><code class="hljs java">hr.setRoles(hrMapper.getHrRolesById(hr.getId()));</code></pre></div>

<p><strong>HrMapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getHrRolesById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>
  SELECT r.* FROM role r, hr_role hrr WHERE hrr.`rid` = r.`id` AND hrr.`hrid` = #&#123;id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p>测试类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/employee/basic/hello&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/employee/basic/hello&quot;</span>;
&#125;

<span class="hljs-meta">@GetMapping(&quot;/employee/advanced/hello&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/employee/advanced/hello&quot;</span>;
&#125;</code></pre></div>

<h1 id="七、业务模块"><a href="#七、业务模块" class="headerlink" title="七、业务模块"></a>七、业务模块</h1><h2 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h2><h3 id="基础信息设置"><a href="#基础信息设置" class="headerlink" title="基础信息设置"></a>基础信息设置</h3><p><code>views/sys/SysBasic.vue</code>下定义每个标签</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
    &lt;div&gt;
      &lt;el-tabs v-model&#x3D;&quot;activeName&quot; type&#x3D;&quot;card&quot;&gt;
        &lt;el-tab-pane label&#x3D;&quot;部门管理&quot; name&#x3D;&quot;first&quot;&gt;&lt;DepMana&gt;&lt;&#x2F;DepMana&gt;&lt;&#x2F;el-tab-pane&gt;
        &lt;el-tab-pane label&#x3D;&quot;职位管理&quot; name&#x3D;&quot;second&quot;&gt;&lt;PosMana&gt;&lt;&#x2F;PosMana&gt;&lt;&#x2F;el-tab-pane&gt;
        &lt;el-tab-pane label&#x3D;&quot;职称管理&quot; name&#x3D;&quot;third&quot;&gt;&lt;JobLevelMana&gt;&lt;&#x2F;JobLevelMana&gt;&lt;&#x2F;el-tab-pane&gt;
        &lt;el-tab-pane label&#x3D;&quot;奖惩规则&quot; name&#x3D;&quot;fourth&quot;&gt;&lt;EcMana&gt;&lt;&#x2F;EcMana&gt;&lt;&#x2F;el-tab-pane&gt;
        &lt;el-tab-pane label&#x3D;&quot;权限组&quot; name&#x3D;&quot;fifth&quot;&gt;&lt;PermissMana&gt;&lt;&#x2F;PermissMana&gt;&lt;&#x2F;el-tab-pane&gt;
      &lt;&#x2F;el-tabs&gt;
    &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
    import DepMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;DepMana&quot;;
    import EcMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;EcMana&quot;;
    import JobLevelMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;JobLevelMana&quot;;
    import PermissMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;PermissMana&quot;;
    import PosMana from &quot;@&#x2F;components&#x2F;sys&#x2F;basic&#x2F;PosMana&quot;;
    export default &#123;
        name: &quot;SysBasic&quot;,
        data()&#123;
            return &#123;
              activeName: &#39;&#39;
            &#125;
        &#125;,
        components:&#123;
          DepMana,
          EcMana,
          JobLevelMana,
          PermissMana,
          PosMana
        &#125;
    &#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<p>其中的<code>&lt;DepMana&gt;</code>等标签，对应<code>components/sys/basic/DepMana.vue</code>，这样就可以对不同的标签进行开发</p>
<h4 id="职位管理"><a href="#职位管理" class="headerlink" title="职位管理"></a>职位管理</h4><h5 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h5><p><strong>PosMana.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div&gt;
    &lt;div&gt;
      &lt;el-input
          size&#x3D;&quot;small&quot;
          class&#x3D;&quot;addPosInput&quot;
          placeholder&#x3D;&quot;添加职位&quot;
          prefix-icon&#x3D;&quot;el-icon-plus&quot;
          v-model&#x3D;&quot;pos.name&quot;&gt;
      &lt;&#x2F;el-input&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot;&gt;添加&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;
    &lt;div class&#x3D;&quot;posManaMain&quot;&gt;
    &lt;el-table
          :data&#x3D;&quot;positions&quot;
          border
          stripe
          style&#x3D;&quot;width: 70%&quot;&gt;
        &lt;el-table-column
            prop&#x3D;&quot;id&quot;
            label&#x3D;&quot;编号&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;name&quot;
            label&#x3D;&quot;职位名称&quot;
            width&#x3D;&quot;120&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;createDate&quot;
            label&#x3D;&quot;创建时间&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
      &lt;&#x2F;el-table&gt;

    &lt;&#x2F;div&gt;
  &lt;&#x2F;div&gt;


&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;PosMana&quot;,
  data()&#123;
    return &#123;
      pos: &#123;
        name: &#39;&#39;
      &#125;,
      positions: []
    &#125;
&#125;


&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;
.addPosInput &#123;
  width: 300px;
  margin-right: 8px
&#125;

.posManaMain &#123;
  margin-top: 10px;
&#125;

&lt;&#x2F;style&gt;</code></pre></div>

<h5 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h5><p>先写测试接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/basic/pos&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PositionController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    PositionService positionService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> positionService.getAllPositions();
    &#125;

    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addPosition</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Position position)</span></span>&#123;
        <span class="hljs-keyword">if</span> (positionService.addPosition(position) == <span class="hljs-number">1</span>)&#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;添加成功&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;添加失败&quot;</span>);
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updatePositions</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Position position)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (positionService.updatePositions(position) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deletePositionById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (positionService.deletePositionById(id) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
    &#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PositionService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    PositionMapper positionMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> positionMapper.getAllPositions();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addPosition</span><span class="hljs-params">(Position position)</span> </span>&#123;
        position.setEnabled(<span class="hljs-keyword">true</span>);
        position.setCreateDate(<span class="hljs-keyword">new</span> Date());
        <span class="hljs-keyword">return</span> positionMapper.insertSelective(position);

    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updatePositions</span><span class="hljs-params">(Position position)</span> </span>&#123;
        <span class="hljs-keyword">return</span> positionMapper.updateByPrimaryKeySelective(position);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deletePositionById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> positionMapper.deleteByPrimaryKey(id);
    &#125;

&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PositionMapper</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Position record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(Position record)</span></span>;

    <span class="hljs-function">Position <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(Position record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(Position record)</span></span>;

    <span class="hljs-function">List&lt;Position&gt; <span class="hljs-title">getAllPositions</span><span class="hljs-params">()</span></span>;

&#125;</code></pre></div>

<p>对应的xml文件</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllPositions&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  SELECT * FROM position;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p>这样就完成了对职位管理的添加，更新，删除操作</p>
<h5 id="前后端对接"><a href="#前后端对接" class="headerlink" title="前后端对接"></a>前后端对接</h5><p>先针对PosMana进行删除添加相关的补充</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div&gt;
    &lt;div&gt;
      &lt;el-input
          size&#x3D;&quot;small&quot;
          class&#x3D;&quot;addPosInput&quot;
          placeholder&#x3D;&quot;添加职位&quot;
          prefix-icon&#x3D;&quot;el-icon-plus&quot;
          @keydown.enter.native&#x3D;&quot;addPosition&quot;
          v-model&#x3D;&quot;pos.name&quot;&gt;
      &lt;&#x2F;el-input&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addPosition&quot;&gt;添加&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;
    &lt;div class&#x3D;&quot;posManaMain&quot;&gt;
    &lt;el-table
          :data&#x3D;&quot;positions&quot;
          @selection-change&#x3D;&quot;handleSelectionChange&quot;
          border
          stripe
          style&#x3D;&quot;width: 70%&quot;&gt;
      &lt;el-table-column
          type&#x3D;&quot;selection&quot;
          width&#x3D;&quot;55&quot;&gt;
      &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;id&quot;
            label&#x3D;&quot;编号&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;name&quot;
            label&#x3D;&quot;职位名称&quot;
            width&#x3D;&quot;150&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;createDate&quot;
            width&#x3D;&quot;150&quot;
            label&#x3D;&quot;创建时间&quot;&gt;
        &lt;&#x2F;el-table-column&gt;

      &lt;el-table-column label&#x3D;&quot;操作&quot;&gt;
        &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
          &lt;el-button
              size&#x3D;&quot;mini&quot;
              @click&#x3D;&quot;showEditView(scope.$index, scope.row)&quot;&gt;编辑
          &lt;&#x2F;el-button&gt;
          &lt;el-button
              size&#x3D;&quot;mini&quot;
              type&#x3D;&quot;danger&quot;
              @click&#x3D;&quot;handleDelete(scope.$index, scope.row)&quot;&gt;删除
          &lt;&#x2F;el-button&gt;
        &lt;&#x2F;template&gt;
      &lt;&#x2F;el-table-column&gt;
      &lt;&#x2F;el-table&gt;
      &lt;el-button @click&#x3D;&quot;deleteMany&quot; type&#x3D;&quot;danger&quot; size&#x3D;&quot;small&quot; style&#x3D;&quot;margin-top: 8px&quot;
                 :disabled&#x3D;&quot;multipleSelection.length&#x3D;&#x3D;0&quot;&gt;批量删除
      &lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;
    &lt;el-dialog
        title&#x3D;&quot;修改职位&quot;
        :visible.sync&#x3D;&quot;dialogVisible&quot;
        width&#x3D;&quot;30%&quot;&gt;
      &lt;div&gt;
        &lt;el-tag&gt;职位名称&lt;&#x2F;el-tag&gt;
        &lt;el-input class&#x3D;&quot;updatePosInput&quot; size&#x3D;&quot;small&quot; v-model&#x3D;&quot;updatePos.name&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;div&gt;
      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
 &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;取 消&lt;&#x2F;el-button&gt;
    &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate&quot;&gt;确 定&lt;&#x2F;el-button&gt;
  &lt;&#x2F;span&gt;
    &lt;&#x2F;el-dialog&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;PosMana&quot;,
  data() &#123;
    return &#123;
      pos: &#123;
        name: &#39;&#39;
      &#125;,
      dialogVisible: false,
      updatePos: &#123;
        name: &#39;&#39;,
        enabled: false
      &#125;,
      positions: [],
      multipleSelection: [],
    &#125;
  &#125;,

  &#x2F;&#x2F; 钩子函数
  mounted() &#123;
    this.initPositions();
  &#125;,
  methods:&#123;
    initPositions() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.positions &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    handleSelectionChange(val) &#123;
      this.multipleSelection &#x3D; val;
    &#125;,
    showEditView(index, data) &#123;
      Object.assign(this.updatePos, data);
      this.dialogVisible &#x3D; true;
    &#125;,
    handleDelete(index, data) &#123;
      this.$confirm(&#39;此操作将永久删除【&#39; + data.name + &#39;】职位, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initPositions();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,
    addPosition() &#123;
      if (this.pos.name) &#123;
        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;, this.pos).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initPositions();
            this.pos.name &#x3D; &#39;&#39;;
          &#125;
        &#125;)
      &#125; else &#123;
        this.$message.error(&#39;职位名称不可以为空&#39;);
      &#125;
    &#125;,
    doUpdate() &#123;
      this.putRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot;, this.updatePos).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.initPositions();
          this.updatePos.name &#x3D; &#39;&#39;;
          this.dialogVisible &#x3D; false;
        &#125;
      &#125;)
    &#125;,
    deleteMany() &#123;
      this.$confirm(&#39;此操作将永久删除 &#39; + this.multipleSelection.length + &#39; 条记录, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        let ids &#x3D; &#39;?&#39;;
        this.multipleSelection.forEach(item &#x3D;&gt; &#123;
          ids +&#x3D; &#39;ids&#x3D;&#39; + item.id + &#39;&amp;&#39;;
        &#125;)
        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;pos&#x2F;&quot; + ids).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initPositions();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,


  &#125;
&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;
.addPosInput &#123;
  width: 300px;
  margin-right: 8px
&#125;

.posManaMain &#123;
  margin-top: 10px;
&#125;

.updatePosInput &#123;
  width: 200px;
  margin-left: 8px;
&#125;

&lt;&#x2F;style&gt;</code></pre></div>

<p>删除的时候，有些职位并不能删除，需要做全局异常处理</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalExceptionHandler</span> </span>&#123;

    <span class="hljs-meta">@ExceptionHandler(SQLException.class)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">sqlException</span><span class="hljs-params">(SQLException e)</span></span>&#123;
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> MySQLIntegrityConstraintViolationException)&#123;
            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;该数据有关联数据，操作失败！&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;数据库异常，操作失败！&quot;</span>);
    &#125;
&#125;</code></pre></div>

<p>并添加批量删除的接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping(&quot;/&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deletePositionsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (positionService.deletePositionsByIds(ids) == ids.length) &#123;
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
&#125;</code></pre></div>

<p>并生成相应的Service和Mapper接口，最终在mapper.xml文件中完善sql语句</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deletePositionsByIds&quot;</span>&gt;</span>
  DELETE FROM position WHERE id in
  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span>
    #&#123;id&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></div>

<h4 id="职称管理"><a href="#职称管理" class="headerlink" title="职称管理"></a>职称管理</h4><h5 id="前端部分-1"><a href="#前端部分-1" class="headerlink" title="前端部分"></a>前端部分</h5><p><strong>JobLevelMana.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div&gt;
    &lt;div&gt;
      &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;jl.name&quot; style&#x3D;&quot;width: 300px;&quot; prefix-icon&#x3D;&quot;el-icon-plus&quot;
                placeholder&#x3D;&quot;添加职称&quot;&gt;
      &lt;&#x2F;el-input&gt;
      &lt;el-select v-model&#x3D;&quot;jl.titleLevel&quot; placeholder&#x3D;&quot;职称等级&quot; size&#x3D;&quot;small&quot;
                 style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in titleLevels&quot;
            :key&#x3D;&quot;item&quot;
            :label&#x3D;&quot;item&quot;
            :value&#x3D;&quot;item&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;添加&lt;&#x2F;el-button&gt;
      &lt;&#x2F;div&gt;
    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;
      &lt;el-table
          :data&#x3D;&quot;jls&quot;
          border
          size&#x3D;&quot;small&quot;
          style&#x3D;&quot;width: 80%&quot;&gt;
        &lt;el-table-column
            type&#x3D;&quot;selection&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;id&quot;
            label&#x3D;&quot;编号&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;name&quot;
            label&#x3D;&quot;职称名称&quot;
            width&#x3D;&quot;150&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;titleLevel&quot;
            label&#x3D;&quot;职称级别&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;createDate&quot;
            label&#x3D;&quot;创建时间&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
&lt;!--        &lt;el-table-column
            label&#x3D;&quot;是否启用&quot;&gt;
          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
            &lt;el-tag type&#x3D;&quot;success&quot; v-if&#x3D;&quot;scope.row.enabled&quot;&gt;已启用&lt;&#x2F;el-tag&gt;
            &lt;el-tag type&#x3D;&quot;danger&quot; v-else&gt;未启用&lt;&#x2F;el-tag&gt;
          &lt;&#x2F;template&gt;
        &lt;&#x2F;el-table-column&gt;--&gt;
        &lt;el-table-column
            label&#x3D;&quot;操作&quot;&gt;
          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
            &lt;el-button size&#x3D;&quot;small&quot; &gt;编辑&lt;&#x2F;el-button&gt;
            &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;danger&quot; &gt;删除&lt;&#x2F;el-button&gt;
          &lt;&#x2F;template&gt;
        &lt;&#x2F;el-table-column&gt;
      &lt;&#x2F;el-table&gt;
    &lt;&#x2F;div&gt;

  &lt;&#x2F;div&gt;

&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;JobLevelMana&quot;,
  data() &#123;
    return &#123;
      jl: &#123;
        name: &#39;&#39;,
        titleLevel: &#39;&#39;
      &#125;,
      jls: [],
      titleLevels: [
        &#39;正高级&#39;,
        &#39;副高级&#39;,
        &#39;中级&#39;,
        &#39;初级&#39;,
        &#39;员级&#39;,
      ]
    &#125;
  &#125;
&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<h5 id="后端部分-1"><a href="#后端部分-1" class="headerlink" title="后端部分"></a>后端部分</h5><p><strong>接口</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/basic/joblevel&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobLevelController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    JobLevelService jobLevelService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> jobLevelService.getAllJobLevels();
    &#125;

    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addJobLevel</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> JobLevel jobLevel)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (jobLevelService.addJobLevel(jobLevel) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;添加成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;添加失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateJobLevelById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> JobLevel jobLevel)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (jobLevelService.updateJobLevelById(jobLevel) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteJobLevelById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (jobLevelService.deleteJobLevelById(id) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (jobLevelService.deleteJobLevelsByIds(ids) == ids.length) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
    &#125;

&#125;</code></pre></div>

<p>业务类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobLevelService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    JobLevelMapper jobLevelMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span> </span>&#123;
     <span class="hljs-keyword">return</span> jobLevelMapper.getAllJobLevels();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addJobLevel</span><span class="hljs-params">(JobLevel jobLevel)</span> </span>&#123;
        jobLevel.setCreateDate(<span class="hljs-keyword">new</span> Date());
        jobLevel.setEnabled(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">return</span> jobLevelMapper.insertSelective(jobLevel);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateJobLevelById</span><span class="hljs-params">(JobLevel jobLevel)</span> </span>&#123;
        <span class="hljs-keyword">return</span> jobLevelMapper.updateByPrimaryKeySelective(jobLevel);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteJobLevelById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> jobLevelMapper.deleteByPrimaryKey(id);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(Integer[] ids)</span> </span>&#123;
        <span class="hljs-keyword">return</span> jobLevelMapper.deleteJobLevelsByIds(ids);
    &#125;

&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JobLevelMapper</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(JobLevel record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(JobLevel record)</span></span>;

    <span class="hljs-function">JobLevel <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(JobLevel record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(JobLevel record)</span></span>;

    <span class="hljs-function">List&lt;Position&gt; <span class="hljs-title">getAllJobLevels</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">Integer <span class="hljs-title">deleteJobLevelsByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> Integer[] ids)</span></span>;

&#125;</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllJobLevels&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  SELECT * FROM joblevel;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteJobLevelsByIds&quot;</span>&gt;</span>
  delete from joblevel where id in
  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>
    #&#123;id&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></div>

<h5 id="前后端对接-1"><a href="#前后端对接-1" class="headerlink" title="前后端对接"></a>前后端对接</h5><p>主要对添加，编辑，删除按钮进行设计</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div&gt;
    &lt;div&gt;
      &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;jl.name&quot; style&#x3D;&quot;width: 300px;&quot; prefix-icon&#x3D;&quot;el-icon-plus&quot;
                placeholder&#x3D;&quot;添加职称&quot;&gt;
      &lt;&#x2F;el-input&gt;
      &lt;el-select v-model&#x3D;&quot;jl.titleLevel&quot; placeholder&#x3D;&quot;职称等级&quot; size&#x3D;&quot;small&quot;
                 style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in titleLevels&quot;
            :key&#x3D;&quot;item&quot;
            :label&#x3D;&quot;item&quot;
            :value&#x3D;&quot;item&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot; @click&#x3D;&quot;addJobLevel&quot;&gt;添加&lt;&#x2F;el-button&gt;
      &lt;&#x2F;div&gt;
    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;
      &lt;el-table
          :data&#x3D;&quot;jls&quot;
          border
          size&#x3D;&quot;small&quot;
          @selection-change&#x3D;&quot;handleSelectionChange&quot;
          style&#x3D;&quot;width: 80%&quot;&gt;
        &lt;el-table-column
            type&#x3D;&quot;selection&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;id&quot;
            label&#x3D;&quot;编号&quot;
            width&#x3D;&quot;55&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;name&quot;
            label&#x3D;&quot;职称名称&quot;
            width&#x3D;&quot;150&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;titleLevel&quot;
            label&#x3D;&quot;职称级别&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            prop&#x3D;&quot;createDate&quot;
            label&#x3D;&quot;创建时间&quot;&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            label&#x3D;&quot;是否启用&quot;&gt;
          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
            &lt;el-tag type&#x3D;&quot;success&quot; v-if&#x3D;&quot;scope.row.enabled&quot;&gt;已启用&lt;&#x2F;el-tag&gt;
            &lt;el-tag type&#x3D;&quot;info&quot; v-else&gt;未启用&lt;&#x2F;el-tag&gt;
          &lt;&#x2F;template&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column
            label&#x3D;&quot;操作&quot;&gt;
          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
            &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;showEditView(scope.row)&quot;&gt;编辑&lt;&#x2F;el-button&gt;
            &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;deleteHandler(scope.row)&quot;&gt;删除&lt;&#x2F;el-button&gt;
          &lt;&#x2F;template&gt;
        &lt;&#x2F;el-table-column&gt;
      &lt;&#x2F;el-table&gt;
      &lt;el-button type&#x3D;&quot;danger&quot; size&#x3D;&quot;small&quot; style&#x3D;&quot;margin-top: 10px&quot; :disabled&#x3D;&quot;multipleSelection.length&#x3D;&#x3D;0&quot;
                 @click&#x3D;&quot;deleteMany&quot;&gt;批量删除
      &lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;

    &lt;el-dialog
        title&#x3D;&quot;修改职称&quot;
        :visible.sync&#x3D;&quot;dialogVisible&quot;
        width&#x3D;&quot;30%&quot;&gt;
      &lt;div&gt;
        &lt;table&gt;
          &lt;tr&gt;
            &lt;td&gt;
              &lt;el-tag&gt;职称名&lt;&#x2F;el-tag&gt;
            &lt;&#x2F;td&gt;
            &lt;td&gt;
              &lt;el-input size&#x3D;&quot;small&quot; v-model&#x3D;&quot;updateJl.name&quot;&gt;&lt;&#x2F;el-input&gt;
            &lt;&#x2F;td&gt;
          &lt;&#x2F;tr&gt;
          &lt;tr&gt;
            &lt;td&gt;
              &lt;el-tag&gt;职称级别&lt;&#x2F;el-tag&gt;
            &lt;&#x2F;td&gt;
            &lt;td&gt;
              &lt;el-select v-model&#x3D;&quot;updateJl.titleLevel&quot; placeholder&#x3D;&quot;职称等级&quot; size&#x3D;&quot;small&quot;
                         style&#x3D;&quot;margin-left: 5px;margin-right: 5px&quot;&gt;
                &lt;el-option
                    v-for&#x3D;&quot;item in titleLevels&quot;
                    :key&#x3D;&quot;item&quot;
                    :label&#x3D;&quot;item&quot;
                    :value&#x3D;&quot;item&quot;&gt;
                &lt;&#x2F;el-option&gt;
              &lt;&#x2F;el-select&gt;
            &lt;&#x2F;td&gt;
          &lt;&#x2F;tr&gt;
          &lt;tr&gt;
            &lt;td&gt;
              &lt;el-tag&gt;是否启用&lt;&#x2F;el-tag&gt;
            &lt;&#x2F;td&gt;
            &lt;td&gt;
              &lt;el-switch
                  v-model&#x3D;&quot;updateJl.enabled&quot;
                  active-text&#x3D;&quot;启用&quot;
                  inactive-text&#x3D;&quot;禁用&quot;&gt;
              &lt;&#x2F;el-switch&gt;
            &lt;&#x2F;td&gt;
          &lt;&#x2F;tr&gt;
        &lt;&#x2F;table&gt;
      &lt;&#x2F;div&gt;
      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
    &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;取 消&lt;&#x2F;el-button&gt;
    &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate&quot;&gt;确 定&lt;&#x2F;el-button&gt;
  &lt;&#x2F;span&gt;
    &lt;&#x2F;el-dialog&gt;

  &lt;&#x2F;div&gt;

&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;JobLevelMana&quot;,
  data() &#123;
    return &#123;
      multipleSelection: [],
      dialogVisible: false,
      updateJl: &#123;
        name: &#39;&#39;,
        titleLevel: &#39;&#39;,
        enabled: false
      &#125;,

      jl: &#123;
        name: &#39;&#39;,
        titleLevel: &#39;&#39;
      &#125;,
      jls: [],
      titleLevels: [
        &#39;正高级&#39;,
        &#39;副高级&#39;,
        &#39;中级&#39;,
        &#39;初级&#39;,
        &#39;员级&#39;,
      ]
    &#125;
  &#125;,
  mounted() &#123;
    this.initJls();
  &#125;,
  methods: &#123;
    handleSelectionChange(val) &#123;
      this.multipleSelection &#x3D; val;
    &#125;,
    deleteMany() &#123;
      this.$confirm(&#39;此操作将永久删除 &#39; + this.multipleSelection.length + &#39; 条记录, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        let ids &#x3D; &#39;?&#39;;
        this.multipleSelection.forEach(item &#x3D;&gt; &#123;
          ids +&#x3D; &#39;ids&#x3D;&#39; + item.id + &#39;&amp;&#39;;
        &#125;)
        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot; + ids).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initJls();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,
    doUpdate() &#123;
      this.putRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;, this.updateJl).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.initJls();
          this.dialogVisible &#x3D; false;
        &#125;
      &#125;)
    &#125;,
    showEditView(data) &#123;
      Object.assign(this.updateJl, data);
      this.dialogVisible &#x3D; true;
    &#125;,
    deleteHandler(data) &#123;
      this.$confirm(&#39;此操作将永久 &#39; + data.name + &#39; 职称, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initJls();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,
    addJobLevel() &#123;
      if (this.jl.name &amp;&amp; this.jl.titleLevel) &#123;

        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;, this.jl).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initJls();
          &#125;
        &#125;);
      &#125; else &#123;
        this.$message.error(&quot;添加字段不可以为空!&quot;);
      &#125;
    &#125;,
    initJls() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&#x2F;&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.jls &#x3D; resp;
          this.jl &#x3D; &#123;
            name: &#39;&#39;,
            titleLevel: &#39;&#39;
          &#125;;
        &#125;
      &#125;)
    &#125;
  &#125;
&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<h4 id="权限组"><a href="#权限组" class="headerlink" title="权限组"></a>权限组</h4><h5 id="前端部分-2"><a href="#前端部分-2" class="headerlink" title="前端部分"></a>前端部分</h5><p><strong>PermissMana.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div&gt;
    &lt;div class&#x3D;&quot;permissManaTool&quot;&gt;
      &lt;el-input size&#x3D;&quot;small&quot; placeholder&#x3D;&quot;请输入角色英文名&quot; v-model&#x3D;&quot;role.name&quot;&gt;
        &lt;template slot&#x3D;&quot;prepend&quot;&gt;ROLE_&lt;&#x2F;template&gt;
      &lt;&#x2F;el-input&gt;

      &lt;el-input size&#x3D;&quot;small&quot; placeholder&#x3D;&quot;请输入角色中文名&quot; v-model&#x3D;&quot;role.nameZh&quot;
                @keydown.enter.native&#x3D;&quot;doAddRole&quot;&gt;
      &lt;&#x2F;el-input&gt;

      &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot; icon&#x3D;&quot;el-icon-plus&quot; @click&#x3D;&quot;doAddRole&quot;&gt;添加角色&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;

    &lt;div class&#x3D;&quot;permissManaMain&quot;&gt;
      &lt;el-collapse v-model&#x3D;&quot;activeName&quot; @change&#x3D;&quot;change&quot;&gt;
        &lt;el-collapse-item :title&#x3D;&quot;r.nameZh&quot; :name&#x3D;&quot;r.id&quot; v-for&#x3D;&quot;(r,index) in roles&quot; :key&#x3D;&quot;index&quot;&gt;

          &lt;el-card class&#x3D;&quot;box-card&quot;&gt;
            &lt;div slot&#x3D;&quot;header&quot; class&#x3D;&quot;clearfix&quot;&gt;
              &lt;span&gt;可访问的资源&lt;&#x2F;span&gt;
              &lt;el-button style&#x3D;&quot;float: right; padding: 3px 0;color: #ff0000;&quot; icon&#x3D;&quot;el-icon-delete&quot;
                         type&#x3D;&quot;text&quot; @click&#x3D;&quot;deleteRole(r)&quot;&gt;&lt;&#x2F;el-button&gt;
            &lt;&#x2F;div&gt;
            &lt;div&gt;
              &lt;el-tree
                  show-checkbox
                  node-key&#x3D;&quot;id&quot;
                  ref&#x3D;&quot;tree&quot;
                  :key&#x3D;&quot;index&quot;
                  :default-checked-keys&#x3D;&quot;selectedMenus&quot;
                  :data&#x3D;&quot;allmenus&quot; :props&#x3D;&quot;defaultProps&quot;&gt;
              &lt;&#x2F;el-tree&gt;
              &lt;div style&#x3D;&quot;display: flex;justify-content: flex-end&quot;&gt;
                &lt;el-button size&#x3D;&quot;small&quot; @click&#x3D;&quot;cancelUpdate&quot;&gt;取消修改&lt;&#x2F;el-button&gt;
                &lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doUpdate(r.id,index)&quot;&gt;确认修改&lt;&#x2F;el-button&gt;
              &lt;&#x2F;div&gt;
            &lt;&#x2F;div&gt;
          &lt;&#x2F;el-card&gt;

        &lt;&#x2F;el-collapse-item&gt;
      &lt;&#x2F;el-collapse&gt;
    &lt;&#x2F;div&gt;
  &lt;&#x2F;div&gt;

&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;PermissMana&quot;,
  data() &#123;
    return &#123;
      role: &#123;
        name: &#39;&#39;,
        nameZh: &#39;&#39;
      &#125;,
      activeName: -1,
      roles: [],
      allmenus: [],
      selectedMenus: [],
      defaultProps: &#123;
        children: &#39;children&#39;,
        label: &#39;name&#39;
      &#125;

    &#125;
  &#125;,

  mounted() &#123;
    this.initRoles();
  &#125;,

  methods: &#123;
    initRoles() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.roles &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    change(rid) &#123;
      if (rid) &#123;
        this.initAllMenus();
        this.initSelectedMenus(rid);
      &#125;
    &#125;,
    doUpdate(rid, index) &#123;
      let tree &#x3D; this.$refs.tree[index];
      let selectedKeys &#x3D; tree.getCheckedKeys(true);
      let url &#x3D; &#39;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;?rid&#x3D;&#39; + rid;
      selectedKeys.forEach(key &#x3D;&gt; &#123;
        url +&#x3D; &#39;&amp;mids&#x3D;&#39; + key;
      &#125;)
      this.putRequest(url).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.activeName &#x3D; -1;
        &#125;
      &#125;)
    &#125;,
    cancelUpdate() &#123;
      this.activeName &#x3D; -1;
    &#125;,
    initAllMenus() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;menus&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.allmenus &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    initSelectedMenus(rid) &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;mids&#x2F;&quot; + rid).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.selectedMenus &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    doAddRole() &#123;
      if (this.role.name &amp;&amp; this.role.nameZh) &#123;
        this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;role&quot;, this.role).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.role.name &#x3D; &#39;&#39;;
            this.role.nameZh &#x3D; &#39;&#39;;
            this.initRoles();
          &#125;
        &#125;)
      &#125; else &#123;
        this.$message.error(&#39;数据不可以为空&#39;);
      &#125;
    &#125;,
    deleteRole(role) &#123;
      this.$confirm(&#39;此操作将永久删除 &#39; + role.nameZh + &#39; 角色, 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;permiss&#x2F;role&#x2F;&quot; + role.id).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initRoles();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,
  &#125;
  &#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

.permissManaTool &#123;
  display: flex;
  justify-content: flex-start;
&#125;
.permissManaTool .el-input &#123;
  width: 300px;
  margin-right: 6px;
&#125;

.permissManaMain &#123;
  margin-top: 10px;
  width: 700px;
&#125;

&lt;&#x2F;style&gt;</code></pre></div>

<h5 id="后端部分-2"><a href="#后端部分-2" class="headerlink" title="后端部分"></a>后端部分</h5><p><strong>测试接口类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/basic/permiss&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    RoleService roleService;
    <span class="hljs-meta">@Autowired</span>
    MenuService menuService;
    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> roleService.getAllRoles();
    &#125;
    <span class="hljs-meta">@GetMapping(&quot;/menus&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuService.getAllMenus();
    &#125;

    <span class="hljs-meta">@GetMapping(&quot;/mids/&#123;rid&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getMidsByRid</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer rid)</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuService.getMidsByRid(rid);
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateMenuRole</span><span class="hljs-params">(Integer rid, Integer[] mids)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (menuService.updateMenuRole(rid, mids)) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@PostMapping(&quot;/role&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addRole</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Role role)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (roleService.addRole(role) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;添加成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;添加失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/role/&#123;rid&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteRoleById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer rid)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (roleService.deleteRoleById(rid) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
    &#125;
&#125;

</code></pre></div>

<p>用户绑定菜单的权限，所以定义<strong>MenuService</strong>和<strong>RoleService</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    MenuMapper menuMapper;

    <span class="hljs-meta">@Autowired</span>
    MenuRoleMapper menuRoleMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getMenusByHrId</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuMapper.getMenusByHrId(((Hr) SecurityContextHolder.getContext().getAuthentication().getPrincipal()).getId());
    &#125;

    <span class="hljs-comment">//@Cacheable</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenus</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuMapper.getAllMenus();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getMidsByRid</span><span class="hljs-params">(Integer rid)</span> </span>&#123;
        <span class="hljs-keyword">return</span> menuMapper.getMidsByRid(rid);
    &#125;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateMenuRole</span><span class="hljs-params">(Integer rid, Integer[] mids)</span> </span>&#123;
        menuRoleMapper.deleteByRid(rid);
        <span class="hljs-keyword">if</span> (mids == <span class="hljs-keyword">null</span> || mids.length == <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        &#125;
        Integer result = menuRoleMapper.insertRecord(rid, mids);
        <span class="hljs-keyword">return</span> result==mids.length;
    &#125;
&#125;


<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    RoleMapper roleMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> roleMapper.getAllRoles();

    &#125;
  
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addRole</span><span class="hljs-params">(Role role)</span> </span>&#123;
      <span class="hljs-keyword">if</span> (!role.getName().startsWith(<span class="hljs-string">&quot;ROLE_&quot;</span>))&#123;
        role.setName(<span class="hljs-string">&quot;ROLE_&quot;</span> + role.getName());
      &#125;
      <span class="hljs-keyword">return</span> roleMapper.insert(role);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteRoleById</span><span class="hljs-params">(Integer rid)</span> </span>&#123;
        <span class="hljs-keyword">return</span> roleMapper.deleteByPrimaryKey(rid);
    &#125;
&#125;</code></pre></div>

<p><strong>Menumapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MenuWithChildren&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id1&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name1&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name2&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;children&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Menu&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id3&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name3&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllMenus&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;MenuWithChildren&quot;</span>&gt;</span>
    SELECT m1.`id` as id1,m1.`name` as name1,m2.`id` as id2,m2.`name` as name2,m3.`id` as id3,m3.`name` as name3
    FROM menu m1,menu m2,menu m3
    WHERE m1.`id`=m2.`parentId` AND m2.`id`=m3.`parentId` AND m3.`enabled`=true
    ORDER BY m1.`id`,m2.`id`,m3.`id`
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>


  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMidsByRid&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;</span>
    select mid from menu_role where rid=#&#123;rid&#125;;
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p><strong>Rolemapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllRoles&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  select * from role;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p>由于需要更新每个<strong>Role</strong>的管理权限，所以还要更新<strong>MenuRoleMapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteByRid&quot;</span>&gt;</span>
  delete from menu_role where rid=#&#123;rid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertRecord&quot;</span>&gt;</span>
	insert into menu_role (mid,rid) values
	<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;mids&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;mid&quot;</span>&gt;</span>
	(#&#123;mid&#125;,#&#123;rid&#125;)
	<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<h4 id="部门管理"><a href="#部门管理" class="headerlink" title="部门管理"></a>部门管理</h4><h5 id="前端部分-3"><a href="#前端部分-3" class="headerlink" title="前端部分"></a>前端部分</h5><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;

  &lt;div style&#x3D;&quot;width: 500px;&quot;&gt;

    &lt;el-input
        placeholder&#x3D;&quot;请输入部门名称进行搜索...&quot;
        prefix-icon&#x3D;&quot;el-icon-search&quot;
        v-model&#x3D;&quot;filterText&quot;&gt;
    &lt;&#x2F;el-input&gt;

    &lt;el-tree
        style&#x3D;&quot;margin-top: 10px;&quot;
        :data&#x3D;&quot;deps&quot;
        :props&#x3D;&quot;defaultProps&quot;
        :expand-on-click-node&#x3D;&quot;false&quot;
        :filter-node-method&#x3D;&quot;filterNode&quot;
        ref&#x3D;&quot;tree&quot;&gt;
      &lt;span class&#x3D;&quot;custom-tree-node&quot; style&#x3D;&quot;display: flex;justify-content:space-between;width: 100%;&quot;
                  slot-scope&#x3D;&quot;&#123; node, data &#125;&quot;&gt;
        &lt;span&gt;&#123;&#123;data.name &#125;&#125;&lt;&#x2F;span&gt;
        &lt;span&gt;
          &lt;el-button
              type&#x3D;&quot;primary&quot;
              size&#x3D;&quot;small&quot;
              class&#x3D;&quot;depBtn&quot;
              @click&#x3D;&quot;() &#x3D;&gt; showAddDepView(data)&quot;&gt;
            添加部门
          &lt;&#x2F;el-button&gt;
          &lt;el-button
              type&#x3D;&quot;danger&quot;
              size&#x3D;&quot;small&quot;
              class&#x3D;&quot;depBtn&quot;
              @click&#x3D;&quot;() &#x3D;&gt; deleteDep(data)&quot;&gt;
            删除部门
          &lt;&#x2F;el-button&gt;
        &lt;&#x2F;span&gt;
      &lt;&#x2F;span&gt;
    &lt;&#x2F;el-tree&gt;

    &lt;el-dialog
        title&#x3D;&quot;添加部门&quot;
        :visible.sync&#x3D;&quot;dialogVisible&quot;
        width&#x3D;&quot;30%&quot;&gt;
      &lt;div&gt;
        &lt;table&gt;
          &lt;tr&gt;
            &lt;td&gt;
              &lt;el-tag&gt;上级部门&lt;&#x2F;el-tag&gt;
            &lt;&#x2F;td&gt;
            &lt;td&gt;&#123;&#123;pname&#125;&#125;&lt;&#x2F;td&gt;
          &lt;&#x2F;tr&gt;
          &lt;tr&gt;
            &lt;td&gt;
              &lt;el-tag&gt;部门名称&lt;&#x2F;el-tag&gt;
            &lt;&#x2F;td&gt;
            &lt;td&gt;
              &lt;el-input v-model&#x3D;&quot;dep.name&quot; placeholder&#x3D;&quot;请输入部门名称...&quot;&gt;&lt;&#x2F;el-input&gt;
            &lt;&#x2F;td&gt;
          &lt;&#x2F;tr&gt;
        &lt;&#x2F;table&gt;
      &lt;&#x2F;div&gt;
      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
    &lt;el-button @click&#x3D;&quot;dialogVisible &#x3D; false&quot;&gt;取 消&lt;&#x2F;el-button&gt;
    &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doAddDep&quot;&gt;确 定&lt;&#x2F;el-button&gt;
      &lt;&#x2F;span&gt;
  &lt;&#x2F;el-dialog&gt;

  &lt;&#x2F;div&gt;

&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;DepMana&quot;,
  data() &#123;
    return &#123;
      filterText: &#39;&#39;,
      deps: [],
      defaultProps: &#123;
        children: &#39;children&#39;,
        label: &#39;name&#39;
      &#125;,
      pname: &#39;&#39;,
      dep: &#123;
        name: &#39;&#39;,
        parentId: -1
      &#125;,
      dialogVisible: false,
    &#125;
  &#125;,

  watch: &#123;
    filterText(val) &#123;
      this.$refs.tree.filter(val);
    &#125;
  &#125;,

  mounted() &#123;
    this.initDeps();
  &#125;,

  methods : &#123;

    initDeps() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.deps &#x3D; resp;
        &#125;
      &#125;)
    &#125;,

    filterNode(value, data) &#123;
      if (!value) return true;
      return data.name.indexOf(value) !&#x3D;&#x3D; -1;
    &#125;,

    showAddDepView(data) &#123;
      this.pname &#x3D; data.name;
      this.dep.parentId &#x3D; data.id;
      this.dialogVisible &#x3D; true;
    &#125;,

    initDep() &#123;
      this.dep &#x3D; &#123;
        name: &#39;&#39;,
        parentId: -1
      &#125;
      this.pname &#x3D; &#39;&#39;;
    &#125;,

    doAddDep() &#123;
      this.postRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;, this.dep).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.addDep2Deps(this.deps, resp.obj);
          this.dialogVisible &#x3D; false;
          &#x2F;&#x2F;初始化变量
          this.initDep();
        &#125;
      &#125;)
    &#125;,

    addDep2Deps(deps, dep) &#123;
      for (let i &#x3D; 0; i &lt; deps.length; i++) &#123;
        let d &#x3D; deps[i];
        if (d.id &#x3D;&#x3D; dep.parentId) &#123;
          d.children &#x3D; d.children.concat(dep);
          if (d.children.length &gt; 0) &#123;
            d.parent &#x3D; true;
          &#125;
          return;
        &#125; else &#123;
          this.addDep2Deps(d.children, dep);
        &#125;
      &#125;
    &#125;,

    deleteDep(data) &#123;
      if (data.parent) &#123;
        this.$message.error(&quot;父部门删除失败&quot;);
      &#125; else &#123;
        this.$confirm(&#39;此操作将永久删除 &#39; + data.name + &#39; 部门, 是否继续?&#39;, &#39;提示&#39;, &#123;
          confirmButtonText: &#39;确定&#39;,
          cancelButtonText: &#39;取消&#39;,
          type: &#39;warning&#39;
        &#125;).then(() &#x3D;&gt; &#123;
          this.deleteRequest(&quot;&#x2F;system&#x2F;basic&#x2F;department&#x2F;&quot;+data.id).then(resp&#x3D;&gt;&#123;
            if (resp) &#123;
              this.removeDepFromDeps(null,this.deps,data.id);
            &#125;
          &#125;)
        &#125;).catch(() &#x3D;&gt; &#123;
          this.$message(&#123;
            type: &#39;info&#39;,
            message: &#39;已取消删除&#39;
          &#125;);
        &#125;);
      &#125;
    &#125;,

    removeDepFromDeps(p,deps, id) &#123;
      for(let i &#x3D; 0;i &lt; deps.length;i++)&#123;
        let d &#x3D; deps[i];
        if (d.id &#x3D;&#x3D; id) &#123;
          deps.splice(i, 1);
          if (deps.length &#x3D;&#x3D; 0) &#123;
            p.parent &#x3D; false;
          &#125;
          return;
        &#125;else&#123;
          this.removeDepFromDeps(d,d.children, id);
        &#125;
      &#125;
    &#125;,

  &#125;

&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;
  .depBtn &#123;
    padding: 2px;
  &#125;
&lt;&#x2F;style&gt;</code></pre></div>

<h5 id="后端部分-3"><a href="#后端部分-3" class="headerlink" title="后端部分"></a>后端部分</h5><p>因为这部分SQL代码比较多，所以这里使用存储过程，生成添加和删除部门的存储过程</p>
<div class="hljs code-wrapper"><pre><code class="hljs sql">#添加
<span class="hljs-keyword">create</span>
    definer <span class="hljs-operator">=</span> root@`<span class="hljs-number">172.16</span><span class="hljs-number">.211</span><span class="hljs-number">.4</span>` <span class="hljs-keyword">procedure</span> addDep(<span class="hljs-keyword">IN</span> depName <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>), <span class="hljs-keyword">IN</span> parentId <span class="hljs-type">int</span>, <span class="hljs-keyword">IN</span> enabled tinyint(<span class="hljs-number">1</span>),
                                                   <span class="hljs-keyword">OUT</span> <span class="hljs-keyword">result</span> <span class="hljs-type">int</span>, <span class="hljs-keyword">OUT</span> result2 <span class="hljs-type">int</span>)
<span class="hljs-keyword">begin</span>
  <span class="hljs-keyword">declare</span> did <span class="hljs-type">int</span>;
  <span class="hljs-keyword">declare</span> pDepPath <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> department <span class="hljs-keyword">set</span> name<span class="hljs-operator">=</span>depName,parentId<span class="hljs-operator">=</span>parentId,enabled<span class="hljs-operator">=</span>enabled;
  <span class="hljs-keyword">select</span> row_count() <span class="hljs-keyword">into</span> <span class="hljs-keyword">result</span>;
  <span class="hljs-keyword">select</span> last_insert_id() <span class="hljs-keyword">into</span> did;
  <span class="hljs-keyword">set</span> result2<span class="hljs-operator">=</span>did;
  <span class="hljs-keyword">select</span> depPath <span class="hljs-keyword">into</span> pDepPath <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>parentId;
  update department <span class="hljs-keyword">set</span> depPath<span class="hljs-operator">=</span>concat(pDepPath,<span class="hljs-string">&#x27;.&#x27;</span>,did) <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did;
  update department <span class="hljs-keyword">set</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">true</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>parentId;
<span class="hljs-keyword">end</span>;

#删除
<span class="hljs-keyword">create</span>
    definer <span class="hljs-operator">=</span> root@`<span class="hljs-number">172.16</span><span class="hljs-number">.211</span><span class="hljs-number">.4</span>` <span class="hljs-keyword">procedure</span> deleteDep(<span class="hljs-keyword">IN</span> did <span class="hljs-type">int</span>, <span class="hljs-keyword">OUT</span> <span class="hljs-keyword">result</span> <span class="hljs-type">int</span>)
<span class="hljs-keyword">begin</span>
  <span class="hljs-keyword">declare</span> ecount <span class="hljs-type">int</span>;
  <span class="hljs-keyword">declare</span> pid <span class="hljs-type">int</span>;
  <span class="hljs-keyword">declare</span> pcount <span class="hljs-type">int</span>;
  <span class="hljs-keyword">declare</span> a <span class="hljs-type">int</span>;
  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> a <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did <span class="hljs-keyword">and</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span>;
  if a<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-number">-2</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> ecount <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> departmentId<span class="hljs-operator">=</span>did;
  if ecount<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span><span class="hljs-operator">=</span><span class="hljs-number">-1</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-keyword">select</span> parentId <span class="hljs-keyword">into</span> pid <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did;
  <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>did <span class="hljs-keyword">and</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span>;
  <span class="hljs-keyword">select</span> row_count() <span class="hljs-keyword">into</span> <span class="hljs-keyword">result</span>;
  <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> pcount <span class="hljs-keyword">from</span> department <span class="hljs-keyword">where</span> parentId<span class="hljs-operator">=</span>pid;
  if pcount<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span> update department <span class="hljs-keyword">set</span> isParent<span class="hljs-operator">=</span><span class="hljs-literal">false</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>pid;
  <span class="hljs-keyword">end</span> if;
  <span class="hljs-keyword">end</span> if;
  <span class="hljs-keyword">end</span> if;
<span class="hljs-keyword">end</span>;</code></pre></div>

<p>对<strong>Department</strong>实体类进行修改</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer id;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> Integer parentId;

    <span class="hljs-keyword">private</span> String depPath;

    <span class="hljs-keyword">private</span> Boolean enabled;

    <span class="hljs-keyword">private</span> Boolean isParent;

    <span class="hljs-keyword">private</span> List&lt;Department&gt; children = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-keyword">private</span> Integer result;
&#125;</code></pre></div>

<p><strong>Controller</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/basic/department&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    DepartmentService departmentService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Department&gt; <span class="hljs-title">getAllDepartments</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> departmentService.getAllDepartments();
    &#125;

    <span class="hljs-comment">//调用存储过程</span>
    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addDep</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Department dep)</span> </span>&#123;
        departmentService.addDep(dep);
        <span class="hljs-keyword">if</span> (dep.getResult() == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;添加成功&quot;</span>, dep);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;添加失败&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteDepById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;
        Department dep = <span class="hljs-keyword">new</span> Department();
        dep.setId(id);
        departmentService.deleteDepById(dep);
        <span class="hljs-keyword">if</span> (dep.getResult() == -<span class="hljs-number">2</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;该部门下有子部门，删除失败&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dep.getResult() == -<span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;该部门下有员工，删除失败&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dep.getResult() == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败&quot;</span>);
    &#125;

&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentService</span> </span>&#123;


    <span class="hljs-meta">@Autowired</span>
    DepartmentMapper departmentMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Department&gt; <span class="hljs-title">getAllDepartments</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> departmentMapper.getAllDepartmentsByParentId(-<span class="hljs-number">1</span>);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addDep</span><span class="hljs-params">(Department dep)</span> </span>&#123;
        dep.setEnabled(<span class="hljs-keyword">true</span>);
        departmentMapper.addDep(dep);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteDepById</span><span class="hljs-params">(Department dep)</span> </span>&#123;
        departmentMapper.deleteDepById(dep);
    &#125;
&#125;</code></pre></div>

<p><strong>Mapper接口</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DepartmentMapper</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Department record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertSelective</span><span class="hljs-params">(Department record)</span></span>;

    <span class="hljs-function">Department <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKeySelective</span><span class="hljs-params">(Department record)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateByPrimaryKey</span><span class="hljs-params">(Department record)</span></span>;

    <span class="hljs-function">List&lt;Department&gt; <span class="hljs-title">getAllDepartmentsByParentId</span><span class="hljs-params">(Integer pid)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addDep</span><span class="hljs-params">(Department dep)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteDepById</span><span class="hljs-params">(Department dep)</span></span>;

    <span class="hljs-function">List&lt;Department&gt; <span class="hljs-title">getAllDepartmentsWithOutChildren</span><span class="hljs-params">()</span></span>;
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--调用存储过程--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addDep&quot;</span> <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span>&gt;</span>
    call addDep(#&#123;name,mode=IN,jdbcType=VARCHAR&#125;,#&#123;parentId,mode=IN,jdbcType=INTEGER&#125;,
        #&#123;enabled,mode=IN,jdbcType=BOOLEAN&#125;,#&#123;result,mode=OUT,jdbcType=INTEGER&#125;,#&#123;id,mode=OUT,jdbcType=INTEGER&#125;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteDepById&quot;</span> <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span>&gt;</span>
    call deleteDep(#&#123;id,mode=IN,jdbcType=INTEGER&#125;,#&#123;result,mode=OUT,jdbcType=INTEGER&#125;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h3 id="操作员管理"><a href="#操作员管理" class="headerlink" title="操作员管理"></a>操作员管理</h3><h4 id="前端部分-4"><a href="#前端部分-4" class="headerlink" title="前端部分"></a>前端部分</h4><p>在<strong>SysHr.vue</strong>中完善以下部分</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div&gt;
    &lt;div style&#x3D;&quot;margin-top: 10px;display: flex;justify-content: center&quot;&gt;
      &lt;el-input v-model&#x3D;&quot;keywords&quot; placeholder&#x3D;&quot;通过用户名搜索用户&quot; prefix-icon&#x3D;&quot;el-icon-search&quot;
                style&#x3D;&quot;width: 400px;margin-right: 10px&quot; @keydown.enter.native&#x3D;&quot;doSearch&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-search&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;doSearch&quot;&gt;搜索&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;

    &lt;div class&#x3D;&quot;hr-container&quot;&gt;
      &lt;el-card class&#x3D;&quot;hr-card&quot; v-for&#x3D;&quot;(hr,index) in hrs&quot; :key&#x3D;&quot;index&quot;&gt;
        &lt;div slot&#x3D;&quot;header&quot; class&#x3D;&quot;clearfix&quot;&gt;
          &lt;span&gt;&#123;&#123;hr.name&#125;&#125;&lt;&#x2F;span&gt;
          &lt;el-button style&#x3D;&quot;float: right; padding: 3px 0;color: #e30007;&quot; type&#x3D;&quot;text&quot;
                     icon&#x3D;&quot;el-icon-delete&quot; @click&#x3D;&quot;deleteHr(hr)&quot;&gt;&lt;&#x2F;el-button&gt;
        &lt;&#x2F;div&gt;
        &lt;div&gt;
          &lt;div class&#x3D;&quot;img-container&quot;&gt;
            &lt;img :src&#x3D;&quot;hr.userface&quot; :alt&#x3D;&quot;hr.name&quot; :title&#x3D;&quot;hr.name&quot; class&#x3D;&quot;userface-img&quot;&gt;
          &lt;&#x2F;div&gt;
          &lt;div class&#x3D;&quot;userinfo-container&quot;&gt;
            &lt;div&gt;用户名：&#123;&#123;hr.name&#125;&#125;&lt;&#x2F;div&gt;
            &lt;div&gt;手机号码：&#123;&#123;hr.phone&#125;&#125;&lt;&#x2F;div&gt;
            &lt;div&gt;电话号码：&#123;&#123;hr.telephone&#125;&#125;&lt;&#x2F;div&gt;
            &lt;div&gt;地址：&#123;&#123;hr.address&#125;&#125;&lt;&#x2F;div&gt;
            &lt;div&gt;用户状态：
              &lt;el-switch
                  v-model&#x3D;&quot;hr.enabled&quot;
                  active-text&#x3D;&quot;启用&quot;
                  @change&#x3D;&quot;enabledChange(hr)&quot;
                  active-color&#x3D;&quot;#13ce66&quot;
                  inactive-color&#x3D;&quot;#ff4949&quot;
                  inactive-text&#x3D;&quot;禁用&quot;&gt;
              &lt;&#x2F;el-switch&gt;
            &lt;&#x2F;div&gt;
            &lt;div&gt;用户角色：
              &lt;el-tag type&#x3D;&quot;success&quot; style&#x3D;&quot;margin-right: 6px&quot;
                      v-for&#x3D;&quot;(role,indexj) in hr.roles&quot; :key&#x3D;&quot;indexj&quot;&gt;
                &#123;&#123;role.nameZh&#125;&#125;
              &lt;&#x2F;el-tag&gt;
              &lt;el-popover
                  placement&#x3D;&quot;right&quot;
                  title&#x3D;&quot;角色列表&quot;
                  @show&#x3D;&quot;showPop(hr)&quot;
                  @hide&#x3D;&quot;hidePop(hr)&quot;
                  width&#x3D;&quot;150&quot;
                  trigger&#x3D;&quot;click&quot;&gt;
                &lt;el-select v-model&#x3D;&quot;selectedRoles&quot; multiple placeholder&#x3D;&quot;请选择&quot;&gt;
                  &lt;el-option
                      v-for&#x3D;&quot;(r,indexk) in allroles&quot;
                      :key&#x3D;&quot;indexk&quot;
                      :label&#x3D;&quot;r.nameZh&quot;
                      :value&#x3D;&quot;r.id&quot;&gt;
                  &lt;&#x2F;el-option&gt;
                &lt;&#x2F;el-select&gt;
                &lt;el-button slot&#x3D;&quot;reference&quot; icon&#x3D;&quot;el-icon-more&quot; type&#x3D;&quot;text&quot;&gt;&lt;&#x2F;el-button&gt;
              &lt;&#x2F;el-popover&gt;
            &lt;&#x2F;div&gt;
            &lt;div&gt;备注：&#123;&#123;hr.remark&#125;&#125;&lt;&#x2F;div&gt;
          &lt;&#x2F;div&gt;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;el-card&gt;

    &lt;&#x2F;div&gt;


  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;SysHr&quot;,
  data() &#123;
    return &#123;
      keywords: &#39;&#39;,
      hrs: [],
      selectedRoles: [],
      allroles: []
    &#125;
  &#125;,

  mounted() &#123;
    this.initHrs();
  &#125;,

  methods: &#123;
    initHrs() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;hr&#x2F;?keywords&#x3D;&quot;+this.keywords).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.hrs &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    enabledChange(hr) &#123;
      delete hr.roles;
      this.putRequest(&quot;&#x2F;system&#x2F;hr&#x2F;&quot;, hr).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.initHrs();
        &#125;
      &#125;)
    &#125;,
    showPop(hr) &#123;
      this.initAllRoles();
      let roles &#x3D; hr.roles;
      this.selectedRoles &#x3D; [];
      roles.forEach(r &#x3D;&gt; &#123;
        this.selectedRoles.push(r.id);
      &#125;)
    &#125;,
    initAllRoles() &#123;
      this.getRequest(&quot;&#x2F;system&#x2F;hr&#x2F;roles&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.allroles &#x3D; resp;
        &#125;
      &#125;)
    &#125;,

    hidePop(hr) &#123;
      let roles &#x3D; [];
      &#x2F;&#x2F;拷贝一份
      Object.assign(roles, hr.roles);
      let flag &#x3D; false;
      if (roles.length !&#x3D; this.selectedRoles.length) &#123;
        flag &#x3D; true;
      &#125; else &#123;
        for (let i &#x3D; 0; i &lt; roles.length; i++) &#123;
          let role &#x3D; roles[i];
          for (let j &#x3D; 0; j &lt; this.selectedRoles.length; j++) &#123;
            let sr &#x3D; this.selectedRoles[j];
            if (role.id &#x3D;&#x3D; sr) &#123;
              roles.splice(i, 1);
              i--;
              break;
            &#125;
          &#125;
        &#125;
        if (roles.length !&#x3D; 0) &#123;
          flag &#x3D; true;
        &#125;
      &#125;
      if (flag) &#123;
        let url &#x3D; &#39;&#x2F;system&#x2F;hr&#x2F;role?hrid&#x3D;&#39; + hr.id;
        this.selectedRoles.forEach(sr &#x3D;&gt; &#123;
          url +&#x3D; &#39;&amp;rids&#x3D;&#39; + sr;
        &#125;);
        this.putRequest(url).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initHrs();
          &#125;
        &#125;);
      &#125;
    &#125;,

    doSearch() &#123;
      this.initHrs();
    &#125;,

    deleteHr(hr) &#123;
      this.$confirm(&#39;此操作将永久删除 &#39;+hr.name+&#39; , 是否继续?&#39;, &#39;提示&#39;, &#123;
        confirmButtonText: &#39;确定&#39;,
        cancelButtonText: &#39;取消&#39;,
        type: &#39;warning&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        this.deleteRequest(&quot;&#x2F;system&#x2F;hr&#x2F;&quot;+hr.id).then(resp&#x3D;&gt;&#123;
          if (resp) &#123;
            this.initHrs();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message(&#123;
          type: &#39;info&#39;,
          message: &#39;已取消删除&#39;
        &#125;);
      &#125;);
    &#125;,

  &#125;

&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

.hr-container &#123;
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
&#125;

.hr-card &#123;
  width: 350px;
  margin-bottom: 20px;
&#125;

.img-container &#123;
  width: 100%;
  display: flex;
  justify-content: center;
&#125;

.userface-img &#123;
  width: 72px;
  height: 72px;
  border-radius: 72px;
&#125;

.userinfo-container &#123;
  margin-top: 20px;
&#125;

.userinfo-container div &#123;
  font-size: 12px;
  color: #409eff;
&#125;


&lt;&#x2F;style&gt;</code></pre></div>

<h4 id="后端部分-4"><a href="#后端部分-4" class="headerlink" title="后端部分"></a>后端部分</h4><p><strong>接口设计</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/system/hr&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    HrService hrService;

    <span class="hljs-meta">@Autowired</span>
    RoleService roleService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">(String keywords)</span> </span>&#123;
        <span class="hljs-keyword">return</span> hrService.getAllHrs(keywords);
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@GetMapping(&quot;/roles&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getAllRoles</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> roleService.getAllRoles();
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/role&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrRole</span><span class="hljs-params">(Integer hrid, Integer[] rids)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (hrService.updateHrRole(hrid, rids)) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteHrById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (hrService.deleteHrById(id) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败!&quot;</span>);
    &#125;</code></pre></div>

<p>继续在<strong>Service</strong>层完善</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    HrMapper hrMapper;

    <span class="hljs-meta">@Autowired</span>
    HrRoleMapper hrRoleMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;

        Hr hr = hrMapper.loadUserByUsername(username);
        <span class="hljs-keyword">if</span> (hr == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UsernameNotFoundException(<span class="hljs-string">&quot;用户名不存在！&quot;</span>);
        &#125;

        hr.setRoles(hrMapper.getHrRolesById(hr.getId()));

        <span class="hljs-keyword">return</span> hr;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">(String keywords)</span> </span>&#123;
        <span class="hljs-keyword">return</span> hrMapper.getAllHrs(HrUtils.getCurrentHr().getId(),keywords);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateHr</span><span class="hljs-params">(Hr hr)</span> </span>&#123;
        <span class="hljs-keyword">return</span> hrMapper.updateByPrimaryKeySelective(hr);
    &#125;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateHrRole</span><span class="hljs-params">(Integer hrid, Integer[] rids)</span> </span>&#123;
        hrRoleMapper.deleteByHrid(hrid);
        <span class="hljs-keyword">return</span> hrRoleMapper.addRole(hrid,rids) == rids.length;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteHrById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> hrMapper.deleteByPrimaryKey(id);
    &#125;

&#125;</code></pre></div>

<p>在实体类Hr中忽略传入的role的Json</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-meta">@JsonIgnore</span>
<span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;
    List&lt;SimpleGrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(roles.size());
    <span class="hljs-keyword">for</span> (Role role : roles) &#123;
        authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName()));
    &#125;
    <span class="hljs-keyword">return</span> authorities;
&#125;</code></pre></div>

<p><strong>HrRoleMapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteByHrid&quot;</span>&gt;</span>
  delete from hr_role where hrid=#&#123;hrid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addRole&quot;</span>&gt;</span>
  insert into hr_role (hrid,rid) values
  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;rids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>
    (#&#123;hrid&#125;,#&#123;rid&#125;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<p><strong>HrMapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;HrWithRoles&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Hr&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roles&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Role&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rnameZh&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nameZh&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllHrs&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;HrWithRoles&quot;</span>&gt;</span>
  SELECT hr.id, hr.name, hr.phone, hr.telephone, hr.address, hr.enabled,
  hr.username, hr.password, hr.userface, hr.remark, r.id as rid, r.name as rname, r.nameZh as rnameZh
  FROM hr LEFT JOIN hr_role hrr ON hr.id = hrr.hrid
  LEFT JOIN role r ON hrr.rid = r.id
  WHERE hr.id != #&#123;hrid&#125;
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;keywords!=null&quot;</span>&gt;</span>
    and hr.name like concat(&#x27;%&#x27;,#&#123;keywords&#125;,&#x27;%&#x27;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  ORDER BY hr.id
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h2 id="员工资料"><a href="#员工资料" class="headerlink" title="员工资料"></a>员工资料</h2><p>此部分代码较多，但实现的功能和上面类似，不再展示</p>
<p>具体可去<a target="_blank" rel="noopener" href="https://github.com/Lucifer2u/x-luciferpro%E4%B8%AD%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B">https://github.com/Lucifer2u/x-luciferpro中的版本信息查看</a></p>
<p><strong>这里补充设计到的新知识点，导入和导出数据到Excel</strong></p>
<h3 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h3><p>先引入依赖</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><strong>后端代码</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/employee/basic&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmpBasicController</span> </span>&#123;
    <span class="hljs-meta">@GetMapping(&quot;/export&quot;)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt; exportData() &#123;
        List&lt;Employee&gt; list = (List&lt;Employee&gt;) employeeService.getEmployeeByPage(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>).getData();
        <span class="hljs-keyword">return</span> POIUtils.employee2Excel(list);

    &#125;
&#125;</code></pre></div>

<p><strong>生成Excel的工具类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">POIUtils</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt; employee2Excel(List&lt;Employee&gt; list) &#123;
        <span class="hljs-comment">//1. 创建一个 Excel 文档</span>
        HSSFWorkbook workbook = <span class="hljs-keyword">new</span> HSSFWorkbook();
        <span class="hljs-comment">//2. 创建文档摘要</span>
        workbook.createInformationProperties();
        <span class="hljs-comment">//3. 获取并配置文档信息</span>
        DocumentSummaryInformation docInfo = workbook.getDocumentSummaryInformation();
        <span class="hljs-comment">//文档类别</span>
        docInfo.setCategory(<span class="hljs-string">&quot;员工信息&quot;</span>);
        <span class="hljs-comment">//文档管理员</span>
        docInfo.setManager(<span class="hljs-string">&quot;lucifer&quot;</span>);
        <span class="hljs-comment">//设置公司信息</span>
        docInfo.setCompany(<span class="hljs-string">&quot;www.lucifer.org&quot;</span>);
        <span class="hljs-comment">//4. 获取文档摘要信息</span>
        SummaryInformation summInfo = workbook.getSummaryInformation();
        <span class="hljs-comment">//文档标题</span>
        summInfo.setTitle(<span class="hljs-string">&quot;员工信息表&quot;</span>);
        <span class="hljs-comment">//文档作者</span>
        summInfo.setAuthor(<span class="hljs-string">&quot;lucifer&quot;</span>);
        <span class="hljs-comment">// 文档备注</span>
        summInfo.setComments(<span class="hljs-string">&quot;本文档由 lucifer 提供&quot;</span>);
        <span class="hljs-comment">//5. 创建样式</span>
        <span class="hljs-comment">//创建标题行的样式</span>
        HSSFCellStyle headerStyle = workbook.createCellStyle();
        headerStyle.setFillForegroundColor(IndexedColors.YELLOW.index);
        headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);
        <span class="hljs-comment">//设置日期格式</span>
        HSSFCellStyle dateCellStyle = workbook.createCellStyle();
        dateCellStyle.setDataFormat(HSSFDataFormat.getBuiltinFormat(<span class="hljs-string">&quot;m/d/yy&quot;</span>));
        HSSFSheet sheet = workbook.createSheet(<span class="hljs-string">&quot;员工信息表&quot;</span>);
        <span class="hljs-comment">//设置列的宽度</span>
        sheet.setColumnWidth(<span class="hljs-number">0</span>, <span class="hljs-number">5</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">1</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">2</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">3</span>, <span class="hljs-number">5</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">4</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">5</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">6</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">7</span>, <span class="hljs-number">10</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">8</span>, <span class="hljs-number">16</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">9</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">10</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">11</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">12</span>, <span class="hljs-number">16</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">13</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">14</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">15</span>, <span class="hljs-number">12</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">16</span>, <span class="hljs-number">8</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">17</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">18</span>, <span class="hljs-number">20</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">19</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">20</span>, <span class="hljs-number">8</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">21</span>, <span class="hljs-number">25</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">22</span>, <span class="hljs-number">14</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">23</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);
        sheet.setColumnWidth(<span class="hljs-number">24</span>, <span class="hljs-number">15</span> * <span class="hljs-number">256</span>);
        <span class="hljs-comment">//6. 创建标题行</span>
        HSSFRow r0 = sheet.createRow(<span class="hljs-number">0</span>);

        HSSFCell c0 = r0.createCell(<span class="hljs-number">0</span>);
        c0.setCellValue(<span class="hljs-string">&quot;编号&quot;</span>);
        c0.setCellStyle(headerStyle);
        HSSFCell c1 = r0.createCell(<span class="hljs-number">1</span>);
        c1.setCellStyle(headerStyle);
        c1.setCellValue(<span class="hljs-string">&quot;姓名&quot;</span>);
        HSSFCell c2 = r0.createCell(<span class="hljs-number">2</span>);
        c2.setCellStyle(headerStyle);
        c2.setCellValue(<span class="hljs-string">&quot;工号&quot;</span>);
        HSSFCell c3 = r0.createCell(<span class="hljs-number">3</span>);
        c3.setCellStyle(headerStyle);
        c3.setCellValue(<span class="hljs-string">&quot;性别&quot;</span>);
        HSSFCell c4 = r0.createCell(<span class="hljs-number">4</span>);
        c4.setCellStyle(headerStyle);
        c4.setCellValue(<span class="hljs-string">&quot;出生日期&quot;</span>);
        HSSFCell c5 = r0.createCell(<span class="hljs-number">5</span>);
        c5.setCellStyle(headerStyle);
        c5.setCellValue(<span class="hljs-string">&quot;身份证号码&quot;</span>);
        HSSFCell c6 = r0.createCell(<span class="hljs-number">6</span>);
        c6.setCellStyle(headerStyle);
        c6.setCellValue(<span class="hljs-string">&quot;婚姻状况&quot;</span>);
        HSSFCell c7 = r0.createCell(<span class="hljs-number">7</span>);
        c7.setCellStyle(headerStyle);
        c7.setCellValue(<span class="hljs-string">&quot;民族&quot;</span>);
        HSSFCell c8 = r0.createCell(<span class="hljs-number">8</span>);
        c8.setCellStyle(headerStyle);
        c8.setCellValue(<span class="hljs-string">&quot;籍贯&quot;</span>);
        HSSFCell c9 = r0.createCell(<span class="hljs-number">9</span>);
        c9.setCellStyle(headerStyle);
        c9.setCellValue(<span class="hljs-string">&quot;政治面貌&quot;</span>);
        HSSFCell c10 = r0.createCell(<span class="hljs-number">10</span>);
        c10.setCellStyle(headerStyle);
        c10.setCellValue(<span class="hljs-string">&quot;电话号码&quot;</span>);
        HSSFCell c11 = r0.createCell(<span class="hljs-number">11</span>);
        c11.setCellStyle(headerStyle);
        c11.setCellValue(<span class="hljs-string">&quot;联系地址&quot;</span>);
        HSSFCell c12 = r0.createCell(<span class="hljs-number">12</span>);
        c12.setCellStyle(headerStyle);
        c12.setCellValue(<span class="hljs-string">&quot;所属部门&quot;</span>);
        HSSFCell c13 = r0.createCell(<span class="hljs-number">13</span>);
        c13.setCellStyle(headerStyle);
        c13.setCellValue(<span class="hljs-string">&quot;职称&quot;</span>);
        HSSFCell c14 = r0.createCell(<span class="hljs-number">14</span>);
        c14.setCellStyle(headerStyle);
        c14.setCellValue(<span class="hljs-string">&quot;职位&quot;</span>);
        HSSFCell c15 = r0.createCell(<span class="hljs-number">15</span>);
        c15.setCellStyle(headerStyle);
        c15.setCellValue(<span class="hljs-string">&quot;聘用形式&quot;</span>);
        HSSFCell c16 = r0.createCell(<span class="hljs-number">16</span>);
        c16.setCellStyle(headerStyle);
        c16.setCellValue(<span class="hljs-string">&quot;最高学历&quot;</span>);
        HSSFCell c17 = r0.createCell(<span class="hljs-number">17</span>);
        c17.setCellStyle(headerStyle);
        c17.setCellValue(<span class="hljs-string">&quot;专业&quot;</span>);
        HSSFCell c18 = r0.createCell(<span class="hljs-number">18</span>);
        c18.setCellStyle(headerStyle);
        c18.setCellValue(<span class="hljs-string">&quot;毕业院校&quot;</span>);
        HSSFCell c19 = r0.createCell(<span class="hljs-number">19</span>);
        c19.setCellStyle(headerStyle);
        c19.setCellValue(<span class="hljs-string">&quot;入职日期&quot;</span>);
        HSSFCell c20 = r0.createCell(<span class="hljs-number">20</span>);
        c20.setCellStyle(headerStyle);
        c20.setCellValue(<span class="hljs-string">&quot;在职状态&quot;</span>);
        HSSFCell c21 = r0.createCell(<span class="hljs-number">21</span>);
        c21.setCellStyle(headerStyle);
        c21.setCellValue(<span class="hljs-string">&quot;邮箱&quot;</span>);
        HSSFCell c22 = r0.createCell(<span class="hljs-number">22</span>);
        c22.setCellStyle(headerStyle);
        c22.setCellValue(<span class="hljs-string">&quot;合同期限(年)&quot;</span>);
        HSSFCell c23 = r0.createCell(<span class="hljs-number">23</span>);
        c23.setCellStyle(headerStyle);
        c23.setCellValue(<span class="hljs-string">&quot;合同起始日期&quot;</span>);
        HSSFCell c24 = r0.createCell(<span class="hljs-number">24</span>);
        c24.setCellStyle(headerStyle);
        c24.setCellValue(<span class="hljs-string">&quot;合同终止日期&quot;</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; list.size(); i++) &#123;
            Employee emp = list.get(i);
            HSSFRow row = sheet.createRow(i + <span class="hljs-number">1</span>);
            row.createCell(<span class="hljs-number">0</span>).setCellValue(emp.getId());
            row.createCell(<span class="hljs-number">1</span>).setCellValue(emp.getName());
            row.createCell(<span class="hljs-number">2</span>).setCellValue(emp.getWorkID());
            row.createCell(<span class="hljs-number">3</span>).setCellValue(emp.getGender());
            HSSFCell cell4 = row.createCell(<span class="hljs-number">4</span>);
            cell4.setCellStyle(dateCellStyle);
            cell4.setCellValue(emp.getBirthday());
            row.createCell(<span class="hljs-number">5</span>).setCellValue(emp.getIdCard());
            row.createCell(<span class="hljs-number">6</span>).setCellValue(emp.getWedlock());
            row.createCell(<span class="hljs-number">7</span>).setCellValue(emp.getNation().getName());
            row.createCell(<span class="hljs-number">8</span>).setCellValue(emp.getNativePlace());
            row.createCell(<span class="hljs-number">9</span>).setCellValue(emp.getPoliticsstatus().getName());
            row.createCell(<span class="hljs-number">10</span>).setCellValue(emp.getPhone());
            row.createCell(<span class="hljs-number">11</span>).setCellValue(emp.getAddress());
            row.createCell(<span class="hljs-number">12</span>).setCellValue(emp.getDepartment().getName());
            row.createCell(<span class="hljs-number">13</span>).setCellValue(emp.getJobLevel().getName());
            row.createCell(<span class="hljs-number">14</span>).setCellValue(emp.getPosition().getName());
            row.createCell(<span class="hljs-number">15</span>).setCellValue(emp.getEngageForm());
            row.createCell(<span class="hljs-number">16</span>).setCellValue(emp.getTiptopDegree());
            row.createCell(<span class="hljs-number">17</span>).setCellValue(emp.getSpecialty());
            row.createCell(<span class="hljs-number">18</span>).setCellValue(emp.getSchool());
            HSSFCell cell19 = row.createCell(<span class="hljs-number">19</span>);
            cell19.setCellStyle(dateCellStyle);
            cell19.setCellValue(emp.getBeginDate());
            row.createCell(<span class="hljs-number">20</span>).setCellValue(emp.getWorkState());
            row.createCell(<span class="hljs-number">21</span>).setCellValue(emp.getEmail());
            row.createCell(<span class="hljs-number">22</span>).setCellValue(emp.getContractTerm());
            HSSFCell cell23 = row.createCell(<span class="hljs-number">23</span>);
            cell23.setCellStyle(dateCellStyle);
            cell23.setCellValue(emp.getBeginContract());
            HSSFCell cell24 = row.createCell(<span class="hljs-number">24</span>);
            cell24.setCellStyle(dateCellStyle);
            cell24.setCellValue(emp.getEndContract());
<span class="hljs-comment">/*            HSSFCell cell25 = row.createCell(25);</span>
<span class="hljs-comment">            cell25.setCellStyle(dateCellStyle);</span>
<span class="hljs-comment">            cell25.setCellValue(emp.getConversionTime());*/</span>
        &#125;

        ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();
        HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();
        <span class="hljs-keyword">try</span> &#123;
            headers.setContentDispositionFormData(<span class="hljs-string">&quot;attachment&quot;</span>, <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;员工表.xls&quot;</span>.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>), <span class="hljs-string">&quot;ISO-8859-1&quot;</span>));
            headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);
            workbook.write(baos);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125;

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;<span class="hljs-keyword">byte</span>[]&gt;(baos.toByteArray(), headers, HttpStatus.CREATED);

    &#125;

&#125;</code></pre></div>

<p><strong>前端在EmpBasic.vue填写方法</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;
export default &#123;
  methods: &#123;
		exportData() &#123;
 		 window.open(&#39;&#x2F;employee&#x2F;basic&#x2F;export&#39;, &#39;_parent&#39;);
		&#125;
  &#125;
&lt;&#x2F;script&gt;</code></pre></div>

<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>定义接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/import&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">importData</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    List&lt;Employee&gt; list = POIUtils.excel2Employee(file, nationService.getAllNations(), politicsstatusService.getAllPoliticsstatus(), departmentService.getAllDepartmentsWithOutChildren(), positionService.getAllPositions(), jobLevelService.getAllJobLevels());
    <span class="hljs-keyword">if</span> (employeeService.addEmps(list) == list.size()) &#123;
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;上传成功&quot;</span>);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;上传失败&quot;</span>);
&#125;</code></pre></div>

<p>后端添加工具类中的代码</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Excel 解析成员工数据集合</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Employee&gt; <span class="hljs-title">excel2Employee</span><span class="hljs-params">(MultipartFile file, List&lt;Nation&gt; allNations, List&lt;Politicsstatus&gt; allPoliticsstatus, List&lt;Department&gt; allDepartments, List&lt;Position&gt; allPositions, List&lt;JobLevel&gt; allJobLevels)</span> </span>&#123;
    List&lt;Employee&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    Employee employee = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-comment">//1. 创建一个 workbook 对象</span>
        HSSFWorkbook workbook = <span class="hljs-keyword">new</span> HSSFWorkbook(file.getInputStream());
        <span class="hljs-comment">//2. 获取 workbook 中表单的数量</span>
        <span class="hljs-keyword">int</span> numberOfSheets = workbook.getNumberOfSheets();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numberOfSheets; i++) &#123;
            <span class="hljs-comment">//3. 获取表单</span>
            HSSFSheet sheet = workbook.getSheetAt(i);
            <span class="hljs-comment">//4. 获取表单中的行数</span>
            <span class="hljs-keyword">int</span> physicalNumberOfRows = sheet.getPhysicalNumberOfRows();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; physicalNumberOfRows; j++) &#123;
                <span class="hljs-comment">//5. 跳过标题行</span>
                <span class="hljs-keyword">if</span> (j == <span class="hljs-number">0</span>) &#123;
                    <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//跳过标题行</span>
                &#125;
                <span class="hljs-comment">//6. 获取行</span>
                HSSFRow row = sheet.getRow(j);
                <span class="hljs-keyword">if</span> (row == <span class="hljs-keyword">null</span>) &#123;
                    <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//防止数据中间有空行</span>
                &#125;
                <span class="hljs-comment">//7. 获取列数</span>
                <span class="hljs-keyword">int</span> physicalNumberOfCells = row.getPhysicalNumberOfCells();
                employee = <span class="hljs-keyword">new</span> Employee();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; physicalNumberOfCells; k++) &#123;
                    HSSFCell cell = row.getCell(k);
                    <span class="hljs-keyword">if</span> (cell.getCellType() == CellType.STRING) &#123;
                        String cellValue = cell.getStringCellValue();
                        <span class="hljs-keyword">switch</span> (k) &#123;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                                employee.setName(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                                employee.setWorkID(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                                employee.setGender(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
                                employee.setIdCard(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
                                employee.setWedlock(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
                                <span class="hljs-keyword">int</span> nationIndex = allNations.indexOf(<span class="hljs-keyword">new</span> Nation(cellValue));
                                employee.setNationId(allNations.get(nationIndex).getId());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
                                employee.setNativePlace(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
                                <span class="hljs-keyword">int</span> politicstatusIndex = allPoliticsstatus.indexOf(<span class="hljs-keyword">new</span> Politicsstatus(cellValue));
                                employee.setPoliticId(allPoliticsstatus.get(politicstatusIndex).getId());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
                                employee.setPhone(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:
                                employee.setAddress(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
                                <span class="hljs-keyword">int</span> departmentIndex = allDepartments.indexOf(<span class="hljs-keyword">new</span> Department(cellValue));
                                employee.setDepartmentId(allDepartments.get(departmentIndex).getId());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:
                                <span class="hljs-keyword">int</span> jobLevelIndex = allJobLevels.indexOf(<span class="hljs-keyword">new</span> JobLevel(cellValue));
                                employee.setJobLevelId(allJobLevels.get(jobLevelIndex).getId());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">14</span>:
                                <span class="hljs-keyword">int</span> positionIndex = allPositions.indexOf(<span class="hljs-keyword">new</span> Position(cellValue));
                                employee.setPosId(allPositions.get(positionIndex).getId());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">15</span>:
                                employee.setEngageForm(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:
                                employee.setTiptopDegree(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">17</span>:
                                employee.setSpecialty(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">18</span>:
                                employee.setSchool(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">20</span>:
                                employee.setWorkState(cellValue);
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">21</span>:
                                employee.setEmail(cellValue);
                                <span class="hljs-keyword">break</span>;
                        &#125;
                    &#125; <span class="hljs-keyword">else</span> &#123;
                        <span class="hljs-keyword">switch</span> (k) &#123;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
                                employee.setBirthday(cell.getDateCellValue());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">19</span>:
                                employee.setBeginDate(cell.getDateCellValue());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">23</span>:
                                employee.setBeginContract(cell.getDateCellValue());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">24</span>:
                                employee.setEndContract(cell.getDateCellValue());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">22</span>:
                                employee.setContractTerm(cell.getNumericCellValue());
                                <span class="hljs-keyword">break</span>;
                            <span class="hljs-keyword">case</span> <span class="hljs-number">25</span>:
                                employee.setConversionTime(cell.getDateCellValue());
                                <span class="hljs-keyword">break</span>;
                        &#125;
                    &#125;
                &#125;
                list.add(employee);
            &#125;
        &#125;

    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
        e.printStackTrace();
    &#125;
    <span class="hljs-keyword">return</span> list;
&#125;</code></pre></div>

<p>注意：在<code>new Nation(cellValue)</code>里判断<code>nationIndex</code>的时候，重写hashcode和equals，同理于<code>Politicsstatus、Department、JobLevel、Position</code></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//只用name来判断，不使用id（按理来说应该id和name都一致）</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;
    <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span> || getClass() != o.getClass()) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;
    Nation nation = (Nation) o;
    <span class="hljs-keyword">return</span> Objects.equals(name, nation.name);
&#125;

<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> Objects.hash(name);
&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmps</span><span class="hljs-params">(List&lt;Employee&gt; list)</span> </span>&#123;
    <span class="hljs-keyword">return</span> employeeMapper.addEmps(list);
&#125;</code></pre></div>

<p>Mapper代码可以参考插入</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmps&quot;</span>&gt;</span>
  insert into employee (name, gender,
  birthday, idCard, wedlock, nationId,
  nativePlace, politicId, email,
  phone, address, departmentId,
  jobLevelId, posId, engageForm,
  tiptopDegree, specialty, school,
  beginDate, workState, workID,
  contractTerm, conversionTime, notWorkDate,
  beginContract, endContract, workAge
  )
  values
  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;emp&quot;</span>&gt;</span>
    (#&#123;emp.name,jdbcType=VARCHAR&#125;, #&#123;emp.gender,jdbcType=CHAR&#125;,
    #&#123;emp.birthday,jdbcType=DATE&#125;, #&#123;emp.idCard,jdbcType=CHAR&#125;, #&#123;emp.wedlock,jdbcType=CHAR&#125;,
    #&#123;emp.nationId,jdbcType=INTEGER&#125;,
    #&#123;emp.nativePlace,jdbcType=VARCHAR&#125;, #&#123;emp.politicId,jdbcType=INTEGER&#125;, #&#123;emp.email,jdbcType=VARCHAR&#125;,
    #&#123;emp.phone,jdbcType=VARCHAR&#125;, #&#123;emp.address,jdbcType=VARCHAR&#125;, #&#123;emp.departmentId,jdbcType=INTEGER&#125;,
    #&#123;emp.jobLevelId,jdbcType=INTEGER&#125;, #&#123;emp.posId,jdbcType=INTEGER&#125;, #&#123;emp.engageForm,jdbcType=VARCHAR&#125;,
    #&#123;emp.tiptopDegree,jdbcType=CHAR&#125;, #&#123;emp.specialty,jdbcType=VARCHAR&#125;, #&#123;emp.school,jdbcType=VARCHAR&#125;,
    #&#123;emp.beginDate,jdbcType=DATE&#125;, #&#123;emp.workState,jdbcType=CHAR&#125;, #&#123;emp.workID,jdbcType=CHAR&#125;,
    #&#123;emp.contractTerm,jdbcType=DOUBLE&#125;, #&#123;emp.conversionTime,jdbcType=DATE&#125;, #&#123;emp.notWorkDate,jdbcType=DATE&#125;,
    #&#123;emp.beginContract,jdbcType=DATE&#125;, #&#123;emp.endContract,jdbcType=DATE&#125;, #&#123;emp.workAge,jdbcType=INTEGER&#125;
    )
  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<h3 id="高级搜索"><a href="#高级搜索" class="headerlink" title="高级搜索"></a>高级搜索</h3><h4 id="后端部分-5"><a href="#后端部分-5" class="headerlink" title="后端部分"></a>后端部分</h4><p>针对搜索接口优化，不再简单使用关键词搜索，加入employee，beginDateScope等高级搜索需要用到的信息</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(defaultValue = &quot;1&quot;)</span>Integer page, <span class="hljs-meta">@RequestParam(defaultValue = &quot;10&quot;)</span>Integer size, Employee employee, Date[] beginDateScope)</span></span>&#123;
    <span class="hljs-keyword">return</span> employeeService.getEmployeeByPage(page, size, employee, beginDateScope);
&#125;</code></pre></div>

<p>这里需要注意的是，Date需要转换器才能直接传入，在converter包下定义日期转换器</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Date</span>&gt; </span>&#123;
    SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> sdf.parse(source);
        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;
&#125;</code></pre></div>

<p>Service优化</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPage</span><span class="hljs-params">(Integer page, Integer size,  Employee employee, Date[] beginDateScope)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (page != <span class="hljs-keyword">null</span> &amp;&amp; size != <span class="hljs-keyword">null</span>) &#123;
        page = (page - <span class="hljs-number">1</span>) * size;
    &#125;
    List&lt;Employee&gt; data = employeeMapper.getEmployeeByPage(page, size, employee, beginDateScope);
    Long total = employeeMapper.getTotal(employee, beginDateScope);
    RespPageBean bean = <span class="hljs-keyword">new</span> RespPageBean();
    bean.setData(data);
    bean.setTotal(total);
    <span class="hljs-keyword">return</span> bean;
&#125;</code></pre></div>

<p>加入Mapper</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeByPage&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;AllEmployeeInfo&quot;</span>&gt;</span>
  select e.*,p.`id` as pid,p.`name` as pname,n.`id` as nid,n.`name` as nname,d.`id` as did,d.`name` as
  dname,j.`id` as jid,j.`name` as jname,pos.`id` as posid,pos.`name` as posname from employee e,nation
  n,politicsstatus p,department d,joblevel j,position pos where e.`nationId`=n.`id` and e.`politicId`=p.`id` and
  e.`departmentId`=d.`id` and e.`jobLevelId`=j.`id` and e.`posId`=pos.`id`
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.name !=null and emp.name!=&#x27;&#x27;&quot;</span>&gt;</span>
    and e.name like concat(&#x27;%&#x27;,#&#123;emp.name&#125;,&#x27;%&#x27;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.politicId !=null&quot;</span>&gt;</span>
    and e.politicId =#&#123;emp.politicId&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.nationId !=null&quot;</span>&gt;</span>
    and e.nationId =#&#123;emp.nationId&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.departmentId !=null&quot;</span>&gt;</span>
    and e.departmentId =#&#123;emp.departmentId&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.jobLevelId !=null&quot;</span>&gt;</span>
    and e.jobLevelId =#&#123;emp.jobLevelId&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.engageForm !=null and emp.engageForm!=&#x27;&#x27;&quot;</span>&gt;</span>
    and e.engageForm =#&#123;emp.engageForm&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.posId !=null&quot;</span>&gt;</span>
    and e.posId =#&#123;emp.posId&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginDateScope !=null&quot;</span>&gt;</span>
    and e.beginDate between #&#123;beginDateScope[0]&#125; and #&#123;beginDateScope[1]&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;page !=null and size!=null&quot;</span>&gt;</span>
    limit #&#123;page&#125;,#&#123;size&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTotal&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span>&gt;</span>
    select count(*) from employee e
    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp!=null&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.name !=null and emp.name!=&#x27;&#x27;&quot;</span>&gt;</span>
          and e.name like concat(&#x27;%&#x27;,#&#123;emp.name&#125;,&#x27;%&#x27;)
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.politicId !=null&quot;</span>&gt;</span>
          and e.politicId =#&#123;emp.politicId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.nationId !=null&quot;</span>&gt;</span>
          and e.nationId =#&#123;emp.nationId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.jobLevelId !=null&quot;</span>&gt;</span>
          and e.jobLevelId =#&#123;emp.jobLevelId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.departmentId !=null&quot;</span>&gt;</span>
          and e.departmentId =#&#123;emp.departmentId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.engageForm !=null and emp.engageForm!=&#x27;&#x27;&quot;</span>&gt;</span>
          and e.engageForm =#&#123;emp.engageForm&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;emp.posId !=null&quot;</span>&gt;</span>
          and e.posId =#&#123;emp.posId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginDateScope !=null&quot;</span>&gt;</span>
        and e.beginDate between #&#123;beginDateScope[0]&#125; and #&#123;beginDateScope[1]&#125;
      <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h4 id="前端部分-5"><a href="#前端部分-5" class="headerlink" title="前端部分"></a>前端部分</h4><p>在原代码上继续进行添加，加入高级搜索框的编写：</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;transition name&#x3D;&quot;slide-fade&quot;&gt;
&lt;div v-show&#x3D;&quot;showAdvanceSearchView&quot;
    style&#x3D;&quot;border: 1px solid #409eff;border-radius: 5px;box-sizing: border-box;padding: 5px;margin: 10px 0px;&quot;&gt;
  &lt;el-row&gt;
    &lt;el-col :span&#x3D;&quot;5&quot;&gt;
      政治面貌:
      &lt;el-select v-model&#x3D;&quot;searchValue.politicId&quot; placeholder&#x3D;&quot;政治面貌&quot; size&#x3D;&quot;mini&quot;
                 style&#x3D;&quot;width: 130px;&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in politicsstatus&quot;
            :key&#x3D;&quot;item.id&quot;
            :label&#x3D;&quot;item.name&quot;
            :value&#x3D;&quot;item.id&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;4&quot;&gt;
      民族:
      &lt;el-select v-model&#x3D;&quot;searchValue.nationId&quot; placeholder&#x3D;&quot;民族&quot; size&#x3D;&quot;mini&quot;
                 style&#x3D;&quot;width: 130px;&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in nations&quot;
            :key&#x3D;&quot;item.id&quot;
            :label&#x3D;&quot;item.name&quot;
            :value&#x3D;&quot;item.id&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;4&quot;&gt;
      职位:
      &lt;el-select v-model&#x3D;&quot;searchValue.posId&quot; placeholder&#x3D;&quot;职位&quot; size&#x3D;&quot;mini&quot; style&#x3D;&quot;width: 130px;&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in positions&quot;
            :key&#x3D;&quot;item.id&quot;
            :label&#x3D;&quot;item.name&quot;
            :value&#x3D;&quot;item.id&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;4&quot;&gt;
      职称:
      &lt;el-select v-model&#x3D;&quot;searchValue.jobLevelId&quot; placeholder&#x3D;&quot;职称&quot; size&#x3D;&quot;mini&quot;
                 style&#x3D;&quot;width: 130px;&quot;&gt;
        &lt;el-option
            v-for&#x3D;&quot;item in joblevels&quot;
            :key&#x3D;&quot;item.id&quot;
            :label&#x3D;&quot;item.name&quot;
            :value&#x3D;&quot;item.id&quot;&gt;
        &lt;&#x2F;el-option&gt;
      &lt;&#x2F;el-select&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;7&quot;&gt;
      聘用形式:
      &lt;el-radio-group v-model&#x3D;&quot;searchValue.engageForm&quot;&gt;
        &lt;el-radio label&#x3D;&quot;劳动合同&quot;&gt;劳动合同&lt;&#x2F;el-radio&gt;
        &lt;el-radio label&#x3D;&quot;劳务合同&quot;&gt;劳务合同&lt;&#x2F;el-radio&gt;
      &lt;&#x2F;el-radio-group&gt;
    &lt;&#x2F;el-col&gt;
  &lt;&#x2F;el-row&gt;

  &lt;el-row style&#x3D;&quot;margin-top: 10px&quot;&gt;
    &lt;el-col :span&#x3D;&quot;5&quot;&gt;
      所属部门:
      &lt;el-popover
          placement&#x3D;&quot;right&quot;
          title&#x3D;&quot;请选择部门&quot;
          width&#x3D;&quot;200&quot;
          trigger&#x3D;&quot;manual&quot;
          v-model&#x3D;&quot;popVisible&quot;&gt;
        &lt;el-tree default-expand-all :data&#x3D;&quot;allDeps&quot; :props&#x3D;&quot;defaultProps&quot;
                 @node-click&#x3D;&quot;searvhViewHandleNodeClick&quot;&gt;&lt;&#x2F;el-tree&gt;
        &lt;div slot&#x3D;&quot;reference&quot;
             style&#x3D;&quot;width: 130px;display: inline-flex;font-size: 13px;border: 1px solid #dedede;height: 26px;border-radius: 5px;cursor: pointer;align-items: center;padding-left: 8px;box-sizing: border-box;margin-left: 3px&quot;
             @click&#x3D;&quot;showDepView&quot;&gt;&#123;&#123;inputDepName&#125;&#125;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;el-popover&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;10&quot;&gt;
      入职日期:
      &lt;el-date-picker
          v-model&#x3D;&quot;searchValue.beginDateScope&quot;
          type&#x3D;&quot;daterange&quot;
          size&#x3D;&quot;mini&quot;
          unlink-panels
          value-format&#x3D;&quot;yyyy-MM-dd&quot;
          range-separator&#x3D;&quot;至&quot;
          start-placeholder&#x3D;&quot;开始日期&quot;
          end-placeholder&#x3D;&quot;结束日期&quot;&gt;
      &lt;&#x2F;el-date-picker&gt;
    &lt;&#x2F;el-col&gt;
    &lt;el-col :span&#x3D;&quot;5&quot; :offset&#x3D;&quot;4&quot;&gt;
      &lt;el-button size&#x3D;&quot;mini&quot; @click&#x3D;&quot;showAdvanceSearchView &#x3D; !showAdvanceSearchView&quot;&gt;取消&lt;&#x2F;el-button&gt;
      &lt;el-button size&#x3D;&quot;mini&quot; icon&#x3D;&quot;el-icon-search&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;initEmps(&#39;advanced&#39;)&quot;&gt;搜索&lt;&#x2F;el-button&gt;
      &lt;el-button size&#x3D;&quot;mini&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;resetForm&quot;&gt;重置&lt;&#x2F;el-button&gt;
    &lt;&#x2F;el-col&gt;
  &lt;&#x2F;el-row&gt;


&lt;&#x2F;div&gt;
&lt;&#x2F;transition&gt;

&lt;script&gt;
  methods: &#123;
    searvhViewHandleNodeClick(data) &#123;
      this.inputDepName &#x3D; data.name;
      this.searchValue.departmentId &#x3D; data.id;
      this.popVisible &#x3D; !this.popVisible;
    &#125;,
&#125;
&lt;&#x2F;script&gt;</code></pre></div>

<p>更多细节的代码见github中的源代码</p>
<h2 id="模块化改造"><a href="#模块化改造" class="headerlink" title="模块化改造"></a>模块化改造</h2><p>为了方便以后的业务需求，针对原项目进行改造，变成</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210630211157577.png" srcset="/img/loading.gif" lazyload alt="image-20210630211157577"></p>
<p>server里存的是目前为止的业务代码，以后会添加邮件模块，和server区分，具体的代码划分见<a target="_blank" rel="noopener" href="https://github.com/Lucifer2u/xm-luciferpro">代码</a></p>
<h2 id="邮件服务"><a href="#邮件服务" class="headerlink" title="邮件服务"></a>邮件服务</h2><p>引入RabbitMQ后启动</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210702154401698.png" srcset="/img/loading.gif" lazyload alt="image-20210702154401698"></p>
<p>新建模块</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210702160148393.png" srcset="/img/loading.gif" lazyload alt="image-20210702160148393"></p>
<p>引入依赖</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.lucifer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>luciferpro-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.amqp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-rabbit-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8082</span>

<span class="hljs-comment">#邮件相关</span>
<span class="hljs-meta">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span>
<span class="hljs-meta">spring.mail.protocol</span>=<span class="hljs-string">smtp</span>
<span class="hljs-meta">spring.mail.default-encoding</span>=<span class="hljs-string">UTF-8</span>
<span class="hljs-meta">spring.mail.password</span>=<span class="hljs-string">cxpuqalzrctubdib</span>
<span class="hljs-meta">spring.mail.username</span>=<span class="hljs-string">xiaoweliang@qq.com</span>
<span class="hljs-meta">spring.mail.port</span>=<span class="hljs-string">587</span>
<span class="hljs-meta">spring.mail.properties.mail.stmp.socketFactory.class</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span>
<span class="hljs-meta">spring.mail.properties.mail.debug</span>=<span class="hljs-string">true</span>

<span class="hljs-comment">#消息中间价</span>
<span class="hljs-meta">spring.rabbitmq.username</span>=<span class="hljs-string">guest</span>
<span class="hljs-meta">spring.rabbitmq.password</span>=<span class="hljs-string">guest</span>
<span class="hljs-meta">spring.rabbitmq.host</span>=<span class="hljs-string">172.16.211.4</span>
<span class="hljs-meta">spring.rabbitmq.port</span>=<span class="hljs-string">5672</span></code></pre></div>

<p>给员工发送邮件，所以需要序列化</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span></code></pre></div>

<p>它里面包含的对象，同样也需要序列化</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Nation nation;
<span class="hljs-keyword">private</span> Politicsstatus politicsstatus;
<span class="hljs-keyword">private</span> Department department;
<span class="hljs-keyword">private</span> JobLevel jobLevel;
<span class="hljs-keyword">private</span> Position position;</code></pre></div>

<h3 id="建立模版"><a href="#建立模版" class="headerlink" title="建立模版"></a>建立模版</h3><p>在<code>templates</code>下建立模版</p>
<div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>入职欢迎邮件<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

欢迎 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> 加入 Shelby 大家庭，您的入职信息如下：
<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>职位<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;posName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>职称<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;joblevelName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>部门<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;departmentName&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<h3 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h3><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;


<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailserverApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(MailserverApplication.class, args);
    &#125;
    <span class="hljs-comment">//引入的队列是rabbitmq的</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(<span class="hljs-string">&quot;lucifer.mail.welcome&quot;</span>);
    &#125;
&#125;</code></pre></div>

<h3 id="消息接收"><a href="#消息接收" class="headerlink" title="消息接收"></a>消息接收</h3><p>这里用到的包有很多重名的情况，需要注意</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.lucifer.mailserver.receiver;

<span class="hljs-keyword">import</span> org.lucifer.vbluciferpro.model.Employee;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.mail.MailProperties;
<span class="hljs-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hljs-keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.thymeleaf.TemplateEngine;
<span class="hljs-keyword">import</span> org.thymeleaf.context.Context;

<span class="hljs-keyword">import</span> javax.mail.MessagingException;
<span class="hljs-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailReceiver</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(MailReceiver.class);
    
    <span class="hljs-meta">@Autowired</span>
    JavaMailSender javaMailSender;
    <span class="hljs-meta">@Autowired</span>
    MailProperties mailProperties;
    <span class="hljs-meta">@Autowired</span>
    TemplateEngine templateEngine;

    <span class="hljs-meta">@RabbitListener(queues =  &quot;lucifer.mail.welcome&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(Employee employee)</span></span>&#123;
        <span class="hljs-comment">//收到消息，发送邮件</span>
        MimeMessage msg = javaMailSender.createMimeMessage();
        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(msg);
        <span class="hljs-keyword">try</span> &#123;
            helper.setTo(employee.getEmail());
            helper.setFrom(mailProperties.getUsername());
            helper.setSubject(<span class="hljs-string">&quot;入职欢迎!&quot;</span>);
            helper.setSentDate(<span class="hljs-keyword">new</span> Date());
            Context context = <span class="hljs-keyword">new</span> Context();
            context.setVariable(<span class="hljs-string">&quot;name&quot;</span>, employee.getName());
            context.setVariable(<span class="hljs-string">&quot;posName&quot;</span>, employee.getPosition().getName());
            context.setVariable(<span class="hljs-string">&quot;joblevelName&quot;</span>, employee.getJobLevel().getName());
            context.setVariable(<span class="hljs-string">&quot;departmentName&quot;</span>, employee.getDepartment().getName());
            <span class="hljs-comment">//对应mail.html</span>
            String mail = templateEngine.process(<span class="hljs-string">&quot;mail&quot;</span>, context);
            helper.setText(mail, <span class="hljs-keyword">true</span>);
            javaMailSender.send(msg);

        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;
            e.printStackTrace();
            <span class="hljs-comment">//发送失败，返回日志</span>
            logger.error(<span class="hljs-string">&quot;邮件发送失败：&quot;</span> + e.getMessage());
        &#125;
    &#125;
&#125;</code></pre></div>

<h3 id="发送执行"><a href="#发送执行" class="headerlink" title="发送执行"></a>发送执行</h3><p>在Service模块中需要用到rabbitmq，所以引入依赖</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>同时web需要连上rabbitmq，所以需要加上配置</p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#消息中间价</span>
<span class="hljs-meta">spring.rabbitmq.username</span>=<span class="hljs-string">guest</span>
<span class="hljs-meta">spring.rabbitmq.password</span>=<span class="hljs-string">guest</span>
<span class="hljs-meta">spring.rabbitmq.host</span>=<span class="hljs-string">172.16.211.4</span>
<span class="hljs-meta">spring.rabbitmq.port</span>=<span class="hljs-string">5672</span></code></pre></div>

<p><strong>Service层</strong>执行具体的操作</p>
<p>在添加的时候还没有id，想要拿到id，必须主键回填</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;
	Employee emp = employeeMapper.getEmployeeById(employee.getId());
&#125;</code></pre></div>

<p>首先在<code>EmployeeMapper</code>中针对<code>int insertSelective(Employee record);</code></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertSelective&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Employee&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span></code></pre></div>

<p>让id能主键回填，这样在Service就能拿到id了</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);</code></pre></div>

<p><strong>最终Service代码</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;

    Date beginContract = employee.getBeginContract();
    Date endContract = employee.getEndContract();
    <span class="hljs-keyword">double</span> month = (Double.parseDouble(yearFormat.format(endContract)) - Double.parseDouble(yearFormat.format(beginContract))) * <span class="hljs-number">12</span>
            + (Double.parseDouble(monthFormat.format(endContract)) - Double.parseDouble(monthFormat.format(beginContract)));
    employee.setContractTerm(Double.parseDouble(decimalFormat.format(month / <span class="hljs-number">12</span>)));
    <span class="hljs-comment">//邮件发送</span>
    <span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);
    <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;
        Employee emp = employeeMapper.getEmployeeById(employee.getId());
        rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;lucifer.mail.welcome&quot;</span>, emp);
    &#125;
        <span class="hljs-keyword">return</span> result;
&#125;</code></pre></div>

<p>相应的Mapper</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;AllEmployeeInfo&quot;</span>&gt;</span>
  select e.*,p.`id` as pid,p.`name` as pname,n.`id` as nid,n.`name` as nname,d.`id` as did,d.`name` as
  dname,j.`id` as jid,j.`name` as jname,pos.`id` as posid,pos.`name` as posname
  from employee e,nation n,politicsstatus p,department d,joblevel j,position pos
  where e.`nationId`=n.`id` and e.`politicId`=p.`id` and
    e.`departmentId`=d.`id` and e.`jobLevelId`=j.`id` and e.`posId`=pos.`id` and e.`id`=#&#123;id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h2 id="薪资管理"><a href="#薪资管理" class="headerlink" title="薪资管理"></a>薪资管理</h2><h3 id="工资套账管理"><a href="#工资套账管理" class="headerlink" title="工资套账管理"></a>工资套账管理</h3><h4 id="后端部分-6"><a href="#后端部分-6" class="headerlink" title="后端部分"></a>后端部分</h4><p>接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/salary/sob&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SalaryController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    SalaryService salaryService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> salaryService.getAllSalaries();
    &#125;

    <span class="hljs-meta">@PostMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addSalary</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Salary salary)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (salaryService.addSalary(salary) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;添加成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;添加失败!&quot;</span>);
    &#125;

    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">deleteSalaryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (salaryService.deleteSalaryById(id) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;删除成功！&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;删除失败！&quot;</span>);
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateSalaryById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Salary salary)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (salaryService.updateSalaryById(salary) == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
    &#125;

&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SalaryService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    SalaryMapper salaryMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> salaryMapper.getAllSalaries();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addSalary</span><span class="hljs-params">(Salary salary)</span> </span>&#123;
        salary.setCreateDate(<span class="hljs-keyword">new</span> Date());
        <span class="hljs-keyword">return</span> salaryMapper.insertSelective(salary);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">deleteSalaryById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> salaryMapper.deleteByPrimaryKey(id);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateSalaryById</span><span class="hljs-params">(Salary salary)</span> </span>&#123;
        <span class="hljs-keyword">return</span> salaryMapper.updateByPrimaryKeySelective(salary);
    &#125;

&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllSalaries&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  select
  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>/&gt;</span>
  from salary
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h4 id="前端部分-6"><a href="#前端部分-6" class="headerlink" title="前端部分"></a>前端部分</h4><p><strong>SalSob.vue</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div&gt;

    &lt;div style&#x3D;&quot;display: flex;justify-content: space-between&quot;&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-plus&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;showAddSalaryView&quot;&gt;添加工资账套&lt;&#x2F;el-button&gt;
      &lt;el-button icon&#x3D;&quot;el-icon-refresh&quot; type&#x3D;&quot;success&quot; @click&#x3D;&quot;initSalaries&quot;&gt;刷新&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;

    &lt;div style&#x3D;&quot;margin-top: 10px&quot;&gt;
      &lt;el-table :data&#x3D;&quot;salaries&quot; border stripe&gt;
        &lt;el-table-column type&#x3D;&quot;selection&quot; width&#x3D;&quot;55&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;120&quot; prop&#x3D;&quot;name&quot; label&#x3D;&quot;账套名称&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;basicSalary&quot; label&#x3D;&quot;基本工资&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;trafficSalary&quot; label&#x3D;&quot;交通补助&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;lunchSalary&quot; label&#x3D;&quot;午餐补助&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;bonus&quot; label&#x3D;&quot;奖金&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column width&#x3D;&quot;100&quot; prop&#x3D;&quot;createDate&quot; label&#x3D;&quot;启用时间&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;el-table-column label&#x3D;&quot;养老金&quot; align&#x3D;&quot;center&quot;&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;pensionPer&quot; label&#x3D;&quot;比率&quot;&gt;&lt;&#x2F;el-table-column&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;pensionBase&quot; label&#x3D;&quot;基数&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column label&#x3D;&quot;医疗保险&quot; align&#x3D;&quot;center&quot;&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;medicalPer&quot; label&#x3D;&quot;比率&quot;&gt;&lt;&#x2F;el-table-column&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;medicalBase&quot; label&#x3D;&quot;基数&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column label&#x3D;&quot;公积金&quot; align&#x3D;&quot;center&quot;&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;accumulationFundPer&quot; label&#x3D;&quot;比率&quot;&gt;&lt;&#x2F;el-table-column&gt;
          &lt;el-table-column width&#x3D;&quot;70&quot; prop&#x3D;&quot;accumulationFundBase&quot; label&#x3D;&quot;基数&quot;&gt;&lt;&#x2F;el-table-column&gt;
        &lt;&#x2F;el-table-column&gt;
        &lt;el-table-column label&#x3D;&quot;操作&quot;&gt;
          &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
            &lt;el-button @click&#x3D;&quot;showEditSalaryView(scope.row)&quot;&gt;编辑&lt;&#x2F;el-button&gt;
            &lt;el-button type&#x3D;&quot;danger&quot; @click&#x3D;&quot;deleteSalary(scope.row)&quot;&gt;删除&lt;&#x2F;el-button&gt;
          &lt;&#x2F;template&gt;
        &lt;&#x2F;el-table-column&gt;
      &lt;&#x2F;el-table&gt;
    &lt;&#x2F;div&gt;

    &lt;el-dialog
        :title&#x3D;&quot;dialogTitle&quot;
        :visible.sync&#x3D;&quot;dialogVisible&quot;
        width&#x3D;&quot;50%&quot;&gt;
      &lt;div style&#x3D;&quot;display: flex;justify-content: space-around;align-items: center&quot;&gt;
        &lt;el-steps direction&#x3D;&quot;vertical&quot; :active&#x3D;&quot;activeItemIndex&quot;&gt;
          &lt;el-step :title&#x3D;&quot;itemName&quot; v-for&#x3D;&quot;(itemName,index) in salaryItemName&quot; :key&#x3D;&quot;index&quot;&gt;&lt;&#x2F;el-step&gt;
        &lt;&#x2F;el-steps&gt;
        &lt;el-input v-model&#x3D;&quot;salary[title]&quot; :placeholder&#x3D;&quot;&#39;请输入&#39;+salaryItemName[index]+&#39;...&#39;&quot;
                  v-for&#x3D;&quot;(value,title,index) in salary&quot;
                  :key&#x3D;&quot;index&quot; v-show&#x3D;&quot;activeItemIndex&#x3D;&#x3D;index&quot; style&#x3D;&quot;width: 200px&quot;&gt;
        &lt;&#x2F;el-input&gt;
      &lt;&#x2F;div&gt;
      &lt;span slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
      &lt;el-button @click&#x3D;&quot;cancel&quot;&gt;&#123;&#123;&#39;取消&#39;&#125;&#125;&lt;&#x2F;el-button&gt;
    &lt;el-button @click&#x3D;&quot;preStep&quot;&gt;&#123;&#123;&#39;上一步&#39;&#125;&#125;&lt;&#x2F;el-button&gt;
    &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;nextStep&quot;&gt;&#123;&#123;activeItemIndex&#x3D;&#x3D;10?&#39;完成&#39;:&#39;下一步&#39;&#125;&#125;&lt;&#x2F;el-button&gt;
  &lt;&#x2F;span&gt;
    &lt;&#x2F;el-dialog&gt;


  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &quot;SalSob&quot;,
  data() &#123;
    return &#123;
      dialogVisible: false,
      dialogTitle: &#39;添加工资账套&#39;,
      salaries: [],
      activeItemIndex: 0,
      salaryItemName: [
        &#39;基本工资&#39;,
        &#39;交通补助&#39;,
        &#39;午餐补助&#39;,
        &#39;奖金&#39;,
        &#39;养老金比率&#39;,
        &#39;养老金基数&#39;,
        &#39;医疗保险比率&#39;,
        &#39;医疗保险基数&#39;,
        &#39;公积金比率&#39;,
        &#39;公积金基数&#39;,
        &#39;账套名称&#39;
      ],
      salary: &#123;
        basicSalary: 0,
        trafficSalary: 0,
        lunchSalary: 0,
        bonus: 0,
        pensionPer: 0,
        pensionBase: 0,
        medicalPer: 0,
        medicalBase: 0,
        accumulationFundPer: 0,
        accumulationFundBase: 0,
        name: &#39;&#39;
      &#125;
    &#125;
  &#125;,
  mounted() &#123;
    this.initSalaries();
  &#125;,

  methods: &#123;
    initSalaries() &#123;
      this.getRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;).then(resp &#x3D;&gt; &#123;
        if (resp) &#123;
          this.salaries &#x3D; resp;
        &#125;
      &#125;)
    &#125;,
    showAddSalaryView() &#123;
      &#x2F;&#x2F;数据初始化
      this.salary &#x3D; &#123;
        basicSalary: &#39;&#39;,
        trafficSalary: &#39;&#39;,
        lunchSalary:  &#39;&#39;,
        bonus:  &#39;&#39;,
        pensionPer:  &#39;&#39;,
        pensionBase:  &#39;&#39;,
        medicalPer:  &#39;&#39;,
        medicalBase:  &#39;&#39;,
        accumulationFundPer:  &#39;&#39;,
        accumulationFundBase:  &#39;&#39;,
        name: &#39;&#39;
      &#125;
      this.dialogTitle &#x3D; &#39;添加工资账套&#39;;
      this.activeItemIndex &#x3D; 0;
      this.dialogVisible &#x3D; true;
    &#125;,
    nextStep() &#123;
      if (this.activeItemIndex &#x3D;&#x3D; 10) &#123;
        &#x2F;&#x2F;id存在是更新操作，否则是添加操作
        if (this.salary.id) &#123;
          this.putRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;, this.salary).then(resp&#x3D;&gt;&#123;
            if (resp) &#123;
              this.initSalaries();
              this.dialogVisible &#x3D; false;
            &#125;
          &#125;)
        &#125; else &#123;
          this.postRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot;, this.salary).then(resp &#x3D;&gt; &#123;
            if (resp) &#123;
              this.initSalaries();
              this.dialogVisible &#x3D; false;
            &#125;
          &#125;);
        &#125;
        return;
      &#125;
      this.activeItemIndex++;
    &#125;,
    cancel() &#123;
      &#x2F;&#x2F;关闭对话框
      this.dialogVisible &#x3D; false;
      return;
    &#125;,

    preStep() &#123;
      if (this.activeItemIndex &#x3D;&#x3D; 0) &#123;
        return;
      &#125;
      this.activeItemIndex--;
    &#125;,

    deleteSalary(data) &#123;
      this.$confirm(&#39;此操作将删除 &#39; + data.name + &#39; 账套，是否继续？&#39;, &#39;提示&#39;, &#123;
        cancelButtonText: &#39;取消&#39;,
        confirmButtonText: &#39;确定&#39;
      &#125;).then(() &#x3D;&gt; &#123;
        this.deleteRequest(&quot;&#x2F;salary&#x2F;sob&#x2F;&quot; + data.id).then(resp &#x3D;&gt; &#123;
          if (resp) &#123;
            this.initSalaries();
          &#125;
        &#125;)
      &#125;).catch(() &#x3D;&gt; &#123;
        this.$message.info(&quot;取消删除!&quot;);
      &#125;)
    &#125;,

    showEditSalaryView(data) &#123;
      this.dialogTitle &#x3D; &#39;修改工资账套&#39;;
      this.dialogVisible &#x3D; true;
      this.salary.basicSalary &#x3D; data.basicSalary;
      this.salary.trafficSalary &#x3D; data.trafficSalary;
      this.salary.lunchSalary &#x3D; data.lunchSalary;
      this.salary.bonus &#x3D; data.bonus;
      this.salary.pensionPer &#x3D; data.pensionPer;
      this.salary.pensionBase &#x3D; data.pensionBase;
      this.salary.medicalPer &#x3D; data.medicalPer;
      this.salary.medicalBase &#x3D; data.medicalBase;
      this.salary.accumulationFundPer &#x3D; data.accumulationFundPer;
      this.salary.accumulationFundBase &#x3D; data.accumulationFundBase;
      this.salary.name &#x3D; data.name;
      this.salary.id &#x3D; data.id;
    &#125;,
  &#125;
&#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<h3 id="员工工资套账管理"><a href="#员工工资套账管理" class="headerlink" title="员工工资套账管理"></a>员工工资套账管理</h3><h4 id="后端部分-7"><a href="#后端部分-7" class="headerlink" title="后端部分"></a>后端部分</h4><p>在Employee实体类上补充工资属性</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Salary salary;</code></pre></div>

<p>接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/salary/sobcfg&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SobConfigController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    EmployeeService employeeService;

    <span class="hljs-meta">@Autowired</span>
    SalaryService salaryService;

    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPageWithSalary</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page, <span class="hljs-meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer size)</span> </span>&#123;
        <span class="hljs-keyword">return</span> employeeService.getEmployeeByPageWithSalary(page, size);
    &#125;

    <span class="hljs-meta">@GetMapping(&quot;/salaries&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Salary&gt; <span class="hljs-title">getAllSalaries</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> salaryService.getAllSalaries();
    &#125;

    <span class="hljs-meta">@PutMapping(&quot;/&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateEmployeeSalaryById</span><span class="hljs-params">(Integer eid, Integer sid)</span> </span>&#123;
        Integer result = employeeService.updateEmployeeSalaryById(eid, sid);
        <span class="hljs-comment">// REPLACE INTO 关键词 更新为1，插入为2</span>
        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span> || result == <span class="hljs-number">2</span>) &#123;
            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败&quot;</span>);
    &#125;

&#125;</code></pre></div>

<p>在原先EmployeeService的基础上补充即可</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> RespPageBean <span class="hljs-title">getEmployeeByPageWithSalary</span><span class="hljs-params">(Integer page, Integer size)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (page != <span class="hljs-keyword">null</span> &amp;&amp; size != <span class="hljs-keyword">null</span>) &#123;
        page = (page - <span class="hljs-number">1</span>) * size;
    &#125;
    List&lt;Employee&gt; list = employeeMapper.getEmployeeByPageWithSalary(page, size);
    RespPageBean respPageBean = <span class="hljs-keyword">new</span> RespPageBean();
    respPageBean.setData(list);
    respPageBean.setTotal(employeeMapper.getTotal(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>));
    <span class="hljs-keyword">return</span> respPageBean;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateEmployeeSalaryById</span><span class="hljs-params">(Integer eid, Integer sid)</span> </span>&#123;
    <span class="hljs-keyword">return</span> employeeMapper.updateEmployeeSalaryById(eid, sid);
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;EmployeeWithSalary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Employee&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;salary&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Salary&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sbasicSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;basicSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sbonus&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;bonus&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;slunchSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;lunchSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;strafficSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;trafficSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sallSalary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;allSalary&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;spensionBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pensionBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;spensionPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pensionPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;screateDate&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createDate&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;smedicalBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;medicalBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;smedicalPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;medicalPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;saccumulationFundBase&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;accumulationFundBase&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;saccumulationFundPer&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;accumulationFundPer&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;REAL&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;department&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.Department&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getEmployeeByPageWithSalary&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;EmployeeWithSalary&quot;</span>&gt;</span>
  SELECT e.*,d.`name` AS dname,s.`id` AS sid,s.`accumulationFundBase` AS
  saccumulationFundBase,s.`accumulationFundPer` AS saccumulationFundPer,s.`allSalary` AS
  sallSalary,s.`basicSalary` AS sbasicSalary,s.`bonus` AS sbonus,s.`createDate` AS screateDate,s.`lunchSalary` AS
  slunchSalary,s.`medicalBase` AS smedicalBase,s.`medicalPer` AS smedicalPer,s.`name` AS sname,s.`pensionBase` AS
  spensionBase,s.`pensionPer` AS spensionPer,s.`trafficSalary` AS strafficSalary
  FROM employee e
  LEFT JOIN empsalary es
  ON e.`id`=es.`eid`
  LEFT JOIN salary s
  ON es.`sid`=s.`id`
  LEFT JOIN department d
  ON e.`departmentId`=d.`id`
  order by e.id
  <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;page !=null and size !=null&quot;</span>&gt;</span>
    limit #&#123;page&#125;,#&#123;size&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateEmployeeSalaryById&quot;</span>&gt;</span>
  REPLACE INTO empsalary (eid,sid) VALUES(#&#123;eid&#125;,#&#123;sid&#125;)
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<h2 id="聊天功能"><a href="#聊天功能" class="headerlink" title="聊天功能"></a>聊天功能</h2><h3 id="基本页面搭建"><a href="#基本页面搭建" class="headerlink" title="基本页面搭建"></a>基本页面搭建</h3><p>将<a target="_blank" rel="noopener" href="https://github.com/is-liyiwei/vue-Chat-demo">Github上的脚手架</a>引入自己的项目中，首先安装依赖</p>
<div class="hljs code-wrapper"><pre><code class="hljs shell">npm install sass-loader@7.3.1 --save-dev
npm install style-loader --save-dev
npm i node-sass@4.14.1 --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/ --save-dev</code></pre></div>

<p>在<code>views/chat</code>下创建<code>FriendChat.vue</code>，在组件<code>components/chat</code>下新建脚手架中的四个组件：<code>card、list、message、usertext</code>，在首页中引入进入聊天的快捷按钮</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;div&gt;
  &lt;el-button icon&#x3D;&quot;el-icon-bell&quot; type&#x3D;&quot;text&quot; style&#x3D;&quot;margin-right: 8px;color: #000000;&quot; size&#x3D;&quot;normal&quot; @click&#x3D;&quot;goChat&quot;&gt;Chat&lt;&#x2F;el-button&gt;
  &lt;el-dropdown class&#x3D;&quot;userInfo&quot; @command&#x3D;&quot;commandHandler&quot;&gt;
                &lt;span class&#x3D;&quot;el-dropdown-link&quot; style&#x3D;&quot;color: #000000;&quot;&gt;
                  &#123;&#123;user.name&#125;&#125;&lt;i&gt;&lt;img :src&#x3D;&quot;user.userface&quot; alt&#x3D;&quot;&quot;&gt;&lt;&#x2F;i&gt;
                &lt;&#x2F;span&gt;
    &lt;el-dropdown-menu slot&#x3D;&quot;dropdown&quot;&gt;
      &lt;el-dropdown-item command&#x3D;&quot;userinfo&quot;&gt;个人中心&lt;&#x2F;el-dropdown-item&gt;
      &lt;el-dropdown-item command&#x3D;&quot;setting&quot;&gt;设置&lt;&#x2F;el-dropdown-item&gt;
      &lt;el-dropdown-item command&#x3D;&quot;logout&quot; divided&gt;注销登录&lt;&#x2F;el-dropdown-item&gt;
    &lt;&#x2F;el-dropdown-menu&gt;
  &lt;&#x2F;el-dropdown&gt;
&lt;&#x2F;div&gt;

goChat() &#123;
this.$router.push(&quot;&#x2F;chat&quot;);
&#125;,</code></pre></div>

<p>完善<code>router</code>，实现跳转</p>
<div class="hljs code-wrapper"><pre><code class="hljs js">&#123;
  path: <span class="hljs-string">&#x27;/home&#x27;</span>,
  name: <span class="hljs-string">&#x27;Home&#x27;</span>,
  component: Home,
  hidden:<span class="hljs-literal">true</span>,
children: [
    &#123;
        path: <span class="hljs-string">&#x27;/chat&#x27;</span>,
        name: <span class="hljs-string">&#x27;在线聊天&#x27;</span>,
        component: FriendChat,
        hidden: <span class="hljs-literal">true</span>
    &#125;,
]

&#125;,</code></pre></div>

<p>完善<code>store</code>下的<code>index.js</code>文件</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>
<span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>

Vue.use(Vuex)

<span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();


<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store(&#123;

    state:&#123;
        routes:[],

        sessions:[&#123;
            id:<span class="hljs-number">1</span>,
            user:&#123;
                name:<span class="hljs-string">&#x27;示例介绍&#x27;</span>,
                img:<span class="hljs-string">&#x27;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F842eea2fef4be992c14222abf3df84af576f8d0d21049-YmLxJv_fw658&amp;refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1628337952&amp;t=02ebc923420e56695dadbe2933151ca0&#x27;</span>
            &#125;,
            messages:[&#123;
                content:<span class="hljs-string">&#x27;Hello，这是一个基于Vue + Vuex + Webpack构建的简单chat示例，聊天记录保存在localStorge, 有什么问题可以通过Github Issue问我。&#x27;</span>,
                date:now
            &#125;,&#123;
                content:<span class="hljs-string">&#x27;项目地址(原作者): https://github.com/coffcer/vue-chat&#x27;</span>,
                date:now
            &#125;,&#123;
                content:<span class="hljs-string">&#x27;本项目地址(重构): https://github.com/is-liyiwei&#x27;</span>,
                date:now
            &#125;]
        &#125;,&#123;
            id:<span class="hljs-number">2</span>,
            user:&#123;
                name:<span class="hljs-string">&#x27;webpack&#x27;</span>,
                img:<span class="hljs-string">&#x27;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage.biaobaiju.com%2Fuploads%2F20181113%2F23%2F1542122451-kZaRlqfLyK.jpg&amp;refer=http%3A%2F%2Fimage.biaobaiju.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1628338001&amp;t=8d7e0245528edff2b25393d4573fd6ef&#x27;</span>
            &#125;,
            messages:[&#123;
                content:<span class="hljs-string">&#x27;Hi，我是webpack哦&#x27;</span>,
                date:now
            &#125;]
        &#125;],
        currentSessionId:<span class="hljs-number">1</span>,
        filterKey:<span class="hljs-string">&#x27;&#x27;</span>

    &#125;,
    mutations:&#123;
        <span class="hljs-function"><span class="hljs-title">initRoutes</span>(<span class="hljs-params">state, data</span>)</span>&#123;
            state.routes = data;
        &#125;,
        changeCurrentSessionId (state,id) &#123;
            state.currentSessionId = id;
        &#125;,
        addMessage (state,msg) &#123;
            state.sessions[state.currentSessionId-<span class="hljs-number">1</span>].messages.push(&#123;
                content:msg,
                date: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
                self:<span class="hljs-literal">true</span>
            &#125;)
        &#125;,
        INIT_DATA (state) &#123;
            <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;vue-chat-session&#x27;</span>);
            <span class="hljs-comment">//console.log(data)</span>
            <span class="hljs-keyword">if</span> (data) &#123;
                state.sessions = <span class="hljs-built_in">JSON</span>.parse(data);
            &#125;
        &#125;
    &#125;,
    actions:&#123;
        initData (context) &#123;
            context.commit(<span class="hljs-string">&#x27;INIT_DATA&#x27;</span>)
        &#125;
    &#125;
&#125;)

store.watch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state</span>) </span>&#123;
    <span class="hljs-keyword">return</span> state.sessions
&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>&#123;
    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;vue-chat-session&#x27;</span>, <span class="hljs-built_in">JSON</span>.stringify(val));
&#125;, &#123;
    deep: <span class="hljs-literal">true</span><span class="hljs-comment">/*这个貌似是开启watch监测的判断,官方说明也比较模糊*/</span>
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store;</code></pre></div>

<h3 id="动态展示"><a href="#动态展示" class="headerlink" title="动态展示"></a>动态展示</h3><p>在<code>card.vue</code>和<code>message.vue</code>中从数据库读取用户信息和头像地址，不再写死到前端代码中</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;script&gt;
data () &#123;
    return &#123;
      user: JSON.parse(window.sessionStorage.getItem(&quot;user&quot;))
    &#125;
  &#125;
&lt;&#x2F;script&gt;</code></pre></div>

<p>这样<code>user.userface</code>就可以调用图片，<code>user.name</code>就可以调用用户名称，然后<strong>后端加载数据库内容</strong></p>
<p><strong>ChatController</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/chat&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    HrService hrService;


    <span class="hljs-meta">@GetMapping(&quot;/hrs&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrs</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> hrService.getAllHrsExceptCurrentHr();
    &#125;
&#125;</code></pre></div>

<p><strong>HrService</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hr&gt; <span class="hljs-title">getAllHrsExceptCurrentHr</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> hrMapper.getAllHrsExceptCurrentHr(HrUtils.getCurrentHr().getId());
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllHrsExceptCurrentHr&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>
  select * from hr where id !=#&#123;id&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<h3 id="引入WebSocket"><a href="#引入WebSocket" class="headerlink" title="引入WebSocket"></a>引入WebSocket</h3><p><strong>引入依赖</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><strong>配置类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSocketMessageBroker</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketMessageBrokerConfigurer</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> </span>&#123;
        registry.addEndpoint(<span class="hljs-string">&quot;/ws/ep&quot;</span>)
                <span class="hljs-comment">//允许前端发送</span>
                .setAllowedOrigins(<span class="hljs-string">&quot;*&quot;</span>)
                .withSockJS();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry registry)</span> </span>&#123;
        registry.enableSimpleBroker(<span class="hljs-string">&quot;/queue&quot;</span>);
    &#125;
&#125;</code></pre></div>

<p><strong>Controller</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WsController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    SimpMessagingTemplate simpMessagingTemplate;

    <span class="hljs-meta">@MessageMapping(&quot;/ws/chat&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMsg</span><span class="hljs-params">(Principal principal, ChatMsg chatMsg)</span> </span>&#123;
        chatMsg.setFrom(principal.getName());
        chatMsg.setDate(<span class="hljs-keyword">new</span> Date());
        simpMessagingTemplate.convertAndSendToUser(chatMsg.getTo(), <span class="hljs-string">&quot;/queue/chat&quot;</span>, chatMsg);
    &#125;
&#125;</code></pre></div>

<p>实体类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatMsg</span> </span>&#123;
    <span class="hljs-keyword">private</span> String from;
    <span class="hljs-keyword">private</span> String to;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> Date date;
    <span class="hljs-keyword">private</span> String fromNickname;
&#125;</code></pre></div>

<h3 id="消息的发送"><a href="#消息的发送" class="headerlink" title="消息的发送"></a>消息的发送</h3><p>在<code>usertext.vue</code>中将输入的内容发送</p>
<div class="hljs code-wrapper"><pre><code class="hljs js">addMessage (e) &#123;
 <span class="hljs-keyword">if</span> (e.ctrlKey &amp;&amp; e.keyCode ===<span class="hljs-number">13</span> &amp;&amp; <span class="hljs-built_in">this</span>.content.length) &#123;
   <span class="hljs-keyword">let</span> msgObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();
   	 msgObj.to = <span class="hljs-built_in">this</span>.currentSession.username;
     msgObj.content = <span class="hljs-built_in">this</span>.content;
   <span class="hljs-built_in">this</span>.$store.state.stomp.send(<span class="hljs-string">&#x27;ws/chat&#x27;</span>,&#123;&#125;,<span class="hljs-built_in">JSON</span>.stringify(msgObj));
  <span class="hljs-built_in">this</span>.$store.commit(<span class="hljs-string">&#x27;addMessage&#x27;</span>, msgObj);
  <span class="hljs-built_in">this</span>.content=<span class="hljs-string">&#x27;&#x27;</span>;
 &#125;
&#125;</code></pre></div>

<p>在<code>router.js</code>中执行发送</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//消息发送</span>
        addMessage (state,msg) &#123;
            <span class="hljs-keyword">let</span> mss = state.sessions[state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to];
            <span class="hljs-keyword">if</span> (!mss) &#123;
                <span class="hljs-comment">// 此处消息不能自动刷新，需要用Vue.set</span>
                <span class="hljs-comment">// state.sessions[state.currentHr.username+&#x27;#&#x27;+msg.to] = [];</span>
            Vue.set(state.sessions, state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to, []);
            &#125;
            state.sessions[state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + msg.to].push(&#123;
                content: msg.content,
                date: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
                self: !msg.notSelf
            &#125;)
        &#125;,</code></pre></div>

<h3 id="消息的接收"><a href="#消息的接收" class="headerlink" title="消息的接收"></a>消息的接收</h3><p>在<code>router.js</code>中接收消息</p>
<div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//消息接收</span>
<span class="hljs-function"><span class="hljs-title">connect</span>(<span class="hljs-params">context</span>)</span> &#123;
  context.state.stomp = Stomp.over(<span class="hljs-keyword">new</span> SockJS(<span class="hljs-string">&#x27;/ws/ep&#x27;</span>));
  context.state.stomp.connect(&#123;&#125;, <span class="hljs-function"><span class="hljs-params">success</span> =&gt;</span> &#123;
    context.state.stomp.subscribe(<span class="hljs-string">&#x27;/user/queue/chat&#x27;</span>, <span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> &#123;
      <span class="hljs-keyword">let</span> receiveMsg = <span class="hljs-built_in">JSON</span>.parse(msg.body);
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;receiveMsg&#x27;</span> + receiveMsg);
      <span class="hljs-keyword">if</span> (!context.state.currentSession || receiveMsg.from != context.state.currentSession.username) &#123;
        Notification.info(&#123;
          title: <span class="hljs-string">&#x27;【&#x27;</span> + receiveMsg.fromNickname + <span class="hljs-string">&#x27;】发来一条消息&#x27;</span>,
          message: receiveMsg.content.length &gt; <span class="hljs-number">10</span> ? receiveMsg.content.substr(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>) : receiveMsg.content,
          position: <span class="hljs-string">&#x27;bottom-right&#x27;</span>
        &#125;)
        Vue.set(context.state.isDot, context.state.currentHr.username + <span class="hljs-string">&#x27;#&#x27;</span> + receiveMsg.from, <span class="hljs-literal">true</span>);
      &#125;
      receiveMsg.notSelf = <span class="hljs-literal">true</span>;
      receiveMsg.to = receiveMsg.from;
      context.commit(<span class="hljs-string">&#x27;addMessage&#x27;</span>, receiveMsg);
    &#125;)
  &#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
  &#125;)
&#125;,</code></pre></div>

<h3 id="消息的展示"><a href="#消息的展示" class="headerlink" title="消息的展示"></a>消息的展示</h3><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div id&#x3D;&quot;message&quot; v-scroll-bottom&#x3D;&quot;sessions&quot;&gt;
   &lt;ul v-if&#x3D;&quot;currentSession&quot;&gt;
      &lt;li v-for&#x3D;&quot;entry in sessions[user.username+&#39;#&#39;+currentSession.username]&quot;&gt;
      &lt;p class&#x3D;&quot;time&quot;&gt;
      &lt;span&gt;&#123;&#123;entry.date | time&#125;&#125;&lt;&#x2F;span&gt;
     &lt;&#x2F;p&gt;
     &lt;div class&#x3D;&quot;main&quot; :class&#x3D;&quot;&#123;self:entry.self&#125;&quot;&gt;
          &lt;img class&#x3D;&quot;avatar&quot; :src&#x3D;&quot;entry.self ? user.userface : currentSession.userface&quot; alt&#x3D;&quot;&quot;&gt;
          &lt;p class&#x3D;&quot;text&quot;&gt;&#123;&#123;entry.content&#125;&#125;&lt;&#x2F;p&gt;
     &lt;&#x2F;div&gt;
    &lt;&#x2F;li&gt;
   &lt;&#x2F;ul&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;</code></pre></div>

<h1 id="八、补充内容"><a href="#八、补充内容" class="headerlink" title="八、补充内容"></a>八、补充内容</h1><h2 id="登录生成验证码"><a href="#登录生成验证码" class="headerlink" title="登录生成验证码"></a>登录生成验证码</h2><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><h4 id="生成验证码"><a href="#生成验证码" class="headerlink" title="生成验证码"></a>生成验证码</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VerificationCode</span> </span>&#123;

   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> width = <span class="hljs-number">100</span>;<span class="hljs-comment">// 生成验证码图片的宽度</span>
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> height = <span class="hljs-number">30</span>;<span class="hljs-comment">// 生成验证码图片的高度</span>
   <span class="hljs-keyword">private</span> String[] fontNames = &#123; <span class="hljs-string">&quot;宋体&quot;</span>, <span class="hljs-string">&quot;楷体&quot;</span>, <span class="hljs-string">&quot;隶书&quot;</span>, <span class="hljs-string">&quot;微软雅黑&quot;</span> &#125;;
   <span class="hljs-keyword">private</span> Color bgColor = <span class="hljs-keyword">new</span> Color(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<span class="hljs-comment">// 定义验证码图片的背景颜色为白色</span>
   <span class="hljs-keyword">private</span> Random random = <span class="hljs-keyword">new</span> Random();
   <span class="hljs-keyword">private</span> String codes = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;
   <span class="hljs-keyword">private</span> String text;<span class="hljs-comment">// 记录随机字符串</span>

   <span class="hljs-comment">/**</span>
<span class="hljs-comment">    * 获取一个随意颜色</span>
<span class="hljs-comment">    * </span>
<span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">private</span> Color <span class="hljs-title">randomColor</span><span class="hljs-params">()</span> </span>&#123;
      <span class="hljs-keyword">int</span> red = random.nextInt(<span class="hljs-number">150</span>);
      <span class="hljs-keyword">int</span> green = random.nextInt(<span class="hljs-number">150</span>);
      <span class="hljs-keyword">int</span> blue = random.nextInt(<span class="hljs-number">150</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Color(red, green, blue);
   &#125;

   <span class="hljs-comment">/**</span>
<span class="hljs-comment">    * 获取一个随机字体</span>
<span class="hljs-comment">    * </span>
<span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">private</span> Font <span class="hljs-title">randomFont</span><span class="hljs-params">()</span> </span>&#123;
      String name = fontNames[random.nextInt(fontNames.length)];
      <span class="hljs-keyword">int</span> style = random.nextInt(<span class="hljs-number">4</span>);
      <span class="hljs-keyword">int</span> size = random.nextInt(<span class="hljs-number">5</span>) + <span class="hljs-number">24</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Font(name, style, size);
   &#125;

   <span class="hljs-comment">/**</span>
<span class="hljs-comment">    * 获取一个随机字符</span>
<span class="hljs-comment">    * </span>
<span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">char</span> <span class="hljs-title">randomChar</span><span class="hljs-params">()</span> </span>&#123;
      <span class="hljs-keyword">return</span> codes.charAt(random.nextInt(codes.length()));
   &#125;

   <span class="hljs-comment">/**</span>
<span class="hljs-comment">    * 创建一个空白的BufferedImage对象</span>
<span class="hljs-comment">    * </span>
<span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">private</span> BufferedImage <span class="hljs-title">createImage</span><span class="hljs-params">()</span> </span>&#123;
      BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
      Graphics2D g2 = (Graphics2D) image.getGraphics();
      g2.setColor(bgColor);<span class="hljs-comment">// 设置验证码图片的背景颜色</span>
      g2.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);
      <span class="hljs-keyword">return</span> image;
   &#125;

   <span class="hljs-function"><span class="hljs-keyword">public</span> BufferedImage <span class="hljs-title">getImage</span><span class="hljs-params">()</span> </span>&#123;
      BufferedImage image = createImage();
      Graphics2D g2 = (Graphics2D) image.getGraphics();
      StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer();
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;
         String s = randomChar() + <span class="hljs-string">&quot;&quot;</span>;
         sb.append(s);
         g2.setColor(randomColor());
         g2.setFont(randomFont());
         <span class="hljs-keyword">float</span> x = i * width * <span class="hljs-number">1.0f</span> / <span class="hljs-number">4</span>;
         g2.drawString(s, x, height - <span class="hljs-number">8</span>);
      &#125;
      <span class="hljs-keyword">this</span>.text = sb.toString();
      drawLine(image);
      <span class="hljs-keyword">return</span> image;
   &#125;

   <span class="hljs-comment">/**</span>
<span class="hljs-comment">    * 绘制干扰线</span>
<span class="hljs-comment">    * </span>
<span class="hljs-comment">    * <span class="hljs-doctag">@param</span> image</span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drawLine</span><span class="hljs-params">(BufferedImage image)</span> </span>&#123;
      Graphics2D g2 = (Graphics2D) image.getGraphics();
      <span class="hljs-keyword">int</span> num = <span class="hljs-number">5</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) &#123;
         <span class="hljs-keyword">int</span> x1 = random.nextInt(width);
         <span class="hljs-keyword">int</span> y1 = random.nextInt(height);
         <span class="hljs-keyword">int</span> x2 = random.nextInt(width);
         <span class="hljs-keyword">int</span> y2 = random.nextInt(height);
         g2.setColor(randomColor());
         g2.setStroke(<span class="hljs-keyword">new</span> BasicStroke(<span class="hljs-number">1.5f</span>));
         g2.drawLine(x1, y1, x2, y2);
      &#125;
   &#125;

   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getText</span><span class="hljs-params">()</span> </span>&#123;
      <span class="hljs-keyword">return</span> text;
   &#125;

   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">output</span><span class="hljs-params">(BufferedImage image, OutputStream out)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
      ImageIO.write(image, <span class="hljs-string">&quot;JPEG&quot;</span>, out);
   &#125;
&#125;</code></pre></div>

<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/verifyCode&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">verifyCode</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    VerificationCode code = <span class="hljs-keyword">new</span> VerificationCode();
    BufferedImage image = code.getImage();
    String text = code.getText();
    HttpSession session = request.getSession(<span class="hljs-keyword">true</span>);
    session.setAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>, text);
    VerificationCode.output(image,resp.getOutputStream());
&#125;</code></pre></div>

<h4 id="Security不拦截"><a href="#Security不拦截" class="headerlink" title="Security不拦截"></a>Security不拦截</h4><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
    <span class="hljs-comment">//防止访问登录页面死循环，不用进入Security拦截</span>
    web.ignoring().antMatchers(<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>, <span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/verifyCode&quot;</span>);
&#125;</code></pre></div>

<h4 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h4><p>登录前需要先校验验证码，所以需要自定义过滤器</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UsernamePasswordAuthenticationFilter</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    SessionRegistry sessionRegistry;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Authentication <span class="hljs-title">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;
        <span class="hljs-keyword">if</span> (!request.getMethod().equals(<span class="hljs-string">&quot;POST&quot;</span>)) &#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(
                    <span class="hljs-string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());
        &#125;
        String verify_code = (String) request.getSession().getAttribute(<span class="hljs-string">&quot;verify_code&quot;</span>);
        <span class="hljs-keyword">if</span> (request.getContentType().contains(MediaType.APPLICATION_JSON_VALUE) || request.getContentType().contains(MediaType.APPLICATION_JSON_UTF8_VALUE)) &#123;
            Map&lt;String, String&gt; loginData = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
            <span class="hljs-keyword">try</span> &#123;
                loginData = <span class="hljs-keyword">new</span> ObjectMapper().readValue(request.getInputStream(), Map.class);
            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            &#125;<span class="hljs-keyword">finally</span> &#123;
                String code = loginData.get(<span class="hljs-string">&quot;code&quot;</span>);
                checkCode(response, code, verify_code);
            &#125;
            String username = loginData.get(getUsernameParameter());
            String password = loginData.get(getPasswordParameter());
            <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span>) &#123;
                username = <span class="hljs-string">&quot;&quot;</span>;
            &#125;
            <span class="hljs-keyword">if</span> (password == <span class="hljs-keyword">null</span>) &#123;
                password = <span class="hljs-string">&quot;&quot;</span>;
            &#125;
            username = username.trim();
            UsernamePasswordAuthenticationToken authRequest = <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(
                    username, password);
            setDetails(request, authRequest);
            Hr principal = <span class="hljs-keyword">new</span> Hr();
            principal.setUsername(username);
            sessionRegistry.registerNewSession(request.getSession(<span class="hljs-keyword">true</span>).getId(), principal);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAuthenticationManager().authenticate(authRequest);
        &#125; <span class="hljs-keyword">else</span> &#123;
            checkCode(response, request.getParameter(<span class="hljs-string">&quot;code&quot;</span>), verify_code);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.attemptAuthentication(request, response);
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkCode</span><span class="hljs-params">(HttpServletResponse resp, String code, String verify_code)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (code == <span class="hljs-keyword">null</span> || verify_code == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(code) || !verify_code.toLowerCase().equals(code.toLowerCase())) &#123;
            <span class="hljs-comment">//验证码不正确</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationServiceException(<span class="hljs-string">&quot;验证码不正确&quot;</span>);
        &#125;
    &#125;
&#125;</code></pre></div>

<p>同时需要更改一下SecurityConfig，这里通过一个过滤器，同时检验用户名，密码和验证码</p>
<div class="hljs code-wrapper"><pre><code class="hljs java">    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">LoginFilter <span class="hljs-title">loginFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        LoginFilter loginFilter = <span class="hljs-keyword">new</span> LoginFilter();
        loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; &#123;
                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                    PrintWriter out = response.getWriter();
                    Hr hr = (Hr) authentication.getPrincipal();
                    hr.setPassword(<span class="hljs-keyword">null</span>);
                    RespBean ok = RespBean.ok(<span class="hljs-string">&quot;登录成功!&quot;</span>, hr);
                    String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);
                    out.write(s);
                    out.flush();
                    out.close();
                &#125;
        );
        loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; &#123;
                    response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                    PrintWriter out = response.getWriter();
                    RespBean respBean = RespBean.error(exception.getMessage());
                    <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> LockedException) &#123;
                        respBean.setMsg(<span class="hljs-string">&quot;账户被锁定，请联系管理员!&quot;</span>);
                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> CredentialsExpiredException) &#123;
                        respBean.setMsg(<span class="hljs-string">&quot;密码过期，请联系管理员!&quot;</span>);
                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> AccountExpiredException) &#123;
                        respBean.setMsg(<span class="hljs-string">&quot;账户过期，请联系管理员!&quot;</span>);
                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> DisabledException) &#123;
                        respBean.setMsg(<span class="hljs-string">&quot;账户被禁用，请联系管理员!&quot;</span>);
                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;
                        respBean.setMsg(<span class="hljs-string">&quot;用户名或者密码输入错误，请重新输入!&quot;</span>);
                    &#125;
                    out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));
                    out.flush();
                    out.close();
                &#125;
        );
        loginFilter.setAuthenticationManager(authenticationManagerBean());
        loginFilter.setFilterProcessesUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>);
        ConcurrentSessionControlAuthenticationStrategy sessionStrategy = <span class="hljs-keyword">new</span> ConcurrentSessionControlAuthenticationStrategy(sessionRegistry());
        sessionStrategy.setMaximumSessions(<span class="hljs-number">1</span>);
        loginFilter.setSessionAuthenticationStrategy(sessionStrategy);
        <span class="hljs-keyword">return</span> loginFilter;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">SessionRegistryImpl <span class="hljs-title">sessionRegistry</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SessionRegistryImpl();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        http.authorizeRequests()
                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>&#123;
                        object.setAccessDecisionManager(customUrlDecisionManager);
                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);
                        <span class="hljs-keyword">return</span> object;
                    &#125;
                &#125;)
                .and()
                .logout()
                .logoutSuccessHandler((req, resp, authentication) -&gt; &#123;
                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                            PrintWriter out = resp.getWriter();
                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;注销成功!&quot;</span>)));
                            out.flush();
                            out.close();
                        &#125;
                )
                .permitAll()
                .and()
                .csrf().disable().exceptionHandling()
                <span class="hljs-comment">//没有认证时，在这里处理结果，不要重定向</span>
                .authenticationEntryPoint((req, resp, authException) -&gt; &#123;
                            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
                            resp.setStatus(<span class="hljs-number">401</span>);
                            PrintWriter out = resp.getWriter();
                            RespBean respBean = RespBean.error(<span class="hljs-string">&quot;访问失败!&quot;</span>);
                            <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;
                                respBean.setMsg(<span class="hljs-string">&quot;请求失败，请联系管理员!&quot;</span>);
                            &#125;
                            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));
                            out.flush();
                            out.close();
                        &#125;
                );
        http.addFilterAt(<span class="hljs-keyword">new</span> ConcurrentSessionFilter(sessionRegistry(), event -&gt; &#123;
            HttpServletResponse resp = event.getResponse();
            resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);
            resp.setStatus(<span class="hljs-number">401</span>);
            PrintWriter out = resp.getWriter();
            out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.error(<span class="hljs-string">&quot;您已在另一台设备登录，本次登录已下线!&quot;</span>)));
            out.flush();
            out.close();
        &#125;), ConcurrentSessionFilter.class);
        http.addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class);
    &#125;
&#125;</code></pre></div>

<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>前端直接展示即可</p>
<div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;el-form-item prop&#x3D;&quot;code&quot;&gt;
  &lt;el-input size&#x3D;&quot;normal&quot; type&#x3D;&quot;text&quot; v-model&#x3D;&quot;loginForm.code&quot; auto-complete&#x3D;&quot;off&quot;
            placeholder&#x3D;&quot;点击图片更换验证码&quot; @keydown.enter.native&#x3D;&quot;submitLogin&quot; style&#x3D;&quot;width: 250px&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;img :src&#x3D;&quot;vcUrl&quot; @click&#x3D;&quot;updateVerifyCode&quot; alt&#x3D;&quot;&quot; style&#x3D;&quot;cursor: pointer;&quot;&gt;
&lt;&#x2F;el-form-item&gt;</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs js">methods:&#123;
  <span class="hljs-function"><span class="hljs-title">updateVerifyCode</span>(<span class="hljs-params"></span>)</span> &#123;
    <span class="hljs-built_in">this</span>.vcUrl = <span class="hljs-string">&#x27;/verifyCode?time=&#x27;</span>+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
  &#125;
&#125;</code></pre></div>

<h2 id="文件上传FastDFS"><a href="#文件上传FastDFS" class="headerlink" title="文件上传FastDFS"></a>文件上传FastDFS</h2><p>安装过程略，先说明一下安全的问题</p>
<p>现在，任何人都可以访问我们服务器上传文件，这肯定是不行的，这个问题好解决，加一个上传时候的令牌即可。</p>
<p>首先我们在服务端开启令牌校验：</p>
<div class="hljs code-wrapper"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>fdfs/http.conf</code></pre></div>

<p><a target="_blank" rel="noopener" href="http://img.itboyhub.com/2020/03/fastdfs-6.png"><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/fastdfs-6.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<p>配置完成后，记得重启服务端：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">./nginx</span> -s stop
<span class="hljs-string">./nginx</span></code></pre></div>

<p>接下来，在前端准备一个获取令牌的方法，如下：</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getToken</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
    <span class="hljs-keyword">int</span> ts = (<span class="hljs-keyword">int</span>) Instant.now().getEpochSecond();
    String token = ProtoCommon.getToken(<span class="hljs-string">&quot;M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png&quot;</span>, ts, <span class="hljs-string">&quot;FastDFS1234567890&quot;</span>);
    StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();
  	sb.append(<span class="hljs-string">&quot;http:172.16.211.4&quot;</span>)
      .append(<span class="hljs-string">&quot;group1/M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png&quot;</span>)
    sb.append(<span class="hljs-string">&quot;?token=&quot;</span>).append(token);
    sb.append(<span class="hljs-string">&quot;&amp;ts=&quot;</span>).append(ts);
    System.out.println(sb.toString());
&#125;</code></pre></div>

<p>这里，我们主要是根据 ProtoCommon.getToken 方法来获取令牌，注意这个方法的第一个参数是你要访问的文件 id，<strong>注意，这个地址里边不包含 group，千万别搞错了；</strong>第二个参数是时间戳，第三个参数是密钥，密钥要和服务端的配置一致。将生成的字符串拼接，追加到访问路径后面，如：<code>http://192.168.91.128/group1/M00/00/00/wKhbgF5aMteAWy0gAAJkI7-2yGk361.png?token=7e329cc50307000283a3ad3592bb6d32&amp;ts=1582975854</code>。<strong>此时访问路径里边如果没有令牌，会访问失败。</strong></p>
<h2 id="个人中心"><a href="#个人中心" class="headerlink" title="个人中心"></a>个人中心</h2><h3 id="如何获取用户信息"><a href="#如何获取用户信息" class="headerlink" title="如何获取用户信息"></a>如何获取用户信息</h3><p>在Spring Security中提供了Authentication，可以直接在Controller中直接注入就可以使用</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/hr/info&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Hr <span class="hljs-title">getCurrentHr</span><span class="hljs-params">(Authentication authentication)</span> </span>&#123;
    <span class="hljs-keyword">return</span> ((Hr) authentication.getPrincipal());
&#125;</code></pre></div>

<h3 id="如何修改用户信息"><a href="#如何修改用户信息" class="headerlink" title="如何修改用户信息"></a>如何修改用户信息</h3><p>相当于重新构建一个Authentication实例放到Context中去</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PutMapping(&quot;/hr/info&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr, Authentication authentication)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;
        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
&#125;</code></pre></div>

<p>又分为修改用户的基础信息，不需要重新登录，修改密码后需要重新登录，先定义接口</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/hr/info&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Hr <span class="hljs-title">getCurrentHr</span><span class="hljs-params">(Authentication authentication)</span> </span>&#123;
    <span class="hljs-keyword">return</span> ((Hr) authentication.getPrincipal());
&#125;

<span class="hljs-meta">@PutMapping(&quot;/hr/info&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHr</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hr hr, Authentication authentication)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (hrService.updateHr(hr) == <span class="hljs-number">1</span>) &#123;
        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
&#125;

<span class="hljs-meta">@PutMapping(&quot;/hr/pass&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Map&lt;String, Object&gt; info)</span> </span>&#123;
    String oldpass = (String) info.get(<span class="hljs-string">&quot;oldpass&quot;</span>);
    String pass = (String) info.get(<span class="hljs-string">&quot;pass&quot;</span>);
    Integer hrid = (Integer) info.get(<span class="hljs-string">&quot;hrid&quot;</span>);
    <span class="hljs-keyword">if</span> (hrService.updateHrPasswd(oldpass, pass, hrid)) &#123;
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">updateHrPasswd</span><span class="hljs-params">(String oldpass, String pass, Integer hrid)</span> </span>&#123;
    Hr hr = hrMapper.selectByPrimaryKey(hrid);
    BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();
    <span class="hljs-keyword">if</span> (encoder.matches(oldpass, hr.getPassword())) &#123;
        String encodePass = encoder.encode(pass);
        Integer result = hrMapper.updatePasswd(hrid, encodePass);
        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updatePasswd&quot;</span>&gt;</span>
  update hr set password = #&#123;encodePass&#125; where id=#&#123;hrid&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div>

<h3 id="上传头像（FastDFS）"><a href="#上传头像（FastDFS）" class="headerlink" title="上传头像（FastDFS）"></a>上传头像（FastDFS）</h3><p><strong>开启FastDFS（Tracker Server、Storage Server、Nginx）</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs shell">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start
/usr/local/nginx/sbin/.nginx</code></pre></div>

<p><strong>添加依赖</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.zcx7878<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastdfs-client-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.27.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><strong>配置文件</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">## application.properties</span>
<span class="hljs-meta">fastdfs.nginx.host</span> = <span class="hljs-string">http://172.16.211.4/</span>

<span class="hljs-comment">## fastdfs-client.properties</span>

<span class="hljs-meta">fastdfs.connect_timeout_in_seconds</span> = <span class="hljs-string">5</span>
<span class="hljs-meta">fastdfs.network_timeout_in_seconds</span> = <span class="hljs-string">30</span>

<span class="hljs-meta">fastdfs.charset</span> = <span class="hljs-string">UTF-8</span>

<span class="hljs-meta">fastdfs.http_anti_steal_token</span> = <span class="hljs-string">false</span>
<span class="hljs-meta">fastdfs.http_secret_key</span> = <span class="hljs-string">lucifer1234567890</span>
<span class="hljs-meta">fastdfs.http_tracker_http_port</span> = <span class="hljs-string">80</span>

<span class="hljs-meta">fastdfs.tracker_servers</span> = <span class="hljs-string">172.16.211.4:22122</span>

<span class="hljs-comment">## Whether to open the connection pool, if not, create a new connection every time</span>
<span class="hljs-meta">fastdfs.connection_pool.enabled</span> = <span class="hljs-string">true</span>

<span class="hljs-comment">## max_count_per_entry: max connection count per host:port , 0 is not limit</span>
<span class="hljs-meta">fastdfs.connection_pool.max_count_per_entry</span> = <span class="hljs-string">500</span>

<span class="hljs-comment">## connections whose the idle time exceeds this time will be closed, unit: second, default value is 3600</span>
<span class="hljs-meta">fastdfs.connection_pool.max_idle_time</span> = <span class="hljs-string">3600</span>

<span class="hljs-comment">## Maximum waiting time when the maximum number of connections is reached, unit: millisecond, default value is 1000</span>
<span class="hljs-meta">fastdfs.connection_pool.max_wait_time_in_ms</span> = <span class="hljs-string">1000</span></code></pre></div>

<p><strong>工具类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastDFSUtils</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> StorageClient1 client1;

    <span class="hljs-keyword">static</span> &#123;
        <span class="hljs-keyword">try</span> &#123;
            ClientGlobal.initByProperties(<span class="hljs-string">&quot;fastdfs-client.properties&quot;</span>);
            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();
            TrackerServer trackerServer = trackerClient.getConnection();
            client1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, <span class="hljs-keyword">null</span>);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125; <span class="hljs-keyword">catch</span> (MyException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file)</span> </span>&#123;
        String oldName = file.getOriginalFilename();
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> client1.upload_file1(file.getBytes(), oldName.substring(oldName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>), <span class="hljs-keyword">null</span>);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125; <span class="hljs-keyword">catch</span> (MyException e) &#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

&#125;</code></pre></div>

<p><strong>Controller</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/hr/userface&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">updateHrUserface</span><span class="hljs-params">(MultipartFile file, Integer id,Authentication authentication)</span> </span>&#123;
    String fileId = FastDFSUtils.upload(file);
    String url = nginxHost + fileId;
    <span class="hljs-keyword">if</span> (hrService.updateUserface(url, id) == <span class="hljs-number">1</span>) &#123;
        Hr hr = (Hr) authentication.getPrincipal();
        hr.setUserface(url);
        SecurityContextHolder.getContext().setAuthentication(<span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(hr, authentication.getCredentials(), authentication.getAuthorities()));
        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">&quot;更新成功!&quot;</span>, url);
    &#125;
    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">&quot;更新失败!&quot;</span>);
&#125;</code></pre></div>

<p><strong>Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateUserface</span><span class="hljs-params">(String url, Integer id)</span> </span>&#123;
    <span class="hljs-keyword">return</span> hrMapper.updateUserface(url, id);
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUserface&quot;</span>&gt;</span>
  update hr set userface = #&#123;url&#125; where id=#&#123;id&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div>

<h2 id="RabbitMQ保证邮箱发送的可靠性"><a href="#RabbitMQ保证邮箱发送的可靠性" class="headerlink" title="RabbitMQ保证邮箱发送的可靠性"></a>RabbitMQ保证邮箱发送的可靠性</h2><h3 id="消息发送-1"><a href="#消息发送-1" class="headerlink" title="消息发送"></a>消息发送</h3><p>生成表记录消息发送的日志</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210714152747045.png" srcset="/img/loading.gif" lazyload alt="image-20210714152747045"></p>
<p>生成对应实体类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendLog</span> </span>&#123;

    <span class="hljs-keyword">private</span> String msgId;
    <span class="hljs-keyword">private</span> Integer empId;
    <span class="hljs-comment">//0 消息投递中   1 投递成功   2投递失败</span>
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-comment">//RabbbitMQ相关</span>
    <span class="hljs-keyword">private</span> String routeKey;
    <span class="hljs-keyword">private</span> String exchange;
    <span class="hljs-comment">//发送失败重试次数</span>
    <span class="hljs-keyword">private</span> Integer count;
    <span class="hljs-comment">//发送失败重试时间</span>
    <span class="hljs-keyword">private</span> Date tryTime;
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Date updateTime;
&#125;</code></pre></div>

<p>最开始使用的是SpringBoot提供的RabbitTemplate直接发送消息</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
RabbitTemplate rabbitTemplate;</code></pre></div>

<p>这里自己配置RabbitConfig，不再使用系统提供的</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitConfig</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(RabbitConfig.class);

    <span class="hljs-meta">@Autowired</span>
    CachingConnectionFactory cachingConnectionFactory;

    <span class="hljs-meta">@Autowired</span>
    MailSendLogService mailSendLogService;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">RabbitTemplate <span class="hljs-title">rabbitTemplate</span><span class="hljs-params">()</span> </span>&#123;
        RabbitTemplate rabbitTemplate = <span class="hljs-keyword">new</span> RabbitTemplate(cachingConnectionFactory);
        rabbitTemplate.setConfirmCallback((data, ack, cause) -&gt; &#123;
            String msgId = data.getId();
            <span class="hljs-keyword">if</span> (ack) &#123;
                logger.info(msgId + <span class="hljs-string">&quot;:消息发送成功&quot;</span>);
                mailSendLogService.updateMailSendLogStatus(msgId, <span class="hljs-number">1</span>);<span class="hljs-comment">//修改数据库中的记录，消息投递成功</span>
            &#125; <span class="hljs-keyword">else</span> &#123;
                logger.info(msgId + <span class="hljs-string">&quot;:消息发送失败&quot;</span>);
            &#125;
        &#125;);
        rabbitTemplate.setReturnCallback((msg, repCode, repText, exchange, routingkey) -&gt; &#123;
            logger.info(<span class="hljs-string">&quot;消息发送失败&quot;</span>);
        &#125;);
        <span class="hljs-keyword">return</span> rabbitTemplate;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">Queue <span class="hljs-title">mailQueue</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME, <span class="hljs-keyword">true</span>);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">DirectExchange <span class="hljs-title">mailExchange</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectExchange(MailConstants.MAIL_EXCHANGE_NAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">Binding <span class="hljs-title">mailBinding</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> BindingBuilder.bind(mailQueue()).to(mailExchange()).with(MailConstants.MAIL_ROUTING_KEY_NAME);
    &#125;
&#125;</code></pre></div>

<p>定义的消息常量实体类</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailConstants</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer DELIVERING = <span class="hljs-number">0</span>;<span class="hljs-comment">//消息投递中</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer SUCCESS = <span class="hljs-number">1</span>;<span class="hljs-comment">//消息投递成功</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer FAILURE = <span class="hljs-number">2</span>;<span class="hljs-comment">//消息投递失败</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer MAX_TRY_COUNT = <span class="hljs-number">3</span>;<span class="hljs-comment">//最大重试次数</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Integer MSG_TIMEOUT = <span class="hljs-number">1</span>;<span class="hljs-comment">//消息超时时间</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_QUEUE_NAME = <span class="hljs-string">&quot;lucifer.mail.queue&quot;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_EXCHANGE_NAME = <span class="hljs-string">&quot;lucifer.mail.exchange&quot;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String MAIL_ROUTING_KEY_NAME = <span class="hljs-string">&quot;lucifer.mail.routing.key&quot;</span>;
&#125;</code></pre></div>

<p>对应Service</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendLogService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    MailSendLogMapper mailSendLogMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateMailSendLogStatus</span><span class="hljs-params">(String msgId, Integer status)</span> </span>&#123;
        <span class="hljs-keyword">return</span> mailSendLogMapper.updateMailSendLogStatus(msgId, status);
    &#125;
&#125;</code></pre></div>

<p><strong>Mapper</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateMailSendLogStatus&quot;</span>&gt;</span>
    update mail_send_log set status = #&#123;status&#125; where msgId=#&#123;msgId&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div>

<p>此时针对<strong>EmployeeService</strong>需要进行一定的改造，在添加员工发送邮件的时候，利用自己的配置来进行</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">addEmp</span><span class="hljs-params">(Employee employee)</span> </span>&#123;

        Date beginContract = employee.getBeginContract();
        Date endContract = employee.getEndContract();
        <span class="hljs-keyword">double</span> month = (Double.parseDouble(yearFormat.format(endContract)) - Double.parseDouble(yearFormat.format(beginContract))) * <span class="hljs-number">12</span>
                + (Double.parseDouble(monthFormat.format(endContract)) - Double.parseDouble(monthFormat.format(beginContract)));
        employee.setContractTerm(Double.parseDouble(decimalFormat.format(month / <span class="hljs-number">12</span>)));
        <span class="hljs-comment">//邮件发送</span>
        <span class="hljs-keyword">int</span> result = employeeMapper.insertSelective(employee);
        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;
            Employee emp = employeeMapper.getEmployeeById(employee.getId());
            <span class="hljs-comment">//生成消息的唯一id</span>
            String msgId = UUID.randomUUID().toString();
            MailSendLog mailSendLog = <span class="hljs-keyword">new</span> MailSendLog();
            mailSendLog.setMsgId(msgId);
            mailSendLog.setCreateTime(<span class="hljs-keyword">new</span> Date());
            mailSendLog.setExchange(MailConstants.MAIL_EXCHANGE_NAME);
            mailSendLog.setRouteKey(MailConstants.MAIL_ROUTING_KEY_NAME);
            mailSendLog.setEmpId(emp.getId());
            mailSendLog.setTryTime(<span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * MailConstants.MSG_TIMEOUT));
            mailSendLogService.insert(mailSendLog);
<span class="hljs-comment">//            rabbitTemplate.convertAndSend(&quot;lucifer.mail.welcome&quot;, emp);</span>
            rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, <span class="hljs-keyword">new</span> CorrelationData(msgId));

        &#125;
            <span class="hljs-keyword">return</span> result;
    &#125;</code></pre></div>

<p>添加Service方法</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">insert</span><span class="hljs-params">(MailSendLog mailSendLog)</span> </span>&#123;
    <span class="hljs-keyword">return</span> mailSendLogMapper.insert(mailSendLog);
&#125;</code></pre></div>

<p>Mapper，数据库记录每个消息发送的状态</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.MailSendLog&quot;</span>&gt;</span>
    insert into mail_send_log (msgId,empId,routeKey,exchange,tryTime,createTime) values (#&#123;msgId&#125;,#&#123;empId&#125;,#&#123;routeKey&#125;,#&#123;exchange&#125;,#&#123;tryTime&#125;,#&#123;createTime&#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<p>最后需要更改<code>MailReceiver</code>和<code>MailserverApplication</code>中的</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(queues = MailConstants.MAIL_QUEUE_NAME)</span>

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME);
    &#125;</code></pre></div>

<h4 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h4><p>当消息发送失败的时候，需要检测是否需要定时重发，首先在Service里定义task</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendTask</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    MailSendLogService mailSendLogService;
    <span class="hljs-meta">@Autowired</span>
    RabbitTemplate rabbitTemplate;
    <span class="hljs-meta">@Autowired</span>
    EmployeeService employeeService;
    <span class="hljs-comment">//每隔10s执行一次</span>
    <span class="hljs-meta">@Scheduled(cron = &quot;0/10 * * * * ?&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mailResendTask</span><span class="hljs-params">()</span> </span>&#123;
        List&lt;MailSendLog&gt; logs = mailSendLogService.getMailSendLogsByStatus();
        <span class="hljs-keyword">if</span> (logs == <span class="hljs-keyword">null</span> || logs.size() == <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">return</span>;
        &#125;
        logs.forEach(mailSendLog-&gt;&#123;
            <span class="hljs-keyword">if</span> (mailSendLog.getCount() &gt;= <span class="hljs-number">3</span>) &#123;
                mailSendLogService.updateMailSendLogStatus(mailSendLog.getMsgId(), <span class="hljs-number">2</span>);<span class="hljs-comment">//直接设置该条消息发送失败</span>
            &#125;<span class="hljs-keyword">else</span>&#123;
                mailSendLogService.updateCount(mailSendLog.getMsgId(), <span class="hljs-keyword">new</span> Date());
                Employee emp = employeeService.getEmployeeById(mailSendLog.getEmpId());
                rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, <span class="hljs-keyword">new</span> CorrelationData(mailSendLog.getMsgId()));
            &#125;
        &#125;);
    &#125;
&#125;</code></pre></div>

<p>需要注意的是，需要在启动类上加上注解<code>@EnableScheduling</code></p>
<p>添加对应Service方法</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;MailSendLog&gt; <span class="hljs-title">getMailSendLogsByStatus</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> mailSendLogMapper.getMailSendLogsByStatus();
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">updateCount</span><span class="hljs-params">(String msgId, Date date)</span> </span>&#123;
    <span class="hljs-keyword">return</span> mailSendLogMapper.updateCount(msgId,date);
&#125;</code></pre></div>

<p>Mapper</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getMailSendLogsByStatus&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;org.lucifer.vbluciferpro.model.MailSendLog&quot;</span>&gt;</span>
    # 尝试的时间小于当前时间，需要重新处理
    select * from mail_send_log where status=0 and tryTime <span class="hljs-symbol">&amp;lt;</span> sysdate()
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateCount&quot;</span>&gt;</span>
    update mail_send_log set count=count+1,updateTime=#&#123;date&#125; where msgId=#&#123;msgId&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre></div>

<p>在配置文件中配置回调</p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#开启confirms回调</span>
<span class="hljs-comment">#spring.rabbitmq.publisher-confirms=true</span>
<span class="hljs-comment">#开启returnedMessage回调</span>
<span class="hljs-comment">#spring.rabbitmq.publisher-returns=true</span>

<span class="hljs-comment">#新版springboot需要这样配置</span>
<span class="hljs-meta">spring.rabbitmq.publisher-confirm-type</span>=<span class="hljs-string">correlated</span></code></pre></div>

<blockquote>
<p>spring.rabbitmq.publisher-confirm在springboot2.2.0.RELEASE版本之前是amqp正式支持的属性，用来配置消息发送到交换器之后是否触发回调方法，在2.2.0及之后使用spring.rabbitmq.publisher-confirm-type属性配置代替，用来配置更多的确认类型；</p>
<p>其中：</p>
<ul>
<li>NONE值是禁用发布确认模式，是默认值</li>
<li>CORRELATED值是发布消息成功到交换器后会触发回调方法</li>
<li>SIMPLE值经测试有两种效果，其一效果和CORRELATED值一样会触发回调方法，其二在发布消息成功后使用rabbitTemplate调用waitForConfirms或waitForConfirmsOrDie方法等待broker节点返回发送结果，根据返回结果来判定下一步的逻辑，要注意的点是waitForConfirmsOrDie方法如果返回false则会关闭channel，则接下来无法发送消息到broker;</li>
</ul>
</blockquote>
<h3 id="消息消费"><a href="#消息消费" class="headerlink" title="消息消费"></a>消息消费</h3><p>利用Redis，当有多个相同的消息发送的时候，只被消费一次，不产生重复消费，因为每个消息有唯一id，每次把id存到redis中去，然后查这个消息是否被消费过，如果被消费过，就不再重复消费</p>
<p><strong>首先在mail模块添加依赖</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>配置redis</p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#开启手动确认</span>
<span class="hljs-meta">spring.rabbitmq.listener.simple.acknowledge-mode</span>=<span class="hljs-string">manual</span>

<span class="hljs-comment">#redis</span>
<span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">172.16.211.4</span>
<span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span>
<span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span></code></pre></div>

<blockquote>
<p>注意，redis需要开启远程访问</p>
</blockquote>
<p>每次需要手动确认消息，更改消息接收类</p>
<p>主要是利用<code>channel.basicAck</code>和<code>channel.basicNack</code>来确认是否被消费过</p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailReceiver</span> </span>&#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(MailReceiver.class);

    <span class="hljs-meta">@Autowired</span>
    JavaMailSender javaMailSender;
    <span class="hljs-meta">@Autowired</span>
    MailProperties mailProperties;
    <span class="hljs-meta">@Autowired</span>
    TemplateEngine templateEngine;
    <span class="hljs-meta">@Autowired</span>
    StringRedisTemplate redisTemplate;

    <span class="hljs-meta">@RabbitListener(queues =  MailConstants.MAIL_QUEUE_NAME)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
        <span class="hljs-comment">//利用redis完成消息消费</span>
        Employee employee = (Employee) message.getPayload();
        MessageHeaders headers = message.getHeaders();
        Long tag = (Long) headers.get(AmqpHeaders.DELIVERY_TAG);
        String msgId = (String) headers.get(<span class="hljs-string">&quot;spring_returned_message_correlation&quot;</span>);
        <span class="hljs-keyword">if</span> (redisTemplate.opsForHash().entries(<span class="hljs-string">&quot;mail_log&quot;</span>).containsKey(msgId)) &#123;
            <span class="hljs-comment">//redis 中包含该 key，说明该消息已经被消费过</span>
            logger.info(msgId + <span class="hljs-string">&quot;:消息已经被消费&quot;</span>);
            channel.basicAck(tag, <span class="hljs-keyword">false</span>);<span class="hljs-comment">//确认消息已消费</span>
            <span class="hljs-keyword">return</span>;
        &#125;
        <span class="hljs-comment">//收到消息，发送邮件</span>
        MimeMessage msg = javaMailSender.createMimeMessage();
        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(msg);


        <span class="hljs-keyword">try</span> &#123;
            helper.setTo(employee.getEmail());
            helper.setFrom(mailProperties.getUsername());
            helper.setSubject(<span class="hljs-string">&quot;入职欢迎!&quot;</span>);
            helper.setSentDate(<span class="hljs-keyword">new</span> Date());
            Context context = <span class="hljs-keyword">new</span> Context();
            context.setVariable(<span class="hljs-string">&quot;name&quot;</span>, employee.getName());
            context.setVariable(<span class="hljs-string">&quot;posName&quot;</span>, employee.getPosition().getName());
            context.setVariable(<span class="hljs-string">&quot;joblevelName&quot;</span>, employee.getJobLevel().getName());
            context.setVariable(<span class="hljs-string">&quot;departmentName&quot;</span>, employee.getDepartment().getName());
            <span class="hljs-comment">//对应mail.html</span>
            String mail = templateEngine.process(<span class="hljs-string">&quot;mail&quot;</span>, context);
            helper.setText(mail, <span class="hljs-keyword">true</span>);
            javaMailSender.send(msg);
            redisTemplate.opsForHash().put(<span class="hljs-string">&quot;mail_log&quot;</span>, msgId, <span class="hljs-string">&quot;lucifer&quot;</span>);
            channel.basicAck(tag, <span class="hljs-keyword">false</span>);
            logger.info(msgId + <span class="hljs-string">&quot;:邮件发送成功&quot;</span>);
        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;
            channel.basicNack(tag, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);
            e.printStackTrace();
            <span class="hljs-comment">//发送失败，返回日志</span>
            logger.error(<span class="hljs-string">&quot;邮件发送失败：&quot;</span> + e.getMessage());
        &#125;
    &#125;
&#125;</code></pre></div>

<h2 id="Spring-Cache缓存菜单"><a href="#Spring-Cache缓存菜单" class="headerlink" title="Spring Cache缓存菜单"></a>Spring Cache缓存菜单</h2><p>在Spring Boot中，使用Redis缓存，既可以使用RedisTemplate自己来实现，也可以使用使用这种方式，这种方式是Spring Cache提供的统一接口，实现既可以是Redis，也可以是Ehcache或者其他支持这种规范的缓存框架。从这个角度来说，Spring Cache和Redis、Ehcache的关系就像JDBC与各种数据库驱动的关系。</p>
<p><strong>在web模块中引入依赖</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><strong>配置文件</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#开启redis+cache缓存</span>
<span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">172.16.211.4</span>
<span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span>
<span class="hljs-meta">spring.redis.database</span>=<span class="hljs-string">0</span>

<span class="hljs-meta">spring.cache.cache-names</span>=<span class="hljs-string">menus_cache</span></code></pre></div>

<p><strong>启动类</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableCaching</span>
<span class="hljs-meta">@MapperScan(basePackages=&quot;org.lucifer.vbluciferpro.mapper&quot;)</span>
<span class="hljs-meta">@EnableScheduling</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuciferproWebApplication</span> </span>&#123;</code></pre></div>

<p>EnableCaching注解里</p>
<p><img src="https://luciferfigurebed.oss-cn-chengdu.aliyuncs.com/uPic/image-20210716171759970.png" srcset="/img/loading.gif" lazyload alt="image-20210716171759970"></p>
<p>默认使用JDK代理，如果设为true，将使用cglaib</p>
<p><strong>引入Service</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@CacheConfig(cacheNames = &quot;menus_cache&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MenuService</span> </span>&#123;
  
  <span class="hljs-meta">@Cacheable</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Menu&gt; <span class="hljs-title">getAllMenusWithRole</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> menuMapper.getAllMenusWithRole();
  &#125; 
  
&#125;</code></pre></div>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/">技术分享</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/Spring-Security/">Spring Security</a>
                    
                      <a class="hover-with-bg" href="/tags/SpringBoot/">SpringBoot</a>
                    
                      <a class="hover-with-bg" href="/tags/MyBatis/">MyBatis</a>
                    
                      <a class="hover-with-bg" href="/tags/MySQL/">MySQL</a>
                    
                      <a class="hover-with-bg" href="/tags/WebSocket/">WebSocket</a>
                    
                      <a class="hover-with-bg" href="/tags/RabbitMQ/">RabbitMQ</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/09/%E6%B5%85%E8%B0%88Spring%20Security%E5%AE%9E%E7%8E%B0RBAC%E6%A8%A1%E5%9E%8B/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">浅谈Spring Security实现RBAC模型</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/05/SpringBoot/">
                        <span class="hidden-mobile">SpringBoot合集</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#valine",
          app_id: "Q8utolFFXQsi71pQY6bCltkI-gzGzoHsz",
          app_key: "x4RAlPOpmFX9HdGyI6MLoCGn",
          placeholder: "说点什么....",
          path: window.location.pathname,
          avatar: "monsterid",
          meta: ["nick","mail","link"],
          pageSize: "12",
          lang: "zh-CN",
          highlight: true,
          recordIP: true,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>





  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
